/** Cooked with Flambe, https://getflambe.com */
'use strict';(function(){function v(a,b){function c(){}c.prototype=a;var d=new c,e;for(e in b)d[e]=b[e];b.toString!==Object.prototype.toString&&(d.toString=b.toString);return d}function Oj(a){return a instanceof Array?function(){return E.iter(a)}:"function"==typeof a.iterator?y(a,a.iterator):a.iterator}function y(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=Qk++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=function(){return c.method.apply(c.scope,
arguments)},c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c);return c}var h={},j=function(){return A.__string_rec(this,"")},cc=function(a,b){b=b.split("u").join("");this.r=RegExp(a,b)};h.EReg=cc;cc.__name__=!0;cc.prototype={match:function(a){this.r.global&&(this.r.lastIndex=0);this.r.m=this.r.exec(a);this.r.s=a;return null!=this.r.m},replace:function(a,b){return a.replace(this.r,b)},__class__:cc};var E=function(){};h.HxOverrides=E;E.__name__=!0;E.cca=function(a,b){var c=a.charCodeAt(b);return c!=
c?void 0:c};E.substr=function(a,b,c){if(null!=b&&0!=b&&null!=c&&0>c)return"";null==c&&(c=a.length);0>b?(b=a.length+b,0>b&&(b=0)):0>c&&(c=a.length+c-b);return a.substr(b,c)};E.remove=function(a,b){var c=a.indexOf(b);if(-1==c)return!1;a.splice(c,1);return!0};E.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var Rh=function(a,b){this.min=a;this.max=b};h.IntIterator=Rh;Rh.__name__=!0;Rh.prototype={__class__:Rh};var Ef=
function(){};h.Lambda=Ef;Ef.__name__=!0;Ef.array=function(a){for(var b=[],a=Oj(a)();a.hasNext();){var c=a.next();b.push(c)}return b};Ef.count=function(a,b){var c=0;if(null==b)for(var d=Oj(a)();d.hasNext();)d.next(),c++;else for(d=Oj(a)();d.hasNext();){var e=d.next();b(e)&&c++}return c};var Sh=function(){this.length=0};h.List=Sh;Sh.__name__=!0;Sh.prototype={add:function(a){a=[a];null==this.h?this.h=a:this.q[1]=a;this.q=a;this.length++},iterator:function(){return new Th(this.h)},__class__:Sh};var Th=
function(a){this.head=a;this.val=null};h["_List.ListIterator"]=Th;Th.__name__=!0;Th.prototype={hasNext:function(){return null!=this.head},next:function(){this.val=this.head[0];this.head=this.head[1];return this.val},__class__:Th};Math.__name__=!0;var Q=function(){};h.Reflect=Q;Q.__name__=!0;Q.field=function(a,b){try{return a[b]}catch(c){return c instanceof p&&(c=c.val),null}};Q.getProperty=function(a,b){var c;return null==a?null:a.__properties__&&(c=a.__properties__["get_"+b])?a[c]():a[b]};Q.callMethod=
function(a,b,c){return b.apply(a,c)};Q.isFunction=function(a){return"function"==typeof a&&!(a.__name__||a.__ename__)};Q.compare=function(a,b){return a==b?0:a>b?1:-1};Q.isEnumValue=function(a){return null!=a&&null!=a.__enum__};Q.makeVarArgs=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a(b)}};var q=function(){};h.Std=q;q.__name__=!0;q.is=function(a,b){return A.__instanceof(a,b)};q.instance=function(a,b){return a instanceof b?a:null};q.string=function(a){return A.__string_rec(a,
"")};q["int"]=function(a){return a|0};q.parseInt=function(a){var b=parseInt(a,10);if(0==b&&(120==E.cca(a,1)||88==E.cca(a,1)))b=parseInt(a);return isNaN(b)?null:b};q.parseFloat=function(a){return parseFloat(a)};q.random=function(a){return 0>=a?0:Math.floor(Math.random()*a)};var qc=function(){this.b=""};h.StringBuf=qc;qc.__name__=!0;qc.prototype={add:function(a){this.b+=q.string(a)},addSub:function(a,b,c){this.b=null==c?this.b+E.substr(a,b,null):this.b+E.substr(a,b,c)},__class__:qc};var Ja=function(){};
h.StringTools=Ja;Ja.__name__=!0;Ja.htmlEscape=function(a,b){a=a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;");return b?a.split('"').join("&quot;").split("'").join("&#039;"):a};Ja.isSpace=function(a,b){var c=E.cca(a,b);return 8<c&&14>c||32==c};Ja.ltrim=function(a){for(var b=a.length,c=0;c<b&&Ja.isSpace(a,c);)c++;return 0<c?E.substr(a,c,b-c):a};Ja.rtrim=function(a){for(var b=a.length,c=0;c<b&&Ja.isSpace(a,b-c-1);)c++;return 0<c?E.substr(a,0,b-c):a};Ja.trim=function(a){return Ja.ltrim(Ja.rtrim(a))};
Ja.replace=function(a,b,c){return a.split(b).join(c)};Ja.fastCodeAt=function(a,b){return a.charCodeAt(b)};var Ua=function(){};h.Type=Ua;Ua.__name__=!0;Ua.resolveClass=function(a){a=h[a];return null==a||!a.__name__?null:a};Ua.resolveEnum=function(a){a=h[a];return null==a||!a.__ename__?null:a};Ua.createInstance=function(a,b){switch(b.length){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],
b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6]);case 8:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7]);default:throw new p("Too many arguments");}};Ua.createEnum=function(a,b,c){var d=Q.field(a,b);if(null==d)throw new p("No such constructor "+b);if(Q.isFunction(d)){if(null==c)throw new p("Constructor "+b+" need parameters");return Q.callMethod(a,d,c)}if(null!=c&&0!=c.length)throw new p("Constructor "+b+" does not need parameters");
return d};Ua.enumEq=function(a,b){if(a==b)return!0;try{if(a[0]!=b[0])return!1;for(var c=2,d=a.length;c<d;){var e=c++;if(!Ua.enumEq(a[e],b[e]))return!1}var i=a.__enum__;if(i!=b.__enum__||null==i)return!1}catch(m){return m instanceof p&&(m=m.val),!1}return!0};Ua.allEnums=function(a){return a.__empty_constructs__};var o=function(a){this.nodeType=a;this.children=[];this.attributeMap=new D};h.Xml=o;o.__name__=!0;o.parse=function(a){return Nc.parse(a)};o.createElement=function(a){var b=new o(o.Element);
if(b.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+b.nodeType);b.nodeName=a;return b};o.createPCData=function(a){var b=new o(o.PCData);if(b.nodeType==o.Document||b.nodeType==o.Element)throw new p("Bad node type, unexpected "+b.nodeType);b.nodeValue=a;return b};o.createCData=function(a){var b=new o(o.CData);if(b.nodeType==o.Document||b.nodeType==o.Element)throw new p("Bad node type, unexpected "+b.nodeType);b.nodeValue=a;return b};o.createComment=function(a){var b=new o(o.Comment);
if(b.nodeType==o.Document||b.nodeType==o.Element)throw new p("Bad node type, unexpected "+b.nodeType);b.nodeValue=a;return b};o.createDocType=function(a){var b=new o(o.DocType);if(b.nodeType==o.Document||b.nodeType==o.Element)throw new p("Bad node type, unexpected "+b.nodeType);b.nodeValue=a;return b};o.createProcessingInstruction=function(a){var b=new o(o.ProcessingInstruction);if(b.nodeType==o.Document||b.nodeType==o.Element)throw new p("Bad node type, unexpected "+b.nodeType);b.nodeValue=a;return b};
o.createDocument=function(){return new o(o.Document)};o.prototype={get_nodeName:function(){if(this.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+this.nodeType);return this.nodeName},set_nodeName:function(a){if(this.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+this.nodeType);return this.nodeName=a},get_nodeValue:function(){if(this.nodeType==o.Document||this.nodeType==o.Element)throw new p("Bad node type, unexpected "+this.nodeType);return this.nodeValue},
get:function(a){if(this.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+this.nodeType);return this.attributeMap.get(a)},set:function(a,b){if(this.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+this.nodeType);this.attributeMap.set(a,b)},remove:function(a){if(this.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+this.nodeType);this.attributeMap.remove(a)},exists:function(a){if(this.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+
this.nodeType);return this.attributeMap.exists(a)},attributes:function(){if(this.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+this.nodeType);return this.attributeMap.keys()},elements:function(){if(this.nodeType!=o.Document&&this.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+this.nodeType);for(var a=[],b=0,c=this.children;b<c.length;){var d=c[b];++b;d.nodeType==o.Element&&a.push(d)}return E.iter(a)},elementsNamed:function(a){if(this.nodeType!=
o.Document&&this.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+this.nodeType);for(var b=[],c=0,d=this.children;c<d.length;){var e=d[c];++c;var i;if(i=e.nodeType==o.Element){if(e.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+e.nodeType);i=e.nodeName==a}i&&b.push(e)}return E.iter(b)},firstChild:function(){if(this.nodeType!=o.Document&&this.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+
this.nodeType);return this.children[0]},firstElement:function(){if(this.nodeType!=o.Document&&this.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+this.nodeType);for(var a=0,b=this.children;a<b.length;){var c=b[a];++a;if(c.nodeType==o.Element)return c}return null},addChild:function(a){if(this.nodeType!=o.Document&&this.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+this.nodeType);null!=a.parent&&a.parent.removeChild(a);
this.children.push(a);a.parent=this},removeChild:function(a){if(this.nodeType!=o.Document&&this.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+this.nodeType);return E.remove(this.children,a)?(a.parent=null,!0):!1},insertChild:function(a,b){if(this.nodeType!=o.Document&&this.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+this.nodeType);null!=a.parent&&E.remove(a.parent.children,a);this.children.splice(b,0,a);a.parent=
this},__class__:o,__properties__:{get_nodeValue:"get_nodeValue",set_nodeName:"set_nodeName",get_nodeName:"get_nodeName"}};var yd=function(){};h["flambe.util.Disposable"]=yd;yd.__name__=!0;yd.prototype={__class__:yd};var ha=function(){this._flags=0;this.owner=this.next=null};h["flambe.Component"]=ha;ha.__name__=!0;ha.__interfaces__=[yd];ha.prototype={onAdded:function(){},onRemoved:function(){},onStart:function(){},onStop:function(){},onUpdate:function(){},dispose:function(){null!=this.owner&&this.owner.remove(this)},
get_name:function(){return null},__class__:ha,__properties__:{get_name:"get_name"}};var Va=function(){this.parent=this.firstChild=this.next=this.firstComponent=null;this._compMap={}};h["flambe.Entity"]=Va;Va.__name__=!0;Va.__interfaces__=[yd];Va.prototype={add:function(a){null!=a.owner&&a.owner.remove(a);var b=a.get_name(),c=this._compMap[b];null!=c&&this.remove(c);this._compMap[b]=a;b=null;for(c=this.firstComponent;null!=c;)b=c,c=c.next;null!=b?b.next=a:this.firstComponent=a;a.owner=this;a.next=
null;a.onAdded();return this},remove:function(a){for(var b=null,c=this.firstComponent;null!=c;){var d=c.next;if(c==a)return null==b?this.firstComponent=d:(b.owner=this,b.next=d),delete this._compMap[c.get_name()],0!=(c._flags&1)&&(c.onStop(),c._flags&=-2),c.onRemoved(),c.owner=null,c.next=null,!0;b=c;c=d}return!1},addChild:function(a,b){null==b&&(b=!0);null!=a.parent&&a.parent.removeChild(a);a.parent=this;if(b){for(var c=null,d=this.firstChild;null!=d;)c=d,d=d.next;null!=c?c.next=a:this.firstChild=
a}else a.next=this.firstChild,this.firstChild=a;return this},removeChild:function(a){for(var b=null,c=this.firstChild;null!=c;){var d=c.next;if(c==a){null==b?this.firstChild=d:b.next=d;c.parent=null;c.next=null;break}b=c;c=d}},disposeChildren:function(){for(;null!=this.firstChild;)this.firstChild.dispose()},dispose:function(){for(null!=this.parent&&this.parent.removeChild(this);null!=this.firstComponent;)this.firstComponent.dispose();this.disposeChildren()},__class__:Va};var Ff=function(){};h["flambe.util.PackageLog"]=
Ff;Ff.__name__=!0;var Uh=function(){};h["flambe.platform.Platform"]=Uh;Uh.__name__=!0;Uh.prototype={__class__:Uh};var rc=function(){};h["flambe.platform.html.HtmlPlatform"]=rc;rc.__name__=!0;rc.__interfaces__=[Uh];rc.prototype={init:function(){var a=this;F.fixAndroidMath();var b=null;try{b=window.flambe.canvas}catch(c){c instanceof p&&(c=c.val)}b.setAttribute("tabindex","0");b.style.outlineStyle="none";b.style.webkitTapHighlightColor="transparent";this._stage=new Id(b);this._pointer=new rb;this._mouse=
new Gf(this._pointer,b);this._renderer=this.createRenderer(b);this.mainLoop=new me;this.musicPlaying=!1;this._canvas=b;this._container=b.parentElement;this._container.style.overflow="hidden";this._container.style.position="relative";this._container.style.msTouchAction="none";var d=0,e=function(c){if(!(1E3>c.timeStamp-d)){var e=b.getBoundingClientRect(),i=a.getX(c,e),e=a.getY(c,e);switch(c.type){case "mousedown":c.target==b&&(c.preventDefault(),a._mouse.submitDown(i,e,c.button),b.focus());break;case "mousemove":a._mouse.submitMove(i,
e);break;case "mouseup":a._mouse.submitUp(i,e,c.button);break;case "mousewheel":case "DOMMouseScroll":a._mouse.submitScroll(i,e,"mousewheel"==c.type?c.wheelDelta/40:-c.detail)&&c.preventDefault()}}};window.addEventListener("mousedown",e,!1);window.addEventListener("mousemove",e,!1);window.addEventListener("mouseup",e,!1);b.addEventListener("mousewheel",e,!1);b.addEventListener("DOMMouseScroll",e,!1);b.addEventListener("contextmenu",function(a){a.preventDefault()},!1);var i="undefined"!=typeof window.ontouchstart,
e="msMaxTouchPoints"in window.navigator&&1<window.navigator.msMaxTouchPoints;if(i||e){var m=new Hf(this._pointer,i?4:window.navigator.msMaxTouchPoints);this._touch=m;e=function(b){var c;c=i?b.changedTouches:[b];var e=b.target.getBoundingClientRect();d=b.timeStamp;switch(b.type){case "touchstart":case "MSPointerDown":case "pointerdown":b.preventDefault();F.SHOULD_HIDE_MOBILE_BROWSER&&F.hideMobileBrowser();for(b=0;b<c.length;){var f=c[b];++b;var Vh=a.getX(f,e),r=a.getY(f,e);m.submitDown((i?f.identifier:
f.pointerId)|0,Vh,r)}break;case "touchmove":case "MSPointerMove":case "pointermove":b.preventDefault();for(b=0;b<c.length;)f=c[b],++b,Vh=a.getX(f,e),r=a.getY(f,e),m.submitMove((i?f.identifier:f.pointerId)|0,Vh,r);break;case "touchend":case "touchcancel":case "MSPointerUp":case "pointerup":for(b=0;b<c.length;)f=c[b],++b,Vh=a.getX(f,e),r=a.getY(f,e),m.submitUp((i?f.identifier:f.pointerId)|0,Vh,r)}};i?(b.addEventListener("touchstart",e,!1),b.addEventListener("touchmove",e,!1),b.addEventListener("touchend",
e,!1),b.addEventListener("touchcancel",e,!1)):(b.addEventListener("MSPointerDown",e,!1),b.addEventListener("MSPointerMove",e,!1),b.addEventListener("MSPointerUp",e,!1))}else this._touch=new If;var f=window.onerror;window.onerror=function(a,b,c){Y.uncaughtError.emit(a);return null!=f?f(a,b,c):!1};var r=F.loadExtension("hidden",window.document);null!=r.value?(e=function(){Y.hidden.set__(Q.field(window.document,r.field))},e(null),window.document.addEventListener(r.prefix+"visibilitychange",e,!1)):(e=
function(a){Y.hidden.set__("pagehide"==a.type)},window.addEventListener("pageshow",e,!1),window.addEventListener("pagehide",e,!1));Y.hidden.get_changed().connect(function(b){b||(a._skipFrame=!0)});this._skipFrame=!1;this._lastUpdate=Date.now();var g=F.loadExtension("requestAnimationFrame").value;if(null!=g){var h=window.performance,j=null!=h&&F.polyfill("now",h);j?this._lastUpdate=h.now():Aa.logger.warn("No monotonic timer support, falling back to the system date",null);var k=null,k=function(c){a.update(j?
h.now():c);g(k,b)};g(k,b)}else Aa.logger.warn("No requestAnimationFrame support, falling back to setInterval",null),window.setInterval(function(){a.update(Date.now())},16);Aa.info("Initialized HTML platform",["renderer",this._renderer.get_type()])},loadAssetPack:function(a){return(new ka(this,a)).promise},getStage:function(){return this._stage},createLogHandler:function(a){return Zd.isSupported()?new Zd(a):null},update:function(a){var b=(a-this._lastUpdate)/1E3;this._lastUpdate=a;Y.hidden._value||
(this._skipFrame?this._skipFrame=!1:(this.mainLoop.update(b),Oc.onRender()))},getPointer:function(){return this._pointer},getMouse:function(){return this._mouse},getKeyboard:function(){var a=this;if(null==this._keyboard){this._keyboard=new Pc;var b=function(b){switch(b.type){case "keydown":a._keyboard.submitDown(b.keyCode)&&b.preventDefault();break;case "keyup":a._keyboard.submitUp(b.keyCode)}};this._canvas.addEventListener("keydown",b,!1);this._canvas.addEventListener("keyup",b,!1)}return this._keyboard},
getExternal:function(){null==this._external&&(this._external=new Jf);return this._external},getRenderer:function(){return this._renderer},getX:function(a,b){return(a.clientX-b.left)*this._stage.get_width()/b.width},getY:function(a,b){return(a.clientY-b.top)*this._stage.get_height()/b.height},createRenderer:function(a){try{var b=Pj.getContextWebGL(a,{depth:!1,failIfMajorPerformanceCaveat:!0});if(null!=b)if(F.detectSlowDriver(b))Aa.logger.warn("Detected a slow WebGL driver, falling back to canvas",
null);else return new Kf(this._stage,b)}catch(c){c instanceof p&&(c=c.val)}return new Jd(a)},__class__:rc};var xa=function(a,b){this._value=a;this._changed=null!=b?new zd(b):null};h["flambe.util.Value"]=xa;xa.__name__=!0;xa.prototype={watch:function(a){a(this._value,this._value);return this.get_changed().connect(a)},set__:function(a){var b=this._value;a!=b&&(this._value=a,null!=this._changed&&this._changed.emit(a,b));return a},get_changed:function(){null==this._changed&&(this._changed=new zd);return this._changed},
__class__:xa,__properties__:{get_changed:"get_changed",set__:"set__"}};var ne=function(a,b){this._next=null;this._signal=a;this._listener=b;this.stayInList=!0};h["flambe.util.SignalConnection"]=ne;ne.__name__=!0;ne.__interfaces__=[yd];ne.prototype={once:function(){this.stayInList=!1;return this},dispose:function(){null!=this._signal&&(this._signal.disconnect(this),this._signal=null)},__class__:ne};var Pa=function(a){this._head=null!=a?new ne(this,a):null;this._deferredTasks=null};h["flambe.util.SignalBase"]=
Pa;Pa.__name__=!0;Pa.prototype={hasListeners:function(){return null!=this._head},connectImpl:function(a,b){var c=this,d=new ne(this,a);this._head==Pa.DISPATCHING_SENTINEL?this.defer(function(){c.listAdd(d,b)}):this.listAdd(d,b);return d},disconnect:function(a){var b=this;this._head==Pa.DISPATCHING_SENTINEL?this.defer(function(){b.listRemove(a)}):this.listRemove(a)},defer:function(a){for(var b=null,c=this._deferredTasks;null!=c;)b=c,c=c.next;a=new Wh(a);null!=b?b.next=a:this._deferredTasks=a},willEmit:function(){var a=
this._head;this._head=Pa.DISPATCHING_SENTINEL;return a},didEmit:function(a){this._head=a;a=this._deferredTasks;for(this._deferredTasks=null;null!=a;)a.fn(),a=a.next},listAdd:function(a,b){if(b)a._next=this._head,this._head=a;else{for(var c=null,d=this._head;null!=d;)c=d,d=d._next;null!=c?c._next=a:this._head=a}},listRemove:function(a){for(var b=null,c=this._head;null!=c;){if(c==a){a=c._next;null==b?this._head=a:b._next=a;break}b=c;c=c._next}},__class__:Pa};var zd=function(a){Pa.call(this,a)};h["flambe.util.Signal2"]=
zd;zd.__name__=!0;zd.__super__=Pa;zd.prototype=v(Pa.prototype,{connect:function(a,b){null==b&&(b=!1);return this.connectImpl(a,b)},emit:function(a,b){var c=this;this._head==Pa.DISPATCHING_SENTINEL?this.defer(function(){c.emitImpl(a,b)}):this.emitImpl(a,b)},emitImpl:function(a,b){for(var c=this.willEmit(),d=c;null!=d;)d._listener(a,b),d.stayInList||d.dispose(),d=d._next;this.didEmit(c)},__class__:zd});var fa=function(a){Pa.call(this,a)};h["flambe.util.Signal1"]=fa;fa.__name__=!0;fa.__super__=Pa;fa.prototype=
v(Pa.prototype,{connect:function(a,b){null==b&&(b=!1);return this.connectImpl(a,b)},emit:function(a){var b=this;this._head==Pa.DISPATCHING_SENTINEL?this.defer(function(){b.emitImpl(a)}):this.emitImpl(a)},emitImpl:function(a){for(var b=this.willEmit(),c=b;null!=c;)c._listener(a),c.stayInList||c.dispose(),c=c._next;this.didEmit(b)},__class__:fa});var Ka=function(a,b){this._behavior=null;xa.call(this,a,b)};h["flambe.animation.AnimatedFloat"]=Ka;Ka.__name__=!0;Ka.__super__=xa;Ka.prototype=v(xa.prototype,
{set__:function(a){this._behavior=null;return xa.prototype.set__.call(this,a)},update:function(a){null!=this._behavior&&(xa.prototype.set__.call(this,this._behavior.update(a)),this._behavior.isComplete()&&(this._behavior=null))},__class__:Ka});var Y=function(){};h["flambe.System"]=Y;Y.__name__=!0;Y.init=function(){Y._calledInit||(Y._platform.init(),Y._calledInit=!0)};var Lf=function(a){this._handler=a};h["flambe.util.Logger"]=Lf;Lf.__name__=!0;Lf.prototype={info:function(a,b){this.log(bb.Info,a,b)},
warn:function(a,b){this.log(bb.Warn,a,b)},error:function(a,b){this.log(bb.Error,a,b)},log:function(a,b,c){null!=this._handler&&(null==b&&(b=""),null!=c&&(b=sc.withFields(b,c)),this._handler.log(a,b))},__class__:Lf};var Aa=function(){};h["flambe.Log"]=Aa;Aa.__name__=!0;Aa.info=function(a,b){Aa.logger.info(a,b)};Aa.__super__=Ff;Aa.prototype=v(Ff.prototype,{__class__:Aa});var Xh=function(){this._realDt=0};h["flambe.SpeedAdjuster"]=Xh;Xh.__name__=!0;Xh.__super__=ha;Xh.prototype=v(ha.prototype,{get_name:function(){return"SpeedAdjuster_4"},
onUpdate:function(a){0<this._realDt&&(a=this._realDt,this._realDt=0);this.scale.update(a)},__class__:Xh});var Qj=function(){};h["flambe.animation.Behavior"]=Qj;Qj.__name__=!0;Qj.prototype={__class__:Qj};var Ad=function(){};h["flambe.asset.Asset"]=Ad;Ad.__name__=!0;Ad.__interfaces__=[yd];Ad.prototype={__class__:Ad};var C=h["flambe.asset.AssetFormat"]={__ename__:!0,__constructs__:"WEBP,JXR,PNG,JPG,GIF,DDS,PVR,PKM,MP3,M4A,OPUS,OGG,WAV,Data".split(",")};C.WEBP=["WEBP",0];C.WEBP.toString=j;C.WEBP.__enum__=
C;C.JXR=["JXR",1];C.JXR.toString=j;C.JXR.__enum__=C;C.PNG=["PNG",2];C.PNG.toString=j;C.PNG.__enum__=C;C.JPG=["JPG",3];C.JPG.toString=j;C.JPG.__enum__=C;C.GIF=["GIF",4];C.GIF.toString=j;C.GIF.__enum__=C;C.DDS=["DDS",5];C.DDS.toString=j;C.DDS.__enum__=C;C.PVR=["PVR",6];C.PVR.toString=j;C.PVR.__enum__=C;C.PKM=["PKM",7];C.PKM.toString=j;C.PKM.__enum__=C;C.MP3=["MP3",8];C.MP3.toString=j;C.MP3.__enum__=C;C.M4A=["M4A",9];C.M4A.toString=j;C.M4A.__enum__=C;C.OPUS=["OPUS",10];C.OPUS.toString=j;C.OPUS.__enum__=
C;C.OGG=["OGG",11];C.OGG.toString=j;C.OGG.__enum__=C;C.WAV=["WAV",12];C.WAV.toString=j;C.WAV.__enum__=C;C.Data=["Data",13];C.Data.toString=j;C.Data.__enum__=C;C.__empty_constructs__=[C.WEBP,C.JXR,C.PNG,C.JPG,C.GIF,C.DDS,C.PVR,C.PKM,C.MP3,C.M4A,C.OPUS,C.OGG,C.WAV,C.Data];var Yh=function(a,b,c,d){this.name=a;this.url=b;this.format=c;this.bytes=d};h["flambe.asset.AssetEntry"]=Yh;Yh.__name__=!0;Yh.prototype={__class__:Yh};var Mf=function(){};h["flambe.asset.AssetPack"]=Mf;Mf.__name__=!0;Mf.__interfaces__=
[yd];Mf.prototype={__class__:Mf};var Nf=function(){};h["flambe.asset.File"]=Nf;Nf.__name__=!0;Nf.__interfaces__=[Ad];Nf.prototype={__class__:Nf};var dc=function(){this._localBase=this._remoteBase=null;this._entries=[]};h["flambe.asset.Manifest"]=dc;dc.__name__=!0;dc.inferFormat=function(a){var b=sc.getUrlExtension(a);if(null!=b)switch(b.toLowerCase()){case "gif":return C.GIF;case "jpg":case "jpeg":return C.JPG;case "jxr":case "wdp":return C.JXR;case "png":return C.PNG;case "webp":return C.WEBP;case "dds":return C.DDS;
case "pvr":return C.PVR;case "pkm":return C.PKM;case "m4a":return C.M4A;case "mp3":return C.MP3;case "ogg":return C.OGG;case "opus":return C.OPUS;case "wav":return C.WAV}else Aa.logger.warn("No file extension for asset, it will be loaded as data",["url",a]);return C.Data};dc.prototype={add:function(a,b,c,d){null==c&&(c=0);null==d&&(d=dc.inferFormat(b));a=new Yh(a,b,d,c);this._entries.push(a);return a},iterator:function(){return E.iter(this._entries)},getFullURL:function(a){var b;b=null!=this.get_remoteBase()&&
dc._supportsCrossOrigin?this.get_remoteBase():this.get_localBase();return null!=b?sc.joinPath(b,a.url):a.url},get_localBase:function(){return this._localBase},get_remoteBase:function(){return this._remoteBase},__class__:dc,__properties__:{get_remoteBase:"get_remoteBase",get_localBase:"get_localBase"}};var ba=h["flambe.display.BlendMode"]={__ename__:!0,__constructs__:"Normal,Add,Multiply,Screen,Mask,Copy".split(",")};ba.Normal=["Normal",0];ba.Normal.toString=j;ba.Normal.__enum__=ba;ba.Add=["Add",1];
ba.Add.toString=j;ba.Add.__enum__=ba;ba.Multiply=["Multiply",2];ba.Multiply.toString=j;ba.Multiply.__enum__=ba;ba.Screen=["Screen",3];ba.Screen.toString=j;ba.Screen.__enum__=ba;ba.Mask=["Mask",4];ba.Mask.toString=j;ba.Mask.__enum__=ba;ba.Copy=["Copy",5];ba.Copy.toString=j;ba.Copy.__enum__=ba;ba.__empty_constructs__=[ba.Normal,ba.Add,ba.Multiply,ba.Screen,ba.Mask,ba.Copy];var ec=function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b};h["flambe.math.Point"]=ec;ec.__name__=!0;ec.prototype={__class__:ec};
var M=function(){this._sinCache=this._cosCache=0;this.blendMode=this.scissor=null;var a=this;ha.call(this);this._flags|=182;this._localMatrix=new Wa;var b=function(){a._flags|=24};this.x=new Ka(0,b);this.y=new Ka(0,b);this.rotation=new Ka(0,function(){a._flags|=152});this.scaleX=new Ka(1,b);this.scaleY=new Ka(1,b);this.anchorX=new Ka(0,b);this.anchorY=new Ka(0,b);this.alpha=new Ka(1)};h["flambe.display.Sprite"]=M;M.__name__=!0;M.hitTest=function(a,b,c){var d=a._compMap.Sprite_3;if(null!=d){if(6!=
(d._flags&6))return null;d.getLocalMatrix().inverseTransform(b,c,M._scratchPoint)&&(b=M._scratchPoint.x,c=M._scratchPoint.y);var e=d.scissor;if(null!=e&&!e.contains(b,c))return null}a=M.hitTestBackwards(a.firstChild,b,c);return null!=a?a:null!=d&&d.containsLocal(b,c)?d:null};M.getBounds=function(a,b){null==b&&(b=new tc);b.set(1.79769313486231E308,1.79769313486231E308,-1.79769313486231E308,-1.79769313486231E308);M.getBoundsImpl(a,null,b);b.width-=b.x;b.height-=b.y;return b};M.render=function(a,b){var c=
a._compMap.Sprite_3;if(null!=c){var d=c.alpha._value;if(0==(c._flags&2)||0>=d)return;b.save();1>d&&b.multiplyAlpha(d);null!=c.blendMode&&b.setBlendMode(c.blendMode);var d=c.getLocalMatrix(),e=d.m02,i=d.m12;0!=(c._flags&32)&&(e=Math.round(e),i=Math.round(i));b.transform(d.m00,d.m10,d.m01,d.m11,e,i);d=c.scissor;null!=d&&b.applyScissor(d.x,d.y,d.width,d.height);c.draw(b)}d=a._compMap.Director_6;if(null!=d){d=d.occludedScenes;for(e=0;e<d.length;)i=d[e],++e,M.render(i,b)}for(d=a.firstChild;null!=d;)e=
d.next,M.render(d,b),d=e;null!=c&&b.restore()};M.hitTestBackwards=function(a,b,c){if(null!=a){var d=M.hitTestBackwards(a.next,b,c);return null!=d?d:M.hitTest(a,b,c)}return null};M.getBoundsImpl=function(a,b,c){var d=a._compMap.Sprite_3;if(null!=d){var b=null!=b?Wa.multiply(b,d.getLocalMatrix()):d.getLocalMatrix(),e=d.getNaturalWidth(),d=d.getNaturalHeight();0<e&&0<d&&(M.extendRect(b,0,0,c),M.extendRect(b,e,0,c),M.extendRect(b,e,d,c),M.extendRect(b,0,d,c))}e=a._compMap.Director_6;if(null!=e)for(var e=
e.occludedScenes,d=0,i=e.length;d<i;)M.getBoundsImpl(e[d],b,c),++d;for(a=a.firstChild;null!=a;)e=a.next,M.getBoundsImpl(a,b,c),a=e};M.extendRect=function(a,b,c,d){a=a.transform(b,c,M._scratchPoint);b=a.x;c=a.y;b<d.x&&(d.x=b);c<d.y&&(d.y=c);b>d.width&&(d.width=b);c>d.height&&(d.height=c)};M.__super__=ha;M.prototype=v(ha.prototype,{get_name:function(){return"Sprite_3"},getNaturalWidth:function(){return 0},getNaturalHeight:function(){return 0},containsLocal:function(a,b){return 0<=a&&a<this.getNaturalWidth()&&
0<=b&&b<this.getNaturalHeight()},getLocalMatrix:function(){if(0!=(this._flags&8)){this._flags&=-9;if(0!=(this._flags&128)){this._flags&=-129;var a=3.141592653589793*this.rotation._value/180;this._sinCache=Math.sin(a);this._cosCache=Math.cos(a)}var a=this.scaleX._value,b=this.scaleY._value;this._localMatrix.set(this._cosCache*a,this._sinCache*a,-this._sinCache*b,this._cosCache*b,this.x._value,this.y._value);this._localMatrix.translate(-this.anchorX._value,-this.anchorY._value)}return this._localMatrix},
centerAnchor:function(){this.anchorX.set__(this.getNaturalWidth()/2);this.anchorY.set__(this.getNaturalHeight()/2);return this},setXY:function(a,b){this.x.set__(a);this.y.set__(b);return this},setAlpha:function(a){this.alpha.set__(a);return this},setScaleXY:function(a,b){this.scaleX.set__(a);this.scaleY.set__(b);return this},onAdded:function(){0!=(this._flags&64)&&this.connectHover()},onRemoved:function(){null!=this._hoverConnection&&(this._hoverConnection.dispose(),this._hoverConnection=null)},onUpdate:function(a){this.x.update(a);
this.y.update(a);this.rotation.update(a);this.scaleX.update(a);this.scaleY.update(a);this.alpha.update(a);this.anchorX.update(a);this.anchorY.update(a)},draw:function(){},getParentSprite:function(){if(null==this.owner)return null;for(var a=this.owner.parent;null!=a;){var b=a._compMap.Sprite_3;if(null!=b)return b;a=a.parent}return null},get_pointerDown:function(){null==this._pointerDown&&(this._pointerDown=new fa);return this._pointerDown},get_pointerMove:function(){null==this._pointerMove&&(this._pointerMove=
new fa);return this._pointerMove},get_pointerUp:function(){null==this._pointerUp&&(this._pointerUp=new fa);return this._pointerUp},get_pointerIn:function(){null==this._pointerIn&&(this._pointerIn=new fa);return this._pointerIn},get_pointerOut:function(){null==this._pointerOut&&(this._pointerOut=new fa);return this._pointerOut},connectHover:function(){var a=this;null==this._hoverConnection&&(this._hoverConnection=Y._platform.getPointer().move.connect(function(b){for(var c=b.hit;null!=c;){if(c==a)return;
c=c.getParentSprite()}null!=a._pointerOut&&0!=(a._flags&64)&&a._pointerOut.emit(b);a._flags&=-65;null!=a._hoverConnection&&(a._hoverConnection.dispose(),a._hoverConnection=null)}))},set_visible:function(a){this._flags=Zh.set(this._flags,2,a);return a},set_pointerEnabled:function(a){this._flags=Zh.set(this._flags,4,a);return a},onPointerDown:function(a){this.onHover(a);null!=this._pointerDown&&this._pointerDown.emit(a)},onPointerMove:function(a){this.onHover(a);null!=this._pointerMove&&this._pointerMove.emit(a)},
onHover:function(a){if(0==(this._flags&64)&&(this._flags|=64,null!=this._pointerIn||null!=this._pointerOut))null!=this._pointerIn&&this._pointerIn.emit(a),this.connectHover()},onPointerUp:function(a){switch(a.source[1]){case 1:null!=this._pointerOut&&0!=(this._flags&64)&&this._pointerOut.emit(a),this._flags&=-65,null!=this._hoverConnection&&(this._hoverConnection.dispose(),this._hoverConnection=null)}null!=this._pointerUp&&this._pointerUp.emit(a)},__class__:M,__properties__:v(ha.prototype.__properties__,
{get_pointerOut:"get_pointerOut",get_pointerIn:"get_pointerIn",get_pointerUp:"get_pointerUp",get_pointerMove:"get_pointerMove",get_pointerDown:"get_pointerDown",set_pointerEnabled:"set_pointerEnabled",set_visible:"set_visible"})});var Bd=function(a,b,c){M.call(this);this.color=a;this.width=new Ka(b);this.height=new Ka(c)};h["flambe.display.FillSprite"]=Bd;Bd.__name__=!0;Bd.__super__=M;Bd.prototype=v(M.prototype,{draw:function(a){a.fillRect(this.color,0,0,this.width._value,this.height._value)},getNaturalWidth:function(){return this.width._value},
getNaturalHeight:function(){return this.height._value},setSize:function(a,b){this.width.set__(a);this.height.set__(b);return this},onUpdate:function(a){M.prototype.onUpdate.call(this,a);this.width.update(a);this.height.update(a)},__class__:Bd});var $h=function(){};h["flambe.display.Graphics"]=$h;$h.__name__=!0;$h.prototype={__class__:$h};var Kd=function(a){M.call(this);this.texture=a};h["flambe.display.ImageSprite"]=Kd;Kd.__name__=!0;Kd.__super__=M;Kd.prototype=v(M.prototype,{draw:function(a){null!=
this.texture&&a.drawTexture(this.texture,0,0)},getNaturalWidth:function(){return null!=this.texture?this.texture.get_width():0},getNaturalHeight:function(){return null!=this.texture?this.texture.get_height():0},__class__:Kd});var Qc=h["flambe.display.Orientation"]={__ename__:!0,__constructs__:["Portrait","Landscape"]};Qc.Portrait=["Portrait",0];Qc.Portrait.toString=j;Qc.Portrait.__enum__=Qc;Qc.Landscape=["Landscape",1];Qc.Landscape.toString=j;Qc.Landscape.__enum__=Qc;Qc.__empty_constructs__=[Qc.Portrait,
Qc.Landscape];var Of=function(){};h["flambe.display.Texture"]=Of;Of.__name__=!0;Of.__interfaces__=[Ad];Of.prototype={__class__:Of,__properties__:{get_height:"get_height",get_width:"get_width"}};var Rj=function(){};h["flambe.display.SubTexture"]=Rj;Rj.__name__=!0;Rj.__interfaces__=[Of];var g=h["flambe.input.Key"]={__ename__:!0,__constructs__:"A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,Number0,Number1,Number2,Number3,Number4,Number5,Number6,Number7,Number8,Number9,Numpad0,Numpad1,Numpad2,Numpad3,Numpad4,Numpad5,Numpad6,Numpad7,Numpad8,Numpad9,NumpadAdd,NumpadDecimal,NumpadDivide,NumpadEnter,NumpadMultiply,NumpadSubtract,F1,F2,F3,F4,F5,F6,F7,F8,F9,F10,F11,F12,F13,F14,F15,Left,Up,Right,Down,Alt,Backquote,Backslash,Backspace,CapsLock,Comma,Command,Control,Delete,End,Enter,Equals,Escape,Home,Insert,LeftBracket,Minus,PageDown,PageUp,Period,Quote,RightBracket,Semicolon,Shift,Slash,Space,Tab,Menu,Search,Unknown".split(",")};
g.A=["A",0];g.A.toString=j;g.A.__enum__=g;g.B=["B",1];g.B.toString=j;g.B.__enum__=g;g.C=["C",2];g.C.toString=j;g.C.__enum__=g;g.D=["D",3];g.D.toString=j;g.D.__enum__=g;g.E=["E",4];g.E.toString=j;g.E.__enum__=g;g.F=["F",5];g.F.toString=j;g.F.__enum__=g;g.G=["G",6];g.G.toString=j;g.G.__enum__=g;g.H=["H",7];g.H.toString=j;g.H.__enum__=g;g.I=["I",8];g.I.toString=j;g.I.__enum__=g;g.J=["J",9];g.J.toString=j;g.J.__enum__=g;g.K=["K",10];g.K.toString=j;g.K.__enum__=g;g.L=["L",11];g.L.toString=j;g.L.__enum__=
g;g.M=["M",12];g.M.toString=j;g.M.__enum__=g;g.N=["N",13];g.N.toString=j;g.N.__enum__=g;g.O=["O",14];g.O.toString=j;g.O.__enum__=g;g.P=["P",15];g.P.toString=j;g.P.__enum__=g;g.Q=["Q",16];g.Q.toString=j;g.Q.__enum__=g;g.R=["R",17];g.R.toString=j;g.R.__enum__=g;g.S=["S",18];g.S.toString=j;g.S.__enum__=g;g.T=["T",19];g.T.toString=j;g.T.__enum__=g;g.U=["U",20];g.U.toString=j;g.U.__enum__=g;g.V=["V",21];g.V.toString=j;g.V.__enum__=g;g.W=["W",22];g.W.toString=j;g.W.__enum__=g;g.X=["X",23];g.X.toString=
j;g.X.__enum__=g;g.Y=["Y",24];g.Y.toString=j;g.Y.__enum__=g;g.Z=["Z",25];g.Z.toString=j;g.Z.__enum__=g;g.Number0=["Number0",26];g.Number0.toString=j;g.Number0.__enum__=g;g.Number1=["Number1",27];g.Number1.toString=j;g.Number1.__enum__=g;g.Number2=["Number2",28];g.Number2.toString=j;g.Number2.__enum__=g;g.Number3=["Number3",29];g.Number3.toString=j;g.Number3.__enum__=g;g.Number4=["Number4",30];g.Number4.toString=j;g.Number4.__enum__=g;g.Number5=["Number5",31];g.Number5.toString=j;g.Number5.__enum__=
g;g.Number6=["Number6",32];g.Number6.toString=j;g.Number6.__enum__=g;g.Number7=["Number7",33];g.Number7.toString=j;g.Number7.__enum__=g;g.Number8=["Number8",34];g.Number8.toString=j;g.Number8.__enum__=g;g.Number9=["Number9",35];g.Number9.toString=j;g.Number9.__enum__=g;g.Numpad0=["Numpad0",36];g.Numpad0.toString=j;g.Numpad0.__enum__=g;g.Numpad1=["Numpad1",37];g.Numpad1.toString=j;g.Numpad1.__enum__=g;g.Numpad2=["Numpad2",38];g.Numpad2.toString=j;g.Numpad2.__enum__=g;g.Numpad3=["Numpad3",39];g.Numpad3.toString=
j;g.Numpad3.__enum__=g;g.Numpad4=["Numpad4",40];g.Numpad4.toString=j;g.Numpad4.__enum__=g;g.Numpad5=["Numpad5",41];g.Numpad5.toString=j;g.Numpad5.__enum__=g;g.Numpad6=["Numpad6",42];g.Numpad6.toString=j;g.Numpad6.__enum__=g;g.Numpad7=["Numpad7",43];g.Numpad7.toString=j;g.Numpad7.__enum__=g;g.Numpad8=["Numpad8",44];g.Numpad8.toString=j;g.Numpad8.__enum__=g;g.Numpad9=["Numpad9",45];g.Numpad9.toString=j;g.Numpad9.__enum__=g;g.NumpadAdd=["NumpadAdd",46];g.NumpadAdd.toString=j;g.NumpadAdd.__enum__=g;g.NumpadDecimal=
["NumpadDecimal",47];g.NumpadDecimal.toString=j;g.NumpadDecimal.__enum__=g;g.NumpadDivide=["NumpadDivide",48];g.NumpadDivide.toString=j;g.NumpadDivide.__enum__=g;g.NumpadEnter=["NumpadEnter",49];g.NumpadEnter.toString=j;g.NumpadEnter.__enum__=g;g.NumpadMultiply=["NumpadMultiply",50];g.NumpadMultiply.toString=j;g.NumpadMultiply.__enum__=g;g.NumpadSubtract=["NumpadSubtract",51];g.NumpadSubtract.toString=j;g.NumpadSubtract.__enum__=g;g.F1=["F1",52];g.F1.toString=j;g.F1.__enum__=g;g.F2=["F2",53];g.F2.toString=
j;g.F2.__enum__=g;g.F3=["F3",54];g.F3.toString=j;g.F3.__enum__=g;g.F4=["F4",55];g.F4.toString=j;g.F4.__enum__=g;g.F5=["F5",56];g.F5.toString=j;g.F5.__enum__=g;g.F6=["F6",57];g.F6.toString=j;g.F6.__enum__=g;g.F7=["F7",58];g.F7.toString=j;g.F7.__enum__=g;g.F8=["F8",59];g.F8.toString=j;g.F8.__enum__=g;g.F9=["F9",60];g.F9.toString=j;g.F9.__enum__=g;g.F10=["F10",61];g.F10.toString=j;g.F10.__enum__=g;g.F11=["F11",62];g.F11.toString=j;g.F11.__enum__=g;g.F12=["F12",63];g.F12.toString=j;g.F12.__enum__=g;g.F13=
["F13",64];g.F13.toString=j;g.F13.__enum__=g;g.F14=["F14",65];g.F14.toString=j;g.F14.__enum__=g;g.F15=["F15",66];g.F15.toString=j;g.F15.__enum__=g;g.Left=["Left",67];g.Left.toString=j;g.Left.__enum__=g;g.Up=["Up",68];g.Up.toString=j;g.Up.__enum__=g;g.Right=["Right",69];g.Right.toString=j;g.Right.__enum__=g;g.Down=["Down",70];g.Down.toString=j;g.Down.__enum__=g;g.Alt=["Alt",71];g.Alt.toString=j;g.Alt.__enum__=g;g.Backquote=["Backquote",72];g.Backquote.toString=j;g.Backquote.__enum__=g;g.Backslash=
["Backslash",73];g.Backslash.toString=j;g.Backslash.__enum__=g;g.Backspace=["Backspace",74];g.Backspace.toString=j;g.Backspace.__enum__=g;g.CapsLock=["CapsLock",75];g.CapsLock.toString=j;g.CapsLock.__enum__=g;g.Comma=["Comma",76];g.Comma.toString=j;g.Comma.__enum__=g;g.Command=["Command",77];g.Command.toString=j;g.Command.__enum__=g;g.Control=["Control",78];g.Control.toString=j;g.Control.__enum__=g;g.Delete=["Delete",79];g.Delete.toString=j;g.Delete.__enum__=g;g.End=["End",80];g.End.toString=j;g.End.__enum__=
g;g.Enter=["Enter",81];g.Enter.toString=j;g.Enter.__enum__=g;g.Equals=["Equals",82];g.Equals.toString=j;g.Equals.__enum__=g;g.Escape=["Escape",83];g.Escape.toString=j;g.Escape.__enum__=g;g.Home=["Home",84];g.Home.toString=j;g.Home.__enum__=g;g.Insert=["Insert",85];g.Insert.toString=j;g.Insert.__enum__=g;g.LeftBracket=["LeftBracket",86];g.LeftBracket.toString=j;g.LeftBracket.__enum__=g;g.Minus=["Minus",87];g.Minus.toString=j;g.Minus.__enum__=g;g.PageDown=["PageDown",88];g.PageDown.toString=j;g.PageDown.__enum__=
g;g.PageUp=["PageUp",89];g.PageUp.toString=j;g.PageUp.__enum__=g;g.Period=["Period",90];g.Period.toString=j;g.Period.__enum__=g;g.Quote=["Quote",91];g.Quote.toString=j;g.Quote.__enum__=g;g.RightBracket=["RightBracket",92];g.RightBracket.toString=j;g.RightBracket.__enum__=g;g.Semicolon=["Semicolon",93];g.Semicolon.toString=j;g.Semicolon.__enum__=g;g.Shift=["Shift",94];g.Shift.toString=j;g.Shift.__enum__=g;g.Slash=["Slash",95];g.Slash.toString=j;g.Slash.__enum__=g;g.Space=["Space",96];g.Space.toString=
j;g.Space.__enum__=g;g.Tab=["Tab",97];g.Tab.toString=j;g.Tab.__enum__=g;g.Menu=["Menu",98];g.Menu.toString=j;g.Menu.__enum__=g;g.Search=["Search",99];g.Search.toString=j;g.Search.__enum__=g;g.Unknown=function(a){a=["Unknown",100,a];a.__enum__=g;a.toString=j;return a};g.__empty_constructs__=[g.A,g.B,g.C,g.D,g.E,g.F,g.G,g.H,g.I,g.J,g.K,g.L,g.M,g.N,g.O,g.P,g.Q,g.R,g.S,g.T,g.U,g.V,g.W,g.X,g.Y,g.Z,g.Number0,g.Number1,g.Number2,g.Number3,g.Number4,g.Number5,g.Number6,g.Number7,g.Number8,g.Number9,g.Numpad0,
g.Numpad1,g.Numpad2,g.Numpad3,g.Numpad4,g.Numpad5,g.Numpad6,g.Numpad7,g.Numpad8,g.Numpad9,g.NumpadAdd,g.NumpadDecimal,g.NumpadDivide,g.NumpadEnter,g.NumpadMultiply,g.NumpadSubtract,g.F1,g.F2,g.F3,g.F4,g.F5,g.F6,g.F7,g.F8,g.F9,g.F10,g.F11,g.F12,g.F13,g.F14,g.F15,g.Left,g.Up,g.Right,g.Down,g.Alt,g.Backquote,g.Backslash,g.Backspace,g.CapsLock,g.Comma,g.Command,g.Control,g.Delete,g.End,g.Enter,g.Equals,g.Escape,g.Home,g.Insert,g.LeftBracket,g.Minus,g.PageDown,g.PageUp,g.Period,g.Quote,g.RightBracket,
g.Semicolon,g.Shift,g.Slash,g.Space,g.Tab,g.Menu,g.Search];var ai=function(){this.init(0,null)};h["flambe.input.KeyboardEvent"]=ai;ai.__name__=!0;ai.prototype={init:function(a,b){this.id=a;this.key=b},__class__:ai};var sa=h["flambe.input.MouseButton"]={__ename__:!0,__constructs__:["Left","Middle","Right","Unknown"]};sa.Left=["Left",0];sa.Left.toString=j;sa.Left.__enum__=sa;sa.Middle=["Middle",1];sa.Middle.toString=j;sa.Middle.__enum__=sa;sa.Right=["Right",2];sa.Right.toString=j;sa.Right.__enum__=
sa;sa.Unknown=function(a){a=["Unknown",3,a];a.__enum__=sa;a.toString=j;return a};sa.__empty_constructs__=[sa.Left,sa.Middle,sa.Right];var fb=h["flambe.input.MouseCursor"]={__ename__:!0,__constructs__:["Default","Button","None"]};fb.Default=["Default",0];fb.Default.toString=j;fb.Default.__enum__=fb;fb.Button=["Button",1];fb.Button.toString=j;fb.Button.__enum__=fb;fb.None=["None",2];fb.None.toString=j;fb.None.__enum__=fb;fb.__empty_constructs__=[fb.Default,fb.Button,fb.None];var bi=function(){this.init(0,
0,0,null)};h["flambe.input.MouseEvent"]=bi;bi.__name__=!0;bi.prototype={init:function(a,b,c,d){this.id=a;this.viewX=b;this.viewY=c;this.button=d},__class__:bi};var Me=h["flambe.input.EventSource"]={__ename__:!0,__constructs__:["Mouse","Touch"]};Me.Mouse=function(a){a=["Mouse",0,a];a.__enum__=Me;a.toString=j;return a};Me.Touch=function(a){a=["Touch",1,a];a.__enum__=Me;a.toString=j;return a};Me.__empty_constructs__=[];var ci=function(){this.init(0,0,0,null,null)};h["flambe.input.PointerEvent"]=ci;ci.__name__=
!0;ci.prototype={init:function(a,b,c,d,e){this.id=a;this.viewX=b;this.viewY=c;this.hit=d;this.source=e;this._stopped=!1},__class__:ci};var di=function(a){this.id=a;this._source=Me.Touch(this)};h["flambe.input.TouchPoint"]=di;di.__name__=!0;di.prototype={init:function(a,b){this.viewX=a;this.viewY=b},__class__:di};var gd=function(){};h["flambe.math.FMath"]=gd;gd.__name__=!0;gd.toRadians=function(a){return 3.141592653589793*a/180};gd.max=function(a,b){return a>b?a:b};gd.min=function(a,b){return a<b?
a:b};var Wa=function(){this.identity()};h["flambe.math.Matrix"]=Wa;Wa.__name__=!0;Wa.multiply=function(a,b,c){null==c&&(c=new Wa);var d=a.m00*b.m00+a.m01*b.m10,e=a.m00*b.m01+a.m01*b.m11,i=a.m00*b.m02+a.m01*b.m12+a.m02;c.m00=d;c.m01=e;c.m02=i;d=a.m10*b.m00+a.m11*b.m10;e=a.m10*b.m01+a.m11*b.m11;i=a.m10*b.m02+a.m11*b.m12+a.m12;c.m10=d;c.m11=e;c.m12=i;return c};Wa.prototype={set:function(a,b,c,d,e,i){this.m00=a;this.m01=c;this.m02=e;this.m10=b;this.m11=d;this.m12=i},identity:function(){this.set(1,0,0,
1,0,0)},compose:function(a,b,c,d,e){var i=Math.sin(e),e=Math.cos(e);this.set(e*c,i*c,-i*d,e*d,a,b)},translate:function(a,b){this.m02+=this.m00*a+this.m01*b;this.m12+=this.m11*b+this.m10*a},invert:function(){var a=this.determinant();if(0==a)return!1;this.set(this.m11/a,-this.m01/a,-this.m10/a,this.m00/a,(this.m01*this.m12-this.m11*this.m02)/a,(this.m10*this.m02-this.m00*this.m12)/a);return!0},transform:function(a,b,c){null==c&&(c=new ec);c.x=a*this.m00+b*this.m01+this.m02;c.y=a*this.m10+b*this.m11+
this.m12;return c},transformArray:function(a,b,c){for(var d=0;d<b;){var e=a[d],i=a[d+1];c[d++]=e*this.m00+i*this.m01+this.m02;c[d++]=e*this.m10+i*this.m11+this.m12}},determinant:function(){return this.m00*this.m11-this.m01*this.m10},inverseTransform:function(a,b,c){var d=this.determinant();if(0==d)return!1;a-=this.m02;b-=this.m12;c.x=(a*this.m11-b*this.m01)/d;c.y=(b*this.m00-a*this.m10)/d;return!0},clone:function(a){null==a&&(a=new Wa);a.set(this.m00,this.m10,this.m01,this.m11,this.m02,this.m12);
return a},__class__:Wa};var tc=function(a,b,c,d){null==d&&(d=0);null==c&&(c=0);null==b&&(b=0);null==a&&(a=0);this.set(a,b,c,d)};h["flambe.math.Rectangle"]=tc;tc.__name__=!0;tc.prototype={set:function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d},contains:function(a,b){a-=this.x;if(0<=this.width){if(0>a||a>this.width)return!1}else if(0<a||a<this.width)return!1;b-=this.y;if(0<=this.height){if(0>b||b>this.height)return!1}else if(0<b||b<this.height)return!1;return!0},clone:function(a){null==
a&&(a=new tc);a.set(this.x,this.y,this.width,this.height);return a},equals:function(a){return this.x==a.x&&this.y==a.y&&this.width==a.width&&this.height==a.height},__class__:tc};var Oa=function(){this._disposed=!1};h["flambe.platform.BasicAsset"]=Oa;Oa.__name__=!0;Oa.__interfaces__=[Ad];Oa.prototype={dispose:function(){this._disposed||(this._disposed=!0,this.onDisposed())},onDisposed:function(){null},__class__:Oa};var $d=function(a,b){var c=this;this.manifest=b;this._platform=a;this.promise=new Pf;
this._bytesLoaded=new D;this._pack=new Qf(b,this);var d=Ef.array(b);if(0==d.length)this.handleSuccess();else{for(var e=new D,i=0;i<d.length;){var m=d[i];++i;var f=e.get(m.name);null==f&&(f=[],e.set(m.name,f));f.push(m)}this._assetsRemaining=Ef.count(e);for(d=new Rf(e,e.arrayKeys());d.hasNext();)e=[d.next()],this.pickBestEntry(e[0],function(a){return function(d){if(null!=d){var e=b.getFullURL(d);try{c.loadEntry(e,d)}catch(i){i instanceof p&&(i=i.val),c.handleError(d,"Unexpected error: "+q.string(i))}e=
c.promise;e.set_total(e._total+d.bytes)}else d=a[0][0],$d.isAudio(d.format)?(Aa.logger.warn("Could not find a supported audio format to load",["name",d.name]),c.handleLoad(d,La.getInstance())):c.handleError(d,"Could not find a supported format to load")}}(e))}};h["flambe.platform.BasicAssetPackLoader"]=$d;$d.__name__=!0;$d.isAudio=function(a){switch(a[1]){case 8:case 9:case 10:case 11:case 12:return!0;default:return!1}};$d.prototype={onDisposed:function(){},pickBestEntry:function(a,b){this.getAssetFormats(function(c){for(var d=
0;d<c.length;){var e=c[d];++d;for(var i=0;i<a.length;){var m=a[i];++i;if(m.format==e){b(m);return}}}b(null)})},loadEntry:function(){null},getAssetFormats:function(){null},handleLoad:function(a,b){if(!this._pack.disposed){this.handleProgress(a,a.bytes);var c;switch(a.format[1]){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c=this._pack.textures;break;case 8:case 9:case 10:case 11:case 12:c=this._pack.sounds;break;case 13:c=this._pack.files}c.set(a.name,b);this._assetsRemaining-=1;0==this._assetsRemaining&&
this.handleSuccess()}},handleProgress:function(a,b){this._bytesLoaded.set(a.name,b);for(var c=0,d=this._bytesLoaded.iterator();d.hasNext();)var e=d.next(),c=c+e;this.promise.set_progress(c)},handleSuccess:function(){this.promise.set_result(this._pack)},handleError:function(a,b){Aa.logger.warn("Error loading asset pack",["error",b,"url",a.url]);this.promise.error.emit(sc.withFields(b,["url",a.url]))},handleTextureError:function(a){this.handleError(a,"Failed to create texture. Is the GPU context unavailable?")},
__class__:$d};var Qf=function(a,b){this.disposed=!1;this._manifest=a;this.loader=b;this.textures=new D;this.sounds=new D;this.files=new D};h["flambe.platform._BasicAssetPackLoader.BasicAssetPack"]=Qf;Qf.__name__=!0;Qf.__interfaces__=[Mf];Qf.prototype={getTexture:function(a,b){null==b&&(b=!0);var c=this.textures.get(a);if(null==c&&b)throw new p(sc.withFields("Missing texture",["name",a]));return c},getSound:function(a,b){null==b&&(b=!0);var c=this.sounds.get(a);if(null==c&&b)throw new p(sc.withFields("Missing sound",
["name",a]));return c},getFile:function(a,b){null==b&&(b=!0);var c=this.files.get(a);if(null==c&&b)throw new p(sc.withFields("Missing file",["name",a]));return c},dispose:function(){if(!this.disposed){this.disposed=!0;for(var a=this.textures.iterator();a.hasNext();)a.next().dispose();this.textures=null;for(a=this.sounds.iterator();a.hasNext();)a.next().dispose();this.sounds=null;for(a=this.files.iterator();a.hasNext();)a.next().dispose();this.files=null;this.loader.onDisposed()}},__class__:Qf};var Ne=
function(a){this._disposed=!1;this._content=a};h["flambe.platform.BasicFile"]=Ne;Ne.__name__=!0;Ne.__interfaces__=[Nf];Ne.__super__=Oa;Ne.prototype=v(Oa.prototype,{toString:function(){return this._content},onDisposed:function(){this._content=null},__class__:Ne});var ei=function(){};h["flambe.subsystem.KeyboardSystem"]=ei;ei.__name__=!0;ei.prototype={__class__:ei};var Pc=function(){this.down=new fa;this.up=new fa;this.backButton=new Cd;this._keyStates=new hd};h["flambe.platform.BasicKeyboard"]=Pc;
Pc.__name__=!0;Pc.__interfaces__=[ei];Pc.prototype={isDown:function(a){return this.isCodeDown(Oe.toKeyCode(a))},isCodeDown:function(a){return this._keyStates.h.hasOwnProperty(a)},submitDown:function(a){if(16777238==a)return null!=this.backButton._head?(this.backButton.emit(),!0):!1;this._keyStates.h.hasOwnProperty(a)||(this._keyStates.h[a]=!0,Pc._sharedEvent.init(Pc._sharedEvent.id+1,Oe.toKey(a)),this.down.emit(Pc._sharedEvent));return!0},submitUp:function(a){this._keyStates.h.hasOwnProperty(a)&&
(this._keyStates.remove(a),Pc._sharedEvent.init(Pc._sharedEvent.id+1,Oe.toKey(a)),this.up.emit(Pc._sharedEvent))},__class__:Pc};var fi=function(){};h["flambe.subsystem.MouseSystem"]=fi;fi.__name__=!0;fi.prototype={__class__:fi};var Cb=function(a){this._pointer=a;this._source=Me.Mouse(Cb._sharedEvent);this.down=new fa;this.move=new fa;this.up=new fa;this.scroll=new fa;this._y=this._x=0;this._cursor=fb.Default;this._buttonStates=new hd};h["flambe.platform.BasicMouse"]=Cb;Cb.__name__=!0;Cb.__interfaces__=
[fi];Cb.prototype={isDown:function(a){return this.isCodeDown(Pe.toButtonCode(a))},submitDown:function(a,b,c){this._buttonStates.h.hasOwnProperty(c)||(this._buttonStates.h[c]=!0,this.prepare(a,b,Pe.toButton(c)),this._pointer.submitDown(a,b,this._source),this.down.emit(Cb._sharedEvent))},submitMove:function(a,b){this.prepare(a,b,null);this._pointer.submitMove(a,b,this._source);this.move.emit(Cb._sharedEvent)},submitUp:function(a,b,c){this._buttonStates.h.hasOwnProperty(c)&&(this._buttonStates.remove(c),
this.prepare(a,b,Pe.toButton(c)),this._pointer.submitUp(a,b,this._source),this.up.emit(Cb._sharedEvent))},submitScroll:function(a,b,c){this._x=a;this._y=b;if(null==this.scroll._head)return!1;this.scroll.emit(c);return!0},isCodeDown:function(a){return this._buttonStates.h.hasOwnProperty(a)},prepare:function(a,b,c){this._x=a;this._y=b;Cb._sharedEvent.init(Cb._sharedEvent.id+1,a,b,c)},__class__:Cb};var gi=function(){};h["flambe.subsystem.PointerSystem"]=gi;gi.__name__=!0;gi.prototype={__class__:gi,__properties__:{get_y:"get_y",
get_x:"get_x"}};var rb=function(a,b,c){null==c&&(c=!1);null==b&&(b=0);null==a&&(a=0);this.down=new fa;this.move=new fa;this.up=new fa;this._x=a;this._y=b;this._isDown=c};h["flambe.platform.BasicPointer"]=rb;rb.__name__=!0;rb.__interfaces__=[gi];rb.prototype={get_x:function(){return this._x},get_y:function(){return this._y},isDown:function(){return this._isDown},submitDown:function(a,b,c){if(!this._isDown){this.submitMove(a,b,c);this._isDown=!0;var d=[],e=M.hitTest(Y.root,a,b);if(null!=e){var i=e.owner;
do{var m=i._compMap.Sprite_3;null!=m&&d.push(m);i=i.parent}while(null!=i)}this.prepare(a,b,e,c);for(a=0;a<d.length;)if(b=d[a],++a,b.onPointerDown(rb._sharedEvent),rb._sharedEvent._stopped)return;this.down.emit(rb._sharedEvent)}},submitMove:function(a,b,c){if(!(a==this._x&&b==this._y)){var d=[],e=M.hitTest(Y.root,a,b);if(null!=e){var i=e.owner;do{var m=i._compMap.Sprite_3;null!=m&&d.push(m);i=i.parent}while(null!=i)}this.prepare(a,b,e,c);for(a=0;a<d.length;)if(b=d[a],++a,b.onPointerMove(rb._sharedEvent),
rb._sharedEvent._stopped)return;this.move.emit(rb._sharedEvent)}},submitUp:function(a,b,c){if(this._isDown){this.submitMove(a,b,c);this._isDown=!1;var d=[],e=M.hitTest(Y.root,a,b);if(null!=e){var i=e.owner;do{var m=i._compMap.Sprite_3;null!=m&&d.push(m);i=i.parent}while(null!=i)}this.prepare(a,b,e,c);for(a=0;a<d.length;)if(b=d[a],++a,b.onPointerUp(rb._sharedEvent),rb._sharedEvent._stopped)return;this.up.emit(rb._sharedEvent)}},prepare:function(a,b,c,d){this._x=a;this._y=b;rb._sharedEvent.init(rb._sharedEvent.id+
1,a,b,c,d)},__class__:rb,__properties__:{get_y:"get_y",get_x:"get_x"}};var Rc=function(a,b,c){this._parent=null;this.rootX=this.rootY=0;this._disposed=!1;this.root=a;this._width=b;this._height=c};h["flambe.platform.BasicTexture"]=Rc;Rc.__name__=!0;Rc.__interfaces__=[Rj];Rc.__super__=Oa;Rc.prototype=v(Oa.prototype,{onDisposed:function(){null==this._parent&&this.root.dispose()},get_width:function(){return this._width},get_height:function(){return this._height},__class__:Rc,__properties__:{get_height:"get_height",
get_width:"get_width"}});var Sj=function(){};h["flambe.subsystem.TouchSystem"]=Sj;Sj.__name__=!0;var Hf=function(a,b){null==b&&(b=4);this._pointer=a;this._maxPoints=b;this._pointMap=new hd;this._points=[];this.down=new fa;this.move=new fa;this.up=new fa};h["flambe.platform.BasicTouch"]=Hf;Hf.__name__=!0;Hf.__interfaces__=[Sj];Hf.prototype={submitDown:function(a,b,c){if(!this._pointMap.h.hasOwnProperty(a)){var d=new di(a);d.init(b,c);this._pointMap.h[a]=d;this._points.push(d);null==this._pointerTouch&&
(this._pointerTouch=d,this._pointer.submitDown(b,c,d._source));this.down.emit(d)}},submitMove:function(a,b,c){a=this._pointMap.h[a];null!=a&&(a.init(b,c),this._pointerTouch==a&&this._pointer.submitMove(b,c,a._source),this.move.emit(a))},submitUp:function(a,b,c){var d=this._pointMap.h[a];null!=d&&(d.init(b,c),this._pointMap.remove(a),E.remove(this._points,d),this._pointerTouch==d&&(this._pointerTouch=null,this._pointer.submitUp(b,c,d._source)),this.up.emit(d))},__class__:Hf};var ae=function(){};h["flambe.sound.Sound"]=
ae;ae.__name__=!0;ae.__interfaces__=[Ad];ae.prototype={__class__:ae};var La=function(){this._disposed=!1;this._playback=new Sf(this)};h["flambe.platform.DummySound"]=La;La.__name__=!0;La.__interfaces__=[ae];La.getInstance=function(){null==La._instance&&(La._instance=new La);return La._instance};La.__super__=Oa;La.prototype=v(Oa.prototype,{play:function(){return this._playback},loop:function(){return this._playback},onDisposed:function(){},__class__:La});var be=function(){};h["flambe.sound.Playback"]=
be;be.__name__=!0;be.__interfaces__=[yd];be.prototype={__class__:be};var Sf=function(a){this._sound=a;this.volume=new Ka(0);this._complete=new xa(!0)};h["flambe.platform.DummyPlayback"]=Sf;Sf.__name__=!0;Sf.__interfaces__=[be];Sf.prototype={dispose:function(){},__class__:Sf};var If=function(){this.down=new fa;this.move=new fa;this.up=new fa};h["flambe.platform.DummyTouch"]=If;If.__name__=!0;If.__interfaces__=[Sj];If.prototype={__class__:If};var Qe=function(){this._entries=[]};h["flambe.platform.EventGroup"]=
Qe;Qe.__name__=!0;Qe.__interfaces__=[yd];Qe.prototype={addListener:function(a,b,c){a.addEventListener(b,c,!1);this._entries.push(new hi(a,b,c))},addDisposingListener:function(a,b,c){var d=this;this.addListener(a,b,function(a){d.dispose();c(a)})},dispose:function(){for(var a=0,b=this._entries;a<b.length;){var c=b[a];++a;c.dispatcher.removeEventListener(c.type,c.listener,!1)}this._entries=[]},__class__:Qe};var hi=function(a,b,c){this.dispatcher=a;this.type=b;this.listener=c};h["flambe.platform._EventGroup.Entry"]=
hi;hi.__name__=!0;hi.prototype={__class__:hi};var Re=function(){};h["flambe.platform.InternalGraphics"]=Re;Re.__name__=!0;Re.__interfaces__=[$h];Re.prototype={__class__:Re};var ii=function(){};h["flambe.subsystem.RendererSystem"]=ii;ii.__name__=!0;ii.prototype={__class__:ii,__properties__:{get_type:"get_type"}};var Se=function(){};h["flambe.platform.InternalRenderer"]=Se;Se.__name__=!0;Se.__interfaces__=[ii];Se.prototype={__class__:Se};var Oe=function(){};h["flambe.platform.KeyCodes"]=Oe;Oe.__name__=
!0;Oe.toKey=function(a){switch(a){case 65:return g.A;case 66:return g.B;case 67:return g.C;case 68:return g.D;case 69:return g.E;case 70:return g.F;case 71:return g.G;case 72:return g.H;case 73:return g.I;case 74:return g.J;case 75:return g.K;case 76:return g.L;case 77:return g.M;case 78:return g.N;case 79:return g.O;case 80:return g.P;case 81:return g.Q;case 82:return g.R;case 83:return g.S;case 84:return g.T;case 85:return g.U;case 86:return g.V;case 87:return g.W;case 88:return g.X;case 89:return g.Y;
case 90:return g.Z;case 48:return g.Number0;case 49:return g.Number1;case 50:return g.Number2;case 51:return g.Number3;case 52:return g.Number4;case 53:return g.Number5;case 54:return g.Number6;case 55:return g.Number7;case 56:return g.Number8;case 57:return g.Number9;case 96:return g.Numpad0;case 97:return g.Numpad1;case 98:return g.Numpad2;case 99:return g.Numpad3;case 100:return g.Numpad4;case 101:return g.Numpad5;case 102:return g.Numpad6;case 103:return g.Numpad7;case 104:return g.Numpad8;case 105:return g.Numpad9;
case 107:return g.NumpadAdd;case 110:return g.NumpadDecimal;case 111:return g.NumpadDivide;case 108:return g.NumpadEnter;case 106:return g.NumpadMultiply;case 109:return g.NumpadSubtract;case 112:return g.F1;case 113:return g.F2;case 114:return g.F3;case 115:return g.F4;case 116:return g.F5;case 117:return g.F6;case 118:return g.F7;case 119:return g.F8;case 120:return g.F9;case 121:return g.F10;case 122:return g.F11;case 123:return g.F12;case 37:return g.Left;case 38:return g.Up;case 39:return g.Right;
case 40:return g.Down;case 18:return g.Alt;case 192:return g.Backquote;case 220:return g.Backslash;case 8:return g.Backspace;case 20:return g.CapsLock;case 188:return g.Comma;case 15:return g.Command;case 17:return g.Control;case 46:return g.Delete;case 35:return g.End;case 13:return g.Enter;case 187:return g.Equals;case 27:return g.Escape;case 36:return g.Home;case 45:return g.Insert;case 219:return g.LeftBracket;case 189:return g.Minus;case 34:return g.PageDown;case 33:return g.PageUp;case 190:return g.Period;
case 222:return g.Quote;case 221:return g.RightBracket;case 186:return g.Semicolon;case 16:return g.Shift;case 191:return g.Slash;case 32:return g.Space;case 9:return g.Tab;case 16777234:return g.Menu;case 16777247:return g.Search}return g.Unknown(a)};Oe.toKeyCode=function(a){switch(a[1]){case 0:return 65;case 1:return 66;case 2:return 67;case 3:return 68;case 4:return 69;case 5:return 70;case 6:return 71;case 7:return 72;case 8:return 73;case 9:return 74;case 10:return 75;case 11:return 76;case 12:return 77;
case 13:return 78;case 14:return 79;case 15:return 80;case 16:return 81;case 17:return 82;case 18:return 83;case 19:return 84;case 20:return 85;case 21:return 86;case 22:return 87;case 23:return 88;case 24:return 89;case 25:return 90;case 26:return 48;case 27:return 49;case 28:return 50;case 29:return 51;case 30:return 52;case 31:return 53;case 32:return 54;case 33:return 55;case 34:return 56;case 35:return 57;case 36:return 96;case 37:return 97;case 38:return 98;case 39:return 99;case 40:return 100;
case 41:return 101;case 42:return 102;case 43:return 103;case 44:return 104;case 45:return 105;case 46:return 107;case 47:return 110;case 48:return 111;case 49:return 108;case 50:return 106;case 51:return 109;case 52:return 112;case 53:return 113;case 54:return 114;case 55:return 115;case 56:return 116;case 57:return 117;case 58:return 118;case 59:return 119;case 60:return 120;case 61:return 121;case 62:return 122;case 63:return 123;case 64:return 124;case 65:return 125;case 66:return 126;case 67:return 37;
case 68:return 38;case 69:return 39;case 70:return 40;case 71:return 18;case 72:return 192;case 73:return 220;case 74:return 8;case 75:return 20;case 76:return 188;case 77:return 15;case 78:return 17;case 79:return 46;case 80:return 35;case 81:return 13;case 82:return 187;case 83:return 27;case 84:return 36;case 85:return 45;case 86:return 219;case 87:return 189;case 88:return 34;case 89:return 33;case 90:return 190;case 91:return 222;case 92:return 221;case 93:return 186;case 94:return 16;case 95:return 191;
case 96:return 32;case 97:return 9;case 98:return 16777234;case 99:return 16777247;case 100:return a[2]}};var me=function(){this._tickables=[]};h["flambe.platform.MainLoop"]=me;me.__name__=!0;me.updateEntity=function(a,b){var c=a._compMap.SpeedAdjuster_4;if(null!=c&&(c._realDt=b,b*=c.scale._value,0>=b)){c.onUpdate(b);return}for(c=a.firstComponent;null!=c;){var d=c.next;0==(c._flags&1)&&(c._flags|=1,c.onStart());c.onUpdate(b);c=d}for(c=a.firstChild;null!=c;)d=c.next,me.updateEntity(c,b),c=d};me.prototype=
{update:function(a){if(0>=a)Aa.logger.warn("Zero or negative time elapsed since the last frame!",["dt",a]);else{1<a&&(a=1);for(var b=0;b<this._tickables.length;){var c=this._tickables[b];null==c||c.update(a)?this._tickables.splice(b,1):++b}Y.volume.update(a);me.updateEntity(Y.root,a)}},addTickable:function(a){this._tickables.push(a)},__class__:me};var ji=function(){};h["flambe.platform.MathUtil"]=ji;ji.__name__=!0;ji.nextPowerOfTwo=function(a){for(var b=1;b<a;)b<<=1;return b};var Pe=function(){};
h["flambe.platform.MouseCodes"]=Pe;Pe.__name__=!0;Pe.toButton=function(a){switch(a){case 0:return sa.Left;case 1:return sa.Middle;case 2:return sa.Right}return sa.Unknown(a)};Pe.toButtonCode=function(a){switch(a[1]){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return a[2]}};var Tj=function(){};h["flambe.platform.TextureRoot"]=Tj;Tj.__name__=!0;var Tf=function(){};h["flambe.platform.Tickable"]=Tf;Tf.__name__=!0;Tf.prototype={__class__:Tf};var Uf=function(a,b){this._firstDraw=!1;this._canvasCtx=
a.getContext("2d",{alpha:b})};h["flambe.platform.html.CanvasGraphics"]=Uf;Uf.__name__=!0;Uf.__interfaces__=[Re];Uf.prototype={save:function(){this._canvasCtx.save()},translate:function(a,b){this._canvasCtx.translate(a|0,b|0)},rotate:function(a){this._canvasCtx.rotate(3.141592653589793*a/180)},transform:function(a,b,c,d,e,i){this._canvasCtx.transform(a,b,c,d,e,i)},restore:function(){this._canvasCtx.restore()},drawTexture:function(a,b,c){this.drawSubTexture(a,b,c,0,0,a.get_width(),a.get_height())},
drawSubTexture:function(a,b,c,d,e,i,m){this._firstDraw?(this._firstDraw=!1,this._canvasCtx.globalCompositeOperation="copy",this.drawSubTexture(a,b,c,d,e,i,m),this._canvasCtx.globalCompositeOperation="source-over"):this._canvasCtx.drawImage(a.root.image,a.rootX+d|0,a.rootY+e|0,i|0,m|0,b|0,c|0,i|0,m|0)},fillRect:function(a,b,c,d,e){if(this._firstDraw)this._firstDraw=!1,this._canvasCtx.globalCompositeOperation="copy",this.fillRect(a,b,c,d,e),this._canvasCtx.globalCompositeOperation="source-over";else{for(a=
(16777215&a).toString(16);6>a.length;)a="0"+q.string(a);this._canvasCtx.fillStyle="#"+q.string(a);this._canvasCtx.fillRect(b|0,c|0,d|0,e|0)}},multiplyAlpha:function(a){this._canvasCtx.globalAlpha*=a},setBlendMode:function(a){var b;switch(a[1]){case 0:b="source-over";break;case 1:b="lighter";break;case 2:b="multiply";break;case 3:b="screen";break;case 4:b="destination-in";break;case 5:b="copy"}this._canvasCtx.globalCompositeOperation=b},applyScissor:function(a,b,c,d){this._canvasCtx.beginPath();this._canvasCtx.rect(a|
0,b|0,c|0,d|0);this._canvasCtx.clip()},willRender:function(){this._firstDraw=!0},didRender:function(){},onResize:function(){},__class__:Uf};var Jd=function(a){this.graphics=new Uf(a,!0);this._hasGPU=new xa(!0)};h["flambe.platform.html.CanvasRenderer"]=Jd;Jd.__name__=!0;Jd.__interfaces__=[Se];Jd.prototype={get_type:function(){return kb.Canvas},createTextureFromImage:function(a){a=new Te(Jd.CANVAS_TEXTURES?F.createCanvas(a):a);return a.createTexture(a.width,a.height)},getCompressedTextureFormats:function(){return[]},
createCompressedTexture:function(){return null},willRender:function(){this.graphics.willRender()},didRender:function(){this.graphics.didRender()},__class__:Jd,__properties__:{get_type:"get_type"}};var Vf=function(a,b,c){Rc.call(this,a,b,c)};h["flambe.platform.html.CanvasTexture"]=Vf;Vf.__name__=!0;Vf.__super__=Rc;Vf.prototype=v(Rc.prototype,{__class__:Vf});var Te=function(a){this._graphics=null;this._disposed=!1;this.image=a;this.width=a.width;this.height=a.height};h["flambe.platform.html.CanvasTextureRoot"]=
Te;Te.__name__=!0;Te.__interfaces__=[Tj];Te.__super__=Oa;Te.prototype=v(Oa.prototype,{createTexture:function(a,b){return new Vf(this,a,b)},onDisposed:function(){this._graphics=this.image=null},__class__:Te});var ka=function(a,b){$d.call(this,a,b)};h["flambe.platform.html.HtmlAssetPackLoader"]=ka;ka.__name__=!0;ka.detectImageFormats=function(a){var b=[C.PNG,C.JPG,C.GIF],c=2,d;d=window.document.createElement("img");d.onload=d.onerror=function(){1==d.width&&b.unshift(C.WEBP);--c;0==c&&a(b)};d.src="data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==";
var e;e=window.document.createElement("img");e.onload=e.onerror=function(){1==e.width&&b.unshift(C.JXR);--c;0==c&&a(b)};e.src="data:image/vnd.ms-photo;base64,SUm8AQgAAAAFAAG8AQAQAAAASgAAAIC8BAABAAAAAQAAAIG8BAABAAAAAQAAAMC8BAABAAAAWgAAAMG8BAABAAAAHwAAAAAAAAAkw91vA07+S7GFPXd2jckNV01QSE9UTwAZAYBxAAAAABP/gAAEb/8AAQAAAQAAAA=="};ka.detectAudioFormats=function(){var a;a=window.document.createElement("audio");if(null==a||null==y(a,a.canPlayType))return Aa.logger.warn("Audio is not supported at all in this browser!",
null),[];var b=new cc("\\b(iPhone|iPod|iPad|Android|Windows Phone)\\b",""),c=window.navigator.userAgent;if(!O.get_supported()&&b.match(c))return Aa.logger.warn("HTML5 audio is blacklisted for this browser",["userAgent",c]),[];for(var b=[{format:C.M4A,mimeType:"audio/mp4; codecs=mp4a"},{format:C.MP3,mimeType:"audio/mpeg"},{format:C.OPUS,mimeType:"audio/ogg; codecs=opus"},{format:C.OGG,mimeType:"audio/ogg; codecs=vorbis"},{format:C.WAV,mimeType:"audio/wav"}],c=[],d=0;d<b.length;){var e=b[d];++d;var i=
"";try{i=a.canPlayType(e.mimeType)}catch(m){m instanceof p&&(m=m.val)}""!=i&&c.push(e.format)}return c};ka.supportsBlob=function(){if(ka._detectBlobSupport){ka._detectBlobSupport=!1;if((new cc("\\bSilk\\b","")).match(window.navigator.userAgent)||null==window.Blob)return!1;var a=new XMLHttpRequest;a.open("GET",".",!0);if(""!=a.responseType)return!1;a.responseType="blob";if("blob"!=a.responseType)return!1;ka._URL=F.loadExtension("URL").value}return null!=ka._URL&&null!=ka._URL.createObjectURL};ka.__super__=
$d;ka.prototype=v($d.prototype,{loadEntry:function(a,b){var c=this;switch(b.format[1]){case 0:case 1:case 2:case 3:case 4:var d;d=window.document.createElement("img");var e=new Qe;e.addDisposingListener(d,"load",function(){ka.supportsBlob()&&ka._URL.revokeObjectURL(d.src);var a=c._platform.getRenderer().createTextureFromImage(d);null!=a?c.handleLoad(b,a):c.handleTextureError(b)});e.addDisposingListener(d,"error",function(){c.handleError(b,"Failed to load image")});ka.supportsBlob()?this.download(a,
b,"blob",function(a){d.src=ka._URL.createObjectURL(a)}):d.src=a;break;case 5:case 6:case 7:this.download(a,b,"arraybuffer",function(){var a=c._platform.getRenderer().createCompressedTexture(b.format,null);null!=a?c.handleLoad(b,a):c.handleTextureError(b)});break;case 8:case 9:case 10:case 11:case 12:if(O.get_supported())this.download(a,b,"arraybuffer",function(d){O.ctx.decodeAudioData(d,function(a){c.handleLoad(b,new O(a))},function(){Aa.logger.warn("Couldn't decode Web Audio, ignoring this asset",
["url",a]);c.handleLoad(b,La.getInstance())})});else{var i;i=window.document.createElement("audio");i.preload="auto";var m=++ka._mediaRefCount;null==ka._mediaElements&&(ka._mediaElements=new hd);ka._mediaElements.h[m]=i;e=new Qe;e.addDisposingListener(i,"canplaythrough",function(){ka._mediaElements.remove(m);c.handleLoad(b,new Ue(i))});e.addDisposingListener(i,"error",function(){ka._mediaElements.remove(m);var d=i.error.code;3==d||4==d?(Aa.logger.warn("Couldn't decode HTML5 audio, ignoring this asset",
["url",a,"code",d]),c.handleLoad(b,La.getInstance())):c.handleError(b,"Failed to load audio: "+i.error.code)});e.addListener(i,"progress",function(){if(0<i.buffered.length&&0<i.duration){var a=i.buffered.end(0)/i.duration;c.handleProgress(b,a*b.bytes|0)}});i.src=a;i.load()}break;case 13:this.download(a,b,"text",function(a){c.handleLoad(b,new Ne(a))})}},getAssetFormats:function(a){var b=this;null==ka._supportedFormats&&(ka._supportedFormats=new Pf,ka.detectImageFormats(function(a){ka._supportedFormats.set_result(b._platform.getRenderer().getCompressedTextureFormats().concat(a).concat(ka.detectAudioFormats()).concat([C.Data]))}));
ka._supportedFormats.get(a)},download:function(a,b,c,d){var e=this,i=null,m=null,f=0,r=!1,g=function(){r&&(r=!1,window.clearInterval(f))},h=3,j=function(){--h;return 0<=h?(Aa.logger.warn("Retrying asset download",["url",b.url]),m(),!0):!1},m=function(){g();null!=i&&i.abort();i=new XMLHttpRequest;i.open("GET",a,!0);i.responseType=c;var m=0;i.onprogress=function(a){r||(r=!0,f=window.setInterval(function(){4!=i.readyState&&5E3<Date.now()-m&&!j()&&(g(),e.handleError(b,"Download stalled"))},1E3));m=Date.now();
e.handleProgress(b,a.loaded)};i.onerror=function(){if(0!=i.status||!j())g(),e.handleError(b,"HTTP error "+i.status)};i.onload=function(){var a=i.response;null==a&&(a=i.responseText);g();d(a)};i.send()};m()},__class__:ka});var ki=function(){};h["flambe.subsystem.ExternalSystem"]=ki;ki.__name__=!0;ki.prototype={__class__:ki};var Jf=function(){};h["flambe.platform.html.HtmlExternal"]=Jf;Jf.__name__=!0;Jf.__interfaces__=[ki];Jf.prototype={call:function(a,b){null==b&&(b=[]);for(var c=window,d=c,e=0,i=
a.split(".");e<i.length;){var m=i[e];++e;c=d;d=Q.field(c,m)}return Q.callMethod(c,d,b)},__class__:Jf};var li=function(){};h["flambe.util.LogHandler"]=li;li.__name__=!0;li.prototype={__class__:li};var Zd=function(a){this._tagPrefix=a+": "};h["flambe.platform.html.HtmlLogHandler"]=Zd;Zd.__name__=!0;Zd.__interfaces__=[li];Zd.isSupported=function(){return"object"==typeof console&&null!=console.info};Zd.prototype={log:function(a,b){b=this._tagPrefix+b;switch(a[1]){case 0:console.info(b);break;case 1:console.warn(b);
break;case 2:console.error(b)}},__class__:Zd};var Gf=function(a,b){Cb.call(this,a);this._canvas=b};h["flambe.platform.html.HtmlMouse"]=Gf;Gf.__name__=!0;Gf.__super__=Cb;Gf.prototype=v(Cb.prototype,{__class__:Gf});var Ue=function(a){this._disposed=!1;this.audioElement=a};h["flambe.platform.html.HtmlSound"]=Ue;Ue.__name__=!0;Ue.__interfaces__=[ae];Ue.__super__=Oa;Ue.prototype=v(Oa.prototype,{play:function(a){null==a&&(a=1);return new Ve(this,a,!1)},loop:function(a){null==a&&(a=1);return new Ve(this,
a,!0)},onDisposed:function(){this.audioElement=null},__class__:Ue});var Ve=function(a,b,c){var d=this;this._sound=a;this._tickableAdded=!1;this._clonedElement=window.document.createElement("audio");this._clonedElement.loop=c;this._clonedElement.src=a.audioElement.src;this.volume=new Ka(b,function(){d.updateVolume()});this.updateVolume();this._complete=new xa(!1);this.playAudio();Y.hidden._value&&this.set_paused(!0)};h["flambe.platform.html._HtmlSound.HtmlPlayback"]=Ve;Ve.__name__=!0;Ve.__interfaces__=
[Tf,be];Ve.prototype={set_paused:function(a){this._clonedElement.paused!=a&&(a?this._clonedElement.pause():this.playAudio());return a},update:function(a){this.volume.update(a);this._complete.set__(this._clonedElement.ended);return this._complete._value||this._clonedElement.paused?(this._tickableAdded=!1,this._volumeBinding.dispose(),this._hideBinding.dispose(),!0):!1},dispose:function(){this.set_paused(!0);this._complete.set__(!0)},playAudio:function(){var a=this;this._clonedElement.play();this._tickableAdded||
(rc.instance.mainLoop.addTickable(this),this._tickableAdded=!0,this._volumeBinding=Y.volume.get_changed().connect(function(){a.updateVolume()}),this._hideBinding=Y.hidden.get_changed().connect(function(b){b?(a._wasPaused=a._clonedElement.paused,a.set_paused(!0)):a.set_paused(a._wasPaused)}))},updateVolume:function(){this._clonedElement.volume=Y.volume._value*this.volume._value},__class__:Ve,__properties__:{set_paused:"set_paused"}};var mi=function(){};h["flambe.subsystem.StageSystem"]=mi;mi.__name__=
!0;mi.prototype={__class__:mi,__properties__:{get_height:"get_height",get_width:"get_width"}};var Id=function(a){var b=this;this._canvas=a;this.resize=new Cd;this.scaleFactor=Id.computeScaleFactor();1!=this.scaleFactor&&(Aa.logger.info("Reversing device DPI scaling",["scaleFactor",this.scaleFactor]),F.setVendorStyle(this._canvas,"transform-origin","top left"),F.setVendorStyle(this._canvas,"transform","scale("+1/this.scaleFactor+")"));F.SHOULD_HIDE_MOBILE_BROWSER&&(window.addEventListener("orientationchange",
function(){F.callLater(y(b,b.hideMobileBrowser),200)},!1),this.hideMobileBrowser());window.addEventListener("resize",y(this,this.onWindowResize),!1);this.onWindowResize(null);this.orientation=new xa(null);null!=window.orientation&&(window.addEventListener("orientationchange",y(this,this.onOrientationChange),!1),this.onOrientationChange(null));this.fullscreen=new xa(!1);F.addVendorListener(window.document,"fullscreenchange",function(){b.updateFullscreen()},!1);this.updateFullscreen()};h["flambe.platform.html.HtmlStage"]=
Id;Id.__name__=!0;Id.__interfaces__=[mi];Id.computeScaleFactor=function(){var a=window.devicePixelRatio;null==a&&(a=1);var b=window.document.createElement("canvas").getContext("2d",null),b=F.loadExtension("backingStorePixelRatio",b).value;null==b&&(b=1);a/=b;b=window.screen.height;return 1136<a*window.screen.width||1136<a*b?1:a};Id.prototype={get_width:function(){return this._canvas.width},get_height:function(){return this._canvas.height},onWindowResize:function(){var a=this._canvas.parentElement.getBoundingClientRect();
this.resizeCanvas(a.width,a.height)},resizeCanvas:function(a,b){var c=this.scaleFactor*a,d=this.scaleFactor*b;if(this._canvas.width==c&&this._canvas.height==d)return!1;this._canvas.width=c|0;this._canvas.height=d|0;this.resize.emit();return!0},hideMobileBrowser:function(){var a=this,b=window.document.documentElement.style;b.height=window.innerHeight+100+"px";b.width=window.innerWidth+"px";b.overflow="visible";F.callLater(function(){F.hideMobileBrowser();F.callLater(function(){b.height=window.innerHeight+
"px";a.onWindowResize(null)},100)})},onOrientationChange:function(){this.orientation.set__(F.orientation(window.orientation))},updateFullscreen:function(){this.fullscreen.set__(!0==F.loadFirstExtension(["fullscreen","fullScreen","isFullScreen"],window.document).value)},__class__:Id,__properties__:{get_height:"get_height",get_width:"get_width"}};var F=function(){};h["flambe.platform.html.HtmlUtil"]=F;F.__name__=!0;F.callLater=function(a,b){null==b&&(b=0);window.setTimeout(a,b)};F.hideMobileBrowser=
function(){window.scrollTo(1,0)};F.loadExtension=function(a,b){null==b&&(b=window);var c=Q.field(b,a);if(null!=c)return{prefix:"",field:a,value:c};for(var c=a.charAt(0).toUpperCase()+E.substr(a,1,null),d=0,e=F.VENDOR_PREFIXES;d<e.length;){var i=e[d];++d;var m=i+c,f=Q.field(b,m);if(null!=f)return{prefix:i,field:m,value:f}}return{prefix:null,field:null,value:null}};F.loadFirstExtension=function(a,b){for(var c=0;c<a.length;){var d=a[c];++c;d=F.loadExtension(d,b);if(null!=d.field)return d}return{prefix:null,
field:null,value:null}};F.polyfill=function(a,b){null==b&&(b=window);var c=F.loadExtension(a,b).value;if(null==c)return!1;b[a]=c;return!0};F.setVendorStyle=function(a,b,c){for(var a=a.style,d=0,e=F.VENDOR_PREFIXES;d<e.length;){var i=e[d];++d;a.setProperty("-"+i+"-"+b,c)}a.setProperty(b,c)};F.addVendorListener=function(a,b,c,d){for(var e=0,i=F.VENDOR_PREFIXES;e<i.length;){var m=i[e];++e;a.addEventListener(m+b,c,d)}a.addEventListener(b,c,d)};F.orientation=function(a){switch(a){case -90:case 90:return Qc.Landscape;
default:return Qc.Portrait}};F.createEmptyCanvas=function(a,b){var c;c=window.document.createElement("canvas");c.width=a;c.height=b;return c};F.createCanvas=function(a){var b=F.createEmptyCanvas(a.width,a.height),c=b.getContext("2d",null);c.save();c.globalCompositeOperation="copy";c.drawImage(a,0,0);c.restore();return b};F.detectSlowDriver=function(a){if(0<=window.navigator.platform.indexOf("Win")&&null!=window.chrome){for(var b=0,a=a.getSupportedExtensions();b<a.length;){var c=a[b];++b;if(0<=c.indexOf("WEBGL_compressed_texture"))return!1}return!0}return!1};
F.fixAndroidMath=function(){if(0<=window.navigator.userAgent.indexOf("Linux; U; Android 4")){Aa.logger.warn("Monkey patching around Android sin/cos bug",null);var a=Math.sin,b=Math.cos;Math.sin=function(b){return 0==b?0:a(b)};Math.cos=function(a){return 0==a?1:b(a)}}};var O=function(a){this._disposed=!1;this.buffer=a};h["flambe.platform.html.WebAudioSound"]=O;O.__name__=!0;O.__interfaces__=[ae];O.__properties__={get_supported:"get_supported"};O.get_supported=function(){if(O._detectSupport){O._detectSupport=
!1;var a=F.loadExtension("AudioContext").value;null!=a&&(O.ctx=new a,O.gain=O.createGain(),O.gain.connect(O.ctx.destination),Y.volume.watch(function(a){O.gain.gain.value=a}))}return null!=O.ctx};O.createGain=function(){return null!=O.ctx.createGain?O.ctx.createGain():O.ctx.createGainNode()};O.start=function(a,b){null!=a.start?a.start(b):a.noteOn(b)};O.__super__=Oa;O.prototype=v(Oa.prototype,{play:function(a){null==a&&(a=1);return new We(this,a,!1)},loop:function(a){null==a&&(a=1);return new We(this,
a,!0)},get_duration:function(){return this.buffer.duration},onDisposed:function(){this.buffer=null},__class__:O,__properties__:{get_duration:"get_duration"}});var We=function(a,b,c){var d=this;this._sound=a;this._head=O.gain;this._complete=new xa(!1);this._sourceNode=O.ctx.createBufferSource();this._sourceNode.buffer=a.buffer;this._sourceNode.loop=c;this._sourceNode.onended=function(){d._complete.set__(!0)};O.start(this._sourceNode,0);this.playAudio();this.volume=new Ka(b,function(a){d.setVolume(a)});
1!=b&&this.setVolume(b);Y.hidden._value&&this.set_paused(!0)};h["flambe.platform.html._WebAudioSound.WebAudioPlayback"]=We;We.__name__=!0;We.__interfaces__=[Tf,be];We.prototype={set_paused:function(a){a!=0<=this._pausedAt&&(a?(this._sourceNode.disconnect(),this._pausedAt=this.get_position()):this.playAudio());return a},get_position:function(){return this._complete._value?this._sound.get_duration():0<=this._pausedAt?this._pausedAt:(O.ctx.currentTime-this._startedAt)%this._sound.get_duration()},update:function(a){this.volume.update(a);
3==this._sourceNode.playbackState&&this._complete.set__(!0);return this._complete._value||0<=this._pausedAt?(this._tickableAdded=!1,this._hideBinding.dispose(),!0):!1},dispose:function(){this.set_paused(!0);this._complete.set__(!0)},setVolume:function(a){null==this._gainNode&&(this._gainNode=O.createGain(),this.insertNode(this._gainNode));this._gainNode.gain.value=a},insertNode:function(a){0<=this._pausedAt||(this._sourceNode.disconnect(),this._sourceNode.connect(a));a.connect(this._head);this._head=
a},playAudio:function(){var a=this;this._sourceNode.connect(this._head);this._startedAt=O.ctx.currentTime;this._pausedAt=-1;this._tickableAdded||(rc.instance.mainLoop.addTickable(this),this._tickableAdded=!0,this._hideBinding=Y.hidden.get_changed().connect(function(b){b?(a._wasPaused=0<=a._pausedAt,a.set_paused(!0)):a.set_paused(a._wasPaused)}))},__class__:We,__properties__:{get_position:"get_position",set_paused:"set_paused"}};var ni=function(a){this._quads=this._maxQuads=this._dataOffset=this._backbufferWidth=
this._backbufferHeight=0;this._pendingSetScissor=!1;this._lastBlendMode=this._lastRenderTarget=this._lastShader=this._lastTexture=this._lastScissor=this._currentBlendMode=this._currentShader=this._currentTexture=this._currentRenderTarget=null;this._gl=a;a.clearColor(0,0,0,0);a.enable(3042);a.pixelStorei(37441,1);this._vertexBuffer=a.createBuffer();a.bindBuffer(34962,this._vertexBuffer);this._quadIndexBuffer=a.createBuffer();a.bindBuffer(34963,this._quadIndexBuffer);this._drawTextureShader=new Wf(a);
this._drawPatternShader=new Xf(a);this._fillRectShader=new Yf(a);this.resize(16)};h["flambe.platform.html.WebGLBatcher"]=ni;ni.__name__=!0;ni.prototype={resizeBackbuffer:function(a,b){this._gl.viewport(0,0,a,b);this._backbufferWidth=a;this._backbufferHeight=b},willRender:function(){this._gl.clear(16384)},didRender:function(){this.flush()},bindTexture:function(a){this.flush();this._currentTexture=this._lastTexture=null;this._gl.bindTexture(3553,a)},deleteTexture:function(a){null!=this._lastTexture&&
this._lastTexture.root==a&&(this.flush(),this._currentTexture=this._lastTexture=null);this._gl.deleteTexture(a.nativeTexture)},deleteFramebuffer:function(a){a==this._lastRenderTarget&&(this.flush(),this._currentRenderTarget=this._lastRenderTarget=null);this._gl.deleteFramebuffer(a.framebuffer)},prepareDrawTexture:function(a,b,c,d){d!=this._lastTexture&&(this.flush(),this._lastTexture=d);return this.prepareQuad(5,a,b,c,this._drawTextureShader)},prepareFillRect:function(a,b,c){return this.prepareQuad(6,
a,b,c,this._fillRectShader)},prepareQuad:function(a,b,c,d,e){b!=this._lastRenderTarget&&(this.flush(),this._lastRenderTarget=b);c!=this._lastBlendMode&&(this.flush(),this._lastBlendMode=c);e!=this._lastShader&&(this.flush(),this._lastShader=e);if(null!=d||null!=this._lastScissor)if(null==d||null==this._lastScissor||!this._lastScissor.equals(d))this.flush(),this._lastScissor=null!=d?d.clone(this._lastScissor):null,this._pendingSetScissor=!0;this._quads>=this._maxQuads&&this.resize(2*this._maxQuads);
++this._quads;b=this._dataOffset;this._dataOffset+=4*a;return b},flush:function(){if(!(1>this._quads)){this._lastRenderTarget!=this._currentRenderTarget&&this.bindRenderTarget(this._lastRenderTarget);if(this._lastBlendMode!=this._currentBlendMode){switch(this._lastBlendMode[1]){case 0:this._gl.blendFunc(1,771);break;case 1:this._gl.blendFunc(1,1);break;case 2:this._gl.blendFunc(774,771);break;case 3:this._gl.blendFunc(1,769);break;case 4:this._gl.blendFunc(0,770);break;case 5:this._gl.blendFunc(1,
0)}this._currentBlendMode=this._lastBlendMode}this._pendingSetScissor&&(null!=this._lastScissor?(this._gl.enable(3089),this._gl.scissor(this._lastScissor.x|0,this._lastScissor.y|0,this._lastScissor.width|0,this._lastScissor.height|0)):this._gl.disable(3089),this._pendingSetScissor=!1);this._lastTexture!=this._currentTexture&&(this._gl.bindTexture(3553,this._lastTexture.root.nativeTexture),this._currentTexture=this._lastTexture);this._lastShader!=this._currentShader&&(this._lastShader.useProgram(),
this._lastShader.prepare(),this._currentShader=this._lastShader);if(this._lastShader==this._drawPatternShader){var a=this._lastTexture,b=a.root;this._drawPatternShader.setRegion(a.rootX/b.width,a.rootY/b.height,a._width/b.width,a._height/b.height)}this._gl.bufferData(34962,this.data.subarray(0,this._dataOffset),35040);this._gl.drawElements(4,6*this._quads,5123,0);this._dataOffset=this._quads=0}},resize:function(a){this.flush();if(!(1024<a)){this._maxQuads=a;this.data=new Float32Array(24*a);this._gl.bufferData(34962,
4*this.data.length,35040);for(var b=new Uint16Array(6*a),c=0;c<a;){var d=c++;b[6*d]=4*d;b[6*d+1]=4*d+1;b[6*d+2]=4*d+2;b[6*d+3]=4*d+2;b[6*d+4]=4*d+3;b[6*d+5]=4*d}this._gl.bufferData(34963,b,35044)}},bindRenderTarget:function(a){null!=a?(this._gl.bindFramebuffer(36160,a.framebuffer),this._gl.viewport(0,0,a.width,a.height)):(this._gl.bindFramebuffer(36160,null),this._gl.viewport(0,0,this._backbufferWidth,this._backbufferHeight));this._lastRenderTarget=this._currentRenderTarget=a},resetLastStateVars:function(){this._gl.enable(3042);
this._gl.disable(2960);this._gl.disable(2929);this._gl.bindBuffer(34962,this._vertexBuffer);this._gl.bindBuffer(34963,this._quadIndexBuffer);null!=this._lastRenderTarget&&this.bindRenderTarget(this._lastRenderTarget);this._gl.blendFunc(1,771);null!=this._lastTexture&&this._gl.bindTexture(3553,this._lastTexture.root.nativeTexture);null!=this._lastShader&&(this._lastShader.useProgram(),this._lastShader.prepare())},__class__:ni};var uc=function(a,b){this._inverseProjection=this._stateList=null;null==
uc._scratchQuadArray&&(uc._scratchQuadArray=new Float32Array(8));this._batcher=a;this._renderTarget=b};h["flambe.platform.html.WebGLGraphics"]=uc;uc.__name__=!0;uc.__interfaces__=[Re];uc.prototype={save:function(){var a=this._stateList,b=this._stateList.next;null==b&&(b=new Zf,b.prev=a,a.next=b);a.matrix.clone(b.matrix);b.alpha=a.alpha;b.blendMode=a.blendMode;b.scissor=null!=a.scissor?a.scissor.clone(b.scissor):null;this._stateList=b},translate:function(a,b){var c=this._stateList.matrix;c.m02+=c.m00*
a+c.m01*b;c.m12+=c.m10*a+c.m11*b},rotate:function(a){var b=this._stateList.matrix,a=3.141592653589793*a/180,c=Math.sin(a),a=Math.cos(a),d=b.m00,e=b.m10,i=b.m01,m=b.m11;b.m00=d*a+i*c;b.m10=e*a+m*c;b.m01=i*a-d*c;b.m11=m*a-e*c},transform:function(a,b,c,d,e,i){var m=this._stateList;uc._scratchMatrix.set(a,b,c,d,e,i);Wa.multiply(m.matrix,uc._scratchMatrix,m.matrix)},restore:function(){this._stateList=this._stateList.prev},drawTexture:function(a,b,c){this._batcher.resetLastStateVars();this.drawSubTexture(a,
b,c,0,0,a.get_width(),a.get_height())},drawSubTexture:function(a,b,c,d,e,i,m){var f=this._stateList,r=a.root,b=this.transformQuad(b,c,i,m),c=r.width,r=r.height,d=(a.rootX+d)/c,e=(a.rootY+e)/r,i=d+i/c,m=e+m/r,c=f.alpha,a=this._batcher.prepareDrawTexture(this._renderTarget,f.blendMode,f.scissor,a),f=this._batcher.data;f[a]=b[0];f[++a]=b[1];f[++a]=d;f[++a]=e;f[++a]=c;f[++a]=b[2];f[++a]=b[3];f[++a]=i;f[++a]=e;f[++a]=c;f[++a]=b[4];f[++a]=b[5];f[++a]=i;f[++a]=m;f[++a]=c;f[++a]=b[6];f[++a]=b[7];f[++a]=d;
f[++a]=m;f[++a]=c},fillRect:function(a,b,c,d,e){var i=this._stateList,b=this.transformQuad(b,c,d,e),c=(a&16711680)/16711680,d=(a&65280)/65280,a=(a&255)/255,e=i.alpha,i=this._batcher.prepareFillRect(this._renderTarget,i.blendMode,i.scissor),m=this._batcher.data;m[i]=b[0];m[++i]=b[1];m[++i]=c;m[++i]=d;m[++i]=a;m[++i]=e;m[++i]=b[2];m[++i]=b[3];m[++i]=c;m[++i]=d;m[++i]=a;m[++i]=e;m[++i]=b[4];m[++i]=b[5];m[++i]=c;m[++i]=d;m[++i]=a;m[++i]=e;m[++i]=b[6];m[++i]=b[7];m[++i]=c;m[++i]=d;m[++i]=a;m[++i]=e},multiplyAlpha:function(a){this._stateList.alpha*=
a},setBlendMode:function(a){this._stateList.blendMode=a},applyScissor:function(a,b,c,d){var e=this._stateList,i=uc._scratchQuadArray;i[0]=a;i[1]=b;i[2]=a+c;i[3]=b+d;e.matrix.transformArray(i,4,i);this._inverseProjection.transformArray(i,4,i);a=i[0];b=i[1];c=i[2]-a;d=i[3]-b;0>c&&(a+=c,c=-c);0>d&&(b+=d,d=-d);e.applyScissor(a,b,c,d)},willRender:function(){this._batcher.resetLastStateVars();this._batcher.willRender()},didRender:function(){this._batcher.resetLastStateVars();this._batcher.didRender()},
onResize:function(a,b){this._stateList=new Zf;var c;c=null!=this._renderTarget?-1:1;this._stateList.matrix.set(2/a,0,0,-2*c/b,-1,c);this._inverseProjection=new Wa;this._inverseProjection.set(2/a,0,0,2/b,-1,-1);this._inverseProjection.invert()},transformQuad:function(a,b,c,d){var c=a+c,d=b+d,e=uc._scratchQuadArray;e[0]=a;e[1]=b;e[2]=c;e[3]=b;e[4]=c;e[5]=d;e[6]=a;e[7]=d;this._stateList.matrix.transformArray(e,8,e);return e},__class__:uc};var Zf=function(){this.scissor=this.prev=this.next=null;this.matrix=
new Wa;this.alpha=1;this.blendMode=ba.Normal};h["flambe.platform.html._WebGLGraphics.DrawingState"]=Zf;Zf.__name__=!0;Zf.prototype={applyScissor:function(a,b,c,d){if(null!=this.scissor)var e=gd.max(this.scissor.x,a),i=gd.max(this.scissor.y,b),c=gd.min(this.scissor.x+this.scissor.width,a+c),d=gd.min(this.scissor.y+this.scissor.height,b+d),a=e,b=i,c=c-e,d=d-i;else this.scissor=new tc;this.scissor.set(Math.round(a),Math.round(b),Math.round(c),Math.round(d))},__class__:Zf};var Kf=function(a,b){var c=
this;this._hasGPU=new xa(!0);this.gl=b;b.canvas.addEventListener("webglcontextlost",function(a){a.preventDefault();Aa.logger.warn("WebGL context lost",null);c._hasGPU.set__(!1)},!1);b.canvas.addEventListener("webglcontextrestore",function(){Aa.logger.warn("WebGL context restored",null);c.init();c._hasGPU.set__(!0)},!1);a.resize.connect(y(this,this.onResize));this.init()};h["flambe.platform.html.WebGLRenderer"]=Kf;Kf.__name__=!0;Kf.__interfaces__=[Se];Kf.prototype={get_type:function(){return kb.WebGL},
createTextureFromImage:function(a){if(this.gl.isContextLost())return null;var b=new ce(this,a.width,a.height);b.uploadImageData(a);return b.createTexture(a.width,a.height)},getCompressedTextureFormats:function(){return[]},createCompressedTexture:function(){this.gl.isContextLost();return null},willRender:function(){this.graphics.willRender()},didRender:function(){this.graphics.didRender()},onResize:function(){var a=this.gl.canvas.width,b=this.gl.canvas.height;this.batcher.resizeBackbuffer(a,b);this.graphics.onResize(a,
b)},init:function(){this.batcher=new ni(this.gl);this.graphics=new uc(this.batcher,null);this.onResize()},__class__:Kf,__properties__:{get_type:"get_type"}};var $f=function(a,b,c){Rc.call(this,a,b,c)};h["flambe.platform.html.WebGLTexture"]=$f;$f.__name__=!0;$f.__super__=Rc;$f.prototype=v(Rc.prototype,{__class__:$f});var ce=function(a,b,c){this.framebuffer=this._graphics=null;this._disposed=!1;this._renderer=a;this.width=gd.max(2,ji.nextPowerOfTwo(b));this.height=gd.max(2,ji.nextPowerOfTwo(c));b=a.gl;
this.nativeTexture=b.createTexture();a.batcher.bindTexture(this.nativeTexture);b.texParameteri(3553,10242,33071);b.texParameteri(3553,10243,33071);b.texParameteri(3553,10240,9729);b.texParameteri(3553,10241,9728)};h["flambe.platform.html.WebGLTextureRoot"]=ce;ce.__name__=!0;ce.__interfaces__=[Tj];ce.drawBorder=function(a,b,c){var d=a.getContext("2d",null);d.drawImage(a,b-1,0,1,c,b,0,1,c);d.drawImage(a,0,c-1,b,1,0,c,b,1)};ce.__super__=Oa;ce.prototype=v(Oa.prototype,{createTexture:function(a,b){return new $f(this,
a,b)},uploadImageData:function(a){if(this.width!=a.width||this.height!=a.height){var b=F.createEmptyCanvas(this.width,this.height);b.getContext("2d",null).drawImage(a,0,0);ce.drawBorder(b,a.width,a.height);a=b}this._renderer.batcher.bindTexture(this.nativeTexture);this._renderer.gl.texImage2D(3553,0,6408,6408,5121,a)},onDisposed:function(){var a=this._renderer.batcher;a.deleteTexture(this);null!=this.framebuffer&&a.deleteFramebuffer(this);this._graphics=this.framebuffer=this.nativeTexture=null},__class__:ce});
var sb=function(a,b,c){c="#ifdef GL_ES\nprecision mediump float;\n#endif\n"+c;this._gl=a;this._program=a.createProgram();a.attachShader(this._program,sb.createShader(a,35633,b));a.attachShader(this._program,sb.createShader(a,35632,c));a.linkProgram(this._program);a.useProgram(this._program)};h["flambe.platform.shader.ShaderGL"]=sb;sb.__name__=!0;sb.createShader=function(a,b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);return b};sb.prototype={useProgram:function(){this._gl.useProgram(this._program)},
prepare:function(){null},getAttribLocation:function(a){return this._gl.getAttribLocation(this._program,a)},getUniformLocation:function(a){return this._gl.getUniformLocation(this._program,a)},__class__:sb};var Xf=function(a){sb.call(this,a,"attribute highp vec2 a_pos;\nattribute mediump vec2 a_uv;\nattribute lowp float a_alpha;\nvarying mediump vec2 v_uv;\nvarying lowp float v_alpha;\nvoid main (void) {\nv_uv = a_uv;\nv_alpha = a_alpha;\ngl_Position = vec4(a_pos, 0, 1);\n}","varying mediump vec2 v_uv;\nvarying lowp float v_alpha;\nuniform lowp sampler2D u_texture;\nuniform mediump vec4 u_region;\nvoid main (void) {\ngl_FragColor = texture2D(u_texture, u_region.xy + mod(v_uv, u_region.zw)) * v_alpha;\n}");
this.a_pos=this.getAttribLocation("a_pos");this.a_uv=this.getAttribLocation("a_uv");this.a_alpha=this.getAttribLocation("a_alpha");this.u_texture=this.getUniformLocation("u_texture");this.u_region=this.getUniformLocation("u_region");this.setTexture(0)};h["flambe.platform.shader.DrawPatternGL"]=Xf;Xf.__name__=!0;Xf.__super__=sb;Xf.prototype=v(sb.prototype,{setTexture:function(a){this._gl.uniform1i(this.u_texture,a)},setRegion:function(a,b,c,d){this._gl.uniform4f(this.u_region,a,b,c,d)},prepare:function(){this._gl.enableVertexAttribArray(this.a_pos);
this._gl.enableVertexAttribArray(this.a_uv);this._gl.enableVertexAttribArray(this.a_alpha);this._gl.vertexAttribPointer(this.a_pos,2,5126,!1,20,0);this._gl.vertexAttribPointer(this.a_uv,2,5126,!1,20,8);this._gl.vertexAttribPointer(this.a_alpha,1,5126,!1,20,16)},__class__:Xf});var Wf=function(a){sb.call(this,a,"attribute highp vec2 a_pos;\nattribute mediump vec2 a_uv;\nattribute lowp float a_alpha;\nvarying mediump vec2 v_uv;\nvarying lowp float v_alpha;\nvoid main (void) {\nv_uv = a_uv;\nv_alpha = a_alpha;\ngl_Position = vec4(a_pos, 0, 1);\n}",
"varying mediump vec2 v_uv;\nvarying lowp float v_alpha;\nuniform lowp sampler2D u_texture;\nvoid main (void) {\ngl_FragColor = texture2D(u_texture, v_uv) * v_alpha;\n}");this.a_pos=this.getAttribLocation("a_pos");this.a_uv=this.getAttribLocation("a_uv");this.a_alpha=this.getAttribLocation("a_alpha");this.u_texture=this.getUniformLocation("u_texture");this.setTexture(0)};h["flambe.platform.shader.DrawTextureGL"]=Wf;Wf.__name__=!0;Wf.__super__=sb;Wf.prototype=v(sb.prototype,{setTexture:function(a){this._gl.uniform1i(this.u_texture,
a)},prepare:function(){this._gl.enableVertexAttribArray(this.a_pos);this._gl.enableVertexAttribArray(this.a_uv);this._gl.enableVertexAttribArray(this.a_alpha);this._gl.vertexAttribPointer(this.a_pos,2,5126,!1,20,0);this._gl.vertexAttribPointer(this.a_uv,2,5126,!1,20,8);this._gl.vertexAttribPointer(this.a_alpha,1,5126,!1,20,16)},__class__:Wf});var Yf=function(a){sb.call(this,a,"attribute highp vec2 a_pos;\nattribute lowp vec3 a_rgb;\nattribute lowp float a_alpha;\nvarying lowp vec4 v_color;\nvoid main (void) {\nv_color = vec4(a_rgb*a_alpha, a_alpha);\ngl_Position = vec4(a_pos, 0, 1);\n}",
"varying lowp vec4 v_color;\nvoid main (void) {\ngl_FragColor = v_color;\n}");this.a_pos=this.getAttribLocation("a_pos");this.a_rgb=this.getAttribLocation("a_rgb");this.a_alpha=this.getAttribLocation("a_alpha")};h["flambe.platform.shader.FillRectGL"]=Yf;Yf.__name__=!0;Yf.__super__=sb;Yf.prototype=v(sb.prototype,{prepare:function(){this._gl.enableVertexAttribArray(this.a_pos);this._gl.enableVertexAttribArray(this.a_rgb);this._gl.enableVertexAttribArray(this.a_alpha);this._gl.vertexAttribPointer(this.a_pos,
2,5126,!1,24,0);this._gl.vertexAttribPointer(this.a_rgb,3,5126,!1,24,8);this._gl.vertexAttribPointer(this.a_alpha,1,5126,!1,24,20)},__class__:Yf});var oi=function(){this._transitor=null};h["flambe.scene.Director"]=oi;oi.__name__=!0;oi.__super__=ha;oi.prototype=v(ha.prototype,{get_name:function(){return"Director_6"},onAdded:function(){this.owner.addChild(this._root)},onRemoved:function(){this.completeTransition();for(var a=0,b=this.scenes;a<b.length;){var c=b[a];++a;c.dispose()}this.scenes=[];this.occludedScenes=
[];this._root.dispose()},onUpdate:function(a){null!=this._transitor&&this._transitor.update(a)&&this.completeTransition()},get_topScene:function(){var a=this.scenes.length;return 0<a?this.scenes[a-1]:null},show:function(a){a=a._compMap.Scene_8;null!=a&&a.shown.emit()},invalidateVisibility:function(){for(var a=this.scenes.length;0<a;){var b=this.scenes[--a]._compMap.Scene_8;if(null==b||b.opaque)break}this.occludedScenes=0<this.scenes.length?this.scenes.slice(a,this.scenes.length-1):[];a=this.get_topScene();
null!=a&&this.show(a)},completeTransition:function(){null!=this._transitor&&(this._transitor.complete(),this._transitor=null,this.invalidateVisibility())},__class__:oi,__properties__:v(ha.prototype.__properties__,{get_topScene:"get_topScene"})});var Uj=function(){};h["flambe.scene._Director.Transitor"]=Uj;Uj.__name__=!0;Uj.prototype={update:function(a){return this._transition.update(a)},complete:function(){this._transition.complete();this._onComplete()},__class__:Uj};var pi=function(){};h["flambe.scene.Scene"]=
pi;pi.__name__=!0;pi.__super__=ha;pi.prototype=v(ha.prototype,{get_name:function(){return"Scene_8"},__class__:pi});var Vj=function(){};h["flambe.scene.Transition"]=Vj;Vj.__name__=!0;Vj.prototype={update:function(){return!0},complete:function(){},__class__:Vj};var kb=h["flambe.subsystem.RendererType"]={__ename__:!0,__constructs__:["Stage3D","WebGL","Canvas"]};kb.Stage3D=["Stage3D",0];kb.Stage3D.toString=j;kb.Stage3D.__enum__=kb;kb.WebGL=["WebGL",1];kb.WebGL.toString=j;kb.WebGL.__enum__=kb;kb.Canvas=
["Canvas",2];kb.Canvas.toString=j;kb.Canvas.__enum__=kb;kb.__empty_constructs__=[kb.Stage3D,kb.WebGL,kb.Canvas];var Zh=function(){};h["flambe.util.BitSets"]=Zh;Zh.__name__=!0;Zh.set=function(a,b,c){return c?a|b:a&~b};var bb=h["flambe.util.LogLevel"]={__ename__:!0,__constructs__:["Info","Warn","Error"]};bb.Info=["Info",0];bb.Info.toString=j;bb.Info.__enum__=bb;bb.Warn=["Warn",1];bb.Warn.toString=j;bb.Warn.__enum__=bb;bb.Error=["Error",2];bb.Error.toString=j;bb.Error.__enum__=bb;bb.__empty_constructs__=
[bb.Info,bb.Warn,bb.Error];var qi=function(a){this._capacity=2147483647;this._allocator=a;this._freeObjects=[]};h["flambe.util.Pool"]=qi;qi.__name__=!0;qi.prototype={take:function(){return 0<this._freeObjects.length?this._freeObjects.pop():this._allocator()},put:function(a){this._freeObjects.length<this._capacity&&this._freeObjects.push(a)},setSize:function(a){if(this._freeObjects.length>a)this._freeObjects.length=a;else for(var a=a-this._freeObjects.length,b=0;b<a;)b++,this._freeObjects.push(this._allocator());
return this},__class__:qi};var Pf=function(){this.success=new fa;this.error=new fa;this.progressChanged=new Cd;this.hasResult=!1;this._total=this._progress=0};h["flambe.util.Promise"]=Pf;Pf.__name__=!0;Pf.prototype={set_result:function(a){if(this.hasResult)throw new p("Promise result already assigned");this._result=a;this.hasResult=!0;this.success.emit(a);return a},get:function(a){return this.hasResult?(a(this._result),null):this.success.connect(a).once()},set_progress:function(a){this._progress!=
a&&(this._progress=a,this.progressChanged.emit());return a},set_total:function(a){this._total!=a&&(this._total=a,this.progressChanged.emit());return a},__class__:Pf,__properties__:{set_total:"set_total",set_progress:"set_progress",set_result:"set_result"}};var Cd=function(a){Pa.call(this,a)};h["flambe.util.Signal0"]=Cd;Cd.__name__=!0;Cd.__super__=Pa;Cd.prototype=v(Pa.prototype,{connect:function(a,b){null==b&&(b=!1);return this.connectImpl(a,b)},emit:function(){var a=this;this._head==Pa.DISPATCHING_SENTINEL?
this.defer(function(){a.emitImpl()}):this.emitImpl()},emitImpl:function(){for(var a=this.willEmit(),b=a;null!=b;)b._listener(),b.stayInList||b.dispose(),b=b._next;this.didEmit(a)},__class__:Cd});var Wh=function(a){this.next=null;this.fn=a};h["flambe.util._SignalBase.Task"]=Wh;Wh.__name__=!0;Wh.prototype={__class__:Wh};var sc=function(){};h["flambe.util.Strings"]=sc;sc.__name__=!0;sc.getFileExtension=function(a){var b=a.lastIndexOf(".");return 0<b?E.substr(a,b+1,null):null};sc.getUrlExtension=function(a){var b=
a.lastIndexOf("?");0<=b&&(a=E.substr(a,0,b));b=a.lastIndexOf("/");0<=b&&(a=E.substr(a,b+1,null));return sc.getFileExtension(a)};sc.joinPath=function(a,b){0<a.length&&47!=a.charCodeAt(a.length-1)&&(a+="/");return a+b};sc.withFields=function(a,b){var c=b.length;if(0<c){for(var a=0<a.length?a+" [":a+"[",d=0;d<c;){0<d&&(a+=", ");var e=b[d],i=b[d+1];if(q.is(i,Error)){var m=i.stack;null!=m&&(i=m)}a+=e+"="+q.string(i);d+=2}a+="]"}return a};var oe=function(){};h["haxe.IMap"]=oe;oe.__name__=!0;oe.prototype=
{__class__:oe};var ri=function(a,b){this.high=a;this.low=b};h["haxe._Int64.___Int64"]=ri;ri.__name__=!0;ri.prototype={__class__:ri};var Wj=function(){};h["haxe.Log"]=Wj;Wj.__name__=!0;Wj.trace=function(a,b){A.__trace(a,b)};var si=function(){};h["haxe.crypto.Crc32"]=si;si.__name__=!0;si.make=function(a){for(var b=-1,c=a.b.bufferValue,d=0,a=a.length;d<a;){for(var e=d++,e=(b^c.bytes[e])&255,i=0;8>i;)i++,e=1==(e&1)?e>>>1^-306674912:e>>>1;b=b>>>8^e}return b^-1};var ag=function(){};h["haxe.ds.BalancedTree"]=
ag;ag.__name__=!0;ag.prototype={set:function(a,b){this.root=this.setLoop(a,b,this.root)},get:function(a){for(var b=this.root;null!=b;){var c=this.compare(a,b.key);if(0==c)return b.value;b=0>c?b.left:b.right}return null},exists:function(a){for(var b=this.root;null!=b;){var c=this.compare(a,b.key);if(0==c)return!0;b=0>c?b.left:b.right}return!1},iterator:function(){var a=[];this.iteratorLoop(this.root,a);return E.iter(a)},keys:function(){var a=[];this.keysLoop(this.root,a);return E.iter(a)},setLoop:function(a,
b,c){if(null==c)return new Xa(null,a,b,null);var d=this.compare(a,c.key);if(0==d)return new Xa(c.left,a,b,c.right,null==c?0:c._height);if(0>d)return this.balance(this.setLoop(a,b,c.left),c.key,c.value,c.right);a=this.setLoop(a,b,c.right);return this.balance(c.left,c.key,c.value,a)},iteratorLoop:function(a,b){null!=a&&(this.iteratorLoop(a.left,b),b.push(a.value),this.iteratorLoop(a.right,b))},keysLoop:function(a,b){null!=a&&(this.keysLoop(a.left,b),b.push(a.key),this.keysLoop(a.right,b))},balance:function(a,
b,c,d){var e;e=null==a?0:a._height;var i;i=null==d?0:d._height;return e>i+2?function(){var b=a.left;return null==b?0:b._height}(this)>=function(){var b=a.right;return null==b?0:b._height}(this)?new Xa(a.left,a.key,a.value,new Xa(a.right,b,c,d)):new Xa(new Xa(a.left,a.key,a.value,a.right.left),a.right.key,a.right.value,new Xa(a.right.right,b,c,d)):i>e+2?function(){var a=d.right;return null==a?0:a._height}(this)>function(){var a=d.left;return null==a?0:a._height}(this)?new Xa(new Xa(a,b,c,d.left),d.key,
d.value,d.right):new Xa(new Xa(a,b,c,d.left.left),d.left.key,d.left.value,new Xa(d.left.right,d.key,d.value,d.right)):new Xa(a,b,c,d,(e>i?e:i)+1)},compare:function(a,b){return Q.compare(a,b)},__class__:ag};var Xa=function(a,b,c,d,e){null==e&&(e=-1);this.left=a;this.key=b;this.value=c;this.right=d;this._height=-1==e?(function(a){a=a.left;return null==a?0:a._height}(this)>function(a){a=a.right;return null==a?0:a._height}(this)?function(a){a=a.left;return null==a?0:a._height}(this):function(a){a=a.right;
return null==a?0:a._height}(this))+1:e};h["haxe.ds.TreeNode"]=Xa;Xa.__name__=!0;Xa.prototype={__class__:Xa};var na=function(){};h["haxe.ds.EnumValueMap"]=na;na.__name__=!0;na.__interfaces__=[oe];na.__super__=ag;na.prototype=v(ag.prototype,{compare:function(a,b){var c=a[1]-b[1];if(0!=c)return c;var c=a.slice(2),d=b.slice(2);return 0==c.length&&0==d.length?0:this.compareArgs(c,d)},compareArgs:function(a,b){var c=a.length-b.length;if(0!=c)return c;for(var c=0,d=a.length;c<d;){var e=c++,e=this.compareArg(a[e],
b[e]);if(0!=e)return e}return 0},compareArg:function(a,b){return Q.isEnumValue(a)&&Q.isEnumValue(b)?this.compare(a,b):a instanceof Array&&null==a.__enum__&&b instanceof Array&&null==b.__enum__?this.compareArgs(a,b):Q.compare(a,b)},__class__:na});var ti=function(a,b){this.elt=a;this.next=b};h["haxe.ds.GenericCell"]=ti;ti.__name__=!0;ti.prototype={__class__:ti};var ui=function(){};h["haxe.ds.GenericStack"]=ui;ui.__name__=!0;ui.prototype={add:function(a){this.head=new ti(a,this.head)},pop:function(){var a=
this.head;if(null==a)return null;this.head=a.next;return a.elt},__class__:ui};var hd=function(){this.h={}};h["haxe.ds.IntMap"]=hd;hd.__name__=!0;hd.__interfaces__=[oe];hd.prototype={set:function(a,b){this.h[a]=b},get:function(a){return this.h[a]},exists:function(a){return this.h.hasOwnProperty(a)},remove:function(a){if(!this.h.hasOwnProperty(a))return!1;delete this.h[a];return!0},keys:function(){var a=[],b;for(b in this.h)this.h.hasOwnProperty(b)&&a.push(b|0);return E.iter(a)},iterator:function(){return{ref:this.h,
it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){return this.ref[this.it.next()]}}},__class__:hd};var Qa=function(){this.h={};this.h.__keys__={}};h["haxe.ds.ObjectMap"]=Qa;Qa.__name__=!0;Qa.__interfaces__=[oe];Qa.prototype={set:function(a,b){var c=a.__id__||(a.__id__=++Qa.count);this.h[c]=b;this.h.__keys__[c]=a},get:function(a){return this.h[a.__id__]},exists:function(a){return null!=this.h.__keys__[a.__id__]},keys:function(){var a=[],b;for(b in this.h.__keys__)this.h.hasOwnProperty(b)&&
a.push(this.h.__keys__[b]);return E.iter(a)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){return this.ref[this.it.next().__id__]}}},__class__:Qa};var Rf=function(a,b){this.map=a;this.keys=b;this.index=0;this.count=b.length};h["haxe.ds._StringMap.StringMapIterator"]=Rf;Rf.__name__=!0;Rf.prototype={hasNext:function(){return this.index<this.count},next:function(){return this.map.get(this.keys[this.index++])},__class__:Rf};var D=function(){this.h=
{}};h["haxe.ds.StringMap"]=D;D.__name__=!0;D.__interfaces__=[oe];D.prototype={set:function(a,b){null!=qb[a]?this.setReserved(a,b):this.h[a]=b},get:function(a){return null!=qb[a]?this.getReserved(a):this.h[a]},exists:function(a){return null!=qb[a]?this.existsReserved(a):this.h.hasOwnProperty(a)},setReserved:function(a,b){null==this.rh&&(this.rh={});this.rh["$"+a]=b},getReserved:function(a){return null==this.rh?null:this.rh["$"+a]},existsReserved:function(a){return null==this.rh?!1:this.rh.hasOwnProperty("$"+
a)},remove:function(a){if(null!=qb[a]){a="$"+a;if(null==this.rh||!this.rh.hasOwnProperty(a))return!1;delete this.rh[a]}else{if(!this.h.hasOwnProperty(a))return!1;delete this.h[a]}return!0},keys:function(){var a=this.arrayKeys();return E.iter(a)},arrayKeys:function(){var a=[],b;for(b in this.h)this.h.hasOwnProperty(b)&&a.push(b);if(null!=this.rh)for(b in this.rh)36==b.charCodeAt(0)&&a.push(b.substr(1));return a},iterator:function(){return new Rf(this,this.arrayKeys())},__class__:D};var vc=function(a){this.length=
a.byteLength;this.b=new vi(a);this.b.bufferValue=a;a.hxBytes=this;a.bytes=this.b};h["haxe.io.Bytes"]=vc;vc.__name__=!0;vc.alloc=function(a){return new vc(new Xj(a))};vc.ofString=function(a){for(var b=[],c=0;c<a.length;){var d=Ja.fastCodeAt(a,c++);55296<=d&&56319>=d&&(d=d-55232<<10|Ja.fastCodeAt(a,c++)&1023);127>=d?b.push(d):(2047>=d?b.push(192|d>>6):(65535>=d?b.push(224|d>>12):(b.push(240|d>>18),b.push(128|d>>12&63)),b.push(128|d>>6&63)),b.push(128|d&63))}return new vc((new vi(b)).buffer)};vc.prototype=
{getString:function(a,b){if(0>a||0>b||a+b>this.length)throw new p(la.OutsideBounds);for(var c="",d=this.b,e=String.fromCharCode,i=a,m=a+b;i<m;){var f=d[i++];if(128>f){if(0==f)break;c+=e(f)}else if(224>f)c+=e((f&63)<<6|d[i++]&127);else if(240>f)var r=d[i++],c=c+e((f&31)<<12|(r&127)<<6|d[i++]&127);else var r=d[i++],g=d[i++],f=(f&15)<<18|(r&127)<<12|(g&127)<<6|d[i++]&127,c=c+e((f>>10)+55232),c=c+e(f&1023|56320)}return c},toString:function(){return this.getString(0,this.length)},__class__:vc};var wi=
function(){this.b=[]};h["haxe.io.BytesBuffer"]=wi;wi.__name__=!0;wi.prototype={getBytes:function(){var a=new vc((new vi(this.b)).buffer);this.b=null;return a},__class__:wi};var bg=function(){};h["haxe.io.Input"]=bg;bg.__name__=!0;bg.prototype={readByte:function(){throw new p("Not implemented");},readBytes:function(a,b,c){var d=c,e=a.b;if(0>b||0>c||b+c>a.length)throw new p(la.OutsideBounds);for(;0<d;)e[b]=this.readByte(),b++,d--;return c},readFullBytes:function(a,b,c){for(;0<c;)var d=this.readBytes(a,
b,c),b=b+d,c=c-d},readString:function(a){var b=vc.alloc(a);this.readFullBytes(b,0,a);return b.toString()},__class__:bg};var de=function(a,b,c){null==b&&(b=0);null==c&&(c=a.length-b);if(0>b||0>c||b+c>a.length)throw new p(la.OutsideBounds);this.b=a.b;this.pos=b;this.totlen=this.len=c};h["haxe.io.BytesInput"]=de;de.__name__=!0;de.__super__=bg;de.prototype=v(bg.prototype,{readByte:function(){if(0==this.len)throw new p(new cg);this.len--;return this.b[this.pos++]},readBytes:function(a,b,c){if(0>b||0>c||
b+c>a.length)throw new p(la.OutsideBounds);if(0==this.len&&0<c)throw new p(new cg);this.len<c&&(c=this.len);for(var d=this.b,a=a.b,e=0;e<c;){var i=e++;a[b+i]=d[this.pos+i]}this.pos+=c;this.len-=c;return c},__class__:de});var Yj=function(){};h["haxe.io.Output"]=Yj;Yj.__name__=!0;var dg=function(){this.b=new wi};h["haxe.io.BytesOutput"]=dg;dg.__name__=!0;dg.__super__=Yj;dg.prototype=v(Yj.prototype,{writeByte:function(a){this.b.b.push(a)},getBytes:function(){return this.b.getBytes()},__class__:dg});
var cg=function(){};h["haxe.io.Eof"]=cg;cg.__name__=!0;cg.prototype={toString:function(){return"Eof"},__class__:cg};var la=h["haxe.io.Error"]={__ename__:!0,__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};la.Blocked=["Blocked",0];la.Blocked.toString=j;la.Blocked.__enum__=la;la.Overflow=["Overflow",1];la.Overflow.toString=j;la.Overflow.__enum__=la;la.OutsideBounds=["OutsideBounds",2];la.OutsideBounds.toString=j;la.OutsideBounds.__enum__=la;la.Custom=function(a){a=["Custom",3,a];a.__enum__=
la;a.toString=j;return a};la.__empty_constructs__=[la.Blocked,la.Overflow,la.OutsideBounds];var Sc=function(){};h["haxe.io.FPHelper"]=Sc;Sc.__name__=!0;Sc.i32ToFloat=function(a){var b=a>>>23&255,c=a&8388607;return 0==c&&0==b?0:(1-(a>>>31<<1))*(1+Math.pow(2,-23)*c)*Math.pow(2,b-127)};Sc.floatToI32=function(a){if(0==a)return 0;var b;b=0>a?-a:a;var c=Math.floor(Math.log(b)/0.6931471805599453);-127>c?c=-127:128<c&&(c=128);b=Math.round(8388608*(b/Math.pow(2,c)-1))&8388607;return(0>a?-2147483648:0)|c+127<<
23|b};Sc.i64ToDouble=function(a,b){var c=(b>>20&2047)-1023,d=4294967296*(b&1048575)+2147483648*(a>>>31)+(a&2147483647);return 0==d&&-1023==c?0:(1-(b>>>31<<1))*(1+Math.pow(2,-52)*d)*Math.pow(2,c)};Sc.doubleToI64=function(a){var b=Sc.i64tmp;if(0==a)b.low=0,b.high=0;else{var c;c=0>a?-a:a;var d=Math.floor(Math.log(c)/0.6931471805599453);c=4503599627370496*(c/Math.pow(2,d)-1);c=Math.round(c);b.low=c|0;b.high=(0>a?-2147483648:0)|d+1023<<20|c/4294967296|0}return b};var eg=function(a){de.call(this,vc.ofString(a))};
h["haxe.io.StringInput"]=eg;eg.__name__=!0;eg.__super__=de;eg.prototype=v(de.prototype,{__class__:eg});var Db=h["haxe.xml.Filter"]={__ename__:!0,__constructs__:["FInt","FBool","FEnum","FReg"]};Db.FInt=["FInt",0];Db.FInt.toString=j;Db.FInt.__enum__=Db;Db.FBool=["FBool",1];Db.FBool.toString=j;Db.FBool.__enum__=Db;Db.FEnum=function(a){a=["FEnum",2,a];a.__enum__=Db;a.toString=j;return a};Db.FReg=function(a){a=["FReg",3,a];a.__enum__=Db;a.toString=j;return a};Db.__empty_constructs__=[Db.FInt,Db.FBool];
var Ya=h["haxe.xml.Attrib"]={__ename__:!0,__constructs__:["Att"]};Ya.Att=function(a,b,c){a=["Att",0,a,b,c];a.__enum__=Ya;a.toString=j;return a};Ya.__empty_constructs__=[];var G=h["haxe.xml.Rule"]={__ename__:!0,__constructs__:"RNode,RData,RMulti,RList,RChoice,ROptional".split(",")};G.RNode=function(a,b,c){a=["RNode",0,a,b,c];a.__enum__=G;a.toString=j;return a};G.RData=function(a){a=["RData",1,a];a.__enum__=G;a.toString=j;return a};G.RMulti=function(a,b){var c=["RMulti",2,a,b];c.__enum__=G;c.toString=
j;return c};G.RList=function(a,b){var c=["RList",3,a,b];c.__enum__=G;c.toString=j;return c};G.RChoice=function(a){a=["RChoice",4,a];a.__enum__=G;a.toString=j;return a};G.ROptional=function(a){a=["ROptional",5,a];a.__enum__=G;a.toString=j;return a};G.__empty_constructs__=[];var P=h["haxe.xml._Check.CheckResult"]={__ename__:!0,__constructs__:"CMatch,CMissing,CExtra,CElementExpected,CDataExpected,CExtraAttrib,CMissingAttrib,CInvalidAttrib,CInvalidData,CInElement".split(",")};P.CMatch=["CMatch",0];P.CMatch.toString=
j;P.CMatch.__enum__=P;P.CMissing=function(a){a=["CMissing",1,a];a.__enum__=P;a.toString=j;return a};P.CExtra=function(a){a=["CExtra",2,a];a.__enum__=P;a.toString=j;return a};P.CElementExpected=function(a,b){var c=["CElementExpected",3,a,b];c.__enum__=P;c.toString=j;return c};P.CDataExpected=function(a){a=["CDataExpected",4,a];a.__enum__=P;a.toString=j;return a};P.CExtraAttrib=function(a,b){var c=["CExtraAttrib",5,a,b];c.__enum__=P;c.toString=j;return c};P.CMissingAttrib=function(a,b){var c=["CMissingAttrib",
6,a,b];c.__enum__=P;c.toString=j;return c};P.CInvalidAttrib=function(a,b,c){a=["CInvalidAttrib",7,a,b,c];a.__enum__=P;a.toString=j;return a};P.CInvalidData=function(a,b){var c=["CInvalidData",8,a,b];c.__enum__=P;c.toString=j;return c};P.CInElement=function(a,b){var c=["CInElement",9,a,b];c.__enum__=P;c.toString=j;return c};P.__empty_constructs__=[P.CMatch];var I=function(){};h["haxe.xml.Check"]=I;I.__name__=!0;I.isBlank=function(a){return a.nodeType==o.PCData&&I.blanks.match(function(){if(a.nodeType==
o.Document||a.nodeType==o.Element)throw new p("Bad node type, unexpected "+a.nodeType);return a.nodeValue}(this))||a.nodeType==o.Comment};I.filterMatch=function(a,b){switch(b[1]){case 0:return I.filterMatch(a,Db.FReg(new cc("[0-9]+","")));case 1:return I.filterMatch(a,Db.FEnum(["true","false","0","1"]));case 2:for(var c=b[2],d=0;d<c.length;){var e=c[d];++d;if(a==e)return!0}return!1;case 3:return b[2].match(a)}};I.isNullable=function(a){switch(a[1]){case 2:var b=a[2];return!0!=a[3]||I.isNullable(b);
case 3:a=a[2];for(b=0;b<a.length;){var c=a[b];++b;if(!I.isNullable(c))return!1}return!0;case 4:a=a[2];for(b=0;b<a.length;)if(c=a[b],++b,I.isNullable(c))return!0;return!1;case 1:return!1;case 0:return!1;case 5:return!0}};I.check=function(a,b){switch(b[1]){case 0:var c=b[4],d=b[3],e=b[2],i;if(!(i=a.nodeType!=o.Element)){if(a.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+a.nodeType);i=a.nodeName!=e}if(i)return P.CElementExpected(e,a);d=null==d?[]:d.slice();for(e=a.attributes();e.hasNext();){i=
e.next();for(var m=!1,f=0;f<d.length;){var r=d[f];++f;var g=r[3],h=r[2];if(i==h){if(null!=g&&!I.filterMatch(a.get(i),g))return P.CInvalidAttrib(h,a,g);E.remove(d,r);m=!0}}if(!m)return P.CExtraAttrib(i,a)}for(e=0;e<d.length;)if(i=d[e],++e,m=i[2],null==i[4])return P.CMissingAttrib(m,a);null==c&&(c=G.RList([]));c=I.checkList(function(){if(a.nodeType!=o.Document&&a.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+a.nodeType);return E.iter(a.children)}(this),c);
if(c!=P.CMatch)return P.CInElement(a,c);for(c=0;c<d.length;)e=d[c],++c,a.set(e[2],e[4]);return P.CMatch;case 1:return c=b[2],a.nodeType!=o.PCData&&a.nodeType!=o.CData?P.CDataExpected(a):null!=c&&!I.filterMatch(function(){if(a.nodeType==o.Document||a.nodeType==o.Element)throw new p("Bad node type, unexpected "+a.nodeType);return a.nodeValue}(this),c)?P.CInvalidData(a,c):P.CMatch;case 4:c=b[2];if(0==c.length)throw new p("No choice possible");for(d=0;d<c.length;)if(e=c[d],++d,I.check(a,e)==P.CMatch)return P.CMatch;
return I.check(a,c[0]);case 5:return I.check(a,b[2]);default:throw new p("Unexpected "+q.string(b));}};I.checkList=function(a,b){switch(b[1]){case 3:for(var c=b[3],d=b[2].slice();a.hasNext();){var e=a.next();if(!I.isBlank(e)){for(var i=!1,m=0;m<d.length;){var f=d[m];++m;var r=I.checkList(E.iter([e]),f);if(r==P.CMatch){i=!0;switch(f[1]){case 2:m=f[2];if(f[3])for(var r=0,g=d.length;r<g;){var h=r++;d[h]==f&&(d[h]=G.RMulti(m))}break;default:E.remove(d,f)}break}else if(c&&!I.isNullable(f))return r}if(!i)return P.CExtra(e)}}for(c=
0;c<d.length;)if(e=d[c],++c,!I.isNullable(e))return P.CMissing(e);return P.CMatch;case 2:d=b[3];c=b[2];for(e=!1;a.hasNext();)if(i=a.next(),!I.isBlank(i)){e=I.checkList(E.iter([i]),c);if(e!=P.CMatch)return e;e=!0}return d&&!e?P.CMissing(c):P.CMatch;default:for(d=!1;a.hasNext();)if(c=a.next(),!I.isBlank(c)){d=I.check(c,b);if(d!=P.CMatch)return d;d=!0;break}if(!d)switch(b[1]){case 5:break;default:return P.CMissing(b)}for(;a.hasNext();)if(d=a.next(),!I.isBlank(d))return P.CExtra(d);return P.CMatch}};
I.makeWhere=function(a){if(0==a.length)return"";for(var b="In ",c=!0,d=0;d<a.length;){var e=a[d];++d;c?c=!1:b+=".";if(e.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+e.nodeType);b+=e.nodeName}return b+": "};I.makeString=function(a){if(a.nodeType==o.Element){if(a.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+a.nodeType);return"element "+a.nodeName}if(a.nodeType==o.Document||a.nodeType==o.Element)throw new p("Bad node type, unexpected "+
a.nodeType);a=a.nodeValue.split("\r").join("\\r").split("\n").join("\\n").split("\t").join("\\t");return 20<a.length?E.substr(a,0,17)+"...":a};I.makeRule=function(a){switch(a[1]){case 0:return"element "+a[2];case 1:return"data";case 2:return I.makeRule(a[2]);case 3:return I.makeRule(a[2][0]);case 4:return I.makeRule(a[2][0]);case 5:return I.makeRule(a[2])}};I.makeError=function(a,b){null==b&&(b=[]);switch(a[1]){case 0:throw new p("assert");case 1:var c=a[2];return I.makeWhere(b)+"Missing "+I.makeRule(c);
case 2:return c=a[2],I.makeWhere(b)+"Unexpected "+I.makeString(c);case 3:var c=a[3],d=a[2];return I.makeWhere(b)+I.makeString(c)+" while expected element "+d;case 4:return c=a[2],I.makeWhere(b)+I.makeString(c)+" while data expected";case 5:return c=a[2],b.push(a[3]),I.makeWhere(b)+"unexpected attribute "+c;case 6:return c=a[2],b.push(a[3]),I.makeWhere(b)+"missing required attribute "+c;case 7:return c=a[2],b.push(a[3]),I.makeWhere(b)+"invalid attribute value for "+c;case 8:return c=a[2],I.makeWhere(b)+
"invalid data format for "+I.makeString(c);case 9:return c=a[3],b.push(a[2]),I.makeError(c,b)}};I.checkNode=function(a,b){var c=I.checkList(E.iter([a]),b);if(c!=P.CMatch)throw new p(I.makeError(c));};var xi=function(a){this.__x=a};h["haxe.xml._Fast.NodeAccess"]=xi;xi.__name__=!0;xi.prototype={resolve:function(a){var b=this.__x.elementsNamed(a).next();if(null==b)throw b=this.__x.nodeType==o.Document?"Document":this.__x.get_nodeName(),new p(b+" is missing element "+a);return new Mb(b)},__class__:xi};
var yi=function(a){this.__x=a};h["haxe.xml._Fast.AttribAccess"]=yi;yi.__name__=!0;yi.prototype={resolve:function(a){if(this.__x.nodeType==o.Document)throw new p("Cannot access document attribute "+a);var b=this.__x.get(a);if(null==b)throw new p(this.__x.get_nodeName()+" is missing attribute "+a);return b},__class__:yi};var zi=function(a){this.__x=a};h["haxe.xml._Fast.HasAttribAccess"]=zi;zi.__name__=!0;zi.prototype={resolve:function(a){if(this.__x.nodeType==o.Document)throw new p("Cannot access document attribute "+
a);return this.__x.exists(a)},__class__:zi};var Ai=function(a){this.__x=a};h["haxe.xml._Fast.HasNodeAccess"]=Ai;Ai.__name__=!0;Ai.prototype={resolve:function(a){return this.__x.elementsNamed(a).hasNext()},__class__:Ai};var Bi=function(a){this.__x=a};h["haxe.xml._Fast.NodeListAccess"]=Bi;Bi.__name__=!0;Bi.prototype={resolve:function(a){for(var b=new Sh,a=this.__x.elementsNamed(a);a.hasNext();){var c=a.next();b.add(new Mb(c))}return b},__class__:Bi};var Mb=function(a){if(a.nodeType!=o.Document&&a.nodeType!=
o.Element)throw new p("Invalid nodeType "+a.nodeType);this.x=a;this.node=new xi(a);this.nodes=new Bi(a);this.att=new yi(a);this.has=new zi(a);this.hasNode=new Ai(a)};h["haxe.xml.Fast"]=Mb;Mb.__name__=!0;Mb.prototype={get_name:function(){return this.x.nodeType==o.Document?"Document":this.x.get_nodeName()},get_elements:function(){var a=this.x.elements();return{hasNext:y(a,a.hasNext),next:function(){var b=a.next();return null==b?null:new Mb(b)}}},__class__:Mb,__properties__:{get_elements:"get_elements",
get_name:"get_name"}};var Nc=function(){};h["haxe.xml.Parser"]=Nc;Nc.__name__=!0;Nc.parse=function(a,b){null==b&&(b=!1);var c=o.createDocument();Nc.doParse(a,b,0,c);return c};Nc.doParse=function(a,b,c,d){null==c&&(c=0);for(var e=null,i=1,m=1,f=null,r=0,g=0,h=0,j=a.charCodeAt(c),k=new qc,l=1,n=-1;j==j;){switch(i){case 0:switch(j){case 10:case 13:case 9:case 32:break;default:i=m;continue}break;case 1:switch(j){case 60:i=0;m=2;break;default:r=c;i=13;continue}break;case 13:60==j?(k.addSub(a,r,c-r),m=
o.createPCData(k.b),k=new qc,d.addChild(m),g++,i=0,m=2):38==j&&(k.addSub(a,r,c-r),i=18,l=13,r=c+1);break;case 17:93==j&&93==a.charCodeAt(c+1)&&62==a.charCodeAt(c+2)&&(j=o.createCData(E.substr(a,r,c-r)),d.addChild(j),g++,c+=2,i=1);break;case 2:switch(j){case 33:if(91==a.charCodeAt(c+1)){c+=2;if("CDATA["!=E.substr(a,c,6).toUpperCase())throw new p("Expected <![CDATA[");c+=5;i=17}else if(68==a.charCodeAt(c+1)||100==a.charCodeAt(c+1)){if("OCTYPE"!=E.substr(a,c+2,6).toUpperCase())throw new p("Expected <!DOCTYPE");
c+=8;i=16}else{if(45!=a.charCodeAt(c+1)||45!=a.charCodeAt(c+2))throw new p("Expected <\!--");c+=2;i=15}r=c+1;break;case 63:i=14;r=c;break;case 47:if(null==d)throw new p("Expected node name");r=c+1;i=0;m=10;break;default:i=3;r=c;continue}break;case 3:if(!(97<=j&&122>=j||65<=j&&90>=j||48<=j&&57>=j||58==j||46==j||95==j||45==j)){if(c==r)throw new p("Expected node name");e=o.createElement(E.substr(a,r,c-r));d.addChild(e);g++;i=0;m=4;continue}break;case 4:switch(j){case 47:i=11;break;case 62:i=9;break;
default:i=5;r=c;continue}break;case 5:if(!(97<=j&&122>=j||65<=j&&90>=j||48<=j&&57>=j||58==j||46==j||95==j||45==j)){if(r==c)throw new p("Expected attribute name");f=E.substr(a,r,c-r);if(e.exists(f))throw new p("Duplicate attribute");i=0;m=6;continue}break;case 6:switch(j){case 61:i=0;m=7;break;default:throw new p("Expected =");}break;case 7:switch(j){case 34:case 39:k=new qc;i=8;r=c+1;n=j;break;default:throw new p('Expected "');}break;case 8:switch(j){case 38:k.addSub(a,r,c-r);i=18;l=8;r=c+1;break;
case 62:if(b)throw new p("Invalid unescaped "+String.fromCharCode(j)+" in attribute value");j==n&&(k.addSub(a,r,c-r),m=k.b,k=new qc,e.set(f,m),i=0,m=4);break;case 60:if(b)throw new p("Invalid unescaped "+String.fromCharCode(j)+" in attribute value");j==n&&(k.addSub(a,r,c-r),m=k.b,k=new qc,e.set(f,m),i=0,m=4);break;default:j==n&&(k.addSub(a,r,c-r),m=k.b,k=new qc,e.set(f,m),i=0,m=4)}break;case 9:r=c=Nc.doParse(a,b,c,e);i=1;break;case 11:switch(j){case 62:i=1;break;default:throw new p("Expected >");
}break;case 12:switch(j){case 62:return 0==g&&d.addChild(o.createPCData("")),c;default:throw new p("Expected >");}case 10:if(!(97<=j&&122>=j||65<=j&&90>=j||48<=j&&57>=j||58==j||46==j||95==j||45==j)){if(r==c)throw new p("Expected node name");m=E.substr(a,r,c-r);if(d.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+d.nodeType);if(m!=d.nodeName)throw new p("Expected </"+function(){if(d.nodeType!=o.Element)throw"Bad node type, expected Element but found "+d.nodeType;return d.nodeName}(this)+
">");i=0;m=12;continue}break;case 15:45==j&&45==a.charCodeAt(c+1)&&62==a.charCodeAt(c+2)&&(j=o.createComment(E.substr(a,r,c-r)),d.addChild(j),g++,c+=2,i=1);break;case 16:91==j?h++:93==j?h--:62==j&&0==h&&(j=o.createDocType(E.substr(a,r,c-r)),d.addChild(j),g++,i=1);break;case 14:63==j&&62==a.charCodeAt(c+1)&&(c++,j=E.substr(a,r+1,c-r-2),j=o.createProcessingInstruction(j),d.addChild(j),g++,i=1);break;case 18:if(59==j){r=E.substr(a,r,c-r);if(35==r.charCodeAt(0))r=120==r.charCodeAt(1)?q.parseInt("0"+E.substr(r,
1,r.length-1)):q.parseInt(E.substr(r,1,r.length-1)),k.b+=String.fromCharCode(r);else if(Nc.escapes.exists(r))k.add(Nc.escapes.get(r));else{if(b)throw new p("Undefined entity: "+r);k.b+=q.string("&"+r+";")}r=c+1;i=l}else if(!(97<=j&&122>=j||65<=j&&90>=j||48<=j&&57>=j||58==j||46==j||95==j||45==j)&&35!=j){if(b)throw new p("Invalid character in entity: "+String.fromCharCode(j));k.b+="&";k.addSub(a,r,c-r);c--;r=c+1;i=l}}j=Ja.fastCodeAt(a,++c)}1==i&&(r=c,i=13);if(13==i){if(c!=r||0==g)k.addSub(a,r,c-r),
a=o.createPCData(k.b),d.addChild(a),g++;return c}if(!b&&18==i&&13==l)return k.b+="&",k.addSub(a,r,c-r),a=o.createPCData(k.b),d.addChild(a),g++,c;throw new p("Unexpected end");};var pe=function(a){this.output=new qc;this.pretty=a};h["haxe.xml.Printer"]=pe;pe.__name__=!0;pe.print=function(a,b){null==b&&(b=!1);var c=new pe(b);c.writeNode(a,"");return c.output.b};pe.prototype={writeNode:function(a,b){switch(a.nodeType){case 2:this.output.b+=q.string(b+"<![CDATA[");this.write(Ja.trim(function(){if(a.nodeType==
o.Document||a.nodeType==o.Element)throw new p("Bad node type, unexpected "+a.nodeType);return a.nodeValue}(this)));this.output.b+="]]\>";this.pretty&&(this.output.b+="");break;case 3:var c;if(a.nodeType==o.Document||a.nodeType==o.Element)throw new p("Bad node type, unexpected "+a.nodeType);c=a.nodeValue;c=(new cc("[\n\r\t]+","g")).replace(c,"");this.output.b=null==b?this.output.b+"null":this.output.b+(""+b);this.write(Ja.trim("<\!--"+c+"--\>"));this.pretty&&(this.output.b+="");break;case 6:if(a.nodeType!=
o.Document&&a.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+a.nodeType);for(c=E.iter(a.children);c.hasNext();)this.writeNode(c.next(),b);break;case 0:this.output.b+=q.string(b+"<");this.write(function(){if(a.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+a.nodeType);return a.nodeName}(this));for(c=a.attributes();c.hasNext();){var d=c.next();this.output.b+=q.string(" "+d+'="');this.write(Ja.htmlEscape(a.get(d),!0));this.output.b+=
'"'}if(this.hasChildren(a)){this.output.b+=">";this.pretty&&(this.output.b+="");if(a.nodeType!=o.Document&&a.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+a.nodeType);for(c=E.iter(a.children);c.hasNext();)this.writeNode(c.next(),this.pretty?b+"\t":b);this.output.b+=q.string(b+"</");this.write(function(){if(a.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+a.nodeType);return a.nodeName}(this));this.output.b+=">"}else this.output.b+=
"/>";this.pretty&&(this.output.b+="");break;case 1:if(a.nodeType==o.Document||a.nodeType==o.Element)throw new p("Bad node type, unexpected "+a.nodeType);c=a.nodeValue;0!=c.length&&(this.write(b+Ja.htmlEscape(c)),this.pretty&&(this.output.b+=""));break;case 5:this.write("<?"+function(){if(a.nodeType==o.Document||a.nodeType==o.Element)throw new p("Bad node type, unexpected "+a.nodeType);return a.nodeValue}(this)+"?>");break;case 4:this.write("<!DOCTYPE "+function(){if(a.nodeType==o.Document||a.nodeType==
o.Element)throw new p("Bad node type, unexpected "+a.nodeType);return a.nodeValue}(this)+">")}},write:function(a){this.output.b=null==a?this.output.b+"null":this.output.b+(""+a)},hasChildren:function(a){if(a.nodeType!=o.Document&&a.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+a.nodeType);for(a=E.iter(a.children);a.hasNext();){var b=a.next();switch(b.nodeType){case 0:case 1:return!0;case 2:case 3:if(0!=Ja.ltrim(function(){if(b.nodeType==o.Document||b.nodeType==
o.Element)throw new p("Bad node type, unexpected "+b.nodeType);return b.nodeValue}(this)).length)return!0}}return!1},__class__:pe};var Nb=h["hscript.Const"]={__ename__:!0,__constructs__:["CInt","CFloat","CString"]};Nb.CInt=function(a){a=["CInt",0,a];a.__enum__=Nb;a.toString=j;return a};Nb.CFloat=function(a){a=["CFloat",1,a];a.__enum__=Nb;a.toString=j;return a};Nb.CString=function(a){a=["CString",2,a];a.__enum__=Nb;a.toString=j;return a};Nb.__empty_constructs__=[];var x=h["hscript.Expr"]={__ename__:!0,
__constructs__:"EConst,EIdent,EVar,EParent,EBlock,EField,EBinop,EUnop,ECall,EIf,EWhile,EFor,EBreak,EContinue,EFunction,EReturn,EArray,EArrayDecl,ENew,EThrow,ETry,EObject,ETernary,ESwitch".split(",")};x.EConst=function(a){a=["EConst",0,a];a.__enum__=x;a.toString=j;return a};x.EIdent=function(a){a=["EIdent",1,a];a.__enum__=x;a.toString=j;return a};x.EVar=function(a,b,c){a=["EVar",2,a,b,c];a.__enum__=x;a.toString=j;return a};x.EParent=function(a){a=["EParent",3,a];a.__enum__=x;a.toString=j;return a};
x.EBlock=function(a){a=["EBlock",4,a];a.__enum__=x;a.toString=j;return a};x.EField=function(a,b){var c=["EField",5,a,b];c.__enum__=x;c.toString=j;return c};x.EBinop=function(a,b,c){a=["EBinop",6,a,b,c];a.__enum__=x;a.toString=j;return a};x.EUnop=function(a,b,c){a=["EUnop",7,a,b,c];a.__enum__=x;a.toString=j;return a};x.ECall=function(a,b){var c=["ECall",8,a,b];c.__enum__=x;c.toString=j;return c};x.EIf=function(a,b,c){a=["EIf",9,a,b,c];a.__enum__=x;a.toString=j;return a};x.EWhile=function(a,b){var c=
["EWhile",10,a,b];c.__enum__=x;c.toString=j;return c};x.EFor=function(a,b,c){a=["EFor",11,a,b,c];a.__enum__=x;a.toString=j;return a};x.EBreak=["EBreak",12];x.EBreak.toString=j;x.EBreak.__enum__=x;x.EContinue=["EContinue",13];x.EContinue.toString=j;x.EContinue.__enum__=x;x.EFunction=function(a,b,c,d){a=["EFunction",14,a,b,c,d];a.__enum__=x;a.toString=j;return a};x.EReturn=function(a){a=["EReturn",15,a];a.__enum__=x;a.toString=j;return a};x.EArray=function(a,b){var c=["EArray",16,a,b];c.__enum__=x;
c.toString=j;return c};x.EArrayDecl=function(a){a=["EArrayDecl",17,a];a.__enum__=x;a.toString=j;return a};x.ENew=function(a,b){var c=["ENew",18,a,b];c.__enum__=x;c.toString=j;return c};x.EThrow=function(a){a=["EThrow",19,a];a.__enum__=x;a.toString=j;return a};x.ETry=function(a,b,c,d){a=["ETry",20,a,b,c,d];a.__enum__=x;a.toString=j;return a};x.EObject=function(a){a=["EObject",21,a];a.__enum__=x;a.toString=j;return a};x.ETernary=function(a,b,c){a=["ETernary",22,a,b,c];a.__enum__=x;a.toString=j;return a};
x.ESwitch=function(a,b,c){a=["ESwitch",23,a,b,c];a.__enum__=x;a.toString=j;return a};x.__empty_constructs__=[x.EBreak,x.EContinue];var Tc=h["hscript.CType"]={__ename__:!0,__constructs__:["CTPath","CTFun","CTAnon","CTParent"]};Tc.CTPath=function(a,b){var c=["CTPath",0,a,b];c.__enum__=Tc;c.toString=j;return c};Tc.CTFun=function(a,b){var c=["CTFun",1,a,b];c.__enum__=Tc;c.toString=j;return c};Tc.CTAnon=function(a){a=["CTAnon",2,a];a.__enum__=Tc;a.toString=j;return a};Tc.CTParent=function(a){a=["CTParent",
3,a];a.__enum__=Tc;a.toString=j;return a};Tc.__empty_constructs__=[];var V=h["hscript.Error"]={__ename__:!0,__constructs__:"EInvalidChar,EUnexpected,EUnterminatedString,EUnterminatedComment,EUnknownVariable,EInvalidIterator,EInvalidOp,EInvalidAccess".split(",")};V.EInvalidChar=function(a){a=["EInvalidChar",0,a];a.__enum__=V;a.toString=j;return a};V.EUnexpected=function(a){a=["EUnexpected",1,a];a.__enum__=V;a.toString=j;return a};V.EUnterminatedString=["EUnterminatedString",2];V.EUnterminatedString.toString=
j;V.EUnterminatedString.__enum__=V;V.EUnterminatedComment=["EUnterminatedComment",3];V.EUnterminatedComment.toString=j;V.EUnterminatedComment.__enum__=V;V.EUnknownVariable=function(a){a=["EUnknownVariable",4,a];a.__enum__=V;a.toString=j;return a};V.EInvalidIterator=function(a){a=["EInvalidIterator",5,a];a.__enum__=V;a.toString=j;return a};V.EInvalidOp=function(a){a=["EInvalidOp",6,a];a.__enum__=V;a.toString=j;return a};V.EInvalidAccess=function(a){a=["EInvalidAccess",7,a];a.__enum__=V;a.toString=
j;return a};V.__empty_constructs__=[V.EUnterminatedString,V.EUnterminatedComment];var u=h["hscript.Token"]={__ename__:!0,__constructs__:"TEof,TConst,TId,TOp,TPOpen,TPClose,TBrOpen,TBrClose,TDot,TComma,TSemicolon,TBkOpen,TBkClose,TQuestion,TDoubleDot".split(",")};u.TEof=["TEof",0];u.TEof.toString=j;u.TEof.__enum__=u;u.TConst=function(a){a=["TConst",1,a];a.__enum__=u;a.toString=j;return a};u.TId=function(a){a=["TId",2,a];a.__enum__=u;a.toString=j;return a};u.TOp=function(a){a=["TOp",3,a];a.__enum__=
u;a.toString=j;return a};u.TPOpen=["TPOpen",4];u.TPOpen.toString=j;u.TPOpen.__enum__=u;u.TPClose=["TPClose",5];u.TPClose.toString=j;u.TPClose.__enum__=u;u.TBrOpen=["TBrOpen",6];u.TBrOpen.toString=j;u.TBrOpen.__enum__=u;u.TBrClose=["TBrClose",7];u.TBrClose.toString=j;u.TBrClose.__enum__=u;u.TDot=["TDot",8];u.TDot.toString=j;u.TDot.__enum__=u;u.TComma=["TComma",9];u.TComma.toString=j;u.TComma.__enum__=u;u.TSemicolon=["TSemicolon",10];u.TSemicolon.toString=j;u.TSemicolon.__enum__=u;u.TBkOpen=["TBkOpen",
11];u.TBkOpen.toString=j;u.TBkOpen.__enum__=u;u.TBkClose=["TBkClose",12];u.TBkClose.toString=j;u.TBkClose.__enum__=u;u.TQuestion=["TQuestion",13];u.TQuestion.toString=j;u.TQuestion.__enum__=u;u.TDoubleDot=["TDoubleDot",14];u.TDoubleDot.toString=j;u.TDoubleDot.__enum__=u;u.__empty_constructs__=[u.TEof,u.TPOpen,u.TPClose,u.TBrOpen,u.TBrClose,u.TDot,u.TComma,u.TSemicolon,u.TBkOpen,u.TBkClose,u.TQuestion,u.TDoubleDot];var Ci=function(){this.uid=0;this.line=1;this.opChars="+*/-=!><&|^%~";this.identChars=
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_";var a=[["%"],["*","/"],["+","-"],["<<",">>",">>>"],["|","&","^"],"==,!=,>,<,>=,<=".split(","),["..."],["&&"],["||"],"=,+=,-=,*=,/=,%=,<<=,>>=,>>>=,|=,&=,^=".split(",")];this.opPriority=new D;this.opRightAssoc=new D;this.unops=new D;for(var b=0,c=a.length;b<c;)for(var d=b++,e=0,i=a[d];e<i.length;){var m=i[e];++e;this.opPriority.set(m,d);9==d&&this.opRightAssoc.set(m,!0)}a=0;for(b=["!","++","--","-","~"];a<b.length;)c=b[a],++a,this.unops.set(c,
"++"==c||"--"==c)};h["hscript.Parser"]=Ci;Ci.__name__=!0;Ci.prototype={error:function(a){throw new p(a);},invalidChar:function(a){this.error(V.EInvalidChar(a),0,0)},parseString:function(a){this.line=1;this.uid=0;return this.parse(new eg(a))},parse:function(a){this.tokens=new ui;this["char"]=-1;this.input=a;this.ops=[];this.idents=[];for(var a=0,b=this.opChars.length;a<b;){var c=a++;this.ops[E.cca(this.opChars,c)]=!0}a=0;for(b=this.identChars.length;a<b;)c=a++,this.idents[E.cca(this.identChars,c)]=
!0;for(a=[];;){b=this.token();if(b==u.TEof)break;this.tokens.add(b);a.push(this.parseFullExpr())}return 1==a.length?a[0]:this.mk(x.EBlock(a),0,null)},unexpected:function(a){this.error(V.EUnexpected(this.tokenString(a)),0,0);return null},push:function(a){this.tokens.add(a)},ensure:function(a){var b=this.token();b!=a&&this.unexpected(b)},mk:function(a){return a},isBlock:function(a){switch(a[1]){case 4:case 21:case 23:return!0;case 14:return this.isBlock(a[3]);case 2:return a=a[4],null!=a&&this.isBlock(a);
case 9:var b=a[4],a=a[3];return null!=b?this.isBlock(b):this.isBlock(a);case 6:return this.isBlock(a[4]);case 7:return b=a[4],!a[3]&&this.isBlock(b);case 10:return this.isBlock(a[3]);case 11:return this.isBlock(a[4]);case 15:return a=a[2],null!=a&&this.isBlock(a);case 20:return this.isBlock(a[5]);default:return!1}},parseFullExpr:function(){var a=this.parseExpr(),b=this.token();b!=u.TSemicolon&&b!=u.TEof&&(this.isBlock(a)?this.tokens.add(b):this.unexpected(b));return a},parseObject:function(a){var b=
[];try{for(;;){var c=this.token(),d=null;switch(c[1]){case 2:d=c[2];break;case 1:var e=c[2];this.allowJSON||this.unexpected(c);switch(e[1]){case 2:d=e[2];break;default:this.unexpected(c)}break;case 7:throw"__break__";default:this.unexpected(c)}this.ensure(u.TDoubleDot);b.push({name:d,e:this.parseExpr()});c=this.token();switch(c[1]){case 7:throw"__break__";case 9:break;default:this.unexpected(c)}}}catch(i){if("__break__"!=i)throw i;}return this.parseExprNext(this.mk(x.EObject(b),a,null))},parseExpr:function(){var a=
this.token();switch(a[1]){case 2:var a=a[2],b=this.parseStructure(a);null==b&&(b=this.mk(x.EIdent(a),null,null));return this.parseExprNext(b);case 1:return this.parseExprNext(this.mk(x.EConst(a[2]),null,null));case 4:return a=this.parseExpr(),this.ensure(u.TPClose),this.parseExprNext(this.mk(x.EParent(a),0,0));case 6:a=this.token();switch(a[1]){case 7:return this.parseExprNext(this.mk(x.EObject([]),0,null));case 2:b=this.token();this.tokens.add(b);this.tokens.add(a);switch(b[1]){case 14:return this.parseExprNext(this.parseObject(0))}break;
case 1:b=a[2];if(this.allowJSON)switch(b[1]){case 2:b=this.token();this.tokens.add(b);this.tokens.add(a);switch(b[1]){case 14:return this.parseExprNext(this.parseObject(0))}break;default:this.tokens.add(a)}else this.tokens.add(a);break;default:this.tokens.add(a)}for(b=[];;){b.push(this.parseFullExpr());a=this.token();if(a==u.TBrClose)break;this.tokens.add(a)}return this.mk(x.EBlock(b),0,null);case 3:return b=a[2],this.unops.exists(b)?this.makeUnop(b,this.parseExpr()):this.unexpected(a);case 11:b=
[];for(a=this.token();a!=u.TBkClose;)this.tokens.add(a),b.push(this.parseExpr()),a=this.token(),a==u.TComma&&(a=this.token());if(1==b.length)switch(b[0][1]){case 11:case 10:return a="__a_"+this.uid++,this.parseExprNext(this.mk(x.EBlock([this.mk(x.EVar(a,null,this.mk(x.EArrayDecl([]),0,null)),0,null),this.mapCompr(a,b[0]),this.mk(x.EIdent(a),0,null)]),0,null))}return this.parseExprNext(this.mk(x.EArrayDecl(b),0,null));default:return this.unexpected(a)}},mapCompr:function(a,b){var c;switch(b[1]){case 11:c=
x.EFor(b[2],b[3],this.mapCompr(a,b[4]));break;case 10:c=x.EWhile(b[2],this.mapCompr(a,b[3]));break;case 9:c=b[3];var d=b[2];c=null==b[4]?x.EIf(d,this.mapCompr(a,c),null):x.ECall(this.mk(x.EField(this.mk(x.EIdent(a),0,0),"push"),0,0),[b]);break;case 4:switch(b[2].length){case 1:c=x.EBlock([this.mapCompr(a,b[2][0])]);break;default:c=x.ECall(this.mk(x.EField(this.mk(x.EIdent(a),0,0),"push"),0,0),[b])}break;case 3:c=x.EParent(this.mapCompr(a,b[2]));break;default:c=x.ECall(this.mk(x.EField(this.mk(x.EIdent(a),
0,0),"push"),0,0),[b])}return c},makeUnop:function(a,b){switch(b[1]){case 6:var c=b[4];return this.mk(x.EBinop(b[2],this.makeUnop(a,b[3]),c),0,0);case 22:var c=b[4],d=b[3];return this.mk(x.ETernary(this.makeUnop(a,b[2]),d,c),0,0);default:return this.mk(x.EUnop(a,!0,b),0,0)}},makeBinop:function(a,b,c){switch(c[1]){case 6:var d=c[4],e=c[3],i=c[2];return this.opPriority.get(a)<=this.opPriority.get(i)&&!this.opRightAssoc.exists(a)?this.mk(x.EBinop(i,this.makeBinop(a,b,e),d),0,0):this.mk(x.EBinop(a,b,
c),0,0);case 22:return d=c[4],e=c[3],i=c[2],this.opRightAssoc.exists(a)?this.mk(x.EBinop(a,b,c),0,0):this.mk(x.ETernary(this.makeBinop(a,b,i),e,d),0,0);default:return this.mk(x.EBinop(a,b,c),0,0)}},parseStructure:function(a){switch(a){case "if":this.ensure(u.TPOpen);var b=this.parseExpr();this.ensure(u.TPClose);var c=this.parseExpr(),a=null,d=!1,e=this.token();e==u.TSemicolon&&(d=!0,e=this.token());Ua.enumEq(e,u.TId("else"))?a=this.parseExpr():(this.tokens.add(e),d&&this.tokens.add(u.TSemicolon));
return this.mk(x.EIf(b,c,a),0,null==a?0:0);case "var":b=this.token();c=null;switch(b[1]){case 2:c=b[2];break;default:this.unexpected(b)}b=this.token();a=null;b==u.TDoubleDot&&this.allowTypes&&(a=this.parseType(),b=this.token());d=null;Ua.enumEq(b,u.TOp("="))?d=this.parseExpr():this.tokens.add(b);return this.mk(x.EVar(c,a,d),0,null==d?0:0);case "while":return b=this.parseExpr(),c=this.parseExpr(),this.mk(x.EWhile(b,c),0,0);case "for":this.ensure(u.TPOpen);c=this.token();b=null;switch(c[1]){case 2:b=
c[2];break;default:this.unexpected(c)}c=this.token();Ua.enumEq(c,u.TId("in"))||this.unexpected(c);c=this.parseExpr();this.ensure(u.TPClose);a=this.parseExpr();return this.mk(x.EFor(b,c,a),0,0);case "break":return x.EBreak;case "continue":return x.EContinue;case "else":return this.unexpected(u.TId(a));case "function":a=this.token();b=null;switch(a[1]){case 2:b=a[2];break;default:this.tokens.add(a)}this.ensure(u.TPOpen);c=[];a=this.token();if(a!=u.TPClose)for(d=!1;!d;){var i=null,e=!1;switch(a[1]){case 13:e=
!0,a=this.token()}switch(a[1]){case 2:i=a[2];break;default:this.unexpected(a)}a=this.token();i={name:i};c.push(i);e&&(i.opt=!0);a==u.TDoubleDot&&this.allowTypes&&(i.t=this.parseType(),a=this.token());switch(a[1]){case 9:a=this.token();break;case 5:d=!0;break;default:this.unexpected(a)}}d=null;this.allowTypes&&(a=this.token(),a!=u.TDoubleDot?this.tokens.add(a):d=this.parseType());a=this.parseExpr();return this.mk(x.EFunction(c,a,b,d),0,0);case "return":return b=this.token(),this.tokens.add(b),b=b==
u.TSemicolon?null:this.parseExpr(),this.mk(x.EReturn(b),0,null==b?0:0);case "new":b=[];c=this.token();switch(c[1]){case 2:b.push(c[2]);break;default:this.unexpected(c)}for(a=!0;a;)switch(c=this.token(),c[1]){case 8:c=this.token();switch(c[1]){case 2:b.push(c[2]);break;default:this.unexpected(c)}break;case 4:a=!1;break;default:this.unexpected(c)}c=this.parseExprList(u.TPClose);return this.mk(x.ENew(b.join("."),c),0,null);case "throw":return b=this.parseExpr(),this.mk(x.EThrow(b),0,0);case "try":b=
this.parseExpr();d=this.token();Ua.enumEq(d,u.TId("catch"))||this.unexpected(d);this.ensure(u.TPOpen);d=this.token();switch(d[1]){case 2:c=d[2];break;default:c=this.unexpected(d)}this.ensure(u.TDoubleDot);a=null;this.allowTypes?a=this.parseType():(d=this.token(),Ua.enumEq(d,u.TId("Dynamic"))||this.unexpected(d));this.ensure(u.TPClose);d=this.parseExpr();return this.mk(x.ETry(b,c,a,d),0,0);case "switch":a=this.parseExpr();d=null;e=[];this.ensure(u.TBrOpen);try{for(;;)switch(b=this.token(),b[1]){case 2:switch(b[2]){case "case":i=
{values:[],expr:null};e.push(i);try{for(;;)switch(c=this.parseExpr(),i.values.push(c),b=this.token(),b[1]){case 9:break;case 14:throw"__break__";default:this.unexpected(b)}}catch(m){if("__break__"!=m)throw m;}var f=[];try{for(;;)switch(b=this.token(),this.tokens.add(b),b[1]){case 2:switch(b[2]){case "case":case "default":throw"__break__";default:f.push(this.parseFullExpr())}break;case 7:throw"__break__";default:f.push(this.parseFullExpr())}}catch(r){if("__break__"!=r)throw r;}i.expr=1==f.length?f[0]:
0==f.length?this.mk(x.EBlock([]),0,0):this.mk(x.EBlock(f),0,0);break;case "default":null!=d&&this.unexpected(b);this.ensure(u.TDoubleDot);i=[];try{for(;;)switch(b=this.token(),this.tokens.add(b),b[1]){case 2:switch(b[2]){case "case":case "default":throw"__break__";default:i.push(this.parseFullExpr())}break;case 7:throw"__break__";default:i.push(this.parseFullExpr())}}catch(g){if("__break__"!=g)throw g;}d=1==i.length?i[0]:0==i.length?this.mk(x.EBlock([]),0,0):this.mk(x.EBlock(i),0,0);break;default:this.unexpected(b)}break;
case 7:throw"__break__";default:this.unexpected(b)}}catch(h){if("__break__"!=h)throw h;}return this.mk(x.ESwitch(a,e,d),0,0);default:return null}},parseExprNext:function(a){var b=this.token();switch(b[1]){case 3:var c=b[2];if(this.unops.get(c)){var d;if(!(d=this.isBlock(a)))switch(a[1]){case 3:d=!0;break;default:d=!1}return d?(this.tokens.add(b),a):this.parseExprNext(this.mk(x.EUnop(c,!1,a),0,null))}return this.makeBinop(c,a,this.parseExpr());case 8:b=this.token();c=null;switch(b[1]){case 2:c=b[2];
break;default:this.unexpected(b)}return this.parseExprNext(this.mk(x.EField(a,c),0,null));case 4:return this.parseExprNext(this.mk(x.ECall(a,this.parseExprList(u.TPClose)),0,null));case 11:return b=this.parseExpr(),this.ensure(u.TBkClose),this.parseExprNext(this.mk(x.EArray(a,b),0,null));case 13:return b=this.parseExpr(),this.ensure(u.TDoubleDot),c=this.parseExpr(),this.mk(x.ETernary(a,b,c),0,0);default:return this.tokens.add(b),a}},parseType:function(){var a=this.token();switch(a[1]){case 2:for(var b=
[a[2]];;){a=this.token();if(a!=u.TDot)break;a=this.token();switch(a[1]){case 2:b.push(a[2]);break;default:this.unexpected(a)}}var c=null;switch(a[1]){case 3:if("<"==a[2]){c=[];try{for(;;){c.push(this.parseType());a=this.token();switch(a[1]){case 9:continue;case 3:if(">"==a[2])throw"__break__";}this.unexpected(a)}}catch(d){if("__break__"!=d)throw d;}}else this.tokens.add(a);break;default:this.tokens.add(a)}return this.parseTypeNext(Tc.CTPath(b,c));case 4:return a=this.parseType(),this.ensure(u.TPClose),
this.parseTypeNext(Tc.CTParent(a));case 6:b=[];try{for(;;)switch(a=this.token(),a[1]){case 7:throw"__break__";case 2:c=a[2];this.ensure(u.TDoubleDot);b.push({name:c,t:this.parseType()});a=this.token();switch(a[1]){case 9:break;case 7:throw"__break__";default:this.unexpected(a)}break;default:this.unexpected(a)}}catch(e){if("__break__"!=e)throw e;}return this.parseTypeNext(Tc.CTAnon(b));default:return this.unexpected(a)}},parseTypeNext:function(a){var b=this.token();switch(b[1]){case 3:if("->"!=b[2])return this.tokens.add(b),
a;break;default:return this.tokens.add(b),a}b=this.parseType();switch(b[1]){case 1:return b[2].unshift(a),b;default:return Tc.CTFun([a],b)}},parseExprList:function(a){var b=[],c=this.token();if(c==a)return b;this.tokens.add(c);try{for(;;)switch(b.push(this.parseExpr()),c=this.token(),c[1]){case 9:break;default:if(c==a)throw"__break__";this.unexpected(c)}}catch(d){if("__break__"!=d)throw d;}return b},readChar:function(){try{return this.input.readByte()}catch(a){return a instanceof p&&(a=a.val),0}},
readString:function(a){for(var b=0,c=new dg,d=!1,e=this.line,i=this.input;;){try{b=i.readByte()}catch(m){throw m instanceof p&&(m=m.val),this.line=e,new p(V.EUnterminatedString);}if(d)switch(d=!1,b){case 110:c.writeByte(10);break;case 114:c.writeByte(13);break;case 116:c.writeByte(9);break;case 39:case 34:case 92:c.writeByte(b);break;case 47:this.allowJSON?c.writeByte(b):this.invalidChar(b);break;case 117:if(!this.allowJSON)throw new p(this.invalidChar(b));var f=null;try{f=i.readString(4)}catch(r){throw r instanceof
p&&(r=r.val),this.line=e,new p(V.EUnterminatedString);}for(var g=0,h=0;4>h;){var j=h++,g=g<<4,j=E.cca(f,j);if(null!=j)switch(j){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:g+=j-48;break;case 65:case 66:case 67:case 68:case 69:case 70:g+=j-55;break;case 97:case 98:case 99:case 100:case 101:case 102:g+=j-87;break;default:this.invalidChar(j)}else this.invalidChar(j)}127>=g?c.writeByte(g):(2047>=g?c.writeByte(192|g>>6):(c.writeByte(224|g>>12),c.writeByte(128|g>>6&63)),
c.writeByte(128|g&63));break;default:this.invalidChar(b)}else if(92==b)d=!0;else if(b==a)break;else 10==b&&this.line++,c.writeByte(b)}return c.getBytes().toString()},token:function(){if(null!=this.tokens.head)return this.tokens.pop();var a;0>this["char"]?a=this.readChar():(a=this["char"],this["char"]=-1);for(;;){switch(a){case 0:return u.TEof;case 32:case 9:case 13:break;case 10:this.line++;break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:for(var b=1*(a-48),c=
0;;)switch(a=this.readChar(),c*=10,a){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:b=10*b+(a-48);break;case 46:if(0<c){if(10==c&&46==this.readChar())return this.push(u.TOp("...")),a=b|0,u.TConst(a==b?Nb.CInt(a):Nb.CFloat(b));this.invalidChar(a)}c=1;break;case 120:(0<b||0<c)&&this.invalidChar(a);for(var d=0;;)switch(a=this.readChar(),a){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:d=(d<<4)+a-48;break;case 65:case 66:case 67:case 68:case 69:case 70:d=
(d<<4)+(a-55);break;case 97:case 98:case 99:case 100:case 101:case 102:d=(d<<4)+(a-87);break;default:return this["char"]=a,u.TConst(Nb.CInt(d))}break;default:return this["char"]=a,a=b|0,u.TConst(0<c?Nb.CFloat(10*b/c):a==b?Nb.CInt(a):Nb.CFloat(b))}break;case 59:return u.TSemicolon;case 40:return u.TPOpen;case 41:return u.TPClose;case 44:return u.TComma;case 46:a=this.readChar();switch(a){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:b=a-48;for(c=1;;)switch(a=this.readChar(),
c*=10,a){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:b=10*b+(a-48);break;default:return this["char"]=a,u.TConst(Nb.CFloat(b/c))}break;case 46:return a=this.readChar(),46!=a&&this.invalidChar(a),u.TOp("...");default:return this["char"]=a,u.TDot}break;case 123:return u.TBrOpen;case 125:return u.TBrClose;case 91:return u.TBkOpen;case 93:return u.TBkClose;case 39:return u.TConst(Nb.CString(this.readString(39)));case 34:return u.TConst(Nb.CString(this.readString(34)));
case 63:return u.TQuestion;case 58:return u.TDoubleDot;default:if(this.ops[a])for(b=String.fromCharCode(a);;){a=this.readChar();if(!this.ops[a]){if(47==E.cca(b,0))return this.tokenComment(b,a);this["char"]=a;return u.TOp(b)}b+=String.fromCharCode(a)}if(this.idents[a])for(b=String.fromCharCode(a);;){a=this.readChar();if(!this.idents[a])return this["char"]=a,u.TId(b);b+=String.fromCharCode(a)}this.invalidChar(a)}a=this.readChar()}return null},tokenComment:function(a,b){var c=E.cca(a,1),d=this.input;
if(47==c){try{for(;10!=b&&13!=b;)b=d.readByte();this["char"]=b}catch(e){e instanceof p&&(e=e.val)}return this.token()}if(42==c){c=this.line;try{for(;;){for(;42!=b;)10==b&&this.line++,b=d.readByte();b=d.readByte();if(47==b)break}}catch(i){throw i instanceof p&&(i=i.val),this.line=c,new p(V.EUnterminatedComment);}return this.token()}this["char"]=b;return u.TOp(a)},constString:function(a){switch(a[1]){case 0:return a=a[2],null==a?"null":""+a;case 1:return a=a[2],null==a?"null":""+a;case 2:return a[2]}},
tokenString:function(a){switch(a[1]){case 0:return"<eof>";case 1:return this.constString(a[2]);case 2:return a[2];case 3:return a[2];case 4:return"(";case 5:return")";case 6:return"{";case 7:return"}";case 8:return".";case 9:return",";case 10:return";";case 11:return"[";case 12:return"]";case 13:return"?";case 14:return":"}},__class__:Ci};var p=function(a){Error.call(this);this.val=a;this.message=""+a;Error.captureStackTrace&&Error.captureStackTrace(this,p)};h["js._Boot.HaxeError"]=p;p.__name__=!0;
p.__super__=Error;p.prototype=v(Error.prototype,{__class__:p});var A=function(){};h["js.Boot"]=A;A.__name__=!0;A.__unhtml=function(a){return a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")};A.__trace=function(a,b){var c;c=null!=b?b.fileName+":"+b.lineNumber+": ":"";c+=A.__string_rec(a,"");if(null!=b&&null!=b.customParams)for(var d=0,e=b.customParams;d<e.length;){var i=e[d];++d;c+=","+A.__string_rec(i,"")}var m;"undefined"!=typeof document&&null!=(m=document.getElementById("haxe:trace"))?
m.innerHTML+=A.__unhtml(c)+"<br/>":"undefined"!=typeof console&&null!=console.log&&console.log(c)};A.getClass=function(a){if(a instanceof Array&&null==a.__enum__)return Array;var b=a.__class__;if(null!=b)return b;a=A.__nativeClassName(a);return null!=a?A.__resolveNativeClass(a):null};A.__string_rec=function(a,b){if(null==a)return"null";if(5<=b.length)return"<...>";var c=typeof a;if("function"==c&&(a.__name__||a.__ename__))c="object";switch(c){case "object":if(a instanceof Array){if(a.__enum__){if(2==
a.length)return a[0];for(var c=a[0]+"(",b=b+"\t",d=2,e=a.length;d<e;)var i=d++,c=2!=i?c+(","+A.__string_rec(a[i],b)):c+A.__string_rec(a[i],b);return c+")"}c=a.length;d="[";b+="\t";for(e=0;e<c;)i=e++,d+=(0<i?",":"")+A.__string_rec(a[i],b);return d+"]"}try{d=a.toString}catch(m){return m instanceof p&&(m=m.val),"???"}if(null!=d&&d!=Object.toString&&"function"==typeof d&&(c=a.toString(),"[object Object]"!=c))return c;c=null;d="{\n";b+="\t";e=null!=a.hasOwnProperty;for(c in a)if(!e||a.hasOwnProperty(c))"prototype"==
c||"__class__"==c||"__super__"==c||"__interfaces__"==c||"__properties__"==c||(2!=d.length&&(d+=", \n"),d+=b+c+" : "+A.__string_rec(a[c],b));b=b.substring(1);return d+("\n"+b+"}");case "function":return"<function>";case "string":return a;default:return""+a}};A.__interfLoop=function(a,b){if(null==a)return!1;if(a==b)return!0;var c=a.__interfaces__;if(null!=c)for(var d=0,e=c.length;d<e;){var i=d++,i=c[i];if(i==b||A.__interfLoop(i,b))return!0}return A.__interfLoop(a.__super__,b)};A.__instanceof=function(a,
b){if(null==b)return!1;switch(b){case Rk:return(a|0)===a;case Lk:return"number"==typeof a;case Mk:return"boolean"==typeof a;case String:return"string"==typeof a;case Array:return a instanceof Array&&null==a.__enum__;case Sk:return!0;default:if(null!=a)if("function"==typeof b){if(a instanceof b||A.__interfLoop(A.getClass(a),b))return!0}else{if("object"==typeof b&&A.__isNativeObj(b)&&a instanceof b)return!0}else return!1;return b==Tk&&null!=a.__name__||b==Uk&&null!=a.__ename__?!0:a.__enum__==b}};A.__cast=
function(a,b){if(A.__instanceof(a,b))return a;throw new p("Cannot cast "+q.string(a)+" to "+q.string(b));};A.__nativeClassName=function(a){a=A.__toStr.call(a).slice(8,-1);return"Object"==a||"Function"==a||"Math"==a||"JSON"==a?null:a};A.__isNativeObj=function(a){return null!=A.__nativeClassName(a)};A.__resolveNativeClass=function(a){return Function("return typeof "+a+' != "undefined" ? '+a+" : null")()};var Pj=function(){};h["js.html._CanvasElement.CanvasUtil"]=Pj;Pj.__name__=!0;Pj.getContextWebGL=
function(a,b){for(var c=0,d=["webgl","experimental-webgl"];c<d.length;){var e=d[c];++c;e=a.getContext(e,b);if(null!=e)return e}return null};var id=function(a){if(a instanceof Array&&null==a.__enum__)this.a=a,this.byteLength=a.length;else{this.a=[];for(var b=0;b<a;)this.a[b++]=0;this.byteLength=a}};h["js.html.compat.ArrayBuffer"]=id;id.__name__=!0;id.sliceImpl=function(a,b){var c=new vi(this,a,null==b?null:b-a),d=new Xj(c.byteLength);(new vi(d)).set(c);return d};id.prototype={slice:function(a,b){return new id(this.a.slice(a,
b))},__class__:id};var Zj=function(a,b,c){this.buf=a;this.offset=null==b?0:b;this.length=null==c?a.byteLength-this.offset:c;if(0>this.offset||0>this.length||this.offset+this.length>a.byteLength)throw new p(la.OutsideBounds);};h["js.html.compat.DataView"]=Zj;Zj.__name__=!0;Zj.prototype={getInt8:function(a){a=this.buf.a[this.offset+a];return 128<=a?a-256:a},getUint8:function(a){return this.buf.a[this.offset+a]},getInt16:function(a,b){var c=this.getUint16(a,b);return 32768<=c?c-65536:c},getUint16:function(a,
b){return b?this.buf.a[this.offset+a]|this.buf.a[this.offset+a+1]<<8:this.buf.a[this.offset+a]<<8|this.buf.a[this.offset+a+1]},getInt32:function(a,b){var c=this.offset+a,d=this.buf.a[c++],e=this.buf.a[c++],i=this.buf.a[c++],c=this.buf.a[c++];return b?d|e<<8|i<<16|c<<24:c|i<<8|e<<16|d<<24},getUint32:function(a,b){var c=this.getInt32(a,b);return 0>c?c+4294967296:c},getFloat32:function(a,b){return Sc.i32ToFloat(this.getInt32(a,b))},getFloat64:function(a,b){var c=this.getInt32(a,b),d=this.getInt32(a+
4,b);return Sc.i64ToDouble(b?c:d,b?d:c)},setInt8:function(a,b){this.buf.a[a+this.offset]=0>b?b+128&255:b&255},setUint8:function(a,b){this.buf.a[a+this.offset]=b&255},setInt16:function(a,b,c){this.setUint16(a,0>b?b+65536:b,c)},setUint16:function(a,b,c){a+=this.offset;c?(this.buf.a[a]=b&255,this.buf.a[a++]=b>>8&255):(this.buf.a[a++]=b>>8&255,this.buf.a[a]=b&255)},setInt32:function(a,b,c){this.setUint32(a,b,c)},setUint32:function(a,b,c){a+=this.offset;c?(this.buf.a[a++]=b&255,this.buf.a[a++]=b>>8&255,
this.buf.a[a++]=b>>16&255,this.buf.a[a++]=b>>>24):(this.buf.a[a++]=b>>>24,this.buf.a[a++]=b>>16&255,this.buf.a[a++]=b>>8&255,this.buf.a[a++]=b&255)},setFloat32:function(a,b,c){this.setUint32(a,Sc.floatToI32(b),c)},setFloat64:function(a,b,c){b=Sc.doubleToI64(b);c?(this.setUint32(a,b.low),this.setUint32(a,b.high)):(this.setUint32(a,b.high),this.setUint32(a,b.low))},__class__:Zj};var Ld=function(){};h["js.html.compat.Uint8Array"]=Ld;Ld.__name__=!0;Ld._new=function(a,b,c){if("number"==typeof a){c=[];
for(b=0;b<a;){var d=b++;c[d]=0}c.byteLength=c.length;c.byteOffset=0;c.buffer=new id(c)}else if(A.__instanceof(a,id))null==b&&(b=0),null==c&&(c=a.byteLength-b),c=0==b?a.a:a.a.slice(b,b+c),c.byteLength=c.length,c.byteOffset=b,c.buffer=a;else if(a instanceof Array&&null==a.__enum__)c=a.slice(),c.byteLength=c.length,c.byteOffset=0,c.buffer=new id(c);else throw new p("TODO "+q.string(a));c.subarray=Ld._subarray;c.set=Ld._set;return c};Ld._set=function(a,b){if(A.__instanceof(a.buffer,id)){if(a.byteLength+
b>this.byteLength)throw new p("set() outside of range");for(var c=0,d=a.byteLength;c<d;){var e=c++;this[e+b]=a[e]}}else if(a instanceof Array&&null==a.__enum__){if(a.length+b>this.byteLength)throw new p("set() outside of range");c=0;for(d=a.length;c<d;)e=c++,this[e+b]=a[e]}else throw new p("TODO");};Ld._subarray=function(a,b){var c=Ld._new(this.slice(a,b));c.byteOffset=a;return c};var t=function(){};h["nape.Config"]=t;t.__name__=!0;var jd=function(){this.zpp_inner=null};h["nape.callbacks.Callback"]=
jd;jd.__name__=!0;jd.prototype={toString:function(){return""},__class__:jd};var fg=function(){this.zpp_inner=null};h["nape.callbacks.BodyCallback"]=fg;fg.__name__=!0;fg.__super__=jd;fg.prototype=v(jd.prototype,{toString:function(){var a;a="Cb:"+["WAKE","SLEEP"][this.zpp_inner.event-f.id_CbEvent_WAKE];a+=":"+this.zpp_inner.body.outer.toString();return a+=" : listener: "+q.string(this.zpp_inner.listener.outer)},__class__:fg});var wc=function(){this.zpp_inner=null};h["nape.callbacks.Listener"]=wc;wc.__name__=
!0;wc.prototype={toString:function(){var a="BEGIN,END,WAKE,SLEEP,BREAK,PRE,ONGOING".split(",")[this.zpp_inner.event];if(this.zpp_inner.type==f.id_ListenerType_BODY)return"BodyListener{"+a+"::"+q.string(this.zpp_inner.body.outer_zn.zpp_inner_zn.options.outer)+"}";if(this.zpp_inner.type==f.id_ListenerType_CONSTRAINT)return"ConstraintListener{"+a+"::"+q.string(this.zpp_inner.constraint.outer_zn.zpp_inner_zn.options.outer)+"}";var b=this.zpp_inner.interaction,c;switch(b.itype){case 1:c="COLLISION";break;
case 2:c="SENSOR";break;case 4:c="FLUID";break;default:c="ALL"}return(this.zpp_inner.type==f.id_ListenerType_INTERACTION?"InteractionListener{"+a+"#"+c+"::"+q.string(b.outer_zni.zpp_inner_zn.options1.outer)+":"+q.string(b.outer_zni.zpp_inner_zn.options2.outer)+"}":"PreListener{"+c+"::"+q.string(b.outer_znp.zpp_inner_zn.options1.outer)+":"+q.string(b.outer_znp.zpp_inner_zn.options2.outer)+"}")+" precedence="+this.zpp_inner.precedence},__class__:wc};var Di=function(){this.zpp_inner_zn=null};h["nape.callbacks.BodyListener"]=
Di;Di.__name__=!0;Di.__super__=wc;Di.prototype=v(wc.prototype,{__class__:Di});var Ra=function(){};h["nape.callbacks.CbEvent"]=Ra;Ra.__name__=!0;Ra.prototype={toString:function(){var a;null==f.CbEvent_PRE&&(f.internal=!0,f.CbEvent_PRE=new Ra,f.internal=!1);this==f.CbEvent_PRE?a="PRE":(null==f.CbEvent_BEGIN&&(f.internal=!0,f.CbEvent_BEGIN=new Ra,f.internal=!1),this==f.CbEvent_BEGIN?a="BEGIN":(null==f.CbEvent_ONGOING&&(f.internal=!0,f.CbEvent_ONGOING=new Ra,f.internal=!1),this==f.CbEvent_ONGOING?a="ONGOING":
(null==f.CbEvent_END&&(f.internal=!0,f.CbEvent_END=new Ra,f.internal=!1),this==f.CbEvent_END?a="END":(null==f.CbEvent_WAKE&&(f.internal=!0,f.CbEvent_WAKE=new Ra,f.internal=!1),this==f.CbEvent_WAKE?a="WAKE":(null==f.CbEvent_SLEEP&&(f.internal=!0,f.CbEvent_SLEEP=new Ra,f.internal=!1),this==f.CbEvent_SLEEP?a="SLEEP":(null==f.CbEvent_BREAK&&(f.internal=!0,f.CbEvent_BREAK=new Ra,f.internal=!1),a=this==f.CbEvent_BREAK?"BREAK":""))))));return a},__class__:Ra};var Md=function(){this.zpp_inner=null;this.zpp_inner=
new qa;this.zpp_inner.outer=this};h["nape.callbacks.CbType"]=Md;Md.__name__=!0;Md.prototype={toString:function(){return this==qa.ANY_BODY?"ANY_BODY":this==qa.ANY_SHAPE?"ANY_SHAPE":this==qa.ANY_COMPOUND?"ANY_COMPOUND":this==qa.ANY_CONSTRAINT?"ANY_CONSTRAINT":"CbType#"+this.zpp_inner.id},__class__:Md};var fc=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.callbacks.CbTypeIterator"]=fc;fc.__name__=!0;fc.get=function(a){var b;null==fc.zpp_pool?(xc.internal=
!0,b=new fc,xc.internal=!1):(b=fc.zpp_pool,fc.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};fc.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=fc.zpp_pool;fc.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:fc};var gg=function(){this.zpp_inner=null;this.zpp_inner=new xc;this.zpp_inner.outer=
this};h["nape.callbacks.CbTypeList"]=gg;gg.__name__=!0;gg.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=
a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,
a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,
a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=fc.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:gg,__properties__:{get_length:"get_length"}};var hg=
function(){this.zpp_inner=null};h["nape.callbacks.ConstraintCallback"]=hg;hg.__name__=!0;hg.__super__=jd;hg.prototype=v(jd.prototype,{toString:function(){var a;a="Cb:"+["WAKE","SLEEP","BREAK"][this.zpp_inner.event-f.id_CbEvent_WAKE];a+=":"+this.zpp_inner.constraint.outer.toString();return a+=" : listener: "+q.string(this.zpp_inner.listener.outer)},__class__:hg});var Ei=function(){this.zpp_inner_zn=null};h["nape.callbacks.ConstraintListener"]=Ei;Ei.__name__=!0;Ei.__super__=wc;Ei.prototype=v(wc.prototype,
{__class__:Ei});var ig=function(){this.zpp_inner=null};h["nape.callbacks.InteractionCallback"]=ig;ig.__name__=!0;ig.__super__=jd;ig.prototype=v(jd.prototype,{toString:function(){var a;a="Cb:"+"BEGIN,END,,,,,ONGOING".split(",")[this.zpp_inner.event];a+=":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString();a+=" : "+this.zpp_inner.wrap_arbiters.toString();return a+=" : listener: "+q.string(this.zpp_inner.listener.outer)},__class__:ig});var Uc=function(a,b,c,d,e,i){null==
i&&(i=0);this.zpp_inner=this.zpp_inner_zn=null;var m=-1;null==f.CbEvent_BEGIN&&(f.internal=!0,f.CbEvent_BEGIN=new Ra,f.internal=!1);a==f.CbEvent_BEGIN?m=f.id_CbEvent_BEGIN:(null==f.CbEvent_END&&(f.internal=!0,f.CbEvent_END=new Ra,f.internal=!1),a==f.CbEvent_END?m=f.id_CbEvent_END:(null==f.CbEvent_ONGOING&&(f.internal=!0,f.CbEvent_ONGOING=new Ra,f.internal=!1),a==f.CbEvent_ONGOING&&(m=f.id_CbEvent_ONGOING)));this.zpp_inner=this.zpp_inner_zn=new cb(Nd.argument(c),Nd.argument(d),m,f.id_ListenerType_INTERACTION);
this.zpp_inner.outer=this;this.zpp_inner_zn.outer_zni=this;this.zpp_inner.precedence=i;this.zpp_inner_zn.handleri=e;this.set_interactionType(b)};h["nape.callbacks.InteractionListener"]=Uc;Uc.__name__=!0;Uc.__super__=wc;Uc.prototype=v(wc.prototype,{get_interactionType:function(){var a=this.zpp_inner_zn.itype;if(a==f.id_InteractionType_COLLISION)return null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new oa,f.internal=!1),f.InteractionType_COLLISION;if(a==f.id_InteractionType_SENSOR)return null==
f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new oa,f.internal=!1),f.InteractionType_SENSOR;if(a==f.id_InteractionType_FLUID)return null==f.InteractionType_FLUID&&(f.internal=!0,f.InteractionType_FLUID=new oa,f.internal=!1),f.InteractionType_FLUID;return a==f.id_InteractionType_ANY?(null==f.InteractionType_ANY&&(f.internal=!0,f.InteractionType_ANY=new oa,f.internal=!1),f.InteractionType_ANY):null},set_interactionType:function(a){if(this.get_interactionType()!=a){var b=this.zpp_inner_zn;
null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new oa,f.internal=!1);a==f.InteractionType_COLLISION?a=f.id_InteractionType_COLLISION:(null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new oa,f.internal=!1),a==f.InteractionType_SENSOR?a=f.id_InteractionType_SENSOR:(null==f.InteractionType_FLUID&&(f.internal=!0,f.InteractionType_FLUID=new oa,f.internal=!1),a=a==f.InteractionType_FLUID?f.id_InteractionType_FLUID:f.id_InteractionType_ANY));b.itype=
a}return this.get_interactionType()},__class__:Uc,__properties__:{set_interactionType:"set_interactionType",get_interactionType:"get_interactionType"}});var oa=function(){};h["nape.callbacks.InteractionType"]=oa;oa.__name__=!0;oa.prototype={toString:function(){var a;null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new oa,f.internal=!1);this==f.InteractionType_COLLISION?a="COLLISION":(null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new oa,f.internal=
!1),this==f.InteractionType_SENSOR?a="SENSOR":(null==f.InteractionType_FLUID&&(f.internal=!0,f.InteractionType_FLUID=new oa,f.internal=!1),this==f.InteractionType_FLUID?a="FLUID":(null==f.InteractionType_ANY&&(f.internal=!0,f.InteractionType_ANY=new oa,f.internal=!1),a=this==f.InteractionType_ANY?"ANY":"")));return a},__class__:oa};var Vc=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.callbacks.ListenerIterator"]=Vc;Vc.__name__=!0;Vc.get=function(a){var b;
null==Vc.zpp_pool?(Od.internal=!0,b=new Vc,Od.internal=!1):(b=Vc.zpp_pool,Vc.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Vc.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Vc.zpp_pool;Vc.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Vc};var Fi=function(){this.zpp_inner=null;this.zpp_inner=
new Od;this.zpp_inner.outer=this};h["nape.callbacks.ListenerList"]=Fi;Fi.__name__=!0;Fi.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);
else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),
this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-
1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},remove:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&
this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=Vc.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:Fi,__properties__:{get_length:"get_length"}};var Dd=function(){};h["nape.callbacks.ListenerType"]=Dd;Dd.__name__=!0;Dd.prototype={toString:function(){var a;
null==f.ListenerType_BODY&&(f.internal=!0,f.ListenerType_BODY=new Dd,f.internal=!1);this==f.ListenerType_BODY?a="BODY":(null==f.ListenerType_CONSTRAINT&&(f.internal=!0,f.ListenerType_CONSTRAINT=new Dd,f.internal=!1),this==f.ListenerType_CONSTRAINT?a="CONSTRAINT":(null==f.ListenerType_INTERACTION&&(f.internal=!0,f.ListenerType_INTERACTION=new Dd,f.internal=!1),this==f.ListenerType_INTERACTION?a="INTERACTION":(null==f.ListenerType_PRE&&(f.internal=!0,f.ListenerType_PRE=new Dd,f.internal=!1),a=this==
f.ListenerType_PRE?"PRE":"")));return a},__class__:Dd};var Xe=function(a,b){this.zpp_inner=null;this.zpp_inner=new Nd;this.zpp_inner.outer=this;null!=a&&this.including(a);null!=b&&this.excluding(b)};h["nape.callbacks.OptionType"]=Xe;Xe.__name__=!0;Xe.prototype={including:function(a){this.zpp_inner.append(this.zpp_inner.includes,a);return this},excluding:function(a){this.zpp_inner.append(this.zpp_inner.excludes,a);return this},toString:function(){null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes();
var a=this.zpp_inner.wrap_includes.toString();null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes();return"@{"+a+" excluding "+this.zpp_inner.wrap_excludes.toString()+"}"},__class__:Xe};var jg=function(){this.zpp_inner=null};h["nape.callbacks.PreCallback"]=jg;jg.__name__=!0;jg.__super__=jd;jg.prototype=v(jd.prototype,{toString:function(){var a;a="Cb:PRE:"+(":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString());a+=" : "+this.zpp_inner.pre_arbiter.wrapper().toString();
return a+=" : listnener: "+q.string(this.zpp_inner.listener.outer)},__class__:jg});var gb=function(){};h["nape.callbacks.PreFlag"]=gb;gb.__name__=!0;gb.prototype={toString:function(){var a;null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new gb,f.internal=!1);this==f.PreFlag_ACCEPT?a="ACCEPT":(null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new gb,f.internal=!1),this==f.PreFlag_IGNORE?a="IGNORE":(null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new gb,f.internal=!1),
this==f.PreFlag_ACCEPT_ONCE?a="ACCEPT_ONCE":(null==f.PreFlag_IGNORE_ONCE&&(f.internal=!0,f.PreFlag_IGNORE_ONCE=new gb,f.internal=!1),a=this==f.PreFlag_IGNORE_ONCE?"IGNORE_ONCE":"")));return a},__class__:gb};var Gi=function(){this.zpp_inner_zn=null};h["nape.callbacks.PreListener"]=Gi;Gi.__name__=!0;Gi.__super__=wc;Gi.prototype=v(wc.prototype,{__class__:Gi});var $j=function(){};h["nape.constraint.Constraint"]=$j;$j.__name__=!0;$j.prototype={toString:function(){return"{Constraint}"},__class__:$j};var yc=
function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.constraint.ConstraintIterator"]=yc;yc.__name__=!0;yc.get=function(a){var b;null==yc.zpp_pool?(kd.internal=!0,b=new yc,kd.internal=!1):(b=yc.zpp_pool,yc.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};yc.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=yc.zpp_pool;yc.zpp_pool=
this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:yc};var Hi=function(){this.zpp_inner=null;this.zpp_inner=new kd;this.zpp_inner.outer=this};h["nape.constraint.ConstraintList"]=Hi;Hi.__name__=!0;Hi.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();
this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},remove:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==a.zpp_inner){b=
!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=yc.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:Hi,__properties__:{get_length:"get_length"}};var Ob=function(){this.zpp_inner=null};h["nape.dynamics.Arbiter"]=
Ob;Ob.__name__=!0;Ob.prototype={get_state:function(){var a=this.zpp_inner.immState;if(a==(f.id_ImmState_ACCEPT|f.id_ImmState_ALWAYS))return null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new gb,f.internal=!1),f.PreFlag_ACCEPT;switch(a){case 1:return null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new gb,f.internal=!1),f.PreFlag_ACCEPT_ONCE;default:if(a==(f.id_ImmState_IGNORE|f.id_ImmState_ALWAYS))return null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new gb,f.internal=
!1),f.PreFlag_IGNORE;null==f.PreFlag_IGNORE_ONCE&&(f.internal=!0,f.PreFlag_IGNORE_ONCE=new gb,f.internal=!1);return f.PreFlag_IGNORE_ONCE}},toString:function(){var a;a=this.zpp_inner.type==Z.COL?"CollisionArbiter":this.zpp_inner.type==Z.FLUID?"FluidArbiter":"SensorArbiter";return this.zpp_inner.cleared?a+"(object-pooled)":a+"("+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).toString()+"|"+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:
this.zpp_inner.ws2.outer).toString()+")"+(this.zpp_inner.type==Z.COL?"["+["SD","DD"][this.zpp_inner.colarb.stat?0:1]+"]":"")+"<-"+this.get_state().toString()},__class__:Ob,__properties__:{get_state:"get_state"}};var zc=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.dynamics.ArbiterIterator"]=zc;zc.__name__=!0;zc.get=function(a){var b;null==zc.zpp_pool?(Pd.internal=!0,b=new zc,Pd.internal=!1):(b=zc.zpp_pool,zc.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=
a;b.zpp_critical=!1;return b};zc.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.zpp_gl();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=zc.zpp_pool;zc.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:zc};var Ii=function(){this.zpp_inner=null;this.zpp_inner=new Pd;this.zpp_inner.outer=this};h["nape.dynamics.ArbiterList"]=Ii;Ii.__name__=!0;Ii.prototype={zpp_gl:function(){this.zpp_inner.valmod();
if(this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1;this.zpp_inner.user_length=0;for(var a=this.zpp_inner.inner.head;null!=a;)a.elt.active&&this.zpp_inner.user_length++,a=a.next}return this.zpp_inner.user_length},zpp_vm:function(){this.zpp_inner.valmod()},at:function(a){this.zpp_vm();this.zpp_inner.reverse_flag&&(a=this.zpp_gl()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite){this.zpp_inner.at_index=0;for(this.zpp_inner.at_ite=this.zpp_inner.inner.head;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=
this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=a;){this.zpp_inner.at_index++;for(this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.elt.wrapper()},iterator:function(){this.zpp_vm();return zc.get(this)},toString:function(){for(var a="[",b=!0,c=this.iterator();c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+
"]"},__class__:Ii};var Ye=function(){};h["nape.dynamics.ArbiterType"]=Ye;Ye.__name__=!0;Ye.prototype={toString:function(){var a;null==f.ArbiterType_COLLISION&&(f.internal=!0,f.ArbiterType_COLLISION=new Ye,f.internal=!1);this==f.ArbiterType_COLLISION?a="COLLISION":(null==f.ArbiterType_SENSOR&&(f.internal=!0,f.ArbiterType_SENSOR=new Ye,f.internal=!1),this==f.ArbiterType_SENSOR?a="SENSOR":(null==f.ArbiterType_FLUID&&(f.internal=!0,f.ArbiterType_FLUID=new Ye,f.internal=!1),a=this==f.ArbiterType_FLUID?
"FLUID":""));return a},__class__:Ye};var kg=function(){this.zpp_inner=null};h["nape.dynamics.CollisionArbiter"]=kg;kg.__name__=!0;kg.__super__=Ob;kg.prototype=v(Ob.prototype,{__class__:kg});var Ji=function(){this.zpp_inner=null};h["nape.dynamics.Contact"]=Ji;Ji.__name__=!0;Ji.prototype={toString:function(){return null==this.zpp_inner.arbiter||this.zpp_inner.arbiter.cleared?"{object-pooled}":"{Contact}"},__class__:Ji};var Ac=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=
null};h["nape.dynamics.ContactIterator"]=Ac;Ac.__name__=!0;Ac.get=function(a){var b;null==Ac.zpp_pool?(Ze.internal=!0,b=new Ac,Ze.internal=!1):(b=Ac.zpp_pool,Ac.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Ac.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Ac.zpp_pool;Ac.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},
__class__:Ac};var ak=function(){this.zpp_inner=null};h["nape.dynamics.ContactList"]=ak;ak.__name__=!0;ak.prototype={get_length:function(){this.zpp_inner.valmod();if(this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1;this.zpp_inner.user_length=0;for(var a=this.zpp_inner.inner.next;null!=a;){var b=a;b.active&&b.arbiter.active&&this.zpp_inner.user_length++;a=a.next}}return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<
this.zpp_inner.at_index||null==this.zpp_inner.at_ite){this.zpp_inner.at_index=0;for(this.zpp_inner.at_ite=this.zpp_inner.inner.next;;){var b=this.zpp_inner.at_ite;if(b.active&&b.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}}for(;this.zpp_inner.at_index!=a;){this.zpp_inner.at_index++;for(this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){b=this.zpp_inner.at_ite;if(b.active&&b.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}}return this.zpp_inner.at_ite.wrapper()},
toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=Ac.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:ak,__properties__:{get_length:"get_length"}};var lg=function(){this.zpp_inner=null};h["nape.dynamics.FluidArbiter"]=lg;lg.__name__=!0;lg.__super__=Ob;lg.prototype=v(Ob.prototype,{__class__:lg});var Ki=function(a,b,c,d,e,i){null==i&&(i=-1);null==e&&(e=1);null==d&&(d=-1);null==c&&(c=
1);null==b&&(b=-1);null==a&&(a=1);this.zpp_inner=null;null==Sa.zpp_pool?this.zpp_inner=new Sa:(this.zpp_inner=Sa.zpp_pool,Sa.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);null;this.zpp_inner.outer=this;this.zpp_inner.collisionGroup!=a&&(this.zpp_inner.collisionGroup=a,this.zpp_inner.invalidate());this.zpp_inner.collisionGroup;this.zpp_inner.collisionMask!=b&&(this.zpp_inner.collisionMask=b,this.zpp_inner.invalidate());this.zpp_inner.collisionMask;this.zpp_inner.sensorGroup!=c&&(this.zpp_inner.sensorGroup=
c,this.zpp_inner.invalidate());this.zpp_inner.sensorGroup;this.zpp_inner.sensorMask!=d&&(this.zpp_inner.sensorMask=d,this.zpp_inner.invalidate());this.zpp_inner.sensorMask;this.zpp_inner.fluidGroup!=e&&(this.zpp_inner.fluidGroup=e,this.zpp_inner.invalidate());this.zpp_inner.fluidGroup;this.zpp_inner.fluidMask!=i&&(this.zpp_inner.fluidMask=i,this.zpp_inner.invalidate());this.zpp_inner.fluidMask};h["nape.dynamics.InteractionFilter"]=Ki;Ki.__name__=!0;Ki.prototype={__class__:Ki};var bk=function(){this.zpp_inner=
null};h["nape.dynamics.InteractionGroup"]=bk;bk.__name__=!0;bk.prototype={toString:function(){var a="InteractionGroup";this.zpp_inner.ignore&&(a+=":ignore");return a},__class__:bk};var Bc=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.dynamics.InteractionGroupIterator"]=Bc;Bc.__name__=!0;Bc.get=function(a){var b;null==Bc.zpp_pool?($e.internal=!0,b=new Bc,$e.internal=!1):(b=Bc.zpp_pool,Bc.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};
Bc.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Bc.zpp_pool;Bc.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Bc};var ck=function(){this.zpp_inner=null};h["nape.dynamics.InteractionGroupList"]=ck;ck.__name__=!0;ck.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=
!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},toString:function(){var a=
"[",b=!0,c;this.zpp_inner.valmod();for(c=Bc.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:ck,__properties__:{get_length:"get_length"}};var dk=function(){this.zpp_inner=null};h["nape.geom.AABB"]=dk;dk.__name__=!0;dk.prototype={toString:function(){this.zpp_inner.validate();return this.zpp_inner.toString()},__class__:dk};var ek=function(){this.zpp_inner=null};h["nape.geom.ConvexResult"]=ek;ek.__name__=
!0;ek.prototype={toString:function(){return"{ shape: "+q.string(this.zpp_inner.shape)+" toi: "+this.zpp_inner.toiDistance+" }"},__class__:ek};var Pb=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.geom.ConvexResultIterator"]=Pb;Pb.__name__=!0;Pb.get=function(a){var b;null==Pb.zpp_pool?(af.internal=!0,b=new Pb,af.internal=!1):(b=Pb.zpp_pool,Pb.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Pb.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();
var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Pb.zpp_pool;Pb.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Pb};var fk=function(){this.zpp_inner=null};h["nape.geom.ConvexResultList"]=fk;fk.__name__=!0;fk.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);
return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=Pb.get(this);c.hasNext();){var d;
c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:fk,__properties__:{get_length:"get_length"}};var Li=function(){this.zpp_inner=null};h["nape.geom.GeomPoly"]=Li;Li.__name__=!0;Li.prototype={toString:function(){var a="GeomPoly[",b=this.zpp_inner.vertices,c=this.zpp_inner.vertices;if(null!=b){do{var d=b;d!=this.zpp_inner.vertices&&(a+=",");a+="{"+d.x+","+d.y+"}";b=b.next}while(b!=c)}return a+"]"},__class__:Li};var gc=function(){this.zpp_next=
null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.geom.GeomPolyIterator"]=gc;gc.__name__=!0;gc.get=function(a){var b;null==gc.zpp_pool?(bf.internal=!0,b=new gc,bf.internal=!1):(b=gc.zpp_pool,gc.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};gc.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=gc.zpp_pool;gc.zpp_pool=this;this.zpp_inner=null;return!1},
next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:gc};var gk=function(){this.zpp_inner=null};h["nape.geom.GeomPolyList"]=gk;gk.__name__=!0;gk.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||
null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=gc.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:gk,__properties__:{get_length:"get_length"}};
var hk=function(){this.zpp_inner=null};h["nape.geom.Mat23"]=hk;hk.__name__=!0;hk.prototype={toString:function(){return"{ a: "+this.zpp_inner.a+" b: "+this.zpp_inner.b+" c: "+this.zpp_inner.c+" d: "+this.zpp_inner.d+" tx: "+this.zpp_inner.tx+" ty: "+this.zpp_inner.ty+" }"},__class__:hk};var ik=function(){this.zpp_inner=null};h["nape.geom.MatMN"]=ik;ik.__name__=!0;ik.prototype={toString:function(){for(var a="{ ",b=!0,c=0,d=this.zpp_inner.m;c<d;){var e=c++;b||(a+="; ");for(var b=!1,i=0,m=this.zpp_inner.n;i<
m;)var f=i++,a=a+(this.zpp_inner.x[e*this.zpp_inner.n+f]+" ")}return a+"}"},__class__:ik};var jk=function(){this.zpp_inner=null};h["nape.geom.RayResult"]=jk;jk.__name__=!0;jk.prototype={toString:function(){return"{ shape: "+q.string(this.zpp_inner.shape)+" distance: "+this.zpp_inner.toiDistance+" ?inner: "+q.string(this.zpp_inner.inner)+" }"},__class__:jk};var Eb=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.geom.RayResultIterator"]=Eb;Eb.__name__=!0;
Eb.get=function(a){var b;null==Eb.zpp_pool?(cf.internal=!0,b=new Eb,cf.internal=!1):(b=Eb.zpp_pool,Eb.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Eb.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Eb.zpp_pool;Eb.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Eb};var kk=function(){this.zpp_inner=
null};h["nape.geom.RayResultList"]=kk;kk.__name__=!0;kk.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=
a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=Eb.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:kk,__properties__:{get_length:"get_length"}};var ga=function(a,b){null==b&&(b=0);null==a&&(a=0);this.zpp_inner=this.zpp_pool=null;this.zpp_inner=ia.get(a,b,null);this.zpp_inner.outer=
this};h["nape.geom.Vec2"]=ga;ga.__name__=!0;ga.get=function(a,b,c){null==c&&(c=!1);null==b&&(b=0);null==a&&(a=0);var d;null==df.poolVec2?d=new ga:(d=df.poolVec2,df.poolVec2=d.zpp_pool,d.zpp_pool=null);if(null==d.zpp_inner)d.zpp_inner=ia.get(a,b,null),d.zpp_inner.outer=d;else{var e;d.zpp_inner.validate();if(e=d.zpp_inner.x==a)d.zpp_inner.validate(),e=d.zpp_inner.y==b;e||(d.zpp_inner.x=a,d.zpp_inner.y=b,d.zpp_inner.invalidate());d}d.zpp_inner.weak=c;return d};ga.prototype={dispose:function(){var a=
this.zpp_inner;this.zpp_inner=this.zpp_inner.outer=null;this.zpp_pool=df.poolVec2;df.poolVec2=this;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null);a._isimmutable=null;a._validate=null;a._invalidate=null;a.next=ia.zpp_pool;ia.zpp_pool=a},set_x:function(a){this.zpp_inner.validate();this.zpp_inner.x!=a&&(this.zpp_inner.x=a,this.zpp_inner.invalidate());this.zpp_inner.validate();return this.zpp_inner.x},set_y:function(a){this.zpp_inner.validate();this.zpp_inner.y!=a&&(this.zpp_inner.y=a,this.zpp_inner.invalidate());
this.zpp_inner.validate();return this.zpp_inner.y},set:function(a){var b=this.setxy(function(){a.zpp_inner.validate();return a.zpp_inner.x}(this),function(){a.zpp_inner.validate();return a.zpp_inner.y}(this));a.zpp_inner.weak?(a.dispose(),!0):!1;return b},setxy:function(a,b){var c;this.zpp_inner.validate();if(c=this.zpp_inner.x==a)this.zpp_inner.validate(),c=this.zpp_inner.y==b;c||(this.zpp_inner.x=a,this.zpp_inner.y=b,this.zpp_inner.invalidate());return this},toString:function(){this.zpp_inner.validate();
return this.zpp_inner.toString()},__class__:ga,__properties__:{set_y:"set_y",set_x:"set_x"}};var Wc=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.geom.Vec2Iterator"]=Wc;Wc.__name__=!0;Wc.get=function(a){var b;null==Wc.zpp_pool?(qe.internal=!0,b=new Wc,qe.internal=!1):(b=Wc.zpp_pool,Wc.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};Wc.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.zpp_gl();
this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=Wc.zpp_pool;Wc.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:Wc};var ee=function(){this.zpp_inner=null;this.zpp_inner=new qe;this.zpp_inner.outer=this};h["nape.geom.Vec2List"]=ee;ee.__name__=!0;ee.prototype={zpp_gl:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);
return this.zpp_inner.user_length},zpp_vm:function(){this.zpp_inner.valmod()},at:function(a){this.zpp_vm();this.zpp_inner.reverse_flag&&(a=this.zpp_gl()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},push:function(a){this.zpp_inner.modify_test();
this.zpp_vm();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},empty:function(){return 0==this.zpp_gl()},
iterator:function(){this.zpp_vm();return Wc.get(this)},toString:function(){for(var a="[",b=!0,c=this.iterator();c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:ee};var lk=function(){this.zpp_inner=null};h["nape.geom.Vec3"]=lk;lk.__name__=!0;lk.prototype={toString:function(){this.zpp_inner.validate();var a="{ x: "+this.zpp_inner.x+" y: ";this.zpp_inner.validate();a=a+this.zpp_inner.y+" z: ";this.zpp_inner.validate();
return a+this.zpp_inner.z+" }"},__class__:lk};var ef=function(){};h["nape.geom.Winding"]=ef;ef.__name__=!0;ef.prototype={toString:function(){var a;null==f.Winding_UNDEFINED&&(f.internal=!0,f.Winding_UNDEFINED=new ef,f.internal=!1);this==f.Winding_UNDEFINED?a="UNDEFINED":(null==f.Winding_CLOCKWISE&&(f.internal=!0,f.Winding_CLOCKWISE=new ef,f.internal=!1),this==f.Winding_CLOCKWISE?a="CLOCKWISE":(null==f.Winding_ANTICLOCKWISE&&(f.internal=!0,f.Winding_ANTICLOCKWISE=new ef,f.internal=!1),a=this==f.Winding_ANTICLOCKWISE?
"ANTICLOCKWISE":""));return a},__class__:ef};var Xc=function(){this.zpp_inner_i=null};h["nape.phys.Interactor"]=Xc;Xc.__name__=!0;Xc.prototype={get_userData:function(){null==this.zpp_inner_i.userData&&(this.zpp_inner_i.userData={});return this.zpp_inner_i.userData},get_castShape:function(){return null!=this.zpp_inner_i.ishape?this.zpp_inner_i.ishape.outer:null},toString:function(){return""},__class__:Xc,__properties__:{get_castShape:"get_castShape",get_userData:"get_userData"}};var re=function(a,
b){this.zpp_inner_i=this.zpp_inner=null;this.zpp_inner=new Yc;this.zpp_inner.outer=this;this.zpp_inner.outer_i=this;this.zpp_inner_i=this.zpp_inner;null!=b?(b.zpp_inner.validate(),this.zpp_inner.posx=b.zpp_inner.x,b.zpp_inner.validate(),this.zpp_inner.posy=b.zpp_inner.y):(this.zpp_inner.posx=0,this.zpp_inner.posy=0);this.set_type(null==a?function(){null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new Ia,f.internal=!1);return f.BodyType_DYNAMIC}(this):a);null!=b&&(b.zpp_inner.weak?(b.dispose(),
!0):!1);this.zpp_inner_i.insert_cbtype(qa.ANY_BODY.zpp_inner)};h["nape.phys.Body"]=re;re.__name__=!0;re.__super__=Xc;re.prototype=v(Xc.prototype,{set_type:function(a){this.zpp_inner.immutable_midstep("Body::type");Yc.types[this.zpp_inner.type]!=a&&(null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new Ia,f.internal=!1),a==f.BodyType_DYNAMIC?a=f.id_BodyType_DYNAMIC:(null==f.BodyType_KINEMATIC&&(f.internal=!0,f.BodyType_KINEMATIC=new Ia,f.internal=!1),a=a==f.BodyType_KINEMATIC?f.id_BodyType_KINEMATIC:
f.id_BodyType_STATIC),a==f.id_BodyType_STATIC&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,a):this.zpp_inner.type=a);return Yc.types[this.zpp_inner.type]},set_space:function(a){this.zpp_inner.immutable_midstep("Body::space");if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=a){if(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer))this.zpp_inner.component.woken=
!1;if(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer))(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_bodies.remove(this);null!=a&&a.zpp_inner.wrap_bodies.add(this)}return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},get_position:function(){null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();return this.zpp_inner.wrap_pos},set_velocity:function(a){null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();this.zpp_inner.wrap_vel.set(a);
null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();return this.zpp_inner.wrap_vel},applyImpulse:function(a,b,c){null==c&&(c=!1);if(c&&this.zpp_inner.component.sleeping)return a.zpp_inner.weak?(a.dispose(),!0):!1,null!=b&&(b.zpp_inner.weak?(b.dispose(),!0):!1),this;this.zpp_inner.validate_mass();var d=this.zpp_inner.imass,e=this.zpp_inner,i=this.zpp_inner.velx;a.zpp_inner.validate();e.velx=i+a.zpp_inner.x*d;e=this.zpp_inner;i=this.zpp_inner.vely;a.zpp_inner.validate();e.vely=i+a.zpp_inner.y*
d;if(null!=b){var m=0,d=0;b.zpp_inner.validate();m=b.zpp_inner.x-this.zpp_inner.posx;b.zpp_inner.validate();d=b.zpp_inner.y-this.zpp_inner.posy;this.zpp_inner.validate_inertia();e=this.zpp_inner;i=this.zpp_inner.angvel;a.zpp_inner.validate();m*=a.zpp_inner.y;a.zpp_inner.validate();e.angvel=i+(m-a.zpp_inner.x*d)*this.zpp_inner.iinertia;b.zpp_inner.weak?(b.dispose(),!0):!1}c||this.zpp_inner.type==f.id_BodyType_DYNAMIC&&this.zpp_inner.wake();a.zpp_inner.weak?(a.dispose(),!0):!1;return this},toString:function(){return(this.zpp_inner.world?
"(space::world":"("+(this.zpp_inner.type==f.id_BodyType_DYNAMIC?"dynamic":this.zpp_inner.type==f.id_BodyType_STATIC?"static":"kinematic"))+")#"+this.zpp_inner_i.id},__class__:re,__properties__:v(Xc.prototype.__properties__,{set_velocity:"set_velocity",get_position:"get_position",set_space:"set_space",set_type:"set_type"})});var ld=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.phys.BodyIterator"]=ld;ld.__name__=!0;ld.get=function(a){var b;null==ld.zpp_pool?
(Zc.internal=!0,b=new ld,Zc.internal=!1):(b=ld.zpp_pool,ld.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};ld.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=ld.zpp_pool;ld.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:ld};var Mi=function(){this.zpp_inner=null;this.zpp_inner=new Zc;
this.zpp_inner.outer=this};h["nape.phys.BodyList"]=Mi;Mi.__name__=!0;Mi.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);
else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),
this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-
1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?this.push(a):this.unshift(a)},remove:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&
this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=ld.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:Mi,__properties__:{get_length:"get_length"}};var Ia=function(){};h["nape.phys.BodyType"]=Ia;Ia.__name__=!0;Ia.prototype={toString:function(){var a;null==
f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new Ia,f.internal=!1);this==f.BodyType_STATIC?a="STATIC":(null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new Ia,f.internal=!1),this==f.BodyType_DYNAMIC?a="DYNAMIC":(null==f.BodyType_KINEMATIC&&(f.internal=!0,f.BodyType_KINEMATIC=new Ia,f.internal=!1),a=this==f.BodyType_KINEMATIC?"KINEMATIC":""));return a},__class__:Ia};var Ni=function(){this.zpp_inner=null};h["nape.phys.Compound"]=Ni;Ni.__name__=!0;Ni.__super__=Xc;Ni.prototype=v(Xc.prototype,
{toString:function(){return"Compound"+this.zpp_inner_i.id},__class__:Ni});var md=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.phys.CompoundIterator"]=md;md.__name__=!0;md.get=function(a){var b;null==md.zpp_pool?(Qd.internal=!0,b=new md,Qd.internal=!1):(b=md.zpp_pool,md.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};md.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();var a=this.zpp_inner.get_length();this.zpp_critical=
!0;if(this.zpp_i<a)return!0;this.zpp_next=md.zpp_pool;md.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:md};var Oi=function(){this.zpp_inner=null;this.zpp_inner=new Qd;this.zpp_inner.outer=this};h["nape.phys.CompoundList"]=Oi;Oi.__name__=!0;Oi.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},
at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},remove:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=
c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=md.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:Oi,__properties__:{get_length:"get_length"}};var mk=function(){this.zpp_inner=
null};h["nape.phys.FluidProperties"]=mk;mk.__name__=!0;mk.prototype={toString:function(){return"{ density: "+1E3*this.zpp_inner.density+" viscosity: "+this.zpp_inner.viscosity+" gravity: "+q.string(this.zpp_inner.wrap_gravity)+" }"},__class__:mk};var ff=function(){};h["nape.phys.GravMassMode"]=ff;ff.__name__=!0;ff.prototype={toString:function(){var a;null==f.GravMassMode_DEFAULT&&(f.internal=!0,f.GravMassMode_DEFAULT=new ff,f.internal=!1);this==f.GravMassMode_DEFAULT?a="DEFAULT":(null==f.GravMassMode_FIXED&&
(f.internal=!0,f.GravMassMode_FIXED=new ff,f.internal=!1),this==f.GravMassMode_FIXED?a="FIXED":(null==f.GravMassMode_SCALED&&(f.internal=!0,f.GravMassMode_SCALED=new ff,f.internal=!1),a=this==f.GravMassMode_SCALED?"SCALED":""));return a},__class__:ff};var mg=function(){};h["nape.phys.InertiaMode"]=mg;mg.__name__=!0;mg.prototype={toString:function(){var a;null==f.InertiaMode_DEFAULT&&(f.internal=!0,f.InertiaMode_DEFAULT=new mg,f.internal=!1);this==f.InertiaMode_DEFAULT?a="DEFAULT":(null==f.InertiaMode_FIXED&&
(f.internal=!0,f.InertiaMode_FIXED=new mg,f.internal=!1),a=this==f.InertiaMode_FIXED?"FIXED":"");return a},__class__:mg};var nd=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.phys.InteractorIterator"]=nd;nd.__name__=!0;nd.get=function(a){var b;null==nd.zpp_pool?(gf.internal=!0,b=new nd,gf.internal=!1):(b=nd.zpp_pool,nd.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};nd.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();
var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=nd.zpp_pool;nd.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:nd};var nk=function(){this.zpp_inner=null};h["nape.phys.InteractorList"]=nk;nk.__name__=!0;nk.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);
return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer_i},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=nd.get(this);c.hasNext();){var d;
c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:nk,__properties__:{get_length:"get_length"}};var ng=function(){};h["nape.phys.MassMode"]=ng;ng.__name__=!0;ng.prototype={toString:function(){var a;null==f.MassMode_DEFAULT&&(f.internal=!0,f.MassMode_DEFAULT=new ng,f.internal=!1);this==f.MassMode_DEFAULT?a="DEFAULT":(null==f.MassMode_FIXED&&(f.internal=!0,f.MassMode_FIXED=new ng,f.internal=!1),a=this==f.MassMode_FIXED?"FIXED":"");
return a},__class__:ng};var ra=function(a,b,c,d,e){null==e&&(e=0.001);null==d&&(d=1);null==c&&(c=2);null==b&&(b=1);null==a&&(a=0);this.zpp_inner=null;null==da.zpp_pool?this.zpp_inner=new da:(this.zpp_inner=da.zpp_pool,da.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null);null;this.zpp_inner.outer=this;a!=this.zpp_inner.elasticity&&(this.zpp_inner.elasticity=a/1,this.zpp_inner.invalidate(da.WAKE|da.ARBITERS));this.zpp_inner.elasticity;b!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=
b/1,this.zpp_inner.invalidate(da.WAKE|da.ANGDRAG|da.ARBITERS));this.zpp_inner.dynamicFriction;c!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=c/1,this.zpp_inner.invalidate(da.WAKE|da.ARBITERS));this.zpp_inner.staticFriction;d!=1E3*this.zpp_inner.density&&(this.zpp_inner.density=d/1E3,this.zpp_inner.invalidate(da.WAKE|da.PROPS));1E3*this.zpp_inner.density;e!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=e/1,this.zpp_inner.invalidate(da.WAKE|da.ARBITERS));this.zpp_inner.rollingFriction};
h["nape.phys.Material"]=ra;ra.__name__=!0;ra.wood=function(){return new ra(0.4,0.2,0.38,0.7,0.005)};ra.steel=function(){return new ra(0.2,0.57,0.74,7.8,0.001)};ra.ice=function(){return new ra(0.3,0.03,0.1,0.9,1.0E-4)};ra.rubber=function(){return new ra(0.8,1,1.4,1.5,0.01)};ra.glass=function(){return new ra(0.4,0.4,0.94,2.6,0.002)};ra.sand=function(){return new ra(-1,0.45,0.6,1.6,16)};ra.prototype={toString:function(){return"{ elasticity: "+this.zpp_inner.elasticity+" dynamicFriction: "+this.zpp_inner.dynamicFriction+
" staticFriction: "+this.zpp_inner.staticFriction+" density: "+1E3*this.zpp_inner.density+" rollingFriction: "+this.zpp_inner.rollingFriction+" }"},__class__:ra};var $c=function(){this.zpp_inner_i=this.zpp_inner=null};h["nape.shape.Shape"]=$c;$c.__name__=!0;$c.__super__=Xc;$c.prototype=v(Xc.prototype,{get_body:function(){return null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},set_sensorEnabled:function(a){this.zpp_inner.immutable_midstep("Shape::sensorEnabled");this.zpp_inner.sensorEnabled=
a;this.zpp_inner.wake();return this.zpp_inner.sensorEnabled},toString:function(){return(this.zpp_inner.type==f.id_ShapeType_CIRCLE?"Circle":"Polygon")+"#"+this.zpp_inner_i.id},__class__:$c,__properties__:v(Xc.prototype.__properties__,{set_sensorEnabled:"set_sensorEnabled",get_body:"get_body"})});var Rd=function(a,b,c,d){this.zpp_inner_zn=null;$c.call(this);this.zpp_inner_zn=new og;this.zpp_inner_zn.outer=this;this.zpp_inner_zn.outer_zn=this;this.zpp_inner_i=this.zpp_inner=this.zpp_inner_zn;this.zpp_inner_i.outer_i=
this;this.zpp_inner.immutable_midstep("Circle::radius");a!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=a,this.zpp_inner_zn.invalidate_radius());this.zpp_inner_zn.radius;null==b?(this.zpp_inner.localCOMx=0,this.zpp_inner.localCOMy=0):(b.zpp_inner.validate(),this.zpp_inner.localCOMx=b.zpp_inner.x,b.zpp_inner.validate(),this.zpp_inner.localCOMy=b.zpp_inner.y,b.zpp_inner.weak?(b.dispose(),!0):!1);null==c?(null==da.zpp_pool?this.zpp_inner.material=new da:(this.zpp_inner.material=da.zpp_pool,da.zpp_pool=
this.zpp_inner.material.next,this.zpp_inner.material.next=null),null):(this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(c.zpp_inner),this.zpp_inner.material.wrapper());null==d?(null==Sa.zpp_pool?this.zpp_inner.filter=new Sa:(this.zpp_inner.filter=Sa.zpp_pool,Sa.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null),null):(this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(d.zpp_inner),this.zpp_inner.filter.wrapper());this.zpp_inner_i.insert_cbtype(qa.ANY_SHAPE.zpp_inner)};
h["nape.shape.Circle"]=Rd;Rd.__name__=!0;Rd.__super__=$c;Rd.prototype=v($c.prototype,{__class__:Rd});var Pi=function(){this.zpp_inner=null};h["nape.shape.Edge"]=Pi;Pi.__name__=!0;Pi.prototype={toString:function(){if(null==this.zpp_inner.polygon)return"Edge(object-pooled)";if(null==this.zpp_inner.polygon.body)return this.zpp_inner.polygon.validate_laxi(),"{ localNormal : "+("{ x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" }")+" }";this.zpp_inner.polygon.validate_gaxi();return"{ localNormal : "+
("{ x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" }")+" worldNormal : "+("{ x: "+this.zpp_inner.gnormx+" y: "+this.zpp_inner.gnormy+" }")+" }"},__class__:Pi};var od=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.shape.EdgeIterator"]=od;od.__name__=!0;od.get=function(a){var b;null==od.zpp_pool?(hf.internal=!0,b=new od,hf.internal=!1):(b=od.zpp_pool,od.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};od.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();
var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=od.zpp_pool;od.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:od};var ok=function(){this.zpp_inner=null};h["nape.shape.EdgeList"]=ok;ok.__name__=!0;ok.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length);return this.zpp_inner.user_length},
at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&a!=this.get_length()-1&&(a=this.get_length()-2-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=od.get(this);c.hasNext();){var d;
c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:ok,__properties__:{get_length:"get_length"}};var nb=function(a,b,c){this.zpp_inner_zn=null;$c.call(this);this.zpp_inner_zn=new pg;this.zpp_inner_zn.outer=this;this.zpp_inner_zn.outer_zn=this;this.zpp_inner_i=this.zpp_inner=this.zpp_inner_zn;this.zpp_inner_i.outer_i=this;if(a instanceof Array&&null==a.__enum__)for(var d=0;d<a.length;){var e=a[d];++d;var i=e;null==this.zpp_inner_zn.wrap_lverts&&
this.zpp_inner_zn.getlverts();this.zpp_inner_zn.wrap_lverts.push(ga.get(function(){i.zpp_inner.validate();return i.zpp_inner.x}(this),function(){i.zpp_inner.validate();return i.zpp_inner.y}(this),!1))}else if(A.__instanceof(a,ee))for(d=a.iterator();d.hasNext();){var m;d.zpp_critical=!1;m=d.zpp_inner.at(d.zpp_i++);null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();this.zpp_inner_zn.wrap_lverts.push(ga.get(function(){m.zpp_inner.validate();return m.zpp_inner.x}(this),function(){m.zpp_inner.validate();
return m.zpp_inner.y}(this),!1))}else if(A.__instanceof(a,Li)&&(d=a.zpp_inner.vertices,null!=d)){e=d;do{var f=ga.get(e.x,e.y,null),e=e.next;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();this.zpp_inner_zn.wrap_lverts.push(ga.get(function(){f.zpp_inner.validate();return f.zpp_inner.x}(this),function(){f.zpp_inner.validate();return f.zpp_inner.y}(this),!1));f.dispose()}while(e!=d)}if(a instanceof Array&&null==a.__enum__)for(d=0;d<a.length;){var e=a[d],r;if(r=e.zpp_inner.weak)e.dispose(),
r=!0;r?a.splice(d,1):d++}else if(A.__instanceof(a,ee)){null!=a.zpp_inner._validate&&a.zpp_inner._validate();a=a.zpp_inner.inner;d=null;for(e=a.head;null!=e;)r=e.elt,r.outer.zpp_inner.weak?(e=a.erase(d),r.outer.zpp_inner.weak?(r.outer.dispose(),!0):!1):(d=e,e=e.next)}null==b?(null==da.zpp_pool?this.zpp_inner.material=new da:(this.zpp_inner.material=da.zpp_pool,da.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null),null):(this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(b.zpp_inner),
this.zpp_inner.material.wrapper());null==c?(null==Sa.zpp_pool?this.zpp_inner.filter=new Sa:(this.zpp_inner.filter=Sa.zpp_pool,Sa.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null),null):(this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(c.zpp_inner),this.zpp_inner.filter.wrapper());this.zpp_inner_i.insert_cbtype(qa.ANY_SHAPE.zpp_inner)};h["nape.shape.Polygon"]=nb;nb.__name__=!0;nb.rect=function(a,b,c,d,e){null==e&&(e=!1);return[ga.get(a,b,e),ga.get(a+c,b,
e),ga.get(a+c,b+d,e),ga.get(a,b+d,e)]};nb.box=function(a,b,c){null==c&&(c=!1);return nb.rect(-a/2,-b/2,a,b,c)};nb.__super__=$c;nb.prototype=v($c.prototype,{__class__:nb});var pd=function(){this.zpp_next=null;this.zpp_critical=!1;this.zpp_i=0;this.zpp_inner=null};h["nape.shape.ShapeIterator"]=pd;pd.__name__=!0;pd.get=function(a){var b;null==pd.zpp_pool?(Sd.internal=!0,b=new pd,Sd.internal=!1):(b=pd.zpp_pool,pd.zpp_pool=b.zpp_next);b.zpp_i=0;b.zpp_inner=a;b.zpp_critical=!1;return b};pd.prototype={hasNext:function(){this.zpp_inner.zpp_inner.valmod();
var a=this.zpp_inner.get_length();this.zpp_critical=!0;if(this.zpp_i<a)return!0;this.zpp_next=pd.zpp_pool;pd.zpp_pool=this;this.zpp_inner=null;return!1},next:function(){this.zpp_critical=!1;return this.zpp_inner.at(this.zpp_i++)},__class__:pd};var Qi=function(){this.zpp_inner=null;this.zpp_inner=new Sd;this.zpp_inner.outer=this};h["nape.shape.ShapeList"]=Qi;Qi.__name__=!0;Qi.prototype={get_length:function(){this.zpp_inner.valmod();this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=
this.zpp_inner.inner.length);return this.zpp_inner.user_length},at:function(a){this.zpp_inner.valmod();this.zpp_inner.reverse_flag&&(a=this.get_length()-1-a);if(a<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=a,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(a);else for(;this.zpp_inner.at_index!=a;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},push:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();
var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(a.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},unshift:function(a){this.zpp_inner.modify_test();
this.zpp_inner.valmod();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=null==this.zpp_inner.inner.head?null:this.zpp_inner.inner.iterator_at(this.get_length()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,a.zpp_inner)):this.zpp_inner.inner.add(a.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},add:function(a){return this.zpp_inner.reverse_flag?
this.push(a):this.unshift(a)},remove:function(a){this.zpp_inner.modify_test();this.zpp_inner.valmod();var b;b=!1;for(var c=this.zpp_inner.inner.head;null!=c;){if(c.elt==a.zpp_inner){b=!0;break}c=c.next}b&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(a),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(a.zpp_inner),this.zpp_inner.invalidate());return b},toString:function(){var a="[",b=!0,c;this.zpp_inner.valmod();for(c=pd.get(this);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);
b||(a+=",");a=null==d?a+"NULL":a+d.toString();b=!1}return a+"]"},__class__:Qi,__properties__:{get_length:"get_length"}};var qg=function(){};h["nape.shape.ShapeType"]=qg;qg.__name__=!0;qg.prototype={toString:function(){var a;null==f.ShapeType_CIRCLE&&(f.internal=!0,f.ShapeType_CIRCLE=new qg,f.internal=!1);this==f.ShapeType_CIRCLE?a="CIRCLE":(null==f.ShapeType_POLYGON&&(f.internal=!0,f.ShapeType_POLYGON=new qg,f.internal=!1),a=this==f.ShapeType_POLYGON?"POLYGON":"");return a},__class__:qg};var Ed=function(){};
h["nape.shape.ValidationResult"]=Ed;Ed.__name__=!0;Ed.prototype={toString:function(){var a;null==f.ValidationResult_VALID&&(f.internal=!0,f.ValidationResult_VALID=new Ed,f.internal=!1);this==f.ValidationResult_VALID?a="VALID":(null==f.ValidationResult_DEGENERATE&&(f.internal=!0,f.ValidationResult_DEGENERATE=new Ed,f.internal=!1),this==f.ValidationResult_DEGENERATE?a="DEGENERATE":(null==f.ValidationResult_CONCAVE&&(f.internal=!0,f.ValidationResult_CONCAVE=new Ed,f.internal=!1),this==f.ValidationResult_CONCAVE?
a="CONCAVE":(null==f.ValidationResult_SELF_INTERSECTING&&(f.internal=!0,f.ValidationResult_SELF_INTERSECTING=new Ed,f.internal=!1),a=this==f.ValidationResult_SELF_INTERSECTING?"SELF_INTERSECTING":"")));return a},__class__:Ed};var se=function(){};h["nape.space.Broadphase"]=se;se.__name__=!0;se.prototype={toString:function(){var a;null==f.Broadphase_DYNAMIC_AABB_TREE&&(f.internal=!0,f.Broadphase_DYNAMIC_AABB_TREE=new se,f.internal=!1);this==f.Broadphase_DYNAMIC_AABB_TREE?a="DYNAMIC_AABB_TREE":(null==
f.Broadphase_SWEEP_AND_PRUNE&&(f.internal=!0,f.Broadphase_SWEEP_AND_PRUNE=new se,f.internal=!1),a=this==f.Broadphase_SWEEP_AND_PRUNE?"SWEEP_AND_PRUNE":"");return a},__class__:se};var Si=function(a,b){this.zpp_inner=null;this.zpp_inner=new Ri(null==a?null:a.zpp_inner,b);this.zpp_inner.outer=this;null!=a&&(a.zpp_inner.weak?(a.dispose(),!0):!1)};h["nape.space.Space"]=Si;Si.__name__=!0;Si.prototype={step:function(a,b,c){null==c&&(c=10);null==b&&(b=10);this.zpp_inner.step(a,b,c)},__class__:Si};var Td=
function(a){this.time=0;null!=a&&(this.id=a.has.resolve("id")?q.parseInt(a.att.resolve("id")):0,this.time=a.has.resolve("time")?q.parseInt(a.att.resolve("time")):0,this.curveType=a.has.resolve("curve_type")?Ua.createEnum(ya,a.att.resolve("curve_type").toUpperCase()):ya.LINEAR,this.c1=a.has.resolve("c1")?q.parseFloat(a.att.resolve("c1")):0,this.c2=a.has.resolve("c2")?q.parseFloat(a.att.resolve("c2")):0)};h["spriter.definitions.TimelineKey"]=Td;Td.__name__=!0;Td.prototype={copy:function(){return this.clone(new Td)},
clone:function(a){a.id=this.id;a.time=this.time;a.curveType=this.curveType;a.c1=this.c1;a.c2=this.c2;return a},interpolate:function(a,b,c){this.linearKey(a,this.getTWithNextKey(a,b,c))},getTWithNextKey:function(a,b,c){if(this.curveType==ya.INSTANT||this.time==a.time)return 0;a=(c-this.time)/(a.time-this.time);return this.curveType==ya.LINEAR?a:this.curveType==ya.QUADRATIC?this.quadratic(0,this.c1,1,a):this.curveType==ya.CUBIC?this.cubic(0,this.c1,this.c2,1,a):0},linear:function(a,b,c){return(b-a)*
c+a},linearKey:function(){null},angleLinear:function(a,b,c,d){if(0==c)return a;0<c?0>b-a&&(b+=360):0>c&&0<b-a&&(b-=360);return this.linear(a,b,d)},quadratic:function(a,b,c,d){return this.linear(this.linear(a,b,d),this.linear(b,c,d),d)},cubic:function(a,b,c,d,e){return this.linear(this.quadratic(a,b,c,e),this.quadratic(b,c,d,e),e)},__class__:Td};var Qb=function(a){Td.call(this,a);if(null!=a){var b;b=a.has.resolve("spin")?q.parseInt(a.att.resolve("spin")):1;var a=a.hasNode.resolve("object")?a.node.resolve("object"):
a.node.resolve("bone"),c;c=a.has.resolve("x")?q.parseFloat(a.att.resolve("x")):0;var d;d=a.has.resolve("y")?q.parseFloat(a.att.resolve("y")):0;var e;e=a.has.resolve("angle")?q.parseFloat(a.att.resolve("angle")):0;var i;i=a.has.resolve("scale_x")?q.parseFloat(a.att.resolve("scale_x")):1;var m;m=a.has.resolve("scale_y")?q.parseFloat(a.att.resolve("scale_y")):1;a=a.has.resolve("a")?q.parseFloat(a.att.resolve("a")):1;this.info=new fe(c,d,e,i,m,a,b)}};h["spriter.definitions.SpatialTimelineKey"]=Qb;Qb.__name__=
!0;Qb.__super__=Td;Qb.prototype=v(Td.prototype,{copy:function(){return this.clone(new Qb)},clone:function(a){Td.prototype.clone.call(this,a);a.info=this.info.copy();return a},linearSpatialInfo:function(a,b,c,d){this.info.x=this.linear(a.x,b.x,d);this.info.y=this.linear(a.y,b.y,d);this.info.angle=this.angleLinear(a.angle,b.angle,c,d);this.info.scaleX=this.linear(a.scaleX,b.scaleX,d);this.info.scaleY=this.linear(a.scaleY,b.scaleY,d);this.info.a=this.linear(a.a,b.a,d)},paint:function(a,b){return new qd(a,
b)},__class__:Qb});var ge=function(a){this.paintDebugBones=!0;null!=a&&(this.length=a.has.resolve("length")?q.parseInt(a.att.resolve("length")):200,this.width=a.has.resolve("width")?q.parseInt(a.att.resolve("width")):10);Qb.call(this,a)};h["spriter.definitions.BoneTimelineKey"]=ge;ge.__name__=!0;ge.__super__=Qb;ge.prototype=v(Qb.prototype,{copy:function(){return this.clone(new ge)},clone:function(a){Qb.prototype.clone.call(this,a);a.length=this.length;a.width=this.width;a.paintDebugBones=this.paintDebugBones;
return a},paint:function(a,b){return new qd(a,b)},linearKey:function(a,b){if(!A.__instanceof(a,ge))throw new p("keyB must be BoneTimelineKeys");var c;c=A.__cast(a,ge);this.linearSpatialInfo(this.info,c.info,this.info.spin,b);this.paintDebugBones&&(this.length=q["int"](this.linear(this.length,c.length,b)),this.width=q["int"](this.linear(this.width,c.width,b)))},__class__:ge});var Ui=function(a){this.maps=[];this.id=q.parseInt(a.att.resolve("id"));this.name=a.att.resolve("name");for(a=a.nodes.resolve("map").iterator();null!=
a.head;)a.val=a.head[0],a.head=a.head[1],this.maps.push(new Ti(a.val))};h["spriter.definitions.CharacterMap"]=Ui;Ui.__name__=!0;Ui.prototype={__class__:Ui};var Vi=function(a){this.boneRefs=[];this.objectRefs=[];this.id=q.parseInt(a.att.resolve("id"));this.time=a.has.resolve("time")?q.parseInt(a.att.resolve("time")):0;for(var b=a.nodes.resolve("bone_ref").iterator();null!=b.head;)b.val=b.head[0],b.head=b.head[1],this.boneRefs.push(new rg(b.val));for(a=a.nodes.resolve("object_ref").iterator();null!=
a.head;)a.val=a.head[0],a.head=a.head[1],this.objectRefs.push(new rg(a.val))};h["spriter.definitions.MainlineKey"]=Vi;Vi.__name__=!0;Vi.prototype={__class__:Vi};var Ti=function(a){this.folder=q.parseInt(a.att.resolve("folder"));this.file=q.parseInt(a.att.resolve("file"));this.tarFolder=a.has.resolve("target_folder")?q.parseInt(a.att.resolve("target_folder")):-1;this.tarFile=a.has.resolve("target_file")?q.parseInt(a.att.resolve("target_file")):-1};h["spriter.definitions.MapInstruction"]=Ti;Ti.__name__=
!0;Ti.prototype={__class__:Ti};var Rb=function(a,b){Qb.call(this,a);null!=a&&(this.type=b,a=a.node.resolve("object"),this.useDefaultPivot=!a.has.resolve("pivot_x")&&!a.has.resolve("pivot_y"),this.pivot_x=a.has.resolve("pivot_x")?q.parseFloat(a.att.resolve("pivot_x")):0,this.pivot_y=a.has.resolve("pivot_y")?q.parseFloat(a.att.resolve("pivot_y")):1)};h["spriter.definitions.ObjectTimelineKey"]=Rb;Rb.__name__=!0;Rb.__super__=Qb;Rb.prototype=v(Qb.prototype,{copy:function(){return this.clone(new Rb)},clone:function(a){Qb.prototype.clone.call(this,
a);a.useDefaultPivot=this.useDefaultPivot;a.pivot_x=this.pivot_x;a.pivot_y=this.pivot_y;a.type=this.type;return a},paint:function(a,b){var c,d;this.useDefaultPivot?(c=a,d=b):(c=this.pivot_x,d=this.pivot_y);return new qd(c,d)},linearKey:function(a,b){if(!A.__instanceof(a,Rb))throw new p("keyB must be ObjectTimelineKey");var c;c=A.__cast(a,Rb);this.linearSpatialInfo(this.info,c.info,this.info.spin,b);this.useDefaultPivot||(this.pivot_x=this.linear(this.pivot_x,c.pivot_x,b),this.pivot_y=this.linear(this.pivot_y,
c.pivot_y,b))},__class__:Rb});var qd=function(a,b){null==b&&(b=1);null==a&&(a=0);this.pivotX=a;this.pivotY=b};h["spriter.definitions.PivotInfo"]=qd;qd.__name__=!0;qd.prototype={__class__:qd};var Wi=function(a,b,c,d){this.p1=a;this.p2=b;this.p3=c;this.p4=d};h["spriter.definitions.Quadrilateral"]=Wi;Wi.__name__=!0;Wi.prototype={__class__:Wi};var te=function(a,b){null==b&&(b=0);null==a&&(a=0);this.x=a;this.y=b};h["spriter.definitions.QuadPoint"]=te;te.__name__=!0;te.prototype={__class__:te};var rg=function(a){this.id=
q.parseInt(a.att.resolve("id"));this.parent=a.has.resolve("parent")?q.parseInt(a.att.resolve("parent")):-1;this.timeline=q.parseInt(a.att.resolve("timeline"));this.key=q.parseInt(a.att.resolve("key"))};h["spriter.definitions.Ref"]=rg;rg.__name__=!0;rg.prototype={__class__:rg};var Ca=h["spriter.definitions.MetaDispatch"]={__ename__:!0,__constructs__:["ONCE","ONCE_PER_LOOP","ALWAYS"]};Ca.ONCE=["ONCE",0];Ca.ONCE.toString=j;Ca.ONCE.__enum__=Ca;Ca.ONCE_PER_LOOP=["ONCE_PER_LOOP",1];Ca.ONCE_PER_LOOP.toString=
j;Ca.ONCE_PER_LOOP.__enum__=Ca;Ca.ALWAYS=["ALWAYS",2];Ca.ALWAYS.toString=j;Ca.ALWAYS.__enum__=Ca;Ca.__empty_constructs__=[Ca.ONCE,Ca.ONCE_PER_LOOP,Ca.ALWAYS];var Xi=function(){};h["spriter.interfaces.IScml"]=Xi;Xi.__name__=!0;Xi.prototype={__class__:Xi};var tg=function(a){this.metaDispatch=Ca.ONCE_PER_LOOP;this.endAnimRemoval=!0;this.currentEntity=this.currentAnimation="";if(null!=a){this.folders=[];this.entities=new D;a=new Mb(a.firstElement());"1.0"!=a.att.resolve("scml_version")&&null;for(a=a.get_elements();a.hasNext();){var b=
a.next();if("folder"==b.get_name())this.folders.push(new sg(b));else if("entity"==b.get_name()){var c=b.att.resolve("name"),d=new Yi(b);this.entities.set(c,d);"0"==b.att.resolve("id")&&(this.currentEntity=b.att.resolve("name"),this.currentAnimation=b.node.resolve("animation").att.resolve("name"))}else if("tag_list"==b.get_name()){null==this.tags&&(this.tags=[]);for(b=b.get_elements();b.hasNext();)this.tags.push(b.next().att.resolve("name"))}}this.activeCharacterMap=this.copyFolders()}};h["spriter.definitions.ScmlObject"]=
tg;tg.__name__=!0;tg.__interfaces__=[Xi];tg.prototype={getPivots:function(a,b){var c=this.activeCharacterMap[a].files[b];return null!=c?new qd(c.pivotX,c.pivotY):new qd},getFileName:function(a,b){var c=this.activeCharacterMap[a].files[b];return null!=c?c.name:null},onEndAnim:function(){if(null!=this.endAnimCallback){var a=this.endAnimCallback;this.endAnimRemoval&&(this.endAnimCallback=null);a()}},onTag:function(a){null!=this.tagCallback&&this.tagCallback(this.tags[a])},onVar:function(a,b){var c=this.entities.get(this.currentEntity).variables[a];
c.set(b)&&null!=this.varChangeCallback&&this.varChangeCallback(c)},setCurrentTime:function(a,b,c){var d=this.entities.get(this.currentEntity),e=d.animations.get(this.currentAnimation);this.spriterSpatialInfo=c;e.setCurrentTime(a,b,this,d)},copyFolders:function(){for(var a=[],b=0,c=this.folders.length;b<c;){var d=b++;a[d]=this.folders[d].copy()}return a},__class__:tg};var fe=function(a,b,c,d,e,i,m){null==m&&(m=1);null==i&&(i=1);null==e&&(e=1);null==d&&(d=1);null==c&&(c=0);null==b&&(b=0);null==a&&(a=
0);this.scaleX=this.scaleY=this.a=this.spin=1;this.x=this.y=this.angle=0;this.x=a;this.y=b;this.angle=c;this.scaleX=d;this.scaleY=e;this.a=i;this.spin=m};h["spriter.definitions.SpatialInfo"]=fe;fe.__name__=!0;fe.prototype={unmapFromParent:function(a){var b,c;c=0>a.scaleX*a.scaleY?360-this.angle+a.angle:this.angle+a.angle;var d=this.scaleX*a.scaleX,e=this.scaleY*a.scaleY,i=this.a*a.a;if(0!=this.x||0!=this.y){var m=this.x*a.scaleX,f=this.y*a.scaleY;b=Fd.toRadians(Fd.under360(a.angle));var r=Math.sin(b),
g=Math.cos(b);b=m*g-f*r+a.x;a=m*r+f*g+a.y}else b=a.x,a=a.y;return new fe(b,a,c,d,e,i,this.spin)},copy:function(){return new fe(this.x,this.y,this.angle,this.scaleX,this.scaleY,this.a,this.spin)},__class__:fe};var Gd=function(a){Rb.call(this,a);null!=a&&(a=a.node.resolve("object"),this.folder=a.has.resolve("folder")?q.parseInt(a.att.resolve("folder")):0,this.file=a.has.resolve("file")?q.parseInt(a.att.resolve("file")):0)};h["spriter.definitions.SpriteTimelineKey"]=Gd;Gd.__name__=!0;Gd.__super__=Rb;
Gd.prototype=v(Rb.prototype,{copy:function(){return this.clone(new Gd)},clone:function(a){Rb.prototype.clone.call(this,a);a.folder=this.folder;a.file=this.file;a.useDefaultPivot=this.useDefaultPivot;a.pivot_x=this.pivot_x;a.pivot_y=this.pivot_y;return a},__class__:Gd});var hc=h["spriter.definitions.LoopType"]={__ename__:!0,__constructs__:["LOOPING","NO_LOOPING"]};hc.LOOPING=["LOOPING",0];hc.LOOPING.toString=j;hc.LOOPING.__enum__=hc;hc.NO_LOOPING=["NO_LOOPING",1];hc.NO_LOOPING.toString=j;hc.NO_LOOPING.__enum__=
hc;hc.__empty_constructs__=[hc.LOOPING,hc.NO_LOOPING];var bj=function(a){this.loop=0;this.mainlineKeys=[];this.timelines=[];this.id=q.parseInt(a.att.resolve("id"));this.name=a.att.resolve("name");this.length=q.parseInt(a.att.resolve("length"));this.loopType=a.has.resolve("looping")?"true"==a.att.resolve("looping")?hc.LOOPING:hc.NO_LOOPING:hc.LOOPING;for(var b=a.node.resolve("mainline").nodes.resolve("key").iterator();null!=b.head;)b.val=b.head[0],b.head=b.head[1],this.mainlineKeys.push(new Vi(b.val));
for(b=a.nodes.resolve("timeline").iterator();null!=b.head;)b.val=b.head[0],b.head=b.head[1],this.timelines.push(new Zi(b.val));if(a.hasNode.resolve("meta")){a=a.node.resolve("meta");if(a.hasNode.resolve("tagline")){this.taglines=[];for(b=a.node.resolve("tagline").nodes.resolve("key").iterator();null!=b.head;)b.val=b.head[0],b.head=b.head[1],this.taglines.push(new $i(b.val))}if(a.hasNode.resolve("varline")){this.varlines=[];for(a=a.nodes.resolve("varline").iterator();null!=a.head;)a.val=a.head[0],
a.head=a.head[1],this.varlines.push(new aj(a.val))}}};h["spriter.definitions.SpriterAnimation"]=bj;bj.__name__=!0;bj.prototype={setCurrentTime:function(a,b,c,d){var e;switch(this.loopType[1]){case 0:e=this.loop;this.loop=a/this.length|0;a%=this.length;this.updateCharacter(this.mainlineKeyFromTime(a),a,b,c,d);c.metaDispatch==Ca.ONCE_PER_LOOP&&e!=this.loop&&this.resetMetaDispatch();if(1==this.loop&&1>e)c.onEndAnim();break;case 1:if(a=q["int"](Math.min(a,this.length)),this.updateCharacter(this.mainlineKeyFromTime(a),
a,b,c,d),a==this.length)c.onEndAnim()}},updateCharacter:function(a,b,c,d,e){for(var i=[],m,f,r,g=a.boneRefs.length,h=0;h<g;)r=h++,f=a.boneRefs[r],m=this.keyFromRef(f,b),r=0<=f.parent?i[f.parent]:d.spriterSpatialInfo,r=m.info.unmapFromParent(r),i.push(r);this.points=[];this.boxes=[];g=a.objectRefs.length;for(h=0;h<g;){r=h++;f=a.objectRefs[r];m=this.keyFromRef(f,b);r=0<=f.parent?i[f.parent]:d.spriterSpatialInfo;r=m.info.unmapFromParent(r);var j;if(A.__instanceof(m,Gd)){var k;k=A.__cast(m,Gd);j=d.getPivots(k.folder,
k.file);j=m.paint(j.pivotX,j.pivotY);m=d.getFileName(k.folder,k.file);null!=m&&c.addGraphic(d.spriterName,f.timeline,f.key,m,r,j)}else j=new qd,j=m.paint(j.pivotX,j.pivotY),A.__cast(m,Rb).type==ea.POINT?this.points.push(c.compute(r,j,0,0)):(f=this.getTimelineName(f.timeline),f=e.boxes_info.get(f),this.boxes.push(c.computeRectCoordinates(r,j,f.width,f.height)))}if(null!=this.taglines){b=0;for(c=this.taglines;b<c.length;)if(e=c[b],++b,e.time==a.time)if(d.metaDispatch==Ca.ALWAYS)d.onTag(e.id);else d.metaDispatch==
Ca.ONCE_PER_LOOP&&a.time!=e.get_lastDispatched()?(e.set_lastDispatched(a.time),d.onTag(e.id)):d.metaDispatch==Ca.ONCE&&!e.get_dispatched()&&(e.set_lastDispatched(a.time),d.onTag(e.id))}if(null!=this.varlines){b=0;for(c=this.varlines;b<c.length;){e=c[b];++b;i=0;for(g=e.keys;i<g.length;)if(r=g[i],++i,r.time==a.time)if(d.metaDispatch==Ca.ALWAYS)d.onVar(e.id,r.value);else d.metaDispatch==Ca.ONCE_PER_LOOP&&a.time!=r.get_lastDispatched()?(r.set_lastDispatched(a.time),d.onVar(e.id,r.value)):d.metaDispatch==
Ca.ONCE&&!r.get_dispatched()&&(r.set_lastDispatched(a.time),d.onVar(e.id,r.value))}}},mainlineKeyFromTime:function(a){for(var b=0,c=this.mainlineKeys.length,d=0;d<c;){var e=d++;this.mainlineKeys[e].time<=a&&(b=e);if(this.mainlineKeys[e].time>=a)break}return this.mainlineKeys[b]},keyFromRef:function(a,b){var c=this.timelines[a.timeline],d=c.keys[a.key].copy();if(1==c.keys.length||d.curveType==ya.INSTANT)return d;var e=a.key+1;if(e>=c.keys.length)if(this.loopType==hc.LOOPING)e=0;else return d;c=c.keys[e].copy();
e=c.time;e<d.time&&(e+=this.length);d.interpolate(c,e,b);return d},getTimelineName:function(a){return this.timelines[a].name},resetMetaDispatch:function(){if(null!=this.taglines)for(var a=0,b=this.taglines;a<b.length;){var c=b[a];++a;c.set_dispatched(!1)}},__class__:bj};var cj=function(a){null!=a&&(this.name=a.att.resolve("name"),this.pivotX=a.has.resolve("pivot_x")?q.parseFloat(a.att.resolve("pivot_x")):0,this.pivotY=a.has.resolve("pivot_y")?q.parseFloat(a.att.resolve("pivot_y")):0,this.width=a.has.resolve("w")?
q.parseFloat(a.att.resolve("w")):0,this.height=a.has.resolve("h")?q.parseFloat(a.att.resolve("h")):0)};h["spriter.definitions.SpriterBox"]=cj;cj.__name__=!0;cj.prototype={__class__:cj};var Yi=function(a){this.characterMaps=new D;this.animations=new D;this.variables=[];this.boxes_info=new D;this.id=q.parseInt(a.att.resolve("id"));this.name=a.att.resolve("name");for(var b=a.nodes.resolve("character_map").iterator();null!=b.head;){var c;b.val=b.head[0];b.head=b.head[1];c=b.val;var d=c.att.resolve("name");
c=new Ui(c);this.characterMaps.set(d,c)}if(a.hasNode.resolve("var_defs"))for(b=a.node.resolve("var_defs").get_elements();b.hasNext();)switch(d=b.next(),d.att.resolve("type")){case "int":this.variables.push(new ug(d.att.resolve("name"),q.parseInt(d.att.resolve("default"))));break;case "string":this.variables.push(new vg(d.att.resolve("name"),q.string(d.att.resolve("default"))));break;case "float":this.variables.push(new wg(d.att.resolve("name"),q.parseFloat(d.att.resolve("default"))))}for(b=a.nodes.resolve("obj_info").iterator();null!=
b.head;)b.val=b.head[0],b.head=b.head[1],c=b.val,d=c.att.resolve("name"),c=new cj(c),this.boxes_info.set(d,c);for(a=a.nodes.resolve("animation").iterator();null!=a.head;)a.val=a.head[0],a.head=a.head[1],d=a.val,b=d.att.resolve("name"),d=new bj(d),this.animations.set(b,d)};h["spriter.definitions.SpriterEntity"]=Yi;Yi.__name__=!0;Yi.prototype={__class__:Yi};var xg=function(a){null!=a&&(this.id=q.parseInt(a.att.resolve("id")),this.name=a.att.resolve("name"),this.pivotX=a.has.resolve("pivot_x")?q.parseFloat(a.att.resolve("pivot_x")):
0,this.pivotY=a.has.resolve("pivot_y")?q.parseFloat(a.att.resolve("pivot_y")):1,this.width=a.has.resolve("width")?q.parseFloat(a.att.resolve("width")):0,this.height=a.has.resolve("height")?q.parseFloat(a.att.resolve("height")):0)};h["spriter.definitions.SpriterFile"]=xg;xg.__name__=!0;xg.prototype={copy:function(){var a=new xg;a.name=this.name;a.id=this.id;a.pivotX=this.pivotX;a.pivotY=this.pivotY;a.width=this.width;a.height=this.height;return a},__class__:xg};var sg=function(a){this.name="";this.files=
[];if(null!=a){this.id=q.parseInt(a.att.resolve("id"));a.hasNode.resolve("name")&&(this.name=a.att.resolve("name"));for(a=a.nodes.resolve("file").iterator();null!=a.head;)a.val=a.head[0],a.head=a.head[1],this.files.push(new xg(a.val))}};h["spriter.definitions.SpriterFolder"]=sg;sg.__name__=!0;sg.prototype={copy:function(){var a=new sg;a.name=this.name;a.id=this.id;for(var b=0,c=this.files.length;b<c;){var d=b++;a.files[d]=this.files[d].copy()}return a},__class__:sg};var ea=h["spriter.definitions.ObjectType"]=
{__ename__:!0,__constructs__:"SPRITE,BONE,BOX,POINT,SOUND,ENTITY,VARIABLE".split(",")};ea.SPRITE=["SPRITE",0];ea.SPRITE.toString=j;ea.SPRITE.__enum__=ea;ea.BONE=["BONE",1];ea.BONE.toString=j;ea.BONE.__enum__=ea;ea.BOX=["BOX",2];ea.BOX.toString=j;ea.BOX.__enum__=ea;ea.POINT=["POINT",3];ea.POINT.toString=j;ea.POINT.__enum__=ea;ea.SOUND=["SOUND",4];ea.SOUND.toString=j;ea.SOUND.__enum__=ea;ea.ENTITY=["ENTITY",5];ea.ENTITY.toString=j;ea.ENTITY.__enum__=ea;ea.VARIABLE=["VARIABLE",6];ea.VARIABLE.toString=
j;ea.VARIABLE.__enum__=ea;ea.__empty_constructs__=[ea.SPRITE,ea.BONE,ea.BOX,ea.POINT,ea.SOUND,ea.ENTITY,ea.VARIABLE];var Zi=function(a){this.keys=[];this.id=q.parseInt(a.att.resolve("id"));this.name=a.has.resolve("name")?a.att.resolve("name"):"";this.objectType=a.has.resolve("object_type")?Ua.createEnum(ea,a.att.resolve("object_type").toUpperCase()):ea.SPRITE;switch(this.objectType[1]){case 0:for(a=a.nodes.resolve("key").iterator();null!=a.head;)a.val=a.head[0],a.head=a.head[1],this.keys.push(new Gd(a.val));
break;case 1:for(a=a.nodes.resolve("key").iterator();null!=a.head;)a.val=a.head[0],a.head=a.head[1],this.keys.push(new ge(a.val));break;case 3:for(a=a.nodes.resolve("key").iterator();null!=a.head;)a.val=a.head[0],a.head=a.head[1],this.keys.push(new Rb(a.val,this.objectType));break;case 2:for(a=a.nodes.resolve("key").iterator();null!=a.head;)a.val=a.head[0],a.head=a.head[1],this.keys.push(new Rb(a.val,this.objectType))}};h["spriter.definitions.SpriterTimeline"]=Zi;Zi.__name__=!0;Zi.prototype={__class__:Zi};
var $i=function(a){this._lastDispatched=-1;this._dispatched=!1;this.time=0;null!=a&&(this.id=a.has.resolve("id")?q.parseInt(a.att.resolve("id")):0,this.time=a.has.resolve("time")?q.parseInt(a.att.resolve("time")):0,a=a.node.resolve("tag"),this.t=q.parseInt(a.att.resolve("t")))};h["spriter.definitions.TaglineKey"]=$i;$i.__name__=!0;$i.prototype={set_lastDispatched:function(a){this._lastDispatched=a;this._dispatched=-1!=a;return a},get_lastDispatched:function(){return this._lastDispatched},set_dispatched:function(a){this._dispatched=
a;a||(this._lastDispatched=-1);return a},get_dispatched:function(){return this._dispatched},__class__:$i,__properties__:{set_lastDispatched:"set_lastDispatched",get_lastDispatched:"get_lastDispatched",set_dispatched:"set_dispatched",get_dispatched:"get_dispatched"}};var ya=h["spriter.definitions.CurveType"]={__ename__:!0,__constructs__:["INSTANT","LINEAR","QUADRATIC","CUBIC"]};ya.INSTANT=["INSTANT",0];ya.INSTANT.toString=j;ya.INSTANT.__enum__=ya;ya.LINEAR=["LINEAR",1];ya.LINEAR.toString=j;ya.LINEAR.__enum__=
ya;ya.QUADRATIC=["QUADRATIC",2];ya.QUADRATIC.toString=j;ya.QUADRATIC.__enum__=ya;ya.CUBIC=["CUBIC",3];ya.CUBIC.toString=j;ya.CUBIC.__enum__=ya;ya.__empty_constructs__=[ya.INSTANT,ya.LINEAR,ya.QUADRATIC,ya.CUBIC];var aj=function(a){if(null!=a){this.id=q.parseInt(a.att.resolve("def"));this.keys=[];for(a=a.nodes.resolve("key").iterator();null!=a.head;)a.val=a.head[0],a.head=a.head[1],this.keys.push(new dj(a.val))}};h["spriter.definitions.Varline"]=aj;aj.__name__=!0;aj.prototype={__class__:aj};var dj=
function(a){this._lastDispatched=-1;this._dispatched=!1;this.time=0;null!=a&&(this.id=a.has.resolve("id")?q.parseInt(a.att.resolve("id")):0,this.time=a.has.resolve("time")?q.parseInt(a.att.resolve("time")):0,this.value=a.att.resolve("val"))};h["spriter.definitions.VarlineKey"]=dj;dj.__name__=!0;dj.prototype={set_lastDispatched:function(a){this._lastDispatched=a;this._dispatched=-1!=a;return a},get_lastDispatched:function(){return this._lastDispatched},get_dispatched:function(){return this._dispatched},
__class__:dj,__properties__:{set_lastDispatched:"set_lastDispatched",get_lastDispatched:"get_lastDispatched",get_dispatched:"get_dispatched"}};var ej=function(a,b,c,d){this.playbackSpeed=1;this.paused=!1;this.timeMS=0;this.scml=b;this.library=c;this.spriterName=a;this.scml.spriterName=this.spriterName;this.info=d};h["spriter.engine.Spriter"]=ej;ej.__name__=!0;ej.prototype={advanceTime:function(a){this.paused||(this.timeMS+=a*this.playbackSpeed|0);this.scml.setCurrentTime(this.timeMS,this.library,
this.info)},playAnim:function(a,b,c){null==c&&(c=!0);if(null==a)return this.paused&&(this.paused=!1),this.timeMS=0,null!=b&&(this.scml.endAnimCallback=function(a,b,c,m){return function(){a(b,c,m)}}(b,this,this.scml.currentEntity,this.scml.currentAnimation),this.scml.endAnimRemoval=c),!0;return this.scml.entities.get(this.scml.currentEntity).animations.exists(a)?(this.paused&&(this.paused=!1),this.timeMS=0,this.scml.currentAnimation=a,null!=b&&(this.scml.endAnimCallback=function(a,b,c,m){return function(){a(b,
c,m)}}(b,this,this.scml.currentEntity,a),this.scml.endAnimRemoval=c),!0):!1},__class__:ej};var yg=function(a,b,c){ha.call(this);this._pack=a;a=b.split(".");a.pop();this._basePath=a.join(".");b=this._pack.getFile(b).toString();this._scml=new tg(o.parse(b));this._container=(new Va).add(new M);this._library=new ic(this._container,this._pack,this._basePath);this._spriter=new ej(c,this._scml,this._library,new fe)};h["spriter.flambe.SpriterMovie"]=yg;yg.__name__=!0;yg.__super__=ha;yg.prototype=v(ha.prototype,
{get_name:function(){return"SpriterMovie_1"},onStart:function(){this.owner.addChild(this._container)},onUpdate:function(a){this._library.clear();this._spriter.advanceTime(1E3*a|0)},playAnim:function(a){this._spriter.playAnim(a);return this},__class__:yg});var zg=function(a){this._basePath=a};h["spriter.library.AbstractLibrary"]=zg;zg.__name__=!0;zg.prototype={addGraphic:function(){throw new p("must be overrided");},compute:function(a,b,c,d){var e=Fd.under360(a.angle),i=e*Math.PI/180,m=Math.sin(i),
i=Math.cos(i),f=a.x,r=a.y,c=a.x-b.pivotX*c*a.scaleX,b=a.y+(1-b.pivotY)*d*a.scaleY;return new fe((c-f)*i-(b-r)*m+f,-((c-f)*m+(b-r)*i+r),e,a.scaleX,a.scaleY,a.a,a.spin)},computeRectCoordinates:function(a,b,c,d){var e=-Fd.under360(a.angle)*Math.PI/180,i=Math.sin(e),e=Math.cos(e),m=a.x,f=-a.y,r=m-c*a.scaleX*b.pivotX,b=f-d*a.scaleY*(1-b.pivotY),g=r+c*a.scaleX,h=b,g=(g-m)*e-(h-f)*i+m,h=(g-m)*i+(h-f)*e+f,c=r+c*a.scaleX,j=b+d*a.scaleY,c=(c-m)*e-(j-f)*i+m,j=(c-m)*i+(j-f)*e+f,d=b+d*a.scaleY,a=(r-m)*e-(d-f)*
i+m,d=(a-m)*i+(d-f)*e+f,r=(r-m)*e-(b-f)*i+m;return new Wi(new te(r,(r-m)*i+(b-f)*e+f),new te(g,h),new te(c,j),new te(a,d))},__class__:zg};var ic=function(a,b,c){this._basePath=c;this._pack=b;this._point=new ec;this._matrix=new Wa;this._rootEntity=a;ic._textures=new D;this._entityPool=(new qi(function(){return new Va})).setSize(25)};h["spriter.library.FlambeLibrary"]=ic;ic.__name__=!0;ic.__super__=zg;ic.prototype=v(zg.prototype,{getTexture:function(a){if(!ic._textures.exists(this._basePath+"."+a)){var b=
this._pack.getTexture(this._basePath+"."+a.substring(0,a.lastIndexOf(".")));ic._textures.set(this._basePath+"."+a,b)}return ic._textures.get(this._basePath+"."+a)},clear:function(){for(;null!=this._rootEntity.firstChild;){var a=this._rootEntity.firstChild;this._rootEntity.removeChild(a);this._entityPool.put(a)}this._rootEntity.add(new M)},addGraphic:function(a,b,c,d,e,i){a=this.getTexture(d);e=this.compute(e,i,a.get_width(),a.get_height());i=new Kd(a);i.getLocalMatrix().compose(e.x,e.y,e.scaleX,e.scaleY,
gd.toRadians(Fd.fixRotation(e.angle)));i.alpha.set__(e.a);this._rootEntity.addChild(this._entityPool.take().add(i))},__class__:ic});var Fd=function(){};h["spriter.util.SpriterUtil"]=Fd;Fd.__name__=!0;Fd.toRadians=function(a){return a*Math.PI/180};Fd.fixRotation=function(a){0==a&&(a=360);return 360-a};Fd.under360=function(a){for(;360<a;)a-=360;for(;0>a;)a+=360;return a};var tb=function(a,b){this.name=a;this.def=this.value=b};h["spriter.vars.Variable"]=tb;tb.__name__=!0;tb.prototype={set:function(){return!1},
__class__:tb};var wg=function(a,b){tb.call(this,a,b)};h["spriter.vars.VariableFloat"]=wg;wg.__name__=!0;wg.__super__=tb;wg.prototype=v(tb.prototype,{set:function(a){var b=this.value;this.value=parseFloat(a);return b!=this.value?!0:!1},__class__:wg});var ug=function(a,b){tb.call(this,a,b)};h["spriter.vars.VariableInt"]=ug;ug.__name__=!0;ug.__super__=tb;ug.prototype=v(tb.prototype,{set:function(a){var b=this.value;this.value=q.parseInt(a);return b!=this.value?!0:!1},__class__:ug});var vg=function(a,
b){tb.call(this,a,b)};h["spriter.vars.VariableString"]=vg;vg.__name__=!0;vg.__super__=tb;vg.prototype=v(tb.prototype,{set:function(a){var b=this.value;this.value=a;return b!=this.value?!0:!1},__class__:vg});var jc=function(){};h["tools.spark.Main"]=jc;jc.__name__=!0;jc.main=function(){Ag.init();jc._loadClientConfig()};jc._loadClientConfig=function(){R.successSignal.connect(jc._onClientConfigLoaded).once();R.initiateBatch();R.addFile(jc._getSkcUrl(),"config");R.loadBatch()};jc._onClientConfigLoaded=
function(){if(!1==(new fj(R.getFile("config"))).parseClient())w.logger.error("Failed to parse configuration file. Aborting...",null);else{B.init();Ag.createDisplayRenderers();for(var a=0,b=W.executeModules;a<b.length;){var c=b[a];++a;K.execute(c)}Y.root.add(new Bg)}};jc._getSkcUrl=function(){try{var a=Y._platform.getExternal().call("getMainSparkClientUrl");return 0==a.length?"main.skc":a}catch(b){return b instanceof p&&(b=b.val),"main.skc"}};var R=function(){};h["tools.spark.framework.Assets"]=R;
R.__name__=!0;R.init=function(){R._loader=new gj;R._loader.successSignal.connect(R._onLoaderSuccess);R._loader.errorSignal.connect(R._onLoaderError);R._loader.progressSignal.connect(R._onLoaderProgress);R.successSignal=new Cd;R.errorSignal=new fa;R.progressSignal=new zd};R._onLoaderSuccess=function(){R.successSignal.emit()};R._onLoaderError=function(a){R.errorSignal.emit(a)};R._onLoaderProgress=function(a,b){R.progressSignal.emit(a,b)};R.initiateBatch=function(){R._loader.startNewBatchLoad()};R.addFile=
function(a,b,c){null==c&&(c=!1);null==b&&(b=a);R._loader.addFile(b,a,c)};R.loadBatch=function(){R._loader.initiateLoad()};R.getAssetPackOf=function(a){return R._loader.getAssetPackOf(a)};R.getFile=function(a){return R._loader.getFile(a)};R.getTexture=function(a){return R._loader.getTexture(a)};R.getSound=function(a){return R._loader.getSound(a)};var pa=function(){};h["tools.spark.framework.Console"]=pa;pa.__name__=!0;pa.log=function(a){w.logger.info(a,null)};pa.info=function(a){w.logger.info(a,null)};
pa.debug=function(a){w.logger.info(a,null)};pa.warn=function(a){w.logger.warn(a,null)};pa.error=function(a){w.logger.error(a,null)};var Ag=function(){};h["tools.spark.framework.Framework"]=Ag;Ag.__name__=!0;Ag.init=function(){Object.defineProperty&&Object.defineProperty(Array.prototype,"__class__",{enumerable:!1});Y.init();Cg.init();R.init();W.init();K.init()};Ag.createDisplayRenderers=function(){Cg.createDisplayRenderers()};var K=function(){};h["tools.spark.framework.ModuleManager"]=K;K.__name__=
!0;K.init=function(){K._moduleStates=new D;K._modulesLoadQueue=[];K._modulesLoadQueueBytes=[];K._loadingBatch=!1;R.successSignal.connect(K._onLoaderSuccess);R.errorSignal.connect(K._onLoaderError);R.progressSignal.connect(K._onLoaderProgress)};K._onLoaderSuccess=function(){if(!1!=K._loadingBatch){K._loadingBatch=!1;var a=K._modulesLoadQueue[0];w.logger.info("Module Loader: SUCCESS LOADING: "+a,null);var b=ta.LOADED;K._moduleStates.set(a,b);b;K._modulesLoadQueue.shift();K._modulesLoadQueueBytes.shift();
K._executeModule(a);K._startLoadBatch()}};K._onLoaderError=function(a){w.logger.error("Module Loader: ERROR: "+a,null)};K._onLoaderProgress=function(){};K.execute=function(a){K.isModuleLoaded(a)?K._executeModule(a):K._loadModule(a)};K.getModuleState=function(a){if(null==K._moduleStates.get(a)){var b=ta.NOT_LOADED;K._moduleStates.set(a,b);b}return K._moduleStates.get(a)};K.isModuleLoaded=function(a){switch(K.getModuleState(a)[1]){case 0:case 1:return!1;case 2:case 3:case 4:return!0}};K.isModuleExecuted=
function(a){switch(K.getModuleState(a)[1]){case 0:case 1:case 2:return!1;case 3:case 4:return!0}};K._executeModule=function(a){if(K.isModuleExecuted(a))w.logger.warn("Error while trying to execute Module ["+a+"]. Module already executed. Ignoring..",null);else if(K.isModuleExecutable(a)){B.logic.createAndRun(W.modules.get(a).executeEntity);var b=ta.RUNNING;K._moduleStates.set(a,b);b}else w.logger.warn("Warning while trying to execute Module ["+a+"]. Module is not executable. Ignoring..",null)};K.isModuleExecutable=
function(a){return"none"==W.modules.get(a).executeEntity?!1:!0};K._loadModule=function(a){w.logger.info("LOADING MODULE: "+a,null);if(K.getModuleState(a)==ta.NOT_LOADED){for(var b=0,c=W.modules.get(a).requiresModules;b<c.length;){var d=c[b];++b;w.logger.info("LOADING MODULE REQUIREMENT: "+d,null);K.getModuleState(d)==ta.NOT_LOADED&&K._loadModule(d)}K._loadAssetsOfModule(a)}};K._loadAssetsOfModule=function(a){var b=0,c;for(c=W.modules.get(a).assets.iterator();c.hasNext();)var d=c.next(),b=b+q.parseInt(d.bytes);
c=ta.LOADING;K._moduleStates.set(a,c);c;K._modulesLoadQueue.push(a);K._modulesLoadQueueBytes.push(b);!1==K._loadingBatch&&K._startLoadBatch()};K._startLoadBatch=function(){if(0<K._modulesLoadQueue.length){var a=K._modulesLoadQueue[0];R.initiateBatch();for(a=W.modules.get(a).assets.iterator();a.hasNext();){var b=a.next();R.addFile(W.getPath(b.location,b.type)+b.url,b.id,"true"==b.forceLoadAsData)}R.loadBatch();K._loadingBatch=!0}};var W=function(){};h["tools.spark.framework.Project"]=W;W.__name__=
!0;W.init=function(){W.executeModules=[];W.sliced=new na;W.paths=new D;W.modules=new D};W.setPath=function(a,b,c){if(null==W.paths.get(a)){var d=new D;W.paths.set(a,d);d}W.paths.get(a).set(b,c);c};W.getPath=function(a,b){return null==W.paths.get(a)?null:W.paths.get(a).get(b)};var Bg=function(){ha.call(this)};h["tools.spark.framework.RootComponent"]=Bg;Bg.__name__=!0;Bg.__super__=ha;Bg.prototype=v(ha.prototype,{get_name:function(){return"RootComponent_0"},onUpdate:function(a){B.dt=a;B.input.update();
B.event.update();B.logic.update();B.display.update();B.comms.update()},__class__:Bg});var w=function(){};h["tools.spark.framework.SparkLog"]=w;w.__name__=!0;w.__super__=Ff;w.prototype=v(Ff.prototype,{__class__:w});var hj=function(a){this.id=a};h["tools.spark.framework.assets.Asset"]=hj;hj.__name__=!0;hj.prototype={__class__:hj};var ta=h["tools.spark.framework.assets.EModuleState"]={__ename__:!0,__constructs__:["NOT_LOADED","LOADING","LOADED","RUNNING","PAUSED"]};ta.NOT_LOADED=["NOT_LOADED",0];ta.NOT_LOADED.toString=
j;ta.NOT_LOADED.__enum__=ta;ta.LOADING=["LOADING",1];ta.LOADING.toString=j;ta.LOADING.__enum__=ta;ta.LOADED=["LOADED",2];ta.LOADED.toString=j;ta.LOADED.__enum__=ta;ta.RUNNING=["RUNNING",3];ta.RUNNING.toString=j;ta.RUNNING.__enum__=ta;ta.PAUSED=["PAUSED",4];ta.PAUSED.toString=j;ta.PAUSED.__enum__=ta;ta.__empty_constructs__=[ta.NOT_LOADED,ta.LOADING,ta.LOADED,ta.RUNNING,ta.PAUSED];var gj=function(){this._init()};h["tools.spark.framework.assets.FlambeLoader"]=gj;gj.__name__=!0;gj.prototype={_init:function(){this.successSignal=
new Cd;this.errorSignal=new fa;this.progressSignal=new zd;this._assetInUse=new D;this._assetToBatchLoad=new D;this._batchLoadToAssetPack=new Qa},startNewBatchLoad:function(){this._manifest=new dc},addFile:function(a,b,c){c?this._manifest.add(a,b,1,C.Data):this._manifest.add(a,b,1);b=this._manifest;this._assetToBatchLoad.set(a,b);b},getAssetPackOf:function(a){return this._batchLoadToAssetPack.h[this._assetToBatchLoad.get(a).__id__]},getFile:function(a){return this._batchLoadToAssetPack.h[this._assetToBatchLoad.get(a).__id__].getFile(a)},
getTexture:function(a){return this._batchLoadToAssetPack.h[this._assetToBatchLoad.get(a).__id__].getTexture(a)},getSound:function(a){return this._batchLoadToAssetPack.h[this._assetToBatchLoad.get(a).__id__].getSound(a)},initiateLoad:function(){this._promise=Y._platform.loadAssetPack(this._manifest);this._promiseSignalSuccess=this._promise.success.connect(y(this,this._onPromiseSuccess));this._promiseSignalError=this._promise.error.connect(y(this,this._onPromiseError));this._promiseSignalProgress=this._promise.progressChanged.connect(y(this,
this._onPromiseProgress))},_onPromiseSuccess:function(a){this._disposePromiseSignals();this._batchLoadToAssetPack.set(this._manifest,a);a;this.successSignal.emit()},_onPromiseError:function(a){this._disposePromiseSignals();this.errorSignal.emit(a)},_onPromiseProgress:function(){this.progressSignal.emit(this._promise._progress,this._promise._total)},_disposePromiseSignals:function(){this._promiseSignalSuccess.dispose();this._promiseSignalError.dispose();this._promiseSignalProgress.dispose()},__class__:gj};
var ij=function(a){this.id=a;this.requiresModules=[];this.assets=new D};h["tools.spark.framework.assets.Module"]=ij;ij.__name__=!0;ij.prototype={__class__:ij};var fj=function(a){this._configFile=a;this._initNodeNamesMap();this._initNodeTypesMap();this._configValidator=new jj(this._xmlNodeTypeToNodeName);this._configInstantiator=new kj(this._xmlNodeTypeToNodeName)};h["tools.spark.framework.config.Config"]=fj;fj.__name__=!0;fj.prototype={parseClient:function(){return this._parse(l.CLIENT)},_parse:function(a){var b;
w.logger.info("Config: Parsing...",null);try{b=o.parse(this._configFile.toString())}catch(c){return c instanceof p&&(c=c.val),w.logger.error(q.string(c),null),!1}b=b.firstElement();var d;if(b.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+b.nodeType));d=this._xmlNodeNameToNodeType.get(b.nodeName);if(d!=a)return w.logger.error("Config file is not correct. Expected Root Child: "+q.string(a)+", got: "+q.string(d)+".",null),!1;w.logger.info("Config: Validating...",
null);this._configValidator.init(a);if(!1==this._validateConfigNode(b))return w.logger.error("Config file could not be validated",null),!1;w.logger.info("Config: Instantiating...",null);this._configInstantiator.init(b,a);this._configInstantiator.instantiateProject();this._configInstantiator.instantiateSliced();this._configInstantiator.instantiatePaths();this._configInstantiator.instantiateAssets();w.logger.info("Config: Completed!",null);return!0},_validateConfigNode:function(a){var b;if(a.nodeType!=
o.Element)throw new p(new p("Bad node type, expected Element but found "+a.nodeType));b=this._xmlNodeNameToNodeType.get(a.nodeName);if(this._configValidator.validateConfigNode(a,b))return!0;for(a=a.elements();a.hasNext()&&!(!1==this._validateConfigNode(a.next())););return!1},_initNodeNamesMap:function(){this._xmlNodeTypeToNodeName=new na;this._xmlNodeTypeToNodeName.set(l.CLIENT,"Client");"Client";this._xmlNodeTypeToNodeName.set(l.SERVER,"Server");"Server";this._xmlNodeTypeToNodeName.set(l.PROJECT,
"Project");"Project";this._xmlNodeTypeToNodeName.set(l.SLICED,"Sliced");"Sliced";this._xmlNodeTypeToNodeName.set(l.PATHS,"Paths");"Paths";this._xmlNodeTypeToNodeName.set(l.ASSETS,"Assets");"Assets";this._xmlNodeTypeToNodeName.set(l.PROJECT_NAME,"Name");"Name";this._xmlNodeTypeToNodeName.set(l.PROJECT_VERSION,"Version");"Version";this._xmlNodeTypeToNodeName.set(l.EXECUTE_AT_LAUNCH,"ExecuteAtLaunch");"ExecuteAtLaunch";this._xmlNodeTypeToNodeName.set(l.EXECUTE_MODULE,"ExecuteModule");"ExecuteModule";
this._xmlNodeTypeToNodeName.set(l.SOUND_SERVICE,"Sound");"Sound";this._xmlNodeTypeToNodeName.set(l.LOGIC_SERVICE,"Logic");"Logic";this._xmlNodeTypeToNodeName.set(l.INPUT_SERVICE,"Input");"Input";this._xmlNodeTypeToNodeName.set(l.COMMUNICATIONS_SERVICE,"Comms");"Comms";this._xmlNodeTypeToNodeName.set(l.EVENT_SERVICE,"Event");"Event";this._xmlNodeTypeToNodeName.set(l.DISPLAY_SERVICE,"Display");"Display";this._xmlNodeTypeToNodeName.set(l.PATH,"Path");"Path";this._xmlNodeTypeToNodeName.set(l.MODULE,"Module");
"Module";this._xmlNodeTypeToNodeName.set(l.ASSET,"Asset");"Asset";this._xmlNodeTypeToNodeName.set(l.REQUIRES,"Requires");"Requires";this._xmlNodeTypeToNodeName.set(l.REQUIRES_MODULE,"RequiresModule");"RequiresModule"},_initNodeTypesMap:function(){this._xmlNodeNameToNodeType=new D;var a=this._xmlNodeTypeToNodeName.get(l.CLIENT),b=l.CLIENT;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.SERVER);b=l.SERVER;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.PROJECT);
b=l.PROJECT;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.SLICED);b=l.SLICED;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.PATHS);b=l.PATHS;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.ASSETS);b=l.ASSETS;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.PROJECT_NAME);b=l.PROJECT_NAME;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.PROJECT_VERSION);b=l.PROJECT_VERSION;
this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.EXECUTE_AT_LAUNCH);b=l.EXECUTE_AT_LAUNCH;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.EXECUTE_MODULE);b=l.EXECUTE_MODULE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.SOUND_SERVICE);b=l.SOUND_SERVICE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.LOGIC_SERVICE);b=l.LOGIC_SERVICE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.INPUT_SERVICE);
b=l.INPUT_SERVICE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.COMMUNICATIONS_SERVICE);b=l.COMMUNICATIONS_SERVICE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.EVENT_SERVICE);b=l.EVENT_SERVICE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.DISPLAY_SERVICE);b=l.DISPLAY_SERVICE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.PATH);b=l.PATH;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.MODULE);
b=l.MODULE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.ASSET);b=l.ASSET;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.REQUIRES);b=l.REQUIRES;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(l.REQUIRES_MODULE);b=l.REQUIRES_MODULE;this._xmlNodeNameToNodeType.set(a,b);b},__class__:fj};var kj=function(a){this._xmlNodeTypeToNodeName=a};h["tools.spark.framework.config.ConfigInstantiator"]=kj;kj.__name__=!0;kj.prototype=
{init:function(a,b){this._configNode=a;this._rootNodeType=b},instantiateProject:function(){var a=this._configNode.elementsNamed(this._xmlNodeTypeToNodeName.get(l.PROJECT)).next();W.$name=a.elementsNamed(this._xmlNodeTypeToNodeName.get(l.PROJECT_NAME)).next().firstChild().get_nodeValue();W.version=a.elementsNamed(this._xmlNodeTypeToNodeName.get(l.PROJECT_VERSION)).next().firstChild().get_nodeValue();W.type=this._rootNodeType;for(a=a.elementsNamed(this._xmlNodeTypeToNodeName.get(l.EXECUTE_AT_LAUNCH)).next().elements();a.hasNext();){var b=
a.next();W.executeModules.push(function(){if(b.nodeType!=o.Document&&b.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+b.nodeType);return b.children[0]}(this).get_nodeValue())}},instantiateSliced:function(){var a=this._configNode.elementsNamed(this._xmlNodeTypeToNodeName.get(l.SLICED)).next(),b=a.elementsNamed(this._xmlNodeTypeToNodeName.get(l.LOGIC_SERVICE)).next().firstChild().get_nodeValue();W.sliced.set(l.LOGIC_SERVICE,b);b;b=a.elementsNamed(this._xmlNodeTypeToNodeName.get(l.COMMUNICATIONS_SERVICE)).next().firstChild().get_nodeValue();
W.sliced.set(l.COMMUNICATIONS_SERVICE,b);b;b=a.elementsNamed(this._xmlNodeTypeToNodeName.get(l.EVENT_SERVICE)).next().firstChild().get_nodeValue();W.sliced.set(l.EVENT_SERVICE,b);b;W.type==l.CLIENT&&(b=a.elementsNamed(this._xmlNodeTypeToNodeName.get(l.SOUND_SERVICE)).next().firstChild().get_nodeValue(),W.sliced.set(l.SOUND_SERVICE,b),b,b=a.elementsNamed(this._xmlNodeTypeToNodeName.get(l.INPUT_SERVICE)).next().firstChild().get_nodeValue(),W.sliced.set(l.INPUT_SERVICE,b),b,a=a.elementsNamed(this._xmlNodeTypeToNodeName.get(l.DISPLAY_SERVICE)).next().firstChild().get_nodeValue(),
W.sliced.set(l.DISPLAY_SERVICE,a),a)},instantiatePaths:function(){for(var a=this._configNode.elementsNamed(this._xmlNodeTypeToNodeName.get(l.PATHS)).next().elements();a.hasNext();){var b=a.next();W.setPath(b.get("location"),b.get("type"),function(){if(b.nodeType!=o.Document&&b.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+b.nodeType);return b.children[0]}(this).get_nodeValue())}},instantiateAssets:function(){for(var a=this._configNode.elementsNamed(this._xmlNodeTypeToNodeName.get(l.ASSETS)).next().elements();a.hasNext();){var b=
a.next(),c=b.get("id"),b=this._instantiateModule(b);W.modules.set(c,b);b}},_instantiateModule:function(a){var b=new ij(a.get("id"));b.executeEntity=a.get("executeEntity");if(a.elementsNamed(this._xmlNodeTypeToNodeName.get(l.REQUIRES)).hasNext())for(var c=a.elementsNamed(this._xmlNodeTypeToNodeName.get(l.REQUIRES)).next().elements();c.hasNext();){var d=c.next();b.requiresModules.push(function(){if(d.nodeType!=o.Document&&d.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+
d.nodeType);return d.children[0]}(this).get_nodeValue())}for(a=a.elementsNamed(this._xmlNodeTypeToNodeName.get(l.ASSET));a.hasNext();)c=this._instantiateAsset(a.next()),b.assets.set(c.id,c),c;return b},_instantiateAsset:function(a){var b;if("useUrl"==a.get("id")){if(a.nodeType!=o.Document&&a.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+a.nodeType);b=a.children[0].get_nodeValue()}else b=a.get("id");b=new hj(b);if(a.nodeType!=o.Document&&a.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+
a.nodeType);b.url=a.children[0].get_nodeValue();b.type=a.get("type");b.subtype=a.get("subtype");b.location=a.get("location");b.bytes=a.get("bytes");b.condition=a.get("condition");b.forceLoadAsData=a.get("forceLoadAsData");return b},__class__:kj};var jj=function(a){this._xmlNodeTypeToNodeName=a};h["tools.spark.framework.config.ConfigValidator"]=jj;jj.__name__=!0;jj.prototype={init:function(a){this._initNodeRulesMap(a)},_initNodeRulesMap:function(a){this._xmlNodeTypeToNodeRule=new na;var b=this._createRequiresModuleNodeRule();
this._xmlNodeTypeToNodeRule.set(l.REQUIRES_MODULE,b);b;b=this._createRequiresNodeRule();this._xmlNodeTypeToNodeRule.set(l.REQUIRES,b);b;b=this._createAssetNodeRule();this._xmlNodeTypeToNodeRule.set(l.ASSET,b);b;b=this._createModuleNodeRule();this._xmlNodeTypeToNodeRule.set(l.MODULE,b);b;b=this._createAssetsNodeRule();this._xmlNodeTypeToNodeRule.set(l.ASSETS,b);b;b=this._createPathNodeRule();this._xmlNodeTypeToNodeRule.set(l.PATH,b);b;b=this._createPathsNodeRule();this._xmlNodeTypeToNodeRule.set(l.PATHS,
b);b;b=this._createSoundServiceNodeRule();this._xmlNodeTypeToNodeRule.set(l.SOUND_SERVICE,b);b;b=this._createLogicServiceNodeRule();this._xmlNodeTypeToNodeRule.set(l.LOGIC_SERVICE,b);b;b=this._createInputServiceNodeRule();this._xmlNodeTypeToNodeRule.set(l.INPUT_SERVICE,b);b;b=this._createCommsServiceNodeRule();this._xmlNodeTypeToNodeRule.set(l.COMMUNICATIONS_SERVICE,b);b;b=this._createEventServiceNodeRule();this._xmlNodeTypeToNodeRule.set(l.EVENT_SERVICE,b);b;b=this._createDisplayServiceNodeRule();
this._xmlNodeTypeToNodeRule.set(l.DISPLAY_SERVICE,b);b;b=this._createExecuteModuleNodeRule();this._xmlNodeTypeToNodeRule.set(l.EXECUTE_MODULE,b);b;b=this._createExecuteAtLaunchNodeRule();this._xmlNodeTypeToNodeRule.set(l.EXECUTE_AT_LAUNCH,b);b;b=this._createProjectNameNodeRule();this._xmlNodeTypeToNodeRule.set(l.PROJECT_NAME,b);b;b=this._createProjectVersionNodeRule();this._xmlNodeTypeToNodeRule.set(l.PROJECT_VERSION,b);b;b=this._createProjectNodeRule();this._xmlNodeTypeToNodeRule.set(l.PROJECT,b);
b;a==l.CLIENT?(a=this._createSlicedClientNodeRule(),this._xmlNodeTypeToNodeRule.set(l.SLICED,a),a,a=this._createClientNodeRule(),this._xmlNodeTypeToNodeRule.set(l.CLIENT,a),a):a==l.SERVER&&(a=this._createSlicedServerNodeRule(),this._xmlNodeTypeToNodeRule.set(l.SLICED,a),a,a=this._createServerNodeRule(),this._xmlNodeTypeToNodeRule.set(l.SERVER,a),a)},validateConfigNode:function(a,b){if(null==this._xmlNodeTypeToNodeRule.get(b))return w.logger.error("This Config Node Rule has not been created Yet!",
null),!1;try{return I.checkNode(a,this._xmlNodeTypeToNodeRule.get(b)),!0}catch(c){c instanceof p&&(c=c.val);if(A.__instanceof(c,String))return w.logger.error(c,null),!1;throw c;}},_createClientNodeRule:function(){var a=G.RList([this._xmlNodeTypeToNodeRule.get(l.PROJECT),this._xmlNodeTypeToNodeRule.get(l.SLICED),this._xmlNodeTypeToNodeRule.get(l.PATHS),this._xmlNodeTypeToNodeRule.get(l.ASSETS)],!1);return G.RNode(this._xmlNodeTypeToNodeName.get(l.CLIENT),[],a)},_createServerNodeRule:function(){var a=
G.RList([this._xmlNodeTypeToNodeRule.get(l.PROJECT),this._xmlNodeTypeToNodeRule.get(l.SLICED),this._xmlNodeTypeToNodeRule.get(l.PATHS),this._xmlNodeTypeToNodeRule.get(l.ASSETS)],!1);return G.RNode(this._xmlNodeTypeToNodeName.get(l.SERVER),[],a)},_createProjectNodeRule:function(){var a=G.RList([this._xmlNodeTypeToNodeRule.get(l.PROJECT_NAME),this._xmlNodeTypeToNodeRule.get(l.PROJECT_VERSION),this._xmlNodeTypeToNodeRule.get(l.EXECUTE_AT_LAUNCH)],!1);return G.RNode(this._xmlNodeTypeToNodeName.get(l.PROJECT),
[],a)},_createProjectNameNodeRule:function(){var a=G.RData();return G.RNode(this._xmlNodeTypeToNodeName.get(l.PROJECT_NAME),[],a)},_createProjectVersionNodeRule:function(){var a=G.RData();return G.RNode(this._xmlNodeTypeToNodeName.get(l.PROJECT_VERSION),[],a)},_createExecuteAtLaunchNodeRule:function(){var a=G.RMulti(this._xmlNodeTypeToNodeRule.get(l.EXECUTE_MODULE),!0);return G.RNode(this._xmlNodeTypeToNodeName.get(l.EXECUTE_AT_LAUNCH),[],a)},_createExecuteModuleNodeRule:function(){var a=G.RData();
return G.RNode(this._xmlNodeTypeToNodeName.get(l.EXECUTE_MODULE),[],a)},_createSlicedClientNodeRule:function(){var a=G.RList([this._xmlNodeTypeToNodeRule.get(l.SOUND_SERVICE),this._xmlNodeTypeToNodeRule.get(l.LOGIC_SERVICE),this._xmlNodeTypeToNodeRule.get(l.INPUT_SERVICE),this._xmlNodeTypeToNodeRule.get(l.COMMUNICATIONS_SERVICE),this._xmlNodeTypeToNodeRule.get(l.EVENT_SERVICE),this._xmlNodeTypeToNodeRule.get(l.DISPLAY_SERVICE)],!1);return G.RNode(this._xmlNodeTypeToNodeName.get(l.SLICED),[],a)},_createSlicedServerNodeRule:function(){var a=
G.RList([this._xmlNodeTypeToNodeRule.get(l.LOGIC_SERVICE),this._xmlNodeTypeToNodeRule.get(l.COMMUNICATIONS_SERVICE),this._xmlNodeTypeToNodeRule.get(l.EVENT_SERVICE)],!1);return G.RNode(this._xmlNodeTypeToNodeName.get(l.SLICED),[],a)},_createSoundServiceNodeRule:function(){var a=G.RData();return G.RNode(this._xmlNodeTypeToNodeName.get(l.SOUND_SERVICE),[],a)},_createLogicServiceNodeRule:function(){var a=G.RData();return G.RNode(this._xmlNodeTypeToNodeName.get(l.LOGIC_SERVICE),[],a)},_createInputServiceNodeRule:function(){var a=
G.RData();return G.RNode(this._xmlNodeTypeToNodeName.get(l.INPUT_SERVICE),[],a)},_createCommsServiceNodeRule:function(){var a=G.RData();return G.RNode(this._xmlNodeTypeToNodeName.get(l.COMMUNICATIONS_SERVICE),[],a)},_createEventServiceNodeRule:function(){var a=G.RData();return G.RNode(this._xmlNodeTypeToNodeName.get(l.EVENT_SERVICE),[],a)},_createDisplayServiceNodeRule:function(){var a=G.RData();return G.RNode(this._xmlNodeTypeToNodeName.get(l.DISPLAY_SERVICE),[],a)},_createPathsNodeRule:function(){var a=
G.RMulti(this._xmlNodeTypeToNodeRule.get(l.PATH),!0);return G.RNode(this._xmlNodeTypeToNodeName.get(l.PATHS),[],a)},_createPathNodeRule:function(){var a=G.RData(),b=[Ya.Att("location"),Ya.Att("type")];return G.RNode(this._xmlNodeTypeToNodeName.get(l.PATH),b,a)},_createAssetsNodeRule:function(){var a=G.RMulti(this._xmlNodeTypeToNodeRule.get(l.MODULE),!0);return G.RNode(this._xmlNodeTypeToNodeName.get(l.ASSETS),[],a)},_createModuleNodeRule:function(){var a=G.RList([G.ROptional(this._xmlNodeTypeToNodeRule.get(l.REQUIRES)),
G.RMulti(this._xmlNodeTypeToNodeRule.get(l.ASSET),!0)],!1),b=[Ya.Att("id"),Ya.Att("executeEntity",null,"none")];return G.RNode(this._xmlNodeTypeToNodeName.get(l.MODULE),b,a)},_createAssetNodeRule:function(){var a=G.RData(),b=[Ya.Att("location"),Ya.Att("type"),Ya.Att("bytes"),Ya.Att("subtype",null,"none"),Ya.Att("id",null,"useUrl"),Ya.Att("condition",null,"always"),Ya.Att("forceLoadAsData",null,"false")];return G.RNode(this._xmlNodeTypeToNodeName.get(l.ASSET),b,a)},_createRequiresNodeRule:function(){var a=
G.RMulti(this._xmlNodeTypeToNodeRule.get(l.REQUIRES_MODULE),!0);return G.RNode(this._xmlNodeTypeToNodeName.get(l.REQUIRES),[],a)},_createRequiresModuleNodeRule:function(){var a=G.RData();return G.RNode(this._xmlNodeTypeToNodeName.get(l.REQUIRES_MODULE),[],a)},__class__:jj};var l=h["tools.spark.framework.config.ENodeType"]={__ename__:!0,__constructs__:"CLIENT,SERVER,PROJECT,SLICED,PATHS,ASSETS,PROJECT_NAME,PROJECT_VERSION,EXECUTE_AT_LAUNCH,EXECUTE_MODULE,SOUND_SERVICE,LOGIC_SERVICE,INPUT_SERVICE,COMMUNICATIONS_SERVICE,EVENT_SERVICE,DISPLAY_SERVICE,PATH,MODULE,ASSET,REQUIRES,REQUIRES_MODULE".split(",")};
l.CLIENT=["CLIENT",0];l.CLIENT.toString=j;l.CLIENT.__enum__=l;l.SERVER=["SERVER",1];l.SERVER.toString=j;l.SERVER.__enum__=l;l.PROJECT=["PROJECT",2];l.PROJECT.toString=j;l.PROJECT.__enum__=l;l.SLICED=["SLICED",3];l.SLICED.toString=j;l.SLICED.__enum__=l;l.PATHS=["PATHS",4];l.PATHS.toString=j;l.PATHS.__enum__=l;l.ASSETS=["ASSETS",5];l.ASSETS.toString=j;l.ASSETS.__enum__=l;l.PROJECT_NAME=["PROJECT_NAME",6];l.PROJECT_NAME.toString=j;l.PROJECT_NAME.__enum__=l;l.PROJECT_VERSION=["PROJECT_VERSION",7];l.PROJECT_VERSION.toString=
j;l.PROJECT_VERSION.__enum__=l;l.EXECUTE_AT_LAUNCH=["EXECUTE_AT_LAUNCH",8];l.EXECUTE_AT_LAUNCH.toString=j;l.EXECUTE_AT_LAUNCH.__enum__=l;l.EXECUTE_MODULE=["EXECUTE_MODULE",9];l.EXECUTE_MODULE.toString=j;l.EXECUTE_MODULE.__enum__=l;l.SOUND_SERVICE=["SOUND_SERVICE",10];l.SOUND_SERVICE.toString=j;l.SOUND_SERVICE.__enum__=l;l.LOGIC_SERVICE=["LOGIC_SERVICE",11];l.LOGIC_SERVICE.toString=j;l.LOGIC_SERVICE.__enum__=l;l.INPUT_SERVICE=["INPUT_SERVICE",12];l.INPUT_SERVICE.toString=j;l.INPUT_SERVICE.__enum__=
l;l.COMMUNICATIONS_SERVICE=["COMMUNICATIONS_SERVICE",13];l.COMMUNICATIONS_SERVICE.toString=j;l.COMMUNICATIONS_SERVICE.__enum__=l;l.EVENT_SERVICE=["EVENT_SERVICE",14];l.EVENT_SERVICE.toString=j;l.EVENT_SERVICE.__enum__=l;l.DISPLAY_SERVICE=["DISPLAY_SERVICE",15];l.DISPLAY_SERVICE.toString=j;l.DISPLAY_SERVICE.__enum__=l;l.PATH=["PATH",16];l.PATH.toString=j;l.PATH.__enum__=l;l.MODULE=["MODULE",17];l.MODULE.toString=j;l.MODULE.__enum__=l;l.ASSET=["ASSET",18];l.ASSET.toString=j;l.ASSET.__enum__=l;l.REQUIRES=
["REQUIRES",19];l.REQUIRES.toString=j;l.REQUIRES.__enum__=l;l.REQUIRES_MODULE=["REQUIRES_MODULE",20];l.REQUIRES_MODULE.toString=j;l.REQUIRES_MODULE.__enum__=l;l.__empty_constructs__=[l.CLIENT,l.SERVER,l.PROJECT,l.SLICED,l.PATHS,l.ASSETS,l.PROJECT_NAME,l.PROJECT_VERSION,l.EXECUTE_AT_LAUNCH,l.EXECUTE_MODULE,l.SOUND_SERVICE,l.LOGIC_SERVICE,l.INPUT_SERVICE,l.COMMUNICATIONS_SERVICE,l.EVENT_SERVICE,l.DISPLAY_SERVICE,l.PATH,l.MODULE,l.ASSET,l.REQUIRES,l.REQUIRES_MODULE];var jf=function(){};h["tools.spark.framework.space2_5D.interfaces.IBase2_5D"]=
jf;jf.__name__=!0;jf.prototype={__class__:jf};var rd=function(a){this.gameEntity=a};h["tools.spark.framework.space2_5D.core.ABase2_5D"]=rd;rd.__name__=!0;rd.__interfaces__=[jf];rd.prototype={setPosSize:function(a,b,c,d){!0==this.gameEntity.getState("layoutable")&&(null!=a&&this.gameEntity.setState("feedbackX",a),null!=b&&this.gameEntity.setState("feedbackY",b),null!=c&&this.gameEntity.setState("feedbackWidth",c),null!=d&&this.gameEntity.setState("feedbackHeight",d))},__class__:rd};var Dg=function(){};
h["tools.spark.framework.space2_5D.interfaces.IObject2_5D"]=Dg;Dg.__name__=!0;Dg.__interfaces__=[jf];var Cc=function(a){this.gameEntity=a};h["tools.spark.framework.space2_5D.core.AObject2_5D"]=Cc;Cc.__name__=!0;Cc.__interfaces__=[Dg];Cc.__super__=rd;Cc.prototype=v(rd.prototype,{__class__:Cc});var Eg=function(){};h["tools.spark.framework.space2_5D.interfaces.ICamera2_5D"]=Eg;Eg.__name__=!0;Eg.__interfaces__=[Dg];Eg.prototype={__class__:Eg};var Ma=function(a){this.gameEntity=a;this._initACamera2_5D()};
h["tools.spark.framework.space2_5D.core.ACamera2_5D"]=Ma;Ma.__name__=!0;Ma.__interfaces__=[Eg];Ma.__super__=Cc;Ma.prototype=v(Cc.prototype,{_initACamera2_5D:function(){this._attachedToViews=new Qa},attachToView:function(a){this._attachedToViews.set(a,a);a;return null},__class__:Ma});var kf=function(a){Ma.call(this,a)};h["tools.spark.framework.dom2_5D.DomCamera2_5D"]=kf;kf.__name__=!0;kf.__super__=Ma;kf.prototype=v(Ma.prototype,{__class__:kf});var lj=function(){};h["tools.spark.framework.space2_5D.interfaces.IObjectContainer2_5D"]=
lj;lj.__name__=!0;lj.__interfaces__=[Dg];var Za=function(a){this.gameEntity=a;this.children=[]};h["tools.spark.framework.space2_5D.core.AObjectContainer2_5D"]=Za;Za.__name__=!0;Za.__interfaces__=[lj];Za.__super__=Cc;Za.prototype=v(Cc.prototype,{addChild:function(a){this.children.push(a)},removeChild:function(a){E.remove(this.children,a)},__class__:Za});var ue=function(){};h["tools.spark.framework.space2_5D.interfaces.IInstantiable2_5D"]=ue;ue.__name__=!0;ue.__interfaces__=[lj];ue.prototype={__class__:ue};
var Sb=function(a){Za.call(this,a);this._instances=new Qa;this._updateStateFunctions=new D;this._queryFunctions=new D;this.groupInstances=new Qa};h["tools.spark.framework.space2_5D.core.AInstantiable2_5D"]=Sb;Sb.__name__=!0;Sb.__interfaces__=[ue];Sb.__super__=Za;Sb.prototype=v(Za.prototype,{getInstance:function(a){return this._instances.h[a.__id__]},_updateState:function(a,b){if(null==b)for(var c=this._instances.keys();c.hasNext();){var d=c.next();null!=this._updateStateFunctions.get(a)?this._updateStateFunctions.get(a)(this.gameEntity.getState(a),
d):w.logger.warn("State "+a+" does not have a function handler! Ignoring :(",null)}else null!=this._updateStateFunctions.get(a)?this._updateStateFunctions.get(a)(this.gameEntity.getState(a),b):w.logger.warn("State "+a+" does not have a function handler! Ignoring :(",null)},query:function(a,b,c,d){null==d&&(d=!1);null==c?a=d?null:this._instances.keys().hasNext()?this._queryInstance(a,b,this._instances.keys().next()):null:null!=this._queryFunctions.get(a)?a=this._queryFunctions.get(a)(b,c):(w.logger.warn("Query "+
a+" does not have a function handler! Returning null :(",null),a=null);return a},_queryInstance:function(a,b,c){if(null!=this._queryFunctions.get(a))return this._queryFunctions.get(a)(b,c);w.logger.warn("Query "+a+" does not have a function handler! Returning null :(",null);return null},_updateLayoutGroup:function(a){if(null==a)for(a=this.groupInstances.keys();a.hasNext();)this.groupInstances.h[a.next().__id__].update();else this.groupInstances.h[a.__id__].update()},_createChildrenOfInstance:function(a){for(var b=
0,c=this.children;b<c.length;){var d=c[b];++b;this._createChildOfInstance(d,a)}},createInstance:function(a){this._createChildrenOfInstance(a);return this._instances.h[a.__id__]},_createChildOfInstance:function(){},_removeChildOfInstance:function(){},update:function(){},addChild:function(a){Za.prototype.addChild.call(this,a);for(var b=this._instances.keys();b.hasNext();){var c=b.next();this._createChildOfInstance(a,c);a.update(c)}},removeChild:function(a){Za.prototype.removeChild.call(this,a);for(var b=
this._instances.keys();b.hasNext();){var c=b.next();this._removeChildOfInstance(a,c)}},__class__:Sb});var Fg=function(){};h["tools.spark.framework.space2_5D.interfaces.IEntity2_5D"]=Fg;Fg.__name__=!0;Fg.__interfaces__=[ue];Fg.prototype={__class__:Fg};var Fb=function(a){Sb.call(this,a)};h["tools.spark.framework.space2_5D.core.AEntity2_5D"]=Fb;Fb.__name__=!0;Fb.__interfaces__=[Fg];Fb.__super__=Sb;Fb.prototype=v(Sb.prototype,{createInstance:function(a){if(!0==this.gameEntity.getState("layoutable")){var b=
new ye(this.gameEntity,"Entity",this);this.groupInstances.set(a,b);b}return Sb.prototype.createInstance.call(this,a)},_createChildOfInstance:function(a,b){!0==a.gameEntity.getState("layoutable")&&this.groupInstances.h[b.__id__].children.push(a.groupInstances.h[b.__id__])},_removeChildOfInstance:function(a,b){!0==a.gameEntity.getState("layoutable")&&E.remove(this.groupInstances.h[b.__id__].children,a.groupInstances.h[b.__id__])},__class__:Fb});var ub=function(a){Sb.call(this,a);this._initDomEntity2_5D()};
h["tools.spark.framework.dom2_5D.DomEntity2_5D"]=ub;ub.__name__=!0;ub.__super__=Fb;ub.prototype=v(Fb.prototype,{_initDomEntity2_5D:function(){var a=y(this,this._updateNCmeshType);this._updateStateFunctions.set("NCmeshType",a);a;a=y(this,this._updateTouchable);this._updateStateFunctions.set("touchable",a);a;a=y(this,this._updateAcceptsKeyboardInput);this._updateStateFunctions.set("acceptsKeyboardInput",a);a;a=y(this,this._updateDraggable);this._updateStateFunctions.set("draggable",a);a;a=y(this,this._updateDropTarget);
this._updateStateFunctions.set("dropTarget",a);a;a=y(this,this._updateNCstyleable);this._updateStateFunctions.set("NCstyleable",a);a;a=y(this,this._updateVisibility);this._updateStateFunctions.set("visibility",a);a;a=y(this,this._updateOpacity);this._updateStateFunctions.set("opacity",a);a;a=y(this,this._updateDisplay);this._updateStateFunctions.set("display",a);a;a=y(this,this._updateText);this._updateStateFunctions.set("text",a);a;a=y(this,this._updateFontColor);this._updateStateFunctions.set("fontColor",
a);a;a=y(this,this._updateImageSrc);this._updateStateFunctions.set("src",a);a;a=y(this,this._updateFontSize);this._updateStateFunctions.set("fontSize",a);a;a=y(this,this._updateFontWeight);this._updateStateFunctions.set("fontWeight",a);a;a=y(this,this._updateOverflow);this._updateStateFunctions.set("overflow",a);a;a=y(this,this._updateWidth);this._updateStateFunctions.set("width",a);a;a=y(this,this._updateHeight);this._updateStateFunctions.set("height",a);a;a=y(this,this._updateTop);this._updateStateFunctions.set("top",
a);a;a=y(this,this._updateLeft);this._updateStateFunctions.set("left",a);a;a=y(this,this._updateBackgroundColor);this._updateStateFunctions.set("backgroundColor",a);a;a=y(this,this._updateBorder);this._updateStateFunctions.set("border",a);a;a=y(this,this._updateBorderColor);this._updateStateFunctions.set("borderColor",a);a;a=y(this,this._queryGlobalPosition);this._queryFunctions.set("globalPosition",a);a},createInstance:function(a){switch(this.gameEntity.getState("NCmeshType")){case "Div":var b;b=
window.document.createElement("div");this._instances.set(a,b);b;break;case "Input":b=window.document.createElement("input");this._instances.set(a,b);b;this._instances.h[a.__id__].onchange=y(this,this._onChange);this._instances.h[a.__id__].style.outline="0";break;case "Button":b=window.document.createElement("div");this._instances.set(a,b);b;this._instances.h[a.__id__].style.outline="0";break;case "Image":b=window.document.createElement("img");this._instances.set(a,b);b;break;case "Ace":b=window.document.createElement("div");
this._instances.set(a,b);b;break;case "Tree":b=window.document.createElement("div");this._instances.set(a,b);b;break;default:w.logger.error("Unrecognised NCMeshType input. Creating a Div By Default.",null),b=window.document.createElement("div"),this._instances.set(a,b),b}this._instances.h[a.__id__].style.position="absolute";return Fb.prototype.createInstance.call(this,a)},_createChildOfInstance:function(a,b){this._instances.h[b.__id__].appendChild(A.__cast(a.createInstance(b),HTMLElement));Fb.prototype._createChildOfInstance.call(this,
a,b)},_removeChildOfInstance:function(a,b){this._instances.h[b.__id__].removeChild(A.__cast(a.getInstance(b),HTMLElement));Fb.prototype._removeChildOfInstance.call(this,a,b)},update:function(a){this._updateState("NCmeshType",a);!0==this.gameEntity.getState("NCstyleable")&&(this._updateState("NCstyleable",a),this._updateState("visibility",a),this._updateState("opacity",a),this._updateState("fontSize",a),this._updateState("fontWeight",a),this._updateState("fontColor",a),this._updateState("overflow",
a),this._updateState("backgroundColor",a),this._updateState("border",a),this._updateState("borderColor",a));this._updateState("display",a);this._updateState("touchable",a);this._updateState("acceptsKeyboardInput",a);this._updateState("draggable",a);this._updateState("dropTarget",a);null!=this.gameEntity.getState("text")&&this._updateState("text",a);!0==this.gameEntity.getState("layoutable")&&this._updateLayoutGroup(a);for(var b=0,c=this.children;b<c.length;){var d=c[b];++b;d.update(a)}},setPosSize:function(a,
b,c,d,e){var i=this._instances.h[e.__id__];null!=i&&(null!=a&&(i.style.left=(null==a?"null":""+a)+"px"),null!=b&&(i.style.top=(null==b?"null":""+b)+"px"),null!=c&&(i.style.width=(null==c?"null":""+c)+"px"),null!=d&&(i.style.height=(null==d?"null":""+d)+"px"));Fb.prototype.setPosSize.call(this,a,b,c,d,e)},_updateNCstyleable:function(a,b){null!=this.gameEntity.getState("borderRadius")&&"Undefined"!=this.gameEntity.getState("borderRadius")&&(this._instances.h[b.__id__].style.borderRadius=this.gameEntity.getState("borderRadius"));
null!=this.gameEntity.getState("borderStyle")&&"Undefined"!=this.gameEntity.getState("borderStyle")&&(this._instances.h[b.__id__].style.borderStyle=this.gameEntity.getState("borderStyle"));null!=this.gameEntity.getState("borderWidth")&&"Undefined"!=this.gameEntity.getState("borderWidth")&&(this._instances.h[b.__id__].style.borderWidth=this.gameEntity.getState("borderWidth"));null!=this.gameEntity.getState("boxShadow")&&"Undefined"!=this.gameEntity.getState("boxShadow")&&(this._instances.h[b.__id__].style.boxShadow=
this.gameEntity.getState("boxShadow"));null!=this.gameEntity.getState("fontFamily")&&"Undefined"!=this.gameEntity.getState("fontFamily")&&(this._instances.h[b.__id__].style.fontFamily=this.gameEntity.getState("fontFamily"));null!=this.gameEntity.getState("textAlign")&&"Undefined"!=this.gameEntity.getState("textAlign")&&(this._instances.h[b.__id__].style.textAlign=this.gameEntity.getState("textAlign"));null!=this.gameEntity.getState("textVerticalAlign")&&"Undefined"!=this.gameEntity.getState("textVerticalAlign")&&
"middle"==this.gameEntity.getState("textVerticalAlign")&&(this._instances.h[b.__id__].style.lineHeight=q.string(this.gameEntity.getState("height"))+"px");null!=this.gameEntity.getState("textIndent")&&"Undefined"!=this.gameEntity.getState("textIndent")&&(this._instances.h[b.__id__].style.textIndent=this.gameEntity.getState("textIndent"));null!=this.gameEntity.getState("cursor")&&"Undefined"!=this.gameEntity.getState("cursor")&&(this._instances.h[b.__id__].style.cursor=this.gameEntity.getState("cursor"));
null!=this.gameEntity.getState("white-space")&&"Undefined"!=this.gameEntity.getState("white-space")&&(this._instances.h[b.__id__].style.whiteSpace=this.gameEntity.getState("white-space"));null!=this.gameEntity.getState("selectable")&&!1==this.gameEntity.getState("selectable")&&(this._instances.h[b.__id__].style.setProperty("-webkit-user-select","none"),this._instances.h[b.__id__].style.setProperty("-moz-user-select","none"),this._instances.h[b.__id__].style.setProperty("-ms-user-select","none"),this._instances.h[b.__id__].style.setProperty("user-select",
"none"))},_updateImageSrc:function(a,b){var c=this._instances.h[b.__id__];if("Undefined"!=a)if(-1==a.indexOf("assets/")){var d;d=W.modules.get("DoNotLoad").assets.get(a);c.src=W.getPath(d.location,d.type)+d.url}else c.src="../"+a},_updateWidth:function(a,b){!0==this.gameEntity.getState("layoutable")&&(this.groupInstances.h[b.__id__].updateState("width"),B.display.projectActiveSpaceReference.activeStageReference.layoutManager.validated=!1)},_updateHeight:function(a,b){!0==this.gameEntity.getState("layoutable")&&
(this.groupInstances.h[b.__id__].updateState("height"),B.display.projectActiveSpaceReference.activeStageReference.layoutManager.validated=!1)},_updateTop:function(a,b){!0==this.gameEntity.getState("layoutable")&&(this.groupInstances.h[b.__id__].updateState("top"),B.display.invalidateLayout())},_updateLeft:function(a,b){!0==this.gameEntity.getState("layoutable")&&(this.groupInstances.h[b.__id__].updateState("left"),B.display.invalidateLayout())},_updateOverflow:function(a,b){"Undefined"!=a&&(this._instances.h[b.__id__].style.overflow=
a)},_updateFontSize:function(a,b){"Undefined"!=a&&(this._instances.h[b.__id__].style.fontSize=a)},_updateFontWeight:function(a,b){"Undefined"!=a&&(this._instances.h[b.__id__].style.fontWeight=a)},_updateFontColor:function(a,b){"Undefined"!=a&&(this._instances.h[b.__id__].style.color=a)},_updateVisibility:function(a,b){this._instances.h[b.__id__].style.visibility=a},_updateOpacity:function(a,b){this._instances.h[b.__id__].style.opacity=a},_updateBackgroundColor:function(a,b){"Undefined"!=a&&(this._instances.h[b.__id__].style.backgroundColor=
a)},_updateBorder:function(a,b){"Undefined"!=a&&(this._instances.h[b.__id__].style.border=a)},_updateBorderColor:function(a,b){"Undefined"!=a&&(this._instances.h[b.__id__].style.borderColor=a)},_updateDisplay:function(a,b){this._instances.h[b.__id__].style.display=a},_updateText:function(a,b){if("Undefined"!=a)switch(this.gameEntity.getState("NCmeshType")){case "Div":this._instances.h[b.__id__].innerHTML=a;break;case "Input":this._instances.h[b.__id__].value=a;break;case "Button":this._instances.h[b.__id__].innerHTML=
a}},_updateNCmeshType:function(a,b){switch(a){case "Div":break;case "Button":this._updateButtonProperties(b);break;case "Input":this._updateInputProperties(b);break;case "Image":this._updateImageSrc(this.gameEntity.getState("src"),b);break;case "Ace":this._updateAceProperties(b);break;case "Tree":this._updateTreeProperties(b);break;case "Undefined":w.logger.warn("Undefined NCmeshType value",null);break;default:w.logger.warn("Unhandled NCmeshType value: "+a,null)}},_updateInputProperties:function(a){a=
this._instances.h[a.__id__];null!=this.gameEntity.getState("text")&&"Undefined"!=this.gameEntity.getState("text")&&(a.value=this.gameEntity.getState("text"));null!=this.gameEntity.getState("placeholder")&&"Undefined"!=this.gameEntity.getState("placeholder")&&(a.placeholder=this.gameEntity.getState("placeholder"));null!=this.gameEntity.getState("type")&&"Undefined"!=this.gameEntity.getState("type")&&(a.type=this.gameEntity.getState("type"));"file"==this.gameEntity.getState("type")&&null!=this.gameEntity.getState("accept")&&
"Undefined"!=this.gameEntity.getState("accept")&&(a.accept=this.gameEntity.getState("accept"))},_updateButtonProperties:function(a){a=this._instances.h[a.__id__];null!=this.gameEntity.getState("text")&&"Undefined"!=this.gameEntity.getState("text")&&(a.innerHTML=this.gameEntity.getState("text"))},_updateAceProperties:function(a){this._instances.h[a.__id__].id="editor";a=ace.edit("editor");a.setTheme("ace/theme/merbivore_soft");a.getSession().setMode("ace/mode/xml");this.gameEntity.setState("aceObject",
a)},_updateTreeProperties:function(a){a=this._instances.h[a.__id__];a.id="tree";var b=$("#tree");a.style.overflowX="hidden";a.style.overflowY="scroll";this.gameEntity.setState("treeObject",b)},_updateTouchable:function(a,b){var c=this._instances.h[b.__id__];null!=c&&(a?(c.onclick=y(this,this._onPointerClick),c.oncontextmenu=y(this,this._onMouseRightClick),c.onmousedown=y(this,this._onMouseDown),c.onmouseup=y(this,this._onMouseUp),c.onmouseenter=y(this,this._onMouseEnter),c.onmouseleave=y(this,this._onMouseLeave)):
this.gameEntity.getState("preventDefaultEvents")&&(c.oncontextmenu=y(this,this._preventDefault)))},_preventDefault:function(){return!1},_updateAcceptsKeyboardInput:function(a,b){var c=this._instances.h[b.__id__];null!=c&&a&&(c.onkeypress=y(this,this._onKeyPress),c.onkeyup=y(this,this._onKeyRelease),c.onkeydown=y(this,this._onKeyDown),c.tabIndex=1)},_updateDraggable:function(a,b){var c=this._instances.h[b.__id__];null!=c&&a&&(c.ondragstart=y(this,this._onDragStart),c.ondrag=y(this,this._onDrag),c.ondragend=
y(this,this._onDragEnd))},_queryGlobalPosition:function(a,b){var c=this._instances.h[b.__id__],d=0,e=0;do d+=c.offsetTop,e+=c.offsetLeft,c=c.offsetParent;while(null!=c);return new ec(e,d)},_onDragStart:function(a){this.gameEntity.setState("eventObject",a);B.event.raiseEvent(n.ON_DRAG_START,this.gameEntity)},_onDrag:function(a){this.gameEntity.setState("eventObject",a);B.event.raiseEvent(n.ON_DRAG,this.gameEntity)},_onDragEnd:function(a){this.gameEntity.setState("eventObject",a);B.event.raiseEvent(n.ON_DRAG_END,
this.gameEntity)},_updateDropTarget:function(a,b){var c=this._instances.h[b.__id__];null!=c&&a&&(c.ondragenter=y(this,this._onDragEnter),c.ondragover=y(this,this._onDragOver),c.ondragleave=y(this,this._onDragLeave),c.ondrop=y(this,this._onDrop))},_onDragEnter:function(a){this.gameEntity.setState("eventObject",a);B.event.raiseEvent(n.ON_DRAG_ENTER,this.gameEntity)},_onDragOver:function(a){this.gameEntity.setState("eventObject",a);a.preventDefault();B.event.raiseEvent(n.ON_DRAG_OVER,this.gameEntity)},
_onDragLeave:function(a){this.gameEntity.setState("eventObject",a);B.event.raiseEvent(n.ON_DRAG_LEAVE,this.gameEntity)},_onDrop:function(a){this.gameEntity.setState("eventObject",a);a.preventDefault();B.event.raiseEvent(n.ON_DROP,this.gameEntity)},_onKeyPress:function(a){this.gameEntity.setState("eventObjectKeyPress",a);this.gameEntity.getState("preventDefaultEvents")&&a.preventDefault();B.event.raiseEvent(n.KEY_PRESSED_LOCAL,this.gameEntity)},_onKeyRelease:function(a){this.gameEntity.setState("eventObjectKeyRelease",
a);this.gameEntity.getState("preventDefaultEvents")&&a.preventDefault();B.event.raiseEvent(n.KEY_RELEASED_LOCAL,this.gameEntity)},_onKeyDown:function(a){this.gameEntity.setState("eventObjectKeyDown",a);this.gameEntity.getState("preventDefaultEvents")&&a.preventDefault();B.event.raiseEvent(n.KEY_DOWN_LOCAL,this.gameEntity)},_onPointerClick:function(a){this.gameEntity.setState("eventObject",a);B.input.pointer.submitPointerEvent(n.MOUSE_LEFT_CLICK,this.gameEntity)},_onMouseRightClick:function(a){this.gameEntity.getState("preventDefaultEvents")&&
a.preventDefault();this.gameEntity.setState("eventObject",a);B.input.pointer.submitPointerEvent(n.MOUSE_RIGHT_CLICK,this.gameEntity)},_onMouseDown:function(a){this.gameEntity.setState("eventObject",a);B.input.pointer.submitPointerEvent(n.MOUSE_DOWN,this.gameEntity)},_onMouseUp:function(a){this.gameEntity.setState("eventObject",a);B.input.pointer.submitPointerEvent(n.MOUSE_UP,this.gameEntity)},_onMouseEnter:function(a){this.gameEntity.setState("eventObject",a);B.input.pointer.submitPointerEvent(n.MOUSE_ENTERED,
this.gameEntity)},_onMouseLeave:function(a){this.gameEntity.setState("eventObject",a);B.input.pointer.submitPointerEvent(n.MOUSE_LEFT,this.gameEntity)},_onChange:function(a){"file"==this.gameEntity.getState("type")?(this.gameEntity.setState("files",a.target.files),B.input.pointer.submitPointerEvent(n.MOUSE_LEFT_CLICK,this.gameEntity)):(this.gameEntity.setState("text",a.target.value),B.event.raiseEvent(n.CHANGED,this.gameEntity))},__class__:ub});var Gg=function(){};h["tools.spark.framework.space2_5D.interfaces.IScene2_5D"]=
Gg;Gg.__name__=!0;Gg.__interfaces__=[ue];Gg.prototype={__class__:Gg};var Ga=function(a){this._tempY=this._tempX=0;this._scaleY=this._scaleX=1;Sb.call(this,a)};h["tools.spark.framework.space2_5D.core.AScene2_5D"]=Ga;Ga.__name__=!0;Ga.__interfaces__=[Gg];Ga.__super__=Sb;Ga.prototype=v(Sb.prototype,{createInstance:function(a){return Sb.prototype.createInstance.call(this,a)},_createChildOfInstance:function(a,b){!0==a.gameEntity.getState("layoutable")&&b.group.children.push(a.groupInstances.h[b.__id__]);
a.parentScene=this},_removeChildOfInstance:function(a,b){!0==a.gameEntity.getState("layoutable")&&E.remove(b.group.children,a.groupInstances.h[b.__id__])},updateCamera:function(a,b){var c=b.gameEntity.getState("captureAreaX"),d=b.gameEntity.getState("captureAreaY"),e=b.gameEntity.getState("captureAreaWidth"),i=b.gameEntity.getState("captureAreaHeight"),e=a.gameEntity.getState("feedbackWidth")/e,i=a.gameEntity.getState("feedbackHeight")/i;this._scaleX=this._scaleY=i=Math.min(e,i);this._tempX=-c*i;
this._tempY=-d*i},__class__:Ga});var vb=function(a){Ga.call(this,a);this._initDomScene2_5D()};h["tools.spark.framework.dom2_5D.DomScene2_5D"]=vb;vb.__name__=!0;vb.__super__=Ga;vb.prototype=v(Ga.prototype,{_initDomScene2_5D:function(){},createInstance:function(a){var b;b=window.document.createElement("div");this._instances.set(a,b);b;this._instances.h[a.__id__].style.position="absolute";return Ga.prototype.createInstance.call(this,a)},update:function(a){for(var b=0,c=this.children;b<c.length;){var d=
c[b];++b;d.update(a)}},_createChildOfInstance:function(a,b){this._instances.h[b.__id__].appendChild(A.__cast(a.createInstance(b),HTMLElement));Ga.prototype._createChildOfInstance.call(this,a,b)},_removeChildOfInstance:function(a,b){this._instances.h[b.__id__].removeChild(A.__cast(a.getInstance(b),HTMLElement));Ga.prototype._removeChildOfInstance.call(this,a,b)},__class__:vb});var Hg=function(){};h["tools.spark.framework.space2_5D.interfaces.IView2_5D"]=Hg;Hg.__name__=!0;Hg.__interfaces__=[jf];Hg.prototype=
{__class__:Hg};var Tb=function(a){this.gameEntity=a;this.group=B.display.projectActiveSpaceReference.activeStageReference.layoutManager.getViewGroupByGameEntity(this.gameEntity);this.group.layoutableInstance=this};h["tools.spark.framework.space2_5D.core.AView2_5D"]=Tb;Tb.__name__=!0;Tb.__interfaces__=[Hg];Tb.__super__=rd;Tb.prototype=v(rd.prototype,{render:function(){},updateCamera:function(){this.scene.updateCamera(this,this.camera)},__class__:Tb});var ze=function(a){Tb.call(this,a);this._initDomView2_5D()};
h["tools.spark.framework.dom2_5D.DomView2_5D"]=ze;ze.__name__=!0;ze.__super__=Tb;ze.prototype=v(Tb.prototype,{updateState:function(a){switch(a){case "visible":this._instanceView.style.display=!0==this.gameEntity.getState(a)?"inline":"none";break;case "width":this._updateWidth(this.gameEntity.getState(a));break;case "height":this._updateHeight(this.gameEntity.getState(a))}},_updateWidth:function(){!0==this.gameEntity.getState("layoutable")&&(this.group.updateState("width"),B.display.projectActiveSpaceReference.activeStageReference.layoutManager.validated=
!1)},_updateHeight:function(){!0==this.gameEntity.getState("layoutable")&&(this.group.updateState("height"),B.display.projectActiveSpaceReference.activeStageReference.layoutManager.validated=!1)},_initDomView2_5D:function(){var a=window.document.getElementById("content");this._instanceView=window.document.createElement("div");this._instanceView.style.position="absolute";a.insertBefore(this._instanceView,a.firstElementChild)},set_camera:function(a){if(this.camera==a)return this.camera;if(null==a)return this.camera=
null,this._updateCurrentView(),null;this.camera=a;this.camera.attachToView(this);this._updateCurrentView();return this.camera},set_scene:function(a){if(this.scene==a)return this.scene;if(null==a)return this.scene=null,this._disposeCurrentScene(),this._updateCurrentView(),null;this.scene=a;this._instanceScene=A.__cast(this.scene.createInstance(this),HTMLDivElement);this._updateCurrentView();return this.scene},_updateCurrentView:function(){null==this.scene||null==this.camera?null!=this._instanceView.firstElementChild&&
this._instanceView.removeChild(this._instanceView.firstElementChild):(null==this._instanceView.firstElementChild&&this._instanceView.appendChild(this._instanceScene),this.scene.update(this))},_disposeCurrentScene:function(){this._instanceScene=null},setPosSize:function(a,b,c,d,e){null!=a&&(this._instanceView.style.left=(null==a?"null":""+a)+"px");null!=b&&(this._instanceView.style.top=(null==b?"null":""+b)+"px");null!=c&&(this._instanceView.style.width=(null==c?"null":""+c)+"px");null!=d&&(this._instanceView.style.height=
(null==d?"null":""+d)+"px");Tb.prototype.setPosSize.call(this,a,b,c,d,e)},__class__:ze});var Ae=function(a){Ma.call(this,a)};h["tools.spark.framework.flambe2_5D.FlambeCamera2_5D"]=Ae;Ae.__name__=!0;Ae.__super__=Ma;Ae.prototype=v(Ma.prototype,{__class__:Ae});var he=function(a){Sb.call(this,a);this._initFlambeEntity2_5D()};h["tools.spark.framework.flambe2_5D.FlambeEntity2_5D"]=he;he.__name__=!0;he.__super__=Fb;he.prototype=v(Fb.prototype,{_initFlambeEntity2_5D:function(){this._instancesMesh=new Qa;
var a=y(this,this._update2DMeshType);this._updateStateFunctions.set("2DmeshType",a);a;a=y(this,this._updatePositionX);this._updateStateFunctions.set("spaceX",a);a;a=y(this,this._updatePositionY);this._updateStateFunctions.set("spaceY",a);a;a=y(this,this._updateSizeX);this._updateStateFunctions.set("scaleX",a);a;a=y(this,this._updateSizeY);this._updateStateFunctions.set("scaleY",a);a;a=y(this,this._updateTouchable);this._updateStateFunctions.set("touchable",a);a;a=y(this,this._updateVisible);this._updateStateFunctions.set("visible",
a);a;a=y(this,this._updateOpacity);this._updateStateFunctions.set("opacity",a);a;a=y(this,this._updateVelocityX);this._updateStateFunctions.set("velocityX",a);a;a=y(this,this._updateVelocityY);this._updateStateFunctions.set("velocityY",a);a;a=y(this,this._updateApplyImpulseX);this._updateStateFunctions.set("applyImpulseX",a);a;a=y(this,this._updateApplyImpulseY);this._updateStateFunctions.set("applyImpulseY",a);a;a=y(this,this._centerAnchor);this._updateStateFunctions.set("centerAnchor",a);a;a=y(this,
this._updatePhysics);this._updateStateFunctions.set("physicsEntity",a);a;a=y(this,this._updateSpaceWidth);this._updateStateFunctions.set("spaceWidth",a);a;a=y(this,this._updateSpaceHeight);this._updateStateFunctions.set("spaceHeight",a);a;a=y(this,this._update2DMeshImageForm);this._updateStateFunctions.set("2DMeshImageForm",a);a;a=y(this,this._update2DMeshSpriterForm);this._updateStateFunctions.set("2DMeshSpriterForm",a);a;a=y(this,this._update2DMeshSpritesheetForm);this._updateStateFunctions.set("2DMeshSpritesheetForm",
a);a;a=y(this,this._update2DMeshFillRectForm);this._updateStateFunctions.set("2DMeshFillRectForm",a);a;a=y(this,this._update2DMeshSpriteForm);this._updateStateFunctions.set("2DMeshSpriteForm",a);a;a=y(this,this._update2DMeshSpriterAnimForm);this._updateStateFunctions.set("2DMeshSpriterAnimForm",a);a},createInstance:function(a){var b=new Va;this._instances.set(a,b);b;return Fb.prototype.createInstance.call(this,a)},_createChildOfInstance:function(a,b){this._instances.h[b.__id__].addChild(A.__cast(a.createInstance(b),
Va));Fb.prototype._createChildOfInstance.call(this,a,b)},update:function(a){this._updateState("2DmeshType",a);this._updateState("centerAnchor",a);this._updateState("physicsEntity",a);if(null==this.gameEntity.getState("layoutable")||!1==this.gameEntity.getState("layoutable"))this._updateState("spaceX",a),this._updateState("spaceY",a);this._updateState("scaleX",a);this._updateState("scaleY",a);this._updateState("touchable",a);this._updateState("visible",a);this._updateState("opacity",a);!0==this.gameEntity.getState("layoutable")&&
this._updateLayoutGroup(a);for(var b=0,c=this.children;b<c.length;){var d=c[b];++b;d.update(a)}},_update2DMeshType:function(a,b){switch(a){case "Image":null!=this._updateStateFunctions.get("2DMeshImageForm")?this._updateStateFunctions.get("2DMeshImageForm")(this.gameEntity.getState("2DMeshImageForm"),b):w.logger.warn("State 2DMeshImageForm does not have a function handler! Ignoring :(",null);break;case "Spriter":null!=this._updateStateFunctions.get("2DMeshSpriterForm")?this._updateStateFunctions.get("2DMeshSpriterForm")(this.gameEntity.getState("2DMeshSpriterForm"),
b):w.logger.warn("State 2DMeshSpriterForm does not have a function handler! Ignoring :(",null);break;case "Spritesheet":null!=this._updateStateFunctions.get("2DMeshSpritesheetForm")?this._updateStateFunctions.get("2DMeshSpritesheetForm")(this.gameEntity.getState("2DMeshSpritesheetForm"),b):w.logger.warn("State 2DMeshSpritesheetForm does not have a function handler! Ignoring :(",null);break;case "FillRect":null!=this._updateStateFunctions.get("2DMeshFillRectForm")?this._updateStateFunctions.get("2DMeshFillRectForm")(this.gameEntity.getState("2DMeshFillRectForm"),
b):w.logger.warn("State 2DMeshFillRectForm does not have a function handler! Ignoring :(",null);break;case "Sprite":null!=this._updateStateFunctions.get("2DMeshSpriteForm")?this._updateStateFunctions.get("2DMeshSpriteForm")(this.gameEntity.getState("2DMeshSpriteForm"),b):w.logger.warn("State 2DMeshSpriteForm does not have a function handler! Ignoring :(",null);break;case "Undefined":w.logger.warn("Undefined 2DmeshType value",null);break;default:w.logger.warn("Unhandled 2DmeshType value: "+a,null)}this._updateBounds(b)},
_update2DMeshImageForm:function(a,b){if(!("Image"!=this.gameEntity.getState("2DmeshType")||"Undefined"==a)){var c=this._instances.h[b.__id__],d;d=null!=this._instancesMesh.h[b.__id__]?A.__cast(this._instancesMesh.h[b.__id__],Kd):null;null==d?(d=new Kd(R.getTexture(this.gameEntity.gameForm.getState(a))),d.blendMode=ba.Copy,c.add(d),this._instancesMesh.set(b,d),d):d.texture=R.getTexture(this.gameEntity.gameForm.getState(a))}},_update2DMeshSpriterForm:function(a,b){if(!("Spriter"!=this.gameEntity.getState("2DmeshType")||
"Undefined"==a)){var c=this._instances.h[b.__id__],d=this._instancesMesh.h[b.__id__];if(null==d){var d=new M,e=this.gameEntity.gameForm.getState(a),e=new yg(R.getAssetPackOf(e),e,null);d.blendMode=ba.Copy;c.add(d);c.add(e);this._instancesMesh.set(b,d);d}null!=this._updateStateFunctions.get("2DMeshSpriterAnimForm")?this._updateStateFunctions.get("2DMeshSpriterAnimForm")(this.gameEntity.getState("2DMeshSpriterAnimForm"),b):w.logger.warn("State 2DMeshSpriterAnimForm does not have a function handler! Ignoring :(",
null)}},_update2DMeshSpritesheetForm:function(a,b){if(!("Spritesheet"!=this.gameEntity.getState("2DmeshType")||"Undefined"==a)){var c=this._instances.h[b.__id__],d=this._instancesMesh.h[b.__id__];if(null==d){var d=new M,e=this.gameEntity.gameForm.getState(a),e=new Ig(R.getAssetPackOf(e),e);d.blendMode=ba.Copy;c.add(d);c.add(e);this._instancesMesh.set(b,d);d}c=c._compMap.SpriteSheetPlayer_2;!0==this.gameEntity.getState("AnimationLoop")?c.loop():c.play();c.setSpeed(this.gameEntity.getState("AnimationSpeed"))}},
_update2DMeshFillRectForm:function(a,b){if(!("FillRect"!=this.gameEntity.getState("2DmeshType")||"Undefined"==a)){var c=this._instances.h[b.__id__],d;d=null!=this._instancesMesh.h[b.__id__]?A.__cast(this._instancesMesh.h[b.__id__],Bd):null;null==d?(d=new Bd(this.gameEntity.gameForm.getState(a),this.gameEntity.getState("spaceWidth"),this.gameEntity.getState("spaceHeight")),d.scissor=new tc(0,0,this.gameEntity.getState("spaceWidth"),this.gameEntity.getState("spaceHeight")),d.blendMode=ba.Copy,c.add(d),
this._instancesMesh.set(b,d),d):d.color=this.gameEntity.gameForm.getState(a)}},_update2DMeshSpriteForm:function(a,b){if("Sprite"==this.gameEntity.getState("2DmeshType")){var c=this._instances.h[b.__id__],d;d=null!=this._instancesMesh.h[b.__id__]?A.__cast(this._instancesMesh.h[b.__id__],M):null;null==d&&(d=new M,d.blendMode=ba.Copy,c.add(d),this._instancesMesh.set(b,d),d)}},_update2DMeshSpriterAnimForm:function(a,b){if(!("Spriter"!=this.gameEntity.getState("2DmeshType")||"Undefined"==this.gameEntity.getState("2DMeshSpriterForm"))&&
"Undefined"!=a){var c=this._instances.h[b.__id__]._compMap.SpriterMovie_1;null!=c&&c.playAnim(this.gameEntity.gameForm.getState(a))}},_updatePositionX:function(a,b){var c=this._instancesMesh.h[b.__id__];this.gameEntity.getState("physicsEntity")?A.__cast(this.gameEntity.getState("physicsBody"),re).get_position().set_x(a):c.x.set__(a)},_updatePositionY:function(a,b){var c=this._instancesMesh.h[b.__id__];this.gameEntity.getState("physicsEntity")?A.__cast(this.gameEntity.getState("physicsBody"),re).get_position().set_y(a):
c.y.set__(a)},_updateSizeX:function(a,b){var c=this._instancesMesh.h[b.__id__];null!=c&&c.scaleX.set__(a)},_updateSizeY:function(a,b){var c=this._instancesMesh.h[b.__id__];null!=c&&c.scaleY.set__(a)},_updateVisible:function(a,b){var c=this._instancesMesh.h[b.__id__];null!=c&&c.set_visible(a)},_updateOpacity:function(a,b){var c=this._instancesMesh.h[b.__id__];null!=c&&c.setAlpha(a)},_centerAnchor:function(a,b){var c=this._instancesMesh.h[b.__id__];null!=c&&c.centerAnchor()},_updatePhysics:function(a,
b){var c=this._instances.h[b.__id__],d=this._instancesMesh.h[b.__id__];if(null!=d&&a)if(null!=this.parentScene)if(this.parentScene.gameEntity.getState("physicsScene")){var e=this.parentScene.getInstance(b),i;"Static"==this.gameEntity.getState("physicsType")?(null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new Ia,f.internal=!1),i=f.BodyType_STATIC):"Kinematic"==this.gameEntity.getState("physicsType")?(null==f.BodyType_KINEMATIC&&(f.internal=!0,f.BodyType_KINEMATIC=new Ia,f.internal=!1),i=
f.BodyType_KINEMATIC):"Dynamic"==this.gameEntity.getState("physicsType")?(null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new Ia,f.internal=!1),i=f.BodyType_DYNAMIC):(null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new Ia,f.internal=!1),i=f.BodyType_STATIC);i=new re(i);var m;switch(this.gameEntity.getState("physicsMaterial")){case "Glass":m=ra.glass();break;case "Ice":m=ra.ice();break;case "Rubber":m=ra.rubber();break;case "Sand":m=ra.sand();break;case "Steel":m=ra.steel();break;
case "Wood":m=ra.wood();break;case "Ellastic":m=new ra(1,0,0,1,0);break;case "Biped":m=new ra(-5,1,2,1,0.001);break;default:m=ra.wood()}var g=M.getBounds(c).width,r=M.getBounds(c).height;if("Spriter"!=this.gameEntity.getState("2DmeshType")){switch(this.gameEntity.getState("physicsShape")){case "Circle":d=new Rd((g+r)/4,null,m);break;case "Polygon":d=new nb(nb.box(g,r),m);break;default:d=new nb(nb.box(g,r),m)}d.set_sensorEnabled(this.gameEntity.getState("physicsSensorFlag"));i.zpp_inner.wrap_shapes.add(d)}else"Biped"==
this.gameEntity.getState("physicsShape")?(this._appendPhysicsBipedShapes(i,76,180,d.scaleX._value,0,-0.09,m),i.zpp_inner.immutable_midstep("Body::false"),!1!=!i.zpp_inner.norotate&&(i.zpp_inner.norotate=!0,i.zpp_inner.invalidate_inertia()),!i.zpp_inner.norotate):i.zpp_inner.wrap_shapes.add(new nb(nb.box(100,100),m));this.gameEntity.setState("physicsBody",i);"Dynamic"==this.gameEntity.getState("physicsType")?i.set_velocity(new ga(this.gameEntity.getState("velocityX"),this.gameEntity.getState("velocityY"))):
"Kinematic"==this.gameEntity.getState("physicsType")&&i.set_velocity(new ga(this.gameEntity.getState("velocityX"),this.gameEntity.getState("velocityY")));i.set_space(e._compMap.SpaceComponent_4.space);null==i.zpp_inner_i.userData&&(i.zpp_inner_i.userData={});i.zpp_inner_i.userData.gameEntity=this.gameEntity;c.add(new Jg(i))}else this.gameEntity.setState("physicsEntity",!1),pa.warn("Entity "+q.string(this.gameEntity.getState("name"))+" failed to become a physics object.");else this.gameEntity.setState("physicsEntity",
!1),pa.warn("Entity "+q.string(this.gameEntity.getState("name"))+" failed to become a physics object.")},_appendPhysicsBipedShapes:function(a,b,c,d,e,i,m){null==i&&(i=0);null==e&&(e=0);null==d&&(d=1);var b=b*d,c=c*d,e=e*b,f=i*c,r=b/2,g=c-2*r,i=new Rd(r,new ga(e,-g/2+f),m),d=new nb(nb.rect(-b/2+e,-g/2+f,b,g),m),h=new Rd(r,new ga(e,g/2+f),m),m=new nb(nb.rect(-b/2/2+e,g/2+f+r-0.05*c/2,b/2,0.05*c),m);m.zpp_inner.immutable_midstep("Shape::sensorEnabled");m.zpp_inner.sensorEnabled=!0;m.zpp_inner.wake();
m.zpp_inner.sensorEnabled;null==m.zpp_inner_i.wrap_cbTypes&&m.zpp_inner_i.setupcbTypes();m.zpp_inner_i.wrap_cbTypes.add(Ub.BIPED_FEET);a.zpp_inner.wrap_shapes.add(i);a.zpp_inner.wrap_shapes.add(d);a.zpp_inner.wrap_shapes.add(h);a.zpp_inner.wrap_shapes.add(m)},_updateVelocityX:function(a,b){var c=this._instances.h[b.__id__];null!=c._compMap.BodyComponent_5&&(c=c._compMap.BodyComponent_5.body,null==c.zpp_inner.wrap_vel&&c.zpp_inner.setupVelocity(),c.zpp_inner.wrap_vel.set_x(a))},_updateVelocityY:function(a,
b){var c=this._instances.h[b.__id__];null!=c._compMap.BodyComponent_5&&(c=c._compMap.BodyComponent_5.body,null==c.zpp_inner.wrap_vel&&c.zpp_inner.setupVelocity(),c.zpp_inner.wrap_vel.set_y(a))},_updateApplyImpulseX:function(a,b){var c=this._instances.h[b.__id__];null!=c._compMap.BodyComponent_5&&c._compMap.BodyComponent_5.body.applyImpulse(ga.get(a,0,!0))},_updateApplyImpulseY:function(a,b){var c=this._instances.h[b.__id__];null!=c._compMap.BodyComponent_5&&c._compMap.BodyComponent_5.body.applyImpulse(ga.get(0,
a,!0))},_updateTouchable:function(a,b){var c=this._instancesMesh.h[b.__id__];null!=c&&a&&(c.set_pointerEnabled(!0),c.get_pointerIn().hasListeners()||c.get_pointerIn().connect(y(this,this._onPointerIn)),c.get_pointerMove().hasListeners()||c.get_pointerMove().connect(y(this,this._onPointerMove)),c.get_pointerOut().hasListeners()||c.get_pointerOut().connect(y(this,this._onPointerOut)),c.get_pointerDown().hasListeners()||c.get_pointerDown().connect(y(this,this._onPointerDown)),c.get_pointerUp().hasListeners()||
c.get_pointerUp().connect(y(this,this._onPointerUp)))},_onPointerIn:function(){B.input.pointer.submitPointerEvent(n.MOUSE_ENTERED,this.gameEntity)},_onPointerMove:function(){B.input.pointer.submitPointerEvent(n.MOUSE_MOVED,this.gameEntity)},_onPointerOut:function(){B.input.pointer.submitPointerEvent(n.MOUSE_LEFT,this.gameEntity)},_onPointerDown:function(){B.input.mouse.isDown(sa.Left)&&B.input.pointer.submitPointerEvent(n.MOUSE_LEFT_CLICK,this.gameEntity)},_onPointerUp:function(){B.input.mouse.lastMouseButton==
sa.Right&&B.input.pointer.submitPointerEvent(n.MOUSE_RIGHT_CLICK,this.gameEntity)},setPosSize:function(a,b,c,d,e){var i=this._instancesMesh.h[e.__id__];null!=i&&(null!=a&&i.x.set__(a),null!=b&&i.y.set__(b));i=q.instance(this._instances.h[e.__id__]._compMap.Sprite_3,Bd);null!=i&&i.setSize(c,d);Fb.prototype.setPosSize.call(this,a,b,c,d,e)},_updateSpaceWidth:function(a,b){var c=q.instance(this._instances.h[b.__id__]._compMap.Sprite_3,Bd);null!=c&&(c.width.set__(a),c.centerAnchor(),c.scissor.width=a)},
_updateSpaceHeight:function(a,b){var c=q.instance(this._instances.h[b.__id__]._compMap.Sprite_3,Bd);null!=c&&(c.height.set__(a),c.centerAnchor(),c.scissor.height=a)},_updateBounds:function(a){a=this._instances.h[a.__id__];null!=a&&("Spriter"==this.gameEntity.getState("2DmeshType")?this.gameEntity.setState("boundsRect",new tc(-55,-112,140,190)):this.gameEntity.setState("boundsRect",M.getBounds(a)))},__class__:he});var qa=function(){this.cbsets=this.listeners=this.bodylisteners=this.conlisteners=null;
this.id=0;this.outer=null;this.id=wb.CbType();this.listeners=new Be;this.bodylisteners=new Kg;this.conlisteners=new Lg;this.constraints=new ad;this.interactors=new Dc;this.cbsets=new Ce};h["zpp_nape.callbacks.ZPP_CbType"]=qa;qa.__name__=!0;qa.prototype={addint:function(a){for(var b=null,c=this.listeners.head;null!=c;){var d=c.elt;if(a.precedence>d.precedence||a.precedence==d.precedence&&a.id>d.id)break;b=c;c=c.next}this.listeners.inlined_insert(b,a);this.invalidateint()},invalidateint:function(){for(var a=
this.cbsets.head;null!=a;){var b=a.elt;b.zip_listeners=!0;b.invalidate_pairs();a=a.next}},addbody:function(a){for(var b=null,c=this.bodylisteners.head;null!=c;){var d=c.elt;if(a.precedence>d.precedence||a.precedence==d.precedence&&a.id>d.id)break;b=c;c=c.next}this.bodylisteners.inlined_insert(b,a);this.invalidatebody()},invalidatebody:function(){for(var a=this.cbsets.head;null!=a;)a.elt.zip_bodylisteners=!0,a=a.next},addconstraint:function(a){for(var b=null,c=this.conlisteners.head;null!=c;){var d=
c.elt;if(a.precedence>d.precedence||a.precedence==d.precedence&&a.id>d.id)break;b=c;c=c.next}this.conlisteners.inlined_insert(b,a);this.invalidateconstraint()},invalidateconstraint:function(){for(var a=this.cbsets.head;null!=a;)a.elt.zip_conlisteners=!0,a=a.next},__class__:qa};var wb=function(){};h["zpp_nape.ZPP_ID"]=wb;wb.__name__=!0;wb.Interactor=function(){return wb._Interactor++};wb.CbType=function(){return wb._CbType++};wb.CbSet=function(){return wb._CbSet++};wb.Listener=function(){return wb._Listener++};
var Be=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_InteractionListener"]=Be;Be.__name__=!0;Be.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Gb.zpp_pool?b=new Gb:(b=Gb.zpp_pool,Gb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},inlined_insert:function(a,b){var c;null==Gb.zpp_pool?c=new Gb:(c=Gb.zpp_pool,Gb.zpp_pool=c.next,c.next=null);
null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Gb.zpp_pool;Gb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,
c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Gb.zpp_pool;Gb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},inlined_clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},__class__:Be};var Kg=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_BodyListener"]=
Kg;Kg.__name__=!0;Kg.prototype={inlined_insert:function(a,b){var c;null==Ec.zpp_pool?c=new Ec:(c=Ec.zpp_pool,Ec.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Ec.zpp_pool;Ec.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=
null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ec.zpp_pool;Ec.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},__class__:Kg};var Lg=function(){this.length=0;this.modified=
this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_ConstraintListener"]=Lg;Lg.__name__=!0;Lg.prototype={inlined_insert:function(a,b){var c;null==Fc.zpp_pool?c=new Fc:(c=Fc.zpp_pool,Fc.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Fc.zpp_pool;Fc.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=
!0;this.length--},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Fc.zpp_pool;Fc.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=
this.head;)this.inlined_pop();this.pushmod=!0},__class__:Lg};var ad=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Constraint"]=ad;ad.__name__=!0;ad.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Gc.zpp_pool?b=new Gc:(b=Gc.zpp_pool,Gc.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=
this.head;this.head=a.next;a.elt=null;a.next=Gc.zpp_pool;Gc.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.head,
this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Gc.zpp_pool;Gc.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:ad};var Dc=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Interactor"]=Dc;Dc.__name__=!0;Dc.prototype={add:function(a){return this.inlined_add(a)},
inlined_add:function(a){var b;null==Hc.zpp_pool?b=new Hc:(b=Hc.zpp_pool,Hc.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Hc.zpp_pool;Hc.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();
return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Hc.zpp_pool;Hc.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},inlined_clear:function(){for(;null!=
this.head;)this.inlined_pop();this.pushmod=!0},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Dc};var Ce=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_CbSet"]=Ce;Ce.__name__=!0;Ce.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Ic.zpp_pool?b=new Ic:(b=Ic.zpp_pool,Ic.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;
return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Ic.zpp_pool;Ic.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=
c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Ic.zpp_pool;Ic.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Ce};var Ub=function(a){Ga.call(this,a);this._initFlambeScene2_5D()};h["tools.spark.framework.flambe2_5D.FlambeScene2_5D"]=Ub;Ub.__name__=!0;Ub.__super__=Ga;Ub.prototype=v(Ga.prototype,{_initFlambeScene2_5D:function(){var a=
y(this,this._updatePhysics);this._updateStateFunctions.set("physicsScene",a);a},createInstance:function(a){var b=new Va;this._instances.set(a,b);b;b=new M;b.blendMode=ba.Copy;b.centerAnchor();this._instances.h[a.__id__].add(b);return Ga.prototype.createInstance.call(this,a)},update:function(a){this._updateState("physicsScene",a);for(var b=0,c=this.children;b<c.length;){var d=c[b];++b;d.update(a)}},_createChildOfInstance:function(a,b){this._instances.h[b.__id__].addChild(A.__cast(a.createInstance(b),
Va));Ga.prototype._createChildOfInstance.call(this,a,b)},_removeChildOfInstance:function(a,b){this._instances.h[b.__id__].removeChild(A.__cast(a.getInstance(b),Va));Ga.prototype._removeChildOfInstance.call(this,a,b)},updateCamera:function(a,b){Ga.prototype.updateCamera.call(this,a,b);var c=this._instances.h[a.__id__]._compMap.Sprite_3;c.setXY(this._tempX,this._tempY);c.setScaleXY(this._scaleX,this._scaleY);if(null!=a.scene.gameEntity.getState("backgroundEntity")&&"Editor Scene Edit Camera"!=b.gameEntity.getState("name")){var c=
A.__cast(a.scene.gameEntity.getState("backgroundEntity"),lf),d=c.getState("boundsRect").width,e=a.scene.gameEntity.getState("boundsWidth"),i=a.gameEntity.getState("feedbackWidth"),m=a.scene.gameEntity.getState("boundsX")+e,e=d/2-this._tempX/this._scaleX,d=d-i/this._scaleX,i=a.scene.gameEntity.getState("boundsX"),m=m-b.gameEntity.getState("captureAreaWidth");c.setState("spaceX",e-d*((-1*(this._tempX/this._scaleX)-i)/(m-i)))}},_updatePhysics:function(a,b){var c=this._instances.h[b.__id__];if(a){var d=
new Mg(this.gameEntity.getState("gravityX"),this.gameEntity.getState("gravityY"));c.add(d);this._scenePhysicsInit(d.space)}},_scenePhysicsInit:function(a){a.zpp_inner.wrap_listeners.add(new Uc(function(){null==f.CbEvent_BEGIN&&(f.internal=!0,f.CbEvent_BEGIN=new Ra,f.internal=!1);return f.CbEvent_BEGIN}(this),function(){null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new oa,f.internal=!1);return f.InteractionType_COLLISION}(this),qa.ANY_BODY,qa.ANY_BODY,y(this,this._beginHandlerCollision)));
a.zpp_inner.wrap_listeners.add(new Uc(function(){null==f.CbEvent_END&&(f.internal=!0,f.CbEvent_END=new Ra,f.internal=!1);return f.CbEvent_END}(this),function(){null==f.InteractionType_COLLISION&&(f.internal=!0,f.InteractionType_COLLISION=new oa,f.internal=!1);return f.InteractionType_COLLISION}(this),qa.ANY_BODY,qa.ANY_BODY,y(this,this._endHandlerCollision)));a.zpp_inner.wrap_listeners.add(new Uc(function(){null==f.CbEvent_BEGIN&&(f.internal=!0,f.CbEvent_BEGIN=new Ra,f.internal=!1);return f.CbEvent_BEGIN}(this),
function(){null==f.InteractionType_ANY&&(f.internal=!0,f.InteractionType_ANY=new oa,f.internal=!1);return f.InteractionType_ANY}(this),qa.ANY_BODY,qa.ANY_BODY,y(this,this._beginHandlerSensor)));a.zpp_inner.wrap_listeners.add(new Uc(function(){null==f.CbEvent_END&&(f.internal=!0,f.CbEvent_END=new Ra,f.internal=!1);return f.CbEvent_END}(this),function(){null==f.InteractionType_ANY&&(f.internal=!0,f.InteractionType_ANY=new oa,f.internal=!1);return f.InteractionType_ANY}(this),qa.ANY_BODY,qa.ANY_BODY,
y(this,this._endHandlerSensor)));a.zpp_inner.wrap_listeners.add(new Uc(function(){null==f.CbEvent_BEGIN&&(f.internal=!0,f.CbEvent_BEGIN=new Ra,f.internal=!1);return f.CbEvent_BEGIN}(this),function(){null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new oa,f.internal=!1);return f.InteractionType_SENSOR}(this),Ub.BIPED_FEET,qa.ANY_BODY,y(this,this._beginHandlerSensorFeet)));a.zpp_inner.wrap_listeners.add(new Uc(function(){null==f.CbEvent_END&&(f.internal=!0,f.CbEvent_END=new Ra,
f.internal=!1);return f.CbEvent_END}(this),function(){null==f.InteractionType_SENSOR&&(f.internal=!0,f.InteractionType_SENSOR=new oa,f.internal=!1);return f.InteractionType_SENSOR}(this),Ub.BIPED_FEET,qa.ANY_BODY,y(this,this._endHandlerSensorFeet)))},_beginHandlerCollision:function(a){null!=a.zpp_inner.int1.outer_i.get_userData().gameEntity&&null!=a.zpp_inner.int2.outer_i.get_userData().gameEntity&&(B.event.raiseEvent(n.PHYSICS_COLLISION_START,a.zpp_inner.int1.outer_i.get_userData().gameEntity),B.event.raiseEvent(n.PHYSICS_COLLISION_START,
a.zpp_inner.int2.outer_i.get_userData().gameEntity),w.logger.error("REAL COLLISION START!",null))},_endHandlerCollision:function(a){null!=a.zpp_inner.int1.outer_i.get_userData().gameEntity&&null!=a.zpp_inner.int2.outer_i.get_userData().gameEntity&&(B.event.raiseEvent(n.PHYSICS_COLLISION_END,a.zpp_inner.int1.outer_i.get_userData().gameEntity),B.event.raiseEvent(n.PHYSICS_COLLISION_END,a.zpp_inner.int2.outer_i.get_userData().gameEntity),w.logger.error("REAL COLLISION END!",null))},_beginHandlerSensor:function(a){null!=
a.zpp_inner.int1.outer_i.get_userData().gameEntity&&null!=a.zpp_inner.int2.outer_i.get_userData().gameEntity&&(B.event.raiseEvent(n.PHYSICS_SENSOR_START,a.zpp_inner.int1.outer_i.get_userData().gameEntity),B.event.raiseEvent(n.PHYSICS_SENSOR_START,a.zpp_inner.int2.outer_i.get_userData().gameEntity),a.zpp_inner.int1.outer_i.get_userData().gameEntity.setState("collidedWith",a.zpp_inner.int2.outer_i.get_userData().gameEntity),a.zpp_inner.int2.outer_i.get_userData().gameEntity.setState("collidedWith",
a.zpp_inner.int1.outer_i.get_userData().gameEntity),w.logger.error("SENSOR COLLISION START!",null))},_endHandlerSensor:function(a){null!=a.zpp_inner.int1.outer_i.get_userData().gameEntity&&null!=a.zpp_inner.int2.outer_i.get_userData().gameEntity&&(B.event.raiseEvent(n.PHYSICS_SENSOR_END,a.zpp_inner.int1.outer_i.get_userData().gameEntity),B.event.raiseEvent(n.PHYSICS_SENSOR_END,a.zpp_inner.int2.outer_i.get_userData().gameEntity),w.logger.error("SENSOR COLLISION END!",null))},_beginHandlerSensorFeet:function(a){var b=
a.zpp_inner.int1.outer_i.get_castShape().get_body();null==b.zpp_inner_i.userData&&(b.zpp_inner_i.userData={});null!=b.zpp_inner_i.userData.gameEntity&&B.event.raiseEvent(n.PHYSICS_SENSOR_START_BIPED_FEET,function(){null==b.zpp_inner_i.userData&&(b.zpp_inner_i.userData={});return b.zpp_inner_i.userData}(this).gameEntity);null!=a.zpp_inner.int2.outer_i.get_userData().gameEntity&&B.event.raiseEvent(n.PHYSICS_SENSOR_START_BIPED_FEET,a.zpp_inner.int2.outer_i.get_userData().gameEntity)},_endHandlerSensorFeet:function(a){var b=
a.zpp_inner.int1.outer_i.get_castShape().get_body();null==b.zpp_inner_i.userData&&(b.zpp_inner_i.userData={});null!=b.zpp_inner_i.userData.gameEntity&&B.event.raiseEvent(n.PHYSICS_SENSOR_END_BIPED_FEET,function(){null==b.zpp_inner_i.userData&&(b.zpp_inner_i.userData={});return b.zpp_inner_i.userData}(this).gameEntity);null!=a.zpp_inner.int2.outer_i.get_userData().gameEntity&&B.event.raiseEvent(n.PHYSICS_SENSOR_END_BIPED_FEET,a.zpp_inner.int2.outer_i.get_userData().gameEntity)},__class__:Ub});var De=
function(a,b){Tb.call(this,a);this._flambeGraphics=b;this._initFlambeView2_5D()};h["tools.spark.framework.flambe2_5D.FlambeView2_5D"]=De;De.__name__=!0;De.__super__=Tb;De.prototype=v(Tb.prototype,{_initFlambeView2_5D:function(){this._instanceView=new Va;var a=new M;a.blendMode=ba.Copy;this._instanceView.add(a);this.gameEntity.getState("visible")&&Y.root.addChild(this._instanceView)},render:function(){this.gameEntity.getState("visible")&&M.render(this._instanceView,this._flambeGraphics)},setVisible:function(a){a?
Y.root.addChild(this._instanceView):Y.root.removeChild(this._instanceView)},set_camera:function(a){if(this.camera==a)return this.camera;if(null==a)return this.camera=null,this._updateCurrentView(),null;this.camera=a;this.camera.attachToView(this);this._updateCurrentView();return this.camera},set_scene:function(a){if(this.scene==a)return this.scene;if(null==a)return this.scene=null,this._disposeCurrentScene(),this._updateCurrentView(),null;null!=this.scene&&(this.scene=null,this._disposeCurrentScene());
this.scene=a;this._instanceScene=A.__cast(this.scene.createInstance(this),Va);this._updateCurrentView();return this.scene},_updateCurrentView:function(){null==this.scene||null==this.camera?null!=this._instanceView.firstChild&&this._instanceView.removeChild(this._instanceView.firstChild):(null==this._instanceView.firstChild&&this._instanceView.addChild(this._instanceScene),this.scene.update(this))},_disposeCurrentScene:function(){this._instanceScene=null;this._instanceView.disposeChildren()},setPosSize:function(a,
b,c,d,e){var i=this._instanceView._compMap.Sprite_3;null!=a&&i.x.set__(a);null!=b&&i.y.set__(b);Tb.prototype.setPosSize.call(this,a,b,c,d,e)},__class__:De});var Jg=function(a){ha.call(this);this.body=a};h["tools.spark.framework.flambe2_5D.components.BodyComponent"]=Jg;Jg.__name__=!0;Jg.__super__=ha;Jg.prototype=v(ha.prototype,{get_name:function(){return"BodyComponent_5"},onUpdate:function(){var a=this.body.get_position(),b=this.owner._compMap.Sprite_3;b.x.set__(function(){a.zpp_inner.validate();return a.zpp_inner.x}(this));
b.y.set__(function(){a.zpp_inner.validate();return a.zpp_inner.y}(this));b.rotation.set__(180*this.body.zpp_inner.rot/3.141592653589793)},onRemoved:function(){this.body.set_space(null)},__class__:Jg});var Mg=function(a,b){ha.call(this);this.space=new Si(new ga(a,b))};h["tools.spark.framework.flambe2_5D.components.SpaceComponent"]=Mg;Mg.__name__=!0;Mg.__super__=ha;Mg.prototype=v(ha.prototype,{get_name:function(){return"SpaceComponent_4"},onUpdate:function(a){this.space.step(a)},__class__:Mg});var Ng=
function(a){null!=a&&(this.name=a.name,this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this.sourceColorX=a.sourceColorX,this.sourceColorY=a.sourceColorY,this.rotated=a.rotated)};h["tools.spark.framework.flambe2_5D.spritesheet.PlistEntry"]=Ng;Ng.__name__=!0;Ng.prototype={__class__:Ng};var mf=function(){};h["tools.spark.framework.flambe2_5D.spritesheet.PlistParser"]=mf;mf.__name__=!0;mf.parse=function(a){for(var b=[],c=null,d=0,a=a.firstElement().firstElement().elements();a.hasNext();){var e=
a.next();if(e.nodeType!=o.Document&&e.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+e.nodeType));if("frames"==e.children[0].get_nodeValue())d=1;else{if(e.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+e.nodeType));if("dict"==e.nodeName&&1==d)c=e;else{if(e.nodeType!=o.Document&&e.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+e.nodeType));if("metadata"==e.children[0].get_nodeValue())d=
2;else if(e.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+e.nodeType));}}}d=1;a=new Ng;e="";for(c=c.elements();c.hasNext();){var i=c.next();if(i.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+i.nodeType));if("key"==i.nodeName&&1==d){d=a;if(i.nodeType!=o.Document&&i.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+i.nodeType));d.name=i.children[0].get_nodeValue();d=2}else{if(i.nodeType!=
o.Element)throw new p(new p("Bad node type, expected Element but found "+i.nodeType));if("dict"==i.nodeName&&2==d){d=1;for(i=i.elements();i.hasNext();){var m=i.next();if(m.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+m.nodeType));if("key"==m.nodeName){if(m.nodeType!=o.Document&&m.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+m.nodeType));e=m.children[0].get_nodeValue()}else switch(e){case "frame":var f=mf.parseString(function(){if(m.nodeType!=
o.Document&&m.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+m.nodeType));return m.children[0]}(this).get_nodeValue());a.x=f[0];a.y=f[1];a.width=f[2];a.height=f[3];break;case "sourceColorRect":f=mf.parseString(function(){if(m.nodeType!=o.Document&&m.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+m.nodeType));return m.children[0]}(this).get_nodeValue());a.sourceColorX=f[0];a.sourceColorY=f[1];break;case "rotated":f=
a;if(m.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+m.nodeType));f.rotated="true"==m.nodeName?!0:!1}}b.push(new Ng(a))}}}return b};mf.parseString=function(a){for(var b=[],c=new qc,d=0,e=a.length;d<e;){var i=d++;"{"!=a.charAt(i)&&"}"!=a.charAt(i)&&c.addSub(a.charAt(i),0,null)}a=0;for(c=c.b.split(",");a<c.length;)d=c[a],++a,b.push(parseFloat(d));return b};var nf=function(a,b){null==b&&(b=0);null==a&&(a=0);this.width=a;this.height=b};h["tools.spark.framework.flambe2_5D.spritesheet.Size"]=
nf;nf.__name__=!0;nf.prototype={__class__:nf};var of=function(){this._offset=new ec(0,0);this._offsetInPixels=new ec(0,0);this._originalSize=new nf(0,0);this._rectInPixels=new tc(0,0,0,0);this._rect=new tc(0,0,0,0);this._originalSizeInPixels=new nf(0,0);this._textureFilname=""};h["tools.spark.framework.flambe2_5D.spritesheet.SpriteFrame"]=of;of.__name__=!0;of.createWithTexture=function(a,b,c,d,e){var i=new of;i.initWithTexture(a,b,c,d,e);return i};of.prototype={isRotated:function(){return this._rotated},
getRect:function(){return this._rect},getTexture:function(){return null!=this._texture?this._texture:null},getOffset:function(){return new ec(this._offset.x,this._offset.y)},initWithTexture:function(a,b,c,d,e){this._texture=a;this._rect=this._rectInPixels=b;this._offset=this._offsetInPixels=d;this._originalSize=this._originalSizeInPixels=e;this._rotated=c;return!0},__class__:of};var pf=function(a){M.call(this);this.frame=a};h["tools.spark.framework.flambe2_5D.spritesheet.SpriteSheet"]=pf;pf.__name__=
!0;pf.__super__=M;pf.prototype=v(M.prototype,{draw:function(a){this.g=a;this.frame.isRotated()?(a.translate(this.frame.getOffset().x,this.frame.getOffset().y+this.frame.getRect().height),a.rotate(-90),a.drawSubTexture(this.frame.getTexture(),0,0,this.frame.getRect().x,this.frame.getRect().y,this.frame.getRect().height,this.frame.getRect().width)):(a.translate(this.frame.getOffset().x,this.frame.getOffset().y),a.drawSubTexture(this.frame.getTexture(),0,0,this.frame.getRect().x,this.frame.getRect().y,
this.frame.getRect().width,this.frame.getRect().height))},getNaturalHeight:function(){return null==this.frame?0:this.frame.getRect().height},getNaturalWidth:function(){return null==this.frame?0:this.frame.getRect().width},__class__:pf});var Ig=function(a,b){this.paused=this.isLooping=!1;this.currentIndex=0;ha.call(this);var c=o.parse(a.getFile(b).toString());this.plist=mf.parse(c);this._spriteFramesInfo=[];this.sprites=[];null==this.texture&&(this.texture=a.getTexture(b+"_sheet"));this._addSpriteFramesWithDictionary();
this._initSprites();this._root=new Va;this.speed=-1};h["tools.spark.framework.flambe2_5D.spritesheet.SpriteSheetPlayer"]=Ig;Ig.__name__=!0;Ig.__super__=ha;Ig.prototype=v(ha.prototype,{get_name:function(){return"SpriteSheetPlayer_2"},_addSpriteFramesWithDictionary:function(){for(var a=0,b=this.plist;a<b.length;){var c=b[a];++a;var d=new tc(c.x,c.y,c.width,c.height),e=c.rotated,c=new ec(c.sourceColorX,c.sourceColorY),i=new nf(0,0);this._spriteFramesInfo.push(of.createWithTexture(this.texture,d,e,c,
i))}},_initSprites:function(){this.currentFrame=new pf(this._spriteFramesInfo[0]);this.currentIndex++},play:function(){null==q.instance(this._root._compMap.Sprite_3,pf)&&(this._root.add(this.currentFrame),this.currentFrame.centerAnchor());this.currentIndex=0;this.paused=!1},loop:function(){this.play();this.isLooping=!0},onAdded:function(){this.owner.addChild(this._root);this.oldTime=(new Date).getTime();this.curTime=(new Date).getTime()},onRemoved:function(){this._root.parent.removeChild(this._root);
this.currentFrame.frame=this._spriteFramesInfo[0];this.currentIndex=0;this.isLooping=this.paused=!1},onUpdate:function(){if(-1!=this.speed){this.curTime=(new Date).getTime();if(this.curTime-this.oldTime<this.speed)return;this.oldTime=this.curTime}!this.paused&&null!=this.currentFrame&&(this.currentIndex==this._spriteFramesInfo.length&&(this.isLooping?this.currentIndex=0:this.paused=!0),this.paused||(this.currentFrame.frame=this._spriteFramesInfo[this.currentIndex++]))},setSpeed:function(a){this.speed=
a},__class__:Ig});var lb=h["tools.spark.framework.haxe.Filter"]={__ename__:!0,__constructs__:["FInt","FBool","FEnum","FReg"]};lb.FInt=["FInt",0];lb.FInt.toString=j;lb.FInt.__enum__=lb;lb.FBool=["FBool",1];lb.FBool.toString=j;lb.FBool.__enum__=lb;lb.FEnum=function(a){a=["FEnum",2,a];a.__enum__=lb;a.toString=j;return a};lb.FReg=function(a){a=["FReg",3,a];a.__enum__=lb;a.toString=j;return a};lb.__empty_constructs__=[lb.FInt,lb.FBool];var Hk=h["tools.spark.framework.haxe.Attrib"]={__ename__:!0,__constructs__:["Att"]};
Hk.Att=function(a,b,c){a=["Att",0,a,b,c];a.__enum__=Hk;a.toString=j;return a};Hk.__empty_constructs__=[];var s=h["tools.spark.framework.haxe.Rule"]={__ename__:!0,__constructs__:"RNode,RData,RMulti,RList,RChoice,ROptional".split(",")};s.RNode=function(a,b,c){a=["RNode",0,a,b,c];a.__enum__=s;a.toString=j;return a};s.RData=function(a){a=["RData",1,a];a.__enum__=s;a.toString=j;return a};s.RMulti=function(a,b){var c=["RMulti",2,a,b];c.__enum__=s;c.toString=j;return c};s.RList=function(a,b){var c=["RList",
3,a,b];c.__enum__=s;c.toString=j;return c};s.RChoice=function(a){a=["RChoice",4,a];a.__enum__=s;a.toString=j;return a};s.ROptional=function(a){a=["ROptional",5,a];a.__enum__=s;a.toString=j;return a};s.__empty_constructs__=[];var X=h["tools.spark.framework.haxe._LooseCheck.CheckResult"]={__ename__:!0,__constructs__:"CMatch,CMissing,CExtra,CElementExpected,CDataExpected,CExtraAttrib,CMissingAttrib,CInvalidAttrib,CInvalidData,CInElement".split(",")};X.CMatch=["CMatch",0];X.CMatch.toString=j;X.CMatch.__enum__=
X;X.CMissing=function(a){a=["CMissing",1,a];a.__enum__=X;a.toString=j;return a};X.CExtra=function(a){a=["CExtra",2,a];a.__enum__=X;a.toString=j;return a};X.CElementExpected=function(a,b){var c=["CElementExpected",3,a,b];c.__enum__=X;c.toString=j;return c};X.CDataExpected=function(a){a=["CDataExpected",4,a];a.__enum__=X;a.toString=j;return a};X.CExtraAttrib=function(a,b){var c=["CExtraAttrib",5,a,b];c.__enum__=X;c.toString=j;return c};X.CMissingAttrib=function(a,b){var c=["CMissingAttrib",6,a,b];c.__enum__=
X;c.toString=j;return c};X.CInvalidAttrib=function(a,b,c){a=["CInvalidAttrib",7,a,b,c];a.__enum__=X;a.toString=j;return a};X.CInvalidData=function(a,b){var c=["CInvalidData",8,a,b];c.__enum__=X;c.toString=j;return c};X.CInElement=function(a,b){var c=["CInElement",9,a,b];c.__enum__=X;c.toString=j;return c};X.__empty_constructs__=[X.CMatch];var N=function(){};h["tools.spark.framework.haxe.LooseCheck"]=N;N.__name__=!0;N.isBlank=function(a){return a.nodeType==o.PCData&&N.blanks.match(function(){if(a.nodeType==
o.Document||a.nodeType==o.Element)throw new p("Bad node type, unexpected "+a.nodeType);return a.nodeValue}(this))||a.nodeType==o.Comment};N.filterMatch=function(a,b){switch(b[1]){case 0:return N.filterMatch(a,lb.FReg(new cc("[0-9]+","")));case 1:return N.filterMatch(a,lb.FEnum(["true","false","0","1"]));case 2:for(var c=b[2],d=0;d<c.length;){var e=c[d];++d;if(a==e)return!0}return!1;case 3:return b[2].match(a)}};N.isNullable=function(a){switch(a[1]){case 2:var b=a[2];return!0!=a[3]||N.isNullable(b);
case 3:a=a[2];for(b=0;b<a.length;){var c=a[b];++b;if(!N.isNullable(c))return!1}return!0;case 4:a=a[2];for(b=0;b<a.length;)if(c=a[b],++b,N.isNullable(c))return!0;return!1;case 1:return!1;case 0:return!1;case 5:return!0}};N.check=function(a,b){switch(b[1]){case 0:var c=b[4],d=b[3],e=b[2],i;if(!(i=a.nodeType!=o.Element)){if(a.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+a.nodeType);i=a.nodeName!=e}if(i)return X.CElementExpected(e,a);if(null!=d){e=d.slice();for(i=a.attributes();i.hasNext();){for(var m=
i.next(),f=!1,r=0;r<e.length;){var g=e[r];++r;var h=g[3],j=g[2];if(m==j){if(null!=h&&!N.filterMatch(a.get(m),h))return X.CInvalidAttrib(j,a,h);E.remove(e,g);f=!0}}if(!f)return X.CExtraAttrib(m,a)}for(i=0;i<e.length;)if(m=e[i],++i,f=m[2],null==m[4])return X.CMissingAttrib(f,a)}if(null!=c&&(c=N.checkList(function(){if(a.nodeType!=o.Document&&a.nodeType!=o.Element)throw new p("Bad node type, expected Element or Document but found "+a.nodeType);return E.iter(a.children)}(this),c),c!=X.CMatch))return X.CInElement(a,
c);if(null!=d)for(c=0;c<d.length;)e=d[c],++c,a.set(e[2],e[4]);return X.CMatch;case 1:return d=b[2],a.nodeType!=o.PCData&&a.nodeType!=o.CData?X.CDataExpected(a):null!=d&&!N.filterMatch(function(){if(a.nodeType==o.Document||a.nodeType==o.Element)throw new p("Bad node type, unexpected "+a.nodeType);return a.nodeValue}(this),d)?X.CInvalidData(a,d):X.CMatch;case 4:d=b[2];if(0==d.length)throw new p("No choice possible");for(c=0;c<d.length;)if(e=d[c],++c,N.check(a,e)==X.CMatch)return X.CMatch;return N.check(a,
d[0]);case 5:return N.check(a,b[2]);default:throw new p("Unexpected "+q.string(b));}};N.checkList=function(a,b){switch(b[1]){case 3:for(var c=b[3],d=b[2].slice();a.hasNext();){var e=a.next();if(!N.isBlank(e)){for(var i=!1,m=0;m<d.length;){var f=d[m];++m;var r=N.checkList(E.iter([e]),f);if(r==X.CMatch){i=!0;switch(f[1]){case 2:m=f[2];if(f[3])for(var r=0,g=d.length;r<g;){var h=r++;d[h]==f&&(d[h]=s.RMulti(m))}break;default:E.remove(d,f)}break}else if(c&&!N.isNullable(f))return r}if(!i)return X.CExtra(e)}}for(c=
0;c<d.length;)if(e=d[c],++c,!N.isNullable(e))return X.CMissing(e);return X.CMatch;case 2:d=b[3];c=b[2];for(e=!1;a.hasNext();)if(i=a.next(),!N.isBlank(i)){e=N.checkList(E.iter([i]),c);if(e!=X.CMatch)return e;e=!0}return d&&!e?X.CMissing(c):X.CMatch;default:for(d=!1;a.hasNext();)if(c=a.next(),!N.isBlank(c)){d=N.check(c,b);if(d!=X.CMatch)return d;d=!0;break}if(!d)switch(b[1]){case 5:break;default:return X.CMissing(b)}for(;a.hasNext();)if(d=a.next(),!N.isBlank(d))return X.CExtra(d);return X.CMatch}};
N.makeWhere=function(a){if(0==a.length)return"";for(var b="In ",c=!0,d=0;d<a.length;){var e=a[d];++d;c?c=!1:b+=".";if(e.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+e.nodeType);b+=e.nodeName}return b+": "};N.makeString=function(a){if(a.nodeType==o.Element){if(a.nodeType!=o.Element)throw new p("Bad node type, expected Element but found "+a.nodeType);return"element "+a.nodeName}if(a.nodeType==o.Document||a.nodeType==o.Element)throw new p("Bad node type, unexpected "+
a.nodeType);a=a.nodeValue.split("\r").join("\\r").split("\n").join("\\n").split("\t").join("\\t");return 20<a.length?E.substr(a,0,17)+"...":a};N.makeRule=function(a){switch(a[1]){case 0:return"element "+a[2];case 1:return"data";case 2:return N.makeRule(a[2]);case 3:return N.makeRule(a[2][0]);case 4:return N.makeRule(a[2][0]);case 5:return N.makeRule(a[2])}};N.makeError=function(a,b){null==b&&(b=[]);switch(a[1]){case 0:throw new p("assert");case 1:var c=a[2];return N.makeWhere(b)+"Missing "+N.makeRule(c);
case 2:return c=a[2],N.makeWhere(b)+"Unexpected "+N.makeString(c);case 3:var c=a[3],d=a[2];return N.makeWhere(b)+N.makeString(c)+" while expected element "+d;case 4:return c=a[2],N.makeWhere(b)+N.makeString(c)+" while data expected";case 5:return c=a[2],b.push(a[3]),N.makeWhere(b)+"unexpected attribute "+c;case 6:return c=a[2],b.push(a[3]),N.makeWhere(b)+"missing required attribute "+c;case 7:return c=a[2],b.push(a[3]),N.makeWhere(b)+"invalid attribute value for "+c;case 8:return c=a[2],N.makeWhere(b)+
"invalid data format for "+N.makeString(c);case 9:return c=a[3],b.push(a[2]),N.makeError(c,b)}};N.checkNode=function(a,b){var c=N.checkList(E.iter([a]),b);if(c!=X.CMatch)throw new p(N.makeError(c));};var ye=function(a,b,c){this.layoutableEntity=a;this.layoutableInstanceType=b;this.layoutableInstance=c;this.children=[];this.visibleStartX=this.visibleStartY=this.x=this.y=this.width=this.height=0;this.visibleStartIndex=this.visibleEndIndex=this.numElementsCached=-1;this.tileWidthCached=this.tileHeightCached=
null;this.rowCount=this.columnCount=-1};h["tools.spark.framework.layout.containers.Group"]=ye;ye.__name__=!0;ye.prototype={update:function(){this.updateState("layout");this.updateState("includeInLayout");this.updateState("x");this.updateState("y");this.updateState("width");this.updateState("height");this.updateState("left");this.updateState("top");this.updateState("right");this.updateState("bottom");this.updateState("horizontalCenter");this.updateState("verticalCenter");if(null!=this.layout&&"Basic"!=
this.layout.layoutType){this.updateState("paddingLeft");this.updateState("paddingRight");this.updateState("paddingTop");this.updateState("paddingBottom");this.updateState("horizontalAlign");this.updateState("verticalAlign");("Horizontal"==this.layout.layoutType||"Vertical"==this.layout.layoutType)&&this.updateState("gap");if("Horizontal"==this.layout.layoutType||"Tile"==this.layout.layoutType)this.updateState("columnWidth"),this.updateState("requestedColumnCount");"Horizontal"==this.layout.layoutType&&
(this.updateState("requestedMaxColumnCount"),this.updateState("requestedMinColumnCount"),this.updateState("variableColumnWidth"));if("Vertical"==this.layout.layoutType||"Tile"==this.layout.layoutType)this.updateState("rowHeight"),this.updateState("requestedRowCount");"Vertical"==this.layout.layoutType&&(this.updateState("requestedMaxRowCount"),this.updateState("requestedMinRowCount"),this.updateState("variableRowHeight"));"Tile"==this.layout.layoutType&&(this.updateState("horizontalGap"),this.updateState("verticalGap"),
this.updateState("rowAlign"),this.updateState("columnAlign"),this.updateState("orientation"))}},updateState:function(a){switch(a){case "layout":this._updateLayout(this.layoutableEntity.getState(a));break;case "includeInLayout":this.includeInLayout=this.layoutableEntity.getState(a);break;case "x":(function(b){b=b.layoutableEntity.getState(a);return isNaN(b)})(this)||(this.x=this.layoutableEntity.getState(a));break;case "y":(function(b){b=b.layoutableEntity.getState(a);return isNaN(b)})(this)||(this.y=
this.layoutableEntity.getState(a));break;case "width":this._updateExplicitSize(this.layoutableEntity.getState(a),"width");break;case "height":this._updateExplicitSize(this.layoutableEntity.getState(a),"height");break;case "left":(function(b){b=b.layoutableEntity.getState(a);return isNaN(b)})(this)||(this.left=this.layoutableEntity.getState(a));break;case "top":(function(b){b=b.layoutableEntity.getState(a);return isNaN(b)})(this)||(this.top=this.layoutableEntity.getState(a));break;case "right":(function(b){b=
b.layoutableEntity.getState(a);return isNaN(b)})(this)||(this.right=this.layoutableEntity.getState(a));break;case "bottom":(function(b){b=b.layoutableEntity.getState(a);return isNaN(b)})(this)||(this.bottom=this.layoutableEntity.getState(a));break;case "horizontalCenter":(function(b){b=b.layoutableEntity.getState(a);return isNaN(b)})(this)||(this.horizontalCenter=this.layoutableEntity.getState(a));break;case "verticalCenter":(function(b){b=b.layoutableEntity.getState(a);return isNaN(b)})(this)||(this.verticalCenter=
this.layoutableEntity.getState(a));break;case "paddingLeft":this.paddingLeft=this.layoutableEntity.getState(a);break;case "paddingRight":this.paddingRight=this.layoutableEntity.getState(a);break;case "paddingTop":this.paddingTop=this.layoutableEntity.getState(a);break;case "paddingBottom":this.paddingBottom=this.layoutableEntity.getState(a);break;case "gap":this.gap=this.layoutableEntity.getState(a);break;case "horizontalAlign":var b=this.layoutableEntity.getState(a);"left"==b?this.horizontalAlign=
aa.LEFT:"center"==b?this.horizontalAlign=aa.CENTER:"right"==b?this.horizontalAlign=aa.RIGHT:"justify"==b?this.horizontalAlign=aa.JUSTIFY:"contentJustify"==b&&(this.horizontalAlign=aa.CONTENT_JUSTIFY);break;case "verticalAlign":b=this.layoutableEntity.getState(a);"top"==b?this.verticalAlign=L.TOP:"middle"==b?this.verticalAlign=L.MIDDLE:"bottom"==b?this.verticalAlign=L.BOTTOM:"justify"==b?this.verticalAlign=L.JUSTIFY:"contentJustify"==b&&(this.verticalAlign=L.CONTENT_JUSTIFY);break;case "columnWidth":b=
this.layoutableEntity.getState(a);this.columnWidth="calculated"==b?this.explicitColumnWidth=null:this.explicitColumnWidth=parseFloat(b);break;case "requestedColumnCount":this.requestedColumnCount=this.layoutableEntity.getState(a);break;case "requestedMaxColumnCount":this.requestedMaxColumnCount=this.layoutableEntity.getState(a);break;case "requestedMinColumnCount":this.requestedMinColumnCount=this.layoutableEntity.getState(a);break;case "variableColumnWidth":this.variableColumnWidth=this.layoutableEntity.getState(a);
break;case "rowHeight":b=this.layoutableEntity.getState(a);this.rowHeight="calculated"==b?this.explicitRowHeight=null:this.explicitRowHeight=parseFloat(b);break;case "requestedRowCount":this.requestedRowCount=this.layoutableEntity.getState(a);break;case "requestedMaxRowCount":this.requestedMaxRowCount=this.layoutableEntity.getState(a);break;case "requestedMinRowCount":this.requestedMinRowCount=this.layoutableEntity.getState(a);break;case "variableRowHeight":this.variableRowHeight=this.layoutableEntity.getState(a);
break;case "horizontalGap":this.horizontalGap=this.explicitHorizontalGap=this.layoutableEntity.getState(a);break;case "verticalGap":this.verticalGap=this.explicitVerticalGap=this.layoutableEntity.getState(a);break;case "rowAlign":b=this.layoutableEntity.getState(a);"top"==b?this.rowAlign=db.TOP:"justifyUsingHeight"==b?this.rowAlign=db.JUSTIFY_USING_HEIGHT:"justifyUsingGap"==b&&(this.rowAlign=db.JUSTIFY_USING_GAP);break;case "columnAlign":b=this.layoutableEntity.getState(a);"left"==b?this.columnAlign=
Da.LEFT:"justifyUsingWidth"==b?this.columnAlign=Da.JUSTIFY_USING_WIDTH:"justifyUsingGap"==b&&(this.columnAlign=Da.JUSTIFY_USING_GAP);break;case "orientation":b=this.layoutableEntity.getState(a),"rows"==b?this.orientation=ob.ROWS:"columns"==b&&(this.orientation=ob.COLUMNS)}},_updateLayout:function(a){"Basic"==a?null==this.layout?this.set_layout(new Vb):this.layout.layoutType!=a&&this.set_layout(new Vb):"Horizontal"==a?null==this.layout?this.set_layout(new Na):this.layout.layoutType!=a&&this.set_layout(new Na):
"Vertical"==a?null==this.layout?this.set_layout(new xb):this.layout.layoutType!=a&&this.set_layout(new xb):"Tile"==a&&(null==this.layout?this.set_layout(new qf):this.layout.layoutType!=a&&this.set_layout(new qf));this.layout.set_target(this)},_updateExplicitSize:function(a,b){var c=null,d=null;"Implicit"!=a&&(-1!=a.indexOf("%")?d=parseFloat(a):c=parseFloat(a));"width"==b?(this.explicitWidth=c,this.percentWidth=d):(this.explicitHeight=c,this.percentHeight=d)},set_layout:function(a){return this.layout==
a?this.layout:this.layout=a},measure:function(){this.layout.measure()},updateDisplayList:function(a,b){this.layout.updateDisplayList(a,b)},setActualSize:function(a,b){null!=this.explicitWidth?this.width=this.explicitWidth:null!=a&&0!=a?this.measuredWidth=this.width=a:0!=this.get_preferredWidth()&&(this.width=this.get_preferredWidth());null!=this.explicitHeight?this.height=this.explicitHeight:null!=b&&0!=b?this.measuredHeight=this.height=b:0!=this.get_preferredHeight()&&(this.height=this.get_preferredHeight())},
get_preferredWidth:function(){return null==this.explicitWidth?this.measuredWidth:this.explicitWidth},get_preferredHeight:function(){return null==this.explicitHeight?this.measuredHeight:this.explicitHeight},get_preferredMinWidth:function(){return null==this.explicitMinWidth?this.measuredMinWidth:this.explicitMinWidth},get_preferredMinHeight:function(){return null==this.explicitMinHeight?this.measuredMinHeight:this.explicitMinHeight},get_preferredMaxWidth:function(){return null==this.explicitMaxWidth?
this.measuredMaxWidth:this.explicitMaxWidth},get_preferredMaxHeight:function(){return null==this.explicitMaxHeight?this.measuredMaxHeight:this.explicitMaxHeight},__class__:ye,__properties__:{get_preferredMaxHeight:"get_preferredMaxHeight",get_preferredMaxWidth:"get_preferredMaxWidth",get_preferredMinHeight:"get_preferredMinHeight",get_preferredMinWidth:"get_preferredMinWidth",get_preferredHeight:"get_preferredHeight",get_preferredWidth:"get_preferredWidth",set_layout:"set_layout"}};var Og=function(){this.size=
0};h["tools.spark.framework.layout.helpers.ChildInfo"]=Og;Og.__name__=!0;Og.prototype={__class__:Og};var mj=function(){};h["tools.spark.framework.layout.helpers.LayoutHelper"]=mj;mj.__name__=!0;mj.flexChildrenProportionally=function(a,b,c,d){var e=d.length,i,m,f;do{i=0;m=!0;f=b-a*c/100;0<f?b-=f:f=0;for(var r=b/c,g=0;g<e;){var h=d[g],j=h.percent*r;if(j<h.min){m=h.min;h.size=m;d[g]=d[--e];d[e]=h;c-=h.percent;f>=m?f-=m:(b-=m-f,f=0);m=!1;break}else if(j>h.max){m=h.max;h.size=m;d[g]=d[--e];d[e]=h;c-=h.percent;
f>=m?f-=m:(b-=m-f,f=0);m=!1;break}else h.size=j,i+=j;g++}}while(!m);return Math.max(0,Math.floor(b+f-i))};var Pg=function(){};h["tools.spark.framework.layout.helpers.SizesAndLimit"]=Pg;Pg.__name__=!0;Pg.prototype={__class__:Pg};var Da=h["tools.spark.framework.layout.interfaces.EColumnAlign"]={__ename__:!0,__constructs__:["JUSTIFY_USING_GAP","JUSTIFY_USING_WIDTH","LEFT"]};Da.JUSTIFY_USING_GAP=["JUSTIFY_USING_GAP",0];Da.JUSTIFY_USING_GAP.toString=j;Da.JUSTIFY_USING_GAP.__enum__=Da;Da.JUSTIFY_USING_WIDTH=
["JUSTIFY_USING_WIDTH",1];Da.JUSTIFY_USING_WIDTH.toString=j;Da.JUSTIFY_USING_WIDTH.__enum__=Da;Da.LEFT=["LEFT",2];Da.LEFT.toString=j;Da.LEFT.__enum__=Da;Da.__empty_constructs__=[Da.JUSTIFY_USING_GAP,Da.JUSTIFY_USING_WIDTH,Da.LEFT];var aa=h["tools.spark.framework.layout.interfaces.EHorizontalAlign"]={__ename__:!0,__constructs__:["LEFT","CENTER","RIGHT","JUSTIFY","CONTENT_JUSTIFY"]};aa.LEFT=["LEFT",0];aa.LEFT.toString=j;aa.LEFT.__enum__=aa;aa.CENTER=["CENTER",1];aa.CENTER.toString=j;aa.CENTER.__enum__=
aa;aa.RIGHT=["RIGHT",2];aa.RIGHT.toString=j;aa.RIGHT.__enum__=aa;aa.JUSTIFY=["JUSTIFY",3];aa.JUSTIFY.toString=j;aa.JUSTIFY.__enum__=aa;aa.CONTENT_JUSTIFY=["CONTENT_JUSTIFY",4];aa.CONTENT_JUSTIFY.toString=j;aa.CONTENT_JUSTIFY.__enum__=aa;aa.__empty_constructs__=[aa.LEFT,aa.CENTER,aa.RIGHT,aa.JUSTIFY,aa.CONTENT_JUSTIFY];var db=h["tools.spark.framework.layout.interfaces.ERowAlign"]={__ename__:!0,__constructs__:["JUSTIFY_USING_GAP","JUSTIFY_USING_HEIGHT","TOP"]};db.JUSTIFY_USING_GAP=["JUSTIFY_USING_GAP",
0];db.JUSTIFY_USING_GAP.toString=j;db.JUSTIFY_USING_GAP.__enum__=db;db.JUSTIFY_USING_HEIGHT=["JUSTIFY_USING_HEIGHT",1];db.JUSTIFY_USING_HEIGHT.toString=j;db.JUSTIFY_USING_HEIGHT.__enum__=db;db.TOP=["TOP",2];db.TOP.toString=j;db.TOP.__enum__=db;db.__empty_constructs__=[db.JUSTIFY_USING_GAP,db.JUSTIFY_USING_HEIGHT,db.TOP];var ob=h["tools.spark.framework.layout.interfaces.ETileOrientation"]={__ename__:!0,__constructs__:["COLUMNS","ROWS"]};ob.COLUMNS=["COLUMNS",0];ob.COLUMNS.toString=j;ob.COLUMNS.__enum__=
ob;ob.ROWS=["ROWS",1];ob.ROWS.toString=j;ob.ROWS.__enum__=ob;ob.__empty_constructs__=[ob.COLUMNS,ob.ROWS];var L=h["tools.spark.framework.layout.interfaces.EVerticalAlign"]={__ename__:!0,__constructs__:["TOP","MIDDLE","BOTTOM","JUSTIFY","CONTENT_JUSTIFY"]};L.TOP=["TOP",0];L.TOP.toString=j;L.TOP.__enum__=L;L.MIDDLE=["MIDDLE",1];L.MIDDLE.toString=j;L.MIDDLE.__enum__=L;L.BOTTOM=["BOTTOM",2];L.BOTTOM.toString=j;L.BOTTOM.__enum__=L;L.JUSTIFY=["JUSTIFY",3];L.JUSTIFY.toString=j;L.JUSTIFY.__enum__=L;L.CONTENT_JUSTIFY=
["CONTENT_JUSTIFY",4];L.CONTENT_JUSTIFY.toString=j;L.CONTENT_JUSTIFY.__enum__=L;L.__empty_constructs__=[L.TOP,L.MIDDLE,L.BOTTOM,L.JUSTIFY,L.CONTENT_JUSTIFY];var kc=function(){};h["tools.spark.framework.layout.layouts.ALayoutBase"]=kc;kc.__name__=!0;kc.prototype={get_typicalLayoutElement:function(){null==this._typicalLayoutElement&&null!=this.target&&0<this.target.children.length&&(this._typicalLayoutElement=this.target.children[0]);return this._typicalLayoutElement},set_target:function(a){return this.target==
a?this.target:this.target=a},measure:function(){},updateDisplayList:function(){},__class__:kc,__properties__:{get_typicalLayoutElement:"get_typicalLayoutElement",set_target:"set_target"}};var Vb=function(){this.layoutType="Basic"};h["tools.spark.framework.layout.layouts.BasicLayout"]=Vb;Vb.__name__=!0;Vb._constraintsDetermineWidth=function(a){return null!=a.percentWidth||null!=a.left&&null!=a.right};Vb._constraintsDetermineHeight=function(a){return null!=a.percentHeight||null!=a.top&&null!=a.bottom};
Vb._maxSizeToFitIn=function(a,b,c,d,e){return null!=b?a-2*Math.abs(b):null!=c?a-c:null!=d?a-d:a-e};Vb.__super__=kc;Vb.prototype=v(kc.prototype,{measure:function(){for(var a=0,b=0,c=0,d=0,e=0,i=this.target.children;e<i.length;){var m=i[e];++e;if(!(null==m||!1==m.includeInLayout)){var f,r;null!=m.left&&null!=m.right?f=m.left+m.right:null!=m.horizontalCenter?f=2*Math.abs(m.horizontalCenter):null!=m.left||null!=m.right?(f=null==m.left?0:m.left,f=null==m.right?f+0:f+m.right):f=m.x;null!=m.top&&null!=m.bottom?
r=m.top+m.bottom:null!=m.verticalCenter?r=2*Math.abs(m.verticalCenter):null!=m.top||null!=m.bottom?(r=null==m.top?0:m.top,r=null==m.bottom?r+0:r+m.bottom):r=m.y;var a=Math.max(a,f+m.get_preferredWidth()),b=Math.max(b,r+m.get_preferredHeight()),g;g=Vb._constraintsDetermineWidth(m)?m.get_preferredMinWidth():m.get_preferredWidth();m=Vb._constraintsDetermineHeight(m)?m.get_preferredMinHeight():m.get_preferredHeight();c=Math.max(c,f+g);d=Math.max(d,r+m)}}this.target.measuredWidth=Math.ceil(Math.max(a,
c));this.target.measuredHeight=Math.ceil(Math.max(b,d));this.target.measuredMinWidth=Math.ceil(c);this.target.measuredMinHeight=Math.ceil(d);this.target.measuredMaxWidth=999999;this.target.measuredMaxHeight=999999},updateDisplayList:function(a,b){for(var c=0,d=0,e=0,i=this.target.children;e<i.length;){var m=i[e];++e;if(!(null==m||!1==m.includeInLayout)){var f=null,r=null,g=null,h=null;null!=m.percentWidth?(f=a,null!=m.left&&(f-=m.left),null!=m.right&&(f-=m.right),g=Math.round(f*Math.min(0.01*m.percentWidth,
1)),f=Math.min(m.get_preferredMaxWidth(),Vb._maxSizeToFitIn(a,m.horizontalCenter,m.left,m.right,m.x))):null!=m.left&&null!=m.right&&(g=a-m.right-m.left);null!=m.percentHeight?(r=b,null!=m.top&&(r-=m.top),null!=m.bottom&&(r-=m.bottom),h=Math.round(r*Math.min(0.01*m.percentHeight,1)),r=Math.min(m.get_preferredMaxHeight(),Vb._maxSizeToFitIn(b,m.verticalCenter,m.top,m.bottom,m.y))):null!=m.top&&null!=m.bottom&&(h=b-m.bottom-m.top);null!=g&&(null==f&&(f=m.get_preferredMaxWidth()),g=Math.max(m.get_preferredMinWidth(),
Math.min(f,g)));null!=h&&(null==r&&(r=m.get_preferredMaxHeight()),h=Math.max(m.get_preferredMinHeight(),Math.min(r,h)));m.setActualSize(g,h);f=m.width;r=m.height;h=g=null;g=null!=m.horizontalCenter?Math.round((a-f)/2+m.horizontalCenter):null!=m.left?m.left:null!=m.right?a-f-m.right:m.x;h=null!=m.verticalCenter?Math.round((b-r)/2+m.verticalCenter):null!=m.top?m.top:null!=m.bottom?b-r-m.bottom:m.y;m.x=g;m.y=h;c=Math.max(c,g+f);d=Math.max(d,h+r)}}this.target.width=Math.ceil(a);this.target.height=Math.ceil(b)},
__class__:Vb});var Na=function(){this.layoutType="Horizontal"};h["tools.spark.framework.layout.layouts.HorizontalLayout"]=Na;Na.__name__=!0;Na._pinBetween=function(a,b,c){return Math.min(c,Math.max(b,a))};Na._calculatePercentHeight=function(a,b){return Na._pinBetween(Math.min(Math.round(0.01*a.percentHeight*b),b),a.get_preferredMinHeight(),a.get_preferredMaxHeight())};Na._sizeLayoutElement=function(a,b,c,d,e,i,m){var f=null;c==L.JUSTIFY||c==L.CONTENT_JUSTIFY?f=d:null!=a.percentHeight&&(f=Na._calculatePercentHeight(a,
b));i?a.setActualSize(e,f):a.setActualSize(m,f)};Na.__super__=kc;Na.prototype=v(kc.prototype,{_getColumsToMeasure:function(a){-1!=this.target.requestedColumnCount?a=this.target.requestedColumnCount:(-1!=this.target.requestedMaxColumnCount&&(a=q["int"](Math.min(this.target.requestedMaxColumnCount,a))),-1!=this.target.requestedMinColumnCount&&(a=q["int"](Math.max(this.target.requestedMinColumnCount,a))));return a},_getElementWidth:function(a,b,c){b=null==b?Math.ceil(a.get_preferredWidth()):b;a=null!=
a.percentWidth?Math.ceil(a.get_preferredMinWidth()):b;c.preferredSize=b;c.minSize=a},_getElementHeight:function(a,b,c){var d=Math.ceil(a.get_preferredHeight()),a=null!=a.percentHeight||b?Math.ceil(a.get_preferredMinHeight()):d;c.preferredSize=d;c.minSize=a},_distributeWidth:function(a,b,c){var d=a,e=0,i=[],m,f;f=this.target.variableColumnWidth?0:Math.ceil(this.target.columnWidth);for(var r=this.target.children.length,g=0,h=this.target.children;g<h.length;){var j=h[g];++g;null==j||!1==j.includeInLayout?
r--:null!=j.percentWidth&&this.target.variableColumnWidth?(e+=j.percentWidth,m=new Og,m.layoutElement=j,m.percent=j.percentWidth,m.min=j.get_preferredMinWidth(),m.max=j.get_preferredMaxWidth(),i.push(m)):(Na._sizeLayoutElement(j,b,this.target.verticalAlign,c,null,this.target.variableColumnWidth,f),d-=Math.ceil(j.width))}1<r&&(d-=(r-1)*this.target.gap);if(0!=e){mj.flexChildrenProportionally(a,d,e,i);for(e=a=0;e<i.length;)m=i[e],++e,r=Math.round(m.size+a),a+=m.size-r,Na._sizeLayoutElement(m.layoutElement,
b,this.target.verticalAlign,c,r,this.target.variableColumnWidth,f),d-=r}return d},measure:function(){var a=new Pg,b=this.target.verticalAlign==L.JUSTIFY,c=this.target.children.length,d=0,e=0,i=0,m=0,f=0,r=null;this.target.variableColumnWidth||(r=null==this.target.columnWidth?this.get_typicalLayoutElement().get_preferredWidth():this.target.columnWidth);for(var g=this._getColumsToMeasure(c),h=0,j=this.target.children;h<j.length;){var k=j[h];++h;null==k||!1==k.includeInLayout?c--:(this._getElementHeight(k,
b,a),e=Math.max(e,a.preferredSize),m=Math.max(m,a.minSize),d<g&&(this._getElementWidth(k,r,a),i+=a.preferredSize,f+=a.minSize,d++))}g=this._getColumsToMeasure(c);d<g&&(c=this.get_typicalLayoutElement(),null!=c&&(this._getElementHeight(c,b,a),e=Math.max(e,a.preferredSize),m=Math.max(m,a.minSize),this._getElementWidth(c,r,a),i+=a.preferredSize*(g-d),f+=a.minSize*(g-d),d=g));1<d&&(a=this.target.gap*(d-1),i+=a,f+=a);a=this.target.paddingLeft+this.target.paddingRight;b=this.target.paddingTop+this.target.paddingBottom;
this.target.measuredHeight=Math.ceil(e+b);this.target.measuredWidth=Math.ceil(i+a);this.target.measuredMinHeight=Math.ceil(m+b);this.target.measuredMinWidth=Math.ceil(f+a);this.target.measuredMaxWidth=999999;this.target.measuredMaxHeight=999999},updateDisplayList:function(a,b){if(0==this.target.children.length||0==a||0==b)0==this.target.children.length&&(this.target.width=Math.ceil(this.target.paddingLeft+this.target.paddingRight),this.target.height=Math.ceil(this.target.paddingTop+this.target.paddingBottom));
else{var c=Math.max(0,this.target.width-this.target.paddingLeft-this.target.paddingRight),d=Math.max(0,this.target.height-this.target.paddingTop-this.target.paddingBottom),e=d;if(this.target.verticalAlign==L.CONTENT_JUSTIFY)for(var i=0,m=this.target.children;i<m.length;){var f=m[i];++i;null==f||!1==f.includeInLayout||(f=null!=f.percentHeight?Na._calculatePercentHeight(f,d):f.get_preferredHeight(),e=Math.max(e,Math.ceil(f)))}var g=this._distributeWidth(c,d,e),c=0;this.target.verticalAlign==L.MIDDLE?
c=0.5:this.target.verticalAlign==L.BOTTOM&&(c=1);var d=this.target.paddingLeft,i=this.target.paddingTop,m=this.target.paddingLeft,f=this.target.paddingTop,h=this.target.horizontalAlign;h==aa.CENTER?d=this.target.paddingLeft+Math.round(g/2):h==aa.RIGHT&&(d=this.target.paddingLeft+g);g=0;for(h=this.target.children;g<h.length;){var j=h[g];++g;if(!(null==j||!1==j.includeInLayout)){var k=Math.ceil(j.width),l=Math.ceil(j.height),n;n=i+(e-l)*c;0.5==c&&(n=Math.round(n));j.x=d;j.y=n;m=Math.max(m,d+k);f=Math.max(f,
n+l);d+=k+this.target.gap}}this.target.width=Math.ceil(a);this.target.height=Math.ceil(b)}},__class__:Na});var qf=function(){this.layoutType="Tile"};h["tools.spark.framework.layout.layouts.TileLayout"]=qf;qf.__name__=!0;qf.__super__=kc;qf.prototype=v(kc.prototype,{_closerToSquare:function(a,b,c,d){a=Math.abs(a*(this.target.columnWidth+this.target.horizontalGap)-this.target.horizontalGap-b*(this.target.rowHeight+this.target.verticalGap)+this.target.verticalGap);c=Math.abs(c*(this.target.columnWidth+
this.target.horizontalGap)-this.target.horizontalGap-d*(this.target.rowHeight+this.target.verticalGap)+this.target.verticalGap);return a<c||a==c&&b<=d},_calculateColumnAndRowCount:function(a,b,c){this.target.columnCount=this.target.rowCount=-1;0>=a&&(a=null);0>=b&&(b=null);if(-1!=this.target.requestedColumnCount||-1!=this.target.requestedRowCount)-1!=this.target.requestedRowCount&&(this.target.rowCount=q["int"](Math.max(1,this.target.requestedRowCount))),-1!=this.target.requestedColumnCount&&(this.target.columnCount=
q["int"](Math.max(1,this.target.requestedColumnCount)));else if(null!=a&&(this.target.orientation==ob.ROWS||null==b))this.target.columnCount=0<this.target.columnWidth+this.target.explicitHorizontalGap?q["int"](Math.max(1,Math.floor((a+this.target.explicitHorizontalGap)/(this.target.columnWidth+this.target.explicitHorizontalGap)))):1;else if(null!=b&&(this.target.orientation==ob.COLUMNS||null==a))this.target.rowCount=0<this.target.rowHeight+this.target.explicitVerticalGap?q["int"](Math.max(1,Math.floor((b+
this.target.explicitVerticalGap)/(this.target.rowHeight+this.target.explicitVerticalGap)))):1;else{var b=this.target.explicitHorizontalGap,d=this.target.explicitVerticalGap,a=Math.max(0,this.target.rowHeight+d),d=b-d,b=d*d-4*a*-c*(this.target.columnWidth+b),b=Math.sqrt(b),e;e=0!=a?(d+b)/(2*a):c;var a=q["int"](Math.max(1,Math.floor(e))),b=q["int"](Math.max(1,Math.ceil(c/a))),a=q["int"](Math.max(1,Math.ceil(c/b))),d=q["int"](Math.max(1,Math.ceil(e))),i=q["int"](Math.max(1,Math.ceil(c/d))),d=q["int"](Math.max(1,
Math.ceil(c/i))),m=q["int"](Math.max(1,Math.floor(c/e))),f=q["int"](Math.max(1,Math.ceil(c/m))),m=q["int"](Math.max(1,Math.ceil(c/f)));e=q["int"](Math.max(1,Math.ceil(c/e)));var g=q["int"](Math.max(1,Math.ceil(c/e)));e=q["int"](Math.max(1,Math.ceil(c/g)));this._closerToSquare(m,f,b,a)&&(b=m,a=f);this._closerToSquare(e,g,i,d)&&(i=e,d=g);this._closerToSquare(b,a,i,d)?(this.target.columnCount=b,this.target.rowCount=a):(this.target.columnCount=i,this.target.rowCount=d)}-1==this.target.rowCount&&(this.target.rowCount=
q["int"](Math.max(1,Math.ceil(c/this.target.columnCount))));-1==this.target.columnCount&&(this.target.columnCount=q["int"](Math.max(1,Math.ceil(c/this.target.rowCount))))},_justifyByGapSize:function(a,b,c,d){if(0>=b+c)return c;var e=q["int"](Math.min(d,Math.floor((a+c)/(b+c))));return 1>e?c:1==e?1<d?Math.max(c,a-b):c:(a-e*b)/(e-1)},_justifyByElementSize:function(a,b,c,d){var e=b+c,i=0,i=0==e?d:q["int"](Math.min(d,Math.floor((a+c)/e)));return 1>i?b:(a-(i-1)*c)/i},_calculateElementCount:function(){if(-1!=
this.target.numElementsCached)return this.target.numElementsCached;this.target.numElementsCached=this.target.children.length;for(var a=0,b=this.target.children;a<b.length;){var c=b[a];++a;(null==c||!1==c.includeInLayout)&&this.target.numElementsCached--}return this.target.numElementsCached},_calculateTileSize:function(){this.target.columnWidth=this.target.tileWidthCached;this.target.rowHeight=this.target.tileHeightCached;if(!(null!=this.target.columnWidth&&null!=this.target.rowHeight)&&(this.target.columnWidth=
this.target.tileWidthCached=this.target.explicitColumnWidth,this.target.rowHeight=this.target.tileHeightCached=this.target.explicitRowHeight,!(null!=this.target.columnWidth&&null!=this.target.rowHeight))){var a=0,b=0;this.target.numElementsCached=this.target.children.length;for(var c=0,d=this.target.children;c<d.length;){var e=d[c];++c;null==e||!1==e.includeInLayout?this.target.numElementsCached--:(null==this.target.columnWidth&&(a=Math.max(a,e.get_preferredWidth())),null==this.target.rowHeight&&
(b=Math.max(b,e.get_preferredHeight())))}null==this.target.columnWidth&&(this.target.columnWidth=this.target.tileWidthCached=a);null==this.target.rowHeight&&(this.target.rowHeight=this.target.tileHeightCached=b)}},_updateActualValues:function(a,b){var c=a-this.target.paddingLeft-this.target.paddingRight,d=b-this.target.paddingTop-this.target.paddingBottom;this._calculateTileSize();var e=this._calculateElementCount();this._calculateColumnAndRowCount(c,d,e);this.target.horizontalGap=this.target.explicitHorizontalGap;
this.target.verticalGap=this.target.explicitVerticalGap;if(null!=this.target.width)switch(this.target.columnAlign[1]){case 0:this.target.horizontalGap=this._justifyByGapSize(c,this.target.columnWidth,this.target.horizontalGap,this.target.columnCount);break;case 1:this.target.columnWidth=this._justifyByElementSize(c,this.target.columnWidth,this.target.horizontalGap,this.target.columnCount)}if(null!=this.target.height)switch(this.target.rowAlign[1]){case 0:this.target.verticalGap=this._justifyByGapSize(d,
this.target.rowHeight,this.target.verticalGap,this.target.rowCount);break;case 1:this.target.rowHeight=this._justifyByElementSize(d,this.target.rowHeight,this.target.verticalGap,this.target.rowCount)}-1!=this.target.requestedColumnCount&&-1!=this.target.requestedRowCount&&(this.target.orientation==ob.ROWS?this.target.rowCount=q["int"](Math.max(1,Math.ceil(e/Math.max(1,this.target.requestedColumnCount)))):this.target.columnCount=q["int"](Math.max(1,Math.ceil(e/Math.max(1,this.target.requestedRowCount)))))},
_calculateDisplayParameters:function(a,b){this._updateActualValues(a,b);var c=this.target.children.length;this.target.visibleStartX=this.target.paddingLeft;this.target.visibleStartY=this.target.paddingTop;this.target.visibleStartIndex=0;this.target.visibleEndIndex=c-1},_sizeAndPositionElement:function(a,b,c,d,e){var i=null,m=null,i=this.target.horizontalAlign==aa.JUSTIFY?d:null!=a.percentWidth?Math.round(0.01*d*a.percentWidth):a.get_preferredWidth(),m=this.target.verticalAlign==L.JUSTIFY?e:null!=
a.percentHeight?Math.round(0.01*e*a.percentHeight):a.get_preferredHeight(),f=Math.min(a.get_preferredMaxWidth(),d),g=Math.min(a.get_preferredMaxHeight(),e),i=Math.max(a.get_preferredMinWidth(),Math.min(f,i)),m=Math.max(a.get_preferredMinHeight(),Math.min(g,m));a.setActualSize(i,m);i=b;switch(this.target.horizontalAlign[1]){case 2:i+=d-a.width;break;case 1:i=b+Math.floor((d-a.width)/2)}b=c;switch(this.target.verticalAlign[1]){case 2:b+=e-a.height;break;case 1:b+=Math.floor((e-a.height)/2)}a.x=i;a.y=
b},measure:function(){var a=this.target.columnCount,b=this.target.rowCount,c=this.target.horizontalGap,d=this.target.verticalGap,e=this.target.columnWidth,i=this.target.rowHeight;this._updateActualValues(this.target.explicitWidth,this.target.explicitHeight);var m;m=-1!=this.target.requestedColumnCount?q["int"](Math.max(1,this.target.requestedColumnCount)):this.target.columnCount;var f;f=-1!=this.target.requestedRowCount?q["int"](Math.max(1,this.target.requestedRowCount)):this.target.rowCount;var g=
0,h=0,j=0,k=0;0<m&&(g=Math.ceil(m*(this.target.columnWidth+this.target.horizontalGap)-this.target.horizontalGap),h=Math.ceil(this.target.columnCount*(this.target.columnWidth+this.target.horizontalGap)-this.target.horizontalGap));0<f&&(j=Math.ceil(f*(this.target.rowHeight+this.target.verticalGap)-this.target.verticalGap),k=Math.ceil(this.target.rowCount*(this.target.rowHeight+this.target.verticalGap)-this.target.verticalGap));this.target.numElementsCached=-1;m=this.target.paddingLeft+this.target.paddingRight;
f=this.target.paddingTop+this.target.paddingBottom;this.target.measuredWidth=g+m;this.target.measuredMinWidth=h+m;this.target.measuredHeight=j+f;this.target.measuredMinHeight=k+f;this.target.measuredMaxWidth=999999;this.target.measuredMaxHeight=999999;this.target.columnCount=a;this.target.rowCount=b;this.target.horizontalGap=c;this.target.verticalGap=d;this.target.columnWidth=e;this.target.rowHeight=i},updateDisplayList:function(a,b){this._calculateDisplayParameters(a|0,b|0);var c=this.target.visibleStartX,
d=this.target.visibleStartY,e,i,m,f,g=0,h;this.target.orientation==ob.ROWS?(h=this.target.columnCount,e=this.target.columnWidth+this.target.horizontalGap,i=m=0,f=this.target.rowHeight+this.target.verticalGap):(h=this.target.rowCount,e=0,m=this.target.columnWidth+this.target.horizontalGap,i=this.target.rowHeight+this.target.verticalGap,f=0);for(var j=0,k=this.target.children;j<k.length;){var l=k[j];++j;if(!(null==l||!1==l.includeInLayout)){var n=Math.round(c),p=Math.round(d),o=Math.round(c+this.target.columnWidth)-
n,t=Math.round(d+this.target.rowHeight)-p;this._sizeAndPositionElement(l,n,p,o,t);c+=e;d+=i;++g>=h&&(g=0,this.target.orientation==ob.ROWS?(c=this.target.paddingLeft,d+=f):(c+=m,d=this.target.paddingTop))}}this.target.width=Math.ceil(a);this.target.height=Math.ceil(b);this.target.tileWidthCached=this.target.tileHeightCached=null;this.target.numElementsCached=-1},__class__:qf});var xb=function(){this.layoutType="Vertical"};h["tools.spark.framework.layout.layouts.VerticalLayout"]=xb;xb.__name__=!0;xb._pinBetween=
function(a,b,c){return Math.min(c,Math.max(b,a))};xb._calculatePercentWidth=function(a,b){return xb._pinBetween(Math.min(Math.round(0.01*a.percentWidth*b),b),a.get_preferredMinWidth(),a.get_preferredMaxWidth())};xb._sizeLayoutElement=function(a,b,c,d,e,i,m){var f=null;c==aa.JUSTIFY||c==aa.CONTENT_JUSTIFY?f=d:null!=a.percentWidth&&(f=xb._calculatePercentWidth(a,b));i?a.setActualSize(f,e):a.setActualSize(f,m)};xb.__super__=kc;xb.prototype=v(kc.prototype,{_getRowsToMeasure:function(a){-1!=this.target.requestedRowCount?
a=this.target.requestedRowCount:(-1!=this.target.requestedMaxRowCount&&(a=q["int"](Math.min(this.target.requestedMaxRowCount,a))),-1!=this.target.requestedMinRowCount&&(a=q["int"](Math.max(this.target.requestedMinRowCount,a))));return a},_getElementWidth:function(a,b,c){var d=Math.ceil(a.get_preferredWidth()),a=null!=a.percentWidth||b?Math.ceil(a.get_preferredMinWidth()):d;c.preferredSize=d;c.minSize=a},_getElementHeight:function(a,b,c){b=null==b?Math.ceil(a.get_preferredHeight()):b;a=null!=a.percentHeight?
Math.ceil(a.get_preferredMinHeight()):b;c.preferredSize=b;c.minSize=a},_distributeHeight:function(a,b,c){var d=b,e=0,i=[],f,g;g=this.target.variableRowHeight?0:Math.ceil(this.target.rowHeight);for(var r=this.target.children.length,h=0,j=this.target.children;h<j.length;){var k=j[h];++h;null==k||!1==k.includeInLayout?r--:null!=k.percentHeight&&this.target.variableRowHeight?(e+=k.percentHeight,f=new Og,f.layoutElement=k,f.percent=k.percentHeight,f.min=k.get_preferredMinHeight(),f.max=k.get_preferredMaxHeight(),
i.push(f)):(xb._sizeLayoutElement(k,a,this.target.horizontalAlign,c,null,this.target.variableRowHeight,g),d-=Math.ceil(k.height))}1<r&&(d-=(r-1)*this.target.gap);if(0!=e){mj.flexChildrenProportionally(b,d,e,i);for(e=b=0;e<i.length;)f=i[e],++e,r=Math.round(f.size+b),b+=f.size-r,xb._sizeLayoutElement(f.layoutElement,a,this.target.horizontalAlign,c,r,this.target.variableRowHeight,g),d-=r}return d},measure:function(){var a=new Pg,b=this.target.horizontalAlign==aa.JUSTIFY,c=this.target.children.length,
d=0,e=0,i=0,f=0,g=0,r=null;this.target.variableRowHeight||(r=null==this.target.rowHeight?this.get_typicalLayoutElement().get_preferredHeight():this.target.rowHeight);for(var h=this._getRowsToMeasure(c),j=0,k=this.target.children;j<k.length;){var l=k[j];++j;null==l||!1==l.includeInLayout?c--:(d<h&&(this._getElementHeight(l,r,a),e+=a.preferredSize,f+=a.minSize,d++),this._getElementWidth(l,b,a),i=Math.max(i,a.preferredSize),g=Math.max(g,a.minSize))}h=this._getRowsToMeasure(c);d<h&&(c=this.get_typicalLayoutElement(),
null!=c&&(this._getElementHeight(c,r,a),e+=a.preferredSize*(h-d),f+=a.minSize*(h-d),this._getElementWidth(c,b,a),i=Math.max(i,a.preferredSize),g=Math.max(g,a.minSize),d=h));1<d&&(a=this.target.gap*(d-1),e+=a,f+=a);a=this.target.paddingLeft+this.target.paddingRight;b=this.target.paddingTop+this.target.paddingBottom;this.target.measuredHeight=Math.ceil(e+b);this.target.measuredWidth=Math.ceil(i+a);this.target.measuredMinHeight=Math.ceil(f+b);this.target.measuredMinWidth=Math.ceil(g+a);this.target.measuredMaxWidth=
999999;this.target.measuredMaxHeight=999999},updateDisplayList:function(a,b){if(0==this.target.children.length||0==a||0==b)0==this.target.children.length&&(this.target.width=Math.ceil(this.target.paddingLeft+this.target.paddingRight),this.target.height=Math.ceil(this.target.paddingTop+this.target.paddingBottom));else{var c=Math.max(0,this.target.width-this.target.paddingLeft-this.target.paddingRight),d=Math.max(0,this.target.height-this.target.paddingTop-this.target.paddingBottom),e=c;if(this.target.horizontalAlign==
aa.CONTENT_JUSTIFY)for(var i=0,f=this.target.children;i<f.length;){var g=f[i];++i;null==g||!1==g.includeInLayout||(g=null!=g.percentWidth?xb._calculatePercentWidth(g,c):g.get_preferredWidth(),e=Math.max(e,Math.ceil(g)))}var r=this._distributeHeight(c,d,e),c=0;this.target.horizontalAlign==aa.CENTER?c=0.5:this.target.horizontalAlign==aa.RIGHT&&(c=1);var d=this.target.paddingLeft,i=this.target.paddingTop,f=this.target.paddingLeft,g=this.target.paddingTop,h=this.target.verticalAlign;h==L.MIDDLE?i=this.target.paddingTop+
Math.round(r/2):h==L.BOTTOM&&(i=this.target.paddingTop+r);r=0;for(h=this.target.children;r<h.length;){var j=h[r];++r;if(!(null==j||!1==j.includeInLayout)){var k=Math.ceil(j.width),l=Math.ceil(j.height),n=d+(e-k)*c;0.5==c&&(n=Math.round(n));j.x=n;j.y=i;f=Math.max(f,n+k);g=Math.max(g,i+l);i+=l+this.target.gap}}this.target.width=Math.ceil(a);this.target.height=Math.ceil(b)}},__class__:xb});var nj=function(a){this.rootLayoutElement=a;this.validated=!1};h["tools.spark.framework.layout.managers.LayoutManager"]=
nj;nj.__name__=!0;nj.prototype={validate:function(){this.validated||(w.logger.error("VALIDATING LAYOUT...",null),this.measure(this.rootLayoutElement),this.updateDisplayList(this.rootLayoutElement),this.updateRealObjects(this.rootLayoutElement),this.validated=!0)},getViewGroupByGameEntity:function(a,b){null==b&&(b=this.rootLayoutElement);if(b.layoutableEntity==a)return b;for(var c=0,d=b.children;c<d.length;){var e=d[c];++c;if("Entity"!=e.layoutableInstanceType&&(e=this.getViewGroupByGameEntity(a,e),
null!=e))return e}return null},updateRealObjects:function(a,b,c,d){null==c&&(c=0);null==b&&(b=0);if("View"==a.layoutableInstanceType)if("3D"==a.layoutableEntity.getState("renderer")){var e=a.layoutableInstance;e.x=a.x+b;e.y=a.y+c;e.width=a.width;e.height=a.height}else d=a.layoutableInstance,d.setPosSize(a.x+b,a.y+c,a.width,a.height);else"Entity"==a.layoutableInstanceType&&a.layoutableInstance.setPosSize(a.x,a.y,a.width,a.height,d);for(var e=0,i=a.children;e<i.length;){var f=i[e];++e;this.updateRealObjects(f,
a.x+b,a.y+c,d)}},measure:function(a){for(var b=0,c=a.children;b<c.length;){var d=c[b];++b;this.measure(d)}a.measure()},updateDisplayList:function(a){a.updateDisplayList(a.get_preferredWidth(),a.get_preferredHeight());for(var b=0,a=a.children;b<a.length;){var c=a[b];++b;this.updateDisplayList(c)}},__class__:nj};var Cg=function(){};h["tools.spark.framework.platform.html.Graphics"]=Cg;Cg.__name__=!0;Cg.init=function(){Oc.init()};Cg.createDisplayRenderers=function(){Oc.createDisplayRenderers();var a=
new rf;B.display.platformRendererSet.set("NativeControls",a);a};var Oc=function(){};h["tools.spark.framework.platform.html.flambe2_5.Subgraphics"]=Oc;Oc.__name__=!0;Oc.createDisplayRenderers=function(){var a=new sf;B.display.platformRendererSet.set("2D",a);a};Oc.init=function(){Oc._flambeDisplaySystem=rc.instance.getRenderer()};Oc.onRender=function(){Oc._flambeDisplaySystem.willRender();if(null!=B.display&&null!=B.display.projectActiveSpaceReference&&null!=B.display.projectActiveSpaceReference.activeStageReference)for(var a=
0,b=B.display.projectActiveSpaceReference.activeStageReference.activeViewReferences;a<b.length;){var c=b[a];++a;c.renderer.renderView(c.viewEntity)}Oc._flambeDisplaySystem.didRender()};var ie=function(){};h["tools.spark.sliced.interfaces.IService"]=ie;ie.__name__=!0;var Ea=function(){};h["tools.spark.sliced.core.AService"]=Ea;Ea.__name__=!0;Ea.__interfaces__=[ie];Ea.prototype={__class__:Ea};var Ik=function(){};h["tools.spark.sliced.interfaces.IServiceFactory"]=Ik;Ik.__name__=!0;var Qg=function(){this._init()};
h["tools.spark.sliced.core.ServiceFactory"]=Qg;Qg.__name__=!0;Qg.__interfaces__=[Ik];Qg.prototype={_init:function(){this._createServices()},_createServices:function(){var a=this._reflectService(l.SOUND_SERVICE),b=this._reflectService(l.LOGIC_SERVICE),c=this._reflectService(l.INPUT_SERVICE),d=this._reflectService(l.COMMUNICATIONS_SERVICE),e=this._reflectService(l.EVENT_SERVICE),i=this._reflectService(l.DISPLAY_SERVICE);B.assignServices(a,b,c,d,e,i);B.logic.createInterpreters()},_reflectService:function(a){a=
W.sliced.get(a);return Ua.createInstance(Ua.resolveClass(a),[])},__class__:Qg};var B=function(){};h["tools.spark.sliced.core.Sliced"]=B;B.__name__=!0;B.init=function(){new Qg};B.assignServices=function(a,b,c,d,e,i){w.logger.info("Init Core (S.L.I.C.E.D.)...",null);B.sound=a;B.logic=b;B.input=c;B.comms=d;B.event=e;B.display=i};var Rg=function(){};h["tools.spark.sliced.interfaces.IComms"]=Rg;Rg.__name__=!0;Rg.__interfaces__=[ie];Rg.prototype={__class__:Rg};var Sg=function(){};h["tools.spark.sliced.interfaces.IDisplay"]=
Sg;Sg.__name__=!0;Sg.__interfaces__=[ie];Sg.prototype={__class__:Sg};var Tg=function(){};h["tools.spark.sliced.interfaces.IEvent"]=Tg;Tg.__name__=!0;Tg.__interfaces__=[ie];Tg.prototype={__class__:Tg};var Ug=function(){};h["tools.spark.sliced.interfaces.IInput"]=Ug;Ug.__name__=!0;Ug.__interfaces__=[ie];Ug.prototype={__class__:Ug};var Vg=function(){};h["tools.spark.sliced.interfaces.ILogic"]=Vg;Vg.__name__=!0;Vg.__interfaces__=[ie];Vg.prototype={__class__:Vg};var pk=function(){};h["tools.spark.sliced.interfaces.ISound"]=
pk;pk.__name__=!0;pk.__interfaces__=[ie];var Wg=function(){this._init()};h["tools.spark.sliced.services.std.comms.core.Comms"]=Wg;Wg.__name__=!0;Wg.__interfaces__=[Rg];Wg.__super__=Ea;Wg.prototype=v(Ea.prototype,{_init:function(){w.logger.info("Init Comms std Service...",null);this._socket=new Xg;this._requestsData=new D;this._serverEventsData=new D;this.isConnected=!1;this._file_requestsData=new D;this.file_isConnected=!1},update:function(){this._requestsData=new D;this._serverEventsData=new D;this._file_requestsData=
new D},getRequestData:function(a){return this._requestsData.get(a)},getServerEventData:function(a){return this._serverEventsData.get(a)},connectTo:function(a,b,c){var d=this;null==c&&(c=a+":"+b);this._socket.init(a,b,null,function(){d.isConnected=!0;d.connectedServerName=c;B.event.raiseEvent(n.NETWORK_CONNECTED)})},request:function(a,b,c){var d=this;null==c&&(c=a);this._socket.request(a,b,function(a){d._requestsData.set(c,a);a;B.event.raiseEvent(n.NETWORK_REQUEST)})},disconnect:function(){this._socket.disconnect();
this.isConnected=!1;this.connectedServerName=null},addServerEvent:function(a,b){var c=this;null==b&&(b=a);this._socket.on(a,function(a){c._serverEventsData.set(b,a);a;B.event.raiseEvent(n.NETWORK_SERVER_EVENT)})},file_connectTo:function(a,b,c){var d=this;this.file_isConnected?w.logger.warn("Attempting to connect to file server: File Transfer already connected. Disconnect first.",null):(null==c&&(c=a+":"+b),this._fileTransfer=new Yg("ws://"+a+":"+b),this._fileTransfer.onConnected(function(){d.file_isConnected=
!0;d.file_connectedServerName=c;B.event.raiseEvent(n.FILETRANSFER_CONNECTED)}))},file_getSendFileRequestData:function(a){return this._file_requestsData.get(a)},file_disconnect:function(){this._fileTransfer.disconnect();this.file_isConnected=!1;this.file_connectedServerName=this._fileTransfer=null},file_sendFileRequest:function(a,b,c){var d=this;if(this.file_isConnected){null==c&&(c=b.name);var e=0;this._fileTransfer.sendFile(a,b,function(a){e+=a.length;a.progress=e/b.size;a.progressPercent=Math.round(100*
(e/b.size));d._file_requestsData.set(c,a);a;B.event.raiseEvent(n.FILETRANSFER_SENDREQUEST)})}else w.logger.warn("Attempting to send a file: File Transfer is not connected.",null)},__class__:Wg});var oj=function(){};h["tools.spark.sliced.services.std.comms.filetransfer.interfaces.IFileTransfer"]=oj;oj.__name__=!0;oj.prototype={__class__:oj};var Yg=function(a){this._binaryJs=new BinaryClient(a)};h["tools.spark.sliced.services.std.comms.filetransfer.core.platform.html5.websocket.binaryjs.FileTransfer"]=
Yg;Yg.__name__=!0;Yg.__interfaces__=[oj];Yg.prototype={onConnected:function(a){this._binaryJs.on("open",a)},disconnect:function(){this._binaryJs.close();this._binaryJs=null},sendFile:function(a,b,c){this._binaryJs.send(a,b).on("data",c)},__class__:Yg};var pj=function(){};h["tools.spark.sliced.services.std.comms.sockets.interfaces.ISocket"]=pj;pj.__name__=!0;pj.prototype={__class__:pj};var Xg=function(){};h["tools.spark.sliced.services.std.comms.sockets.core.pomelo.platform.html5.websocket.Socket"]=
Xg;Xg.__name__=!0;Xg.__interfaces__=[pj];Xg.prototype={init:function(a,b,c,d){null==c&&(c=!1);window.pomelo.init({host:a,port:b,log:c},d)},request:function(a,b,c){window.pomelo.request(a,b,c)},on:function(a,b){window.pomelo.on(a,b)},disconnect:function(){window.pomelo.disconnect()},__class__:Xg};var qj=function(){};h["tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveSpaceReference"]=qj;qj.__name__=!0;qj.prototype={__class__:qj};var Ee=function(a){this.spaceEntity=
a};h["tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveSpaceReference"]=Ee;Ee.__name__=!0;Ee.__interfaces__=[qj];Ee.prototype={__class__:Ee};var tf=function(){};h["tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveStageAreaReference"]=tf;tf.__name__=!0;tf.prototype={__class__:tf};var uf=function(a){this.stageAreaEntity=a;this.layoutElement=new ye(this.stageAreaEntity,"StageArea",this)};h["tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveStageAreaReference"]=
uf;uf.__name__=!0;uf.__interfaces__=[tf];uf.prototype={__class__:uf};var vf=function(){};h["tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveStageReference"]=vf;vf.__name__=!0;vf.prototype={__class__:vf};var Fe=function(a){this.stageEntity=a;this.activeViewReferences=[];this.activeStageAreaReferences=[];this.layoutRoot=new ye(this.stageEntity,"Stage",this);this.layoutManager=new nj(this.layoutRoot);Y._platform.getStage().resize.connect(y(this,this._onResize))};
h["tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveStageReference"]=Fe;Fe.__name__=!0;Fe.__interfaces__=[vf];Fe.prototype={_onResize:function(){this.layoutRoot.explicitWidth=window.innerWidth;this.layoutRoot.explicitHeight=window.innerHeight;this.layoutManager.validated=!1},addView:function(a){this.activeViewReferences.push(a);this.activeViewReferences.sort(y(this,this._orderViews));this._addLayoutElement(a.layoutElement)},addStageArea:function(a){this.activeStageAreaReferences.push(a);
this._addLayoutElement(a.layoutElement)},_addLayoutElement:function(a){if("Implicit"==a.layoutableEntity.getState("parent"))this.layoutRoot.children.push(a);else for(var b=0,c=this.activeStageAreaReferences;b<c.length;){var d=c[b];++b;if(d.stageAreaEntity.getState("name")==a.layoutableEntity.getState("parent")){d.layoutElement.children.push(a);break}}},_orderViews:function(a,b){return a.viewEntity.getState("zIndex")>b.viewEntity.getState("zIndex")?1:a.viewEntity.getState("zIndex")<b.viewEntity.getState("zIndex")?
-1:0},__class__:Fe};var Zg=function(){};h["tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveViewReference"]=Zg;Zg.__name__=!0;Zg.prototype={__class__:Zg};var je=function(a){this.viewEntity=a;this.layoutElement=new ye(this.viewEntity,"View",this)};h["tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveViewReference"]=je;je.__name__=!0;je.__interfaces__=[Zg];je.prototype={__class__:je};var $g=function(){this._init()};h["tools.spark.sliced.services.std.display.core.Display"]=
$g;$g.__name__=!0;$g.__interfaces__=[Sg];$g.__super__=Ea;$g.prototype=v(Ea.prototype,{_initRenderStateNames:function(){this._renderStateNames.set("2DmeshType",!0);!0;this._renderStateNames.set("3DmeshType",!0);!0;this._renderStateNames.set("touchable",!0);!0;this._renderStateNames.set("2DMeshImageForm",!0);!0;this._renderStateNames.set("2DMeshSpriterForm",!0);!0;this._renderStateNames.set("2DMeshFillRectForm",!0);!0;this._renderStateNames.set("2DMeshSpriteForm",!0);!0;this._renderStateNames.set("2DMeshSpriterAnimForm",
!0);!0;this._renderStateNames.set("visibility",!0);!0;this._renderStateNames.set("visible",!0);!0;this._renderStateNames.set("width",!0);!0;this._renderStateNames.set("height",!0);!0;this._renderStateNames.set("top",!0);!0;this._renderStateNames.set("left",!0);!0;this._renderStateNames.set("opacity",!0);!0;this._renderStateNames.set("display",!0);!0;this._renderStateNames.set("text",!0);!0;this._renderStateNames.set("fontSize",!0);!0;this._renderStateNames.set("fontWeight",!0);!0;this._renderStateNames.set("fontColor",
!0);!0;this._renderStateNames.set("src",!0);!0;this._renderStateNames.set("overflow",!0);!0;this._renderStateNames.set("backgroundColor",!0);!0;this._renderStateNames.set("border",!0);!0;this._renderStateNames.set("borderColor",!0);!0;this._renderStateNames.set("spaceX",!0);!0;this._renderStateNames.set("spaceY",!0);!0;this._renderStateNames.set("spaceZ",!0);!0;this._renderStateNames.set("scaleX",!0);!0;this._renderStateNames.set("scaleY",!0);!0;this._renderStateNames.set("scaleZ",!0);!0;this._renderStateNames.set("velocityX",
!0);!0;this._renderStateNames.set("velocityY",!0);!0;this._renderStateNames.set("applyImpulseX",!0);!0;this._renderStateNames.set("applyImpulseY",!0);!0;this._renderStateNames.set("captureAreaX",!0);!0;this._renderStateNames.set("captureAreaY",!0);!0;this._renderStateNames.set("captureAreaWidth",!0);!0;this._renderStateNames.set("captureAreaHeight",!0);!0;this._renderStateNames.set("spaceWidth",!0);!0;this._renderStateNames.set("spaceHeight",!0);!0;this._renderStateNames.set("stage",!0);!0;this._renderStateNames.set("view",
!0);!0;this._renderStateNames.set("camera",!0);!0;this._renderStateNames.set("scene",!0);!0;this._renderStateNames.set("space",!0);!0;this._renderStateNames.set("active",!0);!0},_init:function(){w.logger.info("Init Display std Service...",null);this._renderStateNames=new D;this._initRenderStateNames();this._renderFormStateNames=new D;this._activeReferenceMediator=new ah(this);this.platformRendererSet=new D;this._dataBuffer=new bh},setActiveSpace:function(a){return"Space"==a.getState("displayType")?
(this._dataBuffer.addEntry(ja.SET_SPACE,a),!0):!1},_setActiveSpace:function(a){null!=this._activeReferenceMediator.getActiveSpaceReference(a)?w.logger.warn("This space object is already bound to the Project. Ignoring...",null):(null!=this.projectActiveSpaceReference&&w.logger.warn("Another space object was already set to this Project! Resetting...",null),this.projectActiveSpaceReference=this._activeReferenceMediator.createSpaceReference(a),this._activeReferenceMediator.spaceReferenceManager.update(this.projectActiveSpaceReference,
a))},invalidateLayout:function(){this.projectActiveSpaceReference.activeStageReference.layoutManager.validated=!1},getSpace2_5Object:function(a,b){null==b&&(b=!1);if(b)return null;for(var c,d=this.platformRendererSet.iterator();d.hasNext()&&!(c=d.next().getRealObject(a),null!=c););return c},update:function(){for(var a=0,b=this._dataBuffer.dataBuffer;a<b.length;){var c=b[a];++a;switch(c.type[1]){case 0:this._setActiveSpace(c.source);break;case 1:switch(c.source.getState("displayType")){case "Space":w.logger.warn("adding something to a space",
null);break;case "Stage":w.logger.warn("adding something to a stage",null);break;case "StageArea":w.logger.warn("adding something to a stageArea",null);break;case "View":w.logger.warn("adding something to a view",null);for(c=this.platformRendererSet.iterator();c.hasNext();)c.next(),w.logger.warn("adding something to a view, renderer logic",null);break;default:for(var d=this.platformRendererSet.iterator();d.hasNext();)d.next().addChild(c.source,c.target)}break;case 2:switch(c.source.getState("displayType")){case "Space":w.logger.warn("removing something from a space",
null);break;case "Stage":w.logger.warn("removing something from a stage",null);break;case "StageArea":w.logger.warn("removing something from a stageArea",null);break;case "View":w.logger.warn("removing something from a view",null);for(c=this.platformRendererSet.iterator();c.hasNext();)c.next(),w.logger.warn("removing something from a view, renderer logic",null);break;default:for(d=this.platformRendererSet.iterator();d.hasNext();)d.next().removeChild(c.source,c.target)}break;case 3:switch(c.source.getState("displayType")){case "Space":this._activeReferenceMediator.spaceReferenceManager.updateState(this._activeReferenceMediator.getActiveSpaceReference(c.source),
c.source,c.field);break;case "Stage":this._activeReferenceMediator.stageReferenceManager.updateState(this._activeReferenceMediator.getActiveStageReference(c.source),c.source,c.field);break;case "StageArea":this._activeReferenceMediator.stageAreaReferenceManager.updateState(this._activeReferenceMediator.getActiveStageAreaReference(c.source),c.source,c.field);break;case "View":this._activeReferenceMediator.viewReferenceManager.updateState(this._activeReferenceMediator.getActiveViewReference(c.source),
c.source,c.field);for(d=this.platformRendererSet.iterator();d.hasNext();)d.next().updateState(c.source,c.field);break;default:for(d=this.platformRendererSet.iterator();d.hasNext();)d.next().updateState(c.source,c.field)}break;default:w.logger.warn("DISPLAY: Unhandled request: "+q.string(c.type),null)}}this._dataBuffer.clearBuffer();null!=this.projectActiveSpaceReference&&this.projectActiveSpaceReference.activeStageReference.layoutManager.validate()},addDisplayObjectChild:function(a,b){null!=a.getState("displayType")&&
null!=b.getState("displayType")&&this._dataBuffer.addEntry(ja.ADDED,a,b)},removeDisplayObjectChild:function(a,b){null!=a.getState("displayType")&&null!=b.getState("displayType")&&this._dataBuffer.addEntry(ja.REMOVED,a,b)},updateDisplayObjectState:function(a,b){null!=a.getState("displayType")&&!0==this._renderStateNames.get(b)&&this._dataBuffer.addEntry(ja.UPDATED_STATE,a,null,b)},updateDisplayObjectFormState:function(a,b){null!=a.getState("displayType")&&!0==this._renderFormStateNames.get(b)&&this._dataBuffer.addEntry(ja.UPDATED_FORM_STATE,
a,null,b)},_addChild:function(a,b){this._dataBuffer.addEntry(ja.ADDED,a,b)},_removeChild:function(a,b){this._dataBuffer.addEntry(ja.REMOVED,a,b)},_updateState:function(a,b){this._dataBuffer.addEntry(ja.UPDATED_STATE,a,null,b)},_updateFormState:function(a,b){this._dataBuffer.addEntry(ja.UPDATED_FORM_STATE,a,null,b)},log:function(a){w.logger.info(a,null)},info:function(a){w.logger.info(a,null)},debug:function(a){w.logger.info(a,null)},warn:function(a){w.logger.warn(a,null)},error:function(a){w.logger.error(a,
null)},__class__:$g});var rj=function(){};h["tools.spark.sliced.services.std.display.databuffer.interfaces.IBufferEntry"]=rj;rj.__name__=!0;rj.prototype={__class__:rj};var ch=function(a,b,c,d){this.type=a;this.source=b;this.target=c;this.field=d};h["tools.spark.sliced.services.std.display.databuffer.core.BufferEntry"]=ch;ch.__name__=!0;ch.__interfaces__=[rj];ch.prototype={__class__:ch};var sj=function(){};h["tools.spark.sliced.services.std.display.databuffer.interfaces.IDataBuffer"]=sj;sj.__name__=
!0;sj.prototype={__class__:sj};var bh=function(){this.dataBuffer=[]};h["tools.spark.sliced.services.std.display.databuffer.core.DataBuffer"]=bh;bh.__name__=!0;bh.__interfaces__=[sj];bh.prototype={addEntry:function(a,b,c,d){this.dataBuffer.push(new ch(a,b,c,d))},clearBuffer:function(){this.dataBuffer=[]},__class__:bh};var ja=h["tools.spark.sliced.services.std.display.databuffer.interfaces.EBufferEntryType"]={__ename__:!0,__constructs__:["SET_SPACE","ADDED","REMOVED","UPDATED_STATE","UPDATED_FORM_STATE"]};
ja.SET_SPACE=["SET_SPACE",0];ja.SET_SPACE.toString=j;ja.SET_SPACE.__enum__=ja;ja.ADDED=["ADDED",1];ja.ADDED.toString=j;ja.ADDED.__enum__=ja;ja.REMOVED=["REMOVED",2];ja.REMOVED.toString=j;ja.REMOVED.__enum__=ja;ja.UPDATED_STATE=["UPDATED_STATE",3];ja.UPDATED_STATE.toString=j;ja.UPDATED_STATE.__enum__=ja;ja.UPDATED_FORM_STATE=["UPDATED_FORM_STATE",4];ja.UPDATED_FORM_STATE.toString=j;ja.UPDATED_FORM_STATE.__enum__=ja;ja.__empty_constructs__=[ja.SET_SPACE,ja.ADDED,ja.REMOVED,ja.UPDATED_STATE,ja.UPDATED_FORM_STATE];
var tj=function(){};h["tools.spark.sliced.services.std.display.managers.interfaces.IActiveReferenceMediator"]=tj;tj.__name__=!0;tj.prototype={__class__:tj};var ah=function(a){this.display=a;this.spaceReferenceManager=new dh(this);this.stageReferenceManager=new eh(this);this.viewReferenceManager=new fh(this);this.stageAreaReferenceManager=new gh(this)};h["tools.spark.sliced.services.std.display.managers.core.ActiveReferenceMediator"]=ah;ah.__name__=!0;ah.__interfaces__=[tj];ah.prototype={createSpaceReference:function(a){return A.__cast(this.spaceReferenceManager.create(a),
Ee)},createStageReference:function(a){return A.__cast(this.stageReferenceManager.create(a),Fe)},createViewReference:function(a){return A.__cast(this.viewReferenceManager.create(a),je)},createStageAreaReference:function(a){return A.__cast(this.stageAreaReferenceManager.create(a),uf)},getActiveSpaceReference:function(a){return null==this.display.projectActiveSpaceReference?null:a==this.display.projectActiveSpaceReference.spaceEntity?this.display.projectActiveSpaceReference:null},getActiveStageReference:function(a){return null==
this.display.projectActiveSpaceReference||null==this.display.projectActiveSpaceReference.activeStageReference?null:a==this.display.projectActiveSpaceReference.activeStageReference.stageEntity?this.display.projectActiveSpaceReference.activeStageReference:null},getActiveViewReference:function(a){if(null==this.display.projectActiveSpaceReference||null==this.display.projectActiveSpaceReference.activeStageReference)return null;for(var b=0,c=this.display.projectActiveSpaceReference.activeStageReference.activeViewReferences;b<
c.length;){var d=c[b];++b;if(d.viewEntity==a)return d}return null},getActiveStageAreaReference:function(a){if(null==this.display.projectActiveSpaceReference||null==this.display.projectActiveSpaceReference.activeStageReference)return null;for(var b=0,c=this.display.projectActiveSpaceReference.activeStageReference.activeStageAreaReferences;b<c.length;){var d=c[b];++b;if(d.stageAreaEntity==a)return d}return null},__class__:ah};var Wb=function(){};h["tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager"]=
Wb;Wb.__name__=!0;Wb.prototype={__class__:Wb};var hh=function(a){this._renderer=a};h["tools.spark.sliced.services.std.display.managers.core.DomCameraManager"]=hh;hh.__name__=!0;hh.__interfaces__=[Wb];hh.prototype={create:function(a){return new kf(a)},update:function(){},updateState:function(){},__class__:hh};var ih=function(a){this._renderer=a};h["tools.spark.sliced.services.std.display.managers.core.DomObjectManager"]=ih;ih.__name__=!0;ih.__interfaces__=[Wb];ih.prototype={create:function(a){var b=
new ub(a);this.update(b,a);return b},update:function(a,b){var c;c=A.__cast(a,ub);for(var d=0,e=b.get_children();d<e.length;){var i=e[d];++d;this.addTo(this._renderer.createObject(i),c)}},updateState:function(a,b,c){a=A.__cast(a,ub);for(b=a._instances.keys();b.hasNext();){var d=b.next();null!=a._updateStateFunctions.get(c)?a._updateStateFunctions.get(c)(a.gameEntity.getState(c),d):w.logger.warn("State "+c+" does not have a function handler! Ignoring :(",null)}},addTo:function(a,b){var c;c=A.__cast(b,
ub);null!=a&&c.addChild(a)},removeFrom:function(a,b){var c;c=A.__cast(b,ub);null!=a&&c.removeChild(a)},__class__:ih};var jh=function(a){this._renderer=a};h["tools.spark.sliced.services.std.display.managers.core.DomSceneManager"]=jh;jh.__name__=!0;jh.__interfaces__=[Wb];jh.prototype={create:function(a){var b=new vb(a);this.update(b,a);return b},update:function(a,b){var c;c=A.__cast(a,vb);for(var d=0,e=b.get_children();d<e.length;){var i=e[d];++d;this.addTo(this._renderer.createObject(i),c)}},updateState:function(){},
addTo:function(a,b){var c;c=A.__cast(b,vb);null!=a&&c.addChild(a)},removeFrom:function(a,b){var c;c=A.__cast(b,vb);null!=a&&c.removeChild(a)},__class__:jh};var kh=function(a){this._renderer=a};h["tools.spark.sliced.services.std.display.managers.core.DomViewManager"]=kh;kh.__name__=!0;kh.__interfaces__=[Wb];kh.prototype={create:function(a){var b=new ze(a);this.update(b,a);return b},update:function(a,b){this.updateState(a,b,"scene");this.updateState(a,b,"camera");this.updateState(a,b,"visible")},updateState:function(a,
b,c){a=A.__cast(a,ze);switch(c){case "scene":b=b.getState(c);a.set_scene(this._renderer.createScene(b));break;case "camera":b=b.getState(c);a.set_camera(this._renderer.createCamera(b));break;default:a.updateState(c)}},__class__:kh};var lh=function(a){this._renderer=a};h["tools.spark.sliced.services.std.display.managers.core.Flambe2_5DCameraManager"]=lh;lh.__name__=!0;lh.__interfaces__=[Wb];lh.prototype={create:function(a){return new Ae(a)},update:function(){},updateState:function(a,b,c){for(a=A.__cast(a,
Ae)._attachedToViews.keys();a.hasNext();)switch(b=a.next(),c){case "captureAreaX":b.updateCamera();break;case "captureAreaY":b.updateCamera();break;case "captureAreaWidth":b.updateCamera();break;case "captureAreaHeight":b.updateCamera();break;default:w.logger.warn("Unhandled Camera State value: "+c,null)}},__class__:lh};var mh=function(a){this._renderer=a};h["tools.spark.sliced.services.std.display.managers.core.Flambe2_5DObjectManager"]=mh;mh.__name__=!0;mh.__interfaces__=[Wb];mh.prototype={create:function(a){var b=
new he(a);this.update(b,a);return b},update:function(a,b){var c;c=A.__cast(a,he);for(var d=0,e=b.get_children();d<e.length;){var i=e[d];++d;this.addTo(this._renderer.createObject(i),c)}},updateState:function(a,b,c){a=A.__cast(a,he);for(b=a._instances.keys();b.hasNext();){var d=b.next();null!=a._updateStateFunctions.get(c)?a._updateStateFunctions.get(c)(a.gameEntity.getState(c),d):w.logger.warn("State "+c+" does not have a function handler! Ignoring :(",null)}},addTo:function(a,b){var c;c=A.__cast(b,
he);null!=a&&c.addChild(a)},__class__:mh};var nh=function(a){this._renderer=a};h["tools.spark.sliced.services.std.display.managers.core.Flambe2_5DSceneManager"]=nh;nh.__name__=!0;nh.__interfaces__=[Wb];nh.prototype={create:function(a){var b=new Ub(a);this.update(b,a);return b},update:function(a,b){var c;c=A.__cast(a,Ub);for(var d=0,e=b.get_children();d<e.length;){var i=e[d];++d;this.addTo(this._renderer.createObject(i),c)}},updateState:function(){},addTo:function(a,b){var c;c=A.__cast(b,Ub);null!=
a&&c.addChild(a)},removeFrom:function(a,b){var c;c=A.__cast(b,Ub);null!=a&&c.removeChild(a)},__class__:nh};var oh=function(a,b){this._renderer=a;this._flambeGraphics=b};h["tools.spark.sliced.services.std.display.managers.core.Flambe2_5DViewManager"]=oh;oh.__name__=!0;oh.__interfaces__=[Wb];oh.prototype={create:function(a){var b=new De(a,this._flambeGraphics);this.update(b,a);return b},update:function(a,b){this.updateState(a,b,"scene");this.updateState(a,b,"camera")},updateState:function(a,b,c){a=
A.__cast(a,De);switch(c){case "scene":b=b.getState(c);a.set_scene(this._renderer.createScene(b));break;case "camera":b=b.getState(c);a.set_camera(this._renderer.createCamera(b));break;case "visible":a.setVisible(b.getState(c))}},__class__:oh};var dh=function(a){this._activeReferenceMediator=a};h["tools.spark.sliced.services.std.display.managers.core.SpaceReferenceManager"]=dh;dh.__name__=!0;dh.__interfaces__=[Wb];dh.prototype={create:function(a){return new Ee(a)},update:function(a,b){null!=a&&this.updateState(a,
b,"stage")},updateState:function(a,b,c){if(null!=a)switch(a=A.__cast(a,Ee),c){case "stage":null!=b.getState(c)&&this._setStage(a,this._activeReferenceMediator.createStageReference(b.getState(c)),b.getState(c))}},_setStage:function(a,b,c){null!=this._activeReferenceMediator.getActiveStageReference(c)?pa.warn("This stage object ["+q.string(c.getState("name"))+"] is already bound to the Active Space. Ignoring..."):(null!=this._activeReferenceMediator.display.projectActiveSpaceReference.activeStageReference&&
w.logger.warn("Another stage object was already set to this Project! Resetting...",null),a.activeStageReference=b,this._activeReferenceMediator.stageReferenceManager.update(b,c))},__class__:dh};var gh=function(a){this._activeReferenceMediator=a};h["tools.spark.sliced.services.std.display.managers.core.StageAreaReferenceManager"]=gh;gh.__name__=!0;gh.__interfaces__=[Wb];gh.prototype={create:function(a){return new uf(a)},update:function(a){null!=a&&A.__cast(a,tf).layoutElement.update()},updateState:function(a,
b,c){null!=a&&A.__cast(a,tf).layoutElement.updateState(c)},__class__:gh};var eh=function(a){this._activeReferenceMediator=a};h["tools.spark.sliced.services.std.display.managers.core.StageReferenceManager"]=eh;eh.__name__=!0;eh.__interfaces__=[Wb];eh.prototype={create:function(a){return new Fe(a)},update:function(a,b){if(null!=a){var c;c=A.__cast(a,vf);this.updateState(c,b,"test");this.updateState(c,b,"width");this.updateState(c,b,"height");c.layoutRoot.update();c.layoutRoot.explicitWidth=Y._platform.getStage().get_width();
c.layoutRoot.explicitHeight=Y._platform.getStage().get_height();for(var d=0,e=b.getChildren();d<e.length;){var i=e[d];++d;this.addTo(i,c)}}},updateState:function(a){null!=a&&A.__cast(a,vf)},addTo:function(a,b){if(null!=b){var c;c=A.__cast(b,Fe);var d;d=A.__cast(a,Ge);"View"==d.getState("displayType")?this._addView(c,this._activeReferenceMediator.createViewReference(d),d):"StageArea"==d.getState("displayType")?this._addStageArea(c,this._activeReferenceMediator.createStageAreaReference(d),d):w.logger.warn("A child of a Stage gameEntity is NOT a View or a StageArea! Ignoring...",
null)}},_addView:function(a,b,c){null!=this._activeReferenceMediator.getActiveViewReference(c)?pa.warn("This view object ["+q.string(c.getState("name"))+"] is already bound to the Active Stage. Ignoring..."):null==c.getState("scene")||null==c.getState("camera")?pa.warn("This view object ["+q.string(c.getState("name"))+"] is not ready yet (missing camera or scene). Ignoring..."):(a.addView(b),this._activeReferenceMediator.viewReferenceManager.update(b,c))},_addStageArea:function(a,b,c){null!=this._activeReferenceMediator.getActiveStageAreaReference(c)?
pa.warn("This stageArea object ["+q.string(c.getState("name"))+"] is already bound to the Active Stage. Ignoring..."):(a.addStageArea(b),this._activeReferenceMediator.stageAreaReferenceManager.update(b,c))},__class__:eh};var fh=function(a){this._activeReferenceMediator=a};h["tools.spark.sliced.services.std.display.managers.core.ViewReferenceManager"]=fh;fh.__name__=!0;fh.__interfaces__=[Wb];fh.prototype={create:function(a){return new je(a)},update:function(a,b){if(null!=a){var c;c=A.__cast(a,Zg);
this.updateState(c,b,"scene");this.updateState(c,b,"camera");c.layoutElement.update();this._updateRenderer(c)}},updateState:function(a,b,c){if(null!=a)switch(c){case "scene":this._updateRenderer(A.__cast(a,je));break;case "camera":this._updateRenderer(A.__cast(a,je))}},_updateRenderer:function(a){if(null==a.renderer){if("Implicit"!=a.viewEntity.getState("renderer")){var b=a.viewEntity.getState("renderer");a.renderer=this._activeReferenceMediator.display.platformRendererSet.get(b)}else pa.error("Implicit Renderer selection has not been implemented yet. View "+
q.string(a.viewEntity.getState("name"))+" cannot be rendered!");null!=a.renderer?a.renderer.createView(a.viewEntity):pa.error("Could not create renderer: "+q.string(a.viewEntity.getState("renderer"))+".")}},__class__:fh};var ph=function(){};h["tools.spark.sliced.services.std.display.renderers.interfaces.IRenderer"]=ph;ph.__name__=!0;ph.prototype={__class__:ph};var He=function(){null};h["tools.spark.sliced.services.std.display.renderers.core.ARenderer"]=He;He.__name__=!0;He.__interfaces__=[ph];He.prototype=
{getRealObject:function(){return null},__class__:He};var uj=function(){};h["tools.spark.sliced.services.std.display.renderers.interfaces.IDimensionSpecificRenderer"]=uj;uj.__name__=!0;uj.__interfaces__=[ph];var lc=function(){He.call(this);null};h["tools.spark.sliced.services.std.display.renderers.core.dimension.A2_5DRenderer"]=lc;lc.__name__=!0;lc.__interfaces__=[uj];lc.__super__=He;lc.prototype=v(He.prototype,{__class__:lc});var Ie=function(){};h["tools.spark.sliced.services.std.display.renderers.interfaces.ILibrarySpecificRenderer"]=
Ie;Ie.__name__=!0;Ie.__interfaces__=[uj];Ie.prototype={__class__:Ie};var ke=function(){lc.call(this);this._internalGraphics=this._platform.getRenderer().graphics;null==this._internalGraphics&&w.logger.error("Flambe renderer does NOT have internal graphics!",null);this._views=new Qa;this._scenes=new Qa;this._cameras=new Qa;this._objects=new Qa;this._viewManager=new oh(this,this._internalGraphics);this._sceneManager=new nh(this);this._cameraManager=new lh(this);this._objectManager=new mh(this)};h["tools.spark.sliced.services.std.display.renderers.core.library.AFlambe2_5DRenderer"]=
ke;ke.__name__=!0;ke.__interfaces__=[Ie];ke.__super__=lc;ke.prototype=v(lc.prototype,{renderView:function(a){this._views.h[a.__id__].render()},createView:function(a){if(null!=this._views.h[a.__id__])pa.warn("View "+q.string(a.getState("name"))+" has already been added to this Flambe2_5DRenderer. Ignoring...");else{var b;b=A.__cast(this._viewManager.create(a),De);this._views.set(a,b);b}return this._views.h[a.__id__]},createScene:function(a){if(null!=this._scenes.h[a.__id__])pa.warn("Scene "+q.string(a.getState("name"))+
" has already been added to this Flambe2_5DRenderer. Ignoring...");else{var b;b=A.__cast(this._sceneManager.create(a),Ub);this._scenes.set(a,b);b}return this._scenes.h[a.__id__]},createCamera:function(a){if(null!=this._cameras.h[a.__id__])pa.warn("Camera "+q.string(a.getState("name"))+" has already been added to this Flambe2_5DRenderer. Ignoring...");else{var b;b=A.__cast(this._cameraManager.create(a),Ae);this._cameras.set(a,b);b}return this._cameras.h[a.__id__]},createObject:function(a){if("Entity"==
a.getState("displayType")){if(null!=this._objects.h[a.__id__])pa.warn("Object "+q.string(a.getState("name"))+" has already been added to this Flambe2_5DRenderer. Ignoring...");else{var b;b=A.__cast(this._objectManager.create(a),Za);this._objects.set(a,b);b}return this._objects.h[a.__id__]}return null},addChild:function(a,b){switch(a.getState("displayType")){case "Scene":null!=this._scenes.h[a.__id__]&&this._sceneManager.addTo(this.createObject(b),this._scenes.h[a.__id__]);break;case "Entity":null!=
this._objects.h[a.__id__]&&this._objectManager.addTo(this.createObject(b),this._objects.h[a.__id__]);break;default:pa.warn("AFlambe2_5DRenderer: Unhandled add child request: "+q.string(a.getState("displayType")))}},removeChild:function(a,b){switch(a.getState("displayType")){case "Scene":null!=this._scenes.h[a.__id__]&&this._sceneManager.removeFrom(this._objects.h[b.__id__],this._scenes.h[a.__id__]);break;case "Entity":null!=this._objects.h[a.__id__]&&w.logger.warn("FLAMBE RENDERER: REMOVING A CHILD FROM AN OBJECT NOT YET IMPLEMENTED",
null);break;default:pa.warn("AFlambe2_5DRenderer: Unhandled remove child request: "+q.string(a.getState("displayType")))}},updateState:function(a,b){null!=this._objects.h[a.__id__]?this._objectManager.updateState(this._objects.h[a.__id__],a,b):null!=this._views.h[a.__id__]?this._viewManager.updateState(this._views.h[a.__id__],a,b):null!=this._cameras.h[a.__id__]&&this._cameraManager.updateState(this._cameras.h[a.__id__],a,b)},getRealObject:function(a){return null!=this._objects.h[a.__id__]?this._objects.h[a.__id__]:
null!=this._views.h[a.__id__]?this._views.h[a.__id__]:null!=this._cameras.h[a.__id__]?this._cameras.h[a.__id__]:null!=this._scenes.h[a.__id__]?this._scenes.h[a.__id__]:null},__class__:ke});var Je=function(){lc.call(this)};h["tools.spark.sliced.services.std.display.renderers.core.library.ANativeControls2_5DRenderer"]=Je;Je.__name__=!0;Je.__interfaces__=[Ie];Je.__super__=lc;Je.prototype=v(lc.prototype,{renderView:function(){},createView:function(){return null},createScene:function(){return null},createCamera:function(){return null},
createObject:function(){return null},addChild:function(){},removeChild:function(){},updateState:function(){},__class__:Je});var vj=function(){};h["tools.spark.sliced.services.std.display.renderers.interfaces.IPlatformSpecificRenderer"]=vj;vj.__name__=!0;vj.__interfaces__=[Ie];var sf=function(){this._platform=rc.instance;ke.call(this);w.logger.info("Creating Flambe 2_5D Html Renderer...",null)};h["tools.spark.sliced.services.std.display.renderers.core.platform.html.Flambe2_5DHtmlRenderer"]=sf;sf.__name__=
!0;sf.__interfaces__=[vj];sf.__super__=ke;sf.prototype=v(ke.prototype,{__class__:sf});var rf=function(){lc.call(this);w.logger.info("Creating Native Controls Html (DOM) Renderer...",null);this._views=new Qa;this._scenes=new Qa;this._cameras=new Qa;this._objects=new Qa;this._viewManager=new kh(this);this._sceneManager=new jh(this);this._cameraManager=new hh(this);this._objectManager=new ih(this)};h["tools.spark.sliced.services.std.display.renderers.core.platform.html.NativeControlsHtmlRenderer"]=rf;
rf.__name__=!0;rf.__interfaces__=[vj];rf.__super__=Je;rf.prototype=v(Je.prototype,{renderView:function(a){this._views.h[a.__id__].render()},createView:function(a){if(null!=this._views.h[a.__id__])pa.warn("View "+q.string(a.getState("name"))+" has already been added to this NativeControlsHtmlRenderer. Ignoring...");else{var b;b=A.__cast(this._viewManager.create(a),ze);this._views.set(a,b);b}return this._views.h[a.__id__]},createScene:function(a){if(null!=this._scenes.h[a.__id__])pa.warn("Scene "+q.string(a.getState("name"))+
" has already been added to this NativeControlsHtmlRenderer. Ignoring...");else{var b;b=A.__cast(this._sceneManager.create(a),vb);this._scenes.set(a,b);b}return this._scenes.h[a.__id__]},createCamera:function(a){if(null!=this._cameras.h[a.__id__])pa.warn("Camera "+q.string(a.getState("name"))+" has already been added to this NativeControlsHtmlRenderer. Ignoring...");else{var b;b=A.__cast(this._cameraManager.create(a),kf);this._cameras.set(a,b);b}return this._cameras.h[a.__id__]},createObject:function(a){if("Entity"==
a.getState("displayType")){if(null!=this._objects.h[a.__id__])pa.warn("Object "+q.string(a.getState("name"))+" has already been added to this NativeControlsHtmlRenderer. Ignoring...");else{var b;b=A.__cast(this._objectManager.create(a),Za);this._objects.set(a,b);b}return this._objects.h[a.__id__]}return null},addChild:function(a,b){switch(a.getState("displayType")){case "Scene":null!=this._scenes.h[a.__id__]&&this._sceneManager.addTo(this.createObject(b),this._scenes.h[a.__id__]);break;case "Entity":null!=
this._objects.h[a.__id__]&&this._objectManager.addTo(this.createObject(b),this._objects.h[a.__id__]);break;default:pa.warn("NativeControlsHtmlRenderer: Unhandled add child request: "+q.string(a.getState("displayType")))}},removeChild:function(a,b){switch(a.getState("displayType")){case "Scene":null!=this._scenes.h[a.__id__]&&this._sceneManager.removeFrom(this._objects.h[b.__id__],this._scenes.h[a.__id__]);break;case "Entity":null!=this._objects.h[a.__id__]&&this._objectManager.removeFrom(this._objects.h[b.__id__],
this._objects.h[a.__id__]);break;default:pa.warn("NativeControlsHtmlRenderer: Unhandled remove child request: "+q.string(a.getState("displayType")))}},updateState:function(a,b){null!=this._objects.h[a.__id__]?this._objectManager.updateState(this._objects.h[a.__id__],a,b):null!=this._views.h[a.__id__]&&this._viewManager.updateState(this._views.h[a.__id__],a,b)},getRealObject:function(a){return null!=this._objects.h[a.__id__]?this._objects.h[a.__id__]:null!=this._views.h[a.__id__]?this._views.h[a.__id__]:
null!=this._cameras.h[a.__id__]?this._cameras.h[a.__id__]:null!=this._scenes.h[a.__id__]?this._scenes.h[a.__id__]:null},__class__:rf});var qh=function(){this._init()};h["tools.spark.sliced.services.std.event.core.Event"]=qh;qh.__name__=!0;qh.__interfaces__=[Tg];qh.__super__=Ea;qh.prototype=v(Ea.prototype,{_init:function(){w.logger.info("Init Event std Service...",null);this._eventTypeRaisedFlags=new na;this._eventTypeRegisteredTriggers=new na;this._eventTypeRaisedFlagsParameters=new na;this._isExecutingEvents=
!1},addTrigger:function(a){var b=a.eventType,c=a.target;"TargetMe"==c&&(c=q.string(a.parentEntity.uid));var d;if(d=null!=a.parameter)d=S.keyboardStringToKey.exists(a.parameter);d&&(a.parameter=S.keyboardStringToKey.get(a.parameter));!1==this._eventTypeRegisteredTriggers.exists(b)&&(d=new D,this._eventTypeRegisteredTriggers.set(b,d));!1==this._eventTypeRegisteredTriggers.get(b).exists(c)&&this._eventTypeRegisteredTriggers.get(b).set(c,[]);this._eventTypeRegisteredTriggers.get(b).get(c).push(a)},raiseEvent:function(a,
b,c){if(this._eventTypeRegisteredTriggers.exists(a)){var d=[];null==b?d.push("TargetNone"):(d.push(null==b.uid?"null":""+b.uid),d.push(q.string(b.getState("name"))));this._isExecutingEvents?(null==this._eventTypeRaisedFlagsFuture&&(this._eventTypeRaisedFlagsFuture=new na),this._raiseFlags(d,a,b,this._eventTypeRaisedFlagsFuture)):this._raiseFlags(d,a,b,this._eventTypeRaisedFlags);this._eventTypeRaisedFlagsParameters.set(a,c);c}},_raiseFlags:function(a,b,c,d){for(var e=0;e<a.length;){var i=a[e];++e;
if(this._eventTypeRegisteredTriggers.get(b).exists(i)){if(!1==d.exists(b)){var f=new D;d.set(b,f);f}d.get(b).set(i,c)}}},_doTriggers:function(a,b,c){for(var d=0,b=this._eventTypeRegisteredTriggers.get(a).get(b);d<b.length;){var e=b[d];++d;e.pickedObject=c;(null==e.parameter||e.parameter==this._eventTypeRaisedFlagsParameters.get(a))&&e.doPass()}},update:function(){this._isExecutingEvents=!0;for(var a=this._eventTypeRaisedFlags.keys();a.hasNext();)for(var b=a.next(),c=this._eventTypeRaisedFlags.get(b).keys();c.hasNext();){var d=
c.next();this._doTriggers(b,d,this._eventTypeRaisedFlags.get(b).get(d))}this._isExecutingEvents=!1;null==this._eventTypeRaisedFlagsFuture?this._eventTypeRaisedFlags=new na:(this._eventTypeRaisedFlags=this._eventTypeRaisedFlagsFuture,this._eventTypeRaisedFlagsFuture=null)},__class__:qh});var rh=function(){this._init()};h["tools.spark.sliced.services.std.input.core.Input"]=rh;rh.__name__=!0;rh.__interfaces__=[Ug];rh.__super__=Ea;rh.prototype=v(Ea.prototype,{_init:function(){w.logger.info("Init Input std Service...",
null);this.keyboard=new sh;this.pointer=new th;this.mouse=new uh},update:function(){this.keyboard.update();this.pointer.update();this.mouse.update()},__class__:rh});var wj=function(){};h["tools.spark.sliced.services.std.input.devices.interfaces.IInputDevice"]=wj;wj.__name__=!0;var sh=function(){this._init()};h["tools.spark.sliced.services.std.input.devices.core.KeyboardDevice"]=sh;sh.__name__=!0;sh.__interfaces__=[wj];sh.prototype={_init:function(){this._keysDown=[];this._keysUp=[];this._keysJustPressed=
new na;this._keysJustReleased=new na;Y._platform.getKeyboard().down.connect(y(this,this._onKeyDown));Y._platform.getKeyboard().up.connect(y(this,this._onKeyUp))},_onKeyDown:function(a){this._keysDown.push(a.key)},_onKeyUp:function(a){this._keysUp.push(a.key)},update:function(){this._keysJustPressed=new na;for(this._keysJustReleased=new na;0<this._keysDown.length;){var a=this._keysDown.pop();this._keysJustPressed.set(a,!0);!0;B.event.raiseEvent(n.KEY_PRESSED,null,a)}for(;0<this._keysUp.length;)a=this._keysUp.pop(),
this._keysJustReleased.set(a,!0),!0,B.event.raiseEvent(n.KEY_RELEASED,null,a)},registerTrigger:function(){},isKeyDown:function(a){return Y._platform.getKeyboard().isDown(a)},isKeyPressed:function(a){return this._keysJustPressed.exists(a)},isKeyReleased:function(a){return this._keysJustReleased.exists(a)},__class__:sh};var uh=function(){this._init()};h["tools.spark.sliced.services.std.input.devices.core.MouseDevice"]=uh;uh.__name__=!0;uh.__interfaces__=[wj];uh.prototype={getScroll:function(){return this.get_scroll()},
_init:function(){Y._platform.getMouse().scroll.connect(y(this,this._onScroll));Y._platform.getMouse().down.connect(y(this,this._onMouseButtonDown));this._oldScroll=0;this._mouseRightDown=this._mouseLeftDown=this._scrollTriggered=!1},update:function(){this._scrollTriggered?(B.event.raiseEvent(n.MOUSE_SCROLL),this._scrollTriggered=!1):this._oldScroll=0;this._mouseLeftDown&&(B.event.raiseEvent(n.MOUSE_LEFT_DOWN),this._mouseLeftDown=!1);this._mouseRightDown&&(B.event.raiseEvent(n.MOUSE_RIGHT_DOWN),this._mouseRightDown=
!1)},get_scroll:function(){return this._oldScroll},_onScroll:function(a){this._scrollTriggered=!0;this._oldScroll=a},_onMouseButtonDown:function(a){a.button==sa.Left?this._mouseLeftDown=!0:a.button==sa.Right&&(this._mouseRightDown=!0);this.lastMouseButton=a.button},registerTrigger:function(){},isDown:function(a){return Y._platform.getMouse().isDown(a)},__class__:uh,__properties__:{get_scroll:"get_scroll"}};var th=function(){this._init()};h["tools.spark.sliced.services.std.input.devices.core.PointerDevice"]=
th;th.__name__=!0;th.__interfaces__=[wj];th.prototype={_init:function(){this._registeredTriggers=new na},update:function(){this._oldX=this.currentX;this._oldY=this.currentY;this.currentX=Y._platform.getPointer().get_x();this.currentY=Y._platform.getPointer().get_y()},distX:function(){return this.currentX-this._oldX},distY:function(){return this.currentY-this._oldY},isDown:function(){return Y._platform.getPointer().isDown()},_setTrigger:function(a,b){if(null==this._registeredTriggers.get(a)){var c=
new Qa;this._registeredTriggers.set(a,c);c}this._registeredTriggers.get(a).set(b,b);b},_getTrigger:function(a,b){return null==this._registeredTriggers.get(a)?null:this._registeredTriggers.get(a).get(b)},registerTrigger:function(a,b){this._setTrigger(a,b)},submitPointerEvent:function(a,b){B.event.raiseEvent(a,b)},_onMove:function(a){w.logger.error("PointerMove: "+a.viewX+", "+a.viewY,null)},__class__:th};var vh=function(){this._init()};h["tools.spark.sliced.services.std.logic.core.Logic"]=vh;vh.__name__=
!0;vh.__interfaces__=[Vg];vh.__super__=Ea;vh.prototype=v(Ea.prototype,{_init:function(){w.logger.info("Init Logic std Service...",null);S.init();this.gameFactory=new wh;this.rootGameEntitiesRunning=new D;this.rootGameEntitiesPaused=new D;this._gameEntitiesByName=new D},createInterpreters:function(){this.scriptInterpreter=new xh;this.gmlInterpreter=new yh},update:function(){for(var a=this.rootGameEntitiesRunning.iterator();a.hasNext();)a.next().doActions()},startAction:function(a,b){return a.startAction(b)},
createAndRun:function(a){var b=this.gameFactory.createGameEntity(a);this.rootGameEntitiesRunning.set(a,b);b;w.logger.warn("Logic Service: Create and Running entity: "+a,null)},createAndPause:function(a){var b=this.gameFactory.createGameEntity(a);this.rootGameEntitiesPaused.set(a,b);b},getAllEntitiesByName:function(a){return this._gameEntitiesByName.get(a)},getEntityByName:function(a){return this._gameEntitiesByName.exists(a)?this._gameEntitiesByName.get(a)[this._gameEntitiesByName.get(a).length-1]:
null},queryGameEntity:function(a,b,c,d,e){null==e&&(e=!1);null==d&&(d=!1);return!1==d&&!1==e?(a=B.display.getSpace2_5Object(a),null!=a?a.query(b,c):null):null},registerEntityByName:function(a){if(null!=a.getState("name")){var b=a.getState("name");!1==this._gameEntitiesByName.exists(b)&&this._gameEntitiesByName.set(b,[]);this._gameEntitiesByName.get(b).push(a)}},replace:function(a,b,c,d){return(new cc(b,c)).replace(a,d)},getDt:function(){return B.dt},reflectField:function(a,b){return Q.getProperty(a,
b)},reflectFieldOfField:function(a,b,c){return Q.getProperty(Q.getProperty(a,b),c)},xmlToString:function(a){return pe.print(a)},xml_createDocument:function(){return o.createDocument()},xml_clone:function(a){return o.parse(this.xmlToString(a)).firstElement()},xml_createElements:function(a){for(var b={first:null,last:null},c=0;c<a.length;){var d=a[c];++c;d=o.createElement(d);null==b.first?b.first=d:b.last.addChild(d);b.last=d}return b},xml_createElement:function(a){return o.createElement(a)},xml_createElementAttr:function(a,
b,c){a=o.createElement(a);a.set(b,c);return a},xml_entity_addExtend:function(a,b){var c;c=a.elementsNamed("Extends");c.hasNext()?c=c.next():(c=o.createElement("Extends"),a.addChild(c));var d=o.createElement("Entity");c.addChild(d);null!=b.ext&&d.set("extends",b.ext);return d},xml_entity_getExtendsEntityNames:function(a){var b=[],c=null,a=a.elementsNamed("Extends");a.hasNext()&&(c=a.next());if(null!=c)for(c=c.elementsNamed("Entity");c.hasNext();)a=c.next(),b.push(a.get("extends"));return b},xml_entity_addMState:function(a,
b,c){var c=c?"_States":"States",d=a.elementsNamed(c);d.hasNext()?c=d.next():(c=o.createElement(c),a.addChild(c));a=o.createElement("_State");c.addChild(a);null!=b.id&&a.set("id",b.id);null!=b.value&&(c=o.createElement("Value"),a.addChild(c),c.addChild(o.createPCData(b.value)));return a},xml_entity_addTrigger:function(a,b,c){var c=c?"_Triggers":"Triggers",d=a.elementsNamed(c);d.hasNext()?c=d.next():(c=o.createElement(c),a.addChild(c));a=o.createElement("Trigger");c.addChild(a);null!=b.ext&&a.set("extends",
b.ext);null!=b.event&&(c=o.createElement("Event"),a.addChild(c),c.addChild(o.createPCData(b.event)));null!=b.target&&(c=o.createElement("Target"),a.addChild(c),c.addChild(o.createPCData(b.target)));null!=b.parameter&&(c=o.createElement("Parameter"),a.addChild(c),c.addChild(o.createPCData(b.parameter)));return a},__class__:vh});var bd=function(){};h["tools.spark.sliced.services.std.logic.gde.interfaces.IGameBase"]=bd;bd.__name__=!0;bd.prototype={__class__:bd};var hb=function(){};h["tools.spark.sliced.services.std.logic.gde.core.AGameBase"]=
hb;hb.__name__=!0;hb.__interfaces__=[bd];hb.prototype={get_parent:function(){return this.parentEntity},__class__:hb,__properties__:{get_parent:"get_parent"}};var zh=function(){};h["tools.spark.sliced.services.std.logic.gde.interfaces.IGameAction"]=zh;zh.__name__=!0;zh.__interfaces__=[bd];zh.prototype={__class__:zh};var wf=function(){this._init()};h["tools.spark.sliced.services.std.logic.gde.core.GameAction"]=wf;wf.__name__=!0;wf.__interfaces__=[zh];wf.__super__=hb;wf.prototype=v(hb.prototype,{_init:function(){this.scriptSet=
[];this.gameStateSet=new D},addState:function(a){null!=this.gameStateSet.get(a.id)&&w.logger.warn("A State with id "+a.id+" already exists in this Action.",null);this.gameStateSet.set(a.id,a);a},doPass:function(){for(var a=0,b=this.scriptSet;a<b.length;){var c=b[a];++a;-1==c?B.logic.gmlInterpreter.run(c,function(a){var b=new D;null!=qb["this"]?b.setReserved("this",a):b.h["this"]=a;b.set("me",a.parentEntity);b.set("parent",a.parentEntity.parentEntity);return b}(this)):!1==B.logic.scriptInterpreter.run(c,
function(a){var b=new D;null!=qb["this"]?b.setReserved("this",a):b.h["this"]=a;b.set("me",a.parentEntity);b.set("parent",a.parentEntity.parentEntity);return b}(this))&&(w.logger.error("Error: Failed to run Action ["+this.id+"].",null),this.parentEntity.stopAction(this.id))}},getState:function(a){return null==this.gameStateSet.get(a)?null:this.gameStateSet.get(a).value},setState:function(a,b){this.gameStateSet.get(a).value=b;return this.gameStateSet.get(a).value},__class__:wf});var xj=function(){};
h["tools.spark.sliced.services.std.logic.gde.interfaces.IGameClassInstantiator"]=xj;xj.__name__=!0;xj.prototype={__class__:xj};var Ah=function(a,b,c){w.logger.info("Creating Game Class Instantiator",null);this._xmlNodeTypeToNodeName=a;this._xmlConcurrencyNameToType=b;this._xmlStateNameToType=c;this._init()};h["tools.spark.sliced.services.std.logic.gde.core.GameClassInstantiator"]=Ah;Ah.__name__=!0;Ah.__interfaces__=[xj];Ah.prototype={issueUID:function(){return this._numObjects++},_init:function(){this._numObjects=
0},instantiateEntity:function(a,b){var c=new Ge(this.issueUID());c.parentEntity=b;c.gameForm=this.instantiateForm(a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.FORM)).next(),c);if(a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.STATES)).hasNext())for(var d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.STATES)).next().elements();d.hasNext();){var e=d.next();c.addState(this.instantiateState(e,c))}if(a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.ACTIONS)).hasNext())for(d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.ACTIONS)).next().elements();d.hasNext();)e=
this.instantiateAction(d.next(),c),c.addAction(e);if(a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.TRIGGERS)).hasNext())for(d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.TRIGGERS)).next().elements();d.hasNext();)e=this.instantiateTrigger(d.next(),c),B.event.addTrigger(e);B.logic.registerEntityByName(c);B.event.raiseEvent(n.CREATED,c);return c},instantiateForm:function(a,b){var c=new xf;c.parentEntity=b;if(a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.STATES)).hasNext())for(var d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.STATES)).next().elements();d.hasNext();){var e=
d.next();c.addState(this.instantiateState(e,b))}c.gameSpace=this.instantiateSpace(a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.SPACE)).next(),b);return c},instantiateSpace:function(a,b){var c=new yf;c.parentEntity=b;if(a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.ENTITIES)).hasNext())for(var d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.ENTITIES)).next().elements();d.hasNext();){var e=d.next();c.gameEntitySet.push(this.instantiateEntity(e,b))}return c},instantiateState:function(a,
b){var c=new zf;c.parentEntity=b;c.id=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.ID)).next().firstChild().get_nodeValue();var d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.TYPE)).next().firstChild().get_nodeValue();c.type=this._xmlStateNameToType.get(d);d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.VALUE)).next().firstChild().get_nodeValue();switch(c.type[1]){case 3:c.value="true"==d||"True"==d||"t"==d||"T"==d;break;case 2:c.value=parseFloat(d);break;case 1:c.value=q.parseInt(d);
break;case 4:c.value=d;break;case 0:c.value=null}return c},instantiateAction:function(a,b){var c=new wf;c.parentEntity=b;c.id=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.ID)).next().firstChild().get_nodeValue();var d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.CONCURRENCY)).next().firstChild().get_nodeValue();c.concurrency=this._xmlConcurrencyNameToType.get(d);for(d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.SCRIPTS)).next().elements();d.hasNext();){var e=d.next();if(e.nodeType!=
o.Element)throw new p(new p("Bad node type, expected Element but found "+e.nodeType));e.nodeName==this._xmlNodeTypeToNodeName.get(k.SCRIPT)?c.scriptSet.push(B.logic.scriptInterpreter.hash(function(){if(e.nodeType!=o.Document&&e.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+e.nodeType));return e.children[0]}(this).get_nodeValue())):c.scriptSet.push(B.logic.gmlInterpreter.hash(function(){if(e.nodeType!=o.Document&&e.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+
e.nodeType));return e.children[0]}(this).get_nodeValue()))}if(a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.STATES)).hasNext())for(d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.STATES)).next().elements();d.hasNext();){var i=d.next();c.addState(this.instantiateState(i,b))}return c},instantiateTrigger:function(a,b){var c=new Af;c.parentEntity=b;var d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.EVENT)).next().firstChild().get_nodeValue();c.eventType=S.eventTypesMapReverse.get(d);if(a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.PARAMETER)).hasNext()){d=
a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.PARAMETER)).next();if(d.nodeType!=o.Document&&d.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+d.nodeType));c.parameter=d.children[0].get_nodeValue()}if(a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.TARGET)).hasNext()){d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.TARGET)).next();if(d.nodeType!=o.Document&&d.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+
d.nodeType));c.target=d.children[0].get_nodeValue()}else c.target="TargetMe";if(a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.TARGET_TYPE)).hasNext()){d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.TARGET_TYPE)).next();if(d.nodeType!=o.Document&&d.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+d.nodeType));c.targetType=d.children[0].get_nodeValue()}for(d=a.elementsNamed(this._xmlNodeTypeToNodeName.get(k.SCRIPTS)).next().elements();d.hasNext();){var e=
d.next();if(e.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+e.nodeType));e.nodeName==this._xmlNodeTypeToNodeName.get(k.SCRIPT)?c.scriptSet.push(B.logic.scriptInterpreter.hash(function(){if(e.nodeType!=o.Document&&e.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+e.nodeType));return e.children[0]}(this).get_nodeValue())):c.scriptSet.push(B.logic.gmlInterpreter.hash(function(){if(e.nodeType!=o.Document&&e.nodeType!=
o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+e.nodeType));return e.children[0]}(this).get_nodeValue()))}return c},__class__:Ah};var yj=function(){};h["tools.spark.sliced.services.std.logic.gde.interfaces.IGameClassParser"]=yj;yj.__name__=!0;yj.prototype={__class__:yj};var Bh=function(){w.logger.info("Creating Game Class Parser",null);this._init()};h["tools.spark.sliced.services.std.logic.gde.core.GameClassParser"]=Bh;Bh.__name__=!0;Bh.__interfaces__=[yj];Bh.prototype=
{_init:function(){this._initNodeNamesMap();this._initNodeTypesMap();this._initGameTypesMap();this._initNodeToGameMap();this._initFileExtensionsMap();this._initExtendableNodesMap();this._initMergableNodesMap();this._initTargetMergableNodesMap();this._initArrayNodesMap();this._initConcurrencyTypeToNameMap();this._initConcurrencyNameToTypeMap();this._initStateTypeToNameMap();this._initStateNameToTypeMap();this._gameClassValidator=new Ch(this._xmlNodeTypeToNodeName,this._xmlConcurrencyTypeToName,this._xmlStateTypeToName);
this._gameClassInstantiator=new Ah(this._xmlNodeTypeToNodeName,this._xmlConcurrencyNameToType,this._xmlStateNameToType)},_initNodeNamesMap:function(){this._xmlNodeTypeToNodeName=new na;this._xmlNodeTypeToNodeName.set(k.ACTION,"Action");"Action";this._xmlNodeTypeToNodeName.set(k.ACTIONS,"Actions");"Actions";this._xmlNodeTypeToNodeName.set(k.ENTITIES,"Entities");"Entities";this._xmlNodeTypeToNodeName.set(k.ENTITY,"Entity");"Entity";this._xmlNodeTypeToNodeName.set(k.FORM,"Form");"Form";this._xmlNodeTypeToNodeName.set(k.SCRIPTS,
"Scripts");"Scripts";this._xmlNodeTypeToNodeName.set(k.SCRIPT,"Script");"Script";this._xmlNodeTypeToNodeName.set(k.GML,"Gml");"Gml";this._xmlNodeTypeToNodeName.set(k.TRIGGERS,"Triggers");"Triggers";this._xmlNodeTypeToNodeName.set(k.TRIGGER,"Trigger");"Trigger";this._xmlNodeTypeToNodeName.set(k.EVENT,"Event");"Event";this._xmlNodeTypeToNodeName.set(k.PARAMETER,"Parameter");"Parameter";this._xmlNodeTypeToNodeName.set(k.TARGET,"Target");"Target";this._xmlNodeTypeToNodeName.set(k.TARGET_TYPE,"TargetType");
"TargetType";this._xmlNodeTypeToNodeName.set(k.CONCURRENCY,"Concurrency");"Concurrency";this._xmlNodeTypeToNodeName.set(k.ID,"Id");"Id";this._xmlNodeTypeToNodeName.set(k.SPACE,"Space");"Space";this._xmlNodeTypeToNodeName.set(k.STATE,"State");"State";this._xmlNodeTypeToNodeName.set(k.STATES,"States");"States";this._xmlNodeTypeToNodeName.set(k.TYPE,"Type");"Type";this._xmlNodeTypeToNodeName.set(k.VALUE,"Value");"Value";this._xmlNodeTypeToNodeName.set(k.EXTENDS,"Extends");"Extends"},_initNodeTypesMap:function(){this._xmlNodeNameToNodeType=
new D;var a=this._xmlNodeTypeToNodeName.get(k.ACTION),b=k.ACTION;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.ACTIONS);b=k.ACTIONS;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.ENTITIES);b=k.ENTITIES;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.ENTITY);b=k.ENTITY;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.FORM);b=k.FORM;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.SCRIPTS);
b=k.SCRIPTS;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.SCRIPT);b=k.SCRIPT;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.GML);b=k.GML;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.TRIGGERS);b=k.TRIGGERS;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.TRIGGER);b=k.TRIGGER;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.EVENT);b=k.EVENT;this._xmlNodeNameToNodeType.set(a,
b);b;a=this._xmlNodeTypeToNodeName.get(k.PARAMETER);b=k.PARAMETER;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.TARGET);b=k.TARGET;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.TARGET_TYPE);b=k.TARGET_TYPE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.CONCURRENCY);b=k.CONCURRENCY;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.ID);b=k.ID;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.SPACE);
b=k.SPACE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.STATE);b=k.STATE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.STATES);b=k.STATES;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.TYPE);b=k.TYPE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.VALUE);b=k.VALUE;this._xmlNodeNameToNodeType.set(a,b);b;a=this._xmlNodeTypeToNodeName.get(k.EXTENDS);b=k.EXTENDS;this._xmlNodeNameToNodeType.set(a,
b);b},_initGameTypesMap:function(){this._xmlGameTypeToNodeName=new na;var a=this._xmlNodeTypeToNodeName.get(k.ENTITY);this._xmlGameTypeToNodeName.set(T.ENTITY,a);a;a=this._xmlNodeTypeToNodeName.get(k.STATE);this._xmlGameTypeToNodeName.set(T.STATE,a);a;a=this._xmlNodeTypeToNodeName.get(k.SPACE);this._xmlGameTypeToNodeName.set(T.SPACE,a);a;a=this._xmlNodeTypeToNodeName.get(k.FORM);this._xmlGameTypeToNodeName.set(T.FORM,a);a;a=this._xmlNodeTypeToNodeName.get(k.ACTION);this._xmlGameTypeToNodeName.set(T.ACTION,
a);a;a=this._xmlNodeTypeToNodeName.get(k.TRIGGER);this._xmlGameTypeToNodeName.set(T.TRIGGER,a);a},_initNodeToGameMap:function(){this._xmlNodeTypeToGameType=new na;var a=T.ENTITY;this._xmlNodeTypeToGameType.set(k.ENTITY,a);a;a=T.STATE;this._xmlNodeTypeToGameType.set(k.STATE,a);a;a=T.SPACE;this._xmlNodeTypeToGameType.set(k.SPACE,a);a;a=T.FORM;this._xmlNodeTypeToGameType.set(k.FORM,a);a;a=T.ACTION;this._xmlNodeTypeToGameType.set(k.ACTION,a);a;a=T.TRIGGER;this._xmlNodeTypeToGameType.set(k.TRIGGER,a);
a},_initFileExtensionsMap:function(){this._xmlGameTypeToFileExtension=new na;this._xmlGameTypeToFileExtension.set(T.ENTITY,"egc");"egc";this._xmlGameTypeToFileExtension.set(T.STATE,"sgc");"sgc";this._xmlGameTypeToFileExtension.set(T.SPACE,"pgc");"pgc";this._xmlGameTypeToFileExtension.set(T.FORM,"fgc");"fgc";this._xmlGameTypeToFileExtension.set(T.ACTION,"agc");"agc";this._xmlGameTypeToFileExtension.set(T.TRIGGER,"tgc");"tgc"},_initExtendableNodesMap:function(){this._isNodeExtendable=new na;this._isNodeExtendable.set(k.ACTION,
!0);!0;this._isNodeExtendable.set(k.ACTIONS,!1);!1;this._isNodeExtendable.set(k.ENTITIES,!1);!1;this._isNodeExtendable.set(k.ENTITY,!0);!0;this._isNodeExtendable.set(k.FORM,!0);!0;this._isNodeExtendable.set(k.SCRIPTS,!1);!1;this._isNodeExtendable.set(k.SCRIPT,!1);!1;this._isNodeExtendable.set(k.GML,!1);!1;this._isNodeExtendable.set(k.TRIGGERS,!1);!1;this._isNodeExtendable.set(k.TRIGGER,!0);!0;this._isNodeExtendable.set(k.EVENT,!1);!1;this._isNodeExtendable.set(k.PARAMETER,!1);!1;this._isNodeExtendable.set(k.TARGET,
!1);!1;this._isNodeExtendable.set(k.TARGET_TYPE,!1);!1;this._isNodeExtendable.set(k.CONCURRENCY,!1);!1;this._isNodeExtendable.set(k.ID,!1);!1;this._isNodeExtendable.set(k.SPACE,!0);!0;this._isNodeExtendable.set(k.STATE,!0);!0;this._isNodeExtendable.set(k.STATES,!1);!1;this._isNodeExtendable.set(k.TYPE,!1);!1;this._isNodeExtendable.set(k.VALUE,!1);!1;this._isNodeExtendable.set(k.EXTENDS,!1);!1},_initMergableNodesMap:function(){this._isNodeMergable=new na;this._isNodeMergable.set(k.ACTION,!1);!1;this._isNodeMergable.set(k.ACTIONS,
!0);!0;this._isNodeMergable.set(k.ENTITIES,!0);!0;this._isNodeMergable.set(k.ENTITY,!1);!1;this._isNodeMergable.set(k.FORM,!0);!0;this._isNodeMergable.set(k.SCRIPTS,!0);!0;this._isNodeMergable.set(k.SCRIPT,!1);!1;this._isNodeMergable.set(k.GML,!1);!1;this._isNodeMergable.set(k.TRIGGERS,!0);!0;this._isNodeMergable.set(k.TRIGGER,!1);!1;this._isNodeMergable.set(k.EVENT,!1);!1;this._isNodeMergable.set(k.PARAMETER,!1);!1;this._isNodeMergable.set(k.TARGET,!1);!1;this._isNodeMergable.set(k.TARGET_TYPE,!1);
!1;this._isNodeMergable.set(k.CONCURRENCY,!1);!1;this._isNodeMergable.set(k.ID,!1);!1;this._isNodeMergable.set(k.SPACE,!0);!0;this._isNodeMergable.set(k.STATE,!1);!1;this._isNodeMergable.set(k.STATES,!0);!0;this._isNodeMergable.set(k.TYPE,!1);!1;this._isNodeMergable.set(k.VALUE,!1);!1;this._isNodeMergable.set(k.EXTENDS,!1);!1},_initTargetMergableNodesMap:function(){this._isNodeTargetMergable=new na;this._isNodeTargetMergable.set(k.ACTION,!0);!0;this._isNodeTargetMergable.set(k.ACTIONS,!1);!1;this._isNodeTargetMergable.set(k.ENTITIES,
!1);!1;this._isNodeTargetMergable.set(k.ENTITY,!1);!1;this._isNodeTargetMergable.set(k.FORM,!1);!1;this._isNodeTargetMergable.set(k.SCRIPTS,!1);!1;this._isNodeTargetMergable.set(k.SCRIPT,!1);!1;this._isNodeTargetMergable.set(k.GML,!1);!1;this._isNodeTargetMergable.set(k.TRIGGERS,!1);!1;this._isNodeTargetMergable.set(k.TRIGGER,!1);!1;this._isNodeTargetMergable.set(k.EVENT,!1);!1;this._isNodeTargetMergable.set(k.PARAMETER,!1);!1;this._isNodeTargetMergable.set(k.TARGET,!1);!1;this._isNodeTargetMergable.set(k.TARGET_TYPE,
!1);!1;this._isNodeTargetMergable.set(k.CONCURRENCY,!1);!1;this._isNodeTargetMergable.set(k.ID,!1);!1;this._isNodeTargetMergable.set(k.SPACE,!1);!1;this._isNodeTargetMergable.set(k.STATE,!0);!0;this._isNodeTargetMergable.set(k.STATES,!1);!1;this._isNodeTargetMergable.set(k.TYPE,!1);!1;this._isNodeTargetMergable.set(k.VALUE,!1);!1;this._isNodeTargetMergable.set(k.EXTENDS,!1);!1},_initArrayNodesMap:function(){this._isNodeArray=new na;this._isNodeArray.set(k.ACTION,!1);!1;this._isNodeArray.set(k.ACTIONS,
!0);!0;this._isNodeArray.set(k.ENTITIES,!0);!0;this._isNodeArray.set(k.ENTITY,!1);!1;this._isNodeArray.set(k.FORM,!1);!1;this._isNodeArray.set(k.SCRIPTS,!0);!0;this._isNodeArray.set(k.SCRIPT,!1);!1;this._isNodeArray.set(k.GML,!1);!1;this._isNodeArray.set(k.TRIGGERS,!0);!0;this._isNodeArray.set(k.TRIGGER,!1);!1;this._isNodeArray.set(k.EVENT,!1);!1;this._isNodeArray.set(k.PARAMETER,!1);!1;this._isNodeArray.set(k.TARGET,!1);!1;this._isNodeArray.set(k.TARGET_TYPE,!1);!1;this._isNodeArray.set(k.CONCURRENCY,
!1);!1;this._isNodeArray.set(k.ID,!1);!1;this._isNodeArray.set(k.SPACE,!1);!1;this._isNodeArray.set(k.STATE,!1);!1;this._isNodeArray.set(k.STATES,!0);!0;this._isNodeArray.set(k.TYPE,!1);!1;this._isNodeArray.set(k.VALUE,!1);!1;this._isNodeArray.set(k.EXTENDS,!0);!0},_initConcurrencyTypeToNameMap:function(){this._xmlConcurrencyTypeToName=new na;this._xmlConcurrencyTypeToName.set(ua.PARALLEL,"Parallel");"Parallel";this._xmlConcurrencyTypeToName.set(ua.PERSISTENT,"Persistent");"Persistent";this._xmlConcurrencyTypeToName.set(ua.TRANSIENT,
"Transient");"Transient"},_initConcurrencyNameToTypeMap:function(){this._xmlConcurrencyNameToType=new D;var a=this._xmlConcurrencyTypeToName.get(ua.PARALLEL),b=ua.PARALLEL;this._xmlConcurrencyNameToType.set(a,b);b;a=this._xmlConcurrencyTypeToName.get(ua.PERSISTENT);b=ua.PERSISTENT;this._xmlConcurrencyNameToType.set(a,b);b;a=this._xmlConcurrencyTypeToName.get(ua.TRANSIENT);b=ua.TRANSIENT;this._xmlConcurrencyNameToType.set(a,b);b},_initStateTypeToNameMap:function(){this._xmlStateTypeToName=new na;this._xmlStateTypeToName.set(ca.DYNAMIC,
"Dynamic");"Dynamic";this._xmlStateTypeToName.set(ca.BOOLEAN,"Boolean");"Boolean";this._xmlStateTypeToName.set(ca.DECIMAL,"Decimal");"Decimal";this._xmlStateTypeToName.set(ca.INTEGER,"Integer");"Integer";this._xmlStateTypeToName.set(ca.TEXT,"Text");"Text"},_initStateNameToTypeMap:function(){this._xmlStateNameToType=new D;var a=this._xmlStateTypeToName.get(ca.DYNAMIC),b=ca.DYNAMIC;this._xmlStateNameToType.set(a,b);b;a=this._xmlStateTypeToName.get(ca.BOOLEAN);b=ca.BOOLEAN;this._xmlStateNameToType.set(a,
b);b;a=this._xmlStateTypeToName.get(ca.DECIMAL);b=ca.DECIMAL;this._xmlStateNameToType.set(a,b);b;a=this._xmlStateTypeToName.get(ca.INTEGER);b=ca.INTEGER;this._xmlStateNameToType.set(a,b);b;a=this._xmlStateTypeToName.get(ca.TEXT);b=ca.TEXT;this._xmlStateNameToType.set(a,b);b},parseGameNode:function(a){if(this._extendGameNode(a)){this._mergeGameNode(a);if(this._validateGameNode(a))return!0;w.logger.error("Game Entity could not be validated",null);return!1}w.logger.error("Game Entity Class is not valid!",
null);return!1},instantiateEntity:function(a){return this._gameClassInstantiator.instantiateEntity(a)},_extendGameNode:function(a){var b;if(a.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+a.nodeType));if("_"==E.substr(a.nodeName,0,1)){if(a.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+a.nodeType));b=this._xmlNodeNameToNodeType.get(E.substr(a.nodeName,1,null))}else{if(a.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+
a.nodeType));b=this._xmlNodeNameToNodeType.get(a.nodeName)}if(null==b)return pa.error("Unexpected Element: <"+function(){if(a.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+a.nodeType));return a.nodeName}(this)+">"),!1;for(var c=a.elements();c.hasNext();){var d=c.next();if(!1==this._extendGameNode(d))return pa.error("Failed to parse node "+function(){if(d.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+d.nodeType));return d.nodeName}(this)),
!1}if(this._handleExtendsElement(a,b)){if(this._handleExtendsAttribute(a,b))return!0;w.logger.error("Failed to extend "+q.string(b)+' node from the "extends" parameter.',null);return!1}w.logger.error("Failed to extend "+q.string(b)+' node from the "Extends" tag.',null);return!1},_handleExtendsElement:function(a,b){var c=a.elementsNamed("Extends").hasNext();if(this._isNodeExtendable.get(b)&&c){for(var c=a.elementsNamed("Extends").next(),d=[],e=c.elements();e.hasNext();){var i=e.next();d.splice(0,0,
i)}for(e=0;e<d.length;){var f=d[e];++e;i=this._xmlNodeTypeToNodeName.get(b);if(f.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+f.nodeType));if(i==f.nodeName)this._moveChildren(a,f);else return pa.error("Expected Node <"+this._xmlNodeTypeToNodeName.get(b)+">. Got <"+function(){if(f.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+f.nodeType));return f.nodeName}(this)+">."),!1}a.removeChild(c);return!0}return c?(w.logger.warn("Element "+
q.string(b)+" cannot be extended!",null),!1):!0},_handleExtendsAttribute:function(a,b){if(this._isNodeExtendable.get(b)&&a.exists("extends")){var c=this.getGameNode(this._xmlNodeTypeToGameType.get(b),a.get("extends"),null);a.remove("extends");if(null!=c){if(this._extendGameNode(c))return this._moveChildren(a,c),!0;w.logger.error(""+q.string(b)+" Class is not valid!",null);return!1}w.logger.error(""+q.string(b)+" Class is not well-formed or not found!",null);return!1}return a.exists("extends")?(w.logger.error("Element "+
q.string(b)+" cannot be extended!",null),!1):!0},_moveChildren:function(a,b){for(var c=[],d=b.elements();d.hasNext();){var e=d.next();c.push(e)}for(d=0;d<c.length;){var i=c[d];++d;if(!1==a.elementsNamed(function(){if(i.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+i.nodeType));return i.nodeName}(this)).hasNext())a.addChild(i);else{if(i.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+i.nodeType));"_"==E.substr(i.nodeName,0,1)&&
a.insertChild(i,0)}}},_validateGameNode:function(a){var b;if(a.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+a.nodeType));b=this._xmlNodeNameToNodeType.get(a.nodeName);if(this._gameClassValidator.validateGameNode(a,b)){for(a=a.elements();a.hasNext();){var c=a.next();if(!1==this._validateGameNode(c))return pa.error("Failed to validate node "+function(){if(c.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+c.nodeType));return c.nodeName}(this)),
!1}return!0}w.logger.error("Failed to validate "+q.string(b)+" node",null);return!1},_mergeGameNode:function(a){this._mergeSingleGameNode(a);for(a=a.elements();a.hasNext();)this._mergeGameNode(a.next())},_mergeSingleGameNode:function(a){for(var b=[],c=a.elements();c.hasNext();){var d=c.next();b.push(d)}for(c=0;c<b.length;){var e=b[c];++c;if(e.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+e.nodeType));if("_"==E.substr(e.nodeName,0,1)){var i;if(e.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+
e.nodeType));i=E.substr(e.nodeName,1,null);if(function(a){var b=a._xmlNodeNameToNodeType.get(i);return a._isNodeMergable.get(b)}(this))a.elementsNamed(i).hasNext()?(d=a.elementsNamed(i).next(),this._mergeChildren(e,d),a.removeChild(e)):e.set_nodeName(function(){if(e.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+e.nodeType));return E.substr(e.nodeName,1,null)}(this));else if(function(a){var b=a._xmlNodeNameToNodeType.get(i);return a._isNodeTargetMergable.get(b)}(this))if(e.exists("id")){for(var d=
null,f=!1,g=a.elementsNamed(i);g.hasNext();){var h=g.next();if(h.elementsNamed("Id").hasNext()){var j=h.elementsNamed("Id").next();if(j.nodeType!=o.Document&&j.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element or Document but found "+j.nodeType));if(j.children[0].get_nodeValue()==e.get("id")){d=h;f=!0;break}}}f?(this._mergeChildren(e,d),a.removeChild(e)):(e.set_nodeName(function(){if(e.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+e.nodeType));
return E.substr(e.nodeName,1,null)}(this)),e.remove("id"))}else w.logger.warn("Target-Mergable Element "+i+" does not have a targetMerge attribute",null);else w.logger.warn("Non-mergable element "+i+" has a merge identifier",null)}}},_mergeChildren:function(a,b){for(var c=[],d=a.elements();d.hasNext();){var e=d.next();c.push(e)}if(function(a){var c;if(b.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+b.nodeType));c=a._xmlNodeNameToNodeType.get(b.nodeName);return a._isNodeArray.get(c)}(this))for(d=
0;d<c.length;)e=c[d],++d,b.addChild(e);else for(d=0;d<c.length;){var i=c[d];++d;if(i.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+i.nodeType));"_"!=E.substr(i.nodeName,0,1)&&b.elementsNamed(function(){if(i.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+i.nodeType));return i.nodeName}(this)).hasNext()&&b.removeChild(b.elementsNamed(function(){if(i.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+
i.nodeType));return i.nodeName}(this)).next());b.addChild(i)}},_parseEmbeddedStringAsset:function(a){try{return o.parse(R.getFile(a).toString())}catch(b){return b instanceof p&&(b=b.val),w.logger.error(q.string(b),null),w.logger.error("Spark Parser Error: Entity ["+a+"] has not been loaded!",null),null}},_getClassUrl:function(a,b){return Ja.replace(a,".","/")+"."+b},getGameNode:function(a,b,c){var d;null!=b&&null!=c?(w.logger.warn("Both a game class name and a game class node have been specified to create a game class. Using game class node...",
null),d=c):null!=b?(d=this._parseEmbeddedStringAsset(this._getClassUrl(b,this._xmlGameTypeToFileExtension.get(a))),null!=d&&(d=d.firstElement())):d=null!=c?c:o.createElement(this._xmlGameTypeToNodeName.get(a));if(null!=d){if(d.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+d.nodeType));return d.nodeName!=this._xmlGameTypeToNodeName.get(a)?(pa.error("Expected "+this._xmlGameTypeToNodeName.get(a)+", got "+function(){if(d.nodeType!=o.Element)throw new p(new p("Bad node type, expected Element but found "+
d.nodeType));return d.nodeName}(this)),null):d}w.logger.error("Class "+q.string(a)+" is not well-formed or not found!",null);return null},__class__:Bh};var zj=function(){};h["tools.spark.sliced.services.std.logic.gde.interfaces.IGameClassValidator"]=zj;zj.__name__=!0;zj.prototype={__class__:zj};var Ch=function(a,b,c){w.logger.info("Creating Game Class Validator",null);this._xmlNodeTypeToNodeName=a;this._xmlConcurrencyTypeToName=b;this._xmlStateTypeToName=c;this._init()};h["tools.spark.sliced.services.std.logic.gde.core.GameClassValidator"]=
Ch;Ch.__name__=!0;Ch.__interfaces__=[zj];Ch.prototype={_init:function(){this._initNodeRulesMap()},_initNodeRulesMap:function(){this._xmlNodeTypeToNodeRule=new na;var a=this._createActionNodeRule();this._xmlNodeTypeToNodeRule.set(k.ACTION,a);a;a=this._createActionsNodeRule();this._xmlNodeTypeToNodeRule.set(k.ACTIONS,a);a;a=this._createEntitiesNodeRule();this._xmlNodeTypeToNodeRule.set(k.ENTITIES,a);a;a=this._createEntityNodeRule();this._xmlNodeTypeToNodeRule.set(k.ENTITY,a);a;a=this._createFormNodeRule();
this._xmlNodeTypeToNodeRule.set(k.FORM,a);a;a=this._createScriptsNodeRule();this._xmlNodeTypeToNodeRule.set(k.SCRIPTS,a);a;a=this._createScriptNodeRule();this._xmlNodeTypeToNodeRule.set(k.SCRIPT,a);a;a=this._createGmlNodeRule();this._xmlNodeTypeToNodeRule.set(k.GML,a);a;a=this._createTriggersNodeRule();this._xmlNodeTypeToNodeRule.set(k.TRIGGERS,a);a;a=this._createTriggerNodeRule();this._xmlNodeTypeToNodeRule.set(k.TRIGGER,a);a;a=this._createEventNodeRule();this._xmlNodeTypeToNodeRule.set(k.EVENT,
a);a;a=this._createParameterNodeRule();this._xmlNodeTypeToNodeRule.set(k.PARAMETER,a);a;a=this._createTargetNodeRule();this._xmlNodeTypeToNodeRule.set(k.TARGET,a);a;a=this._createTargetTypeNodeRule();this._xmlNodeTypeToNodeRule.set(k.TARGET_TYPE,a);a;a=this._createConcurrencyNodeRule();this._xmlNodeTypeToNodeRule.set(k.CONCURRENCY,a);a;a=this._createIdNodeRule();this._xmlNodeTypeToNodeRule.set(k.ID,a);a;a=this._createSpaceNodeRule();this._xmlNodeTypeToNodeRule.set(k.SPACE,a);a;a=this._createStateNodeRule();
this._xmlNodeTypeToNodeRule.set(k.STATE,a);a;a=this._createStatesNodeRule();this._xmlNodeTypeToNodeRule.set(k.STATES,a);a;a=this._createTypeNodeRule();this._xmlNodeTypeToNodeRule.set(k.TYPE,a);a;a=this._createValueNodeRule();this._xmlNodeTypeToNodeRule.set(k.VALUE,a);a},validateGameNode:function(a,b){if(null==this._xmlNodeTypeToNodeRule.get(b))return w.logger.error("This rule has not been created Yet!",null),!1;try{return N.checkNode(a,this._xmlNodeTypeToNodeRule.get(b)),!0}catch(c){c instanceof p&&
(c=c.val);if(A.__instanceof(c,String))return w.logger.error(c,null),!1;throw c;}},_createEntityNodeRule:function(){var a=s.RList([s.ROptional(s.RNode(this._xmlNodeTypeToNodeName.get(k.ACTIONS))),s.ROptional(s.RNode(this._xmlNodeTypeToNodeName.get(k.STATES))),s.ROptional(s.RNode(this._xmlNodeTypeToNodeName.get(k.TRIGGERS))),s.RNode(this._xmlNodeTypeToNodeName.get(k.FORM))],!1);return s.RNode(this._xmlNodeTypeToNodeName.get(k.ENTITY),[],a)},_createFormNodeRule:function(){var a=s.RList([s.ROptional(s.RNode(this._xmlNodeTypeToNodeName.get(k.STATES))),
s.RNode(this._xmlNodeTypeToNodeName.get(k.SPACE))],!1);return s.RNode(this._xmlNodeTypeToNodeName.get(k.FORM),[],a)},_createStateNodeRule:function(){var a=s.RList([s.RNode(this._xmlNodeTypeToNodeName.get(k.ID)),s.RNode(this._xmlNodeTypeToNodeName.get(k.TYPE)),s.RNode(this._xmlNodeTypeToNodeName.get(k.VALUE))],!1);return s.RNode(this._xmlNodeTypeToNodeName.get(k.STATE),[],a)},_createActionNodeRule:function(){var a=s.RList([s.RNode(this._xmlNodeTypeToNodeName.get(k.ID)),s.RNode(this._xmlNodeTypeToNodeName.get(k.CONCURRENCY)),
s.RNode(this._xmlNodeTypeToNodeName.get(k.SCRIPTS)),s.ROptional(s.RNode(this._xmlNodeTypeToNodeName.get(k.STATES)))],!1);return s.RNode(this._xmlNodeTypeToNodeName.get(k.ACTION),[],a)},_createSpaceNodeRule:function(){var a=s.ROptional(s.RNode(this._xmlNodeTypeToNodeName.get(k.ENTITIES)));return s.RNode(this._xmlNodeTypeToNodeName.get(k.SPACE),[],a)},_createEntitiesNodeRule:function(){var a=s.RMulti(s.RNode(this._xmlNodeTypeToNodeName.get(k.ENTITY)),!1);return s.RNode(this._xmlNodeTypeToNodeName.get(k.ENTITIES),
[],a)},_createStatesNodeRule:function(){var a=s.RMulti(s.RNode(this._xmlNodeTypeToNodeName.get(k.STATE)),!1);return s.RNode(this._xmlNodeTypeToNodeName.get(k.STATES),[],a)},_createActionsNodeRule:function(){var a=s.RMulti(s.RNode(this._xmlNodeTypeToNodeName.get(k.ACTION)),!1);return s.RNode(this._xmlNodeTypeToNodeName.get(k.ACTIONS),[],a)},_createIdNodeRule:function(){var a=s.RData();return s.RNode(this._xmlNodeTypeToNodeName.get(k.ID),[],a)},_createScriptsNodeRule:function(){var a=s.RMulti(s.RChoice([s.RNode(this._xmlNodeTypeToNodeName.get(k.SCRIPT)),
s.RNode(this._xmlNodeTypeToNodeName.get(k.GML))]),!0);return s.RNode(this._xmlNodeTypeToNodeName.get(k.SCRIPTS),[],a)},_createScriptNodeRule:function(){var a=s.RData();return s.RNode(this._xmlNodeTypeToNodeName.get(k.SCRIPT),[],a)},_createGmlNodeRule:function(){var a=s.RData();return s.RNode(this._xmlNodeTypeToNodeName.get(k.GML),[],a)},_createTriggersNodeRule:function(){var a=s.RMulti(s.RNode(this._xmlNodeTypeToNodeName.get(k.TRIGGER)),!1);return s.RNode(this._xmlNodeTypeToNodeName.get(k.TRIGGERS),
[],a)},_createTriggerNodeRule:function(){var a=s.RList([s.RNode(this._xmlNodeTypeToNodeName.get(k.EVENT)),s.ROptional(s.RNode(this._xmlNodeTypeToNodeName.get(k.PARAMETER))),s.ROptional(s.RNode(this._xmlNodeTypeToNodeName.get(k.TARGET))),s.ROptional(s.RNode(this._xmlNodeTypeToNodeName.get(k.TARGET_TYPE))),s.RNode(this._xmlNodeTypeToNodeName.get(k.SCRIPTS))],!1);return s.RNode(this._xmlNodeTypeToNodeName.get(k.TRIGGER),[],a)},_createParameterNodeRule:function(){var a=s.RData();return s.RNode(this._xmlNodeTypeToNodeName.get(k.PARAMETER),
[],a)},_createTargetNodeRule:function(){var a=s.RData();return s.RNode(this._xmlNodeTypeToNodeName.get(k.TARGET),[],a)},_createTargetTypeNodeRule:function(){var a=s.RData();return s.RNode(this._xmlNodeTypeToNodeName.get(k.TARGET_TYPE),[],a)},_createConcurrencyNodeRule:function(){var a=s.RData(lb.FEnum([this._xmlConcurrencyTypeToName.get(ua.PARALLEL),this._xmlConcurrencyTypeToName.get(ua.PERSISTENT),this._xmlConcurrencyTypeToName.get(ua.TRANSIENT)]));return s.RNode(this._xmlNodeTypeToNodeName.get(k.CONCURRENCY),
[],a)},_createTypeNodeRule:function(){var a=s.RData(lb.FEnum([this._xmlStateTypeToName.get(ca.DYNAMIC),this._xmlStateTypeToName.get(ca.INTEGER),this._xmlStateTypeToName.get(ca.DECIMAL),this._xmlStateTypeToName.get(ca.BOOLEAN),this._xmlStateTypeToName.get(ca.TEXT)]));return s.RNode(this._xmlNodeTypeToNodeName.get(k.TYPE),[],a)},_createValueNodeRule:function(){var a=s.RData();return s.RNode(this._xmlNodeTypeToNodeName.get(k.VALUE),[],a)},_createEventNodeRule:function(){var a=s.RData(lb.FEnum(S.eventTypesStringArray));
return s.RNode(this._xmlNodeTypeToNodeName.get(k.EVENT),[],a)},__class__:Ch};var lf=function(){};h["tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity"]=lf;lf.__name__=!0;lf.__interfaces__=[bd];lf.prototype={__class__:lf,__properties__:{get_children:"get_children"}};var Ge=function(a){this.uid=a;this._init()};h["tools.spark.sliced.services.std.logic.gde.core.GameEntity"]=Ge;Ge.__name__=!0;Ge.__interfaces__=[lf];Ge.__super__=hb;Ge.prototype=v(hb.prototype,{_init:function(){this.gameStateSet=
new D;this.possibleActionSet=new D;this.currentActionSet=new D},doActions:function(){for(var a=this.currentActionSet.iterator();a.hasNext();)for(var b=a.next(),c=0;c<b.length;){var d=b[c];++c;d.doPass()}a=0;for(b=this.gameForm.gameSpace.gameEntitySet;a<b.length;)c=b[a],++a,c.doActions()},addState:function(a){null!=this.gameStateSet.get(a.id)&&w.logger.warn("A State with id "+a.id+" already exists in this Entity.",null);this.gameStateSet.set(a.id,a);a},addAction:function(a){if(null!=this.possibleActionSet.get(a.id))w.logger.warn("An Action with id "+
a.id+" already exists in this Entity.",null);else{var b=[];this.currentActionSet.set(a.id,b);b}this.possibleActionSet.set(a.id,a);a},getAction:function(a){return this.possibleActionSet.get(a)},forceAction:function(a){this.possibleActionSet.get(a).doPass()},startAction:function(a){var b=this.possibleActionSet.get(a);if(null!=b){switch(b.concurrency[1]){case 0:this.currentActionSet.get(b.id).push(b);break;case 1:0==this.currentActionSet.get(b.id).length&&this.currentActionSet.get(b.id).push(b);break;
case 2:for(;0<this.currentActionSet.get(b.id).length;)this.currentActionSet.get(b.id).pop();this.currentActionSet.get(b.id).push(b)}return!0}w.logger.warn("Action with id '"+a+"' could not be started.",null);return!1},stopAction:function(a){if(this.currentActionSet.exists(a)){for(;0<this.currentActionSet.get(a).length;)this.currentActionSet.get(a).pop();return!0}w.logger.warn("Action with id '"+a+"' could not be stopped.",null);return!1},getState:function(a){return null==this.gameStateSet.get(a)?
null:this.gameStateSet.get(a).value},setState:function(a,b){this.gameStateSet.get(a).value=b;B.display.updateDisplayObjectState(this,a);return this.gameStateSet.get(a).value},addToState:function(a,b){this.gameStateSet.get(a).value+=b;B.display.updateDisplayObjectState(this,a);return this.gameStateSet.get(a).value},subtractFromState:function(a,b){this.gameStateSet.get(a).value-=b;B.display.updateDisplayObjectState(this,a);return this.gameStateSet.get(a).value},addChild:function(a){this.get_children().push(a);
a.parentEntity=this;B.display.addDisplayObjectChild(this,a)},insertChild:function(a,b){this.get_children().splice(b,0,a);a.parentEntity=this;B.display.addDisplayObjectChild(this,a)},removeChild:function(a){var b=this.get_children();E.remove(b,a);B.display.removeDisplayObjectChild(this,a)},removeChildren:function(a){null==a&&(a=!1);for(var b=[],c=0,d=this.get_children();c<d.length;){var e=d[c];++c;b.push(e)}a&&b.shift();for(a=0;a<b.length;)c=b[a],++a,this.removeChild(c)},getChildren:function(){return this.get_children()},
get_children:function(){return this.gameForm.gameSpace.gameEntitySet},__class__:Ge,__properties__:v(hb.prototype.__properties__,{get_children:"get_children"})});var Aj=function(){};h["tools.spark.sliced.services.std.logic.gde.interfaces.IGameFactory"]=Aj;Aj.__name__=!0;Aj.prototype={__class__:Aj};var wh=function(){w.logger.info("Creating Game Factory",null);this._init()};h["tools.spark.sliced.services.std.logic.gde.core.GameFactory"]=wh;wh.__name__=!0;wh.__interfaces__=[Aj];wh.prototype={_init:function(){this._gameClassParser=
new Bh},createGameEntityExtended:function(a,b){var c=this._gameClassParser.getGameNode(T.ENTITY,b);c.set("extends",a);return this.createGameEntity(null,c)},createGameEntityByXml:function(a){return this.createGameEntity(null,a)},createGameEntity:function(a,b){var c=this._gameClassParser.getGameNode(T.ENTITY,a,b);if(null!=c){if(this._gameClassParser.parseGameNode(c)){c=this._gameClassParser.instantiateEntity(c);if(null!=c)return c;w.logger.error("Game Entity could not be instantiated",null);return null}w.logger.error("Game Entity could not be parsed",
null);pa.debug(pe.print(c));return null}w.logger.error("Game Entity Class is not well-formed or not found!",null);return null},__class__:wh};var Dh=function(){};h["tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm"]=Dh;Dh.__name__=!0;Dh.__interfaces__=[bd];Dh.prototype={__class__:Dh};var xf=function(){this._init()};h["tools.spark.sliced.services.std.logic.gde.core.GameForm"]=xf;xf.__name__=!0;xf.__interfaces__=[Dh];xf.__super__=hb;xf.prototype=v(hb.prototype,{_init:function(){this.gameStateSet=
new D},addState:function(a){null!=this.gameStateSet.get(a.id)&&w.logger.warn("A State with id "+a.id+" already exists in this Form.",null);this.gameStateSet.set(a.id,a);a},getState:function(a){return null==this.gameStateSet.get(a)?null:this.gameStateSet.get(a).value},setState:function(a,b){this.gameStateSet.get(a).value=b;return this.gameStateSet.get(a).value},__class__:xf});var Eh=function(){};h["tools.spark.sliced.services.std.logic.gde.interfaces.IGameSpace"]=Eh;Eh.__name__=!0;Eh.__interfaces__=
[bd];Eh.prototype={__class__:Eh};var yf=function(){this._init()};h["tools.spark.sliced.services.std.logic.gde.core.GameSpace"]=yf;yf.__name__=!0;yf.__interfaces__=[Eh];yf.__super__=hb;yf.prototype=v(hb.prototype,{_init:function(){this.gameEntitySet=[]},__class__:yf});var Fh=function(){};h["tools.spark.sliced.services.std.logic.gde.interfaces.IGameState"]=Fh;Fh.__name__=!0;Fh.__interfaces__=[bd];Fh.prototype={__class__:Fh};var zf=function(){this._init()};h["tools.spark.sliced.services.std.logic.gde.core.GameState"]=
zf;zf.__name__=!0;zf.__interfaces__=[Fh];zf.__super__=hb;zf.prototype=v(hb.prototype,{_init:function(){},__class__:zf});var Gh=function(){};h["tools.spark.sliced.services.std.logic.gde.interfaces.IGameTrigger"]=Gh;Gh.__name__=!0;Gh.__interfaces__=[bd];Gh.prototype={__class__:Gh};var Af=function(){this._init()};h["tools.spark.sliced.services.std.logic.gde.core.GameTrigger"]=Af;Af.__name__=!0;Af.__interfaces__=[Gh];Af.__super__=hb;Af.prototype=v(hb.prototype,{_init:function(){this.scriptSet=[]},doPass:function(){for(var a=
0,b=this.scriptSet;a<b.length;){var c=b[a];++a;-1==c?B.logic.gmlInterpreter.run(c,function(a){var b=new D;null!=qb["this"]?b.setReserved("this",a):b.h["this"]=a;b.set("me",a.parentEntity);b.set("parent",a.parentEntity.parentEntity);return b}(this)):!1==B.logic.scriptInterpreter.run(c,function(a){var b=new D;null!=qb["this"]?b.setReserved("this",a):b.h["this"]=a;b.set("me",a.parentEntity);b.set("parent",a.parentEntity.parentEntity);return b}(this))&&w.logger.error("Error: Failed to run Trigger ["+
q.string(this.eventType)+"].",null)}},__class__:Af});var ua=h["tools.spark.sliced.services.std.logic.gde.interfaces.EConcurrencyType"]={__ename__:!0,__constructs__:["PARALLEL","PERSISTENT","TRANSIENT"]};ua.PARALLEL=["PARALLEL",0];ua.PARALLEL.toString=j;ua.PARALLEL.__enum__=ua;ua.PERSISTENT=["PERSISTENT",1];ua.PERSISTENT.toString=j;ua.PERSISTENT.__enum__=ua;ua.TRANSIENT=["TRANSIENT",2];ua.TRANSIENT.toString=j;ua.TRANSIENT.__enum__=ua;ua.__empty_constructs__=[ua.PARALLEL,ua.PERSISTENT,ua.TRANSIENT];
var n=h["tools.spark.sliced.services.std.logic.gde.interfaces.EEventType"]={__ename__:!0,__constructs__:"CREATED,UPDATE,CHANGED,NETWORK_CONNECTED,NETWORK_REQUEST,NETWORK_SERVER_EVENT,FILETRANSFER_CONNECTED,FILETRANSFER_SENDREQUEST,MOUSE_LEFT_CLICK,MOUSE_RIGHT_CLICK,MOUSE_LEFT_DOWN,MOUSE_RIGHT_DOWN,MOUSE_SCROLL,MOUSE_ENTERED,MOUSE_MOVED,MOUSE_LEFT,MOUSE_DOWN,MOUSE_UP,PHYSICS_COLLISION_START,PHYSICS_COLLISION_END,PHYSICS_SENSOR_START,PHYSICS_SENSOR_START_BIPED_FEET,PHYSICS_SENSOR_END,PHYSICS_SENSOR_END_BIPED_FEET,ON_DRAG_START,ON_DRAG,ON_DRAG_END,ON_DRAG_ENTER,ON_DRAG_OVER,ON_DRAG_LEAVE,ON_DROP,KEY_PRESSED_LOCAL,KEY_RELEASED_LOCAL,KEY_DOWN_LOCAL,KEY_PRESSED,KEY_RELEASED".split(",")};
n.CREATED=["CREATED",0];n.CREATED.toString=j;n.CREATED.__enum__=n;n.UPDATE=["UPDATE",1];n.UPDATE.toString=j;n.UPDATE.__enum__=n;n.CHANGED=["CHANGED",2];n.CHANGED.toString=j;n.CHANGED.__enum__=n;n.NETWORK_CONNECTED=["NETWORK_CONNECTED",3];n.NETWORK_CONNECTED.toString=j;n.NETWORK_CONNECTED.__enum__=n;n.NETWORK_REQUEST=["NETWORK_REQUEST",4];n.NETWORK_REQUEST.toString=j;n.NETWORK_REQUEST.__enum__=n;n.NETWORK_SERVER_EVENT=["NETWORK_SERVER_EVENT",5];n.NETWORK_SERVER_EVENT.toString=j;n.NETWORK_SERVER_EVENT.__enum__=
n;n.FILETRANSFER_CONNECTED=["FILETRANSFER_CONNECTED",6];n.FILETRANSFER_CONNECTED.toString=j;n.FILETRANSFER_CONNECTED.__enum__=n;n.FILETRANSFER_SENDREQUEST=["FILETRANSFER_SENDREQUEST",7];n.FILETRANSFER_SENDREQUEST.toString=j;n.FILETRANSFER_SENDREQUEST.__enum__=n;n.MOUSE_LEFT_CLICK=["MOUSE_LEFT_CLICK",8];n.MOUSE_LEFT_CLICK.toString=j;n.MOUSE_LEFT_CLICK.__enum__=n;n.MOUSE_RIGHT_CLICK=["MOUSE_RIGHT_CLICK",9];n.MOUSE_RIGHT_CLICK.toString=j;n.MOUSE_RIGHT_CLICK.__enum__=n;n.MOUSE_LEFT_DOWN=["MOUSE_LEFT_DOWN",
10];n.MOUSE_LEFT_DOWN.toString=j;n.MOUSE_LEFT_DOWN.__enum__=n;n.MOUSE_RIGHT_DOWN=["MOUSE_RIGHT_DOWN",11];n.MOUSE_RIGHT_DOWN.toString=j;n.MOUSE_RIGHT_DOWN.__enum__=n;n.MOUSE_SCROLL=["MOUSE_SCROLL",12];n.MOUSE_SCROLL.toString=j;n.MOUSE_SCROLL.__enum__=n;n.MOUSE_ENTERED=["MOUSE_ENTERED",13];n.MOUSE_ENTERED.toString=j;n.MOUSE_ENTERED.__enum__=n;n.MOUSE_MOVED=["MOUSE_MOVED",14];n.MOUSE_MOVED.toString=j;n.MOUSE_MOVED.__enum__=n;n.MOUSE_LEFT=["MOUSE_LEFT",15];n.MOUSE_LEFT.toString=j;n.MOUSE_LEFT.__enum__=
n;n.MOUSE_DOWN=["MOUSE_DOWN",16];n.MOUSE_DOWN.toString=j;n.MOUSE_DOWN.__enum__=n;n.MOUSE_UP=["MOUSE_UP",17];n.MOUSE_UP.toString=j;n.MOUSE_UP.__enum__=n;n.PHYSICS_COLLISION_START=["PHYSICS_COLLISION_START",18];n.PHYSICS_COLLISION_START.toString=j;n.PHYSICS_COLLISION_START.__enum__=n;n.PHYSICS_COLLISION_END=["PHYSICS_COLLISION_END",19];n.PHYSICS_COLLISION_END.toString=j;n.PHYSICS_COLLISION_END.__enum__=n;n.PHYSICS_SENSOR_START=["PHYSICS_SENSOR_START",20];n.PHYSICS_SENSOR_START.toString=j;n.PHYSICS_SENSOR_START.__enum__=
n;n.PHYSICS_SENSOR_START_BIPED_FEET=["PHYSICS_SENSOR_START_BIPED_FEET",21];n.PHYSICS_SENSOR_START_BIPED_FEET.toString=j;n.PHYSICS_SENSOR_START_BIPED_FEET.__enum__=n;n.PHYSICS_SENSOR_END=["PHYSICS_SENSOR_END",22];n.PHYSICS_SENSOR_END.toString=j;n.PHYSICS_SENSOR_END.__enum__=n;n.PHYSICS_SENSOR_END_BIPED_FEET=["PHYSICS_SENSOR_END_BIPED_FEET",23];n.PHYSICS_SENSOR_END_BIPED_FEET.toString=j;n.PHYSICS_SENSOR_END_BIPED_FEET.__enum__=n;n.ON_DRAG_START=["ON_DRAG_START",24];n.ON_DRAG_START.toString=j;n.ON_DRAG_START.__enum__=
n;n.ON_DRAG=["ON_DRAG",25];n.ON_DRAG.toString=j;n.ON_DRAG.__enum__=n;n.ON_DRAG_END=["ON_DRAG_END",26];n.ON_DRAG_END.toString=j;n.ON_DRAG_END.__enum__=n;n.ON_DRAG_ENTER=["ON_DRAG_ENTER",27];n.ON_DRAG_ENTER.toString=j;n.ON_DRAG_ENTER.__enum__=n;n.ON_DRAG_OVER=["ON_DRAG_OVER",28];n.ON_DRAG_OVER.toString=j;n.ON_DRAG_OVER.__enum__=n;n.ON_DRAG_LEAVE=["ON_DRAG_LEAVE",29];n.ON_DRAG_LEAVE.toString=j;n.ON_DRAG_LEAVE.__enum__=n;n.ON_DROP=["ON_DROP",30];n.ON_DROP.toString=j;n.ON_DROP.__enum__=n;n.KEY_PRESSED_LOCAL=
["KEY_PRESSED_LOCAL",31];n.KEY_PRESSED_LOCAL.toString=j;n.KEY_PRESSED_LOCAL.__enum__=n;n.KEY_RELEASED_LOCAL=["KEY_RELEASED_LOCAL",32];n.KEY_RELEASED_LOCAL.toString=j;n.KEY_RELEASED_LOCAL.__enum__=n;n.KEY_DOWN_LOCAL=["KEY_DOWN_LOCAL",33];n.KEY_DOWN_LOCAL.toString=j;n.KEY_DOWN_LOCAL.__enum__=n;n.KEY_PRESSED=["KEY_PRESSED",34];n.KEY_PRESSED.toString=j;n.KEY_PRESSED.__enum__=n;n.KEY_RELEASED=["KEY_RELEASED",35];n.KEY_RELEASED.toString=j;n.KEY_RELEASED.__enum__=n;n.__empty_constructs__=[n.CREATED,n.UPDATE,
n.CHANGED,n.NETWORK_CONNECTED,n.NETWORK_REQUEST,n.NETWORK_SERVER_EVENT,n.FILETRANSFER_CONNECTED,n.FILETRANSFER_SENDREQUEST,n.MOUSE_LEFT_CLICK,n.MOUSE_RIGHT_CLICK,n.MOUSE_LEFT_DOWN,n.MOUSE_RIGHT_DOWN,n.MOUSE_SCROLL,n.MOUSE_ENTERED,n.MOUSE_MOVED,n.MOUSE_LEFT,n.MOUSE_DOWN,n.MOUSE_UP,n.PHYSICS_COLLISION_START,n.PHYSICS_COLLISION_END,n.PHYSICS_SENSOR_START,n.PHYSICS_SENSOR_START_BIPED_FEET,n.PHYSICS_SENSOR_END,n.PHYSICS_SENSOR_END_BIPED_FEET,n.ON_DRAG_START,n.ON_DRAG,n.ON_DRAG_END,n.ON_DRAG_ENTER,n.ON_DRAG_OVER,
n.ON_DRAG_LEAVE,n.ON_DROP,n.KEY_PRESSED_LOCAL,n.KEY_RELEASED_LOCAL,n.KEY_DOWN_LOCAL,n.KEY_PRESSED,n.KEY_RELEASED];var T=h["tools.spark.sliced.services.std.logic.gde.interfaces.EGameType"]={__ename__:!0,__constructs__:"ENTITY,FORM,STATE,SPACE,ACTION,TRIGGER".split(",")};T.ENTITY=["ENTITY",0];T.ENTITY.toString=j;T.ENTITY.__enum__=T;T.FORM=["FORM",1];T.FORM.toString=j;T.FORM.__enum__=T;T.STATE=["STATE",2];T.STATE.toString=j;T.STATE.__enum__=T;T.SPACE=["SPACE",3];T.SPACE.toString=j;T.SPACE.__enum__=T;
T.ACTION=["ACTION",4];T.ACTION.toString=j;T.ACTION.__enum__=T;T.TRIGGER=["TRIGGER",5];T.TRIGGER.toString=j;T.TRIGGER.__enum__=T;T.__empty_constructs__=[T.ENTITY,T.FORM,T.STATE,T.SPACE,T.ACTION,T.TRIGGER];var k=h["tools.spark.sliced.services.std.logic.gde.interfaces.ENodeType"]={__ename__:!0,__constructs__:"ENTITIES,ENTITY,FORM,STATES,STATE,SPACE,ACTIONS,ACTION,SCRIPTS,SCRIPT,GML,TRIGGERS,TRIGGER,EVENT,PARAMETER,TARGET,TARGET_TYPE,CONCURRENCY,ID,TYPE,VALUE,EXTENDS".split(",")};k.ENTITIES=["ENTITIES",
0];k.ENTITIES.toString=j;k.ENTITIES.__enum__=k;k.ENTITY=["ENTITY",1];k.ENTITY.toString=j;k.ENTITY.__enum__=k;k.FORM=["FORM",2];k.FORM.toString=j;k.FORM.__enum__=k;k.STATES=["STATES",3];k.STATES.toString=j;k.STATES.__enum__=k;k.STATE=["STATE",4];k.STATE.toString=j;k.STATE.__enum__=k;k.SPACE=["SPACE",5];k.SPACE.toString=j;k.SPACE.__enum__=k;k.ACTIONS=["ACTIONS",6];k.ACTIONS.toString=j;k.ACTIONS.__enum__=k;k.ACTION=["ACTION",7];k.ACTION.toString=j;k.ACTION.__enum__=k;k.SCRIPTS=["SCRIPTS",8];k.SCRIPTS.toString=
j;k.SCRIPTS.__enum__=k;k.SCRIPT=["SCRIPT",9];k.SCRIPT.toString=j;k.SCRIPT.__enum__=k;k.GML=["GML",10];k.GML.toString=j;k.GML.__enum__=k;k.TRIGGERS=["TRIGGERS",11];k.TRIGGERS.toString=j;k.TRIGGERS.__enum__=k;k.TRIGGER=["TRIGGER",12];k.TRIGGER.toString=j;k.TRIGGER.__enum__=k;k.EVENT=["EVENT",13];k.EVENT.toString=j;k.EVENT.__enum__=k;k.PARAMETER=["PARAMETER",14];k.PARAMETER.toString=j;k.PARAMETER.__enum__=k;k.TARGET=["TARGET",15];k.TARGET.toString=j;k.TARGET.__enum__=k;k.TARGET_TYPE=["TARGET_TYPE",16];
k.TARGET_TYPE.toString=j;k.TARGET_TYPE.__enum__=k;k.CONCURRENCY=["CONCURRENCY",17];k.CONCURRENCY.toString=j;k.CONCURRENCY.__enum__=k;k.ID=["ID",18];k.ID.toString=j;k.ID.__enum__=k;k.TYPE=["TYPE",19];k.TYPE.toString=j;k.TYPE.__enum__=k;k.VALUE=["VALUE",20];k.VALUE.toString=j;k.VALUE.__enum__=k;k.EXTENDS=["EXTENDS",21];k.EXTENDS.toString=j;k.EXTENDS.__enum__=k;k.__empty_constructs__=[k.ENTITIES,k.ENTITY,k.FORM,k.STATES,k.STATE,k.SPACE,k.ACTIONS,k.ACTION,k.SCRIPTS,k.SCRIPT,k.GML,k.TRIGGERS,k.TRIGGER,
k.EVENT,k.PARAMETER,k.TARGET,k.TARGET_TYPE,k.CONCURRENCY,k.ID,k.TYPE,k.VALUE,k.EXTENDS];var ca=h["tools.spark.sliced.services.std.logic.gde.interfaces.EStateType"]={__ename__:!0,__constructs__:["DYNAMIC","INTEGER","DECIMAL","BOOLEAN","TEXT"]};ca.DYNAMIC=["DYNAMIC",0];ca.DYNAMIC.toString=j;ca.DYNAMIC.__enum__=ca;ca.INTEGER=["INTEGER",1];ca.INTEGER.toString=j;ca.INTEGER.__enum__=ca;ca.DECIMAL=["DECIMAL",2];ca.DECIMAL.toString=j;ca.DECIMAL.__enum__=ca;ca.BOOLEAN=["BOOLEAN",3];ca.BOOLEAN.toString=j;ca.BOOLEAN.__enum__=
ca;ca.TEXT=["TEXT",4];ca.TEXT.toString=j;ca.TEXT.__enum__=ca;ca.__empty_constructs__=[ca.DYNAMIC,ca.INTEGER,ca.DECIMAL,ca.BOOLEAN,ca.TEXT];var S=function(){};h["tools.spark.sliced.services.std.logic.gde.interfaces.EventType"]=S;S.__name__=!0;S.init=function(){S.eventTypesMap=new na;S.eventTypesMapReverse=new D;S.eventTypesStringArray=[];S.keyboardStringToKey=new D;S.eventTypesMap.set(n.CREATED,"Created");"Created";S.eventTypesMap.set(n.UPDATE,"Update");"Update";S.eventTypesMap.set(n.CHANGED,"Changed");
"Changed";S.eventTypesMap.set(n.NETWORK_CONNECTED,"NetworkConnected");"NetworkConnected";S.eventTypesMap.set(n.NETWORK_REQUEST,"NetworkRequest");"NetworkRequest";S.eventTypesMap.set(n.NETWORK_SERVER_EVENT,"NetworkServerEvent");"NetworkServerEvent";S.eventTypesMap.set(n.FILETRANSFER_CONNECTED,"FileTransferConnected");"FileTransferConnected";S.eventTypesMap.set(n.FILETRANSFER_SENDREQUEST,"FileTransferRequest");"FileTransferRequest";S.eventTypesMap.set(n.MOUSE_LEFT_CLICK,"MouseLeftClick");"MouseLeftClick";
S.eventTypesMap.set(n.MOUSE_RIGHT_CLICK,"MouseRightClick");"MouseRightClick";S.eventTypesMap.set(n.MOUSE_LEFT_DOWN,"MouseLeftDown");"MouseLeftDown";S.eventTypesMap.set(n.MOUSE_RIGHT_DOWN,"MouseRightDown");"MouseRightDown";S.eventTypesMap.set(n.MOUSE_SCROLL,"MouseScroll");"MouseScroll";S.eventTypesMap.set(n.MOUSE_ENTERED,"MouseEntered");"MouseEntered";S.eventTypesMap.set(n.MOUSE_MOVED,"MouseMoved");"MouseMoved";S.eventTypesMap.set(n.MOUSE_LEFT,"MouseLeft");"MouseLeft";S.eventTypesMap.set(n.MOUSE_DOWN,
"MouseDown");"MouseDown";S.eventTypesMap.set(n.MOUSE_UP,"MouseUp");"MouseUp";S.eventTypesMap.set(n.PHYSICS_COLLISION_START,"PhysicsCollisionStart");"PhysicsCollisionStart";S.eventTypesMap.set(n.PHYSICS_COLLISION_END,"PhysicsCollisionEnd");"PhysicsCollisionEnd";S.eventTypesMap.set(n.PHYSICS_SENSOR_START,"PhysicsSensorStart");"PhysicsSensorStart";S.eventTypesMap.set(n.PHYSICS_SENSOR_START_BIPED_FEET,"PhysicsSensorStartBipedFeet");"PhysicsSensorStartBipedFeet";S.eventTypesMap.set(n.PHYSICS_SENSOR_END,
"PhysicsSensorEnd");"PhysicsSensorEnd";S.eventTypesMap.set(n.PHYSICS_SENSOR_END_BIPED_FEET,"PhysicsSensorEndBipedFeet");"PhysicsSensorEndBipedFeet";S.eventTypesMap.set(n.ON_DRAG_START,"OnDragStart");"OnDragStart";S.eventTypesMap.set(n.ON_DRAG,"OnDrag");"OnDrag";S.eventTypesMap.set(n.ON_DRAG_END,"OnDragEnd");"OnDragEnd";S.eventTypesMap.set(n.ON_DRAG_ENTER,"OnDragEnter");"OnDragEnter";S.eventTypesMap.set(n.ON_DRAG_OVER,"OnDragOver");"OnDragOver";S.eventTypesMap.set(n.ON_DRAG_LEAVE,"OnDragLeave");"OnDragLeave";
S.eventTypesMap.set(n.ON_DROP,"OnDrop");"OnDrop";S.eventTypesMap.set(n.KEY_PRESSED_LOCAL,"KeyPressedLocal");"KeyPressedLocal";S.eventTypesMap.set(n.KEY_RELEASED_LOCAL,"KeyReleasedLocal");"KeyReleasedLocal";S.eventTypesMap.set(n.KEY_DOWN_LOCAL,"KeyDownLocal");"KeyDownLocal";S.eventTypesMap.set(n.KEY_PRESSED,"KeyPressed");"KeyPressed";S.eventTypesMap.set(n.KEY_RELEASED,"KeyReleased");"KeyReleased";for(var a=S.eventTypesMap.keys();a.hasNext();){var b=a.next(),c=S.eventTypesMap.get(b);S.eventTypesMapReverse.set(c,
b);b}for(a=S.eventTypesMap.iterator();a.hasNext();)b=a.next(),S.eventTypesStringArray.push(b);a=0;for(b=Ua.allEnums(g);a<b.length;)c=b[a],++a,S.keyboardStringToKey.set(c[0],c),c};var Hh=function(){};h["tools.spark.sliced.services.std.logic.interpreter.interfaces.IInterpreter"]=Hh;Hh.__name__=!0;Hh.prototype={__class__:Hh};var yh=function(){w.logger.info("Init Gml Interpreter...",null);this._init()};h["tools.spark.sliced.services.std.logic.interpreter.core.GmlInterpreter"]=yh;yh.__name__=!0;yh.__interfaces__=
[Hh];yh.prototype={_init:function(){this._hashTable=new hd},run:function(a,b){this._deleteMeCircleAround(null!=qb.me?b.getReserved("me"):b.h.me);return!0},_deleteMeCircleAround:function(a){null!=a.getState("std_object")&&(a.setState("std_x",a.getState("initX")+50*Math.cos(a.getState("rotationDegree"))),a.getState("std_object").x=a.getState("std_x"),a.setState("std_y",a.getState("initY")+50*Math.sin(a.getState("rotationDegree"))),a.getState("std_object").y=a.getState("std_y"),a.setState("rotationDegree",
a.getState("rotationDegree")+0.1))},hash:function(){return-1},__class__:yh};var xh=function(){w.logger.info("Init Haxe Interpreter...",null);this._init()};h["tools.spark.sliced.services.std.logic.interpreter.core.HaxeInterpreter"]=xh;xh.__name__=!0;xh.__interfaces__=[Hh];xh.prototype={_init:function(){q.random(1);this._hashTable=new hd;this._parser=new Ci;this._interpreter=new Bj;this._interpreter.variables.set("Game",B);this._interpreter.variables.set("Sound",B.sound);this._interpreter.variables.set("Logic",
B.logic);this._interpreter.variables.set("Input",B.input);this._interpreter.variables.set("Comms",B.comms);this._interpreter.variables.set("Event",B.event);this._interpreter.variables.set("Display",B.display);this._interpreter.variables.set("Key",g);this._interpreter.variables.set("Console",pa);this._interpreter.variables.set("Math",Math);this._interpreter.variables.set("Std",q);this._interpreter.variables.set("String",String);this._interpreter.variables.set("Assets",R);this._interpreter.variables.set("Xml",
o);this._interpreter.variables.set("Fast",Mb);this._interpreter.variables.set("StringTools",Ja);this._interpreter.variables.set("EReg",cc);this._interpreter.variables.set("MouseButton",sa);this._interpreter.variables.set("StringMap",D);this._interpreter.variables.set("IntMap",hd);this._interpreter.variables.set("ObjectMap",Qa);this._interpreter.variables.set("XMLHttpRequest",XMLHttpRequest)},run:function(a,b){for(var c=this._get(a),d=b.keys();d.hasNext();){var e=d.next();this._interpreter.setVariableSafe(e,
null!=qb[e]?b.getReserved(e):b.h[e])}try{return this._interpreter.execute(c),!0}catch(i){return i instanceof p&&(i=i.val),w.logger.error("<<<<<SPARK SCRIPT RUN-TIME ERROR>>>>>: "+q.string(i),null),!1}},hash:function(a){try{return this._store(this._parser.parseString(a),si.make(vc.ofString(a)))}catch(b){return b instanceof p&&(b=b.val),w.logger.error("<<<<<SPARK SCRIPT PARSING ERROR [Line: "+this._parser.line+"]>>>>>: "+q.string(b),null),w.logger.error("Stack: "+a,null),this._store(this._parser.parseString("Display.error('This script failed to parse. Look at stack above.'); CouldNotParseScript;"),
si.make(vc.ofString("Display.error('This script failed to parse. Look at stack above.'); CouldNotParseScript;")))}},_get:function(a){var b=this._hashTable.h[a];null==b&&w.logger.error("Script not found on address ["+a+"]",null);return b},_store:function(a,b){if(null!=this._hashTable.h[b]){if(q.string(a)==q.string(this._hashTable.h[b]))return b;pa.warn("Collision detected with hashId: ["+b+"] and script ["+q.string(a)+"]. Previous Stored Entry Script: "+q.string(this._hashTable.h[b]));return this._store(a,
++b)}this._hashTable.h[b]=a;a;return b},__class__:xh};var $a=h["tools.spark.sliced.services.std.logic.interpreter.core._Interp.Stop"]={__ename__:!0,__constructs__:["SBreak","SContinue","SReturn"]};$a.SBreak=["SBreak",0];$a.SBreak.toString=j;$a.SBreak.__enum__=$a;$a.SContinue=["SContinue",1];$a.SContinue.toString=j;$a.SContinue.__enum__=$a;$a.SReturn=function(a){a=["SReturn",2,a];a.__enum__=$a;a.toString=j;return a};$a.__empty_constructs__=[$a.SBreak,$a.SContinue];var Bj=function(){this.variables=
new D;this.locals=new D;this._instances=0;this._depthHistory=[];this._localsHistory=[];this._declaredHistory=[];this._meHistory=[];this._parentHistory=[];this._thisHistory=[];this.variables.set("null",null);this.variables.set("true",!0);this.variables.set("false",!1);this.variables.set("trace",function(a){Wj.trace(q.string(a),{fileName:"hscript",lineNumber:0})});this.initOps()};h["tools.spark.sliced.services.std.logic.interpreter.core.Interp"]=Bj;Bj.__name__=!0;Bj.prototype={initOps:function(){var a=
this;this.binops=new D;this.binops.set("+",function(b,c){return a.expr(b)+a.expr(c)});this.binops.set("-",function(b,c){return a.expr(b)-a.expr(c)});this.binops.set("*",function(b,c){return a.expr(b)*a.expr(c)});this.binops.set("/",function(b,c){return a.expr(b)/a.expr(c)});this.binops.set("%",function(b,c){return a.expr(b)%a.expr(c)});this.binops.set("&",function(b,c){return a.expr(b)&a.expr(c)});this.binops.set("|",function(b,c){return a.expr(b)|a.expr(c)});this.binops.set("^",function(b,c){return a.expr(b)^
a.expr(c)});this.binops.set("<<",function(b,c){return a.expr(b)<<a.expr(c)});this.binops.set(">>",function(b,c){return a.expr(b)>>a.expr(c)});this.binops.set(">>>",function(b,c){return a.expr(b)>>>a.expr(c)});this.binops.set("==",function(b,c){return a.expr(b)==a.expr(c)});this.binops.set("!=",function(b,c){return a.expr(b)!=a.expr(c)});this.binops.set(">=",function(b,c){return a.expr(b)>=a.expr(c)});this.binops.set("<=",function(b,c){return a.expr(b)<=a.expr(c)});this.binops.set(">",function(b,c){return a.expr(b)>
a.expr(c)});this.binops.set("<",function(b,c){return a.expr(b)<a.expr(c)});this.binops.set("||",function(b,c){return!0==a.expr(b)||!0==a.expr(c)});this.binops.set("&&",function(b,c){return!0==a.expr(b)&&!0==a.expr(c)});this.binops.set("=",y(this,this.assign));this.binops.set("...",function(b,c){return new Rh(a.expr(b),a.expr(c))});this.assignOp("+=",function(a,c){return a+c});this.assignOp("-=",function(a,c){return a-c});this.assignOp("*=",function(a,c){return a*c});this.assignOp("/=",function(a,
c){return a/c});this.assignOp("%=",function(a,c){return a%c});this.assignOp("&=",function(a,c){return a&c});this.assignOp("|=",function(a,c){return a|c});this.assignOp("^=",function(a,c){return a^c});this.assignOp("<<=",function(a,c){return a<<c});this.assignOp(">>=",function(a,c){return a>>c});this.assignOp(">>>=",function(a,c){return a>>>c})},assign:function(a,b){var c=this.expr(b);switch(a[1]){case 1:var d=a[2],e=this.locals.get(d);null==e?this.variables.set(d,c):e.r=c;break;case 5:d=a[3];c=this.set(this.expr(a[2]),
d,c);break;case 16:d=a[3];this.expr(a[2])[this.expr(d)]=c;break;default:this.error(V.EInvalidOp("="))}return c},assignOp:function(a,b){var c=this;this.binops.set(a,function(d,e){return c.evalAssignOp(a,b,d,e)})},evalAssignOp:function(a,b,c,d){switch(c[1]){case 1:var a=c[2],e=this.locals.get(a),b=b(this.expr(c),this.expr(d));null==e?this.variables.set(a,b):e.r=b;break;case 5:a=c[3];c=this.expr(c[2]);b=b(this.get(c,a),this.expr(d));b=this.set(c,a,b);break;case 16:a=c[3];c=this.expr(c[2]);a=this.expr(a);
b=b(c[a],this.expr(d));c[a]=b;break;default:return this.error(V.EInvalidOp(a))}return b},increment:function(a,b,c){switch(a[1]){case 1:var d=a[2],a=this.locals.get(d),e;e=null==a?this.variables.get(d):a.r;b?(e+=c,null==a?this.variables.set(d,e):a.r=e):null==a?this.variables.set(d,e+c):a.r=e+c;return e;case 5:return d=a[3],a=this.expr(a[2]),e=this.get(a,d),b?(e+=c,this.set(a,d,e)):this.set(a,d,e+c),e;case 16:return e=a[3],d=this.expr(a[2]),a=this.expr(e),e=d[a],b?(e+=c,d[a]=e):d[a]=e+c,e;default:return this.error(V.EInvalidOp(0<
c?"++":"--"))}},setVariableSafe:function(a,b){0<this._instances&&("me"==a?this._meHistory.push(this.variables.get(a)):"parent"==a?this._parentHistory.push(this.variables.get(a)):"this"==a&&this._thisHistory.push(this.variables.get(a)));this.variables.set(a,b)},execute:function(a){this._instances+=1;1==this._instances?(this.depth=0,this.locals=new D,this.declared=[]):(this._depthHistory.push(this.depth),this._localsHistory.push(this.locals),this._declaredHistory.push(this.declared));a=this.exprReturn(a);
this._instances-=1;0<this._instances&&(this.depth=this._depthHistory.pop(),this.locals=this._localsHistory.pop(),this.declared=this._declaredHistory.pop(),this.variables.set("me",this._meHistory.pop()),this.variables.set("parent",this._parentHistory.pop()),this.variables.set("target",this._thisHistory.pop()));return a},exprReturn:function(a){try{return this.expr(a)}catch(b){if(b instanceof p&&(b=b.val),A.__instanceof(b,$a))switch(b[1]){case 0:throw new p("Invalid break");case 1:throw new p("Invalid continue");
case 2:return b[2]}else throw b;}return null},duplicate:function(a){for(var b=new D,c=a.keys();c.hasNext();){var d=c.next(),e;e=null!=qb[d]?a.getReserved(d):a.h[d];null!=qb[d]?b.setReserved(d,e):b.h[d]=e}return b},restore:function(a){for(;this.declared.length>a;){var b=this.declared.pop();this.locals.set(b.n,b.old)}},error:function(a){throw new p(a);},resolve:function(a){var b=this.locals.get(a);if(null!=b)return b.r;b=this.variables.get(a);null==b&&!this.variables.exists(a)&&this.error(V.EUnknownVariable(a));
return b},expr:function(a){var b=this;switch(a[1]){case 0:a=a[2];switch(a[1]){case 0:return a[2];case 1:return a[2];case 2:return a[2]}break;case 1:return this.resolve(a[2]);case 2:var c=a[4],a=a[2];this.declared.push({n:a,old:this.locals.get(a)});c={r:null==c?null:this.expr(c)};this.locals.set(a,c);break;case 3:return this.expr(a[2]);case 4:for(var a=a[2],c=this.declared.length,d=null,e=0;e<a.length;)d=a[e],++e,d=this.expr(d);this.restore(c);return d;case 5:return c=a[3],this.get(this.expr(a[2]),
c);case 6:return c=a[4],e=a[3],a=a[2],d=this.binops.get(a),null==d&&this.error(V.EInvalidOp(a)),d(e,c);case 7:c=a[4];e=a[3];a=a[2];switch(a){case "!":return!0!=this.expr(c);case "-":return-this.expr(c);case "++":return this.increment(c,e,1);case "--":return this.increment(c,e,-1);case "~":return~this.expr(c);default:this.error(V.EInvalidOp(a))}break;case 8:c=a[3];e=a[2];a=[];for(d=0;d<c.length;){var i=c[d];++d;a.push(this.expr(i))}switch(e[1]){case 5:return c=e[3],e=this.expr(e[2]),null==e&&this.error(V.EInvalidAccess(c)),
this.fcall(e,c,a);default:return this.call(null,this.expr(e),a)}case 9:c=a[4];e=a[3];if(!0==this.expr(a[2]))return this.expr(e);if(null==c)break;else return this.expr(c);case 10:this.whileLoop(a[2],a[3]);break;case 11:this.forLoop(a[2],a[3],a[4]);break;case 12:throw new p($a.SBreak);case 13:throw new p($a.SContinue);case 15:throw a=a[2],new p($a.SReturn(null==a?null:this.expr(a)));case 14:for(var f=a[4],g=a[3],h=a[2],j=this.duplicate(this.locals),k=this,l=0,a=0;a<h.length;)c=h[a],++a,c.opt||l++;a=
Q.makeVarArgs(function(a){if(a.length!=h.length){if(a.length<l)throw a="Invalid number of parameters. Got "+a.length+", required "+l,null!=f&&(a+=" for function '"+f+"'"),new p(a);for(var c=[],d=a.length-l,e=0,i=0;i<h.length;){var n=h[i];++i;n.opt?0<d?(c.push(a[e++]),d--):c.push(null):c.push(a[e++])}a=c}c=k.locals;d=k.depth;k.depth++;k.locals=k.duplicate(j);e=0;for(i=h.length;e<i;)n=e++,k.locals.set(h[n].name,{r:a[n]});a=null;if(b.inTry)try{a=k.exprReturn(g)}catch(o){throw o instanceof p&&(o=o.val),
k.locals=c,k.depth=d,new p(o);}else a=k.exprReturn(g);k.locals=c;k.depth=d;return a});null!=f&&(0==this.depth?this.variables.set(f,a):(this.declared.push({n:f,old:this.locals.get(f)}),c={r:a},this.locals.set(f,c),null!=qb[f]?j.setReserved(f,c):j.h[f]=c));return a;case 17:a=a[2];c=[];for(e=0;e<a.length;)d=a[e],++e,c.push(this.expr(d));return c;case 16:return c=a[3],this.expr(a[2])[this.expr(c)];case 18:c=a[3];a=a[2];e=[];for(d=0;d<c.length;)i=c[d],++d,e.push(this.expr(i));return this.cnew(a,e);case 19:throw new p(this.expr(a[2]));
case 20:var c=a[5],e=a[3],n=a[2],a=this.declared.length,d=this.inTry;try{return this.inTry=!0,i=this.expr(n),this.restore(a),this.inTry=d,i}catch(o){o instanceof p&&(o=o.val);if(A.__instanceof(o,$a))throw this.inTry=d,new p(o);i=o;this.restore(a);this.inTry=d;this.declared.push({n:e,old:this.locals.get(e)});this.locals.set(e,{r:i});c=this.expr(c);this.restore(a);return c}case 21:a=a[2];c={};for(e=0;e<a.length;)d=a[e],++e,this.set(c,d.name,this.expr(d.e));return c;case 22:return c=a[4],e=a[3],!0==
this.expr(a[2])?this.expr(e):this.expr(c);case 23:c=a[4];e=a[3];a=this.expr(a[2]);d=!1;for(i=0;i<e.length;){n=e[i];++i;for(var t=0,q=n.values;t<q.length;){var u=q[t];++t;if(this.expr(u)==a){d=!0;break}}if(d){a=this.expr(n.expr);break}}d||(a=null==c?null:this.expr(c));return a}return null},whileLoop:function(a,b){var c=this.declared.length;try{for(;!0==this.expr(a);)try{this.expr(b)}catch(d){if(d instanceof p&&(d=d.val),A.__instanceof(d,$a))switch(d[1]){case 0:throw"__break__";case 2:throw new p(d);
}else throw d;}}catch(e){if("__break__"!=e)throw e;}this.restore(c)},makeIterator:function(a){try{a=Oj(a)()}catch(b){b instanceof p&&(b=b.val)}(null==a.hasNext||null==a.next)&&this.error(V.EInvalidIterator(a));return a},forLoop:function(a,b,c){var d=this.declared.length;this.declared.push({n:a,old:this.locals.get(a)});b=this.makeIterator(this.expr(b));try{for(;b.hasNext();){var e={r:b.next()};this.locals.set(a,e);try{this.expr(c)}catch(i){if(i instanceof p&&(i=i.val),A.__instanceof(i,$a))switch(i[1]){case 0:throw"__break__";
case 2:throw new p(i);}else throw i;}}}catch(f){if("__break__"!=f)throw f;}this.restore(d)},get:function(a,b){null==a&&this.error(V.EInvalidAccess(b));return Q.field(a,b)},set:function(a,b,c){null==a&&this.error(V.EInvalidAccess(b));return a[b]=c},fcall:function(a,b,c){return this.call(a,Q.field(a,b),c)},call:function(a,b,c){return Q.callMethod(a,b,c)},cnew:function(a,b){var c=Ua.resolveClass(a);null==c&&(c=this.resolve(a));return Ua.createInstance(c,b)},__class__:Bj};var Ih=function(){this._init()};
h["tools.spark.sliced.services.std.sound.core.Sound"]=Ih;Ih.__name__=!0;Ih.__interfaces__=[pk];Ih.__super__=Ea;Ih.prototype=v(Ea.prototype,{_init:function(){w.logger.info("Init Sound std Service...",null)},playSound:function(a,b){return R.getSound(a).play(b)},loopSound:function(a,b){return R.getSound(a).loop(b)},__class__:Ih});var Jc=function(){this.body=this.constraint=null;this.pre_swapped=!1;this.int1=this.int2=this.set=this.wrap_arbiters=this.pre_arbiter=null;this.length=0;this.listener=this.next=
this.prev=null;this.event=0;this.outer_body=this.outer_con=this.outer_int=null;this.length=0};h["zpp_nape.callbacks.ZPP_Callback"]=Jc;Jc.__name__=!0;Jc.prototype={wrapper_body:function(){null==this.outer_body&&(this.outer_body=new fg,this.outer_body.zpp_inner=this);return this.outer_body},wrapper_con:function(){null==this.outer_con&&(this.outer_con=new hg,this.outer_con.zpp_inner=this);return this.outer_con},wrapper_int:function(){null==this.outer_int&&(this.outer_int=new ig,this.outer_int.zpp_inner=
this);null==this.wrap_arbiters?this.wrap_arbiters=Pd.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters;this.wrap_arbiters.zpp_inner.zip_length=!0;this.wrap_arbiters.zpp_inner.at_ite=null;return this.outer_int},push:function(a){null!=this.prev?this.prev.next=a:this.next=a;a.prev=this.prev;a.next=null;this.prev=a;this.length++},pop:function(){var a=this.next;this.next=a.next;null==this.next?this.prev=null:this.next.prev=null;this.length--;return a},empty:function(){return null==
this.next},__class__:Jc};var ma=function(){this.interactors=this.constraints=null;this.zip_conlisteners=!1;this.conlisteners=null;this.zip_bodylisteners=!1;this.bodylisteners=null;this.zip_listeners=!1;this.manager=this.cbpairs=this.listeners=null;this.id=0;this.next=null;this.count=0;this.cbTypes=null;this.cbTypes=new sd;this.listeners=new Be;this.zip_listeners=!0;this.bodylisteners=new Kg;this.zip_bodylisteners=!0;this.conlisteners=new Lg;this.zip_conlisteners=!0;this.constraints=new ad;this.interactors=
new Dc;this.id=wb.CbSet();this.cbpairs=new Cj};h["zpp_nape.callbacks.ZPP_CbSet"]=ma;ma.__name__=!0;ma.setlt=function(a,b){for(var c=a.cbTypes.head,d=b.cbTypes.head;null!=c&&null!=d;){var e=c.elt,i=d.elt;if(e.id<i.id)return!0;if(i.id<e.id)return!1;c=c.next;d=d.next}return null!=d&&null==c};ma.get=function(a){var b;null==ma.zpp_pool?b=new ma:(b=ma.zpp_pool,ma.zpp_pool=b.next,b.next=null);null;for(var c=null,a=a.head;null!=a;){var d=a.elt,c=b.cbTypes.insert(c,d);d.cbsets.add(b);a=a.next}return b};ma.single_intersection=
function(a,b,c){return a.manager.pair(a,b).single_intersection(c)};ma.find_all=function(a,b,c,d){a.manager.pair(a,b).forall(c,d)};ma.prototype={invalidate_pairs:function(){for(var a=this.cbpairs.head;null!=a;)a.elt.zip_listeners=!0,a=a.next},realvalidate_listeners:function(){this.listeners.clear();for(var a=this.cbTypes.head;null!=a;){for(var b=null,c=this.listeners.head,d=a.elt.listeners.head;null!=d;){var e=d.elt;null!=c&&c.elt==e?(d=d.next,b=c,c=c.next):null==c||mc.setlt(e,c.elt)?(e.space==this.manager.space&&
(b=this.listeners.inlined_insert(b,e)),d=d.next):(b=c,c=c.next)}a=a.next}},realvalidate_bodylisteners:function(){this.bodylisteners.clear();for(var a=this.cbTypes.head;null!=a;){for(var b=null,c=this.bodylisteners.head,d=a.elt.bodylisteners.head;null!=d;){var e=d.elt;null!=c&&c.elt==e?(d=d.next,b=c,c=c.next):null==c||mc.setlt(e,c.elt)?(!e.options.excluded(this.cbTypes)&&e.space==this.manager.space&&(b=this.bodylisteners.inlined_insert(b,e)),d=d.next):(b=c,c=c.next)}a=a.next}},realvalidate_conlisteners:function(){this.conlisteners.clear();
for(var a=this.cbTypes.head;null!=a;){for(var b=null,c=this.conlisteners.head,d=a.elt.conlisteners.head;null!=d;){var e=d.elt;null!=c&&c.elt==e?(d=d.next,b=c,c=c.next):null==c||mc.setlt(e,c.elt)?(!e.options.excluded(this.cbTypes)&&e.space==this.manager.space&&(b=this.conlisteners.inlined_insert(b,e)),d=d.next):(b=c,c=c.next)}a=a.next}},validate:function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners());this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners());
this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},free:function(){this.listeners.clear();this.zip_listeners=!0;this.bodylisteners.clear();this.zip_bodylisteners=!0;this.conlisteners.clear();for(this.zip_conlisteners=!0;null!=this.cbTypes.head;)this.cbTypes.pop_unsafe().cbsets.remove(this)},__class__:ma};var Hb=function(){this.listeners=null;this.zip_listeners=!1;this.a=this.b=this.next=null;this.listeners=new Be};h["zpp_nape.callbacks.ZPP_CbSetPair"]=Hb;Hb.__name__=
!0;Hb.get=function(a,b){var c;null==Hb.zpp_pool?c=new Hb:(c=Hb.zpp_pool,Hb.zpp_pool=c.next,c.next=null);c.zip_listeners=!0;ma.setlt(a,b)?(c.a=a,c.b=b):(c.a=b,c.b=a);return c};Hb.setlt=function(a,b){return ma.setlt(a.a,b.a)||a.a==b.a&&ma.setlt(a.b,b.b)};Hb.prototype={__validate:function(){this.listeners.clear();for(var a=this.a.listeners.head,b=this.b.listeners.head;null!=a&&null!=b;){var c=a.elt,d=b.elt;c==d?((c.options1.compatible(this.a.cbTypes)&&c.options2.compatible(this.b.cbTypes)||c.options2.compatible(this.a.cbTypes)&&
c.options1.compatible(this.b.cbTypes))&&this.listeners.add(c),a=a.next,b=b.next):c.precedence>d.precedence||c.precedence==d.precedence&&c.id>d.id?a=a.next:b=b.next}},empty_intersection:function(){return null==this.listeners.head},single_intersection:function(a){var b=this.listeners.head;return null!=b&&b.elt==a&&null==b.next},forall:function(a,b){for(var c=this.listeners.head;null!=c;){var d=c.elt;d.event==a&&b(d);c=c.next}},__class__:Hb};var f=function(){};h["zpp_nape.util.ZPP_Flags"]=f;f.__name__=
!0;var mc=function(){this.body=this.constraint=this.interaction=this.space=null;this.id=this.type=this.event=this.precedence=0;this.outer=null;this.id=wb.Listener()};h["zpp_nape.callbacks.ZPP_Listener"]=mc;mc.__name__=!0;mc.setlt=function(a,b){return a.precedence>b.precedence||a.precedence==b.precedence&&a.id>b.id};mc.prototype={addedToSpace:function(){},removedFromSpace:function(){},__class__:mc};var Dj=function(){this.outer_zn=this.options=this.handler=null};h["zpp_nape.callbacks.ZPP_BodyListener"]=
Dj;Dj.__name__=!0;Dj.__super__=mc;Dj.prototype=v(mc.prototype,{addedToSpace:function(){this.options.handler=y(this,this.cbtype_change);for(var a=this.options.includes.head;null!=a;)a.elt.addbody(this),a=a.next},removedFromSpace:function(){for(var a=this.options.includes.head;null!=a;){var b=a.elt;b.bodylisteners.remove(this);b.invalidatebody();a=a.next}this.options.handler=null},cbtype_change:function(a,b,c){this.removedFromSpace();this.options.effect_change(a,b,c);this.addedToSpace()},__class__:Dj});
var Ej=function(){this.outer_zn=this.options=this.handler=null};h["zpp_nape.callbacks.ZPP_ConstraintListener"]=Ej;Ej.__name__=!0;Ej.__super__=mc;Ej.prototype=v(mc.prototype,{addedToSpace:function(){this.options.handler=y(this,this.cbtype_change);for(var a=this.options.includes.head;null!=a;)a.elt.addconstraint(this),a=a.next},removedFromSpace:function(){for(var a=this.options.includes.head;null!=a;){var b=a.elt;b.conlisteners.remove(this);b.invalidateconstraint();a=a.next}this.options.handler=null},
cbtype_change:function(a,b,c){this.removedFromSpace();this.options.effect_change(a,b,c);this.addedToSpace()},__class__:Ej});var sd=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_CbType"]=sd;sd.__name__=!0;sd.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==yb.zpp_pool?b=new yb:(b=yb.zpp_pool,yb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},
insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==yb.zpp_pool?c=new yb:(c=yb.zpp_pool,yb.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=yb.zpp_pool;yb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},
inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=yb.zpp_pool;yb.zpp_pool=a;this.modified=!0;this.length--;
this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},has:function(a){return this.inlined_has(a)},inlined_has:function(a){var b;b=!1;for(var c=this.head;null!=c;){if(c.elt==a){b=!0;break}c=c.next}return b},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:sd};var cb=function(a,b,c,d){this.handlerp=null;this.allowSleepingCallbacks=this.pure=!1;this.options1=this.options2=this.handleri=null;this.itype=0;this.outer_zni=
this.outer_znp=null;mc.call(this);this.type=d;this.interaction=this;this.event=c;this.options1=a.zpp_inner;this.options2=b.zpp_inner;this.allowSleepingCallbacks=!1};h["zpp_nape.callbacks.ZPP_InteractionListener"]=cb;cb.__name__=!0;cb.__super__=mc;cb.prototype=v(mc.prototype,{CbSetset:function(a,b,c){for(var d=cb.UCbSet,e=cb.VCbSet,i=cb.WCbSet,a=a.head,f=b.head;null!=a&&null!=f;){var g=a.elt,h=f.elt;g==h?(i.inlined_add(g),a=a.next,f=f.next):ma.setlt(g,h)?(d.inlined_add(g),a=a.next):(e.inlined_add(h),
f=f.next)}for(;null!=a;)d.inlined_add(a.elt),a=a.next;for(;null!=f;)e.inlined_add(f.elt),f=f.next;for(;null!=d.head;){a=d.pop_unsafe();for(f=b.head;null!=f;)c(a,f.elt),f=f.next}for(;null!=e.head;){b=e.pop_unsafe();for(d=i.head;null!=d;)c(b,d.elt),d=d.next}for(;null!=i.head;){e=i.pop_unsafe();c(e,e);for(b=i.head;null!=b;)c(e,b.elt),b=b.next}},CbTypeset:function(a,b,c){for(var d=cb.UCbType,e=cb.VCbType,i=cb.WCbType,a=a.head,f=b.head;null!=a&&null!=f;){var g=a.elt,h=f.elt;g==h?(i.inlined_add(g),a=a.next,
f=f.next):g.id<h.id?(d.inlined_add(g),a=a.next):(e.inlined_add(h),f=f.next)}for(;null!=a;)d.inlined_add(a.elt),a=a.next;for(;null!=f;)e.inlined_add(f.elt),f=f.next;for(;null!=d.head;){a=d.pop_unsafe();for(f=b.head;null!=f;)c(a,f.elt),f=f.next}for(;null!=e.head;){b=e.pop_unsafe();for(d=i.head;null!=d;)c(b,d.elt),d=d.next}for(;null!=i.head;){e=i.pop_unsafe();c(e,e);for(b=i.head;null!=b;)c(e,b.elt),b=b.next}},with_uniquesets:function(a){var b=this,c;null==Fa.zpp_pool?c=new Fa:(c=Fa.zpp_pool,Fa.zpp_pool=
c.next,c.next=null);null;c.lt=Hb.setlt;this.CbTypeset(this.options1.includes,this.options2.includes,function(a,d){b.CbSetset(a.cbsets,d.cbsets,function(a,d){a.validate();d.validate();ma.single_intersection(a,d,b)&&c.try_insert(Hb.get(a,d))})});c.clear_with(function(c){a?b.space.freshListenerType(c.a,c.b):b.space.nullListenerType(c.a,c.b);c.a=c.b=null;c.listeners.clear();c.next=Hb.zpp_pool;Hb.zpp_pool=c});var d=c;d.data=null;d.lt=null;d.swapped=null;d.next=Fa.zpp_pool;Fa.zpp_pool=d},with_union:function(a){for(var b=
this.options1.includes.head,c=this.options2.includes.head;null!=b&&null!=c;){var d=b.elt,e=c.elt;d==e?(a(d),b=b.next,c=c.next):d.id<e.id?(a(d),b=b.next):(a(e),c=c.next)}for(;null!=b;)a(b.elt),b=b.next;for(;null!=c;)a(c.elt),c=c.next},addedToSpace:function(){var a=this,b=this.type==f.id_ListenerType_PRE;this.with_union(function(c){c.addint(a);if(b)for(c=c.interactors.head;null!=c;)c.elt.wake(),c=c.next});this.options1.handler=y(this,this.cbtype_change1);this.options2.handler=y(this,this.cbtype_change2);
this.with_uniquesets(!0)},removedFromSpace:function(){var a=this;this.with_uniquesets(!1);var b=this.type==f.id_ListenerType_PRE;this.with_union(function(c){c.listeners.remove(a);c.invalidateint();if(b)for(c=c.interactors.head;null!=c;)c.elt.wake(),c=c.next});this.options1.handler=null;this.options2.handler=null},cbtype_change1:function(a,b,c){this.cbtype_change(this.options1,a,b,c)},cbtype_change2:function(a,b,c){this.cbtype_change(this.options2,a,b,c)},cbtype_change:function(a,b,c,d){this.removedFromSpace();
a.effect_change(b,c,d);this.addedToSpace();null},__class__:cb});var Nd=function(){this.outer=this.handler=this.includes=this.excludes=this.wrap_includes=this.wrap_excludes=null;this.includes=new sd;this.excludes=new sd};h["zpp_nape.callbacks.ZPP_OptionType"]=Nd;Nd.__name__=!0;Nd.argument=function(a){return null==a?new Xe:A.__instanceof(a,Xe)?a:(new Xe).including(a)};Nd.prototype={setup_includes:function(){this.wrap_includes=xc.get(this.includes,!0)},setup_excludes:function(){this.wrap_excludes=xc.get(this.excludes,
!0)},excluded:function(a){return this.nonemptyintersection(a,this.excludes)},compatible:function(a){return this.nonemptyintersection(a,this.includes)&&!this.nonemptyintersection(a,this.excludes)},nonemptyintersection:function(a,b){for(var c=!1,d=a.head,e=b.head;null!=e&&null!=d;){var i=e.elt,f=d.elt;if(i==f){c=!0;break}else i.id<f.id?e=e.next:d=d.next}return c},effect_change:function(a,b,c){if(b)if(c){b=null;for(c=this.includes.head;null!=c&&!(a.id<c.elt.id);){b=c;c=c.next}this.includes.inlined_insert(b,
a)}else this.includes.remove(a);else if(c){b=null;for(c=this.excludes.head;null!=c&&!(a.id<c.elt.id);){b=c;c=c.next}this.excludes.inlined_insert(b,a)}else this.excludes.remove(a)},append_type:function(a,b){a==this.includes?this.includes.has(b)||(this.excludes.has(b)?null!=this.handler?this.handler(b,!1,!1):this.effect_change(b,!1,!1):null!=this.handler?this.handler(b,!0,!0):this.effect_change(b,!0,!0)):this.excludes.has(b)||(this.includes.has(b)?null!=this.handler?this.handler(b,!0,!1):this.effect_change(b,
!0,!1):null!=this.handler?this.handler(b,!1,!0):this.effect_change(b,!1,!0))},append:function(a,b){if(A.__instanceof(b,Md))this.append_type(a,b.zpp_inner);else if(A.__instanceof(b,gg)){var c;b.zpp_inner.valmod();for(c=fc.get(b);c.hasNext();){var d;c.zpp_critical=!1;d=c.zpp_inner.at(c.zpp_i++);this.append_type(a,d.zpp_inner)}}else if(b instanceof Array&&null==b.__enum__)for(c=0;c<b.length;)d=b[c],++c,this.append_type(a,d.zpp_inner)},__class__:Nd};var qk=function(){this.cbTypes=this.cbSet=null;this.ignore=
this.__velocity=!1;this.component=null;this.active=this.stiff=this.removeOnBreak=!1;this.outer=this.compound=this.space=null};h["zpp_nape.constraint.ZPP_Constraint"]=qk;qk.__name__=!0;qk.prototype={alloc_cbSet:function(){if(null!=(this.cbSet=this.space.cbsets.get(this.cbTypes)))this.cbSet.count++,this.cbSet.constraints.add(this)},dealloc_cbSet:function(){if(null!=this.cbSet){this.cbSet.constraints.remove(this);if(0==--this.cbSet.count){this.space.cbsets.remove(this.cbSet);var a=this.cbSet;a.free();
a.next=ma.zpp_pool;ma.zpp_pool=a}this.cbSet=null}},addedToSpace:function(){this.active&&this.activeInSpace();this.activeBodies();for(var a=this.cbTypes.head;null!=a;)a.elt.constraints.add(this),a=a.next},removedFromSpace:function(){this.active&&this.inactiveOrOutSpace();this.inactiveBodies();for(var a=this.cbTypes.head;null!=a;)a.elt.constraints.remove(this),a=a.next},activeInSpace:function(){this.alloc_cbSet();null==eb.zpp_pool?this.component=new eb:(this.component=eb.zpp_pool,eb.zpp_pool=this.component.next,
this.component.next=null);null;this.component.isBody=!1;this.component.constraint=this},inactiveOrOutSpace:function(){this.dealloc_cbSet();var a=this.component;a.body=null;a.constraint=null;null;a.next=eb.zpp_pool;eb.zpp_pool=a;this.component=null},activeBodies:function(){},inactiveBodies:function(){},clearcache:function(){},wake_connected:function(){},forest:function(){},pair_exists:function(){return!1},broken:function(){},warmStart:function(){},preStep:function(){return!1},applyImpulseVel:function(){return!1},
applyImpulsePos:function(){return!1},__class__:qk};var Z=function(){this.colarb=this.fluidarb=this.sensorarb=null;this.type=0;this.b1=this.b2=this.ws1=this.ws2=this.pair=null;this.invalidated=!1;this.immState=0;this.intchange=this.presentable=this.continuous=this.fresh=!1;this.present=0;this.active=this.cleared=this.sleeping=!1;this.id=this.di=this.stamp=this.up_stamp=this.sleep_stamp=this.endGenerated=0;this.outer=null};h["zpp_nape.dynamics.ZPP_Arbiter"]=Z;Z.__name__=!0;Z.prototype={wrapper:function(){null==
this.outer&&(Z.internal=!0,this.type==Z.COL?(this.colarb.outer_zn=new kg,this.outer=this.colarb.outer_zn):this.type==Z.FLUID?(this.fluidarb.outer_zn=new lg,this.outer=this.fluidarb.outer_zn):this.outer=new Ob,this.outer.zpp_inner=this,Z.internal=!1);return this.outer},__class__:Z};var Ib=function(){this.next=null;Z.call(this);this.type=Z.SENSOR;this.sensorarb=this};h["zpp_nape.dynamics.ZPP_SensorArbiter"]=Ib;Ib.__name__=!0;Ib.__super__=Z;Ib.prototype=v(Z.prototype,{retire:function(){this.cleared||
(this.b1.arbiters.inlined_try_remove(this),this.b2.arbiters.inlined_try_remove(this),null!=this.pair&&(this.pair=this.pair.arb=null));this.b1=this.b2=null;this.intchange=this.active=!1;this.next=Ib.zpp_pool;Ib.zpp_pool=this},__class__:Ib});var zb=function(){this.wMass=this.adamp=this.agamma=this.vMassa=this.vMassb=this.vMassc=this.dampx=this.dampy=this.lgamma=this.nx=this.ny=this.buoyx=this.buoyy=this.pre_dt=0;this.nodrag=!1;this.centroidx=this.centroidy=this.overlap=this.r1x=this.r1y=this.r2x=this.r2y=
0;this.outer_zn=this.next=null;Z.call(this);this.type=Z.FLUID;this.fluidarb=this;this.buoyy=this.buoyx=0;this.pre_dt=-1};h["zpp_nape.dynamics.ZPP_FluidArbiter"]=zb;zb.__name__=!0;zb.__super__=Z;zb.prototype=v(Z.prototype,{retire:function(){this.cleared||(this.b1.arbiters.inlined_try_remove(this),this.b2.arbiters.inlined_try_remove(this),null!=this.pair&&(this.pair=this.pair.arb=null));this.b1=this.b2=null;this.intchange=this.active=!1;this.next=zb.zpp_pool;zb.zpp_pool=this;this.pre_dt=-1},preStep:function(a,
b){-1==this.pre_dt&&(this.pre_dt=b);var c=b/this.pre_dt;this.pre_dt=b;this.r1x=this.centroidx-this.b1.posx;this.r1y=this.centroidy-this.b1.posy;this.r2x=this.centroidx-this.b2.posx;this.r2y=this.centroidy-this.b2.posy;var d=0,e=0;this.ws1.fluidEnabled&&null!=this.ws1.fluidProperties.wrap_gravity?(d=this.ws1.fluidProperties.gravityx,e=this.ws1.fluidProperties.gravityy):(d=a.gravityx,e=a.gravityy);var i=0,m=0;this.ws2.fluidEnabled&&null!=this.ws2.fluidProperties.wrap_gravity?(i=this.ws2.fluidProperties.gravityx,
m=this.ws2.fluidProperties.gravityy):(i=a.gravityx,m=a.gravityy);var g=0,h=0;if(this.ws1.fluidEnabled&&this.ws2.fluidEnabled){var j=this.overlap*this.ws1.fluidProperties.density,k=this.overlap*this.ws2.fluidProperties.density;if(j>k)i=j+k,g-=d*i,h-=e*i;else if(j<k)d=j+k,g+=i*d,h+=m*d;else{var l=0,n=0,l=0.5*(d+i),n=0.5*(e+m);this.ws1.worldCOMx*l+this.ws1.worldCOMy*n>this.ws2.worldCOMx*l+this.ws2.worldCOMy*n?(d=j+k,g-=l*d,h-=n*d):(d=j+k,g+=l*d,h+=n*d)}}else this.ws1.fluidEnabled?(i=this.overlap*this.ws1.fluidProperties.density,
g-=d*i,h-=e*i):this.ws2.fluidEnabled&&(d=this.overlap*this.ws2.fluidProperties.density,g+=i*d,h+=m*d);g*=b;h*=b;this.buoyx=g;this.buoyy=h;this.b1.type==f.id_BodyType_DYNAMIC&&(d=this.b1.imass,this.b1.velx-=g*d,this.b1.vely-=h*d,this.b1.angvel-=(h*this.r1x-g*this.r1y)*this.b1.iinertia);this.b2.type==f.id_BodyType_DYNAMIC&&(d=this.b2.imass,this.b2.velx+=g*d,this.b2.vely+=h*d,this.b2.angvel+=(h*this.r2x-g*this.r2y)*this.b2.iinertia);if((!this.ws1.fluidEnabled||0==this.ws1.fluidProperties.viscosity)&&
(!this.ws2.fluidEnabled||0==this.ws2.fluidProperties.viscosity))this.nodrag=!0,this.adamp=this.dampy=this.dampx=0;else{this.nodrag=!1;g=0;this.ws1.fluidEnabled&&(this.ws2.validate_angDrag(),g+=this.ws1.fluidProperties.viscosity*this.ws2.angDrag*this.overlap/this.ws2.area);this.ws2.fluidEnabled&&(this.ws1.validate_angDrag(),g+=this.ws2.fluidProperties.viscosity*this.ws1.angDrag*this.overlap/this.ws1.area);0!=g?(h=this.b1.sinertia+this.b2.sinertia,this.wMass=0!=h?1/h:0,g=2*Math.PI*4.0E-4*g,this.agamma=
1/(b*g*(2+g*b)),g=1/(1+this.agamma),this.agamma*=g,this.wMass*=g):this.agamma=this.wMass=0;g=this.b2.velx+this.b2.kinvelx-this.r2y*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.r1y*(this.b2.angvel+this.b2.kinangvel));h=this.b2.vely+this.b2.kinvely+this.r2x*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.r1x*(this.b1.angvel+this.b1.kinangvel));g*g+h*h<t.epsilon*t.epsilon||(d=1/Math.sqrt(g*g+h*h),this.nx=g*d,this.ny=h*d);g=0;if(this.ws1.fluidEnabled)if(h=
-this.ws1.fluidProperties.viscosity*this.overlap/this.ws2.area,this.ws2.type==f.id_ShapeType_CIRCLE)g-=h*this.ws2.circle.radius*t.fluidLinearDrag/(2*this.ws2.circle.radius*Math.PI);else{e=d=0;for(i=this.ws2.polygon.edges.head;null!=i;)m=i.elt,d+=m.length,m=h*m.length*(m.gnormx*this.nx+m.gnormy*this.ny),0<m&&(m=m*=-t.fluidVacuumDrag),e-=0.5*m*t.fluidLinearDrag,i=i.next;g+=e/d}if(this.ws2.fluidEnabled)if(h=-this.ws2.fluidProperties.viscosity*this.overlap/this.ws1.area,this.ws1.type==f.id_ShapeType_CIRCLE)g-=
h*this.ws1.circle.radius*t.fluidLinearDrag/(2*this.ws1.circle.radius*Math.PI);else{e=d=0;for(i=this.ws1.polygon.edges.head;null!=i;)m=i.elt,d+=m.length,m=h*m.length*(m.gnormx*this.nx+m.gnormy*this.ny),0<m&&(m=m*=-t.fluidVacuumDrag),e-=0.5*m*t.fluidLinearDrag,i=i.next;g+=e/d}0!=g?(i=this.b1.smass+this.b2.smass,e=d=h=0,h=i,d=0,e=i,0!=this.b1.sinertia&&(i=this.r1x*this.b1.sinertia,m=this.r1y*this.b1.sinertia,h+=m*this.r1y,d+=-m*this.r1x,e+=i*this.r1x),0!=this.b2.sinertia&&(i=this.r2x*this.b2.sinertia,
m=this.r2y*this.b2.sinertia,h+=m*this.r2y,d+=-m*this.r2x,e+=i*this.r2x),i=h*e-d*d,i!=i?(h=d=e=0,3):0==i?(i=0,0!=h?h=1/h:(h=0,i|=1),0!=e?e=1/e:(e=0,i|=2),d=0,i):(i=1/i,m=e*i,e=h*i,h=m,d*=-i,0),this.vMassa=h,this.vMassb=d,this.vMassc=e,g*=2*Math.PI,this.lgamma=1/(b*g*(2+g*b)),g=1/(1+this.lgamma),this.lgamma*=g,this.vMassa*=g,this.vMassb*=g,this.vMassc*=g):this.lgamma=this.vMassc=this.vMassb=this.vMassa=0}this.dampx*=c;this.dampy*=c;this.adamp*=c},warmStart:function(){var a=this.b1.imass;this.b1.velx-=
this.dampx*a;this.b1.vely-=this.dampy*a;a=this.b2.imass;this.b2.velx+=this.dampx*a;this.b2.vely+=this.dampy*a;this.b1.angvel-=this.b1.iinertia*(this.dampy*this.r1x-this.dampx*this.r1y);this.b2.angvel+=this.b2.iinertia*(this.dampy*this.r2x-this.dampx*this.r2y);this.b1.angvel-=this.adamp*this.b1.iinertia;this.b2.angvel+=this.adamp*this.b2.iinertia},applyImpulseVel:function(){if(!this.nodrag){var a=this.b1.angvel+this.b1.kinangvel,b=this.b2.angvel+this.b2.kinangvel,c=this.b1.velx+this.b1.kinvelx-this.r1y*
a-(this.b2.velx+this.b2.kinvelx-this.r2y*b),d=this.b1.vely+this.b1.kinvely+this.r1x*a-(this.b2.vely+this.b2.kinvely+this.r2x*b),e=this.vMassa*c+this.vMassb*d,d=this.vMassb*c+this.vMassc*d,i=this.lgamma,c=e-this.dampx*i,d=d-this.dampy*i;this.dampx+=1*c;this.dampy+=1*d;e=this.b1.imass;this.b1.velx-=c*e;this.b1.vely-=d*e;e=this.b2.imass;this.b2.velx+=c*e;this.b2.vely+=d*e;this.b1.angvel-=this.b1.iinertia*(d*this.r1x-c*this.r1y);this.b2.angvel+=this.b2.iinertia*(d*this.r2x-c*this.r2y);a=(a-b)*this.wMass-
this.adamp*this.agamma;this.adamp+=a;this.b1.angvel-=a*this.b1.iinertia;this.b2.angvel+=a*this.b2.iinertia}},__class__:zb});var Jb=function(){this.pre_dt=0;this.stat=!1;this.next=null;this.hc2=this.hpc2=!1;this.c1=this.oc1=this.c2=this.oc2=null;this.__ref_vertex=0;this.__ref_edge1=this.__ref_edge2=null;this.biasCoef=0;this.rev=!1;this.nx=this.ny=this.kMassa=this.kMassb=this.kMassc=this.Ka=this.Kb=this.Kc=this.rMass=this.jrAcc=this.rn1a=this.rt1a=this.rn1b=this.rt1b=this.rn2a=this.rt2a=this.rn2b=this.rt2b=
this.k1x=this.k1y=this.k2x=this.k2y=this.surfacex=this.surfacey=this.lnormx=this.lnormy=this.lproj=this.radius=0;this.s1=this.s2=this.contacts=this.innards=null;this.userdef_dyn_fric=this.userdef_stat_fric=this.userdef_restitution=this.userdef_rfric=!1;this.dyn_fric=this.stat_fric=this.restitution=this.rfric=0;this.outer_zn=null;Z.call(this);this.pre_dt=-1;this.contacts=new Ab;this.innards=new Jh;this.type=Z.COL;this.colarb=this};h["zpp_nape.dynamics.ZPP_ColArbiter"]=Jb;Jb.__name__=!0;Jb.__super__=
Z;Jb.prototype=v(Z.prototype,{injectContact:function(a,b,c,d,e,i,f){null==f&&(f=!1);for(var g=null,h=this.contacts.next;null!=h;){var j=h;if(i==j.hash){g=j;break}h=h.next}null==g?(null==Ab.zpp_pool?g=new Ab:(g=Ab.zpp_pool,Ab.zpp_pool=g.next,g.next=null),null,h=g.inner,h.jnAcc=h.jtAcc=0,g.hash=i,g.fresh=!0,g.arbiter=this,this.jrAcc=0,this.contacts.inlined_add(g),this.innards.add(h)):g.fresh=!1;g.px=a;g.py=b;this.nx=c;this.ny=d;g.dist=e;g.stamp=this.stamp;g.posOnly=f;return g},retire:function(){this.cleared||
(this.b1.arbiters.inlined_try_remove(this),this.b2.arbiters.inlined_try_remove(this),null!=this.pair&&(this.pair=this.pair.arb=null));this.b1=this.b2=null;for(this.intchange=this.active=!1;null!=this.contacts.next;){var a=this.contacts.inlined_pop_unsafe();a.arbiter=null;a.next=Ab.zpp_pool;Ab.zpp_pool=a;this.innards.inlined_pop()}this.userdef_rfric=this.userdef_restitution=this.userdef_stat_fric=this.userdef_dyn_fric=!1;this.__ref_edge1=this.__ref_edge2=null;this.next=Jb.zpp_pool;Jb.zpp_pool=this;
this.pre_dt=-1},cleanupContacts:function(){var a=!0,b=null,c=null,d=this.innards.next;this.hc2=!1;for(var e=this.contacts.next;null!=e;){var i=e;i.stamp+t.arbiterExpirationDelay<this.stamp?(e=this.contacts.inlined_erase(b),d=this.innards.inlined_erase(c),i.arbiter=null,i.next=Ab.zpp_pool,Ab.zpp_pool=i):(b=i.inner,c=i.active,i.active=i.stamp==this.stamp,i.active&&(a?(a=!1,this.c1=b,this.oc1=i):(this.hc2=!0,this.c2=b,this.oc2=i)),c!=i.active&&(this.contacts.modified=!0),b=e,c=d,d=d.next,e=e.next)}this.hc2?
(this.hpc2=!0,this.oc1.posOnly?(d=this.c1,this.c1=this.c2,this.c2=d,d=this.oc1,this.oc1=this.oc2,this.oc2=d,this.hc2=!1):this.oc2.posOnly&&(this.hc2=!1),this.oc1.posOnly&&(a=!0)):this.hpc2=!1;return a},preStep:function(a){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.restitution=-Infinity>=this.s1.material.elasticity||-Infinity>=this.s2.material.elasticity?0:Infinity<=this.s1.material.elasticity||Infinity<=this.s2.material.elasticity?1:(this.s1.material.elasticity+this.s2.material.elasticity)/
2,0>this.restitution&&(this.restitution=0),1<this.restitution&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction)));-1==this.pre_dt&&(this.pre_dt=a);var b=a/this.pre_dt;this.pre_dt=a;var c=
this.b1.smass+this.b2.smass;this.hc2=!1;a=!0;this.biasCoef=this.b1.type!=f.id_BodyType_DYNAMIC||this.b2.type!=f.id_BodyType_DYNAMIC?this.continuous?t.contactContinuousStaticBiasCoef:t.contactStaticBiasCoef:this.continuous?t.contactContinuousBiasCoef:t.contactBiasCoef;this.continuous=!1;for(var d=null,e=null,i=this.innards.next,m=this.contacts.next;null!=m;){var g=m;if(g.stamp+t.arbiterExpirationDelay<this.stamp)m=this.contacts.inlined_erase(d),i=this.innards.inlined_erase(e),g.arbiter=null,g.next=
Ab.zpp_pool,Ab.zpp_pool=g;else{d=g.inner;e=g.active;g.active=g.stamp==this.stamp;if(g.active){a?(a=!1,this.c1=d,this.oc1=g):(this.hc2=!0,this.c2=d,this.oc2=g);d.r2x=g.px-this.b2.posx;d.r2y=g.py-this.b2.posy;d.r1x=g.px-this.b1.posx;d.r1y=g.py-this.b1.posy;var h=c+this.b2.sinertia*Bf.sqr(d.r2x*this.nx+d.r2y*this.ny),h=h+this.b1.sinertia*Bf.sqr(d.r1x*this.nx+d.r1y*this.ny);d.tMass=h<t.epsilon*t.epsilon?0:1/h;h=c+this.b2.sinertia*Bf.sqr(this.ny*d.r2x-this.nx*d.r2y);h+=this.b1.sinertia*Bf.sqr(this.ny*
d.r1x-this.nx*d.r1y);d.nMass=h<t.epsilon*t.epsilon?0:1/h;var j=h=0,k=this.b2.angvel+this.b2.kinangvel,h=this.b2.velx+this.b2.kinvelx-d.r2y*k,j=this.b2.vely+this.b2.kinvely+d.r2x*k,k=this.b1.angvel+this.b1.kinangvel,h=h-(this.b1.velx+this.b1.kinvelx-d.r1y*k),j=j-(this.b1.vely+this.b1.kinvely+d.r1x*k),k=this.nx*h+this.ny*j;g.elasticity=this.restitution;d.bounce=k*g.elasticity;d.bounce>-t.elasticThreshold&&(d.bounce=0);k=j*this.nx-h*this.ny;h=t.staticFrictionThreshold;d.friction=k*k>h*h?this.dyn_fric:
this.stat_fric;d.jnAcc*=b;d.jtAcc*=b}e!=g.active&&(this.contacts.modified=!0);d=m;e=i;i=i.next;m=m.next}}this.hc2?(this.hpc2=!0,this.oc1.posOnly?(i=this.c1,this.c1=this.c2,this.c2=i,i=this.oc1,this.oc1=this.oc2,this.oc2=i,this.hc2=!1):this.oc2.posOnly&&(this.hc2=!1),this.oc1.posOnly&&(a=!0)):this.hpc2=!1;this.jrAcc*=b;a||(this.rn1a=this.ny*this.c1.r1x-this.nx*this.c1.r1y,this.rt1a=this.c1.r1x*this.nx+this.c1.r1y*this.ny,this.rn1b=this.ny*this.c1.r2x-this.nx*this.c1.r2y,this.rt1b=this.c1.r2x*this.nx+
this.c1.r2y*this.ny,this.k1x=this.b2.kinvelx-this.c1.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c1.r1y*this.b1.kinangvel),this.k1y=this.b2.kinvely+this.c1.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c1.r1x*this.b1.kinangvel));this.hc2&&(this.rn2a=this.ny*this.c2.r1x-this.nx*this.c2.r1y,this.rt2a=this.c2.r1x*this.nx+this.c2.r1y*this.ny,this.rn2b=this.ny*this.c2.r2x-this.nx*this.c2.r2y,this.rt2b=this.c2.r2x*this.nx+this.c2.r2y*this.ny,this.k2x=this.b2.kinvelx-this.c2.r2y*this.b2.kinangvel-(this.b1.kinvelx-
this.c2.r1y*this.b1.kinangvel),this.k2y=this.b2.kinvely+this.c2.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c2.r1x*this.b1.kinangvel),this.kMassa=c+this.b1.sinertia*this.rn1a*this.rn1a+this.b2.sinertia*this.rn1b*this.rn1b,this.kMassb=c+this.b1.sinertia*this.rn1a*this.rn2a+this.b2.sinertia*this.rn1b*this.rn2b,this.kMassc=c+this.b1.sinertia*this.rn2a*this.rn2a+this.b2.sinertia*this.rn2b*this.rn2b,this.kMassa*this.kMassa+2*this.kMassb*this.kMassb+this.kMassc*this.kMassc<t.illConditionedThreshold*(this.kMassa*
this.kMassc-this.kMassb*this.kMassb)?(this.Ka=this.kMassa,this.Kb=this.kMassb,this.Kc=this.kMassc,b=this.kMassa*this.kMassc-this.kMassb*this.kMassb,b!=b?(this.kMassa=this.kMassb=this.kMassc=0,3):0==b?(b=0,0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,b|=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,b|=2),this.kMassb=0,b):(b=1/b,c=this.kMassc*b,this.kMassc=this.kMassa*b,this.kMassa=c,this.kMassb*=-b,0)):(this.hc2=!1,this.oc2.dist<this.oc1.dist&&(b=this.c1,this.c1=this.c2,this.c2=
b),this.oc2.active=!1,this.contacts.modified=!0));this.surfacex=this.b2.svelx;this.surfacey=this.b2.svely;this.surfacex+=1*this.b1.svelx;this.surfacey+=1*this.b1.svely;this.surfacex=-this.surfacex;this.surfacey=-this.surfacey;this.rMass=this.b1.sinertia+this.b2.sinertia;0!=this.rMass&&(this.rMass=1/this.rMass);return a},warmStart:function(){var a=this.nx*this.c1.jnAcc-this.ny*this.c1.jtAcc,b=this.ny*this.c1.jnAcc+this.nx*this.c1.jtAcc,c=this.b1.imass;this.b1.velx-=a*c;this.b1.vely-=b*c;this.b1.angvel-=
this.b1.iinertia*(b*this.c1.r1x-a*this.c1.r1y);c=this.b2.imass;this.b2.velx+=a*c;this.b2.vely+=b*c;this.b2.angvel+=this.b2.iinertia*(b*this.c1.r2x-a*this.c1.r2y);this.hc2&&(a=this.nx*this.c2.jnAcc-this.ny*this.c2.jtAcc,b=this.ny*this.c2.jnAcc+this.nx*this.c2.jtAcc,c=this.b1.imass,this.b1.velx-=a*c,this.b1.vely-=b*c,this.b1.angvel-=this.b1.iinertia*(b*this.c2.r1x-a*this.c2.r1y),c=this.b2.imass,this.b2.velx+=a*c,this.b2.vely+=b*c,this.b2.angvel+=this.b2.iinertia*(b*this.c2.r2x-a*this.c2.r2y));this.b2.angvel+=
this.jrAcc*this.b2.iinertia;this.b1.angvel-=this.jrAcc*this.b1.iinertia},applyImpulseVel:function(){var a,b,c,d,e;d=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel);var i=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel);c=(i*this.nx-d*this.ny+this.surfacex)*this.c1.tMass;d=this.c1.friction*this.c1.jnAcc;a=this.c1.jtAcc;e=a-c;e>d?e=d:e<-d&&(e=-d);c=e-a;this.c1.jtAcc=e;a=-this.ny*c;b=this.nx*c;this.b2.velx+=a*this.b2.imass;
this.b2.vely+=b*this.b2.imass;this.b1.velx-=a*this.b1.imass;this.b1.vely-=b*this.b1.imass;this.b2.angvel+=this.rt1b*c*this.b2.iinertia;this.b1.angvel-=this.rt1a*c*this.b1.iinertia;this.hc2?(e=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),b=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel),c=(b*this.nx-e*this.ny+this.surfacex)*this.c2.tMass,d=this.c2.friction*this.c2.jnAcc,a=this.c2.jtAcc,e=a-c,e>d?e=d:e<-d&&(e=-d),
c=e-a,this.c2.jtAcc=e,a=-this.ny*c,b=this.nx*c,this.b2.velx+=a*this.b2.imass,this.b2.vely+=b*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=b*this.b1.imass,this.b2.angvel+=this.rt2b*c*this.b2.iinertia,this.b1.angvel-=this.rt2a*c*this.b1.iinertia,d=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),i=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),e=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-
this.c2.r1y*this.b1.angvel),b=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel),c=this.c1.jnAcc,a=this.c2.jnAcc,d=d*this.nx+i*this.ny+this.surfacey+this.c1.bounce-(this.Ka*c+this.Kb*a),e=e*this.nx+b*this.ny+this.surfacey+this.c2.bounce-(this.Kb*c+this.Kc*a),b=-(this.kMassa*d+this.kMassb*e),i=-(this.kMassb*d+this.kMassc*e),0<=b&&0<=i?(d=b-c,e=i-a,this.c1.jnAcc=b,this.c2.jnAcc=i):(b=-this.c1.nMass*d,0<=b&&0<=this.Kb*b+e?(d=b-c,e=-a,this.c1.jnAcc=b,this.c2.jnAcc=
0):(i=-this.c2.nMass*e,0<=i&&0<=this.Kb*i+d?(d=-c,e=i-a,this.c1.jnAcc=0,this.c2.jnAcc=i):0<=d&&0<=e?(d=-c,e=-a,this.c1.jnAcc=this.c2.jnAcc=0):e=d=0)),c=d+e,a=this.nx*c,b=this.ny*c,this.b2.velx+=a*this.b2.imass,this.b2.vely+=b*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=b*this.b1.imass,this.b2.angvel+=(this.rn1b*d+this.rn2b*e)*this.b2.iinertia,this.b1.angvel-=(this.rn1a*d+this.rn2a*e)*this.b1.iinertia):(0!=this.radius&&(c=(this.b2.angvel-this.b1.angvel)*this.rMass,d=this.rfric*this.c1.jnAcc,
a=this.jrAcc,this.jrAcc-=c,this.jrAcc>d?this.jrAcc=d:this.jrAcc<-d&&(this.jrAcc=-d),c=this.jrAcc-a,this.b2.angvel+=c*this.b2.iinertia,this.b1.angvel-=c*this.b1.iinertia),d=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),i=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),c=(this.c1.bounce+(this.nx*d+this.ny*i)+this.surfacey)*this.c1.nMass,a=this.c1.jnAcc,e=a-c,0>e&&(e=0),c=e-a,this.c1.jnAcc=e,a=this.nx*c,b=this.ny*
c,this.b2.velx+=a*this.b2.imass,this.b2.vely+=b*this.b2.imass,this.b1.velx-=a*this.b1.imass,this.b1.vely-=b*this.b1.imass,this.b2.angvel+=this.rn1b*c*this.b2.iinertia,this.b1.angvel-=this.rn1a*c*this.b1.iinertia)},applyImpulsePos:function(){if(2==this.ptype){var a=this.c1,b=0,c=0,b=this.b2.axisy*a.lr2x-this.b2.axisx*a.lr2y,c=a.lr2x*this.b2.axisx+a.lr2y*this.b2.axisy,b=b+1*this.b2.posx,c=c+1*this.b2.posy,d=0,e=0,d=this.b1.axisy*a.lr1x-this.b1.axisx*a.lr1y,e=a.lr1x*this.b1.axisx+a.lr1y*this.b1.axisy,
d=d+1*this.b1.posx,e=e+1*this.b1.posy,i=a=0,a=b-d,i=c-e,f=Math.sqrt(a*a+i*i),g=this.radius-t.collisionSlop,h=f-g;0>a*this.nx+i*this.ny&&(a=-a,i=-i,h-=this.radius);0>h&&(f<t.epsilon?0!=this.b1.smass?this.b1.posx+=10*t.epsilon:this.b2.posx+=10*t.epsilon:(h=1/f,a*=h,i*=h,b=0.5*(d+b),c=0.5*(e+c),d=b-this.b1.posx,e=c-this.b1.posy,b-=this.b2.posx,c-=this.b2.posy,d=i*d-a*e,b=i*b-a*c,c=this.b2.smass+b*b*this.b2.sinertia+this.b1.smass+d*d*this.b1.sinertia,0!=c&&(f=-this.biasCoef*(f-g)/c,c=g=0,g=a*f,c=i*f,
a=this.b1.imass,this.b1.posx-=g*a,this.b1.posy-=c*a,this.b1.delta_rot(-d*this.b1.iinertia*f),a=this.b2.imass,this.b2.posx+=g*a,this.b2.posy+=c*a,this.b2.delta_rot(b*this.b2.iinertia*f))))}else{var j=h=i=a=0,e=b=0;0==this.ptype?(a=this.b1.axisy*this.lnormx-this.b1.axisx*this.lnormy,i=this.lnormx*this.b1.axisx+this.lnormy*this.b1.axisy,g=this.lproj+(a*this.b1.posx+i*this.b1.posy),h=this.b2.axisy*this.c1.lr1x-this.b2.axisx*this.c1.lr1y,j=this.c1.lr1x*this.b2.axisx+this.c1.lr1y*this.b2.axisy,h+=1*this.b2.posx,
j+=1*this.b2.posy,this.hpc2&&(b=this.b2.axisy*this.c2.lr1x-this.b2.axisx*this.c2.lr1y,e=this.c2.lr1x*this.b2.axisx+this.c2.lr1y*this.b2.axisy,b+=1*this.b2.posx,e+=1*this.b2.posy)):(a=this.b2.axisy*this.lnormx-this.b2.axisx*this.lnormy,i=this.lnormx*this.b2.axisx+this.lnormy*this.b2.axisy,g=this.lproj+(a*this.b2.posx+i*this.b2.posy),h=this.b1.axisy*this.c1.lr1x-this.b1.axisx*this.c1.lr1y,j=this.c1.lr1x*this.b1.axisx+this.c1.lr1y*this.b1.axisy,h+=1*this.b1.posx,j+=1*this.b1.posy,this.hpc2&&(b=this.b1.axisy*
this.c2.lr1x-this.b1.axisx*this.c2.lr1y,e=this.c2.lr1x*this.b1.axisx+this.c2.lr1y*this.b1.axisy,b+=1*this.b1.posx,e+=1*this.b1.posy));f=h*a+j*i-g-this.radius;f+=t.collisionSlop;c=0;this.hpc2&&(c=b*a+e*i-g-this.radius,c+=t.collisionSlop);if(0>f||0>c){this.rev&&(a=-a,i=-i);var k=0,l=0,k=h-this.b1.posx,l=j-this.b1.posy,d=g=0,g=h-this.b2.posx,d=j-this.b2.posy,n=0,o=0,j=h=0;if(this.hpc2){n=b-this.b1.posx;o=e-this.b1.posy;h=b-this.b2.posx;j=e-this.b2.posy;b=i*k-a*l;g=i*g-a*d;e=i*n-a*o;d=i*h-a*j;h=this.b1.smass+
this.b2.smass;this.kMassa=h+this.b1.sinertia*b*b+this.b2.sinertia*g*g;this.kMassb=h+this.b1.sinertia*b*e+this.b2.sinertia*g*d;this.kMassc=h+this.b1.sinertia*e*e+this.b2.sinertia*d*d;k=j=h=0;h=this.kMassa;j=this.kMassb;k=this.kMassc;l=f*this.biasCoef;n=c*this.biasCoef;c=f=0;f=-l;c=-n;o=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(o!=o)f=c=0;else if(0==o)f=0!=this.kMassa?f/this.kMassa:0,c=0!=this.kMassc?c/this.kMassc:0;else var o=1/o,p=o*(this.kMassc*f-this.kMassb*c),c=o*(this.kMassa*c-this.kMassb*
f),f=p;0<=f&&0<=c?(h=(f+c)*this.b1.imass,this.b1.posx-=a*h,this.b1.posy-=i*h,this.b1.delta_rot(-this.b1.iinertia*(b*f+e*c)),b=(f+c)*this.b2.imass,this.b2.posx+=a*b,this.b2.posy+=i*b,this.b2.delta_rot(this.b2.iinertia*(g*f+d*c))):(f=-l/h,c=0,0<=f&&0<=j*f+n?(h=(f+c)*this.b1.imass,this.b1.posx-=a*h,this.b1.posy-=i*h,this.b1.delta_rot(-this.b1.iinertia*(b*f+e*c)),b=(f+c)*this.b2.imass,this.b2.posx+=a*b,this.b2.posy+=i*b,this.b2.delta_rot(this.b2.iinertia*(g*f+d*c))):(f=0,c=-n/k,0<=c&&0<=j*c+l&&(h=(f+
c)*this.b1.imass,this.b1.posx-=a*h,this.b1.posy-=i*h,this.b1.delta_rot(-this.b1.iinertia*(b*f+e*c)),b=(f+c)*this.b2.imass,this.b2.posx+=a*b,this.b2.posy+=i*b,this.b2.delta_rot(this.b2.iinertia*(g*f+d*c)))))}else b=i*k-a*l,g=i*g-a*d,c=this.b2.smass+g*g*this.b2.sinertia+this.b1.smass+b*b*this.b1.sinertia,0!=c&&(f=-this.biasCoef*f/c,d=c=0,c=a*f,d=i*f,a=this.b1.imass,this.b1.posx-=c*a,this.b1.posy-=d*a,this.b1.delta_rot(-b*this.b1.iinertia*f),a=this.b2.imass,this.b2.posx+=c*a,this.b2.posy+=d*a,this.b2.delta_rot(g*
this.b2.iinertia*f))}}},__class__:Jb});var Ab=function(){this.length=0;this._inuse=this.modified=this.pushmod=!1;this.next=null;this.dist=this.elasticity=0;this.fresh=!1;this.stamp=this.hash=0;this.active=this.posOnly=!1;this.arbiter=this.inner=null;this.px=this.py=0;this.outer=null;this.inner=new Jh};h["zpp_nape.dynamics.ZPP_Contact"]=Ab;Ab.__name__=!0;Ab.prototype={wrapper:function(){null==this.outer&&(Ab.internal=!0,this.outer=new Ji,Ab.internal=!1,this.outer.zpp_inner=this);return this.outer},
inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.next;this.next=a.next;a._inuse=!1;null==this.next&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_pop_unsafe:function(){var a=this.next;this.pop();return a},inlined_erase:function(a){var b,c;null==a?(b=this.next,this.next=c=b.next,null==this.next&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=
!0));b._inuse=!1;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Ab};var Jh=function(){this.length=0;this._inuse=this.modified=this.pushmod=!1;this.next=null;this.r1x=this.r1y=this.r2x=this.r2y=this.nMass=this.tMass=this.bounce=this.friction=this.jnAcc=this.jtAcc=this.lr1x=this.lr1y=this.lr2x=this.lr2y=0};h["zpp_nape.dynamics.ZPP_IContact"]=Jh;Jh.__name__=!0;Jh.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=
a;this.modified=!0;this.length++;return a},inlined_pop:function(){var a=this.next;this.next=a.next;a._inuse=!1;null==this.next&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_erase:function(a){var b,c;null==a?(b=this.next,this.next=c=b.next,null==this.next&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));b._inuse=!1;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Jh};var Sa=function(){this.collisionGroup=this.collisionMask=this.sensorGroup=
this.sensorMask=this.fluidGroup=this.fluidMask=0;this.next=this.outer=this.shapes=null;this.shapes=new Ke;this.collisionGroup=this.sensorGroup=this.fluidGroup=1;this.collisionMask=this.sensorMask=this.fluidMask=-1};h["zpp_nape.dynamics.ZPP_InteractionFilter"]=Sa;Sa.__name__=!0;Sa.prototype={wrapper:function(){if(null==this.outer){this.outer=new Ki;var a=this.outer.zpp_inner;a.outer=null;a.next=Sa.zpp_pool;Sa.zpp_pool=a;this.outer.zpp_inner=this}return this.outer},shouldCollide:function(a){return 0!=
(this.collisionMask&a.collisionGroup)&&0!=(a.collisionMask&this.collisionGroup)},shouldSense:function(a){return 0!=(this.sensorMask&a.sensorGroup)&&0!=(a.sensorMask&this.sensorGroup)},shouldFlow:function(a){return 0!=(this.fluidMask&a.fluidGroup)&&0!=(a.fluidMask&this.fluidGroup)},invalidate:function(){for(var a=this.shapes.head;null!=a;)a.elt.invalidate_filter(),a=a.next},__class__:Sa};var rk=function(){this.depth=0;this.group=this.interactors=null;this.ignore=!1;this.outer=null};h["zpp_nape.dynamics.ZPP_InteractionGroup"]=
rk;rk.__name__=!0;rk.prototype={__class__:rk};var za=function(){this.wrap_max=null;this.maxx=this.maxy=0;this.wrap_min=null;this.minx=this.miny=0;this.outer=this.next=null;this._immutable=!1;this._invalidate=this._validate=null};h["zpp_nape.geom.ZPP_AABB"]=za;za.__name__=!0;za.get=function(a,b,c,d){var e;null==za.zpp_pool?e=new za:(e=za.zpp_pool,za.zpp_pool=e.next,e.next=null);null;e.minx=a;e.miny=b;e.maxx=c;e.maxy=d;return e};za.prototype={validate:function(){null!=this._validate&&this._validate()},
perimeter:function(){return 2*(this.maxx-this.minx+(this.maxy-this.miny))},intersectY:function(a){return!(a.miny>this.maxy||this.miny>a.maxy)},intersect:function(a){return a.miny<=this.maxy&&this.miny<=a.maxy&&a.minx<=this.maxx&&this.minx<=a.maxx},combine:function(a){a.minx<this.minx&&(this.minx=a.minx);a.maxx>this.maxx&&(this.maxx=a.maxx);a.miny<this.miny&&(this.miny=a.miny);a.maxy>this.maxy&&(this.maxy=a.maxy)},contains:function(a){return a.minx>=this.minx&&a.miny>=this.miny&&a.maxx<=this.maxx&&
a.maxy<=this.maxy},setCombine:function(a,b){this.minx=a.minx<b.minx?a.minx:b.minx;this.miny=a.miny<b.miny?a.miny:b.miny;this.maxx=a.maxx>b.maxx?a.maxx:b.maxx;this.maxy=a.maxy>b.maxy?a.maxy:b.maxy},setExpand:function(a,b){this.minx=a.minx-b;this.miny=a.miny-b;this.maxx=a.maxx+b;this.maxy=a.maxy+b},toString:function(){return"{ x: "+this.minx+" y: "+this.miny+" w: "+(this.maxx-this.minx)+" h: "+(this.maxy-this.miny)+" }"},__class__:za};var Cf=function(){this.length=0;this.modified=this.pushmod=!1;this.head=
null};h["zpp_nape.util.ZNPList_ZPP_Vec2"]=Cf;Cf.__name__=!0;Cf.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==pb.zpp_pool?b=new pb:(b=pb.zpp_pool,pb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==pb.zpp_pool?c=new pb:(c=pb.zpp_pool,pb.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,
this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=pb.zpp_pool;pb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,
c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=pb.zpp_pool;pb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},clear:function(){for(;null!=this.head;)this.inlined_pop();this.pushmod=!0},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Cf};var H=function(){};h["zpp_nape.geom.ZPP_Collide"]=H;H.__name__=!0;H.contactCollide=function(a,
b,c,d){if(b.type==f.id_ShapeType_POLYGON)if(a.type==f.id_ShapeType_POLYGON){for(var e=!0,i=-1.0E100,g=-1,h=null,j=null,k=a.polygon.edges.head;null!=k;){for(var l=k.elt,n=1.0E100,o=b.polygon.gverts.next;null!=o;){var p=o,p=l.gnormx*p.x+l.gnormy*p.y;p<n&&(n=p);if(n-l.gprojection<=i)break;o=o.next}n-=l.gprojection;if(0<=n){e=!1;break}n>i&&(i=n,h=l,g=1);k=k.next}if(e){for(k=b.polygon.edges.head;null!=k;){l=k.elt;n=1.0E100;for(o=a.polygon.gverts.next;null!=o;){p=o;p=l.gnormx*p.x+l.gnormy*p.y;p<n&&(n=p);
if(n-l.gprojection<=i)break;o=o.next}n-=l.gprojection;if(0<=n){e=!1;break}n>i&&(i=n,j=l,g=2);k=k.next}if(e){1==g?(a=b.polygon,b=h,j=1):(a=a.polygon,b=j,j=-1);h=null;e=1.0E100;for(i=a.edges.head;null!=i;)k=i.elt,l=b.gnormx*k.gnormx+b.gnormy*k.gnormy,l<e&&(e=l,h=k),i=i.next;var i=e=0,e=h.gp0.x,i=h.gp0.y,l=k=0,k=h.gp1.x,l=h.gp1.y,o=n=0,n=k-e,o=l-i,q=b.gnormy*e-b.gnormx*i,p=b.gnormy*k-b.gnormx*l,u=1/(p-q),q=(-b.tp1-q)*u;q>t.epsilon&&(e+=n*q,i+=o*q);p=(-b.tp0-p)*u;p<-t.epsilon&&(k+=n*p,l+=o*p);o=n=0;o=
j;n=b.gnormx*o;o*=b.gnormy;c.lnormx=b.lnormx;c.lnormy=b.lnormy;c.lproj=b.lprojection;c.radius=0;c.rev=d!=(-1==j);c.ptype=c.rev?1:0;p=e*b.gnormx+i*b.gnormy-b.gprojection;j=k*b.gnormx+l*b.gnormy-b.gprojection;if(0<p&&0<j)return!1;d&&(n=-n,o=-o);d=c.injectContact(e-0.5*b.gnormx*p,i-0.5*b.gnormy*p,n,o,p,c.rev?1:0,0<p);e-=1*a.body.posx;i-=1*a.body.posy;d.inner.lr1x=e*a.body.axisy+i*a.body.axisx;d.inner.lr1y=i*a.body.axisy-e*a.body.axisx;d=c.injectContact(k-0.5*b.gnormx*j,l-0.5*b.gnormy*j,n,o,j,c.rev?0:
1,0<j);k-=1*a.body.posx;l-=1*a.body.posy;d.inner.lr1x=k*a.body.axisy+l*a.body.axisx;d.inner.lr1y=l*a.body.axisy-k*a.body.axisx;1==g?(c.__ref_edge1=b,c.__ref_edge2=h):(c.__ref_edge2=b,c.__ref_edge1=h);return!0}}}else{j=-1.0E100;h=!0;e=g=null;i=b.polygon.gverts.next;for(k=b.polygon.edges.head;null!=k;){l=k.elt;n=l.gnormx*a.circle.worldCOMx+l.gnormy*a.circle.worldCOMy-l.gprojection-a.circle.radius;if(0<n){h=!1;break}n>j&&(j=n,g=l,e=i);i=i.next;k=k.next}if(h){h=e;e=null==e.next?b.polygon.gverts.next:
e.next;i=a.circle.worldCOMy*g.gnormx-a.circle.worldCOMx*g.gnormy;if(i<=h.y*g.gnormx-h.x*g.gnormy)return j=a.circle.radius,i=e=0,e=h.x-a.circle.worldCOMx,i=h.y-a.circle.worldCOMy,k=e*e+i*i,k>j*j?j=null:k<t.epsilon*t.epsilon?j=c.injectContact(a.circle.worldCOMx,a.circle.worldCOMy,1,0,-j,0,null):(k=1/Math.sqrt(k),l=k<t.epsilon?1.0E100:1/k,n=0.5+(a.circle.radius-0.5*j)*k,j=d?c.injectContact(a.circle.worldCOMx+e*n,a.circle.worldCOMy+i*n,-e*k,-i*k,l-j,0,null):c.injectContact(a.circle.worldCOMx+e*n,a.circle.worldCOMy+
i*n,e*k,i*k,l-j,0,null)),null!=j&&(e=j.inner,c.ptype=2,k=i=0,i=h.x-b.polygon.body.posx,k=h.y-b.polygon.body.posy,c.__ref_edge1=g,c.__ref_vertex=-1,d?(e.lr1x=i*b.polygon.body.axisy+k*b.polygon.body.axisx,e.lr1y=k*b.polygon.body.axisy-i*b.polygon.body.axisx,e.lr2x=a.circle.localCOMx,e.lr2y=a.circle.localCOMy):(e.lr2x=i*b.polygon.body.axisy+k*b.polygon.body.axisx,e.lr2y=k*b.polygon.body.axisy-i*b.polygon.body.axisx,e.lr1x=a.circle.localCOMx,e.lr1y=a.circle.localCOMy),c.radius=a.circle.radius),null!=
j;if(i>=e.y*g.gnormx-e.x*g.gnormy)return h=a.circle.radius,i=j=0,j=e.x-a.circle.worldCOMx,i=e.y-a.circle.worldCOMy,k=j*j+i*i,k>h*h?h=null:k<t.epsilon*t.epsilon?h=c.injectContact(a.circle.worldCOMx,a.circle.worldCOMy,1,0,-h,0,null):(k=1/Math.sqrt(k),l=k<t.epsilon?1.0E100:1/k,n=0.5+(a.circle.radius-0.5*h)*k,h=d?c.injectContact(a.circle.worldCOMx+j*n,a.circle.worldCOMy+i*n,-j*k,-i*k,l-h,0,null):c.injectContact(a.circle.worldCOMx+j*n,a.circle.worldCOMy+i*n,j*k,i*k,l-h,0,null)),null!=h&&(j=h.inner,c.ptype=
2,k=i=0,i=e.x-b.polygon.body.posx,k=e.y-b.polygon.body.posy,c.__ref_edge1=g,c.__ref_vertex=1,d?(j.lr1x=i*b.polygon.body.axisy+k*b.polygon.body.axisx,j.lr1y=k*b.polygon.body.axisy-i*b.polygon.body.axisx,j.lr2x=a.circle.localCOMx,j.lr2y=a.circle.localCOMy):(j.lr2x=i*b.polygon.body.axisy+k*b.polygon.body.axisx,j.lr2y=k*b.polygon.body.axisy-i*b.polygon.body.axisx,j.lr1x=a.circle.localCOMx,j.lr1y=a.circle.localCOMy),c.radius=a.circle.radius),null!=h;h=b=0;h=a.circle.radius+0.5*j;b=g.gnormx*h;h*=g.gnormy;
i=e=0;e=a.circle.worldCOMx-b;i=a.circle.worldCOMy-h;b=d?c.injectContact(e,i,g.gnormx,g.gnormy,j,0,null):c.injectContact(e,i,-g.gnormx,-g.gnormy,j,0,null);c.ptype=d?0:1;c.lnormx=g.lnormx;c.lnormy=g.lnormy;c.rev=!d;c.lproj=g.lprojection;c.radius=a.circle.radius;b.inner.lr1x=a.circle.localCOMx;b.inner.lr1y=a.circle.localCOMy;c.__ref_edge1=g;c.__ref_vertex=0;return!0}}else if(g=a.circle.radius+b.circle.radius,j=h=0,h=b.circle.worldCOMx-a.circle.worldCOMx,j=b.circle.worldCOMy-a.circle.worldCOMy,e=h*h+
j*j,e>g*g?g=null:e<t.epsilon*t.epsilon?g=c.injectContact(a.circle.worldCOMx,a.circle.worldCOMy,1,0,-g,0,null):(e=1/Math.sqrt(e),i=e<t.epsilon?1.0E100:1/e,k=0.5+(a.circle.radius-0.5*g)*e,g=d?c.injectContact(a.circle.worldCOMx+h*k,a.circle.worldCOMy+j*k,-h*e,-j*e,i-g,0,null):c.injectContact(a.circle.worldCOMx+h*k,a.circle.worldCOMy+j*k,h*e,j*e,i-g,0,null)),null!=g)return g=g.inner,d?(g.lr1x=b.circle.localCOMx,g.lr1y=b.circle.localCOMy,g.lr2x=a.circle.localCOMx,g.lr2y=a.circle.localCOMy):(g.lr1x=a.circle.localCOMx,
g.lr1y=a.circle.localCOMy,g.lr2x=b.circle.localCOMx,g.lr2y=b.circle.localCOMy),c.radius=a.circle.radius+b.circle.radius,c.ptype=2,!0;return!1};H.testCollide_safe=function(a,b){if(b.type==f.id_ShapeType_CIRCLE)var c=a,a=b,b=c;return H.testCollide(a,b)};H.testCollide=function(a,b){if(b.type==f.id_ShapeType_POLYGON){if(a.type==f.id_ShapeType_POLYGON){for(var c=!0,d=a.polygon.edges.head;null!=d;){for(var e=d.elt,i=1.0E100,g=b.polygon.gverts.next;null!=g;){var h=g,h=e.gnormx*h.x+e.gnormy*h.y;h<i&&(i=h);
g=g.next}i-=e.gprojection;if(0<i){c=!1;break}d=d.next}if(c){for(d=b.polygon.edges.head;null!=d;){e=d.elt;i=1.0E100;for(g=a.polygon.gverts.next;null!=g;)h=g,h=e.gnormx*h.x+e.gnormy*h.y,h<i&&(i=h),g=g.next;i-=e.gprojection;if(0<i){c=!1;break}d=d.next}return c}}else{d=c=null;e=!0;i=-1.0E100;g=b.polygon.gverts.next;for(h=b.polygon.edges.head;null!=h;){var j=h.elt,k=j.gnormx*a.circle.worldCOMx+j.gnormy*a.circle.worldCOMy-j.gprojection-a.circle.radius;if(0<k){e=!1;break}k>i&&(i=k,c=j,d=g);g=g.next;h=h.next}if(e){e=
d;d=null==d.next?b.polygon.gverts.next:d.next;i=a.circle.worldCOMy*c.gnormx-a.circle.worldCOMx*c.gnormy;if(i<=e.y*c.gnormx-e.x*c.gnormy)return c=a.circle.radius,i=d=0,d=e.x-a.circle.worldCOMx,i=e.y-a.circle.worldCOMy,d*d+i*i<=c*c;return i>=d.y*c.gnormx-d.x*c.gnormy?(c=a.circle.radius,i=e=0,e=d.x-a.circle.worldCOMx,i=d.y-a.circle.worldCOMy,e*e+i*i<=c*c):!0}}return!1}c=a.circle.radius+b.circle.radius;e=d=0;d=b.circle.worldCOMx-a.circle.worldCOMx;e=b.circle.worldCOMy-a.circle.worldCOMy;return d*d+e*
e<=c*c};H.flowCollide=function(a,b,c){if(b.type==f.id_ShapeType_POLYGON){if(a.type==f.id_ShapeType_POLYGON){for(var d=[],e=[],i=!0,g=!0,h=a.polygon.edges.head;null!=h;){for(var j=h.elt,k=1.0E100,l=0,n=b.polygon.gverts.next;null!=n;){var o=n,p=j.gnormx*o.x+j.gnormy*o.y;p<k&&(k=p);p>=j.gprojection+t.epsilon&&(e[l]=!0,g=!1);l++;n=n.next}k-=j.gprojection;if(0<k){i=!1;break}h=h.next}if(g)return b.polygon.validate_worldCOM(),c.overlap=b.polygon.area,c.centroidx=b.polygon.worldCOMx,c.centroidy=b.polygon.worldCOMy,
null,!0;if(i){for(var g=!0,q=b.polygon.edges.head;null!=q;){for(var u=q.elt,w=1.0E100,y=0,v=a.polygon.gverts.next;null!=v;){var x=v,A=u.gnormx*x.x+u.gnormy*x.y;A<w&&(w=A);A>=u.gprojection+t.epsilon&&(d[y]=!0,g=!1);y++;v=v.next}w-=u.gprojection;if(0<w){i=!1;break}q=q.next}if(g)return a.polygon.validate_worldCOM(),c.overlap=a.polygon.area,c.centroidx=a.polygon.worldCOMx,c.centroidy=a.polygon.worldCOMy,null,!0;if(i){for(;null!=H.flowpoly.head;){var B=H.flowpoly.pop_unsafe();if(!B._inuse){var C=B;null!=
C.outer&&(C.outer.zpp_inner=null,C.outer=null);C._isimmutable=null;C._validate=null;C._invalidate=null;C.next=ia.zpp_pool;ia.zpp_pool=C}}for(var s=null,E=!1,D=a.polygon.gverts.next,G=0,I=b.polygon.gverts.next,K=0,N=0,S=b.polygon.edgeCnt;N<S;){var M=N++;if(e[M])I=I.next;else{K=M;break}}if(null==I){for(var I=b.polygon.gverts.next,E=!0,R=0,Y=a.polygon.edgeCnt;R<Y;){var T=R++;if(d[T])D=D.next;else{G=T;break}}null==D?D=a.polygon.gverts.next:(H.flowpoly.add(D),s=H.flowpoly.head.elt)}else H.flowpoly.add(I),
s=H.flowpoly.head.elt;var P=1;if(null==H.flowpoly.head){for(var X=!0,ca=a.polygon.gverts.next,F=ca,aa=ca.next;null!=aa;){for(var L=aa,ba=2,ea=b.polygon.gverts.next,V=ea,Z=ea.next;null!=Z;){var da=Z,W=0;(function(){var a=0,b=0,a=F.x-V.x,b=F.y-V.y,c=0,d=0,c=L.x-F.x,d=L.y-F.y,e=0,i=0,e=da.x-V.x,i=da.y-V.y,f=d*e-c*i;f*f>t.epsilon*t.epsilon?(f=1/f,e=(i*a-e*b)*f,e>t.epsilon&&e<1-t.epsilon?(a=(d*a-c*b)*f,a>t.epsilon&&a<1-t.epsilon?(W=e,a=!0):a=!1):a=!1):a=!1;return a})(this)&&W<ba&&(ba=W,I=ea);ea=Z;V=da;
Z=Z.next}var pa=Z=b.polygon.gverts.next,ja=0;(function(){var a=0,b=0,a=F.x-V.x,b=F.y-V.y,c=0,d=0,c=L.x-F.x,d=L.y-F.y,e=0,i=0,e=pa.x-V.x,i=pa.y-V.y,f=d*e-c*i;f*f>t.epsilon*t.epsilon?(f=1/f,e=(i*a-e*b)*f,e>t.epsilon&&e<1-t.epsilon?(a=(d*a-c*b)*f,a>t.epsilon&&a<1-t.epsilon?(ja=e,a=!0):a=!1):a=!1):a=!1;return a})(this)&&ja<ba&&(ba=ja,I=ea);if(2!=ba){var O=0,ka=0,ta=ba,O=F.x+(L.x-F.x)*ta,ka=F.y+(L.y-F.y)*ta,s=ia.get(O,ka,null);H.flowpoly.add(s);E=!0;D=ca;X=!1;break}ca=aa;F=L;aa=aa.next}if(X){for(var ha=
aa=a.polygon.gverts.next,z=2,na=b.polygon.gverts.next,fa=na,ma=na.next;null!=ma;){var Ba=ma,Jk=0;(function(){var a=0,b=0,a=F.x-fa.x,b=F.y-fa.y,c=0,d=0,c=ha.x-F.x,d=ha.y-F.y,e=0,i=0,e=Ba.x-fa.x,i=Ba.y-fa.y,f=d*e-c*i;f*f>t.epsilon*t.epsilon?(f=1/f,e=(i*a-e*b)*f,e>t.epsilon&&e<1-t.epsilon?(a=(d*a-c*b)*f,a>t.epsilon&&a<1-t.epsilon?(Jk=e,a=!0):a=!1):a=!1):a=!1;return a})(this)&&Jk<z&&(z=Jk,I=na);na=ma;fa=Ba;ma=ma.next}var Q=ma=b.polygon.gverts.next,ya=0;(function(){var a=0,b=0,a=F.x-fa.x,b=F.y-fa.y,c=
0,d=0,c=ha.x-F.x,d=ha.y-F.y,e=0,i=0,e=Q.x-fa.x,i=Q.y-fa.y,f=d*e-c*i;f*f>t.epsilon*t.epsilon?(f=1/f,e=(i*a-e*b)*f,e>t.epsilon&&e<1-t.epsilon?(a=(d*a-c*b)*f,a>t.epsilon&&a<1-t.epsilon?(ya=e,a=!0):a=!1):a=!1):a=!1;return a})(this)&&ya<z&&(z=ya,I=na);if(2!=z){var ua=0,sa=0,Nk=z,ua=F.x+(ha.x-F.x)*Nk,sa=F.y+(ha.y-F.y)*Nk,s=ia.get(ua,sa,null);H.flowpoly.add(s);E=!0;D=ca}}P=2}for(;;)if(E)if(D=D.next,G++,null==D&&(D=a.polygon.gverts.next,G=0),d[G]){var Aa=H.flowpoly.head.elt,qa=D,ra=I,U=I.next;null==U&&(U=
b.polygon.gverts.next);var wa=-1,ga=null,Ca=0,Fa=0,Ja=U,la=U;do{var Qa=la,za=0;if(function(){var a=0,b=0,a=ra.x-Aa.x,b=ra.y-Aa.y,c=0,d=0,c=Qa.x-ra.x,d=Qa.y-ra.y,e=0,i=0,e=qa.x-Aa.x,i=qa.y-Aa.y,f=d*e-c*i;f*f>t.epsilon*t.epsilon?(f=1/f,e=(i*a-e*b)*f,e>t.epsilon&&e<1-t.epsilon?(a=(d*a-c*b)*f,a>t.epsilon&&a<1-t.epsilon?(za=e,a=!0):a=!1):a=!1):a=!1;return a}(this)&&za>=wa)if(ga=I,Ca=K,++Fa==P){wa=za;la=Ja;break}else wa=za;ra=Qa;I=la;K++;K>=b.polygon.edgeCnt&&(K=0);la=la.next;null==la&&(la=b.polygon.gverts.next)}while(0);
for(;la!=Ja;){var Ua=la,oa=0;if(function(){var a=0,b=0,a=ra.x-Aa.x,b=ra.y-Aa.y,c=0,d=0,c=Ua.x-ra.x,d=Ua.y-ra.y,e=0,i=0,e=qa.x-Aa.x,i=qa.y-Aa.y,f=d*e-c*i;f*f>t.epsilon*t.epsilon?(f=1/f,e=(i*a-e*b)*f,e>t.epsilon&&e<1-t.epsilon?(a=(d*a-c*b)*f,a>t.epsilon&&a<1-t.epsilon?(oa=e,a=!0):a=!1):a=!1):a=!1;return a}(this)&&oa>=wa)if(ga=I,Ca=K,++Fa==P){wa=oa;la=Ja;break}else wa=oa;ra=Ua;I=la;K++;K>=b.polygon.edgeCnt&&(K=0);la=la.next;null==la&&(la=b.polygon.gverts.next)}if(null==ga)break;var gb=ga,Pa=ga.next;
null==Pa&&(Pa=b.polygon.gverts.next);var Ra=Pa,lb=0,Kk=0,$a=wa,lb=gb.x+(Ra.x-gb.x)*$a,Kk=gb.y+(Ra.y-gb.y)*$a;if(null!=s&&Kb.vec_dsq(lb,Kk,s.x,s.y)<t.epsilon)break;H.flowpoly.add(ia.get(lb,Kk,null));null==s&&(s=H.flowpoly.head.elt);I=ga;K=Ca;E=!E;P=2}else{var Ta=D;if(null!=s&&Kb.vec_dsq(Ta.x,Ta.y,s.x,s.y)<t.epsilon)break;H.flowpoly.add(Ta);null==s&&(s=H.flowpoly.head.elt);P=1}else if(I=I.next,K++,null==I&&(I=b.polygon.gverts.next,K=0),e[K]){var Ka=H.flowpoly.head.elt,bb=I,J=D,Oa=D.next;null==Oa&&(Oa=
a.polygon.gverts.next);var Ga=-1,db=null,Da=0,rb=0,kb=Oa,td=Oa;do{var qb=td,cb=0;if(function(){var a=0,b=0,a=J.x-Ka.x,b=J.y-Ka.y,c=0,d=0,c=qb.x-J.x,d=qb.y-J.y,e=0,i=0,e=bb.x-Ka.x,i=bb.y-Ka.y,f=d*e-c*i;f*f>t.epsilon*t.epsilon?(f=1/f,e=(i*a-e*b)*f,e>t.epsilon&&e<1-t.epsilon?(a=(d*a-c*b)*f,a>t.epsilon&&a<1-t.epsilon?(cb=e,a=!0):a=!1):a=!1):a=!1;return a}(this)&&cb>=Ga)if(db=D,Da=G,++rb==P){Ga=cb;td=kb;break}else Ga=cb;J=qb;D=td;G++;G>=a.polygon.edgeCnt&&(G=0);td=td.next;null==td&&(td=a.polygon.gverts.next)}while(0);
for(;td!=kb;){var mb=td,Sa=0;if(function(){var a=0,b=0,a=J.x-Ka.x,b=J.y-Ka.y,c=0,d=0,c=mb.x-J.x,d=mb.y-J.y,e=0,i=0,e=bb.x-Ka.x,i=bb.y-Ka.y,f=d*e-c*i;f*f>t.epsilon*t.epsilon?(f=1/f,e=(i*a-e*b)*f,e>t.epsilon&&e<1-t.epsilon?(a=(d*a-c*b)*f,a>t.epsilon&&a<1-t.epsilon?(Sa=e,a=!0):a=!1):a=!1):a=!1;return a}(this)&&Sa>=Ga)if(db=D,Da=G,++rb==P){Ga=Sa;td=kb;break}else Ga=Sa;J=mb;D=td;G++;G>=a.polygon.edgeCnt&&(G=0);td=td.next;null==td&&(td=a.polygon.gverts.next)}if(null==db)break;var Ia=db,nb=db.next;null==
nb&&(nb=a.polygon.gverts.next);var wb=nb,ob=0,hb=0,Ab=Ga,ob=Ia.x+(wb.x-Ia.x)*Ab,hb=Ia.y+(wb.y-Ia.y)*Ab;if(null!=s&&Kb.vec_dsq(ob,hb,s.x,s.y)<t.epsilon)break;H.flowpoly.add(ia.get(ob,hb,null));null==s&&(s=H.flowpoly.head.elt);D=db;G=Da;E=!E;P=2}else{var jb=I;if(null!=s&&Kb.vec_dsq(jb.x,jb.y,s.x,s.y)<t.epsilon)break;H.flowpoly.add(jb);null==s&&(s=H.flowpoly.head.elt);P=1}if(null!=H.flowpoly.head&&null!=H.flowpoly.head.next&&null!=H.flowpoly.head.next.next){for(var ve=0,Ha=0,xa=0,ve=xa=Ha=0,ud=H.flowpoly.head,
fb=ud.elt,ud=ud.next,ib=ud.elt,ud=ud.next;null!=ud;)var Xa=ud.elt,ve=ve+ib.x*(Xa.y-fb.y),Db=Xa.y*ib.x-Xa.x*ib.y,Ha=Ha+(ib.x+Xa.x)*Db,xa=xa+(ib.y+Xa.y)*Db,fb=ib,ib=Xa,ud=ud.next;var ud=H.flowpoly.head,Kh=ud.elt,ve=ve+ib.x*(Kh.y-fb.y),Fb=Kh.y*ib.x-Kh.x*ib.y,Ha=Ha+(ib.x+Kh.x)*Fb,xa=xa+(ib.y+Kh.y)*Fb,fb=ib,ib=Kh,ud=ud.next,Ea=ud.elt,ve=ve+ib.x*(Ea.y-fb.y),Hb=Ea.y*ib.x-Ea.x*ib.y,Ha=Ha+(ib.x+Ea.x)*Hb,xa=xa+(ib.y+Ea.y)*Hb,ve=0.5*ve,Ib=1/(6*ve),Ha=Ha*Ib,xa=xa*Ib;c.overlap=-ve;c.centroidx=Ha;c.centroidy=xa;
null;return!0}}}return!1}for(var zb=[],Jb=!0,Va=null,sb=null,Nb=-1.0E100,Sb=!0,Gb=b.polygon.gverts.next,Wb=0,yb=b.polygon.edges.head;null!=yb;){var eb=yb.elt,pb=eb.gnormx*a.circle.worldCOMx+eb.gnormy*a.circle.worldCOMy;if(pb>eb.gprojection+a.circle.radius){Sb=!1;break}else pb+a.circle.radius>eb.gprojection+t.epsilon&&(Jb=!1,zb[Wb]=!0);pb-=eb.gprojection+a.circle.radius;pb>Nb&&(Nb=pb,Va=eb,sb=Gb);Gb=Gb.next;Wb++;yb=yb.next}if(Sb){if(Jb)return c.overlap=a.circle.area,c.centroidx=a.circle.worldCOMx,
c.centroidy=a.circle.worldCOMy,null,!0;var Bb=sb,ab;ab=null==sb.next?b.polygon.gverts.next:sb.next;var cc=a.circle.worldCOMy*Va.gnormx-a.circle.worldCOMx*Va.gnormy;if(cc<=Bb.y*Va.gnormx-Bb.x*Va.gnormy?function(){var b=a.circle.radius,c=0,d=0,c=Bb.x-a.circle.worldCOMx,d=Bb.y-a.circle.worldCOMy;return c*c+d*d<=b*b}(this):cc>=ab.y*Va.gnormx-ab.x*Va.gnormy?function(){var b=a.circle.radius,c=0,d=0,c=ab.x-a.circle.worldCOMx,d=ab.y-a.circle.worldCOMy;return c*c+d*d<=b*b}(this):1){for(var Cb=[],Rb=0,hc=!0,
cd=null,Na=0,xb=b.polygon.gverts.next;null!=xb;){var mc=xb,Lc=Kb.vec_dsq(mc.x,mc.y,a.circle.worldCOMx,a.circle.worldCOMy);(Cb[Rb]=Lc<=a.circle.radius*a.circle.radius)?(Na=Rb,cd=xb):hc=!1;Rb++;xb=xb.next}if(hc)return b.polygon.validate_worldCOM(),c.overlap=b.polygon.area,c.centroidx=b.polygon.worldCOMx,c.centroidy=b.polygon.worldCOMy,null,!0;for(;null!=H.flowpoly.head;){var sc=H.flowpoly.pop_unsafe();if(!sc._inuse){var Wa=sc;null!=Wa.outer&&(Wa.outer.zpp_inner=null,Wa.outer=null);Wa._isimmutable=null;
Wa._validate=null;Wa._invalidate=null;Wa.next=ia.zpp_pool;ia.zpp_pool=Wa}}H.flowsegs.clear();var Xb=null,La=1;null==cd?(cd=b.polygon.gverts.next,La=2):H.flowpoly.add(Xb=cd);for(;0!=La;)if(1==La)if(cd=cd.next,null==cd&&(cd=b.polygon.gverts.next),Na++,Na>=b.polygon.edgeCnt&&(Na=0),Cb[Na]){if(Kb.vec_dsq(Xb.x,Xb.y,cd.x,cd.y)<t.epsilon)break;H.flowpoly.add(cd)}else{var Ya=H.flowpoly.head.elt,Qb=cd,Tb=0,Ub=0,Tb=Qb.x-Ya.x,Ub=Qb.y-Ya.y,Vb=0,ac=0,Vb=Ya.x-a.circle.worldCOMx,ac=Ya.y-a.circle.worldCOMy,Lb=Tb*
Tb+Ub*Ub,bc=2*(Vb*Tb+ac*Ub),Pc=Math.sqrt(bc*bc-4*Lb*(Vb*Vb+ac*ac-a.circle.radius*a.circle.radius)),Lb=1/(2*Lb),Qc=(-bc-Pc)*Lb,uc=0,vc=0,Tc=Qc<t.epsilon?(-bc+Pc)*Lb:Qc,uc=Ya.x+(Qb.x-Ya.x)*Tc,vc=Ya.y+(Qb.y-Ya.y)*Tc;if(Kb.vec_dsq(Xb.x,Xb.y,uc,vc)<t.epsilon)break;H.flowpoly.add(ia.get(uc,vc,null));La=2}else if(2==La){var fc=cd.next;null==fc&&(fc=b.polygon.gverts.next);var va=cd,La=0,tb=fc,Yb=fc;do{var Za=Yb,lc=Na+1;lc==b.polygon.edgeCnt&&(lc=0);if(zb[Na])if(Cb[lc]){var nc=0,pc=0,nc=Za.x-va.x,pc=Za.y-
va.y,qc=0,rc=0,qc=va.x-a.circle.worldCOMx,rc=va.y-a.circle.worldCOMy,ec=nc*nc+pc*pc,tc=2*(qc*nc+rc*pc),gd=Math.sqrt(tc*tc-4*ec*(qc*qc+rc*rc-a.circle.radius*a.circle.radius)),ec=1/(2*ec),hd=(-tc-gd)*ec,Rc=0,Sc=0,id=hd<t.epsilon?(-tc+gd)*ec:hd,Rc=va.x+(Za.x-va.x)*id,Sc=va.y+(Za.y-va.y)*id;if(Kb.vec_dsq(Xb.x,Xb.y,Rc,Sc)<t.epsilon){La=0;Yb=tb;break}var jd=ia.get(Rc,Sc,null);H.flowsegs.add(H.flowpoly.head.elt);H.flowsegs.add(jd);H.flowpoly.add(jd);La=1;Yb=tb;break}else{var wc=0,xc=0,Vc,yc=0,zc=0,yc=Za.x-
va.x,zc=Za.y-va.y,Ac=0,Bc=0,Ac=va.x-a.circle.worldCOMx,Bc=va.y-a.circle.worldCOMy,Pb=yc*yc+zc*zc,gc=2*(Ac*yc+Bc*zc),Eb=gc*gc-4*Pb*(Ac*Ac+Bc*Bc-a.circle.radius*a.circle.radius);Eb*Eb<t.epsilon?(wc=0>Eb?10:xc=-gc/(2*Pb),Vc=!1):(Eb=Math.sqrt(Eb),Pb=1/(2*Pb),wc=(-gc-Eb)*Pb,xc=(-gc+Eb)*Pb,Vc=!0);if(wc<1-t.epsilon&&xc>t.epsilon){var Wc=0,Xc=0,ld=wc,Wc=va.x+(Za.x-va.x)*ld,Xc=va.y+(Za.y-va.y)*ld;if(null!=Xb&&Kb.vec_dsq(Xb.x,Xb.y,Wc,Xc)<t.epsilon){La=0;Yb=tb;break}var md=ia.get(Wc,Xc,null);null!=H.flowpoly.head&&
(H.flowsegs.add(H.flowpoly.head.elt),H.flowsegs.add(md));H.flowpoly.add(md);null==Xb&&(Xb=H.flowpoly.head.elt);if(Vc){var nd=0,od=0,pd=xc,nd=va.x+(Za.x-va.x)*pd,od=va.y+(Za.y-va.y)*pd;H.flowpoly.add(ia.get(nd,od,null))}}}va=Za;cd=Yb;Na=lc;Yb=Yb.next;null==Yb&&(Yb=b.polygon.gverts.next)}while(0);for(;Yb!=tb;){var Ma=Yb,Ec=Na+1;Ec==b.polygon.edgeCnt&&(Ec=0);if(zb[Na])if(Cb[Ec]){var Fc=0,Gc=0,Fc=Ma.x-va.x,Gc=Ma.y-va.y,Hc=0,Ic=0,Hc=va.x-a.circle.worldCOMx,Ic=va.y-a.circle.worldCOMy,kc=Fc*Fc+Gc*Gc,Jc=
2*(Hc*Fc+Ic*Gc),sd=Math.sqrt(Jc*Jc-4*kc*(Hc*Hc+Ic*Ic-a.circle.radius*a.circle.radius)),kc=1/(2*kc),wd=(-Jc-sd)*kc,dd=0,ed=0,xd=wd<t.epsilon?(-Jc+sd)*kc:wd,dd=va.x+(Ma.x-va.x)*xd,ed=va.y+(Ma.y-va.y)*xd;if(Kb.vec_dsq(Xb.x,Xb.y,dd,ed)<t.epsilon){La=0;Yb=tb;break}var yd=ia.get(dd,ed,null);H.flowsegs.add(H.flowpoly.head.elt);H.flowsegs.add(yd);H.flowpoly.add(yd);La=1;Yb=tb;break}else{var Oc=0,Uc=0,kd,Yc=0,Zc=0,Yc=Ma.x-va.x,Zc=Ma.y-va.y,$c=0,bd=0,$c=va.x-a.circle.worldCOMx,bd=va.y-a.circle.worldCOMy,oc=
Yc*Yc+Zc*Zc,Nc=2*($c*Yc+bd*Zc),dc=Nc*Nc-4*oc*($c*$c+bd*bd-a.circle.radius*a.circle.radius);dc*dc<t.epsilon?(Oc=0>dc?10:Uc=-Nc/(2*oc),kd=!1):(dc=Math.sqrt(dc),oc=1/(2*oc),Oc=(-Nc-dc)*oc,Uc=(-Nc+dc)*oc,kd=!0);if(Oc<1-t.epsilon&&Uc>t.epsilon){var Bd=0,Cd=0,Ld=Oc,Bd=va.x+(Ma.x-va.x)*Ld,Cd=va.y+(Ma.y-va.y)*Ld;if(null!=Xb&&Kb.vec_dsq(Xb.x,Xb.y,Bd,Cd)<t.epsilon){La=0;Yb=tb;break}var Md=ia.get(Bd,Cd,null);null!=H.flowpoly.head&&(H.flowsegs.add(H.flowpoly.head.elt),H.flowsegs.add(Md));H.flowpoly.add(Md);null==
Xb&&(Xb=H.flowpoly.head.elt);if(kd){var Od=0,Pd=0,Qd=Uc,Od=va.x+(Ma.x-va.x)*Qd,Pd=va.y+(Ma.y-va.y)*Qd;H.flowpoly.add(ia.get(Od,Pd,null))}}}va=Ma;cd=Yb;Na=Ec;Yb=Yb.next;null==Yb&&(Yb=b.polygon.gverts.next)}}if(null==H.flowpoly.head)return!1;if(null==H.flowpoly.head.next){for(var Sd=!0,qd=b.polygon.edges.head;null!=qd;){var Fd=qd.elt;if(Fd.gnormx*a.circle.worldCOMx+Fd.gnormy*a.circle.worldCOMy>Fd.gprojection){Sd=!1;break}qd=qd.next}return Sd?(c.overlap=a.circle.area,c.centroidx=a.circle.worldCOMx,c.centroidy=
a.circle.worldCOMy,null,!0):!1}var ic=0,jc=0,Cc=0;if(null!=H.flowpoly.head.next.next){for(var le=0,ub=0,vb=0,le=vb=ub=0,vd=H.flowpoly.head,ad=vd.elt,vd=vd.next,Zb=vd.elt,vd=vd.next;null!=vd;)var Dc=vd.elt,le=le+Zb.x*(Dc.y-ad.y),Ud=Dc.y*Zb.x-Dc.x*Zb.y,ub=ub+(Zb.x+Dc.x)*Ud,vb=vb+(Zb.y+Dc.y)*Ud,ad=Zb,Zb=Dc,vd=vd.next;var vd=H.flowpoly.head,Mc=vd.elt,le=le+Zb.x*(Mc.y-ad.y),Vd=Mc.y*Zb.x-Mc.x*Zb.y,ub=ub+(Zb.x+Mc.x)*Vd,vb=vb+(Zb.y+Mc.y)*Vd,ad=Zb,Zb=Mc,vd=vd.next,fd=vd.elt,le=le+Zb.x*(fd.y-ad.y),Wd=fd.y*
Zb.x-fd.x*Zb.y,ub=ub+(Zb.x+fd.x)*Wd,vb=vb+(Zb.y+fd.y)*Wd,le=0.5*le,Xd=1/(6*le),ub=ub*Xd,vb=vb*Xd,Yd=-le,ic=ic+ub*Yd,jc=jc+vb*Yd,Cc=Cc-le}else H.flowsegs.add(H.flowpoly.head.elt),H.flowsegs.add(H.flowpoly.head.next.elt);for(;null!=H.flowsegs.head;)var zd=H.flowsegs.pop_unsafe(),Ad=H.flowsegs.pop_unsafe(),$d=0,ce=0,$d=Ad.x-zd.x,ce=Ad.y-zd.y,Mb=0,Ob=0,Mb=$d,Ob=ce,ee=1/Math.sqrt(Mb*Mb+Ob*Ob),Mb=Mb*ee,Ob=Ob*ee,re=Mb,Mb=-Ob,Ob=re,we=0,xe=0,we=zd.x+Ad.x,xe=zd.y+Ad.y,we=0.5*we,xe=0.5*xe,we=we-1*a.circle.worldCOMx,
xe=xe-1*a.circle.worldCOMy,Td=0,fe=0,ge=Mb*we+Ob*xe,Gd=ge/a.circle.radius,rd=Math.sqrt(1-Gd*Gd),he=Math.acos(Gd),Td=a.circle.radius*(a.circle.radius*he-ge*rd),fe=0.6666666666666666*a.circle.radius*rd*rd*rd/(he-Gd*rd),we=a.circle.worldCOMx,xe=a.circle.worldCOMy,ie=fe,we=we+Mb*ie,xe=xe+Ob*ie,je=Td,ic=ic+we*je,jc=jc+xe*je,Cc=Cc+Td;var ke=1/Cc,ic=ic*ke,jc=jc*ke;c.overlap=Cc;c.centroidx=ic;c.centroidy=jc;null;return!0}}return!1}var $b=a.circle,Kc=b.circle,Hd=0,Id=0,Hd=Kc.worldCOMx-$b.worldCOMx,Id=Kc.worldCOMy-
$b.worldCOMy,me=$b.radius+Kc.radius,Zd=Hd*Hd+Id*Id;if(Zd>me*me)return!1;if(Zd<t.epsilon*t.epsilon)$b.radius<Kc.radius?(c.overlap=$b.area,c.centroidx=$b.worldCOMx,c.centroidy=$b.worldCOMy):(c.overlap=Kc.area,c.centroidx=Kc.worldCOMx,c.centroidy=Kc.worldCOMy);else{var Jd=Math.sqrt(Zd),ne=1/Jd,Kd=0.5*(Jd-(Kc.radius*Kc.radius-$b.radius*$b.radius)*ne);if(Kd<=-$b.radius)c.overlap=$b.area,c.centroidx=$b.worldCOMx,c.centroidy=$b.worldCOMy;else{var ae=Jd-Kd;if(ae<=-Kc.radius)c.overlap=Kc.area,c.centroidx=
Kc.worldCOMx,c.centroidy=Kc.worldCOMy;else{var be=0,oe=0,de=0,pe=0,Nd=Kd/$b.radius,Dd=Math.sqrt(1-Nd*Nd),qe=Math.acos(Nd),be=$b.radius*($b.radius*qe-Kd*Dd),oe=0.6666666666666666*$b.radius*Dd*Dd*Dd/(qe-Nd*Dd),Rd=ae/Kc.radius,Ed=Math.sqrt(1-Rd*Rd),se=Math.acos(Rd),de=Kc.radius*(Kc.radius*se-ae*Ed),pe=0.6666666666666666*Kc.radius*Ed*Ed*Ed/(se-Rd*Ed),te=be+de,ue=(oe*be+(Jd-pe)*de)/te*ne;c.overlap=te;c.centroidx=$b.worldCOMx+Hd*ue;c.centroidy=$b.worldCOMy+Id*ue}}}null;return!0};var sk=function(){this.toiDistance=
0;this.inner=!1;this.shape=null};h["zpp_nape.geom.ZPP_ConvexRayResult"]=sk;sk.__name__=!0;sk.prototype={__class__:sk};var tk=function(){this.next=null;this.x=this.y=0};h["zpp_nape.geom.ZPP_GeomVert"]=tk;tk.__name__=!0;tk.prototype={__class__:tk};var uk=function(){this.outer=this.vertices=null};h["zpp_nape.geom.ZPP_GeomPoly"]=uk;uk.__name__=!0;uk.prototype={__class__:uk};var vk=function(){this.a=this.b=this.c=this.d=this.tx=this.ty=0};h["zpp_nape.geom.ZPP_Mat23"]=vk;vk.__name__=!0;vk.prototype={__class__:vk};
var wk=function(){this.x=null;this.m=this.n=0};h["zpp_nape.geom.ZPP_MatMN"]=wk;wk.__name__=!0;wk.prototype={__class__:wk};var Ta=function(){this.slipped=this.failed=this.kinematic=!1;this.c1=this.c2=this.axis=null;this.frozen1=this.frozen2=!1;this.s1=this.s2=this.arbiter=null;this.toi=0;this.next=null;this.c1=new ia;this.c2=new ia;this.axis=new ia};h["zpp_nape.geom.ZPP_ToiEvent"]=Ta;Ta.__name__=!0;Ta.prototype={__class__:Ta};var nc=function(){};h["zpp_nape.geom.ZPP_SweepDistance"]=nc;nc.__name__=
!0;nc.dynamicSweep=function(a,b,c,d,e){null==e&&(e=!1);var i=a.s1,f=a.s2,g=i.body,h=f.body,j=0,k=0,j=h.velx-g.velx,k=h.vely-g.vely,l=g.angvel;0>l&&(l=-l);var n=h.angvel;0>n&&(n=-n);var o=i.sweepCoef*l+f.sweepCoef*n;if(!e&&!a.kinematic&&j*j+k*k<t.dynamicSweepLinearThreshold*t.dynamicSweepLinearThreshold&&o<t.dynamicSweepAngularThreshold)a.toi=-1,a.failed=!0;else{for(var p=a.c1,l=a.c2,n=a.axis,q=0;;){g.sweepIntegrate(c*b);g.sweepValidate(i);h.sweepIntegrate(c*b);h.sweepValidate(f);var u=nc.distance(i,
f,p,l,n,null)+d,w=j*n.x+k*n.y;if(u<t.distanceThresholdCCD){if(e)break;var y=0,v=0,y=p.x-g.posx,v=p.y-g.posy,s=0,x=0,s=l.x-h.posx,x=l.y-h.posy,y=w-g.sweep_angvel*(n.y*y-n.x*v)+h.sweep_angvel*(n.y*s-n.x*x);0<y&&(a.slipped=!0);if(0>=y||u<0.5*t.distanceThresholdCCD)break}w=(o-w)*b;if(0>=w){c=-1;break}w=u/w;1.0E-6>w&&(w=1.0E-6);c+=w;if(1<=c){c=1;g.sweepIntegrate(c*b);g.sweepValidate(i);h.sweepIntegrate(c*b);h.sweepValidate(f);b=nc.distance(i,f,p,l,n,null)+d;j=j*n.x+k*n.y;if(b<t.distanceThresholdCCD){if(e)break;
k=e=0;e=p.x-g.posx;k=p.y-g.posy;d=p=0;p=l.x-h.posx;d=l.y-h.posy;g=j-g.sweep_angvel*(n.y*e-n.x*k)+h.sweep_angvel*(n.y*p-n.x*d);0<g&&(a.slipped=!0);if(0>=g||b<0.5*t.distanceThresholdCCD)break}c=-1;break}if(40<=++q){u>d&&(a.failed=!0);break}}a.toi=c}};nc.staticSweep=function(a,b,c,d){var e=a.s1,i=a.s2,f=e.body,g=0,h=0,g=-f.velx,h=-f.vely,j=f.sweep_angvel;0>j&&(j=-j);for(var k=e.sweepCoef*j,j=a.c1,n=a.c2,l=a.axis,o=0;;){f.sweepIntegrate(c*b);f.sweepValidate(e);var p=nc.distance(e,i,j,n,l,null)+d,q=g*
l.x+h*l.y;if(p<t.distanceThresholdCCD){var u=0,w=0,u=j.x-f.posx,w=j.y-f.posy,u=q-f.sweep_angvel*(l.y*u-l.x*w);0<u&&(a.slipped=!0);if(0>=u||p<0.5*t.distanceThresholdCCD)break}q=(k-q)*b;if(0>=q){c=-1;break}q=p/q;1.0E-6>q&&(q=1.0E-6);c+=q;if(1<=c){c=1;f.sweepIntegrate(c*b);f.sweepValidate(e);b=nc.distance(e,i,j,n,l,null)+d;g=g*l.x+h*l.y;if(b<t.distanceThresholdCCD&&(d=h=0,h=j.x-f.posx,d=j.y-f.posy,f=g-f.sweep_angvel*(l.y*h-l.x*d),0<f&&(a.slipped=!0),0>=f||b<0.5*t.distanceThresholdCCD))break;c=-1;break}if(40<=
++o){p>d&&(a.failed=!0);break}}a.toi=c};nc.distance=function(a,b,c,d,e,i){null==i&&(i=1.0E100);if(a.type==f.id_ShapeType_CIRCLE&&b.type==f.id_ShapeType_CIRCLE){var g=a.circle,h=b.circle,j,k=0,l=0,k=h.worldCOMx-g.worldCOMx,l=h.worldCOMy-g.worldCOMy,n=Math.sqrt(k*k+l*l);j=n-(g.radius+h.radius);if(j<i){if(0==n)k=1,l=0;else var p=1/n,k=k*p,l=l*p;var o=g.radius;c.x=g.worldCOMx+k*o;c.y=g.worldCOMy+l*o;var q=-h.radius;d.x=h.worldCOMx+k*q;d.y=h.worldCOMy+l*q;e.x=k;e.y=l}return j}var u=!1;if(a.type==f.id_ShapeType_CIRCLE&&
b.type==f.id_ShapeType_POLYGON)var w=a,a=b,b=w,y=c,c=d,d=y,u=!0;if(a.type==f.id_ShapeType_POLYGON&&b.type==f.id_ShapeType_CIRCLE){for(var v=b.circle,s=-1.0E100,x=null,A=a.polygon.edges.head;null!=A;){var B=A.elt,C=B.gnormx*v.worldCOMx+B.gnormy*v.worldCOMy-B.gprojection-v.radius;if(C>i){s=C;break}0<C?C>s&&(s=C,x=B):0>s&&C>s&&(s=C,x=B);A=A.next}if(s<i){var D=x.gp0,E=x.gp1,I=v.worldCOMy*x.gnormx-v.worldCOMx*x.gnormy;if(I<=D.y*x.gnormx-D.x*x.gnormy){var H=0,G=0,H=v.worldCOMx-D.x,G=v.worldCOMy-D.y,F=Math.sqrt(H*
H+G*G),s=F-v.radius;if(s<i){if(0==F)H=1,G=0;else var K=1/F,H=H*K,G=G*K;c.x=D.x+0*H;c.y=D.y+0*G;var P=-v.radius;d.x=v.worldCOMx+H*P;d.y=v.worldCOMy+G*P;e.x=H;e.y=G}}else if(I>=E.y*x.gnormx-E.x*x.gnormy){var N=0,M=0,N=v.worldCOMx-E.x,M=v.worldCOMy-E.y,R=Math.sqrt(N*N+M*M),s=R-v.radius;if(s<i){if(0==R)N=1,M=0;else var S=1/R,N=N*S,M=M*S;c.x=E.x+0*N;c.y=E.y+0*M;var T=-v.radius;d.x=v.worldCOMx+N*T;d.y=v.worldCOMy+M*T;e.x=N;e.y=M}}else{var Y=-v.radius;d.x=v.worldCOMx+x.gnormx*Y;d.y=v.worldCOMy+x.gnormy*
Y;var ca=-s;c.x=d.x+x.gnormx*ca;c.y=d.y+x.gnormy*ca;e.x=x.gnormx;e.y=x.gnormy}}u&&(e.x=-e.x,e.y=-e.y);return s}for(var X=a.polygon,V=b.polygon,L=-1.0E100,aa=null,ba=null,Z=0,ea=X.edges.head;null!=ea;){for(var da=ea.elt,W=1.0E100,fa=V.gverts.next;null!=fa;){var la=fa,ja=da.gnormx*la.x+da.gnormy*la.y;ja<W&&(W=ja);fa=fa.next}W-=da.gprojection;if(W>i){L=W;break}0<W?W>L&&(L=W,aa=da,Z=1):0>L&&W>L&&(L=W,aa=da,Z=1);ea=ea.next}if(L<i){for(var ha=V.edges.head;null!=ha;){for(var ia=ha.elt,z=1.0E100,pa=X.gverts.next;null!=
pa;){var na=pa,ra=ia.gnormx*na.x+ia.gnormy*na.y;ra<z&&(z=ra);pa=pa.next}z-=ia.gprojection;if(z>i){L=z;break}0<z?z>L&&(L=z,ba=ia,Z=2):0>L&&z>L&&(L=z,ba=ia,Z=2);ha=ha.next}if(L<i){var ma,O;if(1==Z)ma=V,O=aa;else{ma=X;O=ba;var Aa=c,c=d,d=Aa,u=!u}for(var ka=null,ta=1.0E100,Ba=ma.edges.head;null!=Ba;){var wa=Ba.elt,ya=O.gnormx*wa.gnormx+O.gnormy*wa.gnormy;ya<ta&&(ta=ya,ka=wa);Ba=Ba.next}u?(e.x=-O.gnormx,e.y=-O.gnormy):(e.x=O.gnormx,e.y=O.gnormy);if(0<=L){var Q=O.gp0,qa=O.gp1,ga=ka.gp0,ua=ka.gp1,U=0,sa=
0,Ha=0,xa=0,U=qa.x-Q.x,sa=qa.y-Q.y,Ha=ua.x-ga.x,xa=ua.y-ga.y,Ka=1/(U*U+sa*sa),Ca=1/(Ha*Ha+xa*xa),Ja=-(U*(Q.x-ga.x)+sa*(Q.y-ga.y))*Ka,La=-(U*(Q.x-ua.x)+sa*(Q.y-ua.y))*Ka,Ga=-(Ha*(ga.x-Q.x)+xa*(ga.y-Q.y))*Ca,Na=-(Ha*(ga.x-qa.x)+xa*(ga.y-qa.y))*Ca;0>Ja?Ja=0:1<Ja&&(Ja=1);0>La?La=0:1<La&&(La=1);0>Ga?Ga=0:1<Ga&&(Ga=1);0>Na?Na=0:1<Na&&(Na=1);var Fa=0,za=0,Qa=Ja,Fa=Q.x+U*Qa,za=Q.y+sa*Qa,oa=0,gb=0,db=La,oa=Q.x+U*db,gb=Q.y+sa*db,Ua=0,Za=0,J=Ga,Ua=ga.x+Ha*J,Za=ga.y+xa*J,Va=0,Pa=0,bb=Na,Va=ga.x+Ha*bb,Pa=ga.y+
xa*bb,Oa=Kb.vec_dsq(Fa,za,ga.x,ga.y),Xa=Kb.vec_dsq(oa,gb,ua.x,ua.y),Ma=Kb.vec_dsq(Ua,Za,Q.x,Q.y),lb=Kb.vec_dsq(Va,Pa,qa.x,qa.y),Ta=0,Wa=0,mb=null;Oa<Xa?(Ta=Fa,Wa=za,mb=ga):(Ta=oa,Wa=gb,mb=ua,Oa=Xa);var fb=0,Ya=0,Ra=null;Ma<lb?(fb=Ua,Ya=Za,Ra=Q):(fb=Va,Ya=Pa,Ra=qa,Ma=lb);Oa<Ma?(c.x=Ta,c.y=Wa,d.x=mb.x,d.y=mb.y,L=Math.sqrt(Oa)):(d.x=fb,d.y=Ya,c.x=Ra.x,c.y=Ra.y,L=Math.sqrt(Ma));if(0!=L){e.x=d.x-c.x;e.y=d.y-c.y;var cb=1/L;e.x*=cb;e.y*=cb;u&&(e.x=-e.x,e.y=-e.y)}return L}var Sa=0,Ia=0,Sa=ka.gp0.x,Ia=ka.gp0.y,
Da=0,Ea=0,Da=ka.gp1.x,Ea=ka.gp1.y,$a=0,eb=0,$a=Da-Sa,eb=Ea-Ia,pb=O.gnormy*Sa-O.gnormx*Ia,kb=O.gnormy*Da-O.gnormx*Ea,qb=1/(kb-pb),ib=(-O.tp1-pb)*qb;ib>t.epsilon&&(Sa+=$a*ib,Ia+=eb*ib);var nb=(-O.tp0-kb)*qb;nb<-t.epsilon&&(Da+=$a*nb,Ea+=eb*nb);var ob=Sa*O.gnormx+Ia*O.gnormy-O.gprojection,hb=Da*O.gnormx+Ea*O.gnormy-O.gprojection;if(ob<hb){d.x=Sa;d.y=Ia;var jb=-ob;c.x=d.x+O.gnormx*jb;c.y=d.y+O.gnormy*jb;return ob}d.x=Da;d.y=Ea;var ab=-hb;c.x=d.x+O.gnormx*ab;c.y=d.y+O.gnormy*ab;return hb}}return i};var ia=
function(){this.length=this.x=this.y=0;this._inuse=this.modified=this.pushmod=!1;this.next=null;this.weak=!1;this._isimmutable=this.outer=null;this._immutable=!1;this._invalidate=this._validate=null};h["zpp_nape.geom.ZPP_Vec2"]=ia;ia.__name__=!0;ia.get=function(a,b,c){null==c&&(c=!1);var d;null==ia.zpp_pool?d=new ia:(d=ia.zpp_pool,ia.zpp_pool=d.next,d.next=null);d.weak=!1;d._immutable=c;d.x=a;d.y=b;return d};ia.prototype={validate:function(){null!=this._validate&&this._validate()},invalidate:function(){null!=
this._invalidate&&this._invalidate(this)},wrapper:function(){if(null==this.outer){this.outer=new ga;var a=this.outer.zpp_inner;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null);a._isimmutable=null;a._validate=null;a._invalidate=null;a.next=ia.zpp_pool;ia.zpp_pool=a;this.outer.zpp_inner=this}return this.outer},add:function(a){return this.inlined_add(a)},inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,
b)},inlined_insert:function(a,b){b._inuse=!0;null==a?(b.next=this.next,this.next=b):(b.next=a.next,a.next=b);this.pushmod=this.modified=!0;this.length++;return b},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.next,this.next=c=b.next,null==this.next&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));b._inuse=!1;this.modified=!0;this.length--;this.pushmod=!0;return c},reverse:function(){for(var a=this.next,b=null;null!=a;){var c=
a.next;a.next=b;b=this.next=a;a=c}this.pushmod=this.modified=!0},iterator_at:function(a){for(var b=this.next;0<a--&&null!=b;)b=b.next;return b},toString:function(){return"{ x: "+this.x+" y: "+this.y+" }"},__class__:ia};var xk=function(){this._validate=null;this.x=this.y=this.z=0};h["zpp_nape.geom.ZPP_Vec3"]=xk;xk.__name__=!0;xk.prototype={validate:function(){null!=this._validate&&this._validate()},__class__:xk};var Kb=function(){};h["zpp_nape.geom.ZPP_VecMath"]=Kb;Kb.__name__=!0;Kb.vec_dsq=function(a,
b,c,d){var e=0,f=0,e=a-c,f=b-d;return e*e+f*f};var Ba=function(){this.userData=this.ishape=this.ibody=this.icompound=this.cbsets=this.group=this.cbTypes=this.cbSet=this.wrap_cbTypes=null;this.id=0;this.outer_i=null;this.id=wb.Interactor();this.cbsets=new Fj;this.cbTypes=new sd};h["zpp_nape.phys.ZPP_Interactor"]=Ba;Ba.__name__=!0;Ba.get=function(a,b){var c;c=a.id<b.id?a.id:b.id;var d;d=a.id<b.id?b.id:a.id;for(var e=null,f=(a.cbsets.length<b.cbsets.length?a.cbsets:b.cbsets).head;null!=f;){var g=f.elt;
if(g.id==c&&g.di==d){e=g;break}f=f.next}return e};Ba.int_callback=function(a,b,c){var d=a.int1,a=a.int2;b.options1.compatible(d.cbTypes)&&b.options2.compatible(a.cbTypes)?(c.int1=d,c.int2=a):(c.int1=a,c.int2=d)};Ba.prototype={__iaddedToSpace:function(){null!=this.group&&this.group.interactors.add(this);for(var a=this.cbTypes.head;null!=a;)a.elt.interactors.add(this),a=a.next;this.alloc_cbSet()},__iremovedFromSpace:function(){null!=this.group&&this.group.interactors.remove(this);for(var a=this.cbTypes.head;null!=
a;)a.elt.interactors.remove(this),a=a.next;this.dealloc_cbSet()},wake:function(){if(null!=this.ishape){var a=this.ishape.body;null!=a&&null!=a.space&&a.space.non_inlined_wake(a);!0}else null!=this.ibody?null!=this.ibody.space?this.ibody.space.non_inlined_wake(this.ibody):!1:(null!=this.icompound.space&&this.icompound.space.wakeCompound(this.icompound),!0)},setupcbTypes:function(){this.wrap_cbTypes=xc.get(this.cbTypes);this.wrap_cbTypes.zpp_inner.adder=y(this,this.wrap_cbTypes_adder);this.wrap_cbTypes.zpp_inner.subber=
y(this,this.wrap_cbTypes_subber);this.wrap_cbTypes.zpp_inner.dontremove=!0},wrap_cbTypes_subber:function(a){a=a.zpp_inner;if(this.cbTypes.has(a)){var b;b=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=b&&(this.dealloc_cbSet(),a.interactors.remove(this));this.cbTypes.remove(a);null!=b&&(this.alloc_cbSet(),this.wake())}},wrap_cbTypes_adder:function(a){this.insert_cbtype(a.zpp_inner);return!1},insert_cbtype:function(a){if(!this.cbTypes.has(a)){var b;
b=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=b&&(this.dealloc_cbSet(),a.interactors.add(this));for(var c=null,d=this.cbTypes.head;null!=d&&!(a.id<d.elt.id);){c=d;d=d.next}this.cbTypes.inlined_insert(c,a);null!=b&&(this.alloc_cbSet(),this.wake())}},alloc_cbSet:function(){var a;a=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;if(null!=(this.cbSet=
a.cbsets.get(this.cbTypes)))this.cbSet.count++,this.cbSet.interactors.add(this),this.cbSet.validate(),a.freshInteractorType(this)},dealloc_cbSet:function(){var a;a=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=this.cbSet&&(this.cbSet.interactors.remove(this),a.nullInteractorType(this),0==--this.cbSet.count&&(a.cbsets.remove(this.cbSet),a=this.cbSet,a.free(),a.next=ma.zpp_pool,ma.zpp_pool=a),this.cbSet=null)},immutable_midstep:function(a){null!=
this.ibody?null:null!=this.ishape?this.ishape.__immutable_midstep(a):this.icompound.__imutable_midstep(a)},lookup_group:function(){for(var a=this;null!=a&&null==a.group;)a=null!=a.ishape?a.ishape.body:null!=a.icompound?a.icompound.compound:a.ibody.compound;return null==a?null:a.group},__class__:Ba};var Yc=function(){this.wrap_localCOM=this.wrap_worldCOM=null;this.zip_worldCOM=!1;this.worldCOMx=this.worldCOMy=0;this.zip_localCOM=!1;this.localCOMx=this.localCOMy=0;this.zip_aabb=!1;this.aabb=null;this.norotate=
!1;this.cinertia=this.iinertia=this.sinertia=0;this.zip_inertia=!1;this.inertiaMode=this.inertia=0;this.zip_gravMassScale=!1;this.gravMassMode=this.gravMassScale=0;this.zip_gravMass=!1;this.gravMass=0;this.nomove=!1;this.massMode=this.imass=this.smass=this.cmass=0;this.zip_mass=!1;this.mass=0;this.zip_axis=!1;this.forcex=this.forcey=this.kinvelx=this.kinvely=this.svelx=this.svely=this.angvel=this.torque=this.kinangvel=this.pre_rot=this.rot=this.axisx=this.axisy=0;this.wrap_vel=null;this.velx=this.vely=
0;this.wrap_pos=null;this.pre_posx=this.pre_posy=this.posx=this.posy=0;this.bullet=this.bulletEnabled=this.disableCCD=!1;this.sweepRadius=0;this.sweepFrozen=!1;this.sweepTime=this.sweep_angvel=0;this.compound=this.shapes=this.wrap_shapes=this.space=this.arbiters=this.constraints=this.component=null;this.type=0;this.world=!1;this.outer=null;Ba.call(this);this.ibody=this;this.bulletEnabled=this.world=!1;this.sweep_angvel=this.sweepTime=0;this.disableCCD=this.norotate=this.nomove=!1;this.axisx=this.rot=
this.posy=this.posx=0;this.axisy=1;this.torque=this.angvel=this.kinangvel=this.forcey=this.forcex=this.kinvely=this.kinvelx=this.vely=this.velx=this.svely=this.svelx=0;this.pre_rot=this.pre_posy=this.pre_posx=Infinity;this.worldCOMy=this.worldCOMx=this.localCOMy=this.localCOMx=0;this.zip_aabb=!0;this.aabb=za.get(0,0,0,0);this.aabb._immutable=!0;this.aabb._validate=y(this,this.aabb_validate);this.massMode=f.id_MassMode_DEFAULT;this.gravMassMode=f.id_GravMassMode_DEFAULT;this.gravMassScale=1;this.inertiaMode=
f.id_InertiaMode_DEFAULT;this.arbiters=new Df;this.constraints=new ad;this.shapes=new Ke;this.wrap_shapes=Sd.get(this.shapes);this.wrap_shapes.zpp_inner.adder=y(this,this.shapes_adder);this.wrap_shapes.zpp_inner.subber=y(this,this.shapes_subber);this.wrap_shapes.zpp_inner._invalidate=y(this,this.shapes_invalidate);this.kinematicDelaySleep=!1};h["zpp_nape.phys.ZPP_Body"]=Yc;Yc.__name__=!0;Yc.__static=function(){null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new Ia,f.internal=!1);var a=new re(f.BodyType_STATIC),
b=a.zpp_inner;b.world=!0;b.wrap_shapes.zpp_inner.immutable=!0;b.smass=b.imass=b.cmass=b.mass=b.gravMass=0;b.sinertia=b.iinertia=b.cinertia=b.inertia=0;b.cbTypes.clear();return a};Yc.__super__=Ba;Yc.prototype=v(Ba.prototype,{invalidate_type:function(){this.invalidate_mass();this.invalidate_inertia()},invalidate_shapes:function(){this.zip_worldCOM=this.zip_localCOM=this.zip_aabb=!0;this.invalidate_mass();this.invalidate_inertia()},atRest:function(a){if(this.type!=f.id_BodyType_DYNAMIC)return this.component.sleeping;
var b=t.linearSleepThreshold,b=b*b;if(this.velx*this.velx+this.vely*this.vely>b)a=!1;else if(Kb.vec_dsq(this.posx,this.posy,this.pre_posx,this.pre_posy)>0.25*b*a*a)a=!1;else{var c=b=0,b=this.aabb.maxx-this.aabb.minx,c=this.aabb.maxy-this.aabb.miny,b=b*b+c*c,c=t.angularSleepThreshold,c=c*c;if(4*this.angvel*this.angvel*b>c)a=!1;else var d=this.rot-this.pre_rot,a=d*d*b>c*a*a?!1:!0}a||(this.component.waket=this.space.stamp);return this.component.waket+t.sleepDelay<this.space.stamp},refreshArbiters:function(){for(var a=
this.arbiters.head;null!=a;)a.elt.invalidated=!0,a=a.next},sweepIntegrate:function(a){var b=a-this.sweepTime;0!=b&&(this.sweepTime=a,this.posx+=this.velx*b,this.posy+=this.vely*b,0!=this.angvel&&this.delta_rot(this.sweep_angvel*b))},sweepValidate:function(a){if(a.type==f.id_ShapeType_CIRCLE)a.worldCOMx=this.posx+(this.axisy*a.localCOMx-this.axisx*a.localCOMy),a.worldCOMy=this.posy+(a.localCOMx*this.axisx+a.localCOMy*this.axisy);else{for(var a=a.polygon,b=a.lverts.next,c=a.gverts.next;null!=c;){var d=
c,e=b,b=b.next;d.x=this.posx+(this.axisy*e.x-this.axisx*e.y);d.y=this.posy+(e.x*this.axisx+e.y*this.axisy);c=c.next}c=a.edges.head;b=d=a.gverts.next;for(d=d.next;null!=d;){var e=d,i=c.elt,c=c.next;i.gnormx=this.axisy*i.lnormx-this.axisx*i.lnormy;i.gnormy=i.lnormx*this.axisx+i.lnormy*this.axisy;i.gprojection=this.posx*i.gnormx+this.posy*i.gnormy+i.lprojection;i.tp0=b.y*i.gnormx-b.x*i.gnormy;i.tp1=e.y*i.gnormx-e.x*i.gnormy;b=e;d=d.next}a=a.gverts.next;c=c.elt;c.gnormx=this.axisy*c.lnormx-this.axisx*
c.lnormy;c.gnormy=c.lnormx*this.axisx+c.lnormy*this.axisy;c.gprojection=this.posx*c.gnormx+this.posy*c.gnormy+c.lprojection;c.tp0=b.y*c.gnormx-b.x*c.gnormy;c.tp1=a.y*c.gnormx-a.x*c.gnormy}},invalidate_pos:function(){for(var a=this.shapes.head;null!=a;){var b=a.elt;b.type==f.id_ShapeType_POLYGON&&(b.polygon.invalidate_gverts(),b.polygon.invalidate_gaxi());b.invalidate_worldCOM();a=a.next}this.zip_worldCOM=!0},pos_invalidate:function(a){this.immutable_midstep("Body::position");this.posx==a.x&&this.posy==
a.y||(this.posx=a.x,this.posy=a.y,this.invalidate_pos(),this.wake())},pos_validate:function(){this.wrap_pos.zpp_inner.x=this.posx;this.wrap_pos.zpp_inner.y=this.posy},vel_invalidate:function(a){this.velx=a.x;this.vely=a.y;this.wake()},vel_validate:function(){this.wrap_vel.zpp_inner.x=this.velx;this.wrap_vel.zpp_inner.y=this.vely},setupPosition:function(){this.wrap_pos=ga.get(this.posx,this.posy,null);this.wrap_pos.zpp_inner._inuse=!0;this.world?this.wrap_pos.zpp_inner._immutable=!0:(this.wrap_pos.zpp_inner._invalidate=
y(this,this.pos_invalidate),this.wrap_pos.zpp_inner._validate=y(this,this.pos_validate))},setupVelocity:function(){this.wrap_vel=ga.get(this.velx,this.vely,null);this.wrap_vel.zpp_inner._inuse=!0;this.world?this.wrap_vel.zpp_inner._immutable=!0:(this.wrap_vel.zpp_inner._invalidate=y(this,this.vel_invalidate),this.wrap_vel.zpp_inner._validate=y(this,this.vel_validate))},invalidate_rot:function(){this.zip_axis=!0;for(var a=this.shapes.head;null!=a;){var b=a.elt;b.type==f.id_ShapeType_POLYGON&&(b.polygon.invalidate_gverts(),
b.polygon.invalidate_gaxi());b.invalidate_worldCOM();a=a.next}this.zip_worldCOM=!0},validate_axis:function(){this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot),null)},delta_rot:function(a){this.rot+=a;if(1.0E-4<a*a)this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot),null;else{var b=a*a,c=1-0.5*b,b=1-b*b/8,d=(c*this.axisx+a*this.axisy)*b;this.axisy=(c*this.axisy-a*this.axisx)*b;this.axisx=d}},invalidate_mass:function(){this.zip_mass=!0;this.invalidate_gravMass()},
validate_mass:function(){if(this.zip_mass){this.zip_mass=!1;if(this.massMode==f.id_MassMode_DEFAULT){this.cmass=0;for(var a=this.shapes.head;null!=a;){var b=a.elt;b.refmaterial.density=b.material.density;b.validate_area_inertia();this.cmass+=b.area*b.material.density;a=a.next}}this.type==f.id_BodyType_DYNAMIC&&!this.nomove?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=Infinity,this.imass=this.smass=0)}},invalidate_gravMass:function(){this.gravMassMode!=f.id_GravMassMode_FIXED&&
(this.zip_gravMass=!0);this.gravMassMode!=f.id_GravMassMode_SCALED&&(this.zip_gravMassScale=!0);this.wake()},validate_gravMass:function(){this.zip_gravMass&&(this.zip_gravMass=!1,this.validate_mass(),this.gravMassMode==f.id_GravMassMode_DEFAULT?(this.validate_mass(),this.gravMass=this.cmass):this.gravMassMode==f.id_GravMassMode_SCALED&&(this.validate_mass(),this.gravMass=this.cmass*this.gravMassScale))},invalidate_inertia:function(){this.zip_inertia=!0;this.wake()},validate_inertia:function(){if(this.zip_inertia){this.zip_inertia=
!1;if(this.inertiaMode==f.id_InertiaMode_DEFAULT){this.cinertia=0;for(var a=this.shapes.head;null!=a;){var b=a.elt;b.refmaterial.density=b.material.density;b.validate_area_inertia();this.cinertia+=b.inertia*b.area*b.material.density;a=a.next}}this.type==f.id_BodyType_DYNAMIC&&!this.norotate?(this.inertia=this.cinertia,this.sinertia=this.iinertia=1/this.inertia):(this.inertia=Infinity,this.sinertia=this.iinertia=0)}},validate_aabb:function(){if(this.zip_aabb){this.zip_aabb=!1;this.aabb.minx=Infinity;
this.aabb.miny=Infinity;this.aabb.maxx=-Infinity;this.aabb.maxy=-Infinity;for(var a=this.shapes.head;null!=a;){var b=a.elt;b.zip_aabb&&null!=b.body&&(b.zip_aabb=!1,b.type==f.id_ShapeType_CIRCLE?b.circle.__validate_aabb():b.polygon.__validate_aabb());this.aabb.combine(b.aabb);a=a.next}}},invalidate_localCOM:function(){this.zip_worldCOM=this.zip_localCOM=!0},validate_localCOM:function(){if(this.zip_localCOM){this.zip_localCOM=!1;for(var a=0,b=0,c=0,d=this.shapes.head;null!=d;){var e=d.elt;e.zip_localCOM&&
(e.zip_localCOM=!1,e.type==f.id_ShapeType_POLYGON&&e.polygon.__validate_localCOM(),null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy));e.validate_area_inertia();var i=e.area*e.material.density,a=a+e.localCOMx*i,b=b+e.localCOMy*i,c=c+e.area*e.material.density,d=d.next}0!=c&&(d=1/c,this.localCOMx=a*d,this.localCOMy=b*d);null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy);this.zip_mass&&
this.massMode==f.id_MassMode_DEFAULT&&(this.zip_mass=!1,this.cmass=c,this.type==f.id_BodyType_DYNAMIC?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=Infinity,this.imass=this.smass=0))}},validate_worldCOM:function(){this.zip_worldCOM&&(this.zip_worldCOM=!1,this.validate_localCOM(),this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot),null),this.worldCOMx=this.posx+(this.axisy*this.localCOMx-this.axisx*this.localCOMy),this.worldCOMy=this.posy+
(this.localCOMx*this.axisx+this.localCOMy*this.axisy),null!=this.wrap_worldCOM&&(this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy))},aabb_validate:function(){this.validate_aabb()},shapes_adder:function(a){return a.zpp_inner.body!=this?(null!=a.zpp_inner.body&&a.zpp_inner.body.wrap_shapes.remove(a),a.zpp_inner.body=this,a.zpp_inner.addedToBody(),null!=this.space&&this.space.added_shape(a.zpp_inner,null),a.zpp_inner.type==f.id_ShapeType_POLYGON&&(a.zpp_inner.polygon.invalidate_gaxi(),
a.zpp_inner.polygon.invalidate_gverts()),!0):!1},shapes_subber:function(a){null!=this.space&&this.space.removed_shape(a.zpp_inner);a.zpp_inner.body=null;a.zpp_inner.removedFromBody()},shapes_invalidate:function(){this.invalidate_shapes()},addedToSpace:function(){null==eb.zpp_pool?this.component=new eb:(this.component=eb.zpp_pool,eb.zpp_pool=this.component.next,this.component.next=null);null;this.component.isBody=!0;this.component.body=this;this.__iaddedToSpace()},removedFromSpace:function(){for(;null!=
this.arbiters.head;){var a=this.arbiters.pop_unsafe();a.cleared=!0;a.b2==this&&a.b1.arbiters.inlined_try_remove(a);a.b1==this&&a.b2.arbiters.inlined_try_remove(a);null!=a.pair&&(a.pair.arb=null,a.pair=null);a.active=!1;this.space.f_arbiters.modified=!0}a=this.component;a.body=null;a.constraint=null;null;a.next=eb.zpp_pool;eb.zpp_pool=a;this.component=null;this.__iremovedFromSpace()},__class__:Yc});var Gj=function(){this.compound=this.space=null;this.depth=0;this.outer=this.bodies=this.constraints=
this.compounds=this.wrap_constraints=null};h["zpp_nape.phys.ZPP_Compound"]=Gj;Gj.__name__=!0;Gj.__super__=Ba;Gj.prototype=v(Ba.prototype,{__imutable_midstep:function(){},addedToSpace:function(){this.__iaddedToSpace()},removedFromSpace:function(){this.__iremovedFromSpace()},__class__:Gj});var yk=function(){this.wrap_gravity=null;this.viscosity=this.density=this.gravityx=this.gravityy=0;this.shapes=null};h["zpp_nape.phys.ZPP_FluidProperties"]=yk;yk.__name__=!0;yk.prototype={__class__:yk};var da=function(){this.dynamicFriction=
this.staticFriction=this.density=this.elasticity=this.rollingFriction=0;this.next=this.outer=this.shapes=null;this.shapes=new Ke;this.elasticity=0;this.dynamicFriction=1;this.staticFriction=2;this.density=0.001;this.rollingFriction=0.01};h["zpp_nape.phys.ZPP_Material"]=da;da.__name__=!0;da.prototype={wrapper:function(){if(null==this.outer){this.outer=new ra;var a=this.outer.zpp_inner;a.outer=null;a.next=da.zpp_pool;da.zpp_pool=a;this.outer.zpp_inner=this}return this.outer},set:function(a){this.dynamicFriction=
a.dynamicFriction;this.staticFriction=a.staticFriction;this.density=a.density;this.elasticity=a.elasticity;this.rollingFriction=a.rollingFriction},invalidate:function(a){for(var b=this.shapes.head;null!=b;)b.elt.invalidate_material(a),b=b.next},__class__:da};var oc=function(a){this.zip_aabb=!1;this.sweep=this.node=this.pairs=this.aabb=null;this.fluidEnabled=this.sensorEnabled=!1;this.circle=this.polygon=this.refmaterial=this.material=this.filter=this.fluidProperties=null;this.sweepCoef=0;this.zip_sweepRadius=
!1;this.sweepRadius=0;this.wrap_localCOM=null;this.zip_worldCOM=!1;this.worldCOMx=this.worldCOMy=0;this.zip_localCOM=!1;this.localCOMx=this.localCOMy=0;this.zip_angDrag=!1;this.inertia=this.angDrag=0;this.zip_area_inertia=!1;this.type=this.area=0;this.outer=this.body=null;Ba.call(this);this.pairs=new Hj;this.ishape=this;this.type=a;this.aabb=za.get(0,0,0,0);this.aabb._immutable=!0;this.aabb._validate=y(this,this.aabb_validate);this.zip_area_inertia=this.zip_angDrag=this.zip_localCOM=this.zip_sweepRadius=
!0;this.worldCOMy=this.worldCOMx=this.localCOMy=this.localCOMx=0;this.sensorEnabled=this.fluidEnabled=!1;this.body=this.fluidProperties=null;this.refmaterial=new da;this.sweepRadius=this.sweepCoef=0};h["zpp_nape.shape.ZPP_Shape"]=oc;oc.__name__=!0;oc.__super__=Ba;oc.prototype=v(Ba.prototype,{validate_sweepRadius:function(){this.zip_sweepRadius&&(this.zip_sweepRadius=!1,this.type==f.id_ShapeType_CIRCLE?this.circle.__validate_sweepRadius():this.polygon.__validate_sweepRadius())},validate_area_inertia:function(){this.zip_area_inertia&&
(this.zip_area_inertia=!1,this.type==f.id_ShapeType_CIRCLE?this.circle.__validate_area_inertia():this.polygon.__validate_area_inertia())},validate_angDrag:function(){if(this.zip_angDrag||this.refmaterial.dynamicFriction!=this.material.dynamicFriction)this.zip_angDrag=!1,this.refmaterial.dynamicFriction=this.material.dynamicFriction,this.type==f.id_ShapeType_CIRCLE?this.circle.__validate_angDrag():this.polygon.__validate_angDrag()},validate_worldCOM:function(){this.zip_worldCOM&&null!=this.body&&(this.zip_worldCOM=
!1,this.zip_localCOM&&(this.zip_localCOM=!1,this.type==f.id_ShapeType_POLYGON&&this.polygon.__validate_localCOM(),null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)),this.body.validate_axis(),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy))},invalidate_area_inertia:function(){this.zip_area_inertia=
!0;null!=this.body&&(this.body.invalidate_localCOM(),this.body.invalidate_mass(),this.body.invalidate_inertia())},invalidate_angDrag:function(){this.zip_angDrag=!0},invalidate_localCOM:function(){this.zip_localCOM=!0;this.invalidate_area_inertia();this.type==f.id_ShapeType_CIRCLE&&(this.zip_sweepRadius=!0);this.invalidate_angDrag();this.invalidate_worldCOM();null!=this.body&&this.body.invalidate_localCOM()},invalidate_worldCOM:function(){this.zip_aabb=this.zip_worldCOM=!0;null!=this.body&&(this.body.zip_aabb=
!0)},invalidate_material:function(a){0!=(a&da.WAKE)&&this.wake();0!=(a&da.ARBITERS)&&null!=this.body&&this.body.refreshArbiters();0!=(a&da.PROPS)&&null!=this.body&&(this.body.invalidate_localCOM(),this.body.invalidate_mass(),this.body.invalidate_inertia());0!=(a&da.ANGDRAG)&&this.invalidate_angDrag();this.refmaterial.set(this.material)},invalidate_filter:function(){this.wake()},aabb_validate:function(){this.zip_aabb&&null!=this.body&&(this.zip_aabb=!1,this.type==f.id_ShapeType_CIRCLE?this.circle.__validate_aabb():
this.polygon.__validate_aabb())},setMaterial:function(a){this.material!=a&&(null!=this.body&&null!=this.body.space&&null!=this.material&&this.material.shapes.remove(this),this.material=a,null!=this.body&&null!=this.body.space&&a.shapes.add(this),this.wake(),null!=this.body&&this.body.refreshArbiters())},setFilter:function(a){this.filter!=a&&(null!=this.body&&null!=this.body.space&&null!=this.filter&&this.filter.shapes.remove(this),this.filter=a,null!=this.body&&null!=this.body.space&&a.shapes.add(this),
this.wake())},__immutable_midstep:function(){},addedToBody:function(){this.invalidate_worldCOM();this.zip_aabb=!0;null!=this.body&&(this.body.zip_aabb=!0)},removedFromBody:function(){},addedToSpace:function(){this.__iaddedToSpace();this.material.shapes.add(this);this.filter.shapes.add(this);null!=this.fluidProperties&&this.fluidProperties.shapes.add(this)},removedFromSpace:function(){this.__iremovedFromSpace();this.material.shapes.remove(this);this.filter.shapes.remove(this);null!=this.fluidProperties&&
this.fluidProperties.shapes.remove(this)},__class__:oc});var og=function(){this.radius=0;this.outer_zn=null;oc.call(this,f.id_ShapeType_CIRCLE);this.circle=this;this.zip_localCOM=!1};h["zpp_nape.shape.ZPP_Circle"]=og;og.__name__=!0;og.__super__=oc;og.prototype=v(oc.prototype,{invalidate_radius:function(){this.invalidate_area_inertia();this.invalidate_angDrag();this.zip_aabb=!0;null!=this.body&&(this.body.zip_aabb=!0);null!=this.body&&this.body.wake()},__validate_aabb:function(){this.zip_worldCOM&&
null!=this.body&&(this.zip_worldCOM=!1,this.zip_localCOM&&(this.zip_localCOM=!1,this.type==f.id_ShapeType_POLYGON&&this.polygon.__validate_localCOM(),null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)),this.body.validate_axis(),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy));var a=this.radius,
b=this.radius;this.aabb.minx=this.worldCOMx-a;this.aabb.miny=this.worldCOMy-b;this.aabb.maxx=this.worldCOMx+a;this.aabb.maxy=this.worldCOMy+b},_force_validate_aabb:function(){this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy);this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy);this.aabb.minx=this.worldCOMx-this.radius;this.aabb.miny=this.worldCOMy-this.radius;this.aabb.maxx=this.worldCOMx+this.radius;this.aabb.maxy=
this.worldCOMy+this.radius},__validate_sweepRadius:function(){this.sweepCoef=Math.sqrt(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy);this.sweepRadius=this.sweepCoef+this.radius},__validate_area_inertia:function(){var a=this.radius*this.radius;this.area=a*Math.PI;this.inertia=0.5*a+(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy)},__validate_angDrag:function(){var a=this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy,b=this.radius*this.radius;this.angDrag=(a+2*b)*
this.material.dynamicFriction*t.fluidAngularDragFriction+0.5*t.fluidAngularDrag*(1+t.fluidVacuumDrag)*a;this.angDrag/=2*(a+0.5*b)},__class__:og});var wa=function(){this.tp0=this.tp1=0;this.lp0=this.gp0=this.lp1=this.gp1=null;this.length=this.lprojection=this.gprojection=0;this.wrap_gnorm=null;this.gnormx=this.gnormy=0;this.wrap_lnorm=null;this.lnormx=this.lnormy=0;this.next=this.polygon=this.outer=null;this.gprojection=this.lprojection=this.length=this.gnormy=this.gnormx=this.lnormy=this.lnormx=0};
h["zpp_nape.shape.ZPP_Edge"]=wa;wa.__name__=!0;wa.prototype={wrapper:function(){null==this.outer&&(wa.internal=!0,this.outer=new Pi,wa.internal=!1,this.outer.zpp_inner=this);return this.outer},__class__:wa};var pg=function(){this.reverse_flag=this.zip_lverts=this.zip_laxi=this.zip_gverts=this.zip_gaxi=this.zip_valid=this.zip_sanitation=!1;this.edgeCnt=0;this.outer_zn=this.lverts=this.wrap_lverts=this.gverts=this.wrap_gverts=this.edges=this.wrap_edges=null;oc.call(this,f.id_ShapeType_POLYGON);this.polygon=
this;this.lverts=new ia;this.gverts=new ia;this.edges=new Ij;this.edgeCnt=0};h["zpp_nape.shape.ZPP_Polygon"]=pg;pg.__name__=!0;pg.__super__=oc;pg.prototype=v(oc.prototype,{lverts_pa_invalidate:function(){this.invalidate_lverts()},gverts_pa_validate:function(){this.validate_gverts()},lverts_post_adder:function(a){a.zpp_inner._invalidate=y(this,this.lverts_pa_invalidate);for(var b=null,c=null,d=this.lverts.next;null!=d&&!(d==a.zpp_inner);){b=null==b?this.gverts.next:b.next,c=null==c?this.edges.head:
c.next;d=d.next}a=ia.get(0,0,!0);this.gverts.insert(b,a);null!=this.lverts.next.next&&(null==this.lverts.next.next.next?(null==wa.zpp_pool?c=new wa:(c=wa.zpp_pool,wa.zpp_pool=c.next,c.next=null),null,c.polygon=this,this.edges.add(c),null==wa.zpp_pool?c=new wa:(c=wa.zpp_pool,wa.zpp_pool=c.next,c.next=null),null,c.polygon=this,this.edges.add(c),this.edgeCnt+=2):(null==wa.zpp_pool?b=new wa:(b=wa.zpp_pool,wa.zpp_pool=b.next,b.next=null),null,b.polygon=this,this.edges.insert(c,b),this.edgeCnt++));a._validate=
y(this,this.gverts_pa_validate)},lverts_subber:function(a){this.cleanup_lvert(a.zpp_inner)},lverts_invalidate:function(){this.invalidate_lverts()},lverts_validate:function(){this.validate_lverts()},getlverts:function(){this.wrap_lverts=Le.get(this.lverts);this.wrap_lverts.zpp_inner.post_adder=y(this,this.lverts_post_adder);this.wrap_lverts.zpp_inner.subber=y(this,this.lverts_subber);this.wrap_lverts.zpp_inner._invalidate=y(this,this.lverts_invalidate);this.wrap_lverts.zpp_inner._validate=y(this,this.lverts_validate);
this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag},invalidate_lverts:function(){this.invalidate_laxi();this.invalidate_area_inertia();this.invalidate_angDrag();this.invalidate_localCOM();this.invalidate_gverts();this.zip_sanitation=this.zip_valid=this.zip_lverts=!0;null!=this.body&&this.body.wake()},invalidate_laxi:function(){this.invalidate_gaxi();this.zip_laxi=this.zip_sweepRadius=!0},invalidate_gverts:function(){this.zip_aabb=!0;null!=this.body&&(this.body.zip_aabb=!0);this.zip_gverts=
!0},invalidate_gaxi:function(){this.zip_gaxi=!0},validate_lverts:function(){this.zip_lverts&&(this.zip_lverts=!1,2<this.lverts.length&&(this.validate_area_inertia(),0>this.area&&(this.reverse_vertices(),this.area=-this.area)))},cleanup_lvert:function(a){for(var b=null,c=null,d=this.lverts.next;null!=d&&!(d==a);){b=null==b?this.gverts.next:b.next,c=null==c?this.edges.head:c.next;d=d.next}a=null==b?this.gverts.next:b.next;this.gverts.erase(b);null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null);a._isimmutable=
null;a._validate=null;a._invalidate=null;a.next=ia.zpp_pool;ia.zpp_pool=a;2==this.edgeCnt?(c=this.edges.pop_unsafe(),c.polygon=null,c.next=wa.zpp_pool,wa.zpp_pool=c,c=this.edges.pop_unsafe(),c.polygon=null,c.next=wa.zpp_pool,wa.zpp_pool=c,this.edgeCnt=0):0!=this.edgeCnt&&(b=null==c?this.edges.head.elt:c.next.elt,this.edges.erase(c),b.polygon=null,b.next=wa.zpp_pool,wa.zpp_pool=b,this.edgeCnt--)},splice_collinear:function(){this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real())},
splice_collinear_real:function(){if(!(null==this.lverts.next||null==this.lverts.next.next)&&null!=this.lverts.next.next.next){for(var a=null,b=this.lverts.next;null!=b;){var c=b,d=null==b.next?this.lverts.next:b.next;Kb.vec_dsq(c.x,c.y,d.x,d.y)<t.epsilon*t.epsilon?(this.cleanup_lvert(b),b=this.lverts.erase(a)):(a=b,b=b.next)}if(null!=this.lverts.next){do{a=!1;for(b=this.lverts.next;null!=b;){var c=null==b.next?this.lverts.next:b.next,e=b,d=c,f=null==c.next?this.lverts.next:c.next,g=0,h=0,g=d.x-e.x,
h=d.y-e.y,j=e=0,e=f.x-d.x,j=f.y-d.y,d=j*g-e*h;d*d>=t.epsilon*t.epsilon||(this.cleanup_lvert(c),this.lverts.erase(null==b.next?null:b),a=!0);b=b.next}}while(a)}}},reverse_vertices:function(){this.lverts.reverse();this.gverts.reverse();this.edges.reverse();var a=this.edges.iterator_at(this.edgeCnt-1),b=this.edges.pop_unsafe();this.edges.insert(a,b);this.reverse_flag=!this.reverse_flag;null!=this.wrap_lverts&&(this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag);null!=this.wrap_gverts&&(this.wrap_gverts.zpp_inner.reverse_flag=
this.reverse_flag);null!=this.wrap_edges&&(this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag)},validate_laxi:function(){if(this.zip_laxi){this.zip_laxi=!1;this.validate_lverts();for(var a=this.edges.head,b=this.lverts.next,c=b,b=b.next;null!=b;){var d=b,e=a.elt,a=a.next;e.lp0=c;e.lp1=d;var f=0,g=0,f=c.x-d.x,g=c.y-d.y,h=Math.sqrt(f*f+g*g);e.length=h;h=1/h;f*=h;g*=h;h=f;f=-g;g=h;e.lprojection=f*c.x+g*c.y;e.lnormx=f;e.lnormy=g;null!=e.wrap_lnorm&&(e.wrap_lnorm.zpp_inner.x=f,e.wrap_lnorm.zpp_inner.y=
g);c=d;b=b.next}e=this.lverts.next;a=a.elt;a.lp0=c;a.lp1=e;d=b=0;b=c.x-e.x;d=c.y-e.y;e=Math.sqrt(b*b+d*d);a.length=e;e=1/e;f=b*e;b=-(d*e);d=f;a.lprojection=b*c.x+d*c.y;a.lnormx=b;a.lnormy=d;null!=a.wrap_lnorm&&(a.wrap_lnorm.zpp_inner.x=b,a.wrap_lnorm.zpp_inner.y=d)}},validate_gverts:function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1;this.validate_lverts();this.body.validate_axis();for(var a=this.lverts.next,b=this.gverts.next;null!=b;){var c=b,d=a,a=a.next;c.x=this.body.posx+(this.body.axisy*
d.x-this.body.axisx*d.y);c.y=this.body.posy+(d.x*this.body.axisx+d.y*this.body.axisy);b=b.next}}},validate_gaxi:function(){if(this.zip_gaxi&&null!=this.body){this.zip_gaxi=!1;this.validate_laxi();this.body.validate_axis();this.validate_gverts();for(var a=this.edges.head,b=this.gverts.next,c=b,b=b.next;null!=b;){var d=b,e=a.elt,a=a.next;e.gp0=c;e.gp1=d;e.gnormx=this.body.axisy*e.lnormx-this.body.axisx*e.lnormy;e.gnormy=e.lnormx*this.body.axisx+e.lnormy*this.body.axisy;e.gprojection=this.body.posx*
e.gnormx+this.body.posy*e.gnormy+e.lprojection;null!=e.wrap_gnorm&&(e.wrap_gnorm.zpp_inner.x=e.gnormx,e.wrap_gnorm.zpp_inner.y=e.gnormy);e.tp0=e.gp0.y*e.gnormx-e.gp0.x*e.gnormy;e.tp1=e.gp1.y*e.gnormx-e.gp1.x*e.gnormy;c=d;b=b.next}b=this.gverts.next;a=a.elt;a.gp0=c;a.gp1=b;a.gnormx=this.body.axisy*a.lnormx-this.body.axisx*a.lnormy;a.gnormy=a.lnormx*this.body.axisx+a.lnormy*this.body.axisy;a.gprojection=this.body.posx*a.gnormx+this.body.posy*a.gnormy+a.lprojection;null!=a.wrap_gnorm&&(a.wrap_gnorm.zpp_inner.x=
a.gnormx,a.wrap_gnorm.zpp_inner.y=a.gnormy);a.tp0=a.gp0.y*a.gnormx-a.gp0.x*a.gnormy;a.tp1=a.gp1.y*a.gnormx-a.gp1.x*a.gnormy}},__validate_aabb:function(){this.validate_gverts();var a=this.gverts.next;this.aabb.minx=a.x;this.aabb.miny=a.y;this.aabb.maxx=a.x;this.aabb.maxy=a.y;for(a=this.gverts.next.next;null!=a;){var b=a;b.x<this.aabb.minx&&(this.aabb.minx=b.x);b.x>this.aabb.maxx&&(this.aabb.maxx=b.x);b.y<this.aabb.miny&&(this.aabb.miny=b.y);b.y>this.aabb.maxy&&(this.aabb.maxy=b.y);a=a.next}},_force_validate_aabb:function(){var a=
this.lverts.next,b=this.gverts.next,c=a,a=a.next;b.x=this.body.posx+(this.body.axisy*c.x-this.body.axisx*c.y);b.y=this.body.posy+(c.x*this.body.axisx+c.y*this.body.axisy);this.aabb.minx=b.x;this.aabb.miny=b.y;this.aabb.maxx=b.x;this.aabb.maxy=b.y;for(b=this.gverts.next.next;null!=b;){var c=b,d=a,a=a.next;c.x=this.body.posx+(this.body.axisy*d.x-this.body.axisx*d.y);c.y=this.body.posy+(d.x*this.body.axisx+d.y*this.body.axisy);c.x<this.aabb.minx&&(this.aabb.minx=c.x);c.x>this.aabb.maxx&&(this.aabb.maxx=
c.x);c.y<this.aabb.miny&&(this.aabb.miny=c.y);c.y>this.aabb.maxy&&(this.aabb.maxy=c.y);b=b.next}},__validate_sweepRadius:function(){var a=0,b=0;this.validate_laxi();for(var c=this.lverts.next;null!=c;){var d=c,d=d.x*d.x+d.y*d.y;d>a&&(a=d);c=c.next}for(c=this.edges.head;null!=c;){d=c.elt;if(d.lprojection<b&&(b=d.lprojection,0>b))break;c=c.next}0>b&&(b=0);this.sweepRadius=Math.sqrt(a);this.sweepCoef=this.sweepRadius-b},__validate_area_inertia:function(){if(null==this.lverts.next||null==this.lverts.next.next||
null==this.lverts.next.next.next)this.inertia=this.area=0;else{for(var a=this.area=0,b=0,c=this.lverts.next,d=c,e=c=c.next,c=c.next;null!=c;){var f=c,g=e.y*d.x-e.x*d.y,a=a+g*(e.x*e.x+e.y*e.y+(e.x*d.x+e.y*d.y)+(d.x*d.x+d.y*d.y)),b=b+g;this.area+=e.x*(f.y-d.y);d=e;e=f;c=c.next}g=c=this.lverts.next;f=e.y*d.x-e.x*d.y;a+=f*(e.x*e.x+e.y*e.y+(e.x*d.x+e.y*d.y)+(d.x*d.x+d.y*d.y));this.area+=e.x*(g.y-d.y);d=e;e=g;c=c.next;g=e.y*d.x-e.x*d.y;a+=g*(e.x*e.x+e.y*e.y+(e.x*d.x+e.y*d.y)+(d.x*d.x+d.y*d.y));this.area+=
e.x*(c.y-d.y);this.inertia=a/(6*(b+f+g));this.area*=0.5;0>this.area&&(this.area=-this.area,this.reverse_vertices())}},__validate_angDrag:function(){this.validate_area_inertia();this.validate_laxi();for(var a=0,b=this.edges.head,c=0,d=this.lverts.next,e=d,d=d.next;null!=d;){var f=d,g=b.elt,b=b.next,c=c+g.length,h=0,j=0,h=f.x-e.x,j=f.y-e.y,a=a+g.length*t.fluidAngularDragFriction*this.material.dynamicFriction*g.lprojection*g.lprojection,k=-(e.y*g.lnormx-e.x*g.lnormy)/(j*g.lnormx-h*g.lnormy);if(0<k){var l;
l=1<k?1:k;var n=0,p=0,n=e.x,p=e.y,o=l,n=n+h*o,p=p+j*o,o=g.lnormy*e.x-g.lnormx*e.y,n=g.lnormy*n-g.lnormx*p,a=a+(n*n*n-o*o*o)/(3*(n-o))*l*g.length*t.fluidAngularDrag}1>k&&(k=0>k?0:k,n=l=0,l=e.x,n=e.y,e=k,l+=h*e,n+=j*e,e=g.lnormy*l-g.lnormx*n,h=g.lnormy*f.x-g.lnormx*f.y,a+=(h*h*h-e*e*e)/(3*(h-e))*t.fluidVacuumDrag*(1-k)*g.length*t.fluidAngularDrag);e=f;d=d.next}d=this.lverts.next;b=b.elt;c+=b.length;g=f=0;f=d.x-e.x;g=d.y-e.y;a+=b.length*t.fluidAngularDragFriction*this.material.dynamicFriction*b.lprojection*
b.lprojection;h=-(e.y*b.lnormx-e.x*b.lnormy)/(g*b.lnormx-f*b.lnormy);0<h&&(j=1<h?1:h,n=l=0,l=e.x,n=e.y,k=b.lnormy*e.x-b.lnormx*e.y,l=b.lnormy*(l+f*j)-b.lnormx*(n+g*j),a+=(l*l*l-k*k*k)/(3*(l-k))*j*b.length*t.fluidAngularDrag);1>h&&(h=0>h?0:h,k=j=0,j=e.x,k=e.y,e=b.lnormy*(j+f*h)-b.lnormx*(k+g*h),d=b.lnormy*d.x-b.lnormx*d.y,a+=(d*d*d-e*e*e)/(3*(d-e))*t.fluidVacuumDrag*(1-h)*b.length*t.fluidAngularDrag);this.angDrag=a/(this.inertia*c)},__validate_localCOM:function(){if(null==this.lverts.next.next)this.localCOMx=
this.lverts.next.x,this.localCOMy=this.lverts.next.y;else if(null==this.lverts.next.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y,this.localCOMx+=1*this.lverts.next.next.x,this.localCOMy+=1*this.lverts.next.next.y,this.localCOMx*=0.5,this.localCOMy*=0.5;else{for(var a=this.localCOMy=this.localCOMx=0,b=this.lverts.next,c=b,d=b=b.next,b=b.next;null!=b;){var e=b,a=a+d.x*(e.y-c.y),c=e.y*d.x-e.x*d.y;this.localCOMx+=(d.x+e.x)*c;this.localCOMy+=(d.y+e.y)*c;c=d;d=e;b=b.next}e=
b=this.lverts.next;a+=d.x*(e.y-c.y);c=e.y*d.x-e.x*d.y;this.localCOMx+=(d.x+e.x)*c;this.localCOMy+=(d.y+e.y)*c;c=d;d=e;b=b.next;a+=d.x*(b.y-c.y);c=b.y*d.x-b.x*d.y;this.localCOMx+=(d.x+b.x)*c;this.localCOMy+=(d.y+b.y)*c;a=1/(3*a);this.localCOMx*=a;this.localCOMy*=a}},__class__:pg});var Ud=function(){this.sweep=this.dynab=null;this.is_sweep=!1;this.space=null};h["zpp_nape.space.ZPP_Broadphase"]=Ud;Ud.__name__=!0;Ud.prototype={insert:function(a){this.is_sweep?this.sweep.__insert(a):this.dynab.__insert(a)},
remove:function(a){this.is_sweep?this.sweep.__remove(a):this.dynab.__remove(a)},sync:function(a){this.is_sweep?!this.sweep.space.continuous&&a.zip_aabb&&null!=a.body&&(a.zip_aabb=!1,a.type==f.id_ShapeType_CIRCLE?a.circle.__validate_aabb():a.polygon.__validate_aabb()):this.dynab.__sync(a)},broadphase:function(){},__class__:Ud};var jb=function(){this.synced=this.first_sync=!1;this.snext=null;this.moved=!1;this.next=this.mnext=null;this.height=0;this.parent=this.child1=this.child2=null;this.dyn=!1;this.aabb=
this.shape=null;this.height=-1};h["zpp_nape.space.ZPP_AABBNode"]=jb;jb.__name__=!0;jb.prototype={free:function(){this.height=-1;var a=this.aabb;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null);a.wrap_min=a.wrap_max=null;a._invalidate=null;a._validate=null;a.next=za.zpp_pool;za.zpp_pool=a;this.mnext=this.snext=this.next=this.child1=this.child2=this.parent=null},__class__:jb};var U=function(){this.arb=this.next=null;this.id=this.di=0;this.first=this.sleeping=!1;this.n1=this.n2=null};h["zpp_nape.space.ZPP_AABBPair"]=
U;U.__name__=!0;U.prototype={__class__:U};var Lc=function(){this.root=null};h["zpp_nape.space.ZPP_AABBTree"]=Lc;Lc.__name__=!0;Lc.prototype={inlined_insertLeaf:function(a){if(null==this.root)this.root=a,this.root.parent=null;else{for(var b=a.aabb,c=this.root;null!=c.child1;){var d=c.child1,e=c.child2,f=c.aabb.perimeter();Lc.tmpaabb.setCombine(c.aabb,b);var g=Lc.tmpaabb.perimeter(),h=2*g,f=2*(g-f);Lc.tmpaabb.setCombine(b,d.aabb);null==d.child1?g=Lc.tmpaabb.perimeter()+f:(g=d.aabb.perimeter(),g=Lc.tmpaabb.perimeter()-
g+f);Lc.tmpaabb.setCombine(b,e.aabb);if(null==e.child1)f=Lc.tmpaabb.perimeter()+f;else var j=e.aabb.perimeter(),f=Lc.tmpaabb.perimeter()-j+f;if(h<g&&h<f)break;else c=g<f?d:e}d=c.parent;null==jb.zpp_pool?e=new jb:(e=jb.zpp_pool,jb.zpp_pool=e.next,e.next=null);null==za.zpp_pool?e.aabb=new za:(e.aabb=za.zpp_pool,za.zpp_pool=e.aabb.next,e.aabb.next=null);null;e.moved=!1;e.synced=!1;e.first_sync=!1;e.parent=d;e.aabb.setCombine(b,c.aabb);e.height=c.height+1;null!=d?(d.child1==c?d.child1=e:d.child2=e,e.child1=
c,e.child2=a,c.parent=e,a.parent=e):(e.child1=c,e.child2=a,c.parent=e,this.root=a.parent=e);for(c=a.parent;null!=c;)c=this.balance(c),a=c.child1,b=c.child2,d=a.height,e=b.height,c.height=1+(d>e?d:e),c.aabb.setCombine(a.aabb,b.aabb),c=c.parent}},removeLeaf:function(a){this.inlined_removeLeaf(a)},inlined_removeLeaf:function(a){if(a==this.root)this.root=null;else{var b=a.parent,c=b.parent,a=b.child1==a?b.child2:b.child1;if(null!=c){c.child1==b?c.child1=a:c.child2=a;a.parent=c;b.free();b.next=jb.zpp_pool;
jb.zpp_pool=b;for(b=c;null!=b;)b=this.balance(b),a=b.child1,c=b.child2,b.aabb.setCombine(a.aabb,c.aabb),a=a.height,c=c.height,b.height=1+(a>c?a:c),b=b.parent}else this.root=a,a.parent=null,b.free(),b.next=jb.zpp_pool,jb.zpp_pool=b}},balance:function(a){if(null==a.child1||2>a.height)return a;var b=a.child1,c=a.child2,d=c.height-b.height;if(1<d){var e=c.child1,f=c.child2;c.child1=a;c.parent=a.parent;a.parent=c;null!=c.parent?c.parent.child1==a?c.parent.child1=c:c.parent.child2=c:this.root=c;e.height>
f.height?(c.child2=e,a.child2=f,f.parent=a,a.aabb.setCombine(b.aabb,f.aabb),c.aabb.setCombine(a.aabb,e.aabb),a.height=1+function(){var a=b.height,c=f.height;return a>c?a:c}(this),c.height=1+function(){var b=a.height,c=e.height;return b>c?b:c}(this)):(c.child2=f,a.child2=e,e.parent=a,a.aabb.setCombine(b.aabb,e.aabb),c.aabb.setCombine(a.aabb,f.aabb),a.height=1+function(){var a=b.height,c=e.height;return a>c?a:c}(this),c.height=1+function(){var b=a.height,c=f.height;return b>c?b:c}(this));return c}if(-1>
d){var g=b.child1,h=b.child2;b.child1=a;b.parent=a.parent;a.parent=b;null!=b.parent?b.parent.child1==a?b.parent.child1=b:b.parent.child2=b:this.root=b;g.height>h.height?(b.child2=g,a.child1=h,h.parent=a,a.aabb.setCombine(c.aabb,h.aabb),b.aabb.setCombine(a.aabb,g.aabb),a.height=1+function(){var a=c.height,b=h.height;return a>b?a:b}(this),b.height=1+function(){var b=a.height,c=g.height;return b>c?b:c}(this)):(b.child2=h,a.child1=g,g.parent=a,a.aabb.setCombine(c.aabb,g.aabb),b.aabb.setCombine(a.aabb,
h.aabb),a.height=1+function(){var a=c.height,b=g.height;return a>b?a:b}(this),b.height=1+function(){var b=a.height,c=h.height;return b>c?b:c}(this));return b}return a},__class__:Lc};var Lh=function(a){this.stree=this.dtree=this.pairs=this.syncs=this.moves=null;Ud.call(this);this.space=a;this.is_sweep=!1;this.dynab=this;this.stree=new Lc;this.dtree=new Lc};h["zpp_nape.space.ZPP_DynAABBPhase"]=Lh;Lh.__name__=!0;Lh.__super__=Ud;Lh.prototype=v(Ud.prototype,{__insert:function(a){var b;null==jb.zpp_pool?
b=new jb:(b=jb.zpp_pool,jb.zpp_pool=b.next,b.next=null);null==za.zpp_pool?b.aabb=new za:(b.aabb=za.zpp_pool,za.zpp_pool=b.aabb.next,b.aabb.next=null);null;b.moved=!1;b.synced=!1;b.first_sync=!1;b.shape=a;a.node=b;b.synced=!0;b.first_sync=!0;b.snext=this.syncs;this.syncs=b},__remove:function(a){var b=a.node;b.first_sync||(b.dyn?this.dtree.removeLeaf(b):this.stree.removeLeaf(b));a.node=null;if(b.synced){for(var c=null,d=this.syncs;null!=d&&!(d==b);){c=d;d=d.snext}null==c?this.syncs=d.snext:c.snext=
d.snext;d.snext=null;b.synced=!1}if(b.moved){c=null;for(d=this.moves;null!=d&&!(d==b);){c=d;d=d.mnext}null==c?this.moves=d.mnext:c.mnext=d.mnext;d.mnext=null;b.moved=!1}for(var c=null,e=this.pairs;null!=e;)d=e.next,e.n1==b||e.n2==b?(null==c?this.pairs=d:c.next=d,null!=e.arb&&(e.arb.pair=null),e.arb=null,e.n1.shape.pairs.remove(e),e.n2.shape.pairs.remove(e),e.n1=e.n2=null,e.sleeping=!1,e.next=U.zpp_pool,U.zpp_pool=e):c=e,e=d;for(;null!=a.pairs.head;)c=a.pairs.pop_unsafe(),c.n1==b?c.n2.shape.pairs.remove(c):
c.n1.shape.pairs.remove(c),null!=c.arb&&(c.arb.pair=null),c.arb=null,c.n1=c.n2=null,c.sleeping=!1,c.next=U.zpp_pool,U.zpp_pool=c;b.free();b.next=jb.zpp_pool;jb.zpp_pool=b},__sync:function(a){var b=a.node;if(!b.synced&&(!this.space.continuous&&a.zip_aabb&&null!=a.body&&(a.zip_aabb=!1,a.type==f.id_ShapeType_CIRCLE?a.circle.__validate_aabb():a.polygon.__validate_aabb()),b.dyn!=(a.body.type==f.id_BodyType_STATIC?!1:!a.body.component.sleeping)||!b.aabb.contains(a.aabb)))b.synced=!0,b.snext=this.syncs,
this.syncs=b},broadphase:function(a,b){for(var c=this.syncs;null!=c;){var d=c.shape;c.first_sync?c.first_sync=!1:(c.dyn?this.dtree:this.stree).inlined_removeLeaf(c);var e=c.aabb;!a.continuous&&d.zip_aabb&&null!=d.body&&(d.zip_aabb=!1,d.type==f.id_ShapeType_CIRCLE?d.circle.__validate_aabb():d.polygon.__validate_aabb());e.setExpand(d.aabb,3);((d.body.type==f.id_BodyType_STATIC?c.dyn=!1:c.dyn=!d.body.component.sleeping)?this.dtree:this.stree).inlined_insertLeaf(c);c.synced=!1;c=c.snext}for(;null!=this.syncs;)if(c=
this.syncs,this.syncs=c.snext,c.snext=null,!c.moved&&(c.moved=!1,d=c.shape,!d.body.component.sleeping)){var e=c.aabb,i=null;null!=this.dtree.root&&(this.dtree.root.next=i,i=this.dtree.root);for(;null!=i;){var g;g=i;i=g.next;g.next=null;if(g!=c)if(null==g.child1){var h=g.shape;if(h.body!=d.body&&!(h.body.type==f.id_BodyType_STATIC&&d.body.type==f.id_BodyType_STATIC)&&e.intersect(g.aabb)){var j,k;d.id<h.id?(j=d.id,k=h.id):(j=h.id,k=d.id);for(var l=null,n=(d.pairs.length<h.pairs.length?d:h).pairs.head;null!=
n;){var o=n.elt;if(o.id==j&&o.di==k){l=o;break}n=n.next}null!=l?l.sleeping&&(l.sleeping=!1,l.next=this.pairs,this.pairs=l,l.first=!0):(null==U.zpp_pool?l=new U:(l=U.zpp_pool,U.zpp_pool=l.next,l.next=null),null,l.n1=c,l.n2=g,l.id=j,l.di=k,l.next=this.pairs,this.pairs=l,l.first=!0,d.pairs.inlined_add(l),h.pairs.inlined_add(l))}}else e.intersect(g.aabb)&&(null!=g.child1&&(g.child1.next=i,i=g.child1),null!=g.child2&&(g.child2.next=i,i=g.child2))}null!=this.stree.root&&(this.stree.root.next=i,i=this.stree.root);
for(;null!=i;)if(g=i,i=g.next,g.next=null,g!=c)if(null==g.child1){if(h=g.shape,h.body!=d.body&&!(h.body.type==f.id_BodyType_STATIC&&d.body.type==f.id_BodyType_STATIC)&&e.intersect(g.aabb)){d.id<h.id?(j=d.id,k=h.id):(j=h.id,k=d.id);l=null;for(n=(d.pairs.length<h.pairs.length?d:h).pairs.head;null!=n;){o=n.elt;if(o.id==j&&o.di==k){l=o;break}n=n.next}null!=l?l.sleeping&&(l.sleeping=!1,l.next=this.pairs,this.pairs=l,l.first=!0):(null==U.zpp_pool?l=new U:(l=U.zpp_pool,U.zpp_pool=l.next,l.next=null),null,
l.n1=c,l.n2=g,l.id=j,l.di=k,l.next=this.pairs,this.pairs=l,l.first=!0,d.pairs.inlined_add(l),h.pairs.inlined_add(l))}}else e.intersect(g.aabb)&&(null!=g.child1&&(g.child1.next=i,i=g.child1),null!=g.child2&&(g.child2.next=i,i=g.child2))}for(;null!=this.moves;)if(c=this.moves,this.moves=c.mnext,c.mnext=null,c.moved=!1,d=c.shape,!d.body.component.sleeping){e=c.aabb;i=null;null!=this.dtree.root&&(this.dtree.root.next=i,i=this.dtree.root);for(;null!=i;)if(g=i,i=g.next,g.next=null,g!=c)if(null==g.child1){if(h=
g.shape,h.body!=d.body&&!(h.body.type==f.id_BodyType_STATIC&&d.body.type==f.id_BodyType_STATIC)&&e.intersect(g.aabb)){d.id<h.id?(j=d.id,k=h.id):(j=h.id,k=d.id);l=null;for(n=(d.pairs.length<h.pairs.length?d:h).pairs.head;null!=n;){o=n.elt;if(o.id==j&&o.di==k){l=o;break}n=n.next}null!=l?l.sleeping&&(l.sleeping=!1,l.next=this.pairs,this.pairs=l,l.first=!0):(null==U.zpp_pool?l=new U:(l=U.zpp_pool,U.zpp_pool=l.next,l.next=null),null,l.n1=c,l.n2=g,l.id=j,l.di=k,l.next=this.pairs,this.pairs=l,l.first=!0,
d.pairs.inlined_add(l),h.pairs.inlined_add(l))}}else e.intersect(g.aabb)&&(null!=g.child1&&(g.child1.next=i,i=g.child1),null!=g.child2&&(g.child2.next=i,i=g.child2));null!=this.stree.root&&(this.stree.root.next=i,i=this.stree.root);for(;null!=i;)if(g=i,i=g.next,g.next=null,g!=c)if(null==g.child1){if(h=g.shape,h.body!=d.body&&!(h.body.type==f.id_BodyType_STATIC&&d.body.type==f.id_BodyType_STATIC)&&e.intersect(g.aabb)){d.id<h.id?(j=d.id,k=h.id):(j=h.id,k=d.id);l=null;for(n=(d.pairs.length<h.pairs.length?
d:h).pairs.head;null!=n;){o=n.elt;if(o.id==j&&o.di==k){l=o;break}n=n.next}null!=l?l.sleeping&&(l.sleeping=!1,l.next=this.pairs,this.pairs=l,l.first=!0):(null==U.zpp_pool?l=new U:(l=U.zpp_pool,U.zpp_pool=l.next,l.next=null),null,l.n1=c,l.n2=g,l.id=j,l.di=k,l.next=this.pairs,this.pairs=l,l.first=!0,d.pairs.inlined_add(l),h.pairs.inlined_add(l))}}else e.intersect(g.aabb)&&(null!=g.child1&&(g.child1.next=i,i=g.child1),null!=g.child2&&(g.child2.next=i,i=g.child2))}c=null;for(d=this.pairs;null!=d;)!d.first&&
!d.n1.aabb.intersect(d.n2.aabb)?(null==c?this.pairs=d.next:c.next=d.next,d.n1.shape.pairs.inlined_try_remove(d),d.n2.shape.pairs.inlined_try_remove(d),e=d.next,null!=d.arb&&(d.arb.pair=null),d.arb=null,d.n1=d.n2=null,d.sleeping=!1,d.next=U.zpp_pool,U.zpp_pool=d,d=e):(e=d.n1.shape,i=e.body,g=d.n2.shape,h=g.body,!d.first&&(i.component.sleeping||i.type==f.id_BodyType_STATIC)&&(h.component.sleeping||h.type==f.id_BodyType_STATIC)?(d.sleeping=!0,null==c?this.pairs=d.next:c.next=d.next):(d.first=!1,e.aabb.intersect(g.aabb)&&
(c=d.arb,d.arb=b?a.narrowPhase(e,g,i.type!=f.id_BodyType_DYNAMIC||h.type!=f.id_BodyType_DYNAMIC,d.arb,!1):a.continuousEvent(e,g,i.type!=f.id_BodyType_DYNAMIC||h.type!=f.id_BodyType_DYNAMIC,d.arb,!1),null==d.arb?null!=c&&(c.pair=null):d.arb.pair=d),c=d),d=d.next)},__class__:Lh});var pc=function(){this.waket=0;this.sleep=!1;this.comps=null;this.length=0;this._inuse=this.modified=this.pushmod=!1;this.next=null;this.comps=new Jj};h["zpp_nape.space.ZPP_Island"]=pc;pc.__name__=!0;pc.prototype={inlined_add:function(a){a._inuse=
!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.next;this.next=a.next;a._inuse=!1;null==this.next&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_pop_unsafe:function(){var a=this.next;this.pop();return a},__class__:pc};var eb=function(){this.woken=!1;this.waket=0;this.sleeping=!1;this.body=this.constraint=this.island=null;this.isBody=!1;this.rank=0;this.next=this.parent=null;this.sleeping=!1;this.island=
null;this.parent=this;this.rank=0;this.woken=!1};h["zpp_nape.space.ZPP_Component"]=eb;eb.__name__=!0;eb.prototype={__class__:eb};var Ha=function(){this.freed=this.lazydel=!1;this.length=0;this._inuse=this.modified=this.pushmod=!1;this.int1=this.int2=this.next=null;this.id=this.di=0;this.arbiters=new Df};h["zpp_nape.space.ZPP_CallbackSet"]=Ha;Ha.__name__=!0;Ha.get=function(a,b){var c;null==Ha.zpp_pool?c=new Ha:(c=Ha.zpp_pool,Ha.zpp_pool=c.next,c.next=null);c.freed=!1;c.lazydel=!1;c.COLLISIONstate=
f.id_PreFlag_ACCEPT;c.COLLISIONstamp=0;c.SENSORstate=f.id_PreFlag_ACCEPT;c.SENSORstamp=0;c.FLUIDstate=f.id_PreFlag_ACCEPT;c.FLUIDstamp=0;a.id<b.id?(c.int1=a,c.int2=b):(c.int1=b,c.int2=a);c.id=c.int1.id;c.di=c.int2.id;return c};Ha.prototype={inlined_add:function(a){a._inuse=!0;a.next=this.next;this.next=a;this.modified=!0;this.length++;return a},inlined_erase:function(a){var b,c;null==a?(b=this.next,this.next=c=b.next,null==this.next&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=
!0));b._inuse=!1;this.modified=!0;this.length--;this.pushmod=!0;return c},remove_arb:function(a){this.arbiters.inlined_try_remove(a)},empty_arb:function(a){var b;b=!0;for(var c=this.arbiters.head;null!=c;)if(0==(c.elt.type&a))c=c.next;else{b=!1;break}return b},sleeping:function(){var a;a=!0;for(var b=this.arbiters.head;null!=b;)if(b.elt.sleeping)b=b.next;else{a=!1;break}return a},__class__:Ha};var Kj=function(a){this.cbsets=this.space=null;null==ac.zpp_pool?this.cbsets=new ac:(this.cbsets=ac.zpp_pool,
ac.zpp_pool=this.cbsets.next,this.cbsets.next=null);null;this.cbsets.lt=ma.setlt;this.space=a};h["zpp_nape.space.ZPP_CbSetManager"]=Kj;Kj.__name__=!0;Kj.prototype={get:function(a){if(null==a.head)return null;var b;null==ma.zpp_pool?b=new ma:(b=ma.zpp_pool,ma.zpp_pool=b.next,b.next=null);null;var c=b.cbTypes;b.cbTypes=a;var d=this.cbsets.find_weak(b);null!=d?a=d.data:(a=ma.get(a),this.cbsets.insert(a),a.manager=this);b.cbTypes=c;b.free();b.next=ma.zpp_pool;ma.zpp_pool=b;return a},remove:function(a){for(this.cbsets.remove(a);null!=
a.cbpairs.head;){var b=a.cbpairs.pop_unsafe();b.a!=b.b&&(a==b.a?b.b.cbpairs.remove(b):b.a.cbpairs.remove(b));b.a=b.b=null;b.listeners.clear();b.next=Hb.zpp_pool;Hb.zpp_pool=b}a.manager=null},validate:function(){if(!this.cbsets.empty()){for(var a=this.cbsets.parent;null!=a.prev;)a=a.prev;for(;null!=a;)if(a.data.validate(),null!=a.next)for(a=a.next;null!=a.prev;)a=a.prev;else{for(;null!=a.parent&&a==a.parent.next;)a=a.parent;a=a.parent}}},pair:function(a,b){for(var c=null,d=(a.cbpairs.length<b.cbpairs.length?
a.cbpairs:b.cbpairs).head;null!=d;){var e=d.elt;if(e.a==a&&e.b==b||e.a==b&&e.b==a){c=e;break}d=d.next}null==c&&(c=Hb.get(a,b),a.cbpairs.add(c),b!=a&&b.cbpairs.add(c));c.zip_listeners&&(c.zip_listeners=!1,c.__validate());return c},__class__:Kj};var Ri=function(a,b){this.precb=this.prelisteners=null;this.continuous=!1;this.toiEvents=null;this.pre_dt=0;this.c_arbiters_true=this.c_arbiters_false=this.f_arbiters=this.s_arbiters=this.live=this.wrap_live=this.live_constraints=this.wrap_livecon=this.staticsleep=
this.islands=this.listeners=this.wrap_listeners=this.callbacks=this.callbackset_list=this.cbsets=null;this.sortcontacts=!1;this.time=0;this.midstep=!1;this.global_lin_drag=this.global_ang_drag=this.stamp=0;this.bodies=this.wrap_bodies=this.compounds=this.wrap_compounds=this.constraints=this.wrap_constraints=this.kinematics=this.bphase=this.__static=null;this.gravityx=this.gravityy=0;this.outer=null;this.toiEvents=new Lj;this.global_ang_drag=this.global_lin_drag=0.015;this.precb=new jg;this.precb.zpp_inner=
new Jc;this.sortcontacts=!0;this.pre_dt=0;var c;if(!(c=null==b))null==f.Broadphase_DYNAMIC_AABB_TREE&&(f.internal=!0,f.Broadphase_DYNAMIC_AABB_TREE=new se,f.internal=!1),c=b==f.Broadphase_DYNAMIC_AABB_TREE;c?this.bphase=new Lh(this):(null==f.Broadphase_SWEEP_AND_PRUNE&&(f.internal=!0,f.Broadphase_SWEEP_AND_PRUNE=new se,f.internal=!1),b==f.Broadphase_SWEEP_AND_PRUNE&&(this.bphase=new Mh(this)));this.time=0;null!=a?(this.gravityx=a.x,this.gravityy=a.y):this.gravityy=this.gravityx=0;this.bodies=new Hd;
this.wrap_bodies=Zc.get(this.bodies);this.wrap_bodies.zpp_inner.adder=y(this,this.bodies_adder);this.wrap_bodies.zpp_inner.subber=y(this,this.bodies_subber);this.compounds=new Nh;this.wrap_compounds=Qd.get(this.compounds);this.wrap_compounds.zpp_inner.adder=y(this,this.compounds_adder);this.wrap_compounds.zpp_inner.subber=y(this,this.compounds_subber);this.kinematics=new Hd;this.c_arbiters_true=new Oh;this.c_arbiters_false=new Oh;this.f_arbiters=new Mj;this.s_arbiters=new Nj;this.islands=new pc;this.live=
new Hd;this.wrap_live=Zc.get(this.live,!0);this.staticsleep=new Hd;this.constraints=new ad;this.wrap_constraints=kd.get(this.constraints);this.wrap_constraints.zpp_inner.adder=y(this,this.constraints_adder);this.wrap_constraints.zpp_inner.subber=y(this,this.constraints_subber);this.live_constraints=new ad;this.wrap_livecon=kd.get(this.live_constraints,!0);this.__static=Yc.__static();this.__static.zpp_inner.space=this;this.callbacks=new Jc;this.midstep=!1;this.listeners=new Ph;this.wrap_listeners=
Od.get(this.listeners);this.wrap_listeners.zpp_inner.adder=y(this,this.listeners_adder);this.wrap_listeners.zpp_inner.subber=y(this,this.listeners_subber);this.callbackset_list=new Ha;this.mrca1=new Dc;this.mrca2=new Dc;this.prelisteners=new Be;this.cbsets=new Kj(this)};h["zpp_nape.space.ZPP_Space"]=Ri;Ri.__name__=!0;Ri.prototype={bodies_adder:function(a){return a.zpp_inner.space!=this?(null!=a.zpp_inner.space&&a.zpp_inner.space.outer.zpp_inner.wrap_bodies.remove(a),this.addBody(a.zpp_inner),!0):
!1},bodies_subber:function(a){this.remBody(a.zpp_inner)},compounds_adder:function(a){return a.zpp_inner.space!=this?(null!=a.zpp_inner.space&&a.zpp_inner.space.wrap_compounds.remove(a),this.addCompound(a.zpp_inner),!0):!1},compounds_subber:function(a){this.remCompound(a.zpp_inner)},constraints_adder:function(a){return a.zpp_inner.space!=this?(null!=a.zpp_inner.space&&a.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(a),this.addConstraint(a.zpp_inner),!0):!1},constraints_subber:function(a){this.remConstraint(a.zpp_inner)},
listeners_adder:function(a){return a.zpp_inner.space!=this?(null!=a.zpp_inner.space&&a.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(a),this.addListener(a.zpp_inner),!0):!1},listeners_subber:function(a){this.remListener(a.zpp_inner)},addListener:function(a){a.space=this;a.addedToSpace();null!=a.interaction&&null},remListener:function(a){null!=a.interaction&&null;a.removedFromSpace();a.space=null},add_callbackset:function(a){a.int1.cbsets.inlined_add(a);a.int2.cbsets.inlined_add(a);this.callbackset_list.inlined_add(a)},
remove_callbackset:function(a){a.lazydel=!0;a.int1.cbsets.inlined_try_remove(a);a.int2.cbsets.inlined_try_remove(a)},transmitType:function(a,b){a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!1));a.type==f.id_BodyType_DYNAMIC?this.live.remove(a):a.type==f.id_BodyType_KINEMATIC?(this.kinematics.remove(a),this.staticsleep.remove(a)):a.type==f.id_BodyType_STATIC&&this.staticsleep.remove(a);
a.type=b;a.type==f.id_BodyType_KINEMATIC&&this.kinematics.add(a);a.type==f.id_BodyType_STATIC&&this.static_validation(a);a.component.sleeping=!0;a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!0))},added_shape:function(a,b){null==b&&(b=!1);if(!b){var c=a.body;c.world||(c.component.waket=this.stamp+(this.midstep?0:1),c.type==f.id_BodyType_KINEMATIC&&(c.kinematicDelaySleep=!0),c.component.sleeping&&
this.really_wake(c,!1))}this.bphase.insert(a);a.addedToSpace()},removed_shape:function(a,b){null==b&&(b=!1);var c=this,d=a.body;b||d.wake();for(var e=null,i=d.arbiters.head;null!=i;){var g=[i.elt];if(g[0].ws1==a||g[0].ws2==a){if(0!=g[0].present){this.MRCA_chains(g[0].ws1,g[0].ws2);for(i=this.mrca1.head;null!=i;){for(var h=i.elt,j=this.mrca2.head;null!=j;){var k=j.elt,l=h.cbSet,n=k.cbSet;l.validate();n.validate();l.manager.pair(l,n).empty_intersection()||(k=[Ba.get(h,k)],k[0].remove_arb(g[0]),g[0].present--,
l.manager.pair(l,n).forall(f.id_CbEvent_END,function(a,b){return function(d){if(0!=(d.itype&b[0].type)&&a[0].empty_arb(d.itype)){var e=c.push_callback(d);e.event=f.id_CbEvent_END;Ba.int_callback(a[0],d,e);e.set=a[0]}}}(k,g)),null==k[0].arbiters.head&&this.remove_callbackset(k[0]));j=j.next}i=i.next}}g[0].b1!=d&&g[0].b1.type==f.id_BodyType_DYNAMIC&&(i=g[0].b1,i.world||(i.component.waket=this.stamp+(this.midstep?0:1),i.type==f.id_BodyType_KINEMATIC&&(i.kinematicDelaySleep=!0),i.component.sleeping&&
this.really_wake(i,!1)));g[0].b2!=d&&g[0].b2.type==f.id_BodyType_DYNAMIC&&(i=g[0].b2,i.world||(i.component.waket=this.stamp+(this.midstep?0:1),i.type==f.id_BodyType_KINEMATIC&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!1)));g[0].cleared=!0;(null==d||g[0].b2==d)&&g[0].b1.arbiters.inlined_try_remove(g[0]);(null==d||g[0].b1==d)&&g[0].b2.arbiters.inlined_try_remove(g[0]);null!=g[0].pair&&(g[0].pair.arb=null,g[0].pair=null);g[0].active=!1;this.f_arbiters.modified=!0;i=d.arbiters.erase(e)}else e=
i,i=i.next}this.bphase.remove(a);a.removedFromSpace()},addConstraint:function(a){a.space=this;a.addedToSpace();a.active&&(a.component.sleeping=!0,this.wake_constraint(a,!0))},remConstraint:function(a){a.active&&(this.wake_constraint(a,!0),this.live_constraints.remove(a));a.removedFromSpace();a.space=null},addCompound:function(a){a.space=this;a.addedToSpace();for(var b=a.bodies.head;null!=b;)this.addBody(b.elt),b=b.next;for(b=a.constraints.head;null!=b;)this.addConstraint(b.elt),b=b.next;for(a=a.compounds.head;null!=
a;)this.addCompound(a.elt),a=a.next},remCompound:function(a){for(var b=a.bodies.head;null!=b;)this.remBody(b.elt),b=b.next;for(b=a.constraints.head;null!=b;)this.remConstraint(b.elt),b=b.next;for(b=a.compounds.head;null!=b;)this.remCompound(b.elt),b=b.next;a.removedFromSpace();a.space=null},addBody:function(a,b){null==b&&(b=-1);a.space=this;a.addedToSpace();a.component.sleeping=!0;a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),
a.component.sleeping&&this.really_wake(a,!0));for(var c=a.shapes.head;null!=c;)this.added_shape(c.elt,!0),c=c.next;a.type==f.id_BodyType_STATIC?this.static_validation(a):a.type!=f.id_BodyType_DYNAMIC&&b!=f.id_BodyType_KINEMATIC&&this.kinematics.add(a)},remBody:function(a,b){null==b&&(b=-1);a.type==f.id_BodyType_STATIC?(a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!0)),this.staticsleep.remove(a)):
a.type==f.id_BodyType_DYNAMIC?(a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!0)),this.live.remove(a)):(b!=f.id_BodyType_KINEMATIC&&this.kinematics.remove(a),a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,!0)),this.staticsleep.remove(a));for(var c=a.shapes.head;null!=c;)this.removed_shape(c.elt,
!0),c=c.next;a.removedFromSpace();a.space=null},push_callback:function(a){var b;null==Jc.zpp_pool?b=new Jc:(b=Jc.zpp_pool,Jc.zpp_pool=b.next,b.next=null);null;this.callbacks.push(b);b.listener=a;return b},step:function(a,b,c){var d=this;this.time+=a;this.pre_dt=a;this.midstep=!0;this.stamp++;this.validation();this.bphase.broadphase(this,!0);this.prestep(a);if(this.sortcontacts){var e=this.c_arbiters_false;if(null!=e.head&&null!=e.head.next){var i=e.head,g=null,h=null,j=null,k=null,l=1,n,o,p;do{n=
0;h=i;for(g=i=null;null!=h;){n++;j=h;o=0;for(p=l;null!=j&&o<l;)o++,j=j.next;for(;0<o||0<p&&null!=j;)0==o?(k=j,j=j.next,p--):0==p||null==j?(k=h,h=h.next,o--):(h.elt.active&&j.elt.active?h.elt.oc1.dist<j.elt.oc1.dist:1)?(k=h,h=h.next,o--):(k=j,j=j.next,p--),null!=g?g.next=k:i=k,g=k;h=j}g.next=null;l<<=1}while(1<n);e.head=i;e.modified=!0;e.pushmod=!0}}this.updateVel(a);this.warmStart();this.iterateVel(b);for(b=this.kinematics.head;null!=b;)e=b.elt,e.pre_posx=e.posx,e.pre_posy=e.posy,e.pre_rot=e.rot,
b=b.next;for(b=this.live.head;null!=b;)e=b.elt,e.pre_posx=e.posx,e.pre_posy=e.posy,e.pre_rot=e.rot,b=b.next;this.updatePos(a);this.continuous=!0;this.continuousCollisions(a);this.continuous=!1;this.iteratePos(c);for(c=this.kinematics.head;null!=c;)b=c.elt,e=b.pre_rot!=b.rot,!(b.posx==b.pre_posx&&b.posy==b.pre_posy)&&b.invalidate_pos(),e&&b.invalidate_rot(),c=c.next;for(c=this.live.head;null!=c;)b=c.elt,e=b.pre_rot!=b.rot,!(b.posx==b.pre_posx&&b.posy==b.pre_posy)&&b.invalidate_pos(),e&&b.invalidate_rot(),
c=c.next;c=null;for(b=this.staticsleep.head;null!=b;)e=b.elt,e.type!=f.id_BodyType_KINEMATIC||0==e.velx&&0==e.vely&&0==e.angvel?e.kinematicDelaySleep?(e.kinematicDelaySleep=!1,b=b.next):(e.component.sleeping=!0,b=this.staticsleep.inlined_erase(c)):(c=b,b=b.next);this.doForests(a);this.sleepArbiters();this.midstep=!1;c=null;for(a=this.callbackset_list.next;null!=a;)b=[a],null==b[0].arbiters.head?(a=this.callbackset_list.inlined_erase(c),b=b[0],b.int1=b.int2=null,b.id=b.di=-1,b.freed=!0,null,b.next=
Ha.zpp_pool,Ha.zpp_pool=b):(c=[b[0].sleeping()],ma.find_all(b[0].int1.cbSet,b[0].int2.cbSet,f.id_CbEvent_ONGOING,function(a,b){return function(c){if((!a[0]||c.allowSleepingCallbacks)&&!b[0].empty_arb(c.itype)){var e=d.push_callback(c);e.event=f.id_CbEvent_ONGOING;Ba.int_callback(b[0],c,e);e.set=b[0]}}}(c,b)),c=a,a=a.next);for(;!this.callbacks.empty();)a=this.callbacks.pop(),a.listener.type==f.id_ListenerType_BODY?a.listener.body.handler(a.wrapper_body()):a.listener.type==f.id_ListenerType_CONSTRAINT?
a.listener.constraint.handler(a.wrapper_con()):a.listener.type==f.id_ListenerType_INTERACTION&&a.listener.interaction.handleri(a.wrapper_int()),a.int1=a.int2=null,a.body=null,a.constraint=null,a.listener=null,null!=a.wrap_arbiters&&(a.wrap_arbiters.zpp_inner.inner=null),a.set=null,a.next=Jc.zpp_pool,Jc.zpp_pool=a},continuousCollisions:function(a){var b=2*Math.PI/a;this.bphase.broadphase(this,!1);for(var c=0;1>c&&null!=this.toiEvents.head;){for(var d=null,c=2,e=!1,i=null,g=null,h=this.toiEvents.head;null!=
h;){var j=h.elt,k=j.s1.body,l=j.s2.body;if(k.sweepFrozen&&l.sweepFrozen)if(0!=j.toi&&H.testCollide_safe(j.s1,j.s2))j.toi=0;else{h=this.toiEvents.erase(g);j.next=Ta.zpp_pool;Ta.zpp_pool=j;continue}if(j.frozen1!=k.sweepFrozen||j.frozen2!=l.sweepFrozen)if(j.kinematic){h=this.toiEvents.erase(g);j.next=Ta.zpp_pool;Ta.zpp_pool=j;continue}else if(j.frozen1=k.sweepFrozen,j.frozen2=l.sweepFrozen,j.frozen1&&(k=j.s1,j.s1=j.s2,j.s2=k,j.frozen1=!1,j.frozen2=!0),nc.staticSweep(j,a,0,t.collisionSlopCCD),0>j.toi){h=
this.toiEvents.erase(g);j.next=Ta.zpp_pool;Ta.zpp_pool=j;continue}if(0<=j.toi&&(j.toi<c||!e&&j.kinematic))d=j,c=j.toi,e=j.kinematic,i=g;g=h;h=h.next}if(null==d)break;this.toiEvents.erase(i);c=d.toi;e=d.s1.body;i=d.s2.body;e.sweepFrozen||(e.sweepIntegrate(c*a),e.sweepValidate(d.s1));i.sweepFrozen||(i.sweepIntegrate(c*a),i.sweepValidate(d.s2));g=this.narrowPhase(d.s1,d.s2,!0,d.arbiter,!0);null==g?null!=d.arbiter&&null!=d.arbiter.pair&&(d.arbiter.pair.arb=null,d.arbiter.pair=null):!this.presteparb(g,
a,!0)&&g.type==Z.COL&&g.active&&0!=(g.immState&f.id_ImmState_ACCEPT)&&(g.colarb.warmStart(),g.colarb.applyImpulseVel(),g.colarb.applyImpulseVel(),g.colarb.applyImpulseVel(),g.colarb.applyImpulseVel(),e.sweep_angvel=e.angvel%b,i.sweep_angvel=i.angvel%b);null!=g&&g.active&&0!=(g.immState&f.id_ImmState_ACCEPT)&&g.type==Z.COL&&(!e.sweepFrozen&&e.type!=f.id_BodyType_KINEMATIC&&(e.sweepFrozen=!0,e.angvel=d.failed?e.sweep_angvel=0:d.slipped?e.sweep_angvel*=t.angularCCDSlipScale:e.sweep_angvel),!i.sweepFrozen&&
i.type!=f.id_BodyType_KINEMATIC&&(i.sweepFrozen=!0,i.angvel=d.failed?i.sweep_angvel=0:d.slipped?i.sweep_angvel*=t.angularCCDSlipScale:i.sweep_angvel));d.next=Ta.zpp_pool;Ta.zpp_pool=d}for(;null!=this.toiEvents.head;)b=this.toiEvents.pop_unsafe(),b.next=Ta.zpp_pool,Ta.zpp_pool=b;for(b=this.kinematics.head;null!=b;)d=b.elt,d.sweepIntegrate(a),d.sweepTime=0,b=b.next;for(b=this.live.head;null!=b;)d=b.elt,d.sweepFrozen||d.sweepIntegrate(a),d.sweepTime=0,b=b.next},continuousEvent:function(a,b,c,d){if(a.body.sweepFrozen&&
b.body.sweepFrozen||a.body.disableCCD||b.body.disableCCD||null!=d&&null==d.colarb||0>=this.interactionType(a,b,a.body,b.body))return d;var e=a.body,g=b.body;if(c||e.bullet||g.bullet){var h;null==Ta.zpp_pool?h=new Ta:(h=Ta.zpp_pool,Ta.zpp_pool=h.next,h.next=null);h.failed=!1;h.s1=h.s2=null;h.arbiter=null;e=e.type==f.id_BodyType_KINEMATIC||g.type==f.id_BodyType_KINEMATIC;c&&!e?(a.body.type!=f.id_BodyType_DYNAMIC?(h.s2=a,h.s1=b):(h.s1=a,h.s2=b),h.kinematic=!1,nc.staticSweep(h,this.pre_dt,0,t.collisionSlopCCD)):
(h.s1=a,h.s2=b,h.kinematic=e,h.s1.body.sweepFrozen||h.s2.body.sweepFrozen?(h.s1.body.sweepFrozen&&(a=h.s1,h.s1=h.s2,h.s2=a,h.frozen1=!1,h.frozen2=!0),nc.staticSweep(h,this.pre_dt,0,t.collisionSlopCCD)):nc.dynamicSweep(h,this.pre_dt,0,t.collisionSlopCCD));c&&0>h.toi||h.failed?(c=h,c.next=Ta.zpp_pool,Ta.zpp_pool=c):(this.toiEvents.add(h),h.frozen1=h.s1.body.sweepFrozen,h.frozen2=h.s2.body.sweepFrozen,h.arbiter=null!=d?d.colarb:null)}return d},bodyCbWake:function(a){if(a.type==f.id_BodyType_DYNAMIC&&
null!=a.cbSet)if(this.midstep)for(var b=a.cbSet.bodylisteners.head;null!=b;){var c=b.elt;c.event==f.id_CbEvent_WAKE&&(c=this.push_callback(c),c.event=f.id_CbEvent_WAKE,c.body=a);b=b.next}else a.component.woken=!0},bodyCbSleep:function(a){if(a.type==f.id_BodyType_DYNAMIC&&null!=a.cbSet)for(var b=a.cbSet.bodylisteners.head;null!=b;){var c=b.elt;c.event==f.id_CbEvent_SLEEP&&(c=this.push_callback(c),c.event=f.id_CbEvent_SLEEP,c.body=a);b=b.next}},constraintCbWake:function(a){if(null!=a.cbSet)if(this.midstep)for(var b=
a.cbSet.conlisteners.head;null!=b;){var c=b.elt;c.event==f.id_CbEvent_WAKE&&(c=this.push_callback(c),c.event=f.id_CbEvent_WAKE,c.constraint=a);b=b.next}else a.component.woken=!0},constraintCbSleep:function(a){if(null!=a.cbSet)for(var b=a.cbSet.conlisteners.head;null!=b;){var c=b.elt;c.event==f.id_CbEvent_SLEEP&&(c=this.push_callback(c),c.event=f.id_CbEvent_SLEEP,c.constraint=a);b=b.next}},constraintCbBreak:function(a){if(null!=a.cbSet)for(var b=a.cbSet.conlisteners.head;null!=b;){var c=b.elt;c.event==
f.id_CbEvent_BREAK&&(c=this.push_callback(c),c.event=f.id_CbEvent_BREAK,c.constraint=a);b=b.next}},nullListenerType:function(a,b){for(var c=new Dc,d=a.interactors.head;null!=d;)c.add(d.elt),d=d.next;if(a!=b)for(d=b.interactors.head;null!=d;)c.add(d.elt),d=d.next;for(;null!=c.head;)if(d=c.pop_unsafe(),null!=d.icompound){for(var d=d.icompound,e=d.bodies.head;null!=e;)c.add(e.elt),e=e.next;for(d=d.compounds.head;null!=d;)c.add(d.elt),d=d.next}else{e=null!=d.ibody?d.ibody:d.ishape.body;d=null!=d.ishape?
d.ishape:null;for(e=e.arbiters.head;null!=e;){var f=e.elt;if(0!=f.present&&(null==d||f.ws1==d||f.ws2==d)){this.MRCA_chains(f.ws1,f.ws2);for(f=this.mrca1.head;null!=f;){var g=f.elt;if(!(g.cbSet!=a&&g.cbSet!=b))for(var h=this.mrca2.head;null!=h;){var j=h.elt;if(!(g.cbSet==a&&j.cbSet!=b||g.cbSet==b&&j.cbSet!=a))if(j=Ba.get(g,j),null!=j){for(;null!=j.arbiters.head;)j.arbiters.pop_unsafe().present--;this.remove_callbackset(j)}h=h.next}f=f.next}}e=e.next}}},nullInteractorType:function(a,b){null==b&&(b=
a);if(null!=a.icompound){for(var c=a.icompound,d=c.bodies.head;null!=d;)this.nullInteractorType(d.elt,b),d=d.next;for(c=c.compounds.head;null!=c;)this.nullInteractorType(c.elt,b),c=c.next}else{d=null!=a.ibody?a.ibody:a.ishape.body;c=null!=a.ishape?a.ishape:null;for(d=d.arbiters.head;null!=d;){var e=d.elt;if(0!=e.present&&(null==c||e.ws1==c||e.ws2==c)){this.MRCA_chains(e.ws1,e.ws2);for(var f=this.mrca1.head;null!=f;){for(var g=f.elt,h=this.mrca2.head;null!=h;){var j=h.elt;g!=b&&j!=b||(j=Ba.get(g,j),
null!=j&&(e.present--,j.remove_arb(e),null==j.arbiters.head&&this.remove_callbackset(j)));h=h.next}f=f.next}}d=d.next}}},freshListenerType:function(a,b){for(var c=new Dc,d=a.interactors.head;null!=d;)c.add(d.elt),d=d.next;if(a!=b)for(d=b.interactors.head;null!=d;)c.add(d.elt),d=d.next;for(;null!=c.head;)if(d=c.pop_unsafe(),null!=d.icompound){for(var d=d.icompound,e=d.bodies.head;null!=e;)c.add(e.elt),e=e.next;for(d=d.compounds.head;null!=d;)c.add(d.elt),d=d.next}else{e=null!=d.ibody?d.ibody:d.ishape.body;
d=null!=d.ishape?d.ishape:null;for(e=e.arbiters.head;null!=e;){var f=e.elt;if(f.presentable&&(null==d||f.ws1==d||f.ws2==d)){this.MRCA_chains(f.ws1,f.ws2);for(var g=this.mrca1.head;null!=g;){var h=g.elt;if(!(h.cbSet!=a&&h.cbSet!=b))for(var j=this.mrca2.head;null!=j;){var k=j.elt;if(!(h.cbSet==a&&k.cbSet!=b||h.cbSet==b&&k.cbSet!=a)){var l=Ba.get(h,k);null==l&&(l=Ha.get(h,k),this.add_callbackset(l));if(k=!l.arbiters.inlined_has(f))l.arbiters.inlined_add(f),k=!0;k&&f.present++}j=j.next}g=g.next}}e=e.next}}},
freshInteractorType:function(a,b){null==b&&(b=a);if(null!=a.icompound){for(var c=a.icompound,d=c.bodies.head;null!=d;)this.freshInteractorType(d.elt,b),d=d.next;for(c=c.compounds.head;null!=c;)this.freshInteractorType(c.elt,b),c=c.next}else{d=null!=a.ibody?a.ibody:a.ishape.body;c=null!=a.ishape?a.ishape:null;for(d=d.arbiters.head;null!=d;){var e=d.elt;if(e.presentable&&(null==c||e.ws1==c||e.ws2==c)){this.MRCA_chains(e.ws1,e.ws2);for(var f=this.mrca1.head;null!=f;){for(var g=f.elt,h=this.mrca2.head;null!=
h;){var j=h.elt;if(!(g!=b&&j!=b)){var k=g.cbSet,l=j.cbSet;k.validate();l.validate();if(!k.manager.pair(k,l).empty_intersection()){k=Ba.get(g,j);null==k&&(k=Ha.get(g,j),this.add_callbackset(k));if(j=!k.arbiters.inlined_has(e))k.arbiters.inlined_add(e),j=!0;j&&e.present++}}h=h.next}f=f.next}}d=d.next}}},wakeCompound:function(a){for(var b=a.bodies.head;null!=b;){var c=b.elt;c.world||(c.component.waket=this.stamp+(this.midstep?0:1),c.type==f.id_BodyType_KINEMATIC&&(c.kinematicDelaySleep=!0),c.component.sleeping&&
this.really_wake(c,!1));b=b.next}for(b=a.constraints.head;null!=b;)this.wake_constraint(b.elt),b=b.next;for(a=a.compounds.head;null!=a;)this.wakeCompound(a.elt),a=a.next},wakeIsland:function(a){for(;null!=a.comps.head;){var b=a.comps.pop_unsafe();b.waket=this.stamp+(this.midstep?0:1);if(b.isBody){var c=b.body;this.live.add(c);for(var d=c.arbiters.head;null!=d;){var e=d.elt;e.sleeping&&(e.sleeping=!1,e.up_stamp+=this.stamp-e.sleep_stamp,e.type==Z.COL?(e=e.colarb,e.stat?this.c_arbiters_true.inlined_add(e):
this.c_arbiters_false.inlined_add(e)):e.type==Z.FLUID?this.f_arbiters.inlined_add(e.fluidarb):this.s_arbiters.inlined_add(e.sensorarb));d=d.next}this.bodyCbWake(c);b.sleeping=!1;b.island=null;b.parent=b;b.rank=0;if(c.type!=f.id_BodyType_STATIC)for(b=c.shapes.head;null!=b;)c=b.elt,null!=c.node&&this.bphase.sync(c),b=b.next}else c=b.constraint,this.live_constraints.inlined_add(c),this.constraintCbWake(c),b.sleeping=!1,b.island=null,b.parent=b,b.rank=0}a.next=pc.zpp_pool;pc.zpp_pool=a},non_inlined_wake:function(a,
b){null==b&&(b=!1);a.world||(a.component.waket=this.stamp+(this.midstep?0:1),a.type==f.id_BodyType_KINEMATIC&&(a.kinematicDelaySleep=!0),a.component.sleeping&&this.really_wake(a,b))},really_wake:function(a,b){null==b&&(b=!1);if(null==a.component.island){a.component.sleeping=!1;a.type==f.id_BodyType_KINEMATIC||a.type==f.id_BodyType_STATIC?this.staticsleep.inlined_add(a):this.live.inlined_add(a);for(var c=a.constraints.head;null!=c;){var d=c.elt;d.space==this&&this.wake_constraint(d);c=c.next}for(c=
a.arbiters.head;null!=c;){d=c.elt;if(d.sleeping)if(d.sleeping=!1,d.up_stamp+=this.stamp+(this.midstep?0:1)-d.sleep_stamp,d.type==Z.COL){var e=d.colarb;e.stat?this.c_arbiters_true.inlined_add(e):this.c_arbiters_false.inlined_add(e)}else d.type==Z.FLUID?this.f_arbiters.inlined_add(d.fluidarb):this.s_arbiters.inlined_add(d.sensorarb);d.type!=Z.SENSOR&&!d.cleared&&d.up_stamp>=this.stamp&&0!=(d.immState&f.id_ImmState_ACCEPT)&&(d.b1.type==f.id_BodyType_DYNAMIC&&d.b1.component.sleeping&&(e=d.b1,e.world||
(e.component.waket=this.stamp+(this.midstep?0:1),e.type==f.id_BodyType_KINEMATIC&&(e.kinematicDelaySleep=!0),e.component.sleeping&&this.really_wake(e,!1))),d.b2.type==f.id_BodyType_DYNAMIC&&d.b2.component.sleeping&&(d=d.b2,d.world||(d.component.waket=this.stamp+(this.midstep?0:1),d.type==f.id_BodyType_KINEMATIC&&(d.kinematicDelaySleep=!0),d.component.sleeping&&this.really_wake(d,!1))));c=c.next}!b&&a.type==f.id_BodyType_DYNAMIC&&this.bodyCbWake(a);if(!b&&!this.bphase.is_sweep&&a.type!=f.id_BodyType_STATIC)for(c=
a.shapes.head;null!=c;)d=c.elt,null!=d.node&&this.bphase.sync(d),c=c.next}else this.wakeIsland(a.component.island)},wake_constraint:function(a,b){null==b&&(b=!1);return a.active&&(a.component.waket=this.stamp+(this.midstep?0:1),a.component.sleeping)?(null==a.component.island?(a.component.sleeping=!1,this.live_constraints.inlined_add(a),a.wake_connected(),b||this.constraintCbWake(a)):this.wakeIsland(a.component.island),!0):!1},doForests:function(a){for(var b=this.c_arbiters_false.head;null!=b;){var c=
b.elt;if(!c.cleared&&c.up_stamp==this.stamp&&0!=(c.immState&f.id_ImmState_ACCEPT)&&c.b1.type==f.id_BodyType_DYNAMIC&&c.b2.type==f.id_BodyType_DYNAMIC){var d;if(c.b1.component==c.b1.component.parent)d=c.b1.component;else{d=c.b1.component;for(var e=null;d!=d.parent;){var g=d.parent;d.parent=e;e=d;d=g}for(;null!=e;)g=e.parent,e.parent=d,e=g}if(c.b2.component==c.b2.component.parent)c=c.b2.component;else{c=c.b2.component;for(e=null;c!=c.parent;)g=c.parent,c.parent=e,e=c,c=g;for(;null!=e;)g=e.parent,e.parent=
c,e=g}d!=c&&(d.rank<c.rank?d.parent=c:d.rank>c.rank?c.parent=d:(c.parent=d,d.rank++))}b=b.next}for(b=this.f_arbiters.head;null!=b;){c=b.elt;if(!c.cleared&&c.up_stamp==this.stamp&&0!=(c.immState&f.id_ImmState_ACCEPT)&&c.b1.type==f.id_BodyType_DYNAMIC&&c.b2.type==f.id_BodyType_DYNAMIC){if(c.b1.component==c.b1.component.parent)d=c.b1.component;else{d=c.b1.component;for(e=null;d!=d.parent;)g=d.parent,d.parent=e,e=d,d=g;for(;null!=e;)g=e.parent,e.parent=d,e=g}if(c.b2.component==c.b2.component.parent)c=
c.b2.component;else{c=c.b2.component;for(e=null;c!=c.parent;)g=c.parent,c.parent=e,e=c,c=g;for(;null!=e;)g=e.parent,e.parent=c,e=g}d!=c&&(d.rank<c.rank?d.parent=c:d.rank>c.rank?c.parent=d:(c.parent=d,d.rank++))}b=b.next}for(b=this.live_constraints.head;null!=b;)b.elt.forest(),b=b.next;for(;null!=this.live.head;){d=this.live.inlined_pop_unsafe();b=d.component;if(b==b.parent)c=b;else{c=b;for(e=null;c!=c.parent;)g=c.parent,c.parent=e,e=c,c=g;for(;null!=e;)g=e.parent,e.parent=c,e=g}null==c.island&&(null==
pc.zpp_pool?c.island=new pc:(c.island=pc.zpp_pool,pc.zpp_pool=c.island.next,c.island.next=null),c.island.waket=0,this.islands.inlined_add(c.island),c.island.sleep=!0);b.island=c.island;b.island.comps.inlined_add(b);d=d.atRest(a);b.island.sleep=b.island.sleep&&d;b.waket>b.island.waket&&(b.island.waket=b.waket)}for(;null!=this.live_constraints.head;){a=this.live_constraints.inlined_pop_unsafe().component;if(a==a.parent)b=a;else{b=a;for(d=null;b!=b.parent;)c=b.parent,b.parent=d,d=b,b=c;for(;null!=d;)c=
d.parent,d.parent=b,d=c}a.island=b.island;a.island.comps.inlined_add(a);a.waket>a.island.waket&&(a.island.waket=a.waket)}for(;null!=this.islands.next;)if(a=this.islands.inlined_pop_unsafe(),a.sleep)for(a=a.comps.head;null!=a;){d=a.elt;if(d.isBody){b=d.body;b.velx=0;b.vely=0;b.angvel=0;d.sleeping=!0;for(d=b.shapes.head;null!=d;)this.bphase.sync(d.elt),d=d.next;this.bodyCbSleep(b)}else this.constraintCbSleep(d.constraint),d.sleeping=!0;a=a.next}else{for(;null!=a.comps.head;)b=a.comps.inlined_pop_unsafe(),
b.waket=a.waket,b.isBody?this.live.inlined_add(b.body):this.live_constraints.inlined_add(b.constraint),b.sleeping=!1,b.island=null,b.parent=b,b.rank=0;a.next=pc.zpp_pool;pc.zpp_pool=a}},sleepArbiters:function(){var a=null,b=this.c_arbiters_true,c=b.head,d=null!=this.c_arbiters_false;d&&null==c&&(d=!1,c=this.c_arbiters_false.head,b=this.c_arbiters_false,a=null);for(;null!=c;){var e=c.elt;e.b1.component.sleeping&&e.b2.component.sleeping?(e.sleep_stamp=this.stamp,e.sleeping=!0,c=b.inlined_erase(a)):
(a=c,c=c.next);d&&null==c&&(d=!1,c=this.c_arbiters_false.head,b=this.c_arbiters_false,a=null)}a=null;b=this.f_arbiters;c=b.head;d=!1;for(;null!=c;)e=c.elt,e.b1.component.sleeping&&e.b2.component.sleeping?(e.sleep_stamp=this.stamp,e.sleeping=!0,c=b.inlined_erase(a)):(a=c,c=c.next),d&&null==c&&(d=!1,a=b=null);a=null;b=this.s_arbiters;c=b.head;d=!1;for(;null!=c;)e=c.elt,e.b1.component.sleeping&&e.b2.component.sleeping?(e.sleep_stamp=this.stamp,e.sleeping=!0,c=b.inlined_erase(a)):(a=c,c=c.next),d&&null==
c&&(d=!1,a=b=null)},static_validation:function(a){null!=a.shapes.head&&a.validate_aabb();a.validate_mass();a.validate_inertia();for(var b=a.shapes.head;null!=b;){var c=b.elt;c.type==f.id_ShapeType_POLYGON&&(c.polygon.splice_collinear(),c.polygon.validate_gaxi());b=b.next}a.sweepFrozen=!0},validation:function(){this.cbsets.validate();for(var a=this.live.head;null!=a;){var b=a.elt;b.sweepRadius=0;for(var c=b.shapes.head;null!=c;){var d=c.elt;d.type==f.id_ShapeType_POLYGON&&(d.polygon.splice_collinear(),
d.polygon.validate_gaxi());d.validate_sweepRadius();d.sweepRadius>b.sweepRadius&&(b.sweepRadius=d.sweepRadius);c=c.next}b.validate_mass();b.validate_inertia();null!=b.shapes.head&&(b.validate_aabb(),b.validate_worldCOM());b.validate_gravMass();b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot),null);if(b.component.woken&&null!=b.cbSet)for(c=b.cbSet.bodylisteners.head;null!=c;)d=c.elt,d.event==f.id_CbEvent_WAKE&&(d=this.push_callback(d),d.event=f.id_CbEvent_WAKE,d.body=b),c=
c.next;b.component.woken=!1;for(b=b.shapes.head;null!=b;)this.bphase.sync(b.elt),b=b.next;a=a.next}for(a=this.kinematics.head;null!=a;){b=a.elt;b.sweepRadius=0;for(c=b.shapes.head;null!=c;)d=c.elt,d.type==f.id_ShapeType_POLYGON&&(d.polygon.splice_collinear(),d.polygon.validate_gaxi()),d.validate_sweepRadius(),d.sweepRadius>b.sweepRadius&&(b.sweepRadius=d.sweepRadius),c=c.next;b.validate_mass();b.validate_inertia();null!=b.shapes.head&&(b.validate_aabb(),b.validate_worldCOM());b.validate_gravMass();
b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot),null);for(b=b.shapes.head;null!=b;)this.bphase.sync(b.elt),b=b.next;a=a.next}for(a=this.live_constraints.head;null!=a;){b=a.elt;if(b.active){if(b.component.woken&&null!=b.cbSet)for(c=b.cbSet.conlisteners.head;null!=c;)d=c.elt,d.event==f.id_CbEvent_WAKE&&(d=this.push_callback(d),d.event=f.id_CbEvent_WAKE,d.constraint=b),c=c.next;b.component.woken=!1}a=a.next}},updateVel:function(a){for(var b=1-a*this.global_lin_drag,c=1-a*this.global_ang_drag,
d=this.live.head;null!=d;){var e=d.elt;if(0!=e.smass){var f=a*e.imass;e.velx=b*e.velx+(e.forcex+this.gravityx*e.gravMass)*f;e.vely=b*e.vely+(e.forcey+this.gravityy*e.gravMass)*f}if(0!=e.sinertia){var g=f=0,f=e.worldCOMx-e.posx,g=e.worldCOMy-e.posy;e.angvel=c*e.angvel+(e.torque+(this.gravityy*f-this.gravityx*g)*e.gravMass)*a*e.iinertia}d=d.next}},updatePos:function(a){for(var b=2*Math.PI/a,c=this.live.head;null!=c;){var d=c.elt;d.pre_posx=d.posx;d.pre_posy=d.posy;d.pre_rot=d.rot;d.sweepTime=0;d.sweep_angvel=
d.angvel%b;d.sweepIntegrate(a);if(d.disableCCD)d.sweepFrozen=!0,d.bullet=!1;else{var e=t.staticCCDLinearThreshold*d.sweepRadius,g=t.staticCCDAngularThreshold;if((d.velx*d.velx+d.vely*d.vely)*a*a>e*e||d.angvel*d.angvel*a*a>g*g||d.type==f.id_BodyType_KINEMATIC){e=d.sweep_angvel;0>e&&(e=-e);for(var g=1/e,h=d.shapes.head;null!=h;){var j=h.elt,k=j.aabb,l=k.minx,n=k.miny,o=k.maxx,p=k.maxy,q=0.008333333333333333*e*a*j.sweepCoef|0;8<q&&(q=8);var u=e*a/q;d.sweepIntegrate(a);j.type==f.id_ShapeType_CIRCLE?j.circle._force_validate_aabb():
j.polygon._force_validate_aabb();l<k.minx?k.minx=l:l=k.minx;n<k.miny?k.miny=n:n=k.miny;o>k.maxx?k.maxx=o:o=k.maxx;p>k.maxy?k.maxy=p:p=k.maxy;for(var v=1;v<q;){var w=v++;d.sweepIntegrate(u*w*g);j.type==f.id_ShapeType_CIRCLE?j.circle._force_validate_aabb():j.polygon._force_validate_aabb();l<k.minx?k.minx=l:l=k.minx;n<k.miny?k.miny=n:n=k.miny;o>k.maxx?k.maxx=o:o=k.maxx;p>k.maxy?k.maxy=p:p=k.maxy}this.bphase.sync(j);h=h.next}d.sweepFrozen=!1;if(d.type==f.id_BodyType_DYNAMIC&&d.bulletEnabled&&(e=t.bulletCCDLinearThreshold*
d.sweepRadius,g=t.bulletCCDAngularThreshold,(d.velx*d.velx+d.vely*d.vely)*a*a>e*e||d.angvel*d.angvel*a*a>g*g))d.bullet=!0}else d.sweepFrozen=!0,d.bullet=!1}c=c.next}for(c=this.kinematics.head;null!=c;){d=c.elt;d.pre_posx=d.posx;d.pre_posy=d.posy;d.pre_rot=d.rot;d.sweepTime=0;d.sweep_angvel=d.angvel%b;d.sweepIntegrate(a);if(d.disableCCD)d.sweepFrozen=!0,d.bullet=!1;else if(e=t.staticCCDLinearThreshold*d.sweepRadius,g=t.staticCCDAngularThreshold,(d.velx*d.velx+d.vely*d.vely)*a*a>e*e||d.angvel*d.angvel*
a*a>g*g||d.type==f.id_BodyType_KINEMATIC){e=d.sweep_angvel;0>e&&(e=-e);g=1/e;for(h=d.shapes.head;null!=h;){j=h.elt;k=j.aabb;l=k.minx;n=k.miny;o=k.maxx;p=k.maxy;q=0.008333333333333333*e*a*j.sweepCoef|0;8<q&&(q=8);u=e*a/q;d.sweepIntegrate(a);j.type==f.id_ShapeType_CIRCLE?j.circle._force_validate_aabb():j.polygon._force_validate_aabb();l<k.minx?k.minx=l:l=k.minx;n<k.miny?k.miny=n:n=k.miny;o>k.maxx?k.maxx=o:o=k.maxx;p>k.maxy?k.maxy=p:p=k.maxy;for(v=1;v<q;)w=v++,d.sweepIntegrate(u*w*g),j.type==f.id_ShapeType_CIRCLE?
j.circle._force_validate_aabb():j.polygon._force_validate_aabb(),l<k.minx?k.minx=l:l=k.minx,n<k.miny?k.miny=n:n=k.miny,o>k.maxx?k.maxx=o:o=k.maxx,p>k.maxy?k.maxy=p:p=k.maxy;this.bphase.sync(j);h=h.next}d.sweepFrozen=!1;if(d.type==f.id_BodyType_DYNAMIC&&d.bulletEnabled&&(e=t.bulletCCDLinearThreshold*d.sweepRadius,g=t.bulletCCDAngularThreshold,(d.velx*d.velx+d.vely*d.vely)*a*a>e*e||d.angvel*d.angvel*a*a>g*g))d.bullet=!0}else d.sweepFrozen=!0,d.bullet=!1;c=c.next}},presteparb:function(a,b,c){null==c&&
(c=!1);var d=this;if(!a.cleared&&a.b1.component.sleeping&&a.b2.component.sleeping)return a.sleep_stamp=this.stamp,a.sleeping=!0;if(!a.cleared||0!=a.present||a.intchange){var e=!c&&a.up_stamp==this.stamp-1&&!a.cleared&&!a.intchange,c=a.fresh&&!a.cleared&&!a.intchange;e&&(a.endGenerated=this.stamp);if(c||e||a.cleared||a.intchange){this.inlined_MRCA_chains(a.ws1,a.ws2);for(e=this.mrca1.head;null!=e;){for(var g=e.elt,h=this.mrca2.head;null!=h;){var j=h.elt,k=g.cbSet,l=j.cbSet;if(!k.manager.pair(k,l).empty_intersection()){var n=
[Ba.get(g,j)];if(c||a.intchange){null==n[0]&&(n[0]=Ha.get(g,j),this.add_callbackset(n[0]));k.manager.pair(k,l).forall(f.id_CbEvent_BEGIN,function(b){return function(c){if(0!=(c.itype&a.type)&&b[0].empty_arb(c.itype)){var e=d.push_callback(c);e.event=f.id_CbEvent_BEGIN;Ba.int_callback(b[0],c,e);e.set=b[0]}}}(n));if(j=!n[0].arbiters.inlined_has(a))n[0].arbiters.inlined_add(a),j=!0;j&&a.present++}else a.present--,n[0].remove_arb(a),k.manager.pair(k,l).forall(f.id_CbEvent_END,function(b){return function(c){if(0!=
(c.itype&a.type)&&b[0].empty_arb(c.itype)){var e=d.push_callback(c);e.event=f.id_CbEvent_END;Ba.int_callback(b[0],c,e);e.set=b[0]}}}(n)),null==n[0].arbiters.head&&this.remove_callbackset(n[0])}h=h.next}e=e.next}}a.fresh=!1;a.intchange=!1}if(a.cleared||a.up_stamp+(a.type==Z.COL?t.arbiterExpirationDelay:0)<this.stamp)return a.type==Z.SENSOR?a.sensorarb.retire():a.type==Z.FLUID?a.fluidarb.retire():a.colarb.retire(),!0;c=a.active;a.active=a.presentable=a.up_stamp==this.stamp;0!=(a.immState&f.id_ImmState_ACCEPT)?
a.active&&a.type!=Z.SENSOR&&(null!=a.colarb?a.colarb.preStep(b)&&(a.active=!1):a.fluidarb.preStep(this,b)):null!=a.colarb&&a.colarb.cleanupContacts()&&(a.active=!1);c!=a.active&&(a.b1.arbiters.modified=!0,a.b2.arbiters.modified=!0,this.c_arbiters_true.modified=this.c_arbiters_false.modified=!0,this.s_arbiters.modified=this.f_arbiters.modified=!0);return!1},prestep:function(a){for(var b=null,c=this.live_constraints.head;null!=c;){var d=c.elt;d.preStep(a)?(c=this.live_constraints.erase(b),d.broken(),
this.constraintCbBreak(d),d.removeOnBreak?(d.component.sleeping=!0,this.midstep=!1,null!=d.compound?d.compound.wrap_constraints.remove(d.outer):this.wrap_constraints.remove(d.outer),this.midstep=!0):d.active=!1,d.clearcache()):(b=c,c=c.next)}var b=null,c=this.c_arbiters_true,d=c.head,e=null!=this.c_arbiters_false;e&&null==d&&(e=!1,d=this.c_arbiters_false.head,c=this.c_arbiters_false,b=null);for(;null!=d;)this.presteparb(d.elt,a)?d=c.inlined_erase(b):(b=d,d=d.next),e&&null==d&&(e=!1,d=this.c_arbiters_false.head,
c=this.c_arbiters_false,b=null);b=null;c=this.f_arbiters;d=c.head;e=!1;for(;null!=d;)this.presteparb(d.elt,a)?d=c.inlined_erase(b):(b=d,d=d.next),e&&null==d&&(e=!1,b=c=null);b=null;c=this.s_arbiters;d=c.head;e=!1;for(;null!=d;)this.presteparb(d.elt,a)?d=c.inlined_erase(b):(b=d,d=d.next),e&&null==d&&(e=!1,b=c=null)},warmStart:function(){for(var a=this.f_arbiters.head;null!=a;){var b=a.elt;b.active&&0!=(b.immState&f.id_ImmState_ACCEPT)&&b.warmStart();a=a.next}a=this.c_arbiters_false.head;b=!0;null==
a&&(a=this.c_arbiters_true.head,b=!1);for(;null!=a;){var c=a.elt;c.active&&0!=(c.immState&f.id_ImmState_ACCEPT)&&c.warmStart();a=a.next;b&&null==a&&(a=this.c_arbiters_true.head,b=!1)}for(a=this.live_constraints.head;null!=a;)a.elt.warmStart(),a=a.next},iterateVel:function(a){for(var b=0;b<a;){b++;for(var c=this.f_arbiters.head;null!=c;){var d=c.elt;d.active&&0!=(d.immState&f.id_ImmState_ACCEPT)&&d.applyImpulseVel();c=c.next}c=null;for(d=this.live_constraints.head;null!=d;){var e=d.elt;e.applyImpulseVel()?
(d=this.live_constraints.erase(c),e.broken(),this.constraintCbBreak(e),e.removeOnBreak?(e.component.sleeping=!0,this.midstep=!1,null!=e.compound?e.compound.wrap_constraints.remove(e.outer):this.wrap_constraints.remove(e.outer),this.midstep=!0):e.active=!1,e.clearcache()):(c=d,d=d.next)}c=this.c_arbiters_false.head;d=!0;null==c&&(c=this.c_arbiters_true.head,d=!1);for(;null!=c;)e=c.elt,e.active&&0!=(e.immState&f.id_ImmState_ACCEPT)&&e.applyImpulseVel(),c=c.next,d&&null==c&&(c=this.c_arbiters_true.head,
d=!1)}},iteratePos:function(a){for(var b=0;b<a;){b++;for(var c=null,d=this.live_constraints.head;null!=d;){var e=d.elt;!e.__velocity&&e.stiff&&e.applyImpulsePos()?(d=this.live_constraints.erase(c),e.broken(),this.constraintCbBreak(e),e.removeOnBreak?(e.component.sleeping=!0,this.midstep=!1,null!=e.compound?e.compound.wrap_constraints.remove(e.outer):this.wrap_constraints.remove(e.outer),this.midstep=!0):e.active=!1,e.clearcache()):(c=d,d=d.next)}c=this.c_arbiters_false.head;d=!0;null==c&&(c=this.c_arbiters_true.head,
d=!1);for(;null!=c;)e=c.elt,e.active&&0!=(e.immState&f.id_ImmState_ACCEPT)&&e.applyImpulsePos(),c=c.next,d&&null==c&&(c=this.c_arbiters_true.head,d=!1)}},group_ignore:function(a,b){var c=a.lookup_group();if(null==c)return!1;var d=b.lookup_group();if(null==d)return!1;for(var e=!1;null!=c&&null!=d;){if(c==d){e=c.ignore;break}c.depth<d.depth?d=d.group:c=c.group}return e},interactionType:function(a,b,c,d){var e;e=!1;for(var f=c.constraints.head;null!=f;){var g=f.elt;if(g.ignore&&g.pair_exists(c.id,d.id)){e=
!0;break}f=f.next}return!e&&!this.group_ignore(a,b)?(a.sensorEnabled||b.sensorEnabled)&&a.filter.shouldSense(b.filter)?2:(a.fluidEnabled||b.fluidEnabled)&&a.filter.shouldFlow(b.filter)&&!(0==c.imass&&0==d.imass&&0==c.iinertia&&0==d.iinertia)?0:a.filter.shouldCollide(b.filter)&&!(0==c.imass&&0==d.imass&&0==c.iinertia&&0==d.iinertia)?1:-1:-1},narrowPhase:function(a,b,c,d,e){var g=this,h=null,j=a.body,k=b.body,l=this.interactionType(a,b,j,k);if(-1!=l){var n,o;a.type>b.type?(n=b,o=a):a.type==b.type?a.id<
b.id?(n=a,o=b):(o=a,n=b):(n=a,o=b);var p=n==b;if(0==l){var q;if(null==d){for(var t=null,u=(j.arbiters.length<k.arbiters.length?j:k).arbiters.head;null!=u;){var v=u.elt;if(v.id==n.id&&v.di==o.id){t=v;break}u=u.next}q=t}else q=d;var w=null==q,s,x=!1;w?(null==zb.zpp_pool?s=new zb:(s=zb.zpp_pool,zb.zpp_pool=s.next,s.next=null),null):null==q.fluidarb?(q.cleared=!0,q.b1.arbiters.inlined_try_remove(q),q.b2.arbiters.inlined_try_remove(q),null!=q.pair&&(q.pair.arb=null,q.pair=null),q.active=!1,this.f_arbiters.modified=
!0,null==zb.zpp_pool?s=new zb:(s=zb.zpp_pool,zb.zpp_pool=s.next,s.next=null),null,x=w=s.intchange=!0):s=q.fluidarb;var y=f.id_InteractionType_FLUID;if(w||s.stamp!=this.stamp||e)if(s.stamp=this.stamp,H.flowCollide(n,o,s)){w?(s.b1=a.body,s.ws1=a,s.b2=b.body,s.ws2=b,s.id=n.id,s.di=o.id,s.b1.arbiters.inlined_add(s),s.b2.arbiters.inlined_add(s),s.active=!0,s.present=0,s.cleared=!1,s.sleeping=!1,s.fresh=!1,s.presentable=!1,s.nx=0,s.ny=1,s.dampx=0,s.dampy=0,s.adamp=0,this.f_arbiters.inlined_add(s),s.fresh=
!x):s.fresh=s.up_stamp<this.stamp-1||s.endGenerated==this.stamp&&e;s.up_stamp=s.stamp;if(s.fresh||0==(s.immState&f.id_ImmState_ALWAYS)){s.immState=f.id_ImmState_ACCEPT;var A=!1;this.inlined_MRCA_chains(s.ws1.id>s.ws2.id?s.ws2:s.ws1,s.ws1.id>s.ws2.id?s.ws1:s.ws2);for(var B=this.mrca1.head;null!=B;){for(var C=B.elt,D=this.mrca2.head;null!=D;){var E=D.elt,G=C.cbSet,I=E.cbSet;if(!G.manager.pair(G,I).empty_intersection()){var F=null,K=null;this.prelisteners.inlined_clear();G.manager.pair(G,I).forall(f.id_CbEvent_PRE,
function(a){return function(b){0!=(b.itype&y)&&(a[0]=g.prelisteners.inlined_insert(a[0],b),A=A||!b.pure)}}([null]));if(null!=this.prelisteners.head)if(F=Ba.get(C,E),null==F&&(K=Ha.get(C,E),this.add_callbackset(K)),null==F||(F.FLUIDstamp!=this.stamp||e)&&0==(F.FLUIDstate&f.id_ImmState_ALWAYS)){null!=K&&(F=K);if(null!=F)for(var L=this.prelisteners.head;null!=L;)L.elt.itype==f.id_InteractionType_ANY&&(F.COLLISIONstamp=this.stamp,F.SENSORstamp=this.stamp),F.FLUIDstamp=this.stamp,L=L.next;var N=s.active;
s.active=!0;this.precb.zpp_inner.pre_arbiter=s;this.precb.zpp_inner.set=F;for(var M=this.prelisteners.head;null!=M;){var O=M.elt;this.precb.zpp_inner.listener=O;Ba.int_callback(F,O,this.precb.zpp_inner);this.precb.zpp_inner.pre_swapped=C!=this.precb.zpp_inner.int1;var P=O.handlerp(this.precb);if(null!=P){var R=s,S=P,T;null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new gb,f.internal=!1);if(S==f.PreFlag_ACCEPT)T=f.id_ImmState_ACCEPT|f.id_ImmState_ALWAYS;else{var Y=P,X;null==f.PreFlag_ACCEPT_ONCE&&
(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new gb,f.internal=!1);if(Y==f.PreFlag_ACCEPT_ONCE)X=f.id_ImmState_ACCEPT;else{var ca=P;null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new gb,f.internal=!1);X=ca==f.PreFlag_IGNORE?f.id_ImmState_IGNORE|f.id_ImmState_ALWAYS:f.id_ImmState_IGNORE}T=X}R.immState=T}M=M.next}s.active=N;if(null!=F)for(var W=this.prelisteners.head;null!=W;)W.elt.itype==f.id_InteractionType_ANY&&(F.COLLISIONstate=s.immState,F.SENSORstate=s.immState),F.FLUIDstate=s.immState,W=W.next}else null==
F?0==(s.immState&f.id_ImmState_ALWAYS)&&(s.immState=f.id_ImmState_ACCEPT):s.immState=F.FLUIDstate}D=D.next}B=B.next}if(A&&0==(s.immState&f.id_ImmState_ALWAYS)){if(s.b1.type==f.id_BodyType_DYNAMIC){var V=s.b1;V.world||(V.component.waket=this.stamp+(this.midstep?0:1),V.type==f.id_BodyType_KINEMATIC&&(V.kinematicDelaySleep=!0),V.component.sleeping&&this.really_wake(V,!1))}if(s.b1.type==f.id_BodyType_DYNAMIC){var Z=s.b2;Z.world||(Z.component.waket=this.stamp+(this.midstep?0:1),Z.type==f.id_BodyType_KINEMATIC&&
(Z.kinematicDelaySleep=!0),Z.component.sleeping&&this.really_wake(Z,!1))}}}if(0!=(s.immState&f.id_ImmState_ACCEPT)){if(s.b1.type==f.id_BodyType_DYNAMIC&&s.b1.component.sleeping){var aa=s.b1;aa.world||(aa.component.waket=this.stamp+(this.midstep?0:1),aa.type==f.id_BodyType_KINEMATIC&&(aa.kinematicDelaySleep=!0),aa.component.sleeping&&this.really_wake(aa,!1))}if(s.b2.type==f.id_BodyType_DYNAMIC&&s.b2.component.sleeping){var ba=s.b2;ba.world||(ba.component.waket=this.stamp+(this.midstep?0:1),ba.type==
f.id_BodyType_KINEMATIC&&(ba.kinematicDelaySleep=!0),ba.component.sleeping&&this.really_wake(ba,!1))}}s.sleeping&&(s.sleeping=!1,this.f_arbiters.inlined_add(s));h=s}else if(w){var ea=s;ea.next=zb.zpp_pool;zb.zpp_pool=ea;h=null}else h=s;else h=s}else if(1==l){var da;da=c?this.c_arbiters_true:this.c_arbiters_false;var Q;if(null==d){for(var ga=null,fa=(j.arbiters.length<k.arbiters.length?j:k).arbiters.head;null!=fa;){var ia=fa.elt;if(ia.id==n.id&&ia.di==o.id){ga=ia;break}fa=fa.next}Q=ga}else Q=d;var ha=
null==Q,z,ka=!1;ha?(null==Jb.zpp_pool?z=new Jb:(z=Jb.zpp_pool,Jb.zpp_pool=z.next,z.next=null),null,z.stat=c):null==Q.colarb?(Q.cleared=!0,Q.b1.arbiters.inlined_try_remove(Q),Q.b2.arbiters.inlined_try_remove(Q),null!=Q.pair&&(Q.pair.arb=null,Q.pair=null),Q.active=!1,this.f_arbiters.modified=!0,null==Jb.zpp_pool?z=new Jb:(z=Jb.zpp_pool,Jb.zpp_pool=z.next,z.next=null),null,z.intchange=!0,z.stat=c,ka=ha=!0):(z=Q.colarb,p=n!=z.s1,z.stat!=c&&(z.stat=c,z.sleeping||((c?this.c_arbiters_false:this.c_arbiters_true).remove(z),
da.add(z))));var pa=f.id_InteractionType_COLLISION;if(ha||z.stamp!=this.stamp||e)if(z.stamp=this.stamp,H.contactCollide(n,o,z,p)){ha?(z.b1=a.body,z.ws1=a,z.b2=b.body,z.ws2=b,z.id=n.id,z.di=o.id,z.b1.arbiters.inlined_add(z),z.b2.arbiters.inlined_add(z),z.active=!0,z.present=0,z.cleared=!1,z.sleeping=!1,z.fresh=!1,z.presentable=!1,z.s1=a,z.s2=b,z.userdef_restitution||(z.restitution=-Infinity>=z.s1.material.elasticity||-Infinity>=z.s2.material.elasticity?0:Infinity<=z.s1.material.elasticity||Infinity<=
z.s2.material.elasticity?1:(z.s1.material.elasticity+z.s2.material.elasticity)/2,0>z.restitution&&(z.restitution=0),1<z.restitution&&(z.restitution=1)),z.userdef_dyn_fric||(z.dyn_fric=Math.sqrt(z.s1.material.dynamicFriction*z.s2.material.dynamicFriction)),z.userdef_stat_fric||(z.stat_fric=Math.sqrt(z.s1.material.staticFriction*z.s2.material.staticFriction)),z.userdef_rfric||(z.rfric=Math.sqrt(z.s1.material.rollingFriction*z.s2.material.rollingFriction)),da.inlined_add(z),z.fresh=!ka):z.fresh=z.up_stamp<
this.stamp-1||z.endGenerated==this.stamp&&e;z.up_stamp=z.stamp;if(z.fresh||0==(z.immState&f.id_ImmState_ALWAYS)){z.immState=f.id_ImmState_ACCEPT;var la=!1;this.inlined_MRCA_chains(z.ws1.id>z.ws2.id?z.ws2:z.ws1,z.ws1.id>z.ws2.id?z.ws1:z.ws2);for(var ja=this.mrca1.head;null!=ja;){for(var ma=ja.elt,na=this.mrca2.head;null!=na;){var ra=na.elt,qa=ma.cbSet,ua=ra.cbSet;if(!qa.manager.pair(qa,ua).empty_intersection()){var U=null,sa=null;this.prelisteners.inlined_clear();qa.manager.pair(qa,ua).forall(f.id_CbEvent_PRE,
function(a){return function(b){0!=(b.itype&pa)&&(a[0]=g.prelisteners.inlined_insert(a[0],b),la=la||!b.pure)}}([null]));if(null!=this.prelisteners.head)if(U=Ba.get(ma,ra),null==U&&(sa=Ha.get(ma,ra),this.add_callbackset(sa)),null==U||(U.COLLISIONstamp!=this.stamp||e)&&0==(U.COLLISIONstate&f.id_ImmState_ALWAYS)){null!=sa&&(U=sa);if(null!=U)for(var ta=this.prelisteners.head;null!=ta;)ta.elt.itype==f.id_InteractionType_ANY?(U.COLLISIONstamp=this.stamp,U.SENSORstamp=this.stamp,U.FLUIDstamp=this.stamp):
U.COLLISIONstamp=this.stamp,ta=ta.next;var Aa=z.active;z.active=!0;z.cleanupContacts();this.precb.zpp_inner.pre_arbiter=z;this.precb.zpp_inner.set=U;for(var wa=this.prelisteners.head;null!=wa;){var xa=wa.elt;this.precb.zpp_inner.listener=xa;Ba.int_callback(U,xa,this.precb.zpp_inner);this.precb.zpp_inner.pre_swapped=ma!=this.precb.zpp_inner.int1;var ya=xa.handlerp(this.precb);if(null!=ya){var Ja=z,La=ya,Ga;null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new gb,f.internal=!1);if(La==f.PreFlag_ACCEPT)Ga=
f.id_ImmState_ACCEPT|f.id_ImmState_ALWAYS;else{var Na=ya,Ka;null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new gb,f.internal=!1);if(Na==f.PreFlag_ACCEPT_ONCE)Ka=f.id_ImmState_ACCEPT;else{var Sa=ya;null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new gb,f.internal=!1);Ka=Sa==f.PreFlag_IGNORE?f.id_ImmState_IGNORE|f.id_ImmState_ALWAYS:f.id_ImmState_IGNORE}Ga=Ka}Ja.immState=Ga}wa=wa.next}z.active=Aa;if(null!=U)for(var Ia=this.prelisteners.head;null!=Ia;)Ia.elt.itype==f.id_InteractionType_ANY?
(U.COLLISIONstate=z.immState,U.SENSORstate=z.immState,U.FLUIDstate=z.immState):U.COLLISIONstate=z.immState,Ia=Ia.next}else null==U?0==(z.immState&f.id_ImmState_ALWAYS)&&(z.immState=f.id_ImmState_ACCEPT):z.immState=U.COLLISIONstate}na=na.next}ja=ja.next}if(la&&0==(z.immState&f.id_ImmState_ALWAYS)){if(z.b1.type==f.id_BodyType_DYNAMIC){var Ca=z.b1;Ca.world||(Ca.component.waket=this.stamp+(this.midstep?0:1),Ca.type==f.id_BodyType_KINEMATIC&&(Ca.kinematicDelaySleep=!0),Ca.component.sleeping&&this.really_wake(Ca,
!1))}if(z.b1.type==f.id_BodyType_DYNAMIC){var Da=z.b2;Da.world||(Da.component.waket=this.stamp+(this.midstep?0:1),Da.type==f.id_BodyType_KINEMATIC&&(Da.kinematicDelaySleep=!0),Da.component.sleeping&&this.really_wake(Da,!1))}}}if(0!=(z.immState&f.id_ImmState_ACCEPT)){if(z.b1.type==f.id_BodyType_DYNAMIC&&z.b1.component.sleeping){var Ea=z.b1;Ea.world||(Ea.component.waket=this.stamp+(this.midstep?0:1),Ea.type==f.id_BodyType_KINEMATIC&&(Ea.kinematicDelaySleep=!0),Ea.component.sleeping&&this.really_wake(Ea,
!1))}if(z.b2.type==f.id_BodyType_DYNAMIC&&z.b2.component.sleeping){var Fa=z.b2;Fa.world||(Fa.component.waket=this.stamp+(this.midstep?0:1),Fa.type==f.id_BodyType_KINEMATIC&&(Fa.kinematicDelaySleep=!0),Fa.component.sleeping&&this.really_wake(Fa,!1))}}z.sleeping&&(z.sleeping=!1,da.inlined_add(z));h=z}else if(ha){var za=z;za.userdef_dyn_fric=!1;za.userdef_stat_fric=!1;za.userdef_restitution=!1;za.userdef_rfric=!1;za.__ref_edge1=za.__ref_edge2=null;za.next=Jb.zpp_pool;Jb.zpp_pool=za;h=null}else h=z;else h=
z}else{var oa;if(null==d){for(var Ua=null,Oa=(j.arbiters.length<k.arbiters.length?j:k).arbiters.head;null!=Oa;){var Qa=Oa.elt;if(Qa.id==n.id&&Qa.di==o.id){Ua=Qa;break}Oa=Oa.next}oa=Ua}else oa=d;var Ma=null==oa,J,Za=!1;Ma?(null==Ib.zpp_pool?J=new Ib:(J=Ib.zpp_pool,Ib.zpp_pool=J.next,J.next=null),null):null==oa.sensorarb?(oa.cleared=!0,oa.b1.arbiters.inlined_try_remove(oa),oa.b2.arbiters.inlined_try_remove(oa),null!=oa.pair&&(oa.pair.arb=null,oa.pair=null),oa.active=!1,this.f_arbiters.modified=!0,null==
Ib.zpp_pool?J=new Ib:(J=Ib.zpp_pool,Ib.zpp_pool=J.next,J.next=null),null,Za=Ma=J.intchange=!0):J=oa.sensorarb;var db=f.id_InteractionType_SENSOR;if(Ma||J.stamp!=this.stamp||e)if(J.stamp=this.stamp,H.testCollide(n,o)){Ma?(J.b1=a.body,J.ws1=a,J.b2=b.body,J.ws2=b,J.id=n.id,J.di=o.id,J.b1.arbiters.inlined_add(J),J.b2.arbiters.inlined_add(J),J.active=!0,J.present=0,J.cleared=!1,J.sleeping=!1,J.fresh=!1,J.presentable=!1,this.s_arbiters.inlined_add(J),J.fresh=!Za):J.fresh=J.up_stamp<this.stamp-1||J.endGenerated==
this.stamp&&e;J.up_stamp=J.stamp;if(J.fresh||0==(J.immState&f.id_ImmState_ALWAYS)){J.immState=f.id_ImmState_ACCEPT;var Va=!1;this.inlined_MRCA_chains(J.ws1.id>J.ws2.id?J.ws2:J.ws1,J.ws1.id>J.ws2.id?J.ws1:J.ws2);for(var Pa=this.mrca1.head;null!=Pa;){for(var Ra=Pa.elt,Ta=this.mrca2.head;null!=Ta;){var bb=Ta.elt,Wa=Ra.cbSet,fb=bb.cbSet;if(!Wa.manager.pair(Wa,fb).empty_intersection()){var mb=null,Xa=null;this.prelisteners.inlined_clear();Wa.manager.pair(Wa,fb).forall(f.id_CbEvent_PRE,function(a){return function(b){0!=
(b.itype&db)&&(a[0]=g.prelisteners.inlined_insert(a[0],b),Va=Va||!b.pure)}}([null]));if(null!=this.prelisteners.head)if(mb=Ba.get(Ra,bb),null==mb&&(Xa=Ha.get(Ra,bb),this.add_callbackset(Xa)),null==mb||(mb.SENSORstamp!=this.stamp||e)&&0==(mb.SENSORstate&f.id_ImmState_ALWAYS)){null!=Xa&&(mb=Xa);if(null!=mb)for(var Ya=this.prelisteners.head;null!=Ya;)Ya.elt.itype==f.id_InteractionType_ANY?(mb.COLLISIONstamp=this.stamp,mb.SENSORstamp=this.stamp,mb.FLUIDstamp=this.stamp):mb.SENSORstamp=this.stamp,Ya=Ya.next;
var lb=J.active;J.active=!0;this.precb.zpp_inner.pre_arbiter=J;this.precb.zpp_inner.set=mb;for(var $a=this.prelisteners.head;null!=$a;){var eb=$a.elt;this.precb.zpp_inner.listener=eb;Ba.int_callback(mb,eb,this.precb.zpp_inner);this.precb.zpp_inner.pre_swapped=Ra!=this.precb.zpp_inner.int1;var cb=eb.handlerp(this.precb);if(null!=cb){var nb=J,ob=cb,hb;null==f.PreFlag_ACCEPT&&(f.internal=!0,f.PreFlag_ACCEPT=new gb,f.internal=!1);if(ob==f.PreFlag_ACCEPT)hb=f.id_ImmState_ACCEPT|f.id_ImmState_ALWAYS;else{var pb=
cb,kb;null==f.PreFlag_ACCEPT_ONCE&&(f.internal=!0,f.PreFlag_ACCEPT_ONCE=new gb,f.internal=!1);if(pb==f.PreFlag_ACCEPT_ONCE)kb=f.id_ImmState_ACCEPT;else{var qb=cb;null==f.PreFlag_IGNORE&&(f.internal=!0,f.PreFlag_IGNORE=new gb,f.internal=!1);kb=qb==f.PreFlag_IGNORE?f.id_ImmState_IGNORE|f.id_ImmState_ALWAYS:f.id_ImmState_IGNORE}hb=kb}nb.immState=hb}$a=$a.next}J.active=lb;if(null!=mb)for(var jb=this.prelisteners.head;null!=jb;)jb.elt.itype==f.id_InteractionType_ANY?(mb.COLLISIONstate=J.immState,mb.SENSORstate=
J.immState,mb.FLUIDstate=J.immState):mb.SENSORstate=J.immState,jb=jb.next}else null==mb?0==(J.immState&f.id_ImmState_ALWAYS)&&(J.immState=f.id_ImmState_ACCEPT):J.immState=mb.SENSORstate}Ta=Ta.next}Pa=Pa.next}if(Va&&0==(J.immState&f.id_ImmState_ALWAYS)){if(J.b1.type!=f.id_BodyType_STATIC){var ib=J.b1;ib.world||(ib.component.waket=this.stamp+(this.midstep?0:1),ib.type==f.id_BodyType_KINEMATIC&&(ib.kinematicDelaySleep=!0),ib.component.sleeping&&this.really_wake(ib,!1))}if(J.b2.type!=f.id_BodyType_STATIC){var ab=
J.b2;ab.world||(ab.component.waket=this.stamp+(this.midstep?0:1),ab.type==f.id_BodyType_KINEMATIC&&(ab.kinematicDelaySleep=!0),ab.component.sleeping&&this.really_wake(ab,!1))}}}J.sleeping&&(J.sleeping=!1,this.s_arbiters.inlined_add(J));h=J}else if(Ma){var rb=J;rb.next=Ib.zpp_pool;Ib.zpp_pool=rb;h=null}else h=J;else h=J}}return h},MRCA_chains:function(a,b){this.inlined_MRCA_chains(a,b)},inlined_MRCA_chains:function(a,b){this.mrca1.inlined_clear();this.mrca2.inlined_clear();null!=a.cbSet&&this.mrca1.inlined_add(a);
null!=a.body.cbSet&&this.mrca1.inlined_add(a.body);null!=b.cbSet&&this.mrca2.inlined_add(b);null!=b.body.cbSet&&this.mrca2.inlined_add(b.body);for(var c=a.body.compound,d=b.body.compound;c!=d;)(null==c?0:c.depth)<(null==d?0:d.depth)?(null!=d.cbSet&&this.mrca2.inlined_add(d),d=d.compound):(null!=c.cbSet&&this.mrca1.inlined_add(c),c=c.compound)},__class__:Ri};var Mc=function(){this.next=this.prev=this.shape=this.aabb=null};h["zpp_nape.space.ZPP_SweepData"]=Mc;Mc.__name__=!0;Mc.prototype={__class__:Mc};
var Mh=function(a){this.list=null;Ud.call(this);this.space=a;this.is_sweep=!0;this.sweep=this};h["zpp_nape.space.ZPP_SweepPhase"]=Mh;Mh.__name__=!0;Mh.__super__=Ud;Mh.prototype=v(Ud.prototype,{__insert:function(a){var b;null==Mc.zpp_pool?b=new Mc:(b=Mc.zpp_pool,Mc.zpp_pool=b.next,b.next=null);null;a.sweep=b;b.shape=a;b.aabb=a.aabb;b.next=this.list;null!=this.list&&(this.list.prev=b);this.list=b},__remove:function(a){var b=a.sweep;null==b.prev?this.list=b.next:b.prev.next=b.next;null!=b.next&&(b.next.prev=
b.prev);a.sweep=null;b.prev=null;b.shape=null;b.aabb=null;b.next=Mc.zpp_pool;Mc.zpp_pool=b},sync_broadphase_fast:function(){for(var a=this.list.next;null!=a;){var b=a.next,c=a.prev;if(!(a.aabb.minx>c.aabb.minx)){for(;null!=c.prev&&c.prev.aabb.minx>a.aabb.minx;)c=c.prev;var d=a.prev;d.next=a.next;null!=a.next&&(a.next.prev=d);null==c.prev?(a.prev=null,this.list=a,a.next=c,c.prev=a):(a.prev=c.prev,c.prev=a,a.prev.next=a,a.next=c)}a=b}},broadphase:function(a,b){if(null!=this.list){this.sync_broadphase_fast();
for(var c=this.list;null!=c;){for(var d=c.next,e=c.shape,g=e.body,h=c.aabb.maxx;null!=d&&!(d.aabb.minx>h);){var j=d.shape,k=j.body;if(k!=g&&!(g.type==f.id_BodyType_STATIC&&k.type==f.id_BodyType_STATIC)&&(!g.component.sleeping||!k.component.sleeping))e.aabb.intersectY(j.aabb)&&(b?a.narrowPhase(e,j,g.type!=f.id_BodyType_DYNAMIC||k.type!=f.id_BodyType_DYNAMIC,null,!1):a.continuousEvent(e,j,g.type!=f.id_BodyType_DYNAMIC||k.type!=f.id_BodyType_DYNAMIC,null,!1));d=d.next}c=c.next}}},__class__:Mh});var Fj=
function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_CallbackSet"]=Fj;Fj.__name__=!0;Fj.prototype={inlined_add:function(a){var b;null==Vd.zpp_pool?b=new Vd:(b=Vd.zpp_pool,Vd.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,
c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Vd.zpp_pool;Vd.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Fj};var Ke=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Shape"]=Ke;Ke.__name__=!0;Ke.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Lb.zpp_pool?b=new Lb:
(b=Lb.zpp_pool,Lb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==Lb.zpp_pool?c=new Lb:(c=Lb.zpp_pool,Lb.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=
null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Lb.zpp_pool;Lb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Ke};var Hd=function(){this.length=0;this.modified=
this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Body"]=Hd;Hd.__name__=!0;Hd.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Bb.zpp_pool?b=new Bb:(b=Bb.zpp_pool,Bb.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,b)},inlined_insert:function(a,b){var c;null==Bb.zpp_pool?c=new Bb:(c=Bb.zpp_pool,Bb.zpp_pool=c.next,c.next=null);null;c.elt=
b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=Bb.zpp_pool;Bb.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=
c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Bb.zpp_pool;Bb.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Hd};var Nh=function(){this.length=0;this.modified=this.pushmod=!1;this.head=
null};h["zpp_nape.util.ZNPList_ZPP_Compound"]=Nh;Nh.__name__=!0;Nh.prototype={remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Qh.zpp_pool;Qh.zpp_pool=a;this.modified=!0;this.length--;
this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Nh};var Df=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Arbiter"]=Df;Df.__name__=!0;Df.prototype={inlined_add:function(a){var b;null==wd.zpp_pool?b=new wd:(b=wd.zpp_pool,wd.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=
this.head;this.head=a.next;a.elt=null;a.next=wd.zpp_pool;wd.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.head,
this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=wd.zpp_pool;wd.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},inlined_has:function(a){var b;b=!1;for(var c=this.head;null!=c;){if(c.elt==a){b=!0;break}c=c.next}return b},__class__:Df};var Cj=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_CbSetPair"]=Cj;Cj.__name__=!0;Cj.prototype={add:function(a){return this.inlined_add(a)},
inlined_add:function(a){var b;null==dd.zpp_pool?b=new dd:(b=dd.zpp_pool,dd.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=dd.zpp_pool;dd.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();
return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=dd.zpp_pool;dd.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Cj};var Hj=function(){this.length=
0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_AABBPair"]=Hj;Hj.__name__=!0;Hj.prototype={inlined_add:function(a){var b;null==ed.zpp_pool?b=new ed:(b=ed.zpp_pool,ed.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=ed.zpp_pool;ed.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},
pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=
ed.zpp_pool;ed.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Hj};var Ij=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Edge"]=Ij;Ij.__name__=!0;Ij.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==ab.zpp_pool?b=new ab:(b=ab.zpp_pool,ab.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,
b)},inlined_insert:function(a,b){var c;null==ab.zpp_pool?c=new ab:(c=ab.zpp_pool,ab.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=ab.zpp_pool;ab.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},
inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},erase:function(a){return this.inlined_erase(a)},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=ab.zpp_pool;ab.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},reverse:function(){for(var a=this.head,b=null;null!=a;){var c=a.next;a.next=b;b=this.head=a;a=c}this.pushmod=this.modified=
!0},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Ij};var Jj=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Component"]=Jj;Jj.__name__=!0;Jj.prototype={inlined_add:function(a){var b;null==fd.zpp_pool?b=new fd:(b=fd.zpp_pool,fd.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;
this.head=a.next;a.elt=null;a.next=fd.zpp_pool;fd.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},__class__:Jj};var zk=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_InteractionGroup"]=zk;zk.__name__=!0;zk.prototype={iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},
__class__:zk};var Mj=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_FluidArbiter"]=Mj;Mj.__name__=!0;Mj.prototype={inlined_add:function(a){var b;null==Wd.zpp_pool?b=new Wd:(b=Wd.zpp_pool,Wd.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&
(this.pushmod=!0));a=b;a.elt=null;a.next=Wd.zpp_pool;Wd.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Mj};var Nj=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_SensorArbiter"]=Nj;Nj.__name__=!0;Nj.prototype={inlined_add:function(a){var b;null==Xd.zpp_pool?b=new Xd:(b=Xd.zpp_pool,Xd.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},inlined_erase:function(a){var b,
c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=Xd.zpp_pool;Xd.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Nj};var Oh=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_ColArbiter"]=Oh;Oh.__name__=!0;Oh.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==Yd.zpp_pool?b=new Yd:
(b=Yd.zpp_pool,Yd.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=
Yd.zpp_pool;Yd.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Oh};var Ph=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_Listener"]=Ph;Ph.__name__=!0;Ph.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;null==bc.zpp_pool?b=new bc:(b=bc.zpp_pool,bc.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},insert:function(a,b){return this.inlined_insert(a,
b)},inlined_insert:function(a,b){var c;null==bc.zpp_pool?c=new bc:(c=bc.zpp_pool,bc.zpp_pool=c.next,c.next=null);null;c.elt=b;null==a?(c.next=this.head,this.head=c):(c.next=a.next,a.next=c);this.pushmod=this.modified=!0;this.length++;return c},remove:function(a){this.inlined_try_remove(a)},inlined_try_remove:function(a){for(var b=null,c=this.head,d=!1;null!=c;){if(c.elt==a){this.inlined_erase(b);d=!0;break}b=c;c=c.next}return d},inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,
null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=bc.zpp_pool;bc.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Ph};var Lj=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_ToiEvent"]=Lj;Lj.__name__=!0;Lj.prototype={add:function(a){return this.inlined_add(a)},inlined_add:function(a){var b;
null==xd.zpp_pool?b=new xd:(b=xd.zpp_pool,xd.zpp_pool=b.next,b.next=null);null;b.elt=a;b.next=this.head;this.head=b;this.modified=!0;this.length++;return a},pop:function(){this.inlined_pop()},inlined_pop:function(){var a=this.head;this.head=a.next;a.elt=null;a.next=xd.zpp_pool;xd.zpp_pool=a;null==this.head&&(this.pushmod=!0);this.modified=!0;this.length--},pop_unsafe:function(){return this.inlined_pop_unsafe()},inlined_pop_unsafe:function(){var a=this.head.elt;this.pop();return a},erase:function(a){return this.inlined_erase(a)},
inlined_erase:function(a){var b,c;null==a?(b=this.head,this.head=c=b.next,null==this.head&&(this.pushmod=!0)):(b=a.next,c=b.next,a.next=c,null==c&&(this.pushmod=!0));a=b;a.elt=null;a.next=xd.zpp_pool;xd.zpp_pool=a;this.modified=!0;this.length--;this.pushmod=!0;return c},__class__:Lj};var Ak=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ConvexResult"]=Ak;Ak.__name__=!0;Ak.prototype={iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;
return b},__class__:Ak};var Bk=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_ZPP_GeomPoly"]=Bk;Bk.__name__=!0;Bk.prototype={iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Bk};var Ck=function(){this.length=0;this.modified=this.pushmod=!1;this.head=null};h["zpp_nape.util.ZNPList_RayResult"]=Ck;Ck.__name__=!0;Ck.prototype={iterator_at:function(a){for(var b=this.head;0<a--&&null!=b;)b=b.next;return b},__class__:Ck};
var yb=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_CbType"]=yb;yb.__name__=!0;yb.prototype={__class__:yb};var Vd=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_CallbackSet"]=Vd;Vd.__name__=!0;Vd.prototype={__class__:Vd};var Lb=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Shape"]=Lb;Lb.__name__=!0;Lb.prototype={__class__:Lb};var Bb=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Body"]=Bb;Bb.__name__=!0;Bb.prototype={__class__:Bb};
var Gc=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Constraint"]=Gc;Gc.__name__=!0;Gc.prototype={__class__:Gc};var Qh=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Compound"]=Qh;Qh.__name__=!0;Qh.prototype={__class__:Qh};var Gb=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_InteractionListener"]=Gb;Gb.__name__=!0;Gb.prototype={__class__:Gb};var Ic=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_CbSet"]=Ic;Ic.__name__=!0;Ic.prototype=
{__class__:Ic};var Hc=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Interactor"]=Hc;Hc.__name__=!0;Hc.prototype={__class__:Hc};var Ec=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_BodyListener"]=Ec;Ec.__name__=!0;Ec.prototype={__class__:Ec};var wd=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Arbiter"]=wd;wd.__name__=!0;wd.prototype={__class__:wd};var Fc=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_ConstraintListener"]=Fc;
Fc.__name__=!0;Fc.prototype={__class__:Fc};var dd=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_CbSetPair"]=dd;dd.__name__=!0;dd.prototype={__class__:dd};var ed=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_AABBPair"]=ed;ed.__name__=!0;ed.prototype={__class__:ed};var ab=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Edge"]=ab;ab.__name__=!0;ab.prototype={__class__:ab};var pb=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Vec2"]=
pb;pb.__name__=!0;pb.prototype={__class__:pb};var fd=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Component"]=fd;fd.__name__=!0;fd.prototype={__class__:fd};var Dk=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_InteractionGroup"]=Dk;Dk.__name__=!0;Dk.prototype={__class__:Dk};var Wd=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_FluidArbiter"]=Wd;Wd.__name__=!0;Wd.prototype={__class__:Wd};var Xd=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_SensorArbiter"]=
Xd;Xd.__name__=!0;Xd.prototype={__class__:Xd};var Yd=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_ColArbiter"]=Yd;Yd.__name__=!0;Yd.prototype={__class__:Yd};var bc=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_Listener"]=bc;bc.__name__=!0;bc.prototype={__class__:bc};var xd=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_ToiEvent"]=xd;xd.__name__=!0;xd.prototype={__class__:xd};var Ek=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ConvexResult"]=
Ek;Ek.__name__=!0;Ek.prototype={__class__:Ek};var Fk=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_ZPP_GeomPoly"]=Fk;Fk.__name__=!0;Fk.prototype={__class__:Fk};var Gk=function(){this.next=this.elt=null};h["zpp_nape.util.ZNPNode_RayResult"]=Gk;Gk.__name__=!0;Gk.prototype={__class__:Gk};var Le=function(){this.at_index=0;this.at_ite=null;this.zip_length=!1;this._length=0;this.inner=null;ee.call(this);this.at_ite=null;this.at_index=0;this.zip_length=!0;this._length=0};h["zpp_nape.util.ZPP_MixVec2List"]=
Le;Le.__name__=!0;Le.get=function(a,b){null==b&&(b=!1);var c=new Le;c.inner=a;c.zpp_inner.immutable=b;return c};Le.__super__=ee;Le.prototype=v(ee.prototype,{zpp_gl:function(){this.zpp_vm();if(this.zip_length){this._length=0;for(var a=this.inner.next;null!=a;)this._length++,a=a.next;this.zip_length=!1}return this._length},zpp_vm:function(){this.zpp_inner.validate();this.inner.modified&&(this.zip_length=!0,this._length=0,this.at_ite=null)},at:function(a){this.zpp_vm();this.zpp_inner.reverse_flag&&(a=
this.zpp_gl()-1-a);if(a<this.at_index||null==this.at_ite){this.at_index=0;for(this.at_ite=this.inner.next;;)break}for(;this.at_index!=a;){this.at_index++;for(this.at_ite=this.at_ite.next;;)break}return this.at_ite.wrapper()},push:function(a){this.zpp_inner.modify_test();this.zpp_vm();var b;if(b=null!=this.zpp_inner.adder?this.zpp_inner.adder(a):!0)this.zpp_inner.reverse_flag?this.inner.add(a.zpp_inner):this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),a.zpp_inner),this.zpp_inner.invalidate(),
null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(a);return b},__class__:Le});var kd=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this.adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new ad;this._invalidated=!0};h["zpp_nape.util.ZPP_ConstraintList"]=kd;kd.__name__=!0;kd.get=function(a,b){null==b&&(b=!1);var c=new Hi;c.zpp_inner.inner=
a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};kd.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:kd};var Zc=
function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new Hd;this._invalidated=!0};h["zpp_nape.util.ZPP_BodyList"]=Zc;Zc.__name__=!0;Zc.get=function(a,b){null==b&&(b=!1);var c=new Mi;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};Zc.prototype=
{valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:Zc};var gf=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=
0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_InteractorList"]=gf;gf.__name__=!0;gf.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:gf};var Qd=function(){this.user_length=0;this.zip_length=!1;
this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this.adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new Nh;this._invalidated=!0};h["zpp_nape.util.ZPP_CompoundList"]=Qd;Qd.__name__=!0;Qd.get=function(a,b){null==b&&(b=!1);var c=new Oi;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};Qd.prototype={valmod:function(){this.validate();this.inner.modified&&
(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:Qd};var Od=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=
this._validate=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new Ph;this._invalidated=!0};h["zpp_nape.util.ZPP_ListenerList"]=Od;Od.__name__=!0;Od.get=function(a,b){null==b&&(b=!1);var c=new Fi;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};Od.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,
this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:Od};var xc=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this.adder=this.post_adder=this.subber=null;this.immutable=
this._invalidated=!1;this.outer=this.inner=null;this.inner=new sd;this._invalidated=!0};h["zpp_nape.util.ZPP_CbTypeList"]=xc;xc.__name__=!0;xc.get=function(a,b){null==b&&(b=!1);var c=new gg;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};xc.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&
(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:xc};var qe=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._invalidate=this._validate=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new Cf;this._invalidated=!0};h["zpp_nape.util.ZPP_Vec2List"]=
qe;qe.__name__=!0;qe.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:qe};var bf=function(){this.user_length=0;this.zip_length=!1;this.at_ite=
this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_GeomPolyList"]=bf;bf.__name__=!0;bf.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:bf};var cf=function(){this.user_length=
0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_RayResultList"]=cf;cf.__name__=!0;cf.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:cf};
var af=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_ConvexResultList"]=af;af.__name__=!0;af.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=
this._validate&&this._validate())},__class__:af};var hf=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_EdgeList"]=hf;hf.__name__=!0;hf.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&
(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:hf};var Sd=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.dontremove=this.reverse_flag=!1;this._invalidate=this._validate=this.adder=this.post_adder=this.subber=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new Ke;this._invalidated=!0};h["zpp_nape.util.ZPP_ShapeList"]=Sd;Sd.__name__=!0;Sd.get=function(a,b){null==b&&(b=!1);var c=new Qi;c.zpp_inner.inner=
a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};Sd.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},modify_test:function(){},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},invalidate:function(){this._invalidated=!0;null!=this._invalidate&&this._invalidate(this)},__class__:Sd};var $e=
function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_InteractionGroupList"]=$e;$e.__name__=!0;$e.prototype={valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&
this._validate())},__class__:$e};var Pd=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this.immutable=this._invalidated=!1;this.outer=this.inner=null;this.inner=new Df;this._invalidated=!0};h["zpp_nape.util.ZPP_ArbiterList"]=Pd;Pd.__name__=!0;Pd.get=function(a,b){null==b&&(b=!1);var c=new Ii;c.zpp_inner.inner=a;b&&(c.zpp_inner.immutable=!0);c.zpp_inner.zip_length=!0;return c};Pd.prototype={valmod:function(){this.validate();
this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:Pd};var Ze=function(){this.user_length=0;this.zip_length=!1;this.at_ite=this.push_ite=null;this.at_index=0;this.reverse_flag=!1;this._validate=null;this._invalidated=!1;this.inner=null};h["zpp_nape.util.ZPP_ContactList"]=Ze;Ze.__name__=!0;Ze.prototype=
{valmod:function(){this.validate();this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},validate:function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},__class__:Ze};var Bf=function(){};h["zpp_nape.util.ZPP_Math"]=Bf;Bf.__name__=!0;Bf.sqr=function(a){return a*a};var df=function(){};h["zpp_nape.util.ZPP_PubPool"]=df;df.__name__=!0;var Fa=function(){this.colour=0;this.lt=
this.swapped=this.data=this.prev=this.next=this.parent=null};h["zpp_nape.util.ZPP_Set_ZPP_CbSetPair"]=Fa;Fa.__name__=!0;Fa.prototype={clear_with:function(a){if(null!=this.parent){for(var b=this.parent;null!=b;)b=null!=b.prev?b.prev:null!=b.next?b.next:this.clear_node(b,a);this.parent=null}},clear_node:function(a,b){b(a.data);var c=a.parent;null!=c&&(a==c.prev?c.prev=null:c.next=null,a.parent=null);a.data=null;a.lt=null;a.swapped=null;a.next=Fa.zpp_pool;Fa.zpp_pool=a;return c},__fix_dbl_red:function(a){for(;;){var b=
a.parent,c=b.parent;if(null==c){b.colour=1;break}var d,e,f,g,h,j,k;b==c.prev?(f=c,k=c.next,a==b.prev?(d=a,e=b,g=a.prev,h=a.next,j=b.next):(d=b,e=a,g=b.prev,h=a.prev,j=a.next)):(d=c,g=c.prev,a==b.prev?(e=a,f=b,h=a.prev,j=a.next,k=b.next):(e=b,f=a,h=b.prev,j=a.prev,k=a.next));a=c.parent;null==a?this.parent=e:a.prev==c?a.prev=e:a.next=e;null!=e&&(e.parent=a);d.prev=g;null!=g&&(g.parent=d);d.next=h;null!=h&&(h.parent=d);e.prev=d;null!=d&&(d.parent=e);e.next=f;null!=f&&(f.parent=e);f.prev=j;null!=j&&(j.parent=
f);f.next=k;null!=k&&(k.parent=f);e.colour=c.colour-1;d.colour=1;f.colour=1;if(e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){a=e;continue}break}},try_insert:function(a){var b=null,c=null;if(null==this.parent)null==Fa.zpp_pool?b=new Fa:(b=Fa.zpp_pool,Fa.zpp_pool=b.next,b.next=null),null,b.data=a,this.parent=b;else for(c=this.parent;;)if(this.lt(a,c.data))if(null==c.prev){null==Fa.zpp_pool?b=new Fa:(b=Fa.zpp_pool,Fa.zpp_pool=b.next,b.next=null);null;b.data=a;c.prev=b;
b.parent=c;break}else c=c.prev;else if(this.lt(c.data,a))if(null==c.next){null==Fa.zpp_pool?b=new Fa:(b=Fa.zpp_pool,Fa.zpp_pool=b.next,b.next=null);null;b.data=a;c.next=b;b.parent=c;break}else c=c.next;else break;if(null==b)return c;null==b.parent?b.colour=1:(b.colour=0,0==b.parent.colour&&this.__fix_dbl_red(b));return b},__class__:Fa};var ac=function(){this.colour=0;this.lt=this.swapped=this.data=this.prev=this.next=this.parent=null};h["zpp_nape.util.ZPP_Set_ZPP_CbSet"]=ac;ac.__name__=!0;ac.prototype=
{empty:function(){return null==this.parent},find:function(a){for(var b=this.parent;null!=b&&b.data!=a;)b=this.lt(a,b.data)?b.prev:b.next;return b},find_weak:function(a){for(var b=this.parent;null!=b;)if(this.lt(a,b.data))b=b.prev;else if(this.lt(b.data,a))b=b.next;else break;return b},remove:function(a){this.remove_node(this.find(a))},remove_node:function(a){if(null!=a.next&&null!=a.prev){for(var b=a.next;null!=b.prev;)b=b.prev;var c=a.data;a.data=b.data;b.data=c;null!=this.swapped&&this.swapped(a.data,
b.data);a=b}b=null==a.prev?a.next:a.prev;if(1==a.colour)if(null!=a.prev||null!=a.next)b.colour=1;else if(null!=a.parent)for(c=a.parent;;){c.colour++;c.prev.colour--;c.next.colour--;var d=c.prev;if(-1==d.colour){this.__fix_neg_red(d);break}else if(0==d.colour){if(null!=d.prev&&0==d.prev.colour){this.__fix_dbl_red(d.prev);break}if(null!=d.next&&0==d.next.colour){this.__fix_dbl_red(d.next);break}}d=c.next;if(-1==d.colour){this.__fix_neg_red(d);break}else if(0==d.colour){if(null!=d.prev&&0==d.prev.colour){this.__fix_dbl_red(d.prev);
break}if(null!=d.next&&0==d.next.colour){this.__fix_dbl_red(d.next);break}}if(2==c.colour)if(null==c.parent)c.colour=1;else{c=c.parent;continue}break}c=a.parent;null==c?this.parent=b:c.prev==a?c.prev=b:c.next=b;null!=b&&(b.parent=c);a.parent=a.prev=a.next=null;a.data=null;a.lt=null;a.swapped=null;a.next=ac.zpp_pool;ac.zpp_pool=a},__fix_neg_red:function(a){var b=a.parent;if(b.prev==a){var c=a.prev,d=a.next,e=d.prev,f=d.next;c.colour=0;a.colour=b.colour=1;a.next=e;null!=e&&(e.parent=a);a=b.data;b.data=
d.data;d.data=a;null!=this.swapped&&this.swapped(b.data,d.data);d.prev=f;null!=f&&(f.parent=d);d.next=b.next;null!=b.next&&(b.next.parent=d);b.next=d}else c=a.next,d=a.prev,e=d.next,f=d.prev,c.colour=0,a.colour=b.colour=1,a.prev=e,null!=e&&(e.parent=a),a=b.data,b.data=d.data,d.data=a,null!=this.swapped&&this.swapped(b.data,d.data),d.next=f,null!=f&&(f.parent=d),d.prev=b.prev,null!=b.prev&&(b.prev.parent=d),b.prev=d;null!=d&&(d.parent=b);b=c;null!=b.prev&&0==b.prev.colour?this.__fix_dbl_red(b.prev):
null!=b.next&&0==b.next.colour&&this.__fix_dbl_red(b.next)},__fix_dbl_red:function(a){for(;;){var b=a.parent,c=b.parent;if(null==c){b.colour=1;break}var d,e,f,g,h,j,k;b==c.prev?(f=c,k=c.next,a==b.prev?(d=a,e=b,g=a.prev,h=a.next,j=b.next):(d=b,e=a,g=b.prev,h=a.prev,j=a.next)):(d=c,g=c.prev,a==b.prev?(e=a,f=b,h=a.prev,j=a.next,k=b.next):(e=b,f=a,h=b.prev,j=a.prev,k=a.next));a=c.parent;null==a?this.parent=e:a.prev==c?a.prev=e:a.next=e;null!=e&&(e.parent=a);d.prev=g;null!=g&&(g.parent=d);d.next=h;null!=
h&&(h.parent=d);e.prev=d;null!=d&&(d.parent=e);e.next=f;null!=f&&(f.parent=e);f.prev=j;null!=j&&(j.parent=f);f.next=k;null!=k&&(k.parent=f);e.colour=c.colour-1;d.colour=1;f.colour=1;if(e==this.parent)this.parent.colour=1;else if(0==e.colour&&0==e.parent.colour){a=e;continue}break}},insert:function(a){var b;null==ac.zpp_pool?b=new ac:(b=ac.zpp_pool,ac.zpp_pool=b.next,b.next=null);null;b.data=a;if(null==this.parent)this.parent=b;else for(a=this.parent;;)if(this.lt(b.data,a.data))if(null==a.prev){a.prev=
b;b.parent=a;break}else a=a.prev;else if(null==a.next){a.next=b;b.parent=a;break}else a=a.next;null==b.parent?b.colour=1:(b.colour=0,0==b.parent.colour&&this.__fix_dbl_red(b));return b},__class__:ac};var Qk=0;h.Math=Math;String.prototype.__class__=h.String=String;String.__name__=!0;h.Array=Array;Array.__name__=!0;Date.prototype.__class__=h.Date=Date;Date.__name__=["Date"];var Rk=h.Int={__name__:["Int"]},Sk=h.Dynamic={__name__:["Dynamic"]},Lk=h.Float=Number;Lk.__name__=["Float"];var Mk=h.Bool=Boolean;
Mk.__ename__=["Bool"];var Tk=h.Class={__name__:["Class"]},Uk={},qb={},Xj=Function("return typeof ArrayBuffer != 'undefined' ? ArrayBuffer : null")()||id;null==Xj.prototype.slice&&(Xj.prototype.slice=id.sliceImpl);Function("return typeof DataView != 'undefined' ? DataView : null")();var vi=Function("return typeof Uint8Array != 'undefined' ? Uint8Array : null")()||Ld._new;o.Element=0;o.PCData=1;o.CData=2;o.Comment=3;o.DocType=4;o.ProcessingInstruction=5;o.Document=6;rc.instance=new rc;Pa.DISPATCHING_SENTINEL=
new ne(null,null);Y.root=new Va;Y.uncaughtError=new fa;Y.hidden=new xa(!1);Y.volume=new Ka(1);Y._platform=rc.instance;Y._calledInit=!1;Aa.logger=new Lf(Y._platform.createLogHandler("flambe"));dc.__meta__={obj:{assets:[{"dummy.txt":[]}]}};dc._supportsCrossOrigin=function(){var a;a=0<=window.navigator.userAgent.indexOf("Linux; U; Android")?!1:null!=(new XMLHttpRequest).withCredentials;a||Aa.logger.warn("This browser does not support cross-domain asset loading, any Manifest.remoteBase setting will be ignored.",
null);return a}();M._scratchPoint=new ec;Pc._sharedEvent=new ai;Cb._sharedEvent=new bi;rb._sharedEvent=new ci;Jd.CANVAS_TEXTURES=(new cc("(iPhone|iPod|iPad)","")).match(window.navigator.userAgent);ka._mediaRefCount=0;ka._detectBlobSupport=!0;F.VENDOR_PREFIXES=["webkit","moz","ms","o","khtml"];F.SHOULD_HIDE_MOBILE_BROWSER=window.top==window&&(new cc("Mobile(/.*)? Safari","")).match(window.navigator.userAgent);O._detectSupport=!0;uc._scratchMatrix=new Wa;Qa.count=0;Sc.i64tmp=new ri(0,0);I.blanks=new cc("^[ \r\n\t]*$",
"");Nc.escapes=function(){var a=new D;null!=qb.lt?a.setReserved("lt","<"):a.h.lt="<";null!=qb.gt?a.setReserved("gt",">"):a.h.gt=">";null!=qb.amp?a.setReserved("amp","&"):a.h.amp="&";null!=qb.quot?a.setReserved("quot",'"'):a.h.quot='"';null!=qb.apos?a.setReserved("apos","'"):a.h.apos="'";return a}(this);A.__toStr={}.toString;Ld.BYTES_PER_ELEMENT=1;t.epsilon=1.0E-8;t.fluidAngularDragFriction=2.5;t.fluidAngularDrag=100;t.fluidVacuumDrag=0.5;t.fluidLinearDrag=0.5;t.collisionSlop=0.2;t.collisionSlopCCD=
0.5;t.distanceThresholdCCD=0.05;t.staticCCDLinearThreshold=0.05;t.staticCCDAngularThreshold=0.005;t.bulletCCDLinearThreshold=0.125;t.bulletCCDAngularThreshold=0.0125;t.dynamicSweepLinearThreshold=17;t.dynamicSweepAngularThreshold=0.6;t.angularCCDSlipScale=0.75;t.arbiterExpirationDelay=6;t.staticFrictionThreshold=2;t.elasticThreshold=20;t.sleepDelay=60;t.linearSleepThreshold=0.2;t.angularSleepThreshold=0.4;t.contactBiasCoef=0.3;t.contactStaticBiasCoef=0.6;t.contactContinuousBiasCoef=0.4;t.contactContinuousStaticBiasCoef=
0.5;t.illConditionedThreshold=2E8;w.logger=new Lf(Y._platform.createLogHandler("tools.spark.framework"));qa.ANY_SHAPE=new Md;qa.ANY_BODY=new Md;qa.ANY_COMPOUND=new Md;qa.ANY_CONSTRAINT=new Md;wb._Interactor=0;wb._CbType=0;wb._CbSet=0;wb._Listener=0;Ub.BIPED_FEET=new Md;N.blanks=new cc("^[ \r\n\t]*$","");f.internal=!1;f.id_ImmState_ACCEPT=1;f.id_ImmState_IGNORE=2;f.id_ImmState_ALWAYS=4;f.id_GravMassMode_DEFAULT=0;f.id_GravMassMode_FIXED=1;f.id_GravMassMode_SCALED=2;f.id_InertiaMode_DEFAULT=0;f.id_MassMode_DEFAULT=
0;f.id_BodyType_STATIC=1;f.id_BodyType_DYNAMIC=2;f.id_BodyType_KINEMATIC=3;f.id_ListenerType_BODY=0;f.id_ListenerType_CONSTRAINT=1;f.id_PreFlag_ACCEPT=1;f.id_ListenerType_INTERACTION=2;f.id_ListenerType_PRE=3;f.id_CbEvent_BEGIN=0;f.id_CbEvent_ONGOING=6;f.id_InteractionType_COLLISION=1;f.id_CbEvent_END=1;f.id_InteractionType_SENSOR=2;f.id_CbEvent_WAKE=2;f.id_InteractionType_FLUID=4;f.id_CbEvent_SLEEP=3;f.id_InteractionType_ANY=7;f.id_CbEvent_BREAK=4;f.id_CbEvent_PRE=5;f.id_ShapeType_CIRCLE=0;f.id_ShapeType_POLYGON=
1;cb.UCbSet=new Ce;cb.VCbSet=new Ce;cb.WCbSet=new Ce;cb.UCbType=new sd;cb.VCbType=new sd;cb.WCbType=new sd;Z.internal=!1;Z.COL=1;Z.FLUID=4;Z.SENSOR=2;Ab.internal=!1;H.flowpoly=new Cf;H.flowsegs=new Cf;var Ok;null==f.BodyType_STATIC&&(f.internal=!0,f.BodyType_STATIC=new Ia,f.internal=!1);Ok=f.BodyType_STATIC;var Pk;null==f.BodyType_DYNAMIC&&(f.internal=!0,f.BodyType_DYNAMIC=new Ia,f.internal=!1);Pk=f.BodyType_DYNAMIC;null==f.BodyType_KINEMATIC&&(f.internal=!0,f.BodyType_KINEMATIC=new Ia,f.internal=
!1);Yc.types=[null,Ok,Pk,f.BodyType_KINEMATIC];da.WAKE=1;da.PROPS=2;da.ANGDRAG=4;da.ARBITERS=8;wa.internal=!1;Lc.tmpaabb=new za;kd.internal=!1;Zc.internal=!1;gf.internal=!1;Qd.internal=!1;Od.internal=!1;xc.internal=!1;qe.internal=!1;bf.internal=!1;cf.internal=!1;af.internal=!1;hf.internal=!1;Sd.internal=!1;$e.internal=!1;Pd.internal=!1;Ze.internal=!1;jc.main()})();
