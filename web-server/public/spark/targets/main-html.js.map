{
"version":3,
"file":"main-html.js",
"sourceRoot":"file://",
"sources":["C:/HaxeToolkit/haxe/std/js/_std/EReg.hx","C:/HaxeToolkit/haxe/std/js/_std/HxOverrides.hx","C:/HaxeToolkit/haxe/std/IntIterator.hx","C:/HaxeToolkit/haxe/std/Lambda.hx","C:/HaxeToolkit/haxe/std/List.hx","C:/HaxeToolkit/haxe/std/js/_std/Reflect.hx","C:/HaxeToolkit/haxe/std/js/_std/Std.hx","C:/HaxeToolkit/haxe/std/StringBuf.hx","C:/HaxeToolkit/haxe/std/StringTools.hx","C:/HaxeToolkit/haxe/std/js/_std/Type.hx","C:/HaxeToolkit/haxe/std/js/_std/Xml.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/Component.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/Entity.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/HtmlPlatform.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/Value.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/SignalConnection.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/SignalBase.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/Signal2.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/Signal1.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/animation/AnimatedFloat.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/System.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/Logger.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/PackageLog.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/SpeedAdjuster.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/ComponentBuilder.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/asset/AssetEntry.hx","C:/HaxeToolkit/haxe/std/js/Browser.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/asset/Manifest.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/math/Point.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/display/Sprite.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/display/FillSprite.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/display/ImageSprite.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/input/KeyboardEvent.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/input/MouseEvent.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/input/PointerEvent.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/input/TouchPoint.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/math/FMath.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/math/Matrix.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/math/Rectangle.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/BasicAsset.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/BasicAssetPackLoader.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/BasicFile.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/BasicKeyboard.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/BasicMouse.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/BasicPointer.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/BasicTexture.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/BasicTouch.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/CatapultClient.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/DebugLogic.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/DummySound.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/DummyTouch.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/EventGroup.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/KeyCodes.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/MainLoop.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/MathUtil.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/MouseCodes.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/OverdrawGraphics.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/CanvasGraphics.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/CanvasRenderer.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/CanvasTexture.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/CanvasTextureRoot.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/HtmlAssetPackLoader.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/HtmlCatapultClient.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/HtmlExternal.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/HtmlLogHandler.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/HtmlMouse.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/HtmlSound.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/HtmlStage.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/HtmlUtil.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/WebAudioSound.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/WebGLBatcher.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/WebGLGraphics.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/WebGLRenderer.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/WebGLTexture.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/html/WebGLTextureRoot.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/shader/ShaderGL.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/shader/DrawPatternGL.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/shader/DrawTextureGL.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/shader/FillRectGL.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/scene/Director.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/scene/Transition.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/Arrays.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/Assert.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/BitSets.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/Pool.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/Promise.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/Signal0.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/util/Strings.hx","C:/HaxeToolkit/haxe/std/haxe/Log.hx","C:/HaxeToolkit/haxe/std/haxe/crypto/Crc32.hx","C:/HaxeToolkit/haxe/std/haxe/ds/BalancedTree.hx","C:/HaxeToolkit/haxe/std/haxe/ds/EnumValueMap.hx","C:/HaxeToolkit/haxe/std/haxe/ds/GenericStack.hx","C:/HaxeToolkit/haxe/std/js/_std/haxe/ds/IntMap.hx","C:/HaxeToolkit/haxe/std/js/_std/haxe/ds/ObjectMap.hx","C:/HaxeToolkit/haxe/std/js/_std/haxe/ds/StringMap.hx","C:/HaxeToolkit/haxe/std/haxe/io/Bytes.hx","C:/HaxeToolkit/haxe/std/haxe/io/BytesBuffer.hx","C:/HaxeToolkit/haxe/std/haxe/io/Input.hx","C:/HaxeToolkit/haxe/std/haxe/io/BytesInput.hx","C:/HaxeToolkit/haxe/std/haxe/io/BytesOutput.hx","C:/HaxeToolkit/haxe/std/haxe/io/Eof.hx","C:/HaxeToolkit/haxe/std/haxe/io/StringInput.hx","C:/HaxeToolkit/haxe/std/haxe/xml/Check.hx","C:/HaxeToolkit/haxe/std/haxe/xml/Fast.hx","C:/HaxeToolkit/haxe/std/haxe/xml/Parser.hx","C:/HaxeToolkit/haxe/lib/hscript/2,0,4/hscript/Interp.hx","C:/HaxeToolkit/haxe/lib/hscript/2,0,4/hscript/Parser.hx","C:/HaxeToolkit/haxe/std/js/Boot.hx","C:/HaxeToolkit/haxe/std/js/html/CanvasElement.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/TimelineKey.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/SpatialTimelineKey.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/BoneTimelineKey.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/CharacterMap.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/MainlineKey.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/MapInstruction.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/ObjectTimelineKey.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/PivotInfo.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/Quadrilateral.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/Ref.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/ScmlObject.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/SpatialInfo.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/SpriteTimelineKey.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/SpriterAnimation.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/SpriterBox.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/SpriterEntity.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/SpriterFile.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/SpriterFolder.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/SpriterTimeline.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/TaglineKey.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/Varline.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/definitions/VarlineKey.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/engine/Spriter.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/flambe/SpriterMovie.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/library/AbstractLibrary.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/library/FlambeLibrary.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/util/SpriterUtil.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/vars/Variable.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/vars/VariableFloat.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/vars/VariableInt.hx","C:/HaxeToolkit/haxe/lib/SpriterHaxeEngine-flambe/spriter/vars/VariableString.hx","C:/Users/Aris/SparkRep/src/tools/spark/Main.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/Assets.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/Console.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/Framework.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/ModuleManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/Project.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/RootComponent.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/assets/Asset.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/assets/FlambeLoader.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/assets/Module.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/config/Config.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/config/ConfigInstantiator.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/config/ConfigValidator.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/space2_5D/core/ABase2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/space2_5D/core/AObject2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/space2_5D/core/ACamera2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/dom2_5D/DomCamera2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/space2_5D/core/AObjectContainer2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/space2_5D/core/AInstantiable2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/space2_5D/core/AEntity2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/dom2_5D/DomEntity2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/space2_5D/core/AScene2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/dom2_5D/DomScene2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/space2_5D/core/AView2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/dom2_5D/DomView2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/flambe2_5D/FlambeCamera2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/flambe2_5D/FlambeEntity2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/flambe2_5D/FlambeScene2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/flambe2_5D/FlambeView2_5D.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/haxe/LooseCheck.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/layout/containers/Group.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/layout/helpers/ChildInfo.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/layout/helpers/LayoutHelper.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/layout/helpers/SizesAndLimit.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/layout/layouts/ALayoutBase.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/layout/layouts/BasicLayout.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/layout/layouts/HorizontalLayout.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/layout/layouts/VerticalLayout.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/layout/managers/LayoutManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/platform/html/Graphics.hx","C:/Users/Aris/SparkRep/src/tools/spark/framework/platform/html/flambe2_5/Subgraphics.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/core/AService.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/core/ServiceFactory.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/core/Sliced.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/comms/core/Comms.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/comms/filetransfer/core/platform/html5/websocket/binaryjs/FileTransfer.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/comms/sockets/core/pomelo/platform/html5/websocket/Socket.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/active_displayentity_references/core/ActiveSpaceReference.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/active_displayentity_references/core/ActiveStageAreaReference.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/active_displayentity_references/core/ActiveStageReference.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/active_displayentity_references/core/ActiveViewReference.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/core/Display.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/databuffer/core/BufferEntry.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/databuffer/core/DataBuffer.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/ActiveReferenceMediator.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/DomCameraManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/DomObjectManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/DomSceneManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/DomViewManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/Flambe2_5DCameraManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/Flambe2_5DObjectManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/Flambe2_5DSceneManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/Flambe2_5DViewManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/SpaceReferenceManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/StageAreaReferenceManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/StageReferenceManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/managers/core/ViewReferenceManager.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/renderers/core/ARenderer.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/renderers/core/dimension/A2_5DRenderer.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/renderers/core/library/AFlambe2_5DRenderer.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/renderers/core/library/ANativeControls2_5DRenderer.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/renderers/core/platform/html/Flambe2_5DHtmlRenderer.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/display/renderers/core/platform/html/NativeControlsHtmlRenderer.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/event/core/Event.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/input/core/Input.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/input/devices/core/KeyboardDevice.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/input/devices/core/PointerDevice.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/core/Logic.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/gde/core/AGameBase.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/gde/core/GameAction.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/gde/core/GameClassInstantiator.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/gde/core/GameClassParser.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/gde/core/GameClassValidator.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/gde/core/GameEntity.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/gde/core/GameFactory.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/gde/core/GameForm.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/gde/core/GameSpace.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/gde/core/GameState.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/gde/core/GameTrigger.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/interpreter/core/GmlInterpreter.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/logic/interpreter/core/HaxeInterpreter.hx","C:/Users/Aris/SparkRep/src/tools/spark/sliced/services/std/sound/core/Sound.hx","C:/HaxeToolkit/haxe/std/Math.hx","C:/HaxeToolkit/haxe/lib/flambe/4,1,0/flambe/platform/ManifestBuilder.hx"],
"sourcesContent":["/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:coreApi class EReg {\n\n\tvar r : Dynamic;\n\n\tpublic function new( r : String, opt : String ) : Void {\n\t\topt = opt.split(\"u\").join(\"\"); // 'u' (utf8) depends on page encoding\n\t\tthis.r = untyped __new__(\"RegExp\",r,opt);\n\t}\n\n\tpublic function match( s : String ) : Bool {\n\t\tif( r.global ) r.lastIndex = 0;\n\t\tr.m = r.exec(s);\n\t\tr.s = s;\n\t\treturn (r.m != null);\n\t}\n\n\tpublic function matched( n : Int ) : String {\n\t\treturn if( r.m != null && n >= 0 && n < r.m.length ) r.m[n] else throw \"EReg::matched\";\n\t}\n\n\tpublic function matchedLeft() : String {\n\t\tif( r.m == null ) throw \"No string matched\";\n\t\treturn r.s.substr(0,r.m.index);\n\t}\n\n\tpublic function matchedRight() : String {\n\t\tif( r.m == null ) throw \"No string matched\";\n\t\tvar sz = r.m.index+r.m[0].length;\n\t\treturn r.s.substr(sz,r.s.length-sz);\n\t}\n\n\tpublic function matchedPos() : { pos : Int, len : Int } {\n\t\tif( r.m == null ) throw \"No string matched\";\n\t\treturn { pos : r.m.index, len : r.m[0].length };\n\t}\n\n\tpublic function matchSub( s : String, pos : Int, len : Int = -1):Bool {\n\t\treturn if (r.global) {\n\t\t\tr.lastIndex = pos;\n\t\t\tr.m = r.exec(len < 0 ? s : s.substr(0, pos + len));\n\t\t\tvar b = r.m != null;\n\t\t\tif (b) {\n\t\t\t\tr.s = s;\n\t\t\t}\n\t\t\tb;\n\t\t} else {\n\t\t\t// TODO: check some ^/$ related corner cases\n\t\t\tvar b = match( len < 0 ? s.substr(pos) : s.substr(pos,len) );\n\t\t\tif (b) {\n\t\t\t\tr.s = s;\n\t\t\t\tr.m.index += pos;\n\t\t\t}\n\t\t\tb;\n\t\t}\n\t}\n\n\tpublic function split( s : String ) : Array<String> {\n\t\t// we can't use directly s.split because it's ignoring the 'g' flag\n\t\tvar d = \"#__delim__#\";\n\t\treturn untyped s.replace(r,d).split(d);\n\t}\n\n\tpublic function replace( s : String, by : String ) : String {\n\t\treturn untyped s.replace(r,by);\n\t}\n\n\tpublic function map( s : String, f : EReg -> String ) : String {\n\t\tvar offset = 0;\n\t\tvar buf = new StringBuf();\n\t\tdo {\n\t\t\tif (offset >= s.length)\n\t\t\t\tbreak;\n\t\t\telse if (!matchSub(s, offset)) {\n\t\t\t\tbuf.add(s.substr(offset));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvar p = matchedPos();\n\t\t\tbuf.add(s.substr(offset, p.pos - offset));\n\t\t\tbuf.add(f(this));\n\t\t\tif (p.len == 0) {\n\t\t\t\tbuf.add(s.substr(p.pos, 1));\n\t\t\t\toffset = p.pos + 1;\n\t\t\t}\n\t\t\telse\n\t\t\t\toffset = p.pos + p.len;\n\t\t} while (r.global);\n\t\tif (!r.global && offset > 0 && offset < s.length)\n\t\t\tbuf.add(s.substr(offset));\n\t\treturn buf.toString();\n\t}\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:noDoc\nclass HxOverrides {\n\n\tstatic function dateStr( date :Date ) : String {\n\t\tvar m = date.getMonth() + 1;\n\t\tvar d = date.getDate();\n\t\tvar h = date.getHours();\n\t\tvar mi = date.getMinutes();\n\t\tvar s = date.getSeconds();\n\t\treturn date.getFullYear()\n\t\t\t+\"-\"+(if( m < 10 ) \"0\"+m else \"\"+m)\n\t\t\t+\"-\"+(if( d < 10 ) \"0\"+d else \"\"+d)\n\t\t\t+\" \"+(if( h < 10 ) \"0\"+h else \"\"+h)\n\t\t\t+\":\"+(if( mi < 10 ) \"0\"+mi else \"\"+mi)\n\t\t\t+\":\"+(if( s < 10 ) \"0\"+s else \"\"+s);\n\t}\n\n\tstatic function strDate( s : String ) : Date {\n\t\tswitch( s.length ) {\n\t\tcase 8: // hh:mm:ss\n\t\t\tvar k = s.split(\":\");\n\t\t\tvar d : Date = untyped __new__(Date);\n\t\t\tuntyped d[\"setTime\"](0);\n\t\t\tuntyped d[\"setUTCHours\"](k[0]);\n\t\t\tuntyped d[\"setUTCMinutes\"](k[1]);\n\t\t\tuntyped d[\"setUTCSeconds\"](k[2]);\n\t\t\treturn d;\n\t\tcase 10: // YYYY-MM-DD\n\t\t\tvar k = s.split(\"-\");\n\t\t\treturn new Date(cast k[0],cast untyped k[1] - 1,cast k[2],0,0,0);\n\t\tcase 19: // YYYY-MM-DD hh:mm:ss\n\t\t\tvar k = s.split(\" \");\n\t\t\tvar y = k[0].split(\"-\");\n\t\t\tvar t = k[1].split(\":\");\n\t\t\treturn new Date(cast y[0],cast untyped y[1] - 1,cast y[2],cast t[0],cast t[1],cast t[2]);\n\t\tdefault:\n\t\t\tthrow \"Invalid date format : \" + s;\n\t\t}\n\t}\n\n\tstatic function cca( s : String, index : Int ) : Null<Int> {\n\t\t#if mt\n\t\tvar x = (cast s).cca(index);\n\t\t#else\n\t\tvar x = (cast s).charCodeAt(index);\n\t\t#end\n\t\tif( x != x ) // fast isNaN\n\t\t\treturn untyped undefined; // isNaN will still return true\n\t\treturn x;\n\t}\n\n\tstatic function substr( s : String, pos : Int, ?len : Int ) : String {\n\t\tif( pos != null && pos != 0 && len != null && len < 0 ) return \"\";\n\t\tif( len == null ) len = s.length;\n\t\tif( pos < 0 ){\n\t\t\tpos = s.length + pos;\n\t\t\tif( pos < 0 ) pos = 0;\n\t\t}else if( len < 0 ){\n\t\t\tlen = s.length + len - pos;\n\t\t}\n\n\t\treturn (untyped s).substr(pos, len);\n\t}\n\n\tstatic function indexOf<T>( a : Array<T>, obj : T, i : Int) {\n\t\tvar len = a.length;\n\t\tif (i < 0) {\n\t\t\ti += len;\n\t\t\tif (i < 0) i = 0;\n\t\t}\n\t\twhile (i < len)\n\t\t{\n\t\t\tif (untyped __js__(\"a[i] === obj\"))\n\t\t\t\treturn i;\n\t\t\ti++;\n\t\t}\n\t\treturn -1;\n\t}\n\n\tstatic function lastIndexOf<T>( a : Array<T>, obj : T, i : Int) {\n\t\tvar len = a.length;\n\t\tif (i >= len)\n\t\t\ti = len - 1;\n\t\telse if (i < 0)\n\t\t\ti += len;\n\t\twhile (i >= 0)\n\t\t{\n\t\t\tif (untyped __js__(\"a[i] === obj\"))\n\t\t\t\treturn i;\n\t\t\ti--;\n\t\t}\n\t\treturn -1;\n\t}\n\n\tstatic function remove<T>( a : Array<T>, obj : T ) {\n\t\tvar i = a.indexOf(obj);\n\t\tif( i == -1 ) return false;\n\t\ta.splice(i,1);\n\t\treturn true;\n\t}\n\n\tstatic function iter<T>( a : Array<T> ) : Iterator<T> untyped {\n\t\treturn {\n\t\t\tcur : 0,\n\t\t\tarr : a,\n\t\t\thasNext : function() {\n\t\t\t\treturn __this__.cur < __this__.arr.length;\n\t\t\t},\n\t\t\tnext : function() {\n\t\t\t\treturn __this__.arr[__this__.cur++];\n\t\t\t}\n\t\t};\n\t}\n\n\tstatic function __init__() untyped {\n#if !js_es5\n\t\t__feature__('HxOverrides.indexOf', if( Array.prototype.indexOf ) __js__(\"HxOverrides\").indexOf = function(a,o,i) return Array.prototype.indexOf.call(a, o, i));\n\t\t__feature__('HxOverrides.lastIndexOf', if( Array.prototype.lastIndexOf ) __js__(\"HxOverrides\").lastIndexOf = function(a,o,i) return Array.prototype.lastIndexOf.call(a, o, i));\n#end\n\n#if mt\n\t\tif( String.prototype.cca == null ) String.prototype.cca = String.prototype.charCodeAt;\n#end\n\t}\n\n}\n","/*\n * Copyright (C)2005-2013 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n /**\n\tIntIterator is used for implementing interval iterations.\n\n\tIt is usually not used explicitly, but through it's special syntax:\n\t`min...max`\n\n\tWhile it is possible to assign an instance of IntIterator to a variable or\n\tfield, it is worth noting that IntIterator does not reset after being used\n\tin a for-loop. Subsequent uses of the same instance will then have no\n\teffect.\n**/\nclass IntIterator {\n\n\tvar min : Int;\n\tvar max : Int;\n\n\t/**\n\t\tIterates from `min` (inclusive) to `max` (exclusive).\n\n\t\tIf `max <= min`, the iterator will not act as a countdown.\n\t**/\n\tpublic function new( min : Int, max : Int ) {\n\t\tthis.min = min;\n\t\tthis.max = max;\n\t}\n\n\t/**\n\t\tReturns true if the iterator has other items, false otherwise.\n\t**/\n\tpublic function hasNext() {\n\t\treturn min < max;\n\t}\n\n\t/**\n\t\tMoves to the next item of the iterator.\n\n\t\tIf this is called while hasNext() is false, the result is unspecified.\n\t**/\n\tpublic function next() {\n\t\treturn min++;\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n/**\n\tThe `Lambda` class is a collection of methods to support functional\n\tprogramming. It is ideally used with 'using Lambda' and then acts as an\n\textension to Iterable types.\n\n\tOn static platforms, working with the Iterable structure might be slower\n\tthan performing the operations directly on known types, such as Array and\n\tList.\n\n\tIf the first argument to any of the methods is null, the result is\n\tunspecified.\n**/\nclass Lambda {\n\n\t/**\n\t\tCreates an Array from Iterable `it`.\n\n\t\tIf `it` is an Array, this function returns a copy of it.\n\t**/\n\tpublic static function array<A>( it : Iterable<A> ) : Array<A> {\n\t\tvar a = new Array<A>();\n\t\tfor(i in it)\n\t\t\ta.push(i);\n\t\treturn a;\n\t}\n\n\t/**\n\t\tCreates a List form Iterable `it`.\n\n\t\tIf `it` is a List, this function returns a copy of it.\n\t**/\n\tpublic static function list<A>( it : Iterable<A> ) : List<A> {\n\t\tvar l = new List<A>();\n\t\tfor(i in it)\n\t\t\tl.add(i);\n\t\treturn l;\n\t}\n\n\t/**\n\t\tCreates a new List by applying function `f` to all elements of `it`.\n\n\t\tThe order of elements is preserved.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function map<A,B>( it : Iterable<A>, f : A -> B ) : List<B> {\n\t\tvar l = new List<B>();\n\t\tfor( x in it )\n\t\t\tl.add(f(x));\n\t\treturn l;\n\t}\n\n\t/**\n\t\tSimilar to map, but also passes the index of each element to `f`.\n\n\t\tThe order of elements is preserved.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function mapi<A,B>( it : Iterable<A>, f : Int -> A -> B ) : List<B> {\n\t\tvar l = new List<B>();\n\t\tvar i = 0;\n\t\tfor( x in it )\n\t\t\tl.add(f(i++,x));\n\t\treturn l;\n\t}\n\n\t/**\n\t\tTells if `it` contains `elt`.\n\n\t\tThis function returns true as soon as an element is found which is equal\n\t\tto `elt` according to the `==` operator.\n\n\t\tIf no such element is found, the result is false.\n\t**/\n\tpublic static function has<A>( it : Iterable<A>, elt : A ) : Bool {\n\t\tfor( x in it )\n\t\t\tif( x == elt )\n\t\t\t\treturn true;\n\t\treturn false;\n\t}\n\n\t/**\n\t\tTells if `it` contains an element for which `f` is true.\n\n\t\tThis function returns true as soon as an element is found for which a\n\t\tcall to `f` returns true.\n\n\t\tIf no such element is found, the result is false.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function exists<A>( it : Iterable<A>, f : A -> Bool ) {\n\t\tfor( x in it )\n\t\t\tif( f(x) )\n\t\t\t\treturn true;\n\t\treturn false;\n\t}\n\n\t/**\n\t\tTells if `f` is true for all elements of `it`.\n\n\t\tThis function returns false as soon as an element is found for which a\n\t\tcall to `f` returns false.\n\n\t\tIf no such element is found, the result is true.\n\n\t\tIn particular, this function always returns true if `it` is empty.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function foreach<A>( it : Iterable<A>, f : A -> Bool ) {\n\t\tfor( x in it )\n\t\t\tif( !f(x) )\n\t\t\t\treturn false;\n\t\treturn true;\n\t}\n\n\t/**\n\t\tCalls `f` on all elements of `it`, in order.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function iter<A>( it : Iterable<A>, f : A -> Void ) {\n\t\tfor( x in it )\n\t\t\tf(x);\n\t}\n\n\t/**\n\t\tReturns a List containing those elements of `it` for which `f` returned\n\t\ttrue.\n\n\t\tIf `it` is empty, the result is the empty List even if `f` is null.\n\n\t\tOtherwise if `f` is null, the result is unspecified.\n\t**/\n\tpublic static function filter<A>( it : Iterable<A>, f : A -> Bool ) {\n\t\tvar l = new List<A>();\n\t\tfor( x in it )\n\t\t\tif( f(x) )\n\t\t\t\tl.add(x);\n\t\treturn l;\n\t}\n\n\t/**\n\t\tFunctional fold on Iterable `it`, using function `f` with start argument\n\t\t`first`.\n\n\t\tIf `it` has no elements, the result is `first`.\n\n\t\tOtherwise the first element of `it` is passed to `f` alongside `first`.\n\t\tThe result of that call is then passed to `f` with the next element of\n\t\t`it`, and so on until `it` has no more elements.\n\n\t\tIf `it` or `f` are null, the result is unspecified.\n\t**/\n\tpublic static function fold<A,B>( it : Iterable<A>, f : A -> B -> B, first : B ) : B {\n\t\tfor( x in it )\n\t\t\tfirst = f(x,first);\n\t\treturn first;\n\t}\n\n\t/**\n\t\tReturns the number of elements in `it` for which `pred` is true, or the\n\t\ttotal number of elements in `it` if `pred` is null.\n\n\t\tThis function traverses all elements.\n\t**/\n\tpublic static function count<A>( it : Iterable<A>, ?pred : A -> Bool ) {\n\t\tvar n = 0;\n\t\tif( pred == null )\n\t\t\tfor( _ in it )\n\t\t\t\tn++;\n\t\telse\n\t\t\tfor( x in it )\n\t\t\t\tif( pred(x) )\n\t\t\t\t\tn++;\n\t\treturn n;\n\t}\n\n\t/**\n\t\tTells if Iterable `it` does not contain any element.\n\t**/\n\tpublic static function empty<T>( it : Iterable<T> ) : Bool {\n\t\treturn !it.iterator().hasNext();\n\t}\n\n\t/**\n\t\tReturns the index of the first element `v` within Iterable `it`.\n\n\t\tThis function uses operator `==` to check for equality.\n\n\t\tIf `v` does not exist in `it`, the result is -1.\n\t**/\n\tpublic static function indexOf<T>( it : Iterable<T>, v : T ) : Int {\n\t\tvar i = 0;\n\t\tfor( v2 in it ) {\n\t\t\tif( v == v2 )\n\t\t\t\treturn i;\n\t\t\ti++;\n\t\t}\n\t\treturn -1;\n\t}\n\n\t/**\n\t\tReturns the first element of `it` for which `f` is true.\n\n\t\tThis function returns as soon as an element is found for which a call to\n\t\t`f` returns true.\n\n\t\tIf no such element is found, the result is null.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function find<T>( it : Iterable<T>, f : T -> Bool ) : Null<T> {\n\t\tfor( v in it ) {\n\t\t\tif(f(v)) return v;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t\tReturns a new List containing all elements of Iterable `a` followed by\n\t\tall elements of Iterable `b`.\n\n\t\tIf `a` or `b` are null, the result is unspecified.\n\t**/\n\tpublic static function concat<T>( a : Iterable<T>, b : Iterable<T> ) : List<T> {\n\t\tvar l = new List();\n\t\tfor( x in a )\n\t\t\tl.add(x);\n\t\tfor( x in b )\n\t\t\tl.add(x);\n\t\treturn l;\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n/**\n\tA linked-list of elements. The list is composed of two-elements arrays\n\tthat are chained together. It is optimized so that adding or removing an\n\telement does not imply copying the whole array content every time.\n**/\nclass List<T> {\n\n\tprivate var h : Array<Dynamic>;\n\tprivate var q : Array<Dynamic>;\n\n\t/**\n\t\tThe length of `this` List.\n\t**/\n\tpublic var length(default,null) : Int;\n\n\t/**\n\t\tCreates a new empty list.\n\t**/\n\tpublic function new() {\n\t\tlength = 0;\n\t}\n\n\t/**\n\t\tAdds element `item` at the end of `this` List.\n\n\t\t`this.length` increases by 1.\n\t**/\n\tpublic function add( item : T ) {\n\t\tvar x:Array<Dynamic> = #if neko untyped __dollar__array(item,null) #else [item] #end;\n\t\tif( h == null )\n\t\t\th = x;\n\t\telse\n\t\t\tq[1] = x;\n\t\tq = x;\n\t\tlength++;\n\t}\n\n\t/**\n\t\tAdds element `item` at the beginning of `this` List.\n\n\t\t`this.length` increases by 1.\n\t**/\n\tpublic function push( item : T ) {\n\t\tvar x : Array<Dynamic> = #if neko\n\t\t\tuntyped __dollar__array(item,h)\n\t\t#else\n\t\t\t[item,h]\n\t\t#end;\n\t\th = x;\n\t\tif( q == null )\n\t\t\tq = x;\n\t\tlength++;\n\t}\n\n\t/**\n\t\tReturns the first element of `this` List, or null if no elements exist.\n\n\t\tThis function does not modify `this` List.\n\t**/\n\tpublic function first() : Null<T> {\n\t\treturn if( h == null ) null else h[0];\n\t}\n\n\t/**\n\t\tReturns the last element of `this` List, or null if no elements exist.\n\n\t\tThis function does not modify `this` List.\n\t**/\n\tpublic function last() : Null<T> {\n\t\treturn if( q == null ) null else q[0];\n\t}\n\n\n\t/**\n\t\tReturns the first element of `this` List, or null if no elements exist.\n\n\t\tThe element is removed from `this` List.\n\t**/\n\tpublic function pop() : Null<T> {\n\t\tif( h == null )\n\t\t\treturn null;\n\t\tvar x = h[0];\n\t\th = h[1];\n\t\tif( h == null )\n\t\t\tq = null;\n\t\tlength--;\n\t\treturn x;\n\t}\n\n\t/**\n\t\tTells if `this` List is empty.\n\t**/\n\tpublic function isEmpty() : Bool {\n\t\treturn (h == null);\n\t}\n\n\t/**\n\t\tEmpties `this` List.\n\n\t\tThis function does not traverse the elements, but simply sets the\n\t\tinternal references to null and `this.length` to 0.\n\t**/\n\tpublic function clear() : Void {\n\t\th = null;\n\t\tq = null;\n\t\tlength = 0;\n\t}\n\n\t/**\n\t\tRemoves the first occurence of `v` in `this` List.\n\n\t\tIf `v` is found by checking standard equality, it is removed from `this`\n\t\tList and the function returns true.\n\n\t\tOtherwise, false is returned.\n\t**/\n\tpublic function remove( v : T ) : Bool {\n\t\tvar prev = null;\n\t\tvar l = h;\n\t\twhile( l != null ) {\n\t\t\tif( l[0] == v ) {\n\t\t\t\tif( prev == null )\n\t\t\t\t\th = l[1];\n\t\t\t\telse\n\t\t\t\t\tprev[1] = l[1];\n\t\t\t\tif( q == l )\n\t\t\t\t\tq = prev;\n\t\t\t\tlength--;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tprev = l;\n\t\t\tl = l[1];\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t\tReturns an iterator on the elements of the list.\n\t**/\n\tpublic function iterator() : Iterator<T> {\n\t\t#if (java || cs)\n\t\tvar h = h;\n\t\treturn cast {\n\t\t\thasNext : function() {\n\t\t\t\treturn (h != null);\n\t\t\t},\n\t\t\tnext : function() {\n\t\t\t\t{\n\t\t\t\t\tif( h == null )\n\t\t\t\t\t\treturn null;\n\t\t\t\t\tvar x = h[0];\n\t\t\t\t\th = h[1];\n\t\t\t\t\treturn x;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t#else\n\t\treturn cast {\n\t\t\th : h,\n\t\t\thasNext : function() {\n\t\t\t\treturn untyped (__this__.h != null);\n\t\t\t},\n\t\t\tnext : function() {\n\t\t\t\tuntyped {\n\t\t\t\t\tif( __this__.h == null )\n\t\t\t\t\t\treturn null;\n\t\t\t\t\tvar x = __this__.h[0];\n\t\t\t\t\t__this__.h = __this__.h[1];\n\t\t\t\t\treturn x;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t#end\n\t}\n\n\t/**\n\t\tReturns a string representation of `this` List.\n\n\t\tThe result is enclosed in { } with the individual elements being\n\t\tseparated by a comma.\n\t**/\n\tpublic function toString() {\n\t\tvar s = new StringBuf();\n\t\tvar first = true;\n\t\tvar l = h;\n\t\ts.add(\"{\");\n\t\twhile( l != null ) {\n\t\t\tif( first )\n\t\t\t\tfirst = false;\n\t\t\telse\n\t\t\t\ts.add(\", \");\n\t\t\ts.add(Std.string(l[0]));\n\t\t\tl = l[1];\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n\n\t/**\n\t\tReturns a string representation of `this` List, with `sep` separating\n\t\teach element.\n\t**/\n\tpublic function join(sep : String) {\n\t\tvar s = new StringBuf();\n\t\tvar first = true;\n\t\tvar l = h;\n\t\twhile( l != null ) {\n\t\t\tif( first )\n\t\t\t\tfirst = false;\n\t\t\telse\n\t\t\t\ts.add(sep);\n\t\t\ts.add(l[0]);\n\t\t\tl = l[1];\n\t\t}\n\t\treturn s.toString();\n\t}\n\n\t/**\n\t\tReturns a list filtered with `f`. The returned list will contain all\n\t\telements for which `f(x) == true`.\n\t**/\n\tpublic function filter( f : T -> Bool ) {\n\t\tvar l2 = new List();\n\t\tvar l = h;\n\t\twhile( l != null ) {\n\t\t\tvar v = l[0];\n\t\t\tl = l[1];\n\t\t\tif( f(v) )\n\t\t\t\tl2.add(v);\n\t\t}\n\t\treturn l2;\n\t}\n\n\t/**\n\t\tReturns a new list where all elements have been converted by the\n\t\tfunction `f`.\n\t**/\n\tpublic function map<X>(f : T -> X) : List<X> {\n\t\tvar b = new List();\n\t\tvar l = h;\n\t\twhile( l != null ) {\n\t\t\tvar v = l[0];\n\t\t\tl = l[1];\n\t\t\tb.add(f(v));\n\t\t}\n\t\treturn b;\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:coreApi class Reflect {\n\n\tpublic inline static function hasField( o : Dynamic, field : String ) : Bool {\n\t\treturn untyped __js__('Object').prototype.hasOwnProperty.call(o, field);\n\t}\n\n\tpublic static function field( o : Dynamic, field : String ) : Dynamic untyped {\n\t\treturn try o[field] catch( e : Dynamic ) null;\n\t}\n\n\tpublic inline static function setField( o : Dynamic, field : String, value : Dynamic ) : Void untyped {\n\t\to[field] = value;\n\t}\n\n\tpublic static inline function getProperty( o : Dynamic, field : String ) : Dynamic untyped {\n\t\tvar tmp;\n\t\treturn if( o == null ) __define_feature__(\"Reflect.getProperty\",null) else if( o.__properties__ && (tmp=o.__properties__[\"get_\"+field]) ) o[tmp]() else o[field];\n\t}\n\n\tpublic static inline function setProperty( o : Dynamic, field : String, value : Dynamic ) : Void untyped {\n\t\tvar tmp;\n\t\tif( o.__properties__ && (tmp=o.__properties__[\"set_\"+field]) ) o[tmp](value) else o[field] = __define_feature__(\"Reflect.setProperty\",value);\n\t}\n\n\tpublic inline static function callMethod( o : Dynamic, func : Dynamic, args : Array<Dynamic> ) : Dynamic untyped {\n\t\treturn func.apply(o,args);\n\t}\n\n\tpublic static function fields( o : Dynamic ) : Array<String> {\n\t\tvar a = [];\n\t\tif (o != null) untyped {\n\t\t\tvar hasOwnProperty = __js__('Object').prototype.hasOwnProperty;\n\t\t\t__js__(\"for( var f in o ) {\");\n\t\t\tif( f != \"__id__\" && f != \"hx__closures__\" && hasOwnProperty.call(o, f) ) a.push(f);\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn a;\n\t}\n\n\tpublic static function isFunction( f : Dynamic ) : Bool untyped {\n\t\treturn __js__(\"typeof(f)\") == \"function\" && !(js.Boot.isClass(f) || js.Boot.isEnum(f));\n\t}\n\n\tpublic static function compare<T>( a : T, b : T ) : Int {\n\t\treturn ( a == b ) ? 0 : (((cast a) > (cast b)) ? 1 : -1);\n\t}\n\n\tpublic static function compareMethods( f1 : Dynamic, f2 : Dynamic ) : Bool {\n\t\tif( f1 == f2 )\n\t\t\treturn true;\n\t\tif( !isFunction(f1) || !isFunction(f2) )\n\t\t\treturn false;\n\t\treturn f1.scope == f2.scope && f1.method == f2.method && f1.method != null;\n\t}\n\n\tpublic static function isObject( v : Dynamic ) : Bool untyped {\n\t\tif( v == null )\n\t\t\treturn false;\n\t\tvar t = __js__(\"typeof(v)\");\n\t\treturn (t == \"string\" || (t == \"object\" && v.__enum__ == null)) || (t == \"function\" && (js.Boot.isClass(v) || js.Boot.isEnum(v)) != null);\n\t}\n\n\tpublic static function isEnumValue( v : Dynamic ) : Bool {\n\t\treturn v != null && v.__enum__ != null;\n\t}\n\n\tpublic static function deleteField( o : Dynamic, field : String ) : Bool untyped {\n\t\tif( !hasField(o,field) ) return false;\n\t\t__js__(\"delete\")(o[field]);\n\t\treturn true;\n\t}\n\n\tpublic static function copy<T>( o : T ) : T {\n\t\tvar o2 : Dynamic = {};\n\t\tfor( f in Reflect.fields(o) )\n\t\t\tReflect.setField(o2,f,Reflect.field(o,f));\n\t\treturn o2;\n\t}\n\n\t@:overload(function( f : Array<Dynamic> -> Void ) : Dynamic {})\n\tpublic static function makeVarArgs( f : Array<Dynamic> -> Dynamic ) : Dynamic {\n\t\treturn function() {\n\t\t\tvar a = untyped Array.prototype.slice.call(__js__(\"arguments\"));\n\t\t\treturn f(a);\n\t\t};\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport js.Boot;\n\n@:keepInit\n@:coreApi class Std {\n\n\tpublic static inline function is( v : Dynamic, t : Dynamic ) : Bool {\n\t\treturn untyped js.Boot.__instanceof(v,t);\n\t}\n\n\tpublic static inline function instance<T:{},S:T>( value : T, c : Class<S> ) : S {\n\t\treturn untyped __instanceof__(value, c) ? cast value : null;\n\t}\n\n\tpublic static function string( s : Dynamic ) : String {\n\t\treturn untyped js.Boot.__string_rec(s,\"\");\n\t}\n\n\tpublic static inline function int( x : Float ) : Int {\n\t\treturn cast(x) | 0;\n\t}\n\n\tpublic static function parseInt( x : String ) : Null<Int> {\n\t\tvar v = untyped __js__(\"parseInt\")(x, 10);\n\t\t// parse again if hexadecimal\n\t\tif( v == 0 && (x.charCodeAt(1) == 'x'.code || x.charCodeAt(1) == 'X'.code) )\n\t\t\tv = untyped __js__(\"parseInt\")(x);\n\t\tif( untyped __js__(\"isNaN\")(v) )\n\t\t\treturn null;\n\t\treturn cast v;\n\t}\n\n\tpublic static function parseFloat( x : String ) : Float {\n\t\treturn untyped __js__(\"parseFloat\")(x);\n\t}\n\n\tpublic static function random( x : Int ) : Int {\n\t\treturn untyped x <= 0 ? 0 : Math.floor(Math.random()*x);\n\t}\n\n\tstatic function __init__() : Void untyped {\n\t\t__feature__(\"js.Boot.getClass\",String.prototype.__class__ = __feature__(\"Type.resolveClass\",$hxClasses[\"String\"] = String,String));\n\t\t__feature__(\"js.Boot.isClass\",String.__name__ = __feature__(\"Type.getClassName\",[\"String\"],true));\n\t\t__feature__(\"Type.resolveClass\",$hxClasses[\"Array\"] = Array);\n\t\t__feature__(\"js.Boot.isClass\",Array.__name__ = __feature__(\"Type.getClassName\",[\"Array\"],true));\n\t\t__feature__(\"Date.*\", {\n\t\t\t__feature__(\"js.Boot.getClass\",__js__('Date').prototype.__class__ = __feature__(\"Type.resolveClass\",$hxClasses[\"Date\"] = __js__('Date'),__js__('Date')));\n\t\t\t__feature__(\"js.Boot.isClass\",__js__('Date').__name__ = [\"Date\"]);\n\t\t});\n\t\t__feature__(\"Int.*\",{\n\t\t\tvar Int = __feature__(\"Type.resolveClass\", $hxClasses[\"Int\"] = { __name__ : [\"Int\"] }, { __name__ : [\"Int\"] });\n\t\t});\n\t\t__feature__(\"Dynamic.*\",{\n\t\t\tvar Dynamic = __feature__(\"Type.resolveClass\", $hxClasses[\"Dynamic\"] = { __name__ : [\"Dynamic\"] }, { __name__ : [\"Dynamic\"] });\n\t\t});\n\t\t__feature__(\"Float.*\",{\n\t\t\tvar Float = __feature__(\"Type.resolveClass\", $hxClasses[\"Float\"] = __js__(\"Number\"), __js__(\"Number\"));\n\t\t\tFloat.__name__ = [\"Float\"];\n\t\t});\n\t\t__feature__(\"Bool.*\",{\n\t\t\tvar Bool = __feature__(\"Type.resolveEnum\",$hxClasses[\"Bool\"] = __js__(\"Boolean\"), __js__(\"Boolean\"));\n\t\t\tBool.__ename__ = [\"Bool\"];\n\t\t});\n\t\t__feature__(\"Class.*\",{\n\t\t\tvar Class = __feature__(\"Type.resolveClass\", $hxClasses[\"Class\"] = { __name__ : [\"Class\"] }, { __name__ : [\"Class\"] });\n\t\t});\n\t\t__feature__(\"Enum.*\",{\n\t\t\tvar Enum = {};\n\t\t});\n\t\t__feature__(\"Void.*\",{\n\t\t\tvar Void = __feature__(\"Type.resolveEnum\", $hxClasses[\"Void\"] = { __ename__ : [\"Void\"] }, { __ename__ : [\"Void\"] });\n\t\t});\n\n#if !js_es5\n\t\t__feature__(\"Array.map\",\n\t\t\tif( Array.prototype.map == null )\n\t\t\t\tArray.prototype.map = function(f) {\n\t\t\t\t\tvar a = [];\n\t\t\t\t\tfor( i in 0...__this__.length )\n\t\t\t\t\t\ta[i] = f(__this__[i]);\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\t\t);\n\t\t__feature__(\"Array.filter\",\n\t\t\tif( Array.prototype.filter == null )\n\t\t\t\tArray.prototype.filter = function(f) {\n\t\t\t\t\tvar a = [];\n\t\t\t\t\tfor( i in 0...__this__.length ) {\n\t\t\t\t\t\tvar e = __this__[i];\n\t\t\t\t\t\tif( f(e) ) a.push(e);\n\t\t\t\t\t}\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\t\t);\n#end\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n/**\n\tA String buffer is an efficient way to build a big string by appending small\n\telements together.\n\n\tIts cross-platform implementation uses String concatenation internally, but\n\tStringBuf may be optimized for different targets.\n\n\tUnlike String, an instance of StringBuf is not immutable in the sense that\n\tit can be passed as argument to functions which modify it by appending more\n\tvalues. However, the internal buffer cannot be modified.\n**/\nclass StringBuf {\n\n\tvar b:String = \"\";\n\n\t/**\n\t\tThe length of `this` StringBuf in characters.\n\t**/\n\tpublic var length(get,never) : Int;\n\n\t/**\n\t\tCreates a new StringBuf instance.\n\n\t\tThis may involve initialization of the internal buffer.\n\t**/\n\tpublic function new() {}\n\n\tinline function get_length() : Int {\n\t\treturn b.length;\n\t}\n\n\t/**\n\t\tAppends the representation of `x` to `this` StringBuf.\n\n\t\tThe exact representation of `x` may vary per platform. To get more\n\t\tconsistent behavior, this function should be called with\n\t\tStd.string(x).\n\n\t\tIf `x` is null, the String \"null\" is appended.\n\t**/\n\tpublic inline function add<T>( x : T ) : Void {\n\t\tb += x;\n\t}\n\n\t/**\n\t\tAppends the character identified by `c` to `this` StringBuf.\n\n\t\tIf `c` is negative or has another invalid value, the result is\n\t\tunspecified.\n\t**/\n\tpublic inline function addChar( c : Int ) : Void {\n\t\tb += String.fromCharCode(c);\n\t}\n\n\t/**\n\t\tAppends a substring of `s` to `this` StringBuf.\n\n\t\tThis function expects `pos` and `len` to describe a valid substring of\n\t\t`s`, or else the result is unspecified. To get more robust behavior,\n\t\t`this.add(s.substr(pos,len))` can be used instead.\n\n\t\tIf `s` or `pos` are null, the result is unspecified.\n\n\t\tIf `len` is omitted or null, the substring ranges from `pos` to the end\n\t\tof `s`.\n\t**/\n\tpublic inline function addSub( s : String, pos : Int, ?len : Int) : Void {\n\t\tb += (len == null ? s.substr(pos) : s.substr(pos, len));\n\t}\n\n\t/**\n\t\tReturns the content of `this` StringBuf as String.\n\n\t\tThe buffer is not emptied by this operation.\n\t**/\n\tpublic inline function toString() : String {\n\t\treturn b;\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n/**\n\tThis class provides advanced methods on Strings. It is ideally used with\n\t'using StringTools' and then acts as an extension to the String class.\n\n\tIf the first argument to any of the methods is null, the result is\n\tunspecified.\n**/\n#if cs\n@:keep\n#end\nclass StringTools {\n\t/**\n\t\tEncode an URL by using the standard format.\n\t**/\n\t#if (!java && !cpp) inline #end public static function urlEncode( s : String ) : String untyped {\n\t\t#if flash9\n\t\t\treturn __global__[\"encodeURIComponent\"](s);\n\t\t#elseif flash\n\t\t\treturn _global[\"escape\"](s);\n\t\t#elseif neko\n\t\t\treturn new String(_urlEncode(s.__s));\n\t\t#elseif js\n\t\t\treturn encodeURIComponent(s);\n\t\t#elseif cpp\n\t\t\treturn s.__URLEncode();\n\t\t#elseif java\n\t\t\ttry\n\t\t\t\treturn untyped __java__(\"java.net.URLEncoder.encode(s, \\\"UTF-8\\\")\")\n\t\t\tcatch (e:Dynamic) throw e;\n\t\t#elseif cs\n\t\t\treturn cs.system.Uri.EscapeUriString(s);\n\t\t#else\n\t\t\treturn null;\n\t\t#end\n\t}\n\n\t/**\n\t\tDecode an URL using the standard format.\n\t**/\n\t#if (!java && !cpp) inline #end public static function urlDecode( s : String ) : String untyped {\n\t\t#if flash9\n\t\t\treturn __global__[\"decodeURIComponent\"](s.split(\"+\").join(\" \"));\n\t\t#elseif flash\n\t\t\treturn _global[\"unescape\"](s);\n\t\t#elseif neko\n\t\t\treturn new String(_urlDecode(s.__s));\n\t\t#elseif js\n\t\t\treturn decodeURIComponent(s.split(\"+\").join(\" \"));\n\t\t#elseif cpp\n\t\t\treturn s.__URLDecode();\n\t\t#elseif java\n\t\t\ttry\n\t\t\t\treturn untyped __java__(\"java.net.URLDecoder.decode(s, \\\"UTF-8\\\")\")\n\t\t\tcatch (e:Dynamic) throw e;\n\t\t#elseif cs\n\t\t\treturn cs.system.Uri.UnescapeDataString(s);\n\t\t#else\n\t\t\treturn null;\n\t\t#end\n\t}\n\n\t/**\n\t\tEscapes HTML special characters of the string `s`.\n\n\t\tThe following replacements are made:\n\n\t\t- `&` becomes `&amp`;\n\t\t- `<` becomes `&lt`;\n\t\t- `>` becomes `&gt`;\n\n\t\tIf `quotes` is true, the following characters are also replaced:\n\n\t\t- `\"` becomes `&quot`;\n\t\t- `'` becomes `&#039`;\n\t**/\n\tpublic static function htmlEscape( s : String, ?quotes : Bool ) : String {\n\t\ts = s.split(\"&\").join(\"&amp;\").split(\"<\").join(\"&lt;\").split(\">\").join(\"&gt;\");\n\t\treturn quotes ? s.split('\"').join(\"&quot;\").split(\"'\").join(\"&#039;\") : s;\n\t}\n\n\t/**\n\t\tUnescapes HTML special characters of the string `s`.\n\n\t\tThis is the inverse operation to htmlEscape, i.e. the following always\n\t\tholds: htmlUnescape(htmlEscape(s)) == s\n\n\t\tThe replacements follow:\n\n\t\t- `&amp;` becomes `&`\n\t\t- `&lt;` becomes `<`\n\t\t- `&gt;` becomes `>`\n\t\t- `&quot;` becomes `\"`\n\t\t- `&#039;` becomes `'`\n\t**/\n\tpublic static function htmlUnescape( s : String ) : String {\n\t\treturn s.split(\"&gt;\").join(\">\").split(\"&lt;\").join(\"<\").split(\"&quot;\").join('\"').split(\"&#039;\").join(\"'\").split(\"&amp;\").join(\"&\");\n\t}\n\n\t/**\n\t\tTells if the string `s` starts with the string `start`.\n\n\t\tIf `start` is null, the result is unspecified.\n\n\t\tIf `start` is the empty String \"\", the result is true.\n\t**/\n\tpublic static #if (cs || java) inline #end function startsWith( s : String, start : String ) : Bool {\n\t\t#if java\n\t\treturn untyped s.startsWith(start);\n\t\t#elseif cs\n\t\treturn untyped s.StartsWith(start);\n\t\t#else\n\t\treturn( s.length >= start.length && s.substr(0, start.length) == start );\n\t\t#end\n\t}\n\n\t/**\n\t\tTells if the string `s` ends with the string `end`.\n\n\t\tIf `end` is null, the result is unspecified.\n\n\t\tIf `end` is the empty String \"\", the result is true.\n\t**/\n\tpublic static #if (cs || java) inline #end function endsWith( s : String, end : String ) : Bool {\n\t\t#if java\n\t\treturn untyped s.endsWith(end);\n\t\t#elseif cs\n\t\treturn untyped s.EndsWith(end);\n\t\t#else\n\t\tvar elen = end.length;\n\t\tvar slen = s.length;\n\t\treturn( slen >= elen && s.substr(slen - elen, elen) == end );\n\t\t#end\n\t}\n\n\t/**\n\t\tTells if the character in the string `s` at position `pos` is a space.\n\n\t\tA character is considered to be a space character if its character code\n\t\tis 9,10,11,12,13 or 32.\n\n\t\tIf `s` is the empty String \"\", or if pos is not a valid position within\n\t\t`s`, the result is false.\n\t**/\n\tpublic static function isSpace( s : String, pos : Int ) : Bool {\n\t\tvar c = s.charCodeAt( pos );\n\t\treturn (c > 8 && c < 14) || c == 32;\n\t}\n\n\t/**\n\t\tRemoves leading space characters of `s`.\n\n\t\tThis function internally calls isSpace() to decide which characters to\n\t\tremove.\n\n\t\tIf `s` is the empty String \"\" or consists only of space characters, the\n\t\tresult is the empty String \"\".\n\t**/\n\tpublic #if cs inline #end static function ltrim( s : String ) : String {\n\t\t#if cs\n\t\treturn untyped s.TrimStart();\n\t\t#else\n\t\tvar l = s.length;\n\t\tvar r = 0;\n\t\twhile( r < l && isSpace(s,r) ){\n\t\t\tr++;\n\t\t}\n\t\tif( r > 0 )\n\t\t\treturn s.substr(r, l-r);\n\t\telse\n\t\t\treturn s;\n\t\t#end\n\t}\n\n\t/**\n\t\tRemoves trailing space characters of `s`.\n\n\t\tThis function internally calls isSpace() to decide which characters to\n\t\tremove.\n\n\t\tIf `s` is the empty String \"\" or consists only of space characters, the\n\t\tresult is the empty String \"\".\n\t**/\n\tpublic #if cs inline #end static function rtrim( s : String ) : String {\n\t\t#if cs\n\t\treturn untyped s.TrimEnd();\n\t\t#else\n\t\tvar l = s.length;\n\t\tvar r = 0;\n\t\twhile( r < l && isSpace(s,l-r-1) ){\n\t\t\tr++;\n\t\t}\n\t\tif( r > 0 ){\n\t\t\treturn s.substr(0, l-r);\n\t\t}else{\n\t\t\treturn s;\n\t\t}\n\t\t#end\n\t}\n\n\t/**\n\t\tRemoves leading and trailing space characters of `s`.\n\n\t\tThis is a convenience function for ltrim(rtrim(s)).\n\t**/\n\tpublic #if (cs || java) inline #end static function trim( s : String ) : String {\n\t\t#if cs\n\t\treturn untyped s.Trim();\n\t\t#elseif java\n\t\treturn untyped s.trim();\n\t\t#else\n\t\treturn ltrim(rtrim(s));\n\t\t#end\n\t}\n\n\t/**\n\t\tConcatenates `c` to `s` until `s.length` is at least `l`.\n\n\t\tIf `c` is the empty String \"\" or if `l` does not exceed `s.length`,\n\t\t`s` is returned unchanged.\n\n\t\tIf `c.length` is 1, the resulting String length is exactly `l`.\n\n\t\tOtherwise the length may exceed `l`.\n\n\t\tIf `c` is null, the result is unspecified.\n\t**/\n\tpublic static function lpad( s : String, c : String, l : Int ) : String {\n\t\tif (c.length <= 0)\n\t\t\treturn s;\n\n\t\twhile (s.length < l) {\n\t\t\ts = c + s;\n\t\t}\n\t\treturn s;\n\t}\n\n\t/**\n\t\tAppends `c` to `s` until `s.length` is at least `l`.\n\n\t\tIf `c` is the empty String \"\" or if `l` does not exceed `s.length`,\n\t\t`s` is returned unchanged.\n\n\t\tIf `c.length` is 1, the resulting String length is exactly `l`.\n\n\t\tOtherwise the length may exceed `l`.\n\n\t\tIf `c` is null, the result is unspecified.\n\t**/\n\tpublic static function rpad( s : String, c : String, l : Int ) : String {\n\t\tif (c.length <= 0)\n\t\t\treturn s;\n\n\t\twhile (s.length < l) {\n\t\t\ts = s + c;\n\t\t}\n\t\treturn s;\n\t}\n\n\t/**\n\t\tReplace all occurences of the String `sub` in the String `s` by the\n\t\tString `by`.\n\n\t\tIf `sub` is the empty String \"\", `by` is inserted after each character\n\t\tof `s`. If `by` is also the empty String \"\", `s` remains unchanged.\n\n\t\tThis is a convenience function for `s.split(sub).join(by)`.\n\n\t\tIf `sub` or `by` are null, the result is unspecified.\n\t**/\n\tpublic static function replace( s : String, sub : String, by : String ) : String {\n\t\t#if java\n\t\tif (sub.length == 0)\n\t\t\treturn s.split(sub).join(by);\n\t\telse\n\t\t\treturn untyped s.replace(sub, by);\n\t\t#elseif cs\n\t\tif (sub.length == 0)\n\t\t\treturn s.split(sub).join(by);\n\t\telse\n\t\t\treturn untyped s.Replace(sub, by);\n\t\t#else\n\t\treturn s.split(sub).join(by);\n\t\t#end\n\t}\n\n\t/**\n\t\tEncodes `n` into a hexadecimal representation.\n\n\t\tIf `digits` is specified, the resulting String is padded with \"0\" until\n\t\tits length equals `digits`.\n\t**/\n\tpublic static function hex( n : Int, ?digits : Int ) {\n\t\t#if flash9\n\t\t\tvar n : UInt = n;\n\t\t\tvar s : String = untyped n.toString(16);\n\t\t\ts = s.toUpperCase();\n\t\t#else\n\t\t\tvar s = \"\";\n\t\t\tvar hexChars = \"0123456789ABCDEF\";\n\t\t\tdo {\n\t\t\t\ts = hexChars.charAt(n&15) + s;\n\t\t\t\tn >>>= 4;\n\t\t\t} while( n > 0 );\n\t\t#end\n\t\tif( digits != null )\n\t\t\twhile( s.length < digits )\n\t\t\t\ts = \"0\"+s;\n\t\treturn s;\n\t}\n\n\t/**\n\t\tReturns the character code at position `index` of String `s`.\n\n\t\tThis method is faster than String.charCodeAt() on most platforms.\n\t\tHowever, unlike String.charCodeAt(), the result is unspecified if\n\t\t`index` is negative or exceeds `s.length`.\n\n\t\tThis operation is not guaranteed to work if `s` contains the \\0\n\t\tcharacter.\n\t**/\n\tpublic static inline function fastCodeAt( s : String, index : Int ) : Int untyped {\n\t\t#if neko\n\t\treturn untyped __dollar__sget(s.__s, index);\n\t\t#elseif cpp\n\t\treturn s.cca(index);\n\t\t#elseif flash9\n\t\treturn s.cca(index);\n\t\t#elseif flash\n\t\treturn s[\"cca\"](index);\n\t\t#elseif java\n\t\treturn ( index < s.length ) ? cast(_charAt(s, index), Int) : -1;\n\t\t#elseif cs\n\t\treturn ( cast(index, UInt) < s.length ) ? cast(untyped s[index], Int) : -1;\n\t\t#elseif js\n\t\t\t#if mt\n\t\treturn (untyped s).cca(index);\n\t\t\t#else\n\t\treturn (untyped s).charCodeAt(index);\n\t\t\t#end\n\t\t#else\n\t\treturn s.cca(index);\n\t\t#end\n\t}\n\n\t/*\n\t\tTells if `c` represents the end-of-file (EOF) character.\n\t*/\n\t@:noUsing public static inline function isEof( c : Int ) : Bool {\n\t\t#if (flash9 || cpp)\n\t\treturn c == 0;\n\t\t#elseif flash8\n\t\treturn c <= 0; // fast NaN\n\t\t#elseif js\n\t\treturn c != c; // fast NaN\n\t\t#elseif neko\n\t\treturn c == null;\n\t\t#elseif cs\n\t\treturn c == -1;\n\t\t#elseif java\n\t\treturn c == -1;\n\t\t#else\n\t\treturn false;\n\t\t#end\n\t}\n\n\t#if java\n\tprivate static inline function _charAt(str:String, idx:Int):java.StdTypes.Char16 return untyped str._charAt(idx);\n\t#end\n\n\t#if neko\n\tprivate static var _urlEncode = neko.Lib.load(\"std\",\"url_encode\",1);\n\tprivate static var _urlDecode = neko.Lib.load(\"std\",\"url_decode\",1);\n\t#end\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nenum ValueType {\n\tTNull;\n\tTInt;\n\tTFloat;\n\tTBool;\n\tTObject;\n\tTFunction;\n\tTClass( c : Class<Dynamic> );\n\tTEnum( e : Enum<Dynamic> );\n\tTUnknown;\n}\n\n@:coreApi class Type {\n\n\tpublic static function getClass<T>( o : T ) : Class<T> untyped {\n\t\tif( o == null )\n\t\t\treturn null;\n\t\treturn js.Boot.getClass(o);\n\t}\n\n\tpublic static function getEnum( o : EnumValue ) : Enum<Dynamic> untyped {\n\t\tif( o == null )\n\t\t\treturn null;\n\t\treturn o.__enum__;\n\t}\n\n\tpublic static function getSuperClass( c : Class<Dynamic> ) : Class<Dynamic> untyped {\n\t\treturn c.__super__;\n\t}\n\n\n\tpublic static function getClassName( c : Class<Dynamic> ) : String {\n\t\tvar a : Array<String> = untyped c.__name__;\n\t\treturn a.join(\".\");\n\t}\n\n\tpublic static function getEnumName( e : Enum<Dynamic> ) : String {\n\t\tvar a : Array<String> = untyped e.__ename__;\n\t\treturn a.join(\".\");\n\t}\n\n\tpublic static function resolveClass( name : String ) : Class<Dynamic> untyped {\n\t\tvar cl : Class<Dynamic> = $hxClasses[name];\n\t\t// ensure that this is a class\n\t\tif( cl == null || !js.Boot.isClass(cl) )\n\t\t\treturn null;\n\t\treturn cl;\n\t}\n\n\tpublic static function resolveEnum( name : String ) : Enum<Dynamic> untyped {\n\t\tvar e : Dynamic = $hxClasses[name];\n\t\t// ensure that this is an enum\n\t\tif( e == null || !js.Boot.isEnum(e) )\n\t\t\treturn null;\n\t\treturn e;\n\t}\n\n\tpublic static function createInstance<T>( cl : Class<T>, args : Array<Dynamic> ) : T untyped {\n\t\tswitch( args.length ) {\n\t\tcase 0:\n\t\t\treturn __new__(cl);\n\t\tcase 1:\n\t\t\treturn __new__(cl,args[0]);\n\t\tcase 2:\n\t\t\treturn __new__(cl,args[0],args[1]);\n\t\tcase 3:\n\t\t\treturn __new__(cl,args[0],args[1],args[2]);\n\t\tcase 4:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3]);\n\t\tcase 5:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4]);\n\t\tcase 6:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5]);\n\t\tcase 7:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6]);\n\t\tcase 8:\n\t\t\treturn __new__(cl,args[0],args[1],args[2],args[3],args[4],args[5],args[6],args[7]);\n\t\tdefault:\n\t\t\tthrow \"Too many arguments\";\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic static function createEmptyInstance<T>( cl : Class<T> ) : T untyped {\n\t\t__js__(\"function empty() {}; empty.prototype = cl.prototype\");\n\t\treturn __js__(\"new empty()\");\n\t}\n\n\tpublic static function createEnum<T>( e : Enum<T>, constr : String, ?params : Array<Dynamic> ) : T {\n\t\tvar f = Reflect.field(e,constr);\n\t\tif( f == null ) throw \"No such constructor \"+constr;\n\t\tif( Reflect.isFunction(f) ) {\n\t\t\tif( params == null ) throw \"Constructor \"+constr+\" need parameters\";\n\t\t\treturn Reflect.callMethod(e,f,params);\n\t\t}\n\t\tif( params != null && params.length != 0 )\n\t\t\tthrow \"Constructor \"+constr+\" does not need parameters\";\n\t\treturn f;\n\t}\n\n\tpublic static function createEnumIndex<T>( e : Enum<T>, index : Int, ?params : Array<Dynamic> ) : T {\n\t\tvar c : String = (untyped e.__constructs__)[index];\n\t\tif( c == null ) throw index+\" is not a valid enum constructor index\";\n\t\treturn createEnum(e,c,params);\n\t}\n\n\tpublic static function getInstanceFields( c : Class<Dynamic> ) : Array<String> {\n\t\tvar a = [];\n\t\tuntyped __js__(\"for(var i in c.prototype) a.push(i)\");\n\t\ta.remove(\"__class__\");\n\t\ta.remove(\"__properties__\");\n\t\treturn a;\n\t}\n\n\tpublic static function getClassFields( c : Class<Dynamic> ) : Array<String> {\n\t\tvar a = Reflect.fields(c);\n\t\ta.remove(\"__name__\");\n\t\ta.remove(\"__interfaces__\");\n\t\ta.remove(\"__properties__\");\n\t\ta.remove(\"__super__\");\n\t\ta.remove(\"prototype\");\n\t\treturn a;\n\t}\n\n\tpublic static function getEnumConstructs( e : Enum<Dynamic> ) : Array<String> {\n\t\tvar a : Array<String> = untyped e.__constructs__;\n\t\treturn a.copy();\n\t}\n\n\tpublic static function typeof( v : Dynamic ) : ValueType untyped {\n\t\tswitch( __js__(\"typeof\")(v) ) {\n\t\tcase \"boolean\": return TBool;\n\t\tcase \"string\": return TClass(String);\n\t\tcase \"number\":\n\t\t\t// this should handle all cases : NaN, +/-Inf and Floats outside range\n\t\t\tif( Math.ceil(v) == v%2147483648.0 )\n\t\t\t\treturn TInt;\n\t\t\treturn TFloat;\n\t\tcase \"object\":\n\t\t\tif( v == null )\n\t\t\t\treturn TNull;\n\t\t\tvar e = v.__enum__;\n\t\t\tif( e != null )\n\t\t\t\treturn TEnum(e);\n\t\t\tvar c = js.Boot.getClass(v);\n\t\t\tif( c != null )\n\t\t\t\treturn TClass(c);\n\t\t\treturn TObject;\n\t\tcase \"function\":\n\t\t\tif( js.Boot.isClass(v) || js.Boot.isEnum(v) )\n\t\t\t\treturn TObject;\n\t\t\treturn TFunction;\n\t\tcase \"undefined\":\n\t\t\treturn TNull;\n\t\tdefault:\n\t\t\treturn TUnknown;\n\t\t}\n\t}\n\n\tpublic static function enumEq<T>( a : T, b : T ) : Bool untyped {\n\t\tif( a == b )\n\t\t\treturn true;\n\t\ttry {\n\t\t\tif( a[0] != b[0] )\n\t\t\t\treturn false;\n\t\t\tfor( i in 2...a.length )\n\t\t\t\tif( !enumEq(a[i],b[i]) )\n\t\t\t\t\treturn false;\n\t\t\tvar e = a.__enum__;\n\t\t\tif( e != b.__enum__ || e == null )\n\t\t\t\treturn false;\n\t\t} catch( e : Dynamic ) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic inline static function enumConstructor( e : EnumValue ) : String {\n\t\treturn untyped e[0];\n\t}\n\n\tpublic inline static function enumParameters( e : EnumValue ) : Array<Dynamic> {\n\t\treturn untyped e.slice(2);\n\t}\n\n\tpublic inline static function enumIndex( e : EnumValue ) : Int {\n\t\treturn untyped e[1];\n\t}\n\n\tpublic static function allEnums<T>( e : Enum<T> ) : Array<T> {\n\t\treturn untyped e.__empty_constructs__;\n\t}\n\n}\n\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nenum XmlType {\n}\n\n@:coreApi class Xml {\n\n\tpublic static var Element(default,null) : XmlType;\n\tpublic static var PCData(default,null) : XmlType;\n\tpublic static var CData(default,null) : XmlType;\n\tpublic static var Comment(default,null) : XmlType;\n\tpublic static var DocType(default,null) : XmlType;\n\tpublic static var ProcessingInstruction(default,null) : XmlType;\n\tpublic static var Document(default,null) : XmlType;\n\n\tpublic var nodeType(default,null) : XmlType;\n\tpublic var nodeName(get,set) : String;\n\tpublic var nodeValue(get,set) : String;\n\tpublic var parent(get,null) : Xml;\n\n\tvar _nodeName : String;\n\tvar _nodeValue : String;\n\tvar _attributes : haxe.ds.StringMap<String>;\n\tvar _children : Array<Xml>;\n\tvar _parent : Xml;\n\n\tpublic static function parse( str : String ) : Xml {\n\t\treturn haxe.xml.Parser.parse(str);\n\t}\n\n\tprivate function new() : Void {\n\t}\n\n\tpublic static function createElement( name : String ) : Xml {\n\t\tvar r = new Xml();\n\t\tr.nodeType = Xml.Element;\n\t\tr._children = new Array();\n\t\tr._attributes = new haxe.ds.StringMap();\n\t\tr.set_nodeName( name );\n\t\treturn r;\n\t}\n\n\tpublic static function createPCData( data : String ) : Xml {\n\t\tvar r = new Xml();\n\t\tr.nodeType = Xml.PCData;\n\t\tr.set_nodeValue( data );\n\t\treturn r;\n\t}\n\n\tpublic static function createCData( data : String ) : Xml {\n\t\tvar r = new Xml();\n\t\tr.nodeType = Xml.CData;\n\t\tr.set_nodeValue( data );\n\t\treturn r;\n\t}\n\n\tpublic static function createComment( data : String ) : Xml {\n\t\tvar r = new Xml();\n\t\tr.nodeType = Xml.Comment;\n\t\tr.set_nodeValue( data );\n\t\treturn r;\n\t}\n\n\tpublic static function createDocType( data : String ) : Xml {\n\t\tvar r = new Xml();\n\t\tr.nodeType = Xml.DocType;\n\t\tr.set_nodeValue( data );\n\t\treturn r;\n\t}\n\n\tpublic static function createProcessingInstruction( data : String ) : Xml {\n\t\tvar r = new Xml();\n\t\tr.nodeType = Xml.ProcessingInstruction;\n\t\tr.set_nodeValue( data );\n\t\treturn r;\n\t}\n\n\tpublic static function createDocument() : Xml {\n\t\tvar r = new Xml();\n\t\tr.nodeType = Xml.Document;\n\t\tr._children = new Array();\n\t\treturn r;\n\t}\n\n\tprivate function get_nodeName() : String {\n\t\tif( nodeType != Xml.Element )\n\t\t\tthrow \"bad nodeType\";\n\t\treturn _nodeName;\n\t}\n\n\tprivate function set_nodeName( n : String ) : String {\n\t\tif( nodeType != Xml.Element )\n\t\t\tthrow \"bad nodeType\";\n\t\treturn _nodeName = n;\n\t}\n\n\tprivate function get_nodeValue() : String {\n\t\tif( nodeType == Xml.Element || nodeType == Xml.Document )\n\t\t\tthrow \"bad nodeType\";\n\t\treturn _nodeValue;\n\t}\n\n\tprivate function set_nodeValue( v : String ) : String {\n\t\tif( nodeType == Xml.Element || nodeType == Xml.Document )\n\t\t\tthrow \"bad nodeType\";\n\t\treturn _nodeValue = v;\n\t}\n\n\tprivate function get_parent() : Xml {\n\t\treturn _parent;\n\t}\n\n\tpublic function get( att : String ) : String {\n\t\tif( nodeType != Xml.Element )\n\t\t\tthrow \"bad nodeType\";\n\t\treturn _attributes.get( att );\n\t}\n\n\tpublic function set( att : String, value : String ) : Void {\n\t\tif( nodeType != Xml.Element )\n\t\t\tthrow \"bad nodeType\";\n\t\t_attributes.set( att, value );\n\t}\n\n\tpublic function remove( att : String ) : Void{\n\t\tif( nodeType != Xml.Element )\n\t\t\tthrow \"bad nodeType\";\n\t\t_attributes.remove( att );\n\t}\n\n\tpublic function exists( att : String ) : Bool {\n\t\tif( nodeType != Xml.Element )\n\t\t\tthrow \"bad nodeType\";\n\t\treturn _attributes.exists( att );\n\t}\n\n\tpublic function attributes() : Iterator<String> {\n\t\tif( nodeType != Xml.Element )\n\t\t\tthrow \"bad nodeType\";\n\t\treturn _attributes.keys();\n\t}\n\n\tpublic function iterator() : Iterator<Xml> {\n\t\tif( _children == null ) throw \"bad nodetype\";\n\t\treturn untyped {\n\t\t\tcur: 0,\n\t\t\tx: this._children,\n\t\t\thasNext : function(){\n\t\t\t\treturn __this__.cur < __this__.x.length;\n\t\t\t},\n\t\t\tnext : function(){\n\t\t\t\treturn __this__.x[__this__.cur++];\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic function elements() : Iterator<Xml> {\n\t\tif( _children == null ) throw \"bad nodetype\";\n\t\treturn untyped {\n\t\t\tcur: 0,\n\t\t\tx: this._children,\n\t\t\thasNext : function() {\n\t\t\t\tvar k = __this__.cur;\n\t\t\t\tvar l = __this__.x.length;\n\t\t\t\twhile( k < l ) {\n\t\t\t\t\tif( __this__.x[k].nodeType == Xml.Element )\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tk += 1;\n\t\t\t\t}\n\t\t\t\t__this__.cur = k;\n\t\t\t\treturn k < l;\n\t\t\t},\n\t\t\tnext : function() {\n\t\t\t\tvar k = __this__.cur;\n\t\t\t\tvar l = __this__.x.length;\n\t\t\t\twhile( k < l ) {\n\t\t\t\t\tvar n = __this__.x[k];\n\t\t\t\t\tk += 1;\n\t\t\t\t\tif( n.nodeType == Xml.Element ) {\n\t\t\t\t\t\t__this__.cur = k;\n\t\t\t\t\t\treturn n;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic function elementsNamed( name : String ) : Iterator<Xml> {\n\t\tif( _children == null ) throw \"bad nodetype\";\n\t\treturn untyped {\n\t\t\tcur: 0,\n\t\t\tx: this._children,\n\t\t\thasNext : function() {\n\t\t\t\tvar k = __this__.cur;\n\t\t\t\tvar l = __this__.x.length;\n\t\t\t\twhile( k < l ) {\n\t\t\t\t\tvar n = __this__.x[k];\n\t\t\t\t\tif( n.nodeType == Xml.Element && n._nodeName == name )\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tk++;\n\t\t\t\t}\n\t\t\t\t__this__.cur = k;\n\t\t\t\treturn k < l;\n\t\t\t},\n\t\t\tnext : function() {\n\t\t\t\tvar k = __this__.cur;\n\t\t\t\tvar l = __this__.x.length;\n\t\t\t\twhile( k < l ) {\n\t\t\t\t\tvar n = __this__.x[k];\n\t\t\t\t\tk++;\n\t\t\t\t\tif( n.nodeType == Xml.Element && n._nodeName == name ) {\n\t\t\t\t\t\t__this__.cur = k;\n\t\t\t\t\t\treturn n;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic function firstChild() : Xml {\n\t\tif( _children == null ) throw \"bad nodetype\";\n\t\treturn _children[0];\n\t}\n\n\tpublic function firstElement() : Xml {\n\t\tif( _children == null ) throw \"bad nodetype\";\n\t\tvar cur = 0;\n\t\tvar l = _children.length;\n\t\twhile( cur < l ) {\n\t\t\tvar n = _children[cur];\n\t\t\tif( n.nodeType == Xml.Element )\n\t\t\t\treturn n;\n\t\t\tcur++;\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic function addChild( x : Xml ) : Void {\n\t\tif( _children == null ) throw \"bad nodetype\";\n\t\tif( x._parent != null ) x._parent._children.remove(x);\n\t\tx._parent = this;\n\t\t_children.push( x );\n\t}\n\n\tpublic function removeChild( x : Xml ) : Bool {\n\t\tif( _children == null ) throw \"bad nodetype\";\n\t\tvar b = _children.remove( x );\n\t\tif( b )\n\t\t\tx._parent = null;\n\t\treturn b;\n\t}\n\n\tpublic function insertChild( x : Xml, pos : Int ) : Void {\n\t\tif( _children == null ) throw \"bad nodetype\";\n\t\tif( x._parent != null ) x._parent._children.remove(x);\n\t\tx._parent = this;\n\t\t_children.insert( pos, x );\n\t}\n\n\tpublic function toString() : String {\n\t\tif( nodeType == Xml.PCData )\n\t\t\treturn StringTools.htmlEscape(_nodeValue);\n\t\tif( nodeType == Xml.CData )\n\t\t\treturn \"<![CDATA[\"+_nodeValue+\"]]>\";\n\t\tif( nodeType == Xml.Comment )\n\t\t\treturn \"<!--\"+_nodeValue+\"-->\";\n\t\tif( nodeType == Xml.DocType )\n\t\t\treturn \"<!DOCTYPE \"+_nodeValue+\">\";\n\t\tif( nodeType == Xml.ProcessingInstruction )\n\t\t\treturn \"<?\"+_nodeValue+\"?>\";\n\t\tvar s = new StringBuf();\n\n\t\tif( nodeType == Xml.Element ) {\n\t\t\ts.add(\"<\");\n\t\t\ts.add(_nodeName);\n\t\t\tfor( k in _attributes.keys() ){\n\t\t\t\ts.add(\" \");\n\t\t\t\ts.add(k);\n\t\t\t\ts.add(\"=\\\"\");\n\t\t\t\ts.add(_attributes.get(k));\n\t\t\t\ts.add(\"\\\"\");\n\t\t\t}\n\t\t\tif( _children.length == 0 ) {\n\t\t\t\ts.add(\"/>\");\n\t\t\t\treturn s.toString();\n\t\t\t}\n\t\t\ts.add(\">\");\n\t\t}\n\n\t\tfor( x in iterator() )\n\t\t\ts.add(x.toString());\n\n\t\tif( nodeType == Xml.Element ) {\n\t\t\ts.add(\"</\");\n\t\t\ts.add(_nodeName);\n\t\t\ts.add(\">\");\n\t\t}\n\t\treturn s.toString();\n\t}\n\n\tstatic function __init__() : Void untyped {\n\t\tXml.Element = \"element\";\n\t\tXml.PCData = \"pcdata\";\n\t\tXml.CData = \"cdata\";\n\t\tXml.Comment = \"comment\";\n\t\tXml.DocType = \"doctype\";\n\t\tXml.ProcessingInstruction = \"processingInstruction\";\n\t\tXml.Document = \"document\";\n\t}\n\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe;\n\nimport flambe.util.Disposable;\n\n/**\n * Components are bits of data and logic that can be added to entities.\n */\n#if (!macro && !display)\n@:autoBuild(flambe.platform.ComponentBuilder.build())\n#end\n@:componentBase\nclass Component\n    implements Disposable\n{\n    /** The entity this component is attached to, or null. */\n    @:allow(flambe)\n    public var owner (default, null) :Entity = null;\n\n    /** The owner's next component, for iteration. */\n    @:allow(flambe)\n    public var next (default, null) :Component = null;\n\n    /**\n     * The component's name, generated based on its class. Components with the same name replace\n     * eachother when added to an entity.\n     */\n    public var name (get, null) :String;\n\n    /**\n     * Called after this component has been added to an entity.\n     */\n    public function onAdded ()\n    {\n    }\n\n    /**\n     * Called just before this component has been removed from its entity.\n     */\n    public function onRemoved ()\n    {\n    }\n\n    /**\n     * Called just before this component's first update after being added. This is the best place to\n     * put initialization logic that requires accessing other components/entities, since it waits\n     * until the rest of the entity hierarchy is accessible.\n     *\n     * Note that onStart may be delayed until the next frame after adding a component, depending on\n     * where in the update step it was added.\n     */\n    public function onStart ()\n    {\n    }\n\n    /**\n     * Called just before this component will be removed from its entity, if onStart was previously\n     * called.\n     */\n    public function onStop ()\n    {\n    }\n\n    /**\n     * Called when this component receives a game update.\n     * @param dt The time elapsed since the last frame, in seconds.\n     */\n    public function onUpdate (dt :Float)\n    {\n    }\n\n    /**\n     * Removes this component from its owning entity.\n     */\n    public function dispose ()\n    {\n        if (owner != null) {\n            owner.remove(this);\n        }\n    }\n\n    private function get_name () :String\n    {\n        return null; // Subclasses will automagically implement this\n    }\n\n    // Component flags\n    @:allow(flambe) static inline var STARTED = 1 << 0;\n    private static inline var NEXT_FLAG = 1 << 1; // Must be last!\n\n    @:allow(flambe) var _flags :Int = 0;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe;\n\n#if macro\nimport haxe.macro.Context;\nimport haxe.macro.Expr;\nimport haxe.macro.Type;\nusing haxe.macro.ExprTools;\n#end\n\nimport flambe.util.Disposable;\n\nusing Lambda;\nusing flambe.util.BitSets;\n\n/**\n * A node in the entity hierarchy, and a collection of components.\n *\n * To iterate over the hierarchy, use the parent, firstChild, next and firstComponent fields. For\n * example:\n *\n * ```haxe\n * // Iterate over entity's children\n * var child = entity.firstChild;\n * while (child != null) {\n *     var next = child.next; // Store in case the child is removed in process()\n *     process(child);\n *     child = next;\n * }\n * ```\n */\n@:final class Entity\n    implements Disposable\n{\n    /** This entity's parent. */\n    public var parent (default, null) :Entity = null;\n\n    /** This entity's first child. */\n    public var firstChild (default, null) :Entity = null;\n\n    /** This entity's next sibling, for iteration. */\n    public var next (default, null) :Entity = null;\n\n    /** This entity's first component. */\n    public var firstComponent (default, null) :Component = null;\n\n    public function new ()\n    {\n#if flash\n        _compMap = cast new flash.utils.Dictionary();\n#elseif js\n        _compMap = {};\n#end\n    }\n\n    /**\n     * Add a component to this entity. Any previous component of this type will be replaced.\n     * @returns This instance, for chaining.\n     */\n    public function add (component :Component) :Entity\n    {\n        // Remove the component from any previous owner. Don't just call dispose, which has\n        // additional behavior in some components (like Disposer).\n        if (component.owner != null) {\n            component.owner.remove(component);\n        }\n\n        var name = component.name;\n        var prev = getComponent(name);\n        if (prev != null) {\n            // Remove the previous component under this name\n            remove(prev);\n        }\n\n        untyped _compMap[name] = component;\n\n        // Append it to the component list\n        var tail = null, p = firstComponent;\n        while (p != null) {\n            tail = p;\n            p = p.next;\n        }\n        if (tail != null) {\n            tail.next = component;\n        } else {\n            firstComponent = component;\n        }\n\n        component.owner = this;\n        component.next = null;\n        component.onAdded();\n\n        return this;\n    }\n\n    /**\n     * Remove a component from this entity.\n     * @return Whether the component was removed.\n     */\n    public function remove (component :Component) :Bool\n    {\n        var prev :Component = null, p = firstComponent;\n        while (p != null) {\n            var next = p.next;\n            if (p == component) {\n                // Splice out the component\n                if (prev == null) {\n                    firstComponent = next;\n                } else {\n                    prev.owner = this;\n                    prev.next = next;\n                }\n\n                // Remove it from the _compMap\n#if flash\n                untyped __delete__(_compMap, p.name);\n#elseif js\n                untyped __js__(\"delete\")(_compMap[p.name]);\n#end\n\n                // Notify the component it was removed\n                if (p._flags.contains(Component.STARTED)) {\n                    p.onStop();\n                    p._flags = p._flags.remove(Component.STARTED);\n                }\n                p.onRemoved();\n                p.owner = null;\n                p.next = null;\n                return true;\n            }\n            prev = p;\n            p = next;\n        }\n        return false;\n    }\n\n    /**\n     * Gets a component of a given type from this entity.\n     */\n#if (display || dox)\n    public function get<A:Component> (componentClass :Class<A>) :A return null;\n\n#else\n    macro public function get<A:Component> (self :Expr, componentClass :ExprOf<Class<A>>) :ExprOf<A>\n    {\n        var type = requireComponentType(componentClass);\n        var name = macro $componentClass.NAME;\n        return needSafeCast(type)\n            ? macro Std.instance($self.getComponent($name), $componentClass)\n            : macro $self._internal_unsafeCast($self.getComponent($name), $componentClass);\n    }\n#end\n\n    /**\n     * Checks if this entity has a component of the given type.\n     */\n#if (display || dox)\n    public function has<A:Component> (componentClass :Class<A>) :Bool return false;\n\n#else\n    macro public function has<A> (self :Expr, componentClass :ExprOf<Class<A>>) :ExprOf<Bool>\n    {\n        return macro $self.get($componentClass) != null;\n    }\n#end\n\n    /**\n     * Gets a component of a given type from this entity, or any of its parents. Searches upwards in\n     * the hierarchy until the component is found, or returns null if not found.\n     */\n#if (display || dox)\n    public function getFromParents<A:Component> (componentClass :Class<A>) :A return null;\n\n#else\n    macro public function getFromParents<A> (self :Expr, componentClass :ExprOf<Class<A>>) :ExprOf<A>\n    {\n        var type = requireComponentType(componentClass);\n        var name = macro $componentClass.NAME;\n        return needSafeCast(type)\n            ? macro $self._internal_getFromParents($name, $componentClass)\n            : macro $self._internal_unsafeCast($self._internal_getFromParents($name), $componentClass);\n    }\n#end\n\n    /**\n     * Gets a component of a given type from this entity, or any of its children. Searches downwards\n     * in a depth-first search until the component is found, or returns null if not found.\n     */\n#if (display || dox)\n    public function getFromChildren<A:Component> (componentClass :Class<A>) :A return null;\n\n#else\n    macro public function getFromChildren<A> (self :Expr, componentClass :ExprOf<Class<A>>) :ExprOf<A>\n    {\n        var type = requireComponentType(componentClass);\n        var name = macro $componentClass.NAME;\n        return needSafeCast(type)\n            ? macro $self._internal_getFromChildren($name, $componentClass)\n            : macro $self._internal_unsafeCast($self._internal_getFromChildren($name), $componentClass);\n    }\n#end\n\n    /**\n     * Gets a component by name from this entity.\n     */\n    inline public function getComponent (name :String) :Component\n    {\n        return untyped _compMap[name];\n    }\n\n    /**\n     * Adds a child to this entity.\n     * @param append Whether to add the entity to the end or beginning of the child list.\n     * @returns This instance, for chaining.\n     */\n    public function addChild (entity :Entity, append :Bool=true) :Entity\n    {\n        if (entity.parent != null) {\n            entity.parent.removeChild(entity);\n        }\n        entity.parent = this;\n\n        if (append) {\n            // Append it to the child list\n            var tail = null, p = firstChild;\n            while (p != null) {\n                tail = p;\n                p = p.next;\n            }\n            if (tail != null) {\n                tail.next = entity;\n            } else {\n                firstChild = entity;\n            }\n\n        } else {\n            // Prepend it to the child list\n            entity.next = firstChild;\n            firstChild = entity;\n        }\n\n        return this;\n    }\n\n    public function removeChild (entity :Entity)\n    {\n        var prev :Entity = null, p = firstChild;\n        while (p != null) {\n            var next = p.next;\n            if (p == entity) {\n                // Splice out the entity\n                if (prev == null) {\n                    firstChild = next;\n                } else {\n                    prev.next = next;\n                }\n                p.parent = null;\n                p.next = null;\n                return;\n            }\n            prev = p;\n            p = next;\n        }\n    }\n\n    /**\n     * Dispose all of this entity's children, without touching its own components or removing itself\n     * from its parent.\n     */\n    public function disposeChildren ()\n    {\n        while (firstChild != null) {\n            firstChild.dispose();\n        }\n    }\n\n    /**\n     * Removes this entity from its parent, and disposes all its components and children.\n     */\n    public function dispose ()\n    {\n        if (parent != null) {\n            parent.removeChild(this);\n        }\n\n        while (firstComponent != null) {\n            firstComponent.dispose();\n        }\n        disposeChildren();\n    }\n\n    #if debug @:keep #end public function toString () :String\n    {\n        return toStringImpl(\"\");\n    }\n\n    private function toStringImpl (indent :String) :String\n    {\n        var output = \"\";\n        var p = firstComponent;\n        while (p != null) {\n            output += p.name;\n            if (p.next != null) {\n                output += \", \";\n            }\n            p = p.next;\n        }\n        output += \"\\n\";\n\n        // Oof, Haxe doesn't support escaped unicode in string literals\n        var u2514 = String.fromCharCode(0x2514); // \n        var u241c = String.fromCharCode(0x251c); // \n        var u2500 = String.fromCharCode(0x2500); // \n        var u2502 = String.fromCharCode(0x2502); // \n\n        var p = firstChild;\n        while (p != null) {\n            var last = p.next == null;\n            output += indent + (last ? u2514 : u241c) + u2500+u2500+\" \";\n            output += p.toStringImpl(indent + (last ? \" \" : u2502) + \"   \");\n            p = p.next;\n        }\n        return output;\n    }\n\n    // Semi-private helper methods\n#if !display\n    @:extern // Inline even in debug builds\n    inline public function _internal_unsafeCast<A:Component> (component :Component, cl :Class<A>) :A\n    {\n        return cast component;\n    }\n\n    public function _internal_getFromParents<A:Component> (name :String, ?safeCast :Class<A>) :A\n    {\n        var entity = this;\n        do {\n            var component = entity.getComponent(name);\n            if (safeCast != null) {\n                component = Std.instance(component, safeCast);\n            }\n            if (component != null) {\n                return cast component;\n            }\n            entity = entity.parent;\n        } while (entity != null);\n\n        return null; // Not found\n    }\n\n    public function _internal_getFromChildren<A:Component> (name :String, ?safeCast :Class<A>) :A\n    {\n        var component = getComponent(name);\n        if (safeCast != null) {\n            component = Std.instance(component, safeCast);\n        }\n        if (component != null) {\n            return cast component;\n        }\n\n        var child = firstChild;\n        while (child != null) {\n            var component = child._internal_getFromChildren(name, safeCast);\n            if (component != null) {\n                return component;\n            }\n\n            child = child.next;\n        }\n\n        return null; // Not found\n    }\n#end\n\n#if macro\n    // Gets the ClassType from an expression, or aborts if it's not a component class\n    private static function requireComponentType (componentClass :Expr) :ClassType\n    {\n        var path = getClassName(componentClass);\n        if (path != null) {\n            var type = Context.getType(path.join(\".\"));\n            switch (type) {\n            case TInst(ref,_):\n                var cl = ref.get();\n                if (Context.unify(type, Context.getType(\"flambe.Component\")) && cl.superClass != null) {\n                    return cl;\n                }\n            default:\n            }\n        }\n\n        Context.error(\"Expected a class that extends Component, got \" + componentClass.toString(),\n            componentClass.pos);\n        return null;\n    }\n\n    // Gets a class name from a given expression\n    private static function getClassName<A> (componentClass :Expr) :Array<String>\n    {\n        switch (componentClass.expr) {\n        case EConst(CIdent(name)):\n            return [name];\n        case EField(expr, name):\n            var path = getClassName(expr);\n            if (path != null) {\n                path.push(name);\n            }\n            return path;\n        default:\n            return null;\n        }\n    }\n\n    private static function needSafeCast (componentClass :ClassType) :Bool\n    {\n        return !componentClass.superClass.t.get().meta.has(\":componentBase\");\n    }\n#end\n\n    /**\n     * Maps String -> Component. Usually you would use a Haxe Map here, but I'm dropping down to plain\n     * Object/Dictionary for the quickest possible lookups in this critical part of Flambe.\n     */\n    private var _compMap :Dynamic<Component>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\n//@HACK (aris)\n#if !includeAway3D\n\timport tools.spark.framework.platform.html.flambe2_5.Subgraphics;\n#else\n\timport tools.spark.framework.platform.html.away3d.Subgraphics;\n#end\n\n\nimport js.Browser;\nimport js.html.*;\n\nimport flambe.asset.AssetPack;\nimport flambe.asset.Manifest;\nimport flambe.display.Texture;\nimport flambe.subsystem.*;\nimport flambe.util.Assert;\nimport flambe.util.Logger;\nimport flambe.util.Promise;\nimport flambe.util.Signal1;\n\nclass HtmlPlatform\n    implements Platform\n{\n    public static var instance (default, null) :HtmlPlatform = new HtmlPlatform();\n\n    public var mainLoop (default, null) :MainLoop;\n    public var musicPlaying :Bool;\n\n    private function new ()\n    {\n    }\n\n    public function init ()\n    {\n        HtmlUtil.fixAndroidMath();\n\n#if html\n        // If running in a plain web browser, look up the canvas from the embedder\n        var canvas :CanvasElement = null;\n        try {\n            // Use the canvas assigned to us by the flambe.js embedder\n            canvas = (untyped Browser.window).flambe.canvas;\n        } catch (error :Dynamic) {\n        }\n        Assert.that(canvas != null,\n            \"Could not find a Flambe canvas! Are you embedding with flambe.js?\");\n#else\n        // Otherwise create our own\n        var canvas = Browser.document.createCanvasElement();\n        Browser.document.getElementById(\"content\").appendChild(canvas);\n#end\n\n        // Allow the canvas to trap keyboard focus\n        canvas.setAttribute(\"tabindex\", \"0\");\n        // ...but hide the focus rectangle\n        canvas.style.outlineStyle = \"none\";\n        (untyped canvas.style).webkitTapHighlightColor = \"transparent\";\n\n        // Browser optimization hints\n#if !flambe_transparent\n        canvas.setAttribute(\"moz-opaque\", \"true\");\n#end\n        // canvas.style.webkitTransform = \"translateZ(0)\";\n        // canvas.style.backgroundColor = \"#000\";\n\n        _stage = new HtmlStage(canvas);\n        _pointer = new BasicPointer();\n        _mouse = new HtmlMouse(_pointer, canvas);\n\n        _renderer = createRenderer(canvas);\n\n        mainLoop = new MainLoop();\n\n        // Used by browsers that don't support audio very well\n        musicPlaying = false;\n\n        _canvas = canvas;\n        _container = canvas.parentElement;\n        _container.style.overflow = \"hidden\";\n        _container.style.position = \"relative\";\n\n        // Prevent double tap zooming on IE10. Maybe this should be in the MSPointer block below,\n        // but I have no idea without testing, so apply it always\n        // http://msdn.microsoft.com/en-us/library/windows/apps/Hh767313.aspx\n        (untyped _container.style).msTouchAction = \"none\";\n\n        var lastTouchTime = 0;\n        var onMouse = function (event :MouseEvent) {\n            if (event.timeStamp - lastTouchTime < 1000) {\n                // Ignore if there was too recent a touch event, to filter out mouse events emulated\n                // by mobile browsers: http://www.w3.org/TR/touch-events/#mouse-events\n                return;\n            }\n            var bounds = canvas.getBoundingClientRect();\n            var x = getX(event, bounds);\n            var y = getY(event, bounds);\n\n            switch (event.type) {\n            case \"mousedown\":\n                if (event.target == canvas) {\n                    event.preventDefault();\n                    _mouse.submitDown(x, y, event.button);\n                    canvas.focus();\n                }\n\n            case \"mousemove\":\n                _mouse.submitMove(x, y);\n\n            case \"mouseup\":\n                _mouse.submitUp(x, y, event.button);\n\n            case \"mousewheel\", \"DOMMouseScroll\":\n                var velocity = (event.type == \"mousewheel\") ? (untyped event).wheelDelta/40 : -event.detail;\n                if (_mouse.submitScroll(x, y, velocity)) {\n                    // Only prevent page scrolling if the event was handled\n                    event.preventDefault();\n                }\n            }\n        };\n        // Add listeners on the window object so dragging and releasing outside of the canvas works\n        Browser.window.addEventListener(\"mousedown\", onMouse, false);\n        Browser.window.addEventListener(\"mousemove\", onMouse, false);\n        Browser.window.addEventListener(\"mouseup\", onMouse, false);\n\n        // But the wheel listener should only go on the canvas\n        canvas.addEventListener(\"mousewheel\", onMouse, false);\n        canvas.addEventListener(\"DOMMouseScroll\", onMouse, false); // https://bugzil.la/719320\n\n        // Suppress the context menu so right-click events aren't interfered with\n        canvas.addEventListener(\"contextmenu\", function (event) event.preventDefault(), false);\n\n        // Detect touch support. See http://modernizr.github.com/Modernizr/touch.html for more\n        // sophisticated detection methods, but this seems to cover all important browsers\n        var standardTouch :Bool = untyped __js__(\"typeof\")(Browser.window.ontouchstart) != \"undefined\";\n\n        // The pointer event handles mouse movement, touch events, and stylus events.\n        // We check to see if multiple points are supported indicating true touch support.\n        // http://blogs.msdn.com/b/ie/archive/2011/10/19/handling-multi-touch-and-mouse-input-in-all-browsers.aspx\n        var msTouch :Bool = untyped __js__(\"'msMaxTouchPoints' in window.navigator && (window.navigator.msMaxTouchPoints > 1)\");\n\n        if (standardTouch || msTouch) {\n            var basicTouch = new BasicTouch(_pointer, standardTouch ?\n                4 : (untyped Browser.navigator).msMaxTouchPoints);\n            _touch = basicTouch;\n\n            var onTouch = function (event :Dynamic) {\n                var changedTouches :Array<Dynamic> = standardTouch ? event.changedTouches : [event];\n                var bounds = event.target.getBoundingClientRect();\n                lastTouchTime = event.timeStamp;\n\n                switch (event.type) {\n                case \"touchstart\", \"MSPointerDown\", \"pointerdown\":\n                    event.preventDefault();\n                    if (HtmlUtil.SHOULD_HIDE_MOBILE_BROWSER) {\n                        HtmlUtil.hideMobileBrowser();\n                    }\n                    for (touch in changedTouches) {\n                        var x = getX(touch, bounds);\n                        var y = getY(touch, bounds);\n                        var id = Std.int(standardTouch ? touch.identifier : touch.pointerId);\n                        basicTouch.submitDown(id, x, y);\n                    }\n\n                case \"touchmove\", \"MSPointerMove\", \"pointermove\":\n                    event.preventDefault();\n                    for (touch in changedTouches) {\n                        var x = getX(touch, bounds);\n                        var y = getY(touch, bounds);\n                        var id = Std.int(standardTouch ? touch.identifier : touch.pointerId);\n                        basicTouch.submitMove(id, x, y);\n                    }\n\n                case \"touchend\", \"touchcancel\", \"MSPointerUp\", \"pointerup\":\n                    for (touch in changedTouches) {\n                        var x = getX(touch, bounds);\n                        var y = getY(touch, bounds);\n                        var id = Std.int(standardTouch ? touch.identifier : touch.pointerId);\n                        basicTouch.submitUp(id, x, y);\n                    }\n                }\n            };\n\n            if (standardTouch) {\n                canvas.addEventListener(\"touchstart\", onTouch, false);\n                canvas.addEventListener(\"touchmove\", onTouch, false);\n                canvas.addEventListener(\"touchend\", onTouch, false);\n                canvas.addEventListener(\"touchcancel\", onTouch, false);\n            } else {\n                canvas.addEventListener(\"MSPointerDown\", onTouch, false);\n                canvas.addEventListener(\"MSPointerMove\", onTouch, false);\n                canvas.addEventListener(\"MSPointerUp\", onTouch, false);\n            }\n\n        } else {\n            _touch = new DummyTouch();\n        }\n\n        // Handle uncaught errors\n        var oldErrorHandler = (untyped Browser.window).onerror;\n        (untyped Browser.window).onerror = function (message :String, url :String, line :Int) {\n            System.uncaughtError.emit(message);\n            return (oldErrorHandler != null) ? oldErrorHandler(message, url, line) : false;\n        };\n\n        // Handle visibility changes if the browser supports them\n        // http://www.w3.org/TR/page-visibility/\n        var hiddenApi = HtmlUtil.loadExtension(\"hidden\", Browser.document);\n        if (hiddenApi.value != null) {\n            var onVisibilityChanged = function (_) {\n                System.hidden._ = Reflect.field(Browser.document, hiddenApi.field);\n            };\n            onVisibilityChanged(null); // Update now\n            Browser.document.addEventListener(hiddenApi.prefix + \"visibilitychange\",\n                onVisibilityChanged, false);\n        } else {\n            // Adds some lock screen support for iOS, possibly other devices that don't support the\n            // page visibility api.\n            var onPageTransitionChange = function (event) {\n                System.hidden._ = (event.type == \"pagehide\");\n            };\n            Browser.window.addEventListener(\"pageshow\", onPageTransitionChange, false);\n            Browser.window.addEventListener(\"pagehide\", onPageTransitionChange, false);\n        }\n\n        // Skip the next frame when coming back from being hidden\n        System.hidden.changed.connect(function (hidden,_) {\n            if (!hidden) {\n                _skipFrame = true;\n            }\n        });\n        _skipFrame = false;\n\n        _lastUpdate = HtmlUtil.now();\n\n        // Use requestAnimationFrame if available, otherwise a 60 FPS setInterval\n        // https://developer.mozilla.org/en/DOM/window.mozRequestAnimationFrame\n        var requestAnimationFrame = HtmlUtil.loadExtension(\"requestAnimationFrame\").value;\n        if (requestAnimationFrame != null) {\n            // Use the high resolution, monotonic timer if available\n            // http://www.w3.org/TR/hr-time/\n            var performance :Performance = Browser.window.performance;\n            var hasPerfNow = (performance != null) && HtmlUtil.polyfill(\"now\", performance);\n\n            if (hasPerfNow) {\n                // performance.now is relative to navigationStart, rather than a timestamp\n                _lastUpdate = performance.now();\n            } else {\n                Log.warn(\"No monotonic timer support, falling back to the system date\");\n            }\n\n            var updateFrame = null;\n            updateFrame = function (now :Float) {\n                update(hasPerfNow ? performance.now() : now);\n                requestAnimationFrame(updateFrame, canvas);\n            };\n            requestAnimationFrame(updateFrame, canvas);\n\n        } else {\n            Log.warn(\"No requestAnimationFrame support, falling back to setInterval\");\n            Browser.window.setInterval(function () {\n                update(HtmlUtil.now());\n            }, 16); // ~60 FPS\n        }\n\n#if debug\n        new DebugLogic(this);\n#if html\n        _catapult = HtmlCatapultClient.canUse() ? new HtmlCatapultClient() : null;\n#end\n#end\n        Log.info(\"Initialized HTML platform\", [\"renderer\", _renderer.type]);\n    }\n\n    public function loadAssetPack (manifest :Manifest) :Promise<AssetPack>\n    {\n        return new HtmlAssetPackLoader(this, manifest).promise;\n    }\n\n    public function getStage () :StageSystem\n    {\n        return _stage;\n    }\n\n    public function getStorage () :StorageSystem\n    {\n        if (_storage == null) {\n            // Safely access localStorage (browsers may throw an error on direct access)\n            // http://dev.w3.org/html5/webstorage/#dom-localstorage\n            var localStorage = Browser.getLocalStorage();\n            if (localStorage != null) {\n                _storage = new HtmlStorage(localStorage);\n            } else {\n                Log.warn(\"localStorage is unavailable, falling back to unpersisted storage\");\n                _storage = new DummyStorage();\n            }\n        }\n        return _storage;\n    }\n\n    public function getLocale () :String\n    {\n        // https://developer.mozilla.org/en-US/docs/DOM/window.navigator.language\n        var locale = Browser.navigator.language;\n        if (locale == null) {\n            // IE uses the non-standard userLanguage (or browserLanguage or systemLanguage, but\n            // userLanguage seems to match String's locale-aware methods)\n            locale = (untyped Browser.navigator).userLanguage;\n        }\n        return locale;\n    }\n\n    public function createLogHandler (tag :String) :LogHandler\n    {\n#if (debug || flambe_keep_logs)\n        if (HtmlLogHandler.isSupported()) {\n            return new HtmlLogHandler(tag);\n        }\n#end\n        return null;\n    }\n\n    public function getTime () :Float\n    {\n        return HtmlUtil.now() / 1000;\n    }\n\n    public function getCatapultClient ()\n    {\n        return _catapult;\n    }\n\n    private function update (now :Float)\n    {\n        var dt = (now-_lastUpdate) / 1000;\n        _lastUpdate = now;\n\n        if (System.hidden._) {\n            return; // Prevent updates while hidden\n        }\n        if (_skipFrame) {\n            _skipFrame = false;\n            return;\n        }\n\n        mainLoop.update(dt);\n\t\t\n        //mainLoop.render(_renderer);  //@HACK (aris)\n\t\t\n\t\t//@HACK (aris)\n\t\t#if !includeAway3D\n\t\t\tSubgraphics.onRender();\n\t\t#end\n    }\n\n    public function getPointer () :PointerSystem\n    {\n        return _pointer;\n    }\n\n    public function getMouse () :MouseSystem\n    {\n        return _mouse;\n    }\n\n    public function getTouch () :TouchSystem\n    {\n        return _touch;\n    }\n\n    public function getKeyboard () :KeyboardSystem\n    {\n        if (_keyboard == null) {\n            _keyboard = new BasicKeyboard();\n            var onKey = function (event :KeyboardEvent) {\n                switch (event.type) {\n                case \"keydown\":\n                    if (_keyboard.submitDown(event.keyCode)) {\n                        event.preventDefault();\n                    }\n                case \"keyup\":\n                    _keyboard.submitUp(event.keyCode);\n                }\n            };\n            _canvas.addEventListener(\"keydown\", onKey, false);\n            _canvas.addEventListener(\"keyup\", onKey, false);\n        }\n        return _keyboard;\n    }\n\n    public function getWeb () :WebSystem\n    {\n        if (_web == null) {\n            _web = new HtmlWeb(_container);\n        }\n        return _web;\n    }\n\n    public function getExternal () :ExternalSystem\n    {\n        if (_external == null) {\n            _external = new HtmlExternal();\n        }\n        return _external;\n    }\n\n    public function getMotion () :MotionSystem\n    {\n        if (_motion == null) {\n            _motion = new HtmlMotion();\n        }\n        return _motion;\n    }\n\n    public function getRenderer () :InternalRenderer<Dynamic>\n    {\n        return _renderer;\n    }\n\n    private function getX (event :Dynamic, bounds :Dynamic) :Float\n    {\n        return (event.clientX - bounds.left)*_stage.width/bounds.width;\n    }\n\n    private function getY (event :Dynamic, bounds :Dynamic) :Float\n    {\n        return (event.clientY - bounds.top)*_stage.height/bounds.height;\n    }\n\n    private function createRenderer (canvas :CanvasElement) :InternalRenderer<Dynamic>\n    {\n\t\t//@HACK (aris)\n\t\t#if includeAway3D\n\t\t\tvar gl = Subgraphics.initAway3DStage3DgetContext3D();\n\t\t\treturn new WebGLRenderer(_stage, gl);\n\t\t#else\n\t\t\t#if !flambe_disable_webgl\n\n\t\t\t#if firefox\n\t\t\t\t\t// WebGL is buggy in Firefox OS 1.1, so blacklist it there\n\t\t\t\t\t// https://developer.mozilla.org/en-US/docs/Gecko_user_agent_string_reference#Firefox_OS\n\t\t\t\t\tvar majorVersion = ~/\\bFirefox\\/(\\d+)/;\n\t\t\t\t\tif (!majorVersion.match(Browser.navigator.userAgent) || Std.parseInt(majorVersion.matched(1)) >= 26)\n\t\t\t#end\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvar gl = canvas.getContextWebGL(cast {\n\t\t\t#if !flambe_transparent\n\t\t\t\t\t\t\talpha: false,\n\t\t\t#end\n\t\t\t\t\t\t\tdepth: false,\n\t\t\t\t\t\t\t// http://blog.tojicode.com/2013/12/failifmajorperformancecaveat-with-great.html\n\t\t\t\t\t\t\tfailIfMajorPerformanceCaveat: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (gl != null) {\n\t\t\t#if !flambe_disable_canvas\n\t\t\t\t\t\t\t// TODO(bruno): Remove this check once failIfMajorPerformanceCaveat becomes\n\t\t\t\t\t\t\t// prevalent\n\t\t\t\t\t\t\tif (HtmlUtil.detectSlowDriver(gl)) {\n\t\t\t\t\t\t\t\tLog.warn(\"Detected a slow WebGL driver, falling back to canvas\");\n\t\t\t\t\t\t\t} else\n\t\t\t#end\n\t\t\t\t\t\t\treturn new WebGLRenderer(_stage, gl);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (_ :Dynamic) {\n\t\t\t\t\t\t// Getting the WebGL context blows up on some (headless?) systems\n\t\t\t\t\t}\n\t\t\t#end\n\n\t\t\t#if !flambe_disable_canvas\n\t\t\t\t\t// No WebGL, fall back to canvas\n\t\t\t\t\treturn new CanvasRenderer(canvas);\n\t\t\t#end\n\n\t\t\t#if (flambe_disable_webgl && flambe_disable_canvas)\n\t\t\t\t#error \"Build with either flambe_disable_webgl or flambe_disable_canvas, not both!\"\n\t\t\t#end\n\t\t\t\n\t\t\tLog.error(\"No renderer available!\");\n\t\t\treturn null;\n\t\t#end\n    }\n\n    // Statically initialized subsystems\n    private var _mouse :HtmlMouse;\n    private var _pointer :BasicPointer;\n    private var _renderer :InternalRenderer<Dynamic>;\n    private var _stage :HtmlStage;\n    private var _touch :TouchSystem;\n\n    // Lazily initialized subsystems\n    private var _external :ExternalSystem;\n    private var _keyboard :BasicKeyboard;\n    private var _motion :MotionSystem;\n    private var _storage :StorageSystem;\n    private var _web :WebSystem;\n\n    private var _canvas :CanvasElement;\n    private var _container :Element;\n\n    private var _lastUpdate :Float;\n    private var _skipFrame :Bool;\n\n    private var _catapult :HtmlCatapultClient;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\nimport flambe.util.Signal2;\n\n/**\n * Wraps a single value, notifying listeners when the value changes.\n */\n#if !js\n@:generic // Generate typed templates on static targets\n#end\nclass Value<A>\n{\n    /**\n     * The wrapped value, setting this to a different value will fire the `changed` signal.\n     */\n    public var _ (get, set) :A;\n\n    /**\n     * Emitted when the value has changed. The first listener parameter is the new current value,\n     * the second parameter is the old previous value.\n     */\n    public var changed (get, null) :Signal2<A,A>;\n\n    public function new (value :A, ?listener :Listener2<A,A>)\n    {\n        _value = value;\n        _changed = (listener != null) ? new Signal2(listener) : null;\n    }\n\n    /**\n     * Immediately calls a listener with the current value, and again whenever the value changes.\n     * @returns A handle that can be disposed to stop watching for changes.\n     */\n    public function watch (listener :Listener2<A,A>) :Disposable\n    {\n        listener(_value, _value);\n        return changed.connect(listener);\n    }\n\n    inline private function get__ () :A\n    {\n        return _value;\n    }\n\n    private function set__ (newValue :A) :A\n    {\n        var oldValue = _value;\n        if (newValue != oldValue) {\n            _value = newValue;\n            if (_changed != null) {\n                _changed.emit(newValue, oldValue);\n            }\n        }\n        return newValue;\n    }\n\n    private function get_changed ()\n    {\n        if (_changed == null) {\n            _changed = new Signal2();\n        }\n        return _changed;\n    }\n\n    #if debug @:keep #end public function toString () :String\n    {\n        return \"\"+_value;\n    }\n\n    private var _value :A;\n    private var _changed :Signal2<A,A>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * Represents a connected signal listener.\n */\nclass SignalConnection\n    implements Disposable\n{\n    /**\n     * True if the listener will remain connected after being used.\n     */\n    public var stayInList (default, null) :Bool;\n\n    @:allow(flambe) function new (signal :SignalBase, listener :Dynamic)\n    {\n        _signal = signal;\n        _listener = listener;\n        stayInList = true;\n    }\n\n    /**\n     * Tells the connection to dispose itself after being used once.\n     * @returns This instance, for chaining.\n     */\n    public function once ()\n    {\n        stayInList = false;\n        return this;\n    }\n\n    /**\n     * Disconnects the listener from the signal.\n     */\n    public function dispose ()\n    {\n        if (_signal != null) {\n            _signal.disconnect(this);\n            _signal = null;\n        }\n    }\n\n    @:allow(flambe) var _next :SignalConnection = null;\n\n    @:allow(flambe) var _listener :Dynamic;\n    private var _signal :SignalBase;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\nclass SignalBase\n{\n    private function new (listener :Dynamic)\n    {\n        _head = (listener != null) ? new SignalConnection(this, listener) : null;\n        _deferredTasks = null;\n    }\n\n    /**\n     * Whether this signal has at least one listener.\n     */\n    inline public function hasListeners () :Bool\n    {\n        return _head != null;\n    }\n\n    private function connectImpl (listener :Dynamic, prioritize :Bool) :SignalConnection\n    {\n        var conn = new SignalConnection(this, listener);\n        if (dispatching()) {\n            defer(function () {\n                listAdd(conn, prioritize);\n            });\n        } else {\n            listAdd(conn, prioritize);\n        }\n        return conn;\n    }\n\n    @:allow(flambe) function disconnect (conn :SignalConnection)\n    {\n        if (dispatching()) {\n            defer(function () {\n                listRemove(conn);\n            });\n        } else {\n            listRemove(conn);\n        }\n    }\n\n    private function defer (fn :Void->Void)\n    {\n        var tail = null, p = _deferredTasks;\n        while (p != null) {\n            tail = p;\n            p = p.next;\n        }\n\n        var task = new Task(fn);\n        if (tail != null) {\n            tail.next = task;\n        } else {\n            _deferredTasks = task;\n        }\n    }\n\n    private function willEmit () :SignalConnection\n    {\n        // Should never happen, since the public emit methods will defer, but just in case...\n        Assert.that(!dispatching());\n\n        var snapshot = _head;\n        _head = DISPATCHING_SENTINEL;\n        return snapshot;\n    }\n\n    private function didEmit (head :SignalConnection)\n    {\n        _head = head;\n\n        var snapshot = _deferredTasks;\n        _deferredTasks = null;\n        while (snapshot != null) {\n            snapshot.fn();\n            snapshot = snapshot.next;\n        }\n    }\n\n    private function listAdd (conn :SignalConnection, prioritize :Bool)\n    {\n        if (prioritize) {\n            // Prepend it to the beginning of the list\n            conn._next = _head;\n            _head = conn;\n        } else {\n            // Append it to the end of the list\n            var tail = null, p = _head;\n            while (p != null) {\n                tail = p;\n                p = p._next;\n            }\n            if (tail != null) {\n                tail._next = conn;\n            } else {\n                _head = conn;\n            }\n        }\n    }\n\n    private function listRemove (conn :SignalConnection)\n    {\n        var prev :SignalConnection = null, p = _head;\n        while (p != null) {\n            if (p == conn) {\n                // Splice out p\n                var next = p._next;\n                if (prev == null) {\n                    _head = next;\n                } else {\n                    prev._next = next;\n                }\n                return;\n            }\n            prev = p;\n            p = p._next;\n        }\n    }\n\n    inline private function dispatching () :Bool\n    {\n        return _head == DISPATCHING_SENTINEL;\n    }\n\n    private static var DISPATCHING_SENTINEL = new SignalConnection(null, null);\n\n    private var _head :SignalConnection;\n    private var _deferredTasks :Task;\n}\n\nprivate class Task\n{\n    public var fn :Void->Void;\n    public var next :Task = null;\n\n    public function new (fn :Void->Void)\n    {\n        this.fn = fn;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * An alias for Signal2 listeners.\n */\ntypedef Listener2<A,B> = A -> B -> Void;\n\n/**\n * A two-argument signal. See Signal0 and Signal1 for different arities.\n */\nclass Signal2<A,B> extends SignalBase\n{\n    /**\n     * @param listener An optional listener to immediately connect to the signal.\n     */\n    public function new (?listener :Listener2<A,B>)\n    {\n        super(listener);\n    }\n\n    /**\n     * Connects a listener to this signal.\n     * @param prioritize True if this listener should fire before others.\n     * @returns A SignalConnection, that can be disposed to remove the listener.\n     */\n    public function connect (listener :Listener2<A,B>, prioritize :Bool = false) :SignalConnection\n    {\n        return connectImpl(listener, prioritize);\n    }\n\n    /**\n     * Emit the signal, notifying each connected listener.\n     */\n    public function emit (arg1 :A, arg2 :B)\n    {\n        if (dispatching()) {\n            defer(function () {\n                emitImpl(arg1, arg2);\n            });\n        } else {\n            emitImpl(arg1, arg2);\n        }\n    }\n\n    private function emitImpl (arg1 :A, arg2 :B)\n    {\n        var head = willEmit();\n        var p = head;\n        while (p != null) {\n            p._listener(arg1, arg2);\n            if (!p.stayInList) {\n                p.dispose();\n            }\n            p = p._next;\n        }\n        didEmit(head);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * An alias for Signal1 listeners.\n */\ntypedef Listener1<A> = A -> Void;\n\n/**\n * A one-argument signal. See Signal0 and Signal2 for different arities.\n */\nclass Signal1<A> extends SignalBase\n{\n    /**\n     * @param listener An optional listener to immediately connect to the signal.\n     */\n    public function new (?listener :Listener1<A>)\n    {\n        super(listener);\n    }\n\n    /**\n     * Connects a listener to this signal.\n     * @param prioritize True if this listener should fire before others.\n     * @returns A SignalConnection, that can be disposed to remove the listener.\n     */\n    public function connect (listener :Listener1<A>, prioritize :Bool = false) :SignalConnection\n    {\n        return connectImpl(listener, prioritize);\n    }\n\n    /**\n     * Emit the signal, notifying each connected listener.\n     */\n    public function emit (arg1 :A)\n    {\n        if (dispatching()) {\n            defer(function () {\n                emitImpl(arg1);\n            });\n        } else {\n            emitImpl(arg1);\n        }\n    }\n\n    private function emitImpl (arg1 :A)\n    {\n        var head = willEmit();\n        var p = head;\n        while (p != null) {\n            p._listener(arg1);\n            if (!p.stayInList) {\n                p.dispose();\n            }\n            p = p._next;\n        }\n        didEmit(head);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.animation;\n\nimport flambe.animation.Binding;\nimport flambe.animation.Ease;\nimport flambe.util.Signal2;\nimport flambe.util.Value;\n\n/**\n * A Float value that may be animated over time.\n */\nclass AnimatedFloat extends Value<Float>\n{\n    /**\n     * The behavior that is currently animating the value, or null if the value is not being\n     * animated.\n     */\n    public var behavior (get, set) :Behavior;\n\n    public function new (value :Float, ?listener :Listener2<Float,Float>)\n    {\n        super(value, listener);\n    }\n\n    override private function set__ (value :Float) :Float\n    {\n        _behavior = null;\n        return super.set__(value);\n    }\n\n    public function update (dt :Float)\n    {\n        if (_behavior != null) {\n            super.set__(_behavior.update(dt));\n            if (_behavior.isComplete()) {\n                _behavior = null;\n            }\n        }\n    }\n\n    /**\n     * Animates between the two given values.\n     *\n     * @param from The initial value.\n     * @param to The target value.\n     * @param seconds The animation duration, in seconds.\n     * @param easing The easing function to use, defaults to `Ease.linear`.\n     */\n    public function animate (from :Float, to :Float, seconds :Float, ?easing :EaseFunction)\n    {\n        set__(from);\n        animateTo(to, seconds, easing);\n    }\n\n    /**\n     * Animates between the current value and the given value.\n     *\n     * @param to The target value.\n     * @param seconds The animation duration, in seconds.\n     * @param easing The easing function to use, defaults to `Ease.linear`.\n     */\n    public function animateTo (to :Float, seconds :Float, ?easing :EaseFunction)\n    {\n        behavior = new Tween(_value, to, seconds, easing);\n    }\n\n    /**\n     * Animates the current value by the given delta.\n     *\n     * @param by The delta added to the current value to get the target value.\n     * @param seconds The animation duration, in seconds.\n     * @param easing The easing function to use, defaults to `Ease.linear`.\n     */\n    public function animateBy (by :Float, seconds :Float, ?easing :EaseFunction)\n    {\n        behavior = new Tween(_value, _value + by, seconds, easing);\n    }\n\n    inline public function bindTo (to :Value<Float>, ?fn :BindingFunction)\n    {\n        behavior = new Binding(to, fn);\n    }\n\n    private function set_behavior (behavior :Behavior) :Behavior\n    {\n        _behavior = behavior;\n        update(0);\n        return behavior;\n    }\n\n    inline private function get_behavior () :Behavior\n    {\n        return _behavior;\n    }\n\n    private var _behavior :Behavior = null;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe;\n\nimport flambe.animation.AnimatedFloat;\nimport flambe.asset.AssetPack;\nimport flambe.asset.Manifest;\nimport flambe.display.Texture;\nimport flambe.platform.Platform;\nimport flambe.subsystem.ExternalSystem; // IDEA doesn't support wildcard imports\nimport flambe.subsystem.KeyboardSystem;\nimport flambe.subsystem.MotionSystem;\nimport flambe.subsystem.MouseSystem;\nimport flambe.subsystem.PointerSystem;\nimport flambe.subsystem.RendererSystem;\nimport flambe.subsystem.StageSystem;\nimport flambe.subsystem.StorageSystem;\nimport flambe.subsystem.TouchSystem;\nimport flambe.subsystem.WebSystem;\nimport flambe.util.Assert;\nimport flambe.util.Logger;\nimport flambe.util.Promise;\nimport flambe.util.Signal1;\nimport flambe.util.Value;\n\n/**\n * Provides access to all the different subsystems implemented on each platform.\n */\nclass System\n{\n    /**\n     * The entity at the root of the hierarchy.\n     */\n    public static var root (default, null) :Entity = new Entity();\n\n    /**\n     * The Stage subsystem, for controlling the display viewport.\n     */\n    public static var stage (get, null) :StageSystem;\n\n    /**\n     * The Storage subsystem, for persisting values.\n     */\n    public static var storage (get, null) :StorageSystem;\n\n    /**\n     * The Pointer subsystem, for unified mouse/touch events.\n     */\n    public static var pointer (get, null) :PointerSystem;\n\n    /**\n     * The Mouse subsystem, for direct access to the mouse.\n     */\n    public static var mouse (get, null) :MouseSystem;\n\n    /**\n     * The Touch subsystem, for direct access to the multi-touch.\n     */\n    public static var touch (get, null) :TouchSystem;\n\n    /**\n     * The Keyboard subsystem, for keyboard events.\n     */\n    public static var keyboard (get, null) :KeyboardSystem;\n\n    /**\n     * The Web subsystem, for using the device's web browser.\n     */\n    public static var web (get, null) :WebSystem;\n\n    /**\n     * The External subsystem, for interaction with external code.\n     */\n    public static var external (get, null) :ExternalSystem;\n\n    /**\n     * The Motion subsystem, for events from the device's motion sensors.\n     */\n    public static var motion (get, null) :MotionSystem;\n\n    /**\n     * The Renderer subsystem, for creating textures and accessing the GPU.\n     */\n    public static var renderer (get, null) :RendererSystem<\n#if flash\n        flash.display.BitmapData\n#elseif js\n        js.html.Element\n#end\n    >;\n\n    // TODO(bruno): Subsystems for gamepads, haptic, geolocation, video, textInput\n\n    /**\n     * Gets the RFC 4646 language tag of the environment. For example, \"en-US\", \"pt\", or null if the\n     * locale is unknown.\n     */\n    public static var locale (get, null) :String;\n\n    /**\n     * Emitted when an uncaught exception occurs, if the platform supports it.\n     */\n    public static var uncaughtError (default, null) :Signal1<String> = new Signal1<String>();\n\n    /**\n     * True when the app is not currently visible, such as when minimized or placed in a background\n     * browser tab. While hidden, frame updates may be paused or throttled.\n     */\n    public static var hidden (default, null) :Value<Bool> = new Value<Bool>(false);\n\n    /**\n     * Gets the current clock time, in <b>seconds</b> since January 1, 1970. Depending on the\n     * platform, this may be slightly more efficient than Date.now().getTime().\n     */\n    public static var time (get, null) :Float;\n\n    /**\n     * The global volume applied to all sounds, defaults to 1.\n     */\n    public static var volume (default, null) :AnimatedFloat = new AnimatedFloat(1);\n\n    /**\n     * Starts up Flambe, this should usually be the first thing a game does.\n     */\n    public static function init ()\n    {\n        if (!_calledInit) {\n            _platform.init();\n            _calledInit = true;\n        }\n    }\n\n    /**\n     * Request to load an asset pack described by the given manifest.\n     */\n    inline public static function loadAssetPack (manifest :Manifest) :Promise<AssetPack>\n    {\n        #if debug assertCalledInit(); #end\n        return _platform.loadAssetPack(manifest);\n    }\n\n    /**\n     * Creates a Logger for printing debug messages. In Flash, this uses the native trace()\n     * function. In JS, logging goes to the console object. Logging is stripped from non-debug\n     * builds.\n     */\n    inline public static function createLogger (tag :String) :Logger\n    {\n        // No need to assertCalledInit here, this should be callable from static initializers\n        return new Logger(_platform.createLogHandler(tag));\n    }\n\n    inline private static function get_time () :Float\n    {\n        #if debug assertCalledInit(); #end\n        return _platform.getTime();\n    }\n\n    inline private static function get_stage () :StageSystem\n    {\n        #if debug assertCalledInit(); #end\n        return _platform.getStage();\n    }\n\n    inline private static function get_storage () :StorageSystem\n    {\n        #if debug assertCalledInit(); #end\n        return _platform.getStorage();\n    }\n\n    inline private static function get_pointer () :PointerSystem\n    {\n        #if debug assertCalledInit(); #end\n        return _platform.getPointer();\n    }\n\n    inline private static function get_mouse () :MouseSystem\n    {\n        #if debug assertCalledInit(); #end\n        return _platform.getMouse();\n    }\n\n    inline private static function get_touch () :TouchSystem\n    {\n        #if debug assertCalledInit(); #end\n        return _platform.getTouch();\n    }\n\n    inline private static function get_keyboard () :KeyboardSystem\n    {\n        #if debug assertCalledInit(); #end\n        return _platform.getKeyboard();\n    }\n\n    inline private static function get_web () :WebSystem\n    {\n        #if debug assertCalledInit(); #end\n        return _platform.getWeb();\n    }\n\n    inline private static function get_external () :ExternalSystem\n    {\n        #if debug assertCalledInit(); #end\n        return _platform.getExternal();\n    }\n\n    inline private static function get_locale () :String\n    {\n        #if debug assertCalledInit(); #end\n        return _platform.getLocale();\n    }\n\n    inline static function get_motion () :MotionSystem\n    {\n        #if debug assertCalledInit(); #end\n        return _platform.getMotion();\n    }\n\n    inline static function get_renderer () // inferred return type\n    {\n        #if debug assertCalledInit(); #end\n        return cast _platform.getRenderer();\n    }\n\n    private static function assertCalledInit ()\n    {\n        Assert.that(_calledInit, \"You must call System.init() first\");\n    }\n\n    private static var _platform :Platform =\n#if flash\n        flambe.platform.flash.FlashPlatform.instance;\n#elseif (html || firefox)\n        flambe.platform.html.HtmlPlatform.instance;\n#else\n        null;\n#end\n\n    private static var _calledInit = false;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\nusing flambe.util.Strings;\n\n/**\n * Represents the severity of a log message.\n */\nenum LogLevel {\n    /** General helpful information. */\n    Info;\n\n    /** An unexpected but recoverable problem. */\n    Warn;\n\n    /** A fatal, unrecoverable problem. */\n    Error;\n}\n\ninterface LogHandler\n{\n    function log (level :LogLevel, message :String) :Void;\n}\n\n/**\n * A logging system, for printing formatted debug messages. Logging is stripped from release builds,\n * unless the `-D flambe_keep_logs` compiler flag is used.\n *\n * ```haxe\n * var log = System.createLogger(\"mygame\");\n * log.info(\"Player logged in\", [\"name\", \"Joe\", \"level\", 24]);\n * // Logs \"INFO mygame: Player logged in [name=Joe, level=24]\"\n * ```\n *\n * See `PackageLog` for a handy way to setup logging across a whole project.\n */\nclass Logger\n{\n    /**\n     * @param handler The handler that logs will be sent to for printing.\n     */\n    public function new (handler :LogHandler)\n    {\n        _handler = handler;\n    }\n\n#if (debug || flambe_keep_logs)\n    /**\n     * Logs a message at the `Info` severity level.\n     *\n     * @param text The message to log.\n     * @param fields Extra information to be formatted with `Strings.withFields`.\n     */\n    public function info (?text :String, ?fields :Array<Dynamic>)\n    {\n        log(Info, text, fields);\n    }\n\n    /**\n     * Logs a message at the `Warn` severity level.\n     *\n     * @param text The message to log.\n     * @param fields Extra information to be formatted with `Strings.withFields`.\n     */\n    public function warn (?text :String, ?fields :Array<Dynamic>)\n    {\n        log(Warn, text, fields);\n    }\n\n    /**\n     * Logs a message at the `Error` severity level.\n     *\n     * @param text The message to log.\n     * @param fields Extra information to be formatted with `Strings.withFields`.\n     */\n    public function error (?text :String, ?fields :Array<Dynamic>)\n    {\n        log(Error, text, fields);\n    }\n\n    /**\n     * Logs a message at the given severity level.\n     *\n     * @param level The severity of the log message.\n     * @param text The message to log.\n     * @param fields Extra information to be formatted with `Strings.withFields`.\n     */\n    public function log (level :LogLevel, ?text :String, ?fields :Array<Dynamic>)\n    {\n        if (_handler == null) {\n            return; // No handler, carry on quietly\n        }\n        if (text == null) {\n            text = \"\";\n        }\n        if (fields != null) {\n            text = text.withFields(fields);\n        }\n        _handler.log(level, text);\n    }\n\n#else\n    // In release builds, logging calls are stripped out\n    inline public function info (?text :String, ?fields :Array<Dynamic>) {}\n    inline public function warn (?text :String, ?fields :Array<Dynamic>) {}\n    inline public function error (?text :String, ?fields :Array<Dynamic>) {}\n    inline public function log (level :LogLevel, ?text :String, ?fields :Array<Dynamic>) {}\n#end\n\n    private var _handler :LogHandler;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n#if macro\nimport haxe.macro.Context;\nimport haxe.macro.Expr;\nimport haxe.macro.Type;\n\nimport flambe.util.Logger;\n\n#else\n\n/**\n * Classes that extend PackageLog will have static logging methods generated for them. The methods\n * correspond to the methods in `Logger`.\n *\n * Creating a class that extends PackageLog at the base of your project is a convenient way to\n * include logging across a whole codebase. The package name is used as the log tag.\n *\n * ```haxe\n * // In src/foobar/Log.hx\n * class Log extends PackageLog {}\n *\n * // In src/foobar/something/deeper/Widget.hx\n * // (Importing foobar.Log is not needed, as Haxe automatically imports classes in parent directories)\n * Log.info(\"Hello world\"); // Logs \"foobar: Hello world\"\n * ```\n */\n@:autoBuild(flambe.util.PackageLog.build())\n#end\nclass PackageLog\n{\n#if macro\n    public static function build () :Array<Field>\n    {\n        var pos = Context.currentPos();\n        var cl = Context.getLocalClass().get();\n\n        var tag = Context.makeExpr(cl.pack.join(\".\"), pos);\n        var logger = Context.defined(\"flambe-server\")\n            ? macro flambe.server.Node.createLogger($tag)\n            : macro flambe.System.createLogger($tag);\n\n        return Macros.buildFields(macro {\n            var public__static__logger :flambe.util.Logger = $logger;\n\n            function inline__public__static__info (?text :String, ?args :Array<Dynamic>) {\n                logger.info(text, args);\n            }\n\n            function inline__public__static__warn (?text :String, ?args :Array<Dynamic>) {\n                logger.warn(text, args);\n            }\n\n            function inline__public__static__error (?text :String, ?args :Array<Dynamic>) {\n                logger.error(text, args);\n            }\n\n            function inline__public__static__log (level :flambe.util.Logger.LogLevel,\n                    ?text :String, ?args :Array<Dynamic>) {\n                logger.log(level, text, args);\n            }\n        }).concat(Context.getBuildFields());\n    }\n#end\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe;\n\nimport flambe.animation.AnimatedFloat;\n\n/**\n * Adjusts the update speed of an entity (and its components and children). Can be used for slow\n * motion and fast forward effects.\n */\nclass SpeedAdjuster extends Component\n{\n    /**\n     * The scale that time should pass for the owning entity and its children. Values lower than\n     * 1.0 will play slower than realtime, and values higher than 1.0 will play faster. When the\n     * scale is 0, the entity is basically paused.\n     */\n    public var scale (default, null) :AnimatedFloat;\n\n    public function new (scale :Float = 1)\n    {\n        this.scale = new AnimatedFloat(scale);\n    }\n\n    // Note that this may be called by MainLoop before onStarted!\n    override public function onUpdate (dt :Float)\n    {\n        // Ensure this component is immune to its own time scaling\n        if (_realDt > 0) {\n            dt = _realDt;\n            _realDt = 0;\n        }\n\n        scale.update(dt);\n    }\n\n    @:allow(flambe) var _realDt :Float = 0;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport haxe.macro.Expr;\nimport haxe.macro.Context;\nimport haxe.macro.Type;\n\nimport flambe.util.Macros;\n\nusing Lambda;\nusing flambe.util.Iterables;\n\nclass ComponentBuilder\n{\n    public static function build () :Array<Field>\n    {\n        var pos = Context.currentPos();\n        var cl = Context.getLocalClass().get();\n\n        var name = Context.makeExpr(getComponentName(cl), pos);\n        var componentType = TPath({pack: cl.pack, name: cl.name, params: []});\n\n        var fields = Macros.buildFields(macro {\n            #if doc @:noDoc #end\n            var public__static__inline__NAME = $name;\n        });\n\n        // Only override get_name if this component directly extends a @:componentBase and creates a\n        // new namespace\n        if (extendsComponentBase(cl)) {\n            fields = fields.concat(Macros.buildFields(macro {\n                function override__private__get_name () :String {\n                    return $name;\n                }\n            }));\n        }\n\n        return fields.concat(Context.getBuildFields());\n    }\n\n    private static function getComponentName (cl :ClassType) :String\n    {\n        // Traverse up to the last non-component base\n        while (true) {\n            if (extendsComponentBase(cl)) {\n                break;\n            }\n            cl = cl.superClass.t.get();\n        }\n\n        // Look up the ID, otherwise generate one\n        var fullName = cl.pack.concat([cl.name]).join(\".\");\n        var name = _nameCache.get(fullName);\n        if (name == null) {\n            name = cl.name + \"_\" + _nextId;\n            _nameCache.set(fullName, name);\n            ++_nextId;\n        }\n\n        return name;\n    }\n\n    private static function extendsComponentBase (cl :ClassType)\n    {\n        var superClass = cl.superClass.t.get();\n        return superClass.meta.has(\":componentBase\");\n    }\n\n    private static var _nameCache = new Map<String,String>();\n    private static var _nextId = 0;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.asset;\n\nusing flambe.util.Strings;\n\n/** Specifies all supported asset formats across all Flambe platforms. */\nenum AssetFormat\n{\n    // Images\n    WEBP; JXR; PNG; JPG; GIF;\n\n    // Compressed textures\n    DDS; PVR; PKM;\n\n    // Audio\n    MP3; M4A; OPUS; OGG; WAV;\n\n    // Raw text/data\n    Data;\n}\n\n/**\n * Defines an asset that will be loaded.\n */\nclass AssetEntry\n{\n    /**\n     * The name of this asset.\n     */\n    public var name (default, null) :String;\n\n    /**\n     * The URL or file path this asset will be loaded from. Will be appended to `Manifest.localBase`\n     * or `Manifest.remoteBase` to get the actual URL to load from.\n     */\n    public var url (default, null) :String;\n\n    /**\n     * The format this asset will be loaded as.\n     */\n    public var format (default, null) :AssetFormat;\n\n    /**\n     * The size of this asset in bytes, or 0 if unknown.\n     */\n    public var bytes (default, null) :Int;\n\n    public function new (name :String, url :String, format :AssetFormat, bytes :Int)\n    {\n        this.name = name;\n        this.url = url;\n        this.format = format;\n        this.bytes = bytes;\n    }\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage js;\n\nimport js.html.Storage;\nimport js.html.XMLHttpRequest;\n\nclass Browser {\n\tpublic static var window(get, never):js.html.DOMWindow;\n\tinline static function get_window() return untyped __js__(\"window\");\n\n\tpublic static var document(get, never):js.html.Document;\n\tinline static function get_document() return untyped __js__(\"window.document\");\n\n\tpublic static var location(get, never):js.html.Location;\n\tinline static function get_location() return untyped __js__(\"window.location\");\n\n\tpublic static var navigator(get, never):js.html.Navigator;\n\tinline static function get_navigator() return untyped __js__(\"window.navigator\");\n\n\t/**\n\t * True if a window object exists, false otherwise.\n\t *\n\t * This can be used to check if the code is being executed in a non-browser\n\t * environment such as node.js.\n\t */\n\tpublic static var supported(get, never):Bool;\n\tpublic static function get_supported() return untyped __js__(\"typeof window != \\\"undefined\\\"\");\n\n\t/**\n\t * Safely gets the browser's local storage, or returns null if localStorage is unsupported or\n\t * disabled.\n\t */\n\tpublic static function getLocalStorage() : Storage\n\t{\n\t\ttry {\n\t\t\tvar s = window.localStorage;\n\t\t\ts.getItem(\"\");\n\t\t\treturn s;\n\t\t} catch( e : Dynamic ) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Safely gets the browser's session storage, or returns null if sessionStorage is unsupported\n\t * or disabled.\n\t */\n\tpublic static function getSessionStorage() : Storage\n\t{\n\t\ttry {\n\t\t\tvar s = window.sessionStorage;\n\t\t\ts.getItem(\"\");\n\t\t\treturn s;\n\t\t} catch( e : Dynamic ) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Creates an XMLHttpRequest, with a fallback to ActiveXObject for ancient versions of Internet\n\t * Explorer.\n\t */\n\tpublic static function createXMLHttpRequest() : XMLHttpRequest\n\t{\n\t\tif( untyped __js__(\"typeof XMLHttpRequest\") != \"undefined\" ) {\n\t\t\treturn new XMLHttpRequest();\n\t\t}\n\t\tif( untyped __js__(\"typeof ActiveXObject\") != \"undefined\" ) {\n\t\t\treturn untyped __new__(\"ActiveXObject\",\"Microsoft.XMLHTTP\");\n\t\t}\n\t\tthrow \"Unable to create XMLHttpRequest object.\";\n\t}\n\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.asset;\n\nimport haxe.rtti.Meta;\n\nimport flambe.asset.AssetEntry;\nimport flambe.util.Assert;\n\nusing StringTools;\nusing flambe.util.Strings;\n\n/**\n * An asset manifest contains all the information needed to load an asset pack. A manifest is\n * usually created with `Manifest.fromAssets(\"directory\")`, but manifests can also be assembled\n * programmatically.\n */\nclass Manifest\n{\n    /**\n     * A base path on the current domain to load this manifest's assets from, or null.\n     */\n    public var localBase (get, set) :String;\n\n    /**\n     * A base URL on another domain to load this manifest's assets from, or null. May be used to\n     * load assets from a CDN, in browsers that support cross-domain requests. If not supported or\n     * unset, will fallback to using localBase.\n     */\n    public var remoteBase (get, set) :String;\n\n    public function new ()\n    {\n        _entries = [];\n    }\n\n    /**\n     * Gets the manifest of a pack in the asset directory, that was processed at build-time.\n     * @param packName The folder name in your assets/ directory.\n     * @param required When true and this pack was not found, throw an error. Otherwise null is\n     *   returned.\n     */\n    public static function fromAssets (packName :String, required :Bool = true) :Manifest\n    {\n        var packData :Array<Dynamic> = Reflect.field(Meta.getType(Manifest).assets[0], packName);\n        if (packData == null) {\n            if (required) {\n                throw \"Missing asset pack\".withFields([\"name\", packName]);\n            }\n            return null;\n        }\n\n        var manifest = new Manifest();\n        manifest.localBase = \"assets\";\n\n        for (asset in packData) {\n            var name = asset.name;\n            var path = packName + \"/\" + name + \"?v=\" + asset.md5;\n\n            var format = inferFormat(name);\n            if (format != Data) {\n                // If this an asset that not all platforms may support, trim the extension from\n                // the name. We'll only load one of the assets if this creates a name collision.\n                name = name.removeFileExtension();\n            }\n\n            manifest.add(name, path, asset.bytes, format);\n        }\n\n        return manifest;\n    }\n\n    /**\n     * Tries to find a pack suffixed with the closest available variant of the locale. For example,\n     * fromAssetsLocalized(\"foo\", \"pt-BR\") will first try to load foo_pt-BR, then foo_pt, then just\n     * foo.\n     * @param packName The folder name in your assets/ directory.\n     * @param locale An RFC 4646 language tag, or null to use the system language.\n     * @param required When true and this pack was not found, throw an error. Otherwise null is\n     *   returned.\n     */\n    public static function fromAssetsLocalized (\n        packName :String, locale :String = null, required :Bool = true) :Manifest\n    {\n        if (locale == null) {\n            locale = System.locale;\n        }\n\n        if (locale != null) {\n            var parts = locale.split(\"-\");\n            while (parts.length > 0) {\n                var manifest = fromAssets(packName + \"_\" + parts.join(\"-\"), false);\n                if (manifest != null) {\n                    return manifest;\n                }\n                parts.pop();\n            }\n        }\n        return fromAssets(packName, required);\n    }\n\n    /**\n     * Returns true if the given named pack was included in the asset directory at build-time.\n     */\n    public static function exists (packName :String) :Bool\n    {\n        return Reflect.hasField(Meta.getType(Manifest).assets[0], packName);\n    }\n\n    /**\n     * Adds an asset entry to this manifest.\n     * @param name The name of the asset.\n     * @param url The URL this asset will be downloaded from.\n     * @param bytes The size in bytes.\n     * @param format Optionally specified content format, by default infer it from the URL.\n     */\n    public function add (name :String, url :String, bytes :Int = 0, ?format :AssetFormat) :AssetEntry\n    {\n        if (format == null) {\n            format = inferFormat(url);\n        }\n\n        var entry = new AssetEntry(name, url, format, bytes);\n        _entries.push(entry);\n        return entry;\n    }\n\n    /**\n     * Iterates over all the assets defined in this manifest.\n     */\n    inline public function iterator () :Iterator<AssetEntry>\n    {\n        return _entries.iterator();\n    }\n\n    /**\n     * Creates a copy of this manifest.\n     */\n    public function clone () :Manifest\n    {\n        var copy = new Manifest();\n        copy.localBase = localBase;\n        copy.remoteBase = remoteBase;\n        copy._entries = _entries.copy();\n        return copy;\n    }\n\n    /**\n     * Get the full URL to load an asset from. Will prepend localBase or remoteBase depending on\n     * cross-domain support.\n     */\n    public function getFullURL (entry :AssetEntry) :String\n    {\n        var basePath = (remoteBase != null && _supportsCrossOrigin) ? remoteBase : localBase;\n        return (basePath != null) ? basePath.joinPath(entry.url) : entry.url;\n    }\n\n    private function get_localBase () :String\n    {\n        return _localBase;\n    }\n\n    private function set_localBase (localBase :String) :String\n    {\n        if (localBase != null) {\n            Assert.that(!localBase.startsWith(\"http://\") && !localBase.startsWith(\"https://\"),\n                \"localBase must be a path on the same domain, NOT starting with http(s)://\");\n        }\n        return _localBase = localBase;\n    }\n\n    private function get_remoteBase () :String\n    {\n        return _remoteBase;\n    }\n\n    private function set_remoteBase (remoteBase :String) :String\n    {\n        if (remoteBase != null) {\n            Assert.that(remoteBase.startsWith(\"http://\") || remoteBase.startsWith(\"https://\"),\n                \"remoteBase must be on a remote domain, starting with http(s)://\");\n        }\n        return _remoteBase = remoteBase;\n    }\n\n    private static function inferFormat (url :String) :AssetFormat\n    {\n        var extension = url.getUrlExtension();\n        if (extension != null) {\n            switch (extension.toLowerCase()) {\n                case \"gif\": return GIF;\n                case \"jpg\", \"jpeg\": return JPG;\n                case \"jxr\", \"wdp\": return JXR;\n                case \"png\": return PNG;\n                case \"webp\": return WEBP;\n\n                case \"dds\": return DDS;\n                case \"pvr\": return PVR;\n                case \"pkm\": return PKM;\n\n                case \"m4a\": return M4A;\n                case \"mp3\": return MP3;\n                case \"ogg\": return OGG;\n                case \"opus\": return OPUS;\n                case \"wav\": return WAV;\n            }\n        } else {\n            Log.warn(\"No file extension for asset, it will be loaded as data\", [\"url\", url]);\n        }\n        return Data;\n    }\n\n    // Whether the environment fully supports loading assets from another domain\n    private static var _supportsCrossOrigin :Bool = (function () {\n        var detected =\n#if html\n        (function () {\n            // CORS in the stock Android browser is buggy. If your game is contained in an iframe, XHR\n            // will work the first time. If the response had an Expires header, on subsequent page loads\n            // instead of retrieving it from the cache, it will fail with error code 0.\n            // http://stackoverflow.com/questions/6090816/android-cors-requests-work-only-once\n            if (js.Browser.navigator.userAgent.indexOf(\"Linux; U; Android\") >= 0) {\n                return false;\n            }\n\n            var xhr :Dynamic = untyped __new__(\"XMLHttpRequest\");\n            return (xhr.withCredentials != null);\n        })();\n#else\n            true; // Assumes you have a valid crossdomain.xml\n#end\n        if (!detected) {\n            Log.warn(\"This browser does not support cross-domain asset loading, any Manifest.remoteBase setting will be ignored.\");\n        }\n        return detected;\n    })();\n\n    private var _entries :Array<AssetEntry>;\n\n    private var _localBase :String = null;\n    private var _remoteBase :String = null;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.math;\n\n/**\n * A 2D point or vector.\n */\nclass Point\n{\n    public var x :Float;\n    public var y :Float;\n\n    public function new (x :Float = 0, y :Float = 0)\n    {\n        this.x = x;\n        this.y = y;\n    }\n\n    /**\n     * Re-assign the coordinates of this point.\n     */\n    public function set (x :Float, y :Float)\n    {\n        this.x = x;\n        this.y = y;\n    }\n\n    /**\n     * Normalize this vector, so that its new magnitude is 1.\n     */\n    public function normalize ()\n    {\n        var m = magnitude();\n        x /= m;\n        y /= m;\n    }\n\n    /**\n     * The dot product of two vectors.\n     */\n    public function dot (x :Float, y :Float) :Float\n    {\n        return this.x*x + this.y*y;\n    }\n\n    /**\n     * Scales a vector's magnitude by a given value.\n     */\n    public function multiply (n :Float)\n    {\n        x *= n;\n        y *= n;\n    }\n\n    /**\n     * The magnitude (length) of this vector.\n     */\n    public function magnitude () :Float\n    {\n        return Math.sqrt(x*x + y*y);\n    }\n\n    /**\n     * The distance between this point and another point.\n     */\n    public function distanceTo (x :Float, y :Float) :Float\n    {\n        return Math.sqrt(distanceToSquared(x, y));\n    }\n\n    /**\n     * The squared distance between this point and another point. This is a faster operation than\n     * distanceTo.\n     */\n    public function distanceToSquared (x :Float, y :Float) :Float\n    {\n        var dx = this.x-x;\n        var dy = this.y-y;\n        return dx*dx + dy*dy;\n    }\n\n    /**\n     * Creates a copy of this point.\n     */\n    public function clone (?result :Point) :Point\n    {\n        if (result == null) {\n            return new Point(x, y);\n        }\n        result.set(x, y);\n        return result;\n    }\n\n    public function equals (other :Point) :Bool\n    {\n        return x == other.x && y == other.y;\n    }\n\n    #if debug @:keep #end public function toString () :String\n    {\n        return \"(\" + x + \",\" + y + \")\";\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.display;\n\nimport flambe.animation.AnimatedFloat;\nimport flambe.display.Sprite;\nimport flambe.input.PointerEvent;\nimport flambe.math.FMath;\nimport flambe.math.Matrix;\nimport flambe.math.Point;\nimport flambe.math.Rectangle;\nimport flambe.scene.Director;\nimport flambe.util.Signal1;\nimport flambe.util.SignalConnection;\nimport flambe.util.Value;\n\nusing flambe.util.BitSets;\n\nclass Sprite extends Component\n{\n    /**\n     * X position, in pixels.\n     */\n    public var x (default, null) :AnimatedFloat;\n\n    /**\n     * Y position, in pixels.\n     */\n    public var y (default, null) :AnimatedFloat;\n\n    /**\n     * Rotation angle, in degrees.\n     */\n    public var rotation (default, null) :AnimatedFloat;\n\n    /**\n     * Horizontal scale factor.\n     */\n    public var scaleX (default, null) :AnimatedFloat;\n\n    /**\n     * Vertical scale factor.\n     */\n    public var scaleY (default, null) :AnimatedFloat;\n\n    /**\n     * The X position of this sprite's anchor point. Local transformations are applied relative to\n     * this point.\n     */\n    public var anchorX (default, null) :AnimatedFloat;\n\n    /**\n     * The Y position of this sprite's anchor point. Local transformations are applied relative to\n     * this point.\n     */\n    public var anchorY (default, null) :AnimatedFloat;\n\n    /**\n     * The alpha (opacity) of this sprite, between 0 (invisible) and 1 (fully opaque).\n     */\n    public var alpha (default, null) :AnimatedFloat;\n\n    /**\n     * The blend mode used to draw this sprite, or null to use its parent's blend mode.\n     */\n    public var blendMode :BlendMode = null;\n\n    /**\n     * The scissor rectangle used for clipping/masking, in the local coordinate system. The scissor\n     * rectangle affects both rendering and hit testing, and applies to this sprite and all\n     * children. Rectangles with negative width or height are OK.\n     *\n     * __WARNING__: When using scissor testing, this sprite (and its parents) must not be rotated.\n     * The scissor rectangle must be axis-aligned when converted to screen coordinates.\n     */\n    public var scissor :Rectangle = null;\n\n    /**\n     * Whether this sprite should be drawn. Invisible sprites do not receive pointer events.\n     */\n    public var visible (get, set) :Bool;\n\n    /**\n     * Whether this sprite's position will be rounded to the nearest whole pixel when rendering, for\n     * crisper images. Defaults to true. This can be disabled for smoother animation, at the risk of\n     * fuzziness when an image lies on a subpixel.\n     */\n    public var pixelSnapping (get, set) :Bool;\n\n    /**\n     * Emitted when the pointer is pressed down over this sprite.\n     */\n    public var pointerDown (get, null) :Signal1<PointerEvent>;\n\n    /**\n     * Emitted when the pointer is moved over this sprite.\n     */\n    public var pointerMove (get, null) :Signal1<PointerEvent>;\n\n    /**\n     * Emitted when the pointer is raised over this sprite.\n     */\n    public var pointerUp (get, null) :Signal1<PointerEvent>;\n\n    /**\n     * Emitted when the pointer is moved inside of this sprite.\n     */\n    public var pointerIn (get, null) :Signal1<PointerEvent>;\n\n    /**\n     * Emitted when the pointer is moved outside of this sprite. If the pointer is a touch, also\n     * emitted when the touch is lifted from this sprite.\n     */\n    public var pointerOut (get, null) :Signal1<PointerEvent>;\n\n    /**\n     * Whether this sprite or any children should receive pointer events. Defaults to true.\n     */\n    public var pointerEnabled (get, set) :Bool;\n\n    public function new ()\n    {\n        _flags = _flags.add(VISIBLE | POINTER_ENABLED | VIEW_MATRIX_DIRTY | PIXEL_SNAPPING);\n        _localMatrix = new Matrix();\n\n        var dirtyMatrix = function (_,_) {\n            _flags = _flags.add(LOCAL_MATRIX_DIRTY | VIEW_MATRIX_DIRTY);\n        };\n        x = new AnimatedFloat(0, dirtyMatrix);\n        y = new AnimatedFloat(0, dirtyMatrix);\n        rotation = new AnimatedFloat(0, dirtyMatrix);\n        scaleX = new AnimatedFloat(1, dirtyMatrix);\n        scaleY = new AnimatedFloat(1, dirtyMatrix);\n        anchorX = new AnimatedFloat(0, dirtyMatrix);\n        anchorY = new AnimatedFloat(0, dirtyMatrix);\n\n        alpha = new AnimatedFloat(1);\n    }\n\n    /**\n     * Search for a sprite in the entity hierarchy lying under the given point, in local\n     * coordinates. Ignores sprites that are invisible or not pointerEnabled during traversal.\n     * Returns null if neither the entity or its children contain a sprite under the given point.\n     */\n    public static function hitTest (entity :Entity, x :Float, y :Float) :Sprite\n    {\n        var sprite = entity.get(Sprite);\n        if (sprite != null) {\n            if (!sprite._flags.containsAll(VISIBLE | POINTER_ENABLED)) {\n                return null; // Prune invisible or non-interactive subtrees\n            }\n            if (sprite.getLocalMatrix().inverseTransform(x, y, _scratchPoint)) {\n                x = _scratchPoint.x;\n                y = _scratchPoint.y;\n            }\n\n            var scissor = sprite.scissor;\n            if (scissor != null && !scissor.contains(x, y)) {\n                return null; // Prune if outside the scissor rectangle\n            }\n        }\n\n        // Hit test all children, front to back\n        var result = hitTestBackwards(entity.firstChild, x, y);\n        if (result != null) {\n            return result;\n        }\n\n        // Finally, if we got this far, hit test the actual sprite\n        return (sprite != null && sprite.containsLocal(x, y)) ? sprite : null;\n    }\n\n    /**\n     * Calculate the bounding box of an entity hierarchy. Returns the smallest rectangle in local\n     * coordinates that fully encloses all child sprites.\n     */\n    public static function getBounds (entity :Entity, ?result :Rectangle) :Rectangle\n    {\n        if (result == null) {\n            result = new Rectangle();\n        }\n\n        // The width and height of this rectangle are hijacked to store the bottom right corner\n        result.set(FMath.FLOAT_MAX, FMath.FLOAT_MAX, FMath.FLOAT_MIN, FMath.FLOAT_MIN);\n        getBoundsImpl(entity, null, result);\n\n        // Convert back to a true width and height\n        result.width -= result.x;\n        result.height -= result.y;\n        return result;\n    }\n\n    /**\n     * Renders an entity hierarchy to the given Graphics.\n     */\n    public static function render (entity :Entity, g :Graphics)\n    {\n        // Render this entity's sprite\n        var sprite = entity.get(Sprite);\n        if (sprite != null) {\n            var alpha = sprite.alpha._;\n            if (!sprite.visible || alpha <= 0) {\n                return; // Prune traversal, this sprite and all children are invisible\n            }\n\n            g.save();\n            if (alpha < 1) {\n                g.multiplyAlpha(alpha);\n            }\n            if (sprite.blendMode != null) {\n                g.setBlendMode(sprite.blendMode);\n            }\n            var matrix = sprite.getLocalMatrix();\n\n            var m02 = matrix.m02;\n            var m12 = matrix.m12;\n            if (sprite.pixelSnapping) {\n                // Snap the translation to the nearest whole pixel\n                m02 = Math.round(m02);\n                m12 = Math.round(m12);\n            }\n            g.transform(matrix.m00, matrix.m10, matrix.m01, matrix.m11, m02, m12);\n\n            var scissor = sprite.scissor;\n            if (scissor != null) {\n                g.applyScissor(scissor.x, scissor.y, scissor.width, scissor.height);\n            }\n\n            sprite.draw(g);\n        }\n\n        // Render any partially occluded director scenes\n        var director = entity.get(Director);\n        if (director != null) {\n            var scenes = director.occludedScenes;\n            for (scene in scenes) {\n                render(scene, g);\n            }\n        }\n\n        // Render all children\n        var p = entity.firstChild;\n        while (p != null) {\n            var next = p.next;\n            render(p, g);\n            p = next;\n        }\n\n        // If save() was called, unwind it\n        if (sprite != null) {\n            g.restore();\n        }\n    }\n\n    /**\n     * The \"natural\" width of this sprite, without any transformations being applied. Used for hit\n     * testing. This does not consider child sprites, use Sprite.getBounds for that.\n     */\n    public function getNaturalWidth () :Float\n    {\n        return 0;\n    }\n\n    /**\n     * The \"natural\" height of this sprite, without any transformations being applied. Used for hit\n     * testing. This does not consider child sprites, use Sprite.getBounds for that.\n     */\n    public function getNaturalHeight () :Float\n    {\n        return 0;\n    }\n\n    /**\n     * Returns true if the given point (in viewport/stage coordinates) lies inside this sprite.\n     */\n    public function contains (viewX :Float, viewY :Float) :Bool\n    {\n        return getViewMatrix().inverseTransform(viewX, viewY, _scratchPoint) &&\n            containsLocal(_scratchPoint.x, _scratchPoint.y);\n    }\n\n    /**\n     * Returns true if the given point (in local coordinates) lies inside this sprite.\n     */\n    public function containsLocal (localX :Float, localY :Float) :Bool\n    {\n        return localX >= 0 && localX < getNaturalWidth()\n            && localY >= 0 && localY < getNaturalHeight();\n    }\n\n    /**\n     * Returns the local transformation matrix, relative to the parent. This matrix may be modified\n     * to position the sprite, but any changes will be invalidated when the x, y, scaleX, scaleY,\n     * rotation, anchorX, or anchorY properties are updated.\n     */\n    public function getLocalMatrix () :Matrix\n    {\n        if (_flags.contains(LOCAL_MATRIX_DIRTY)) {\n            _flags = _flags.remove(LOCAL_MATRIX_DIRTY);\n\n            _localMatrix.compose(x._, y._, scaleX._, scaleY._, FMath.toRadians(rotation._));\n            _localMatrix.translate(-anchorX._, -anchorY._);\n        }\n        return _localMatrix;\n    }\n\n    /**\n     * Returns the view transformation matrix, relative to the root. Do NOT modify this matrix.\n     */\n    public function getViewMatrix () :Matrix\n    {\n        if (isViewMatrixDirty()) {\n            var parentSprite = getParentSprite();\n            _viewMatrix = (parentSprite != null)\n                ? Matrix.multiply(parentSprite.getViewMatrix(), getLocalMatrix(), _viewMatrix)\n                : getLocalMatrix().clone(_viewMatrix);\n\n            _flags = _flags.remove(VIEW_MATRIX_DIRTY);\n            if (parentSprite != null) {\n                _parentViewMatrixUpdateCount = parentSprite._viewMatrixUpdateCount;\n            }\n            ++_viewMatrixUpdateCount;\n        }\n        return _viewMatrix;\n    }\n\n    /**\n     * Chainable convenience method to set the anchor position.\n     * @returns This instance, for chaining.\n     */\n    public function setAnchor (x :Float, y :Float) :Sprite\n    {\n        anchorX._ = x;\n        anchorY._ = y;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to center the anchor using the natural width and height.\n     * @returns This instance, for chaining.\n     */\n    public function centerAnchor () :Sprite\n    {\n        anchorX._ = getNaturalWidth()/2;\n        anchorY._ = getNaturalHeight()/2;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to set the position.\n     * @returns This instance, for chaining.\n     */\n    public function setXY (x :Float, y :Float) :Sprite\n    {\n        this.x._ = x;\n        this.y._ = y;\n        return this;\n    }\n\t\n    /**\n     * Chainable convenience method to set the alpha.\n     * @returns This instance, for chaining.\n     */\n    public function setAlpha (alpha :Float) :Sprite\n    {\n        this.alpha._ = alpha;\n        return this;\n    }\n\t\n    /**\n     * Chainable convenience method to set the rotation.\n     * @returns This instance, for chaining.\n     */\n    public function setRotation (rotation :Float) :Sprite\n    {\n        this.rotation._ = rotation;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to uniformly set the scale.\n     * @returns This instance, for chaining.\n     */\n    public function setScale (scale :Float) :Sprite\n    {\n        scaleX._ = scale;\n        scaleY._ = scale;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to set the scale.\n     * @returns This instance, for chaining.\n     */\n    public function setScaleXY (scaleX :Float, scaleY :Float) :Sprite\n    {\n        this.scaleX._ = scaleX;\n        this.scaleY._ = scaleY;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to set the blendMode.\n     * @returns This instance, for chaining.\n     */\n    public function setBlendMode (blendMode :BlendMode) :Sprite\n    {\n        this.blendMode = blendMode;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to set pointerEnabled to false.\n     * @returns This instance, for chaining.\n     */\n    public function disablePointer () :Sprite\n    {\n        pointerEnabled = false;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to set pixelSnapping to false.\n     * @returns This instance, for chaining.\n     */\n    public function disablePixelSnapping () :Sprite\n    {\n        pixelSnapping = false;\n        return this;\n    }\n\n    override public function onAdded ()\n    {\n        if (_flags.contains(HOVERING)) {\n            connectHover();\n        }\n    }\n\n    override public function onRemoved ()\n    {\n        if (_hoverConnection != null) {\n            _hoverConnection.dispose();\n            _hoverConnection = null;\n        }\n    }\n\n    override public function onUpdate (dt :Float)\n    {\n        x.update(dt);\n        y.update(dt);\n        rotation.update(dt);\n        scaleX.update(dt);\n        scaleY.update(dt);\n        alpha.update(dt);\n        anchorX.update(dt);\n        anchorY.update(dt);\n    }\n\n    /**\n     * Draws this sprite to the given Graphics.\n     */\n    public function draw (g :Graphics)\n    {\n        // See subclasses\n    }\n\n    private function isViewMatrixDirty () :Bool\n    {\n        if (_flags.contains(VIEW_MATRIX_DIRTY)) {\n            return true;\n        }\n        var parentSprite = getParentSprite();\n        if (parentSprite == null) {\n            return false;\n        }\n        return _parentViewMatrixUpdateCount != parentSprite._viewMatrixUpdateCount\n            || parentSprite.isViewMatrixDirty();\n    }\n\n    private function getParentSprite () :Sprite\n    {\n        if (owner == null) {\n            return null;\n        }\n        var entity = owner.parent;\n        while (entity != null) {\n            var sprite = entity.get(Sprite);\n            if (sprite != null) {\n                return sprite;\n            }\n            entity = entity.parent;\n        }\n        return null;\n    }\n\n    private function get_pointerDown () :Signal1<PointerEvent>\n    {\n        if (_pointerDown == null) {\n            _pointerDown = new Signal1();\n        }\n        return _pointerDown;\n    }\n\n    private function get_pointerMove () :Signal1<PointerEvent>\n    {\n        if (_pointerMove == null) {\n            _pointerMove = new Signal1();\n        }\n        return _pointerMove;\n    }\n\n    private function get_pointerUp () :Signal1<PointerEvent>\n    {\n        if (_pointerUp == null) {\n            _pointerUp = new Signal1();\n        }\n        return _pointerUp;\n    }\n\n    private function get_pointerIn () :Signal1<PointerEvent>\n    {\n        if (_pointerIn == null) {\n            _pointerIn = new Signal1();\n        }\n        return _pointerIn;\n    }\n\n    private function get_pointerOut () :Signal1<PointerEvent>\n    {\n        if (_pointerOut == null) {\n            _pointerOut = new Signal1();\n        }\n        return _pointerOut;\n    }\n\n    private function connectHover ()\n    {\n        if (_hoverConnection != null) {\n            return;\n        }\n        _hoverConnection = System.pointer.move.connect(function (event) {\n            // Return early if this sprite was in the event chain\n            var hit = event.hit;\n            while (hit != null) {\n                if (hit == this) {\n                    return;\n                }\n                hit = hit.getParentSprite();\n            }\n\n            // This sprite is not under the pointer\n            if (_pointerOut != null && _flags.contains(HOVERING)) {\n                _pointerOut.emit(event);\n            }\n            _flags = _flags.remove(HOVERING);\n            _hoverConnection.dispose();\n            _hoverConnection = null;\n        });\n    }\n\n    inline private function get_visible () :Bool\n    {\n        return _flags.contains(VISIBLE);\n    }\n\n    private function set_visible (visible :Bool) :Bool\n    {\n        _flags = _flags.set(VISIBLE, visible);\n        return visible;\n    }\n\n    inline private function get_pointerEnabled () :Bool\n    {\n        return _flags.contains(POINTER_ENABLED);\n    }\n\n    private function set_pointerEnabled (pointerEnabled :Bool) :Bool\n    {\n        _flags = _flags.set(POINTER_ENABLED, pointerEnabled);\n        return pointerEnabled;\n    }\n\n    inline private function get_pixelSnapping () :Bool\n    {\n        return _flags.contains(PIXEL_SNAPPING);\n    }\n\n    private function set_pixelSnapping (pixelSnapping :Bool) :Bool\n    {\n        _flags = _flags.set(PIXEL_SNAPPING, pixelSnapping);\n        return pixelSnapping;\n    }\n\n    @:allow(flambe) function onPointerDown (event :PointerEvent)\n    {\n        onHover(event);\n        if (_pointerDown != null) {\n            _pointerDown.emit(event);\n        }\n    }\n\n    @:allow(flambe) function onPointerMove (event :PointerEvent)\n    {\n        onHover(event);\n        if (_pointerMove != null) {\n            _pointerMove.emit(event);\n        }\n    }\n\n    private function onHover (event :PointerEvent)\n    {\n        if (_flags.contains(HOVERING)) {\n            return; // Already hovering\n        }\n        _flags = _flags.add(HOVERING);\n\n        // Notify listeners and connect the hover-out listener\n        if ((_pointerIn != null || _pointerOut != null)) {\n            if (_pointerIn != null) {\n                _pointerIn.emit(event);\n            }\n            connectHover();\n        }\n    }\n\n    @:allow(flambe) function onPointerUp (event :PointerEvent)\n    {\n        switch (event.source) {\n        case Touch(point):\n            if (_pointerOut != null && _flags.contains(HOVERING)) {\n                _pointerOut.emit(event);\n            }\n            _flags = _flags.remove(HOVERING);\n            if (_hoverConnection != null) {\n                _hoverConnection.dispose();\n                _hoverConnection = null;\n            }\n        default:\n        }\n\n        if (_pointerUp != null) {\n            _pointerUp.emit(event);\n        }\n    }\n\n    private static function hitTestBackwards (entity :Entity, x :Float, y :Float) :Sprite\n    {\n        if (entity != null) {\n            var result = hitTestBackwards(entity.next, x, y);\n            return (result != null) ? result : hitTest(entity, x, y);\n        }\n        return null;\n    }\n\n    private static function getBoundsImpl (entity :Entity, matrix :Matrix, result :Rectangle)\n    {\n        var sprite = entity.get(Sprite);\n        if (sprite != null) {\n            matrix = (matrix != null)\n                ? Matrix.multiply(matrix, sprite.getLocalMatrix()) // Allocation!\n                : sprite.getLocalMatrix();\n\n            var x1 = 0.0, y1 = 0.0;\n            var x2 = sprite.getNaturalWidth(), y2 = sprite.getNaturalHeight();\n\n            // Intersecting scissor rectangles are too tricky for bounds calculation, ignore it for\n            // now...\n            // var scissor = sprite.scissor;\n            // if (scissor != null) {\n            //     x1 = FMath.max(x1, scissor.x);\n            //     y1 = FMath.max(y1, scissor.y);\n            //     x2 = FMath.min(x2, scissor.x + scissor.width);\n            //     y2 = FMath.min(y2, scissor.y + scissor.height);\n            // }\n\n            // Extend the rectangle out to fit this sprite\n            if (x2 > x1 && y2 > y1) {\n                extendRect(matrix, x1, y1, result);\n                extendRect(matrix, x2, y1, result);\n                extendRect(matrix, x2, y2, result);\n                extendRect(matrix, x1, y2, result);\n            }\n        }\n\n        // Recurse into partially occluded director scenes\n        var director = entity.get(Director);\n        if (director != null) {\n            var scenes = director.occludedScenes;\n            var ii = 0, ll = scenes.length;\n            while (ii < ll) {\n                getBoundsImpl(scenes[ii], matrix, result);\n                ++ii;\n            }\n        }\n\n        // Recurse into all children\n        var p = entity.firstChild;\n        while (p != null) {\n            var next = p.next;\n            getBoundsImpl(p, matrix, result);\n            p = next;\n        }\n    }\n\n    private static function extendRect (matrix :Matrix, x :Float, y :Float, rect :Rectangle)\n    {\n        var p = matrix.transform(x, y, _scratchPoint);\n        x = p.x;\n        y = p.y;\n\n        // The width and height of the rectangle are treated like the bottom right point, rather\n        // than a true width and height offset\n        if (x < rect.x) rect.x = x;\n        if (y < rect.y) rect.y = y;\n        if (x > rect.width) rect.width = x;\n        if (y > rect.height) rect.height = y;\n    }\n\n    private static var _scratchPoint = new Point();\n\n    // Component flags\n    private static inline var VISIBLE = Component.NEXT_FLAG << 0;\n    private static inline var POINTER_ENABLED = Component.NEXT_FLAG << 1;\n    private static inline var LOCAL_MATRIX_DIRTY = Component.NEXT_FLAG << 2;\n    private static inline var VIEW_MATRIX_DIRTY = Component.NEXT_FLAG << 3;\n    private static inline var PIXEL_SNAPPING = Component.NEXT_FLAG << 4;\n    private static inline var HOVERING = Component.NEXT_FLAG << 5;\n    private static inline var NEXT_FLAG = Component.NEXT_FLAG << 6; // Must be last!\n\n    private var _localMatrix :Matrix;\n\n    private var _viewMatrix :Matrix = null;\n    private var _viewMatrixUpdateCount :Int = 0;\n    private var _parentViewMatrixUpdateCount :Int = 0;\n\n    private var _pointerDown :Signal1<PointerEvent>;\n    private var _pointerMove :Signal1<PointerEvent>;\n    private var _pointerUp :Signal1<PointerEvent>;\n\n    private var _pointerIn :Signal1<PointerEvent>;\n    private var _pointerOut :Signal1<PointerEvent>;\n    private var _hoverConnection :SignalConnection;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.display;\n\nimport flambe.animation.AnimatedFloat;\nimport flambe.util.Value;\n\n/**\n * A sprite that displays a rectangle filled with a given color.\n */\nclass FillSprite extends Sprite\n{\n    public var color :Int;\n    public var width (default, null) :AnimatedFloat;\n    public var height (default, null) :AnimatedFloat;\n\n    public function new (color :Int, width :Float, height :Float)\n    {\n        super();\n        this.color = color;\n        this.width = new AnimatedFloat(width);\n        this.height = new AnimatedFloat(height);\n    }\n\n    override public function draw (g :Graphics)\n    {\n        g.fillRect(color, 0, 0, width._, height._);\n    }\n\n    override public function getNaturalWidth () :Float\n    {\n        return width._;\n    }\n\n    override public function getNaturalHeight () :Float\n    {\n        return height._;\n    }\n\n    /**\n     * Chainable convenience method to set the width and height.\n     * @returns This instance, for chaining.\n     */\n    public function setSize (width :Float, height :Float) :FillSprite\n    {\n        this.width._ = width;\n        this.height._ = height;\n        return this;\n    }\n\n    override public function onUpdate (dt :Float)\n    {\n        super.onUpdate(dt);\n        width.update(dt);\n        height.update(dt);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.display;\n\n/**\n * A fixed-size sprite that displays a single texture.\n */\nclass ImageSprite extends Sprite\n{\n    /**\n     * The texture being displayed, or null if none.\n     */\n    public var texture :Texture;\n\n    public function new (texture :Texture)\n    {\n        super();\n        this.texture = texture;\n    }\n\n    override public function draw (g :Graphics)\n    {\n        if (texture != null) {\n            g.drawTexture(texture, 0, 0);\n        }\n    }\n\n    override public function getNaturalWidth () :Float\n    {\n        return (texture != null) ? texture.width : 0;\n    }\n\n    override public function getNaturalHeight () :Float\n    {\n        return (texture != null) ? texture.height : 0;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.input;\n\n/**\n * Represents an event coming from a physical key press.\n *\n * _NOTE_: For performance reasons, KeyboardEvent instances are reused by Flambe. Use `clone()` to\n * retain a reference to an event.\n */\nclass KeyboardEvent\n{\n    /**\n     * The key that caused this event.\n     */\n    public var key (default, null) :Key;\n\n    /**\n     * An incrementing ID unique to every dispatched key event.\n     */\n    public var id (default, null) :Int;\n\n    @:allow(flambe) function new ()\n    {\n        init(0, null);\n    }\n\n    /**\n     * Creates a copy of this event.\n     */\n    public function clone () :KeyboardEvent\n    {\n        var event = new KeyboardEvent();\n        event.init(id, key);\n        return event;\n    }\n\n    @:allow(flambe) function init (id :Int, key :Key)\n    {\n        this.id = id;\n        this.key = key;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.input;\n\n/**\n * Represents an event coming from a mouse.\n *\n * _NOTE_: For performance reasons, MouseEvent instances are reused by Flambe. Use `clone()` to\n * retain a reference to an event.\n */\nclass MouseEvent\n{\n    /**\n     * The X position of the mouse, in view (stage) coordinates.\n     */\n    public var viewX (default, null) :Float;\n\n    /**\n     * The Y position of the mouse, in view (stage) coordinates.\n     */\n    public var viewY (default, null) :Float;\n\n    /**\n     * The mouse button that caused this event, or null for movement events.\n     */\n    public var button (default, null) :MouseButton;\n\n    /**\n     * An incrementing ID unique to every dispatched mouse event.\n     */\n    public var id (default, null) :Int;\n\n    @:allow(flambe) function new ()\n    {\n        init(0, 0, 0, null);\n    }\n\n    /**\n     * Creates a copy of this event.\n     */\n    public function clone () :MouseEvent\n    {\n        var event = new MouseEvent();\n        event.init(id, viewX, viewY, button);\n        return event;\n    }\n\n    @:allow(flambe) function init (id :Int, viewX :Float, viewY :Float, button :MouseButton)\n    {\n        this.id = id;\n        this.viewX = viewX;\n        this.viewY = viewY;\n        this.button = button;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.input;\n\nimport flambe.display.Sprite;\n\nenum EventSource\n{\n    Mouse (event :MouseEvent);\n    Touch (point :TouchPoint);\n}\n\n/**\n * Represents an event coming from a pointing device, such as a mouse or finger.\n *\n * _NOTE_: For performance reasons, PointerEvent instances are reused by Flambe. Use `clone()` to\n * retain a reference to an event.\n */\nclass PointerEvent\n{\n    /**\n     * The X position of the pointing device, in view (stage) coordinates.\n     */\n    public var viewX (default, null) :Float;\n\n    /**\n     * The Y position of the pointing device, in view (stage) coordinates.\n     */\n    public var viewY (default, null) :Float;\n\n    /**\n     * The deepest sprite lying under the pointer that caused the event, if any. The hit sprite does\n     * not necessarily have a pointer event listener connected to it. This event starts at the hit\n     * sprite, and propagates upwards to its parents.\n     */\n    public var hit (default, null) :Sprite;\n\n    /**\n     * The source that this event originated from. This can be used to determine if the event came\n     * from a mouse or a touch.\n     */\n    public var source (default, null) :EventSource;\n\n    /**\n     * An incrementing ID unique to every dispatched pointer event.\n     */\n    public var id (default, null) :Int;\n\n    @:allow(flambe) function new ()\n    {\n        init(0, 0, 0, null, null);\n    }\n\n    /**\n     * Prevents this PointerEvent from propagating up to parent sprites and the top-level Pointer\n     * signal. Other listeners for this event on the current sprite will still fire.\n     */\n    inline public function stopPropagation ()\n    {\n        _stopped = true;\n    }\n\n    /**\n     * Creates a copy of this event.\n     */\n    public function clone () :PointerEvent\n    {\n        // Ensure the source gets deep copied too\n        var sourceCopy = null;\n        switch (source) {\n            case Mouse(event): sourceCopy = Mouse(event.clone());\n            default: sourceCopy = source;\n        }\n\n        var event = new PointerEvent();\n        event.init(id, viewX, viewY, hit, sourceCopy);\n        return event;\n    }\n\n    @:allow(flambe) function init (\n        id :Int, viewX :Float, viewY :Float, hit :Sprite, source :EventSource)\n    {\n        this.id = id;\n        this.viewX = viewX;\n        this.viewY = viewY;\n        this.hit = hit;\n        this.source = source;\n        _stopped = false;\n    }\n\n    @:allow(flambe) var _stopped :Bool;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.input;\n\nimport flambe.input.PointerEvent;\n\n/**\n * Represents a touch screen contact point, such as a finger. It is possible to retain a reference\n * to a TouchPoint, and track changes to it over time.\n */\nclass TouchPoint\n{\n    /**\n     * The X position of the touch, in view (stage) coordinates. This value is modified when the\n     * point moves.\n     */\n    public var viewX (default, null) :Float;\n\n    /**\n     * The Y position of the touch, in view (stage) coordinates. This value is modified when the\n     * point moves.\n     */\n    public var viewY (default, null) :Float;\n\n    /**\n     * An identifier unique to this touch.\n     */\n    public var id (default, null) :Int;\n\n    @:allow(flambe) function new (id :Int)\n    {\n        this.id = id;\n        _source = Touch(this);\n    }\n\n    @:allow(flambe) function init (viewX :Float, viewY :Float)\n    {\n        this.viewX = viewX;\n        this.viewY = viewY;\n    }\n\n    // Cached to avoid lots of allocation\n    @:allow(flambe) var _source :EventSource;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.math;\n\n/**\n * Some handy math functions, and inlinable constants.\n */\nclass FMath\n{\n    public static inline var E = 2.718281828459045;\n    public static inline var LN2 = 0.6931471805599453;\n    public static inline var LN10 = 2.302585092994046;\n    public static inline var LOG2E = 1.4426950408889634;\n    public static inline var LOG10E = 0.43429448190325176;\n    public static inline var PI = 3.141592653589793;\n    public static inline var SQRT1_2 = 0.7071067811865476;\n    public static inline var SQRT2 = 1.4142135623730951;\n\n    // Haxe doesn't specify the size of an int or float, in practice it's 32 bits\n    /** The lowest integer value in Flash and JS. */\n    public static inline var INT_MIN :Int = -2147483648;\n\n    /** The highest integer value in Flash and JS. */\n    public static inline var INT_MAX :Int = 2147483647;\n\n    /** The lowest float value in Flash and JS. */\n    public static inline var FLOAT_MIN = -1.79769313486231e+308;\n\n    /** The highest float value in Flash and JS. */\n    public static inline var FLOAT_MAX = 1.79769313486231e+308;\n\n    /** Converts an angle in degrees to radians. */\n    inline public static function toRadians (degrees :Float) :Float\n    {\n        return degrees * PI/180;\n    }\n\n    /** Converts an angle in radians to degrees. */\n    inline public static function toDegrees (radians :Float) :Float\n    {\n        return radians * 180/PI;\n    }\n\n    #if !js @:generic #end\n    inline public static function max<T:Float> (a :T, b :T) :T\n    {\n        return (a > b) ? a : b;\n    }\n\n    #if !js @:generic #end\n    inline public static function min<T:Float> (a :T, b :T) :T\n    {\n        return (a < b) ? a : b;\n    }\n\n    #if !js @:generic #end\n    public static function clamp<T:Float> (value :T, min :T, max :T) :T\n    {\n        return if (value < min) min\n            else if (value > max) max\n            else value;\n    }\n\n    public static function sign (value :Float) :Int\n    {\n        return if (value < 0) -1\n            else if (value > 0) 1\n            else 0;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.math;\n\n/**\n * A 2D transform matrix.\n *\n * ```\n * [ m00 m01 m02 ]\n * [ m10 m11 m12 ]\n * [  0   0   1  ]\n * ```\n */\nclass Matrix\n{\n    public var m00 :Float;\n    public var m10 :Float;\n    public var m01 :Float;\n    public var m11 :Float;\n    public var m02 :Float;\n    public var m12 :Float;\n\n    public function new ()\n    {\n        identity();\n    }\n\n    public function set (m00 :Float, m10 :Float, m01 :Float, m11 :Float, m02 :Float, m12 :Float)\n    {\n        this.m00 = m00; this.m01 = m01; this.m02 = m02;\n        this.m10 = m10; this.m11 = m11; this.m12 = m12;\n    }\n\n    /**\n     * Sets this matrix to the identity matrix.\n     */\n    public function identity ()\n    {\n        set(1, 0, 0, 1, 0, 0);\n    }\n\n    /**\n     * Set this matrix to a translation, scale, and rotation, in that order.\n     */\n    public function compose (x :Float, y :Float, scaleX :Float, scaleY :Float, rotation :Float)\n    {\n        var sin = Math.sin(rotation);\n        var cos = Math.cos(rotation);\n        set(cos*scaleX, sin*scaleX, -sin*scaleY, cos*scaleY, x, y);\n    }\n\n    public function translate (x :Float, y :Float)\n    {\n        m02 += m00*x + m01*y;\n        m12 += m11*y + m10*x;\n    }\n\n    public function scale (x :Float, y :Float)\n    {\n        m00 *= x;\n        m10 *= x;\n        m01 *= y;\n        m11 *= y;\n    }\n\n    public function rotate (rotation :Float)\n    {\n        var sin = Math.sin(rotation);\n        var cos = Math.cos(rotation);\n\n        var t00 = m00*cos + m01*sin;\n        var t01 = -m00*sin + m01*cos;\n        m00 = t00;\n        m01 = t01;\n\n        var t10 = m11*sin + m10*cos;\n        var t11 = m11*cos - m10*sin;\n        m10 = t10;\n        m11 = t11;\n    }\n\n    /** @return Whether the matrix was inverted. */\n    public function invert () :Bool\n    {\n        var det = determinant();\n        if (det == 0) {\n            return false;\n        }\n        set(m11/det, -m01/det, -m10/det, m00/det,\n            (m01*m12 - m11*m02) / det,\n            (m10*m02 - m00*m12) / det);\n        return true;\n    }\n\n    public function transform (x :Float, y :Float, ?result :Point) :Point\n    {\n        if (result == null) {\n            result = new Point();\n        }\n        result.x = x*m00 + y*m01 + m02;\n        result.y = x*m10 + y*m11 + m12;\n        return result;\n    }\n\n    public function transformArray (points :ArrayAccess<Float>, length :Int,\n        result :ArrayAccess<Float>)\n    {\n        var ii = 0;\n        while (ii < length) {\n            var x = points[ii], y = points[ii+1];\n            result[ii++] = x*m00 + y*m01 + m02;\n            result[ii++] = x*m10 + y*m11 + m12;\n        }\n    }\n\n    /**\n     * Calculate the determinant of this matrix.\n     */\n    public function determinant () :Float\n    {\n        return m00*m11 - m01*m10;\n    }\n\n    /**\n     * Transforms a point by the inverse of this matrix, or return false if this matrix is not\n     * invertible.\n     */\n    public function inverseTransform (x :Float, y :Float, result :Point) :Bool\n    {\n        var det = determinant();\n        if (det == 0) {\n            return false;\n        }\n        x -= m02;\n        y -= m12;\n        result.x = (x*m11 - y*m01) / det;\n        result.y = (y*m00 - x*m10) / det;\n        return true;\n    }\n\n    /**\n     * Multiply two matrices and return the result.\n     */\n    public static function multiply (lhs :Matrix, rhs :Matrix, ?result :Matrix) :Matrix\n    {\n        if (result == null) {\n            result = new Matrix();\n        }\n\n        // First row\n        var a = lhs.m00*rhs.m00 + lhs.m01*rhs.m10;\n        var b = lhs.m00*rhs.m01 + lhs.m01*rhs.m11;\n        var c = lhs.m00*rhs.m02 + lhs.m01*rhs.m12 + lhs.m02;\n        result.m00 = a;\n        result.m01 = b;\n        result.m02 = c;\n\n        // Second row\n        a = lhs.m10*rhs.m00 + lhs.m11*rhs.m10;\n        b = lhs.m10*rhs.m01 + lhs.m11*rhs.m11;\n        c = lhs.m10*rhs.m02 + lhs.m11*rhs.m12 + lhs.m12;\n        result.m10 = a;\n        result.m11 = b;\n        result.m12 = c;\n\n        return result;\n    }\n\n    /**\n     * Creates a copy of this matrix.\n     */\n    public function clone (?result :Matrix) :Matrix\n    {\n        if (result == null) {\n            result = new Matrix();\n        }\n        result.set(m00, m10, m01, m11, m02, m12);\n        return result;\n    }\n\n    #if debug @:keep #end public function toString () :String\n    {\n        return m00 + \" \" + m01 + \" \" + m02 + \" \\\\ \" +\n            m10 + \" \" + m11 + \" \" + m12;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.math;\n\n/**\n * A 2D rectangle.\n */\nclass Rectangle\n{\n    public var x :Float;\n    public var y :Float;\n    public var width :Float;\n    public var height :Float;\n\n    /** The X-coordinate of the left side of the rectangle. */\n    public var left (get, null) :Float;\n\n    /** The X-coordinate of the right side of the rectangle. */\n    public var right (get, null) :Float;\n\n    /** The Y-coordinate of the top side of the rectangle. */\n    public var top (get, null) :Float;\n\n    /** The Y-coordinate of the bottom side of the rectangle. */\n    public var bottom (get, null) :Float;\n\n    /** The X-coordinate of the center of the rectangle. */\n    public var centerX (get, null) :Float;\n\n    /** The Y-coordinate of the center of the rectangle. */\n    public var centerY (get, null) :Float;\n\n    public function new (x :Float = 0, y :Float = 0, width :Float = 0, height :Float = 0)\n    {\n        set(x, y, width, height);\n    }\n\n    public function set (x :Float, y :Float, width :Float, height :Float)\n    {\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n    }\n\n    /**\n     * Returns true if this rectangle contains the given point.\n     */\n    public function contains (x :Float, y :Float) :Bool\n    {\n        // A little more complicated than usual due to proper handling of negative widths/heights\n\n        x -= this.x;\n        if (width >= 0) {\n            if (x < 0 || x > width) {\n                return false;\n            }\n        } else if (x > 0 || x < width) {\n            return false;\n        }\n\n        y -= this.y;\n        if (height >= 0) {\n            if (y < 0 || y > height) {\n                return false;\n            }\n        } else if (y > 0 || y < height) {\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * Returns whether this rectangle intersects another rectangle.\n     *\n     * @param rect The other rectangle to check for intersection.\n     * @param result If supplied and the rectangles intersect, will be set to the calculated\n     *   intersection rectangle.\n     */\n    public function intersects (rect :Rectangle, ?result: Rectangle) :Bool\n    {\n        var left = FMath.max(this.left, rect.left);\n        var right = FMath.min(this.right, rect.right);\n        if (left > right) {\n            return false;\n        }\n\n        var top = FMath.max(this.top, rect.top);\n        var bottom = FMath.min(this.bottom, rect.bottom);\n        if (top > bottom) {\n            return false;\n        }\n\n        if (result != null) {\n            result.set(left, top, right-left, bottom-top);\n        }\n        return true;\n    }\n\n    /**\n     * Creates a copy of this rectangle.\n     */\n    public function clone (?result :Rectangle) :Rectangle\n    {\n        if (result == null) {\n            result = new Rectangle();\n        }\n        result.set(x, y, width, height);\n        return result;\n    }\n\n    public function equals (other :Rectangle) :Bool\n    {\n        return x == other.x && y == other.y && width == other.width && height == other.height;\n    }\n\n    #if debug @:keep #end public function toString () :String\n    {\n        return \"(\" + x + \",\" + y + \" \" + width + \"x\" + height + \")\";\n    }\n\n    inline private function get_left () :Float\n    {\n        return x;\n    }\n\n    inline private function get_top () :Float\n    {\n        return y;\n    }\n\n    private function get_right () :Float\n    {\n        return x + width;\n    }\n\n    private function get_bottom () :Float\n    {\n        return y + height;\n    }\n\n    private function get_centerX () :Float\n    {\n        return x + width/2;\n    }\n\n    private function get_centerY () :Float\n    {\n        return y + height/2;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.asset.Asset;\nimport flambe.util.Assert;\nimport flambe.util.Value;\n\nclass BasicAsset<A/*:BasicAsset<A>*/>\n    implements Asset\n{\n    public var reloadCount (get, null) :Value<Int>;\n\n    public function new ()\n    {\n    }\n\n    inline public function assertNotDisposed ()\n    {\n        Assert.that(!_disposed, \"Asset cannot be used after being disposed\");\n    }\n\n    @:final public function reload (asset :A)\n    {\n        dispose();\n        _disposed = false;\n        copyFrom(asset);\n        ++reloadCount._;\n    }\n\n    @:final public function dispose ()\n    {\n        if (!_disposed) {\n            _disposed = true;\n            onDisposed();\n        }\n    }\n\n    /** Fully copy the content from another asset type, for reloading. */\n    private function copyFrom (asset :A)\n    {\n        Assert.fail(); // See subclasses\n    }\n\n    /** Handle disposing. */\n    private function onDisposed ()\n    {\n        Assert.fail(); // See subclasses\n    }\n\n    // Overridden in subclasses!\n    private function get_reloadCount () :Value<Int>\n    {\n        if (_reloadCount == null) {\n            _reloadCount = new Value<Int>(0);\n        }\n        return _reloadCount;\n    }\n\n    private var _disposed :Bool = false;\n    private var _reloadCount :Value<Int> = null;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.asset.AssetEntry;\nimport flambe.asset.AssetPack;\nimport flambe.asset.File;\nimport flambe.asset.Manifest;\nimport flambe.display.Texture;\nimport flambe.sound.Sound;\nimport flambe.util.Assert;\nimport flambe.util.Promise;\n\nusing Lambda;\nusing flambe.util.Arrays;\nusing flambe.util.Strings;\n\nclass BasicAssetPackLoader\n{\n    public var promise (default, null) :Promise<AssetPack>;\n    public var manifest (default, null) :Manifest;\n\n    public function new (platform :Platform, manifest :Manifest)\n    {\n        this.manifest = manifest;\n        _platform = platform;\n        promise = new Promise();\n        _bytesLoaded = new Map();\n        _pack = new BasicAssetPack(manifest, this);\n\n        var entries = manifest.array();\n        if (entries.length == 0) {\n            // There's nothing to load, just send them an empty pack\n            handleSuccess();\n\n        } else {\n            var groups = new Map<String,Array<AssetEntry>>();\n\n            // Group assets by name\n            for (entry in entries) {\n                var group = groups.get(entry.name);\n                if (group == null) {\n                    group = [];\n                    groups.set(entry.name, group);\n                }\n                group.push(entry);\n            }\n\n            // Load the most suitable asset from each group\n            _assetsRemaining = groups.count();\n            for (group in groups) {\n                pickBestEntry(group, function (bestEntry :AssetEntry) {\n                    if (bestEntry != null) {\n                        var url = manifest.getFullURL(bestEntry);\n                        try {\n                            loadEntry(url, bestEntry);\n                        } catch (error :Dynamic) {\n                            handleError(bestEntry, \"Unexpected error: \" + error);\n                        }\n                        promise.total += bestEntry.bytes;\n\n                    } else {\n                        var badEntry = group[0];\n                        if (isAudio(badEntry.format)) {\n                            // Deal with missing audio files and bad browser support\n                            Log.warn(\"Could not find a supported audio format to load\", [\"name\", badEntry.name]);\n                            handleLoad(badEntry, DummySound.getInstance());\n                        } else {\n                            handleError(badEntry, \"Could not find a supported format to load\");\n                        }\n                    }\n                });\n            }\n        }\n\n#if debug\n        var catapult = _platform.getCatapultClient();\n        if (catapult != null) {\n            catapult.add(this);\n        }\n#end\n    }\n\n    /** Reload any asset that matches this URL (ignoring the ?v= query param). */\n    public function reload (url :String)\n    {\n        // Find the AssetEntry that matches this url\n        var baseUrl = removeUrlParams(url);\n        var foundEntry = null;\n        for (entry in manifest) {\n            if (baseUrl == removeUrlParams(entry.url)) {\n                foundEntry = entry;\n                break;\n            }\n        }\n\n        // If the entry was found in this manifest, and is a supported format\n        if (foundEntry != null) {\n            getAssetFormats(function (formats :Array<AssetFormat>) {\n                if (formats.indexOf(foundEntry.format) >= 0) {\n                    // Dummy up a new AssetEntry based on the previous one, and reload it\n                    var entry = new AssetEntry(foundEntry.name, url, foundEntry.format, 0);\n                    loadEntry(manifest.getFullURL(entry), entry);\n                }\n            });\n        }\n    }\n\n    /** Called when this loader's AssetPack is disposed. */\n    public function onDisposed ()\n    {\n#if debug\n        var catapult = _platform.getCatapultClient();\n        if (catapult != null) {\n            catapult.remove(this);\n        }\n#end\n    }\n\n    private static function removeUrlParams (url :String) :String\n    {\n        var query = url.indexOf(\"?\");\n        return (query > 0) ? url.substr(0, query) : url;\n    }\n\n    /**\n     * Out of a list of asset entries with the same name, select the one best supported by this\n     * environment, or null if none of them are supported.\n     */\n    private function pickBestEntry (entries :Array<AssetEntry>, fn :AssetEntry -> Void)\n    {\n        var onFormatsAvailable = function (formats :Array<AssetFormat>) {\n            for (format in formats) {\n                for (entry in entries) {\n                    if (entry.format == format) {\n                        fn(entry);\n                        return;\n                    }\n                }\n            }\n            fn(null); // This asset is not supported, we're boned\n        };\n\n        getAssetFormats(onFormatsAvailable);\n    }\n\n    private function loadEntry (url :String, entry :AssetEntry)\n    {\n        Assert.fail(); // See subclasses\n    }\n\n    /** Gets the list of asset formats the environment supports, ordered by preference. */\n    private function getAssetFormats (fn :Array<AssetFormat> -> Void)\n    {\n        Assert.fail(); // See subclasses\n    }\n\n    private function handleLoad<A/*:BasicAsset<A>*/> (entry :AssetEntry, asset :A)\n    {\n        if (_pack.disposed) {\n            return; // Pack was disposed earlier, forget about it\n        }\n\n        // Ensure this asset has been fully progressed\n        handleProgress(entry, entry.bytes);\n\n        var map :Map<String,Dynamic>;\n        switch (entry.format) {\n        case WEBP, JXR, PNG, JPG, GIF, DDS, PVR, PKM:\n            map = _pack.textures;\n        case MP3, M4A, OPUS, OGG, WAV:\n            map = _pack.sounds;\n        case Data:\n            map = _pack.files;\n        }\n\n#if debug // Allow some methods to get stripped in release builds, which don't allow reloading\n        var oldAsset :BasicAsset<A> = cast map.get(entry.name);\n        if (oldAsset != null) {\n            Log.info(\"Reloaded asset\", [\"url\", entry.url]);\n            oldAsset.reload(asset);\n\n        } else {\n#end\n            map.set(entry.name, asset);\n            _assetsRemaining -= 1;\n            if (_assetsRemaining == 0) {\n                handleSuccess();\n            }\n#if debug\n        }\n#end\n    }\n\n    private function handleProgress (entry :AssetEntry, bytesLoaded :Int)\n    {\n        _bytesLoaded.set(entry.name, bytesLoaded);\n\n        var bytesTotal = 0;\n        for (bytes in _bytesLoaded) {\n            bytesTotal += bytes;\n        }\n        promise.progress = bytesTotal;\n    }\n\n    private function handleSuccess ()\n    {\n        promise.result = _pack;\n    }\n\n    private function handleError (entry :AssetEntry, message :String)\n    {\n        Log.warn(\"Error loading asset pack\", [\"error\", message, \"url\", entry.url]);\n        promise.error.emit(message.withFields([\"url\", entry.url]));\n    }\n\n    private function handleTextureError (entry :AssetEntry)\n    {\n        handleError(entry, \"Failed to create texture. Is the GPU context unavailable?\");\n    }\n\n    private static function isAudio (format :AssetFormat) :Bool\n    {\n        switch (format) {\n            case MP3, M4A, OPUS, OGG, WAV: return true;\n            default: return false;\n        }\n    }\n\n    private var _platform :Platform;\n\n    // How many assets are still loading\n    private var _assetsRemaining :Int;\n\n    // How many bytes of each asset have been loaded\n    private var _bytesLoaded :Map<String,Int>;\n\n    private var _pack :BasicAssetPack;\n}\n\n// A simple AssetPack backed by a Map\nprivate class BasicAssetPack\n    implements AssetPack\n{\n    public var manifest (get, null) :Manifest;\n    public var loader (default, null) :BasicAssetPackLoader;\n\n    public var textures :Map<String,Texture>;\n    public var sounds :Map<String,Sound>;\n    public var files :Map<String,File>;\n\n    public var disposed :Bool = false;\n\n    public function new (manifest :Manifest, loader :BasicAssetPackLoader)\n    {\n        _manifest = manifest;\n        this.loader = loader;\n\n        textures = new Map();\n        sounds = new Map();\n        files = new Map();\n    }\n\n    public function getTexture (name :String, required :Bool = true) :Texture\n    {\n        assertNotDisposed();\n#if debug\n        warnOnExtension(name);\n#end\n        var texture = textures.get(name);\n        if (texture == null && required) {\n            throw \"Missing texture\".withFields([\"name\", name]);\n        }\n        return texture;\n    }\n\n    public function getSound (name :String, required :Bool = true) :Sound\n    {\n        assertNotDisposed();\n#if debug\n        warnOnExtension(name);\n#end\n        var sound = sounds.get(name);\n        if (sound == null && required) {\n            throw \"Missing sound\".withFields([\"name\", name]);\n        }\n        return sound;\n    }\n\n    public function getFile (name :String, required :Bool = true) :File\n    {\n        assertNotDisposed();\n\n        var file = files.get(name);\n        if (file == null && required) {\n            throw \"Missing file\".withFields([\"name\", name]);\n        }\n        return file;\n    }\n\n    // Dispose all assets contained in this pack\n    public function dispose ()\n    {\n        if (!disposed) {\n            disposed = true;\n\n            for (texture in textures) {\n                texture.dispose();\n            }\n            textures = null;\n\n            for (sound in sounds) {\n                sound.dispose();\n            }\n            sounds = null;\n\n            for (file in files) {\n                file.dispose();\n            }\n            files = null;\n\n            loader.onDisposed();\n        }\n    }\n\n    inline private function get_manifest () :Manifest\n    {\n        return _manifest;\n    }\n\n    inline private function assertNotDisposed ()\n    {\n        Assert.that(!disposed, \"AssetPack cannot be used after being disposed\");\n    }\n\n    private static function warnOnExtension (path :String)\n    {\n        var ext = path.getFileExtension();\n        if (ext != null && ext.length == 3) {\n            Log.warn(\"Requested asset \\\"\" + path + \"\\\" should not have a file extension,\" +\n                \" did you mean \\\"\" + path.removeFileExtension() + \"\\\"?\");\n        }\n    }\n\n    private var _manifest :Manifest;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.asset.File;\n\nclass BasicFile extends BasicAsset<BasicFile>\n    implements File\n{\n    public function new (content :String)\n    {\n        super();\n        _content = content;\n    }\n\n    public function toString ()\n    {\n        assertNotDisposed();\n\n        return _content;\n    }\n\n    override private function copyFrom (that :BasicFile)\n    {\n        this._content = that._content;\n    }\n\n    override private function onDisposed ()\n    {\n        _content = null;\n    }\n\n    private var _content :String;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.input.Key;\nimport flambe.input.KeyboardEvent;\nimport flambe.subsystem.KeyboardSystem;\nimport flambe.util.Signal0;\nimport flambe.util.Signal1;\n\nusing flambe.platform.KeyCodes;\n\nclass BasicKeyboard\n    implements KeyboardSystem\n{\n    public var supported (get, null) :Bool;\n\n    public var down (default, null) :Signal1<KeyboardEvent>;\n    public var up (default, null) :Signal1<KeyboardEvent>;\n    public var backButton (default, null) :Signal0;\n\n    public function new ()\n    {\n        down = new Signal1();\n        up = new Signal1();\n        backButton = new Signal0();\n        _keyStates = new Map();\n    }\n\n    public function get_supported () :Bool\n    {\n        return true;\n    }\n\n    public function isDown (key :Key) :Bool\n    {\n        return isCodeDown(key.toKeyCode());\n    }\n\n    inline private function isCodeDown (keyCode :Int) :Bool\n    {\n        return _keyStates.exists(keyCode);\n    }\n\n    /**\n     * Called by the platform to handle a down event.\n     * @return Whether default action should be prevented.\n     */\n    public function submitDown (keyCode :Int) :Bool\n    {\n        if (keyCode == KeyCodes.BACK) {\n            if (backButton.hasListeners()) {\n                backButton.emit();\n                return true;\n            }\n            return false; // No preventDefault\n        }\n\n        if (!isCodeDown(keyCode)) {\n            _keyStates.set(keyCode, true);\n            _sharedEvent.init(_sharedEvent.id+1, keyCode.toKey());\n            down.emit(_sharedEvent);\n        }\n        return true;\n    }\n\n    /**\n     * Called by the platform to handle an up event.\n     */\n    public function submitUp (keyCode :Int)\n    {\n        if (isCodeDown(keyCode)) {\n            _keyStates.remove(keyCode);\n            _sharedEvent.init(_sharedEvent.id+1, keyCode.toKey());\n            up.emit(_sharedEvent);\n        }\n    }\n\n    private static var _sharedEvent = new KeyboardEvent();\n\n    private var _keyStates :Map<Int,Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.input.MouseButton;\nimport flambe.input.MouseCursor;\nimport flambe.input.MouseEvent;\nimport flambe.input.PointerEvent;\nimport flambe.subsystem.MouseSystem;\nimport flambe.util.Signal1;\n\nusing flambe.platform.MouseCodes;\n\nclass BasicMouse\n    implements MouseSystem\n{\n    public var supported (get, null) :Bool;\n\n    public var down (default, null) :Signal1<MouseEvent>;\n    public var move (default, null) :Signal1<MouseEvent>;\n    public var up (default, null) :Signal1<MouseEvent>;\n    public var scroll (default, null) :Signal1<Float>;\n\n    public var x (get, null) :Float;\n    public var y (get, null) :Float;\n    public var cursor (get, set) :MouseCursor;\n\n    public function new (pointer :BasicPointer)\n    {\n        _pointer = pointer;\n        _source = Mouse(_sharedEvent);\n\n        down = new Signal1();\n        move = new Signal1();\n        up = new Signal1();\n        scroll = new Signal1();\n        _x = 0;\n        _y = 0;\n        _cursor = Default;\n        _buttonStates = new Map();\n    }\n\n    public function get_supported () :Bool\n    {\n        return true;\n    }\n\n    public function get_x () :Float\n    {\n        return _x;\n    }\n\n    public function get_y () :Float\n    {\n        return _y;\n    }\n\n    public function get_cursor () :MouseCursor\n    {\n        return _cursor;\n    }\n\n    public function set_cursor (cursor :MouseCursor) :MouseCursor\n    {\n        // See subclasses for implementation\n        return _cursor = cursor;\n    }\n\n    public function isDown (button :MouseButton) :Bool\n    {\n        return isCodeDown(button.toButtonCode());\n    }\n\n    public function submitDown (viewX :Float, viewY :Float, buttonCode :Int)\n    {\n        if (!isCodeDown(buttonCode)) {\n            _buttonStates.set(buttonCode, true);\n\n            // Init the MouseEvent, and let the Pointer system handle it before emitting our signal\n            prepare(viewX, viewY, buttonCode.toButton());\n            _pointer.submitDown(viewX, viewY, _source);\n            down.emit(_sharedEvent);\n        }\n    }\n\n    public function submitMove (viewX :Float, viewY :Float)\n    {\n        prepare(viewX, viewY, null);\n        _pointer.submitMove(viewX, viewY, _source);\n        move.emit(_sharedEvent);\n    }\n\n    public function submitUp (viewX :Float, viewY :Float, buttonCode :Int)\n    {\n        if (isCodeDown(buttonCode)) {\n            _buttonStates.remove(buttonCode);\n\n            prepare(viewX, viewY, buttonCode.toButton());\n            _pointer.submitUp(viewX, viewY, _source);\n            up.emit(_sharedEvent);\n        }\n    }\n\n    // Returns true if the scroll signal was handled\n    public function submitScroll (viewX :Float, viewY :Float, velocity :Float) :Bool\n    {\n        _x = viewX;\n        _y = viewY;\n        if (!scroll.hasListeners()) {\n            return false;\n        }\n        scroll.emit(velocity);\n        return true;\n    }\n\n    inline private function isCodeDown (buttonCode :Int) :Bool\n    {\n        return _buttonStates.exists(buttonCode);\n    }\n\n    private function prepare (viewX :Float, viewY :Float, button :MouseButton)\n    {\n        _x = viewX;\n        _y = viewY;\n        _sharedEvent.init(_sharedEvent.id+1, viewX, viewY, button);\n    }\n\n    private static var _sharedEvent = new MouseEvent();\n\n    private var _pointer :BasicPointer;\n    private var _source :EventSource;\n\n    private var _x :Float;\n    private var _y :Float;\n    private var _cursor :MouseCursor;\n    private var _buttonStates :Map<Int,Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.display.Sprite;\nimport flambe.input.PointerEvent;\nimport flambe.math.Point;\nimport flambe.scene.Director;\nimport flambe.subsystem.PointerSystem;\nimport flambe.util.Signal1;\n\nusing Lambda;\n\nclass BasicPointer\n    implements PointerSystem\n{\n    public var supported (get, null) :Bool;\n\n    public var down (default, null) :Signal1<PointerEvent>;\n    public var move (default, null) :Signal1<PointerEvent>;\n    public var up (default, null) :Signal1<PointerEvent>;\n\n    public var x (get, null) :Float;\n    public var y (get, null) :Float;\n\n    public function new (x :Float = 0, y :Float = 0, isDown :Bool = false)\n    {\n        down = new Signal1();\n        move = new Signal1();\n        up = new Signal1();\n        _x = x;\n        _y = y;\n        _isDown = isDown;\n    }\n\n    public function get_supported () :Bool\n    {\n        return true;\n    }\n\n    public function get_x () :Float\n    {\n        return _x;\n    }\n\n    public function get_y () :Float\n    {\n        return _y;\n    }\n\n    public function isDown () :Bool\n    {\n        return _isDown;\n    }\n\n    /**\n     * Called by the platform to handle a down event.\n     */\n    public function submitDown (viewX :Float, viewY :Float, source :EventSource)\n    {\n        if (_isDown) {\n            return; // Ignore repeat down events\n        }\n        // Ensure a move event is sent first\n        submitMove(viewX, viewY, source);\n        _isDown = true;\n\n        // Take a snapshot of the entire event bubbling chain\n        var chain = [];\n        var hit = Sprite.hitTest(System.root, viewX, viewY);\n        if (hit != null) {\n            var entity = hit.owner;\n            do {\n                var sprite = entity.get(Sprite);\n                if (sprite != null) {\n                    chain.push(sprite);\n                }\n                entity = entity.parent;\n            } while (entity != null);\n        }\n\n        // Finally, emit the event up the chain\n        prepare(viewX, viewY, hit, source);\n        for (sprite in chain) {\n            sprite.onPointerDown(_sharedEvent);\n            if (_sharedEvent._stopped) {\n                return;\n            }\n        }\n        down.emit(_sharedEvent);\n    }\n\n    /**\n     * Called by the platform to handle a move event.\n     */\n    public function submitMove (viewX :Float, viewY :Float, source :EventSource)\n    {\n        if (viewX == _x && viewY == _y) {\n            return; // Ignore repeated duplicate move events\n        }\n\n        // Take a snapshot of the entire event bubbling chain\n        var chain = [];\n        var hit = Sprite.hitTest(System.root, viewX, viewY);\n        if (hit != null) {\n            var entity = hit.owner;\n            do {\n                var sprite = entity.get(Sprite);\n                if (sprite != null) {\n                    chain.push(sprite);\n                }\n                entity = entity.parent;\n            } while (entity != null);\n        }\n\n        // Finally, emit the event up the chain\n        prepare(viewX, viewY, hit, source);\n        for (sprite in chain) {\n            sprite.onPointerMove(_sharedEvent);\n            if (_sharedEvent._stopped) {\n                return;\n            }\n        }\n        move.emit(_sharedEvent);\n    }\n\n    /**\n     * Called by the platform to handle an up event.\n     */\n    public function submitUp (viewX :Float, viewY :Float, source :EventSource)\n    {\n        if (!_isDown) {\n            return; // Ignore repeat up events\n        }\n        // Ensure a move event is sent first\n        submitMove(viewX, viewY, source);\n        _isDown = false;\n\n        // Take a snapshot of the entire event bubbling chain\n        var chain = [];\n        var hit = Sprite.hitTest(System.root, viewX, viewY);\n        if (hit != null) {\n            var entity = hit.owner;\n            do {\n                var sprite = entity.get(Sprite);\n                if (sprite != null) {\n                    chain.push(sprite);\n                }\n                entity = entity.parent;\n            } while (entity != null);\n        }\n\n        // Finally, emit the event up the chain\n        prepare(viewX, viewY, hit, source);\n        for (sprite in chain) {\n            sprite.onPointerUp(_sharedEvent);\n            if (_sharedEvent._stopped) {\n                return;\n            }\n        }\n        up.emit(_sharedEvent);\n    }\n\n    private function prepare (viewX :Float, viewY :Float, hit :Sprite, source :EventSource)\n    {\n        _x = viewX;\n        _y = viewY;\n        _sharedEvent.init(_sharedEvent.id+1, viewX, viewY, hit, source);\n    }\n\n    private static var _sharedEvent = new PointerEvent();\n    private static var _scratchPoint = new Point();\n\n    private var _x :Float;\n    private var _y :Float;\n    private var _isDown :Bool;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport haxe.io.Bytes;\n\nimport flambe.display.Graphics;\nimport flambe.display.SubTexture;\nimport flambe.display.Texture;\nimport flambe.util.Assert;\nimport flambe.util.Value;\n\n#if !js\n@:generic // for performance reasons\n#end\nclass BasicTexture<R:(TextureRoot,BasicAsset<R>)> extends BasicAsset<BasicTexture<R>>\n    implements SubTexture\n{\n    public var graphics (get, null) :Graphics;\n\n    public var parent (get, null) :Texture;\n\n    // The texture bounds\n    public var x (get, null) :Int;\n    public var y (get, null) :Int;\n    public var width (get, null) :Int;\n    public var height (get, null) :Int;\n\n    public var root (default, null) :R;\n\n    // The global position of this texture from the root\n    public var rootX (default, null) :Int = 0;\n    public var rootY (default, null) :Int = 0;\n\n    private function new (root :R, width :Int, height :Int)\n    {\n        super();\n        this.root = root;\n        _width = width;\n        _height = height;\n    }\n\n    public function readPixels (x :Int, y :Int, width :Int, height :Int) :Bytes\n    {\n        return root.readPixels(rootX+x, rootY+y, width, height);\n    }\n\n    public function writePixels (pixels :Bytes, x :Int, y :Int, sourceW :Int, sourceH :Int)\n    {\n        root.writePixels(pixels, rootX+x, rootY+y, sourceW, sourceH);\n    }\n\n    public function subTexture (x :Int, y :Int, width :Int, height :Int) :SubTexture\n    {\n        var sub :BasicTexture<R> = cast root.createTexture(width, height);\n        sub._parent = this;\n        sub._x = x;\n        sub._y = y;\n        sub.rootX = rootX + x;\n        sub.rootY = rootY + y;\n        return sub;\n    }\n\n    public function split (tilesWide :Int, tilesHigh :Int = 1) :Array<SubTexture>\n    {\n        var tiles = [];\n        var tileWidth = Std.int(_width / tilesWide);\n        var tileHeight = Std.int(_height / tilesHigh);\n        for (y in 0...tilesHigh) {\n            for (x in 0...tilesWide) {\n                tiles.push(subTexture(x*tileWidth, y*tileHeight, tileWidth, tileHeight));\n            }\n        }\n        return tiles;\n    }\n\n    // FIXME(bruno): Different textures that share the same root also share the same Graphics. This\n    // is an unfortunate limitation imposed by Canvas2D only allowing one context per canvas. We'll\n    // need to document this caveat somewhere, or change this API to workaround.\n    private function get_graphics () :Graphics\n    {\n        return root.getGraphics();\n    }\n\n    override private function copyFrom (that :BasicTexture<R>)\n    {\n        this.root._disposed = false;\n        this.root.copyFrom(that.root);\n\n        this._width = that._width;\n        this._height = that._height;\n\n        // We don't support mutability on the position, since it invalidates the rootX/Y of child\n        // subTextures. This assert should never fail with the asset reloader.\n        Assert.that(\n            this.rootX == that.rootX &&\n            this.rootY == that.rootY &&\n            this._x == that._x &&\n            this._y == that._y);\n    }\n\n    override private function onDisposed ()\n    {\n        // Since subtextures shouldn't be able to accidently dispose their parents and siblings,\n        // only dispose the root if this is the top-most subtexture.\n        if (_parent == null) {\n            root.dispose();\n        }\n    }\n\n    override private function get_reloadCount () :Value<Int>\n    {\n        // Delegate to the root, so that root reloads get propogated to all subtextures\n        return root.reloadCount;\n    }\n\n    inline private function get_parent () :Texture\n    {\n        return _parent;\n    }\n\n    inline private function get_x () :Int\n    {\n        return _x;\n    }\n\n    inline private function get_y () :Int\n    {\n        return _y;\n    }\n\n    inline private function get_width () :Int\n    {\n        return _width;\n    }\n\n    inline private function get_height () :Int\n    {\n        return _height;\n    }\n\n    private var _parent :BasicTexture<R> = null;\n\n    private var _x :Int = 0;\n    private var _y :Int = 0;\n    private var _width :Int;\n    private var _height :Int;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.input.TouchPoint;\nimport flambe.subsystem.TouchSystem;\nimport flambe.util.Signal1;\n\nclass BasicTouch\n    implements TouchSystem\n{\n    public var supported (get, null) :Bool;\n    public var maxPoints (get, null) :Int;\n    public var points (get, null) :Array<TouchPoint>;\n\n    public var down (default, null) :Signal1<TouchPoint>;\n    public var move (default, null) :Signal1<TouchPoint>;\n    public var up (default, null) :Signal1<TouchPoint>;\n\n    public function new (pointer :BasicPointer, maxPoints :Int = 4)\n    {\n        _pointer = pointer;\n        _maxPoints = maxPoints;\n        _pointMap = new Map();\n        _points = [];\n\n        down = new Signal1();\n        move = new Signal1();\n        up = new Signal1();\n    }\n\n    public function get_supported () :Bool\n    {\n        return true;\n    }\n\n    public function get_maxPoints () :Int\n    {\n        return _maxPoints;\n    }\n\n    public function get_points () :Array<TouchPoint>\n    {\n        return _points.copy();\n    }\n\n    public function submitDown (id :Int, viewX :Float, viewY :Float)\n    {\n        if (!_pointMap.exists(id)) {\n            var point = new TouchPoint(id);\n            point.init(viewX, viewY);\n            _pointMap.set(id, point);\n            _points.push(point);\n\n            if (_pointerTouch == null) {\n                // Make this touch point the tracked pointer\n                _pointerTouch = point;\n                _pointer.submitDown(viewX, viewY, point._source);\n            }\n            down.emit(point);\n        }\n    }\n\n    public function submitMove (id :Int, viewX :Float, viewY :Float)\n    {\n        var point = _pointMap.get(id);\n        if (point != null) {\n            point.init(viewX, viewY);\n\n            if (_pointerTouch == point) {\n                _pointer.submitMove(viewX, viewY, point._source);\n            }\n            move.emit(point);\n        }\n    }\n\n    public function submitUp (id :Int, viewX :Float, viewY :Float)\n    {\n        var point = _pointMap.get(id);\n        if (point != null) {\n            point.init(viewX, viewY);\n            _pointMap.remove(id);\n            _points.remove(point);\n\n            if (_pointerTouch == point) {\n                _pointerTouch = null;\n                _pointer.submitUp(viewX, viewY, point._source);\n            }\n            up.emit(point);\n        }\n    }\n\n    private var _pointer :BasicPointer;\n    private var _pointerTouch :TouchPoint;\n\n    private var _maxPoints :Int;\n    private var _pointMap :Map<Int,TouchPoint>;\n    private var _points :Array<TouchPoint>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport haxe.Json;\n\nimport flambe.util.Assert;\n\nusing StringTools;\n\n/** Handles communication with the Catapult server run by `flambe serve`, for live reloading. */\nclass CatapultClient\n{\n    private function new ()\n    {\n        _loaders = [];\n    }\n\n    public function add (loader :BasicAssetPackLoader)\n    {\n#if !flambe_disable_reloading\n        // Only care about packs loaded from the assets directory\n        if (loader.manifest.localBase == \"assets\") {\n            _loaders.push(loader);\n        }\n#end\n    }\n\n    public function remove (loader :BasicAssetPackLoader)\n    {\n        _loaders.remove(loader);\n    }\n\n    private function onError (cause :String)\n    {\n        Log.warn(\"Unable to connect to Catapult\", [\"cause\", cause]);\n    }\n\n    private function onMessage (message :String)\n    {\n        var message = Json.parse(message);\n        switch (message.type) {\n        case \"file_changed\":\n            var url = message.name + \"?v=\" + message.md5;\n            url = url.replace(\"\\\\\", \"/\"); // Handle backslash paths in Windows\n            for (loader in _loaders) {\n                loader.reload(url);\n            }\n        case \"restart\":\n            onRestart();\n        }\n    }\n\n    private function onRestart ()\n    {\n        Assert.fail(); // See subclasses\n    }\n\n    private var _loaders :Array<BasicAssetPackLoader>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\n/**\n * Internal helper for shared debug logic across all platforms.\n */\nclass DebugLogic\n{\n    public function new (platform :Platform)\n    {\n        _platform = platform;\n\n        platform.getKeyboard().down.connect(function (event) {\n            if (event.key == O && platform.getKeyboard().isDown(Control)) {\n                if (toggleOverdrawGraphics()) {\n                    Log.info(\"Enabled overdraw visualizer, press Ctrl-O again to disable\");\n                }\n            }\n        });\n    }\n\n    /**\n     * Toggles the overdraw debug renderer.\n     * @return Whether the overdraw renderer was enabled.\n     */\n    public function toggleOverdrawGraphics () :Bool\n    {\n        var renderer = _platform.getRenderer();\n\n        if (_savedGraphics != null) {\n            renderer.graphics = _savedGraphics;\n            _savedGraphics = null;\n\n        } else if (renderer.graphics != null) {\n            _savedGraphics = renderer.graphics;\n            renderer.graphics = new OverdrawGraphics(_savedGraphics);\n            return true;\n        }\n\n        return false;\n    }\n\n    private var _platform :Platform;\n\n    /** The normal Graphics saved by toggleOverdrawGraphics so it can restored. */\n    private var _savedGraphics :InternalGraphics;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.animation.AnimatedFloat;\nimport flambe.sound.Playback;\nimport flambe.sound.Sound;\nimport flambe.util.Value;\n\n/**\n * An empty sound used in environments that don't support audio.\n */\nclass DummySound extends BasicAsset<DummySound>\n    implements Sound\n{\n    public var duration (get, null) :Float;\n\n    public function new ()\n    {\n        super();\n        _playback = new DummyPlayback(this);\n    }\n\n    public function play (volume :Float = 1.0) :Playback\n    {\n        return _playback;\n    }\n\n    public function loop (volume :Float = 1.0) :Playback\n    {\n        return _playback;\n    }\n\n    public function get_duration () :Float\n    {\n        return 0;\n    }\n\n    override private function copyFrom (asset :DummySound)\n    {\n        // Nothing at all\n    }\n\n    override private function onDisposed ()\n    {\n        // Nothing at all\n    }\n\n    public static function getInstance () :DummySound\n    {\n        if (_instance == null) {\n            _instance = new DummySound();\n        }\n        return _instance;\n    }\n\n    private static var _instance :DummySound;\n\n    private var _playback :DummyPlayback;\n}\n\n// This should be immutable too\nclass DummyPlayback\n    implements Playback\n{\n    public var volume (default, null) :AnimatedFloat;\n    public var paused (get, set) :Bool;\n    public var complete (get, null) :Value<Bool>;\n    public var position (get, null) :Float;\n    public var sound (get, null) :Sound;\n\n    public function new (sound :Sound)\n    {\n        _sound = sound;\n        this.volume = new AnimatedFloat(0); // A little quirky? All DummyPlaybacks share the same volume\n        _complete = new Value<Bool>(true);\n    }\n\n    public function get_sound () :Sound\n    {\n        return _sound;\n    }\n\n    public function get_paused () :Bool\n    {\n        return true;\n    }\n\n    public function set_paused (paused :Bool) :Bool\n    {\n        return true;\n    }\n\n    public function get_complete () :Value<Bool>\n    {\n        return _complete;\n    }\n\n    public function get_position () :Float\n    {\n        return 0;\n    }\n\n    public function dispose ()\n    {\n        // Nothing\n    }\n\n    private var _sound :Sound;\n\n    private var _complete :Value<Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.input.TouchPoint;\nimport flambe.subsystem.TouchSystem;\nimport flambe.util.Signal1;\n\nclass DummyTouch\n    implements TouchSystem\n{\n    public var supported (get, null) :Bool;\n    public var maxPoints (get, null) :Int;\n    public var points (get, null) :Array<TouchPoint>;\n\n    public var down (default, null) :Signal1<TouchPoint>;\n    public var move (default, null) :Signal1<TouchPoint>;\n    public var up (default, null) :Signal1<TouchPoint>;\n\n    public function new ()\n    {\n        down = new Signal1();\n        move = new Signal1();\n        up = new Signal1();\n    }\n\n    public function get_supported () :Bool\n    {\n        return false;\n    }\n\n    public function get_maxPoints () :Int\n    {\n        return 0;\n    }\n\n    public function get_points () :Array<TouchPoint>\n    {\n        return [];\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.util.Disposable;\n\n#if flash\nimport flash.events.IEventDispatcher;\nimport flash.events.Event;\n#else\nimport js.html.EventTarget in IEventDispatcher;\nimport js.html.Event;\n#end\n\nprivate typedef Listener = Dynamic -> Void;\n\n/**\n * Manages a group of event listeners. When the group is disposed, all listeners are removed.\n */\nclass EventGroup\n    implements Disposable\n{\n    public function new ()\n    {\n        _entries = [];\n    }\n\n    /** Register a listener with this group. */\n    public function addListener (dispatcher :IEventDispatcher, type :String, listener :Listener)\n    {\n        dispatcher.addEventListener(type, listener, false);\n        _entries.push(new Entry(dispatcher, type, listener));\n    }\n\n    /** Register a listener with this group, all listeners are removed when it's fired. */\n    public function addDisposingListener (\n        dispatcher :IEventDispatcher, type :String, listener :Listener)\n    {\n        addListener(dispatcher, type, function (event :Event) {\n            dispose();\n            listener(event);\n        });\n    }\n\n    /** Detach all listeners registered with this group. */\n    public function dispose ()\n    {\n        for (entry in _entries) {\n            entry.dispatcher.removeEventListener(entry.type, entry.listener, false);\n        }\n        _entries = [];\n    }\n\n    private var _entries :Array<Entry>;\n}\n\nprivate class Entry\n{\n    public var dispatcher :IEventDispatcher;\n    public var type :String;\n    public var listener :Listener;\n\n    public function new (dispatcher, type, listener)\n    {\n        this.dispatcher = dispatcher;\n        this.type = type;\n        this.listener = listener;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.input.Key;\n\n/**\n * Key codes emitted by Flash and JS.\n */\nclass KeyCodes\n{\n    public static inline var A = 65;\n    public static inline var B = 66;\n    public static inline var C = 67;\n    public static inline var D = 68;\n    public static inline var E = 69;\n    public static inline var F = 70;\n    public static inline var G = 71;\n    public static inline var H = 72;\n    public static inline var I = 73;\n    public static inline var J = 74;\n    public static inline var K = 75;\n    public static inline var L = 76;\n    public static inline var M = 77;\n    public static inline var N = 78;\n    public static inline var O = 79;\n    public static inline var P = 80;\n    public static inline var Q = 81;\n    public static inline var R = 82;\n    public static inline var S = 83;\n    public static inline var T = 84;\n    public static inline var U = 85;\n    public static inline var V = 86;\n    public static inline var W = 87;\n    public static inline var X = 88;\n    public static inline var Y = 89;\n    public static inline var Z = 90;\n\n    public static inline var NUMBER_0 = 48;\n    public static inline var NUMBER_1 = 49;\n    public static inline var NUMBER_2 = 50;\n    public static inline var NUMBER_3 = 51;\n    public static inline var NUMBER_4 = 52;\n    public static inline var NUMBER_5 = 53;\n    public static inline var NUMBER_6 = 54;\n    public static inline var NUMBER_7 = 55;\n    public static inline var NUMBER_8 = 56;\n    public static inline var NUMBER_9 = 57;\n\n    public static inline var NUMPAD_0 = 96;\n    public static inline var NUMPAD_1 = 97;\n    public static inline var NUMPAD_2 = 98;\n    public static inline var NUMPAD_3 = 99;\n    public static inline var NUMPAD_4 = 100;\n    public static inline var NUMPAD_5 = 101;\n    public static inline var NUMPAD_6 = 102;\n    public static inline var NUMPAD_7 = 103;\n    public static inline var NUMPAD_8 = 104;\n    public static inline var NUMPAD_9 = 105;\n\n    public static inline var NUMPAD_ADD = 107;\n    public static inline var NUMPAD_DECIMAL = 110;\n    public static inline var NUMPAD_DIVIDE = 111;\n    public static inline var NUMPAD_ENTER = 108;\n    public static inline var NUMPAD_MULTIPLY = 106;\n    public static inline var NUMPAD_SUBTRACT = 109;\n\n    public static inline var F1 = 112;\n    public static inline var F2 = 113;\n    public static inline var F3 = 114;\n    public static inline var F4 = 115;\n    public static inline var F5 = 116;\n    public static inline var F6 = 117;\n    public static inline var F7 = 118;\n    public static inline var F8 = 119;\n    public static inline var F9 = 120;\n    public static inline var F10 = 121;\n    public static inline var F11 = 122;\n    public static inline var F12 = 123;\n    public static inline var F13 = 124;\n    public static inline var F14 = 125;\n    public static inline var F15 = 126;\n\n    public static inline var LEFT = 37;\n    public static inline var UP = 38;\n    public static inline var RIGHT = 39;\n    public static inline var DOWN = 40;\n\n    public static inline var ALT = 18;\n    public static inline var BACKQUOTE = 192;\n    public static inline var BACKSLASH = 220;\n    public static inline var BACKSPACE = 8;\n    public static inline var CAPS_LOCK = 20;\n    public static inline var COMMA = 188;\n    public static inline var COMMAND = 15;\n    public static inline var CONTROL = 17;\n    public static inline var DELETE = 46;\n    public static inline var END = 35;\n    public static inline var ENTER = 13;\n    public static inline var EQUALS = 187;\n    public static inline var ESCAPE = 27;\n    public static inline var HOME = 36;\n    public static inline var INSERT = 45;\n    public static inline var LEFT_BRACKET = 219;\n    public static inline var MINUS = 189;\n    public static inline var PAGE_DOWN = 34;\n    public static inline var PAGE_UP = 33;\n    public static inline var PERIOD = 190;\n    public static inline var QUOTE = 222;\n    public static inline var RIGHT_BRACKET = 221;\n    public static inline var SEMICOLON = 186;\n    public static inline var SHIFT = 16;\n    public static inline var SLASH = 191;\n    public static inline var SPACE = 32;\n    public static inline var TAB = 9;\n\n    // Android keys (AIR only)\n    public static inline var BACK = 0x01000016;\n    public static inline var MENU = 0x01000012;\n    public static inline var SEARCH = 0x0100001f;\n\n    public static function toKey (keyCode :Int) :Key\n    {\n        switch (keyCode) {\n            case A: return Key.A;\n            case B: return Key.B;\n            case C: return Key.C;\n            case D: return Key.D;\n            case E: return Key.E;\n            case F: return Key.F;\n            case G: return Key.G;\n            case H: return Key.H;\n            case I: return Key.I;\n            case J: return Key.J;\n            case K: return Key.K;\n            case L: return Key.L;\n            case M: return Key.M;\n            case N: return Key.N;\n            case O: return Key.O;\n            case P: return Key.P;\n            case Q: return Key.Q;\n            case R: return Key.R;\n            case S: return Key.S;\n            case T: return Key.T;\n            case U: return Key.U;\n            case V: return Key.V;\n            case W: return Key.W;\n            case X: return Key.X;\n            case Y: return Key.Y;\n            case Z: return Key.Z;\n\n            case NUMBER_0: return Key.Number0;\n            case NUMBER_1: return Key.Number1;\n            case NUMBER_2: return Key.Number2;\n            case NUMBER_3: return Key.Number3;\n            case NUMBER_4: return Key.Number4;\n            case NUMBER_5: return Key.Number5;\n            case NUMBER_6: return Key.Number6;\n            case NUMBER_7: return Key.Number7;\n            case NUMBER_8: return Key.Number8;\n            case NUMBER_9: return Key.Number9;\n\n            case NUMPAD_0: return Key.Numpad0;\n            case NUMPAD_1: return Key.Numpad1;\n            case NUMPAD_2: return Key.Numpad2;\n            case NUMPAD_3: return Key.Numpad3;\n            case NUMPAD_4: return Key.Numpad4;\n            case NUMPAD_5: return Key.Numpad5;\n            case NUMPAD_6: return Key.Numpad6;\n            case NUMPAD_7: return Key.Numpad7;\n            case NUMPAD_8: return Key.Numpad8;\n            case NUMPAD_9: return Key.Numpad9;\n\n            case NUMPAD_ADD: return Key.NumpadAdd;\n            case NUMPAD_DECIMAL: return Key.NumpadDecimal;\n            case NUMPAD_DIVIDE: return Key.NumpadDivide;\n            case NUMPAD_ENTER: return Key.NumpadEnter;\n            case NUMPAD_MULTIPLY: return Key.NumpadMultiply;\n            case NUMPAD_SUBTRACT: return Key.NumpadSubtract;\n\n            case F1: return Key.F1;\n            case F2: return Key.F2;\n            case F3: return Key.F3;\n            case F4: return Key.F4;\n            case F5: return Key.F5;\n            case F6: return Key.F6;\n            case F7: return Key.F7;\n            case F8: return Key.F8;\n            case F9: return Key.F9;\n            case F10: return Key.F10;\n            case F11: return Key.F11;\n            case F12: return Key.F12;\n\n            case LEFT: return Key.Left;\n            case UP: return Key.Up;\n            case RIGHT: return Key.Right;\n            case DOWN: return Key.Down;\n\n            case ALT: return Key.Alt;\n            case BACKQUOTE: return Key.Backquote;\n            case BACKSLASH: return Key.Backslash;\n            case BACKSPACE: return Key.Backspace;\n            case CAPS_LOCK: return Key.CapsLock;\n            case COMMA: return Key.Comma;\n            case COMMAND: return Key.Command;\n            case CONTROL: return Key.Control;\n            case DELETE: return Key.Delete;\n            case END: return Key.End;\n            case ENTER: return Key.Enter;\n            case EQUALS: return Key.Equals;\n            case ESCAPE: return Key.Escape;\n            case HOME: return Key.Home;\n            case INSERT: return Key.Insert;\n            case LEFT_BRACKET: return Key.LeftBracket;\n            case MINUS: return Key.Minus;\n            case PAGE_DOWN: return Key.PageDown;\n            case PAGE_UP: return Key.PageUp;\n            case PERIOD: return Key.Period;\n            case QUOTE: return Key.Quote;\n            case RIGHT_BRACKET: return Key.RightBracket;\n            case SEMICOLON: return Key.Semicolon;\n            case SHIFT: return Key.Shift;\n            case SLASH: return Key.Slash;\n            case SPACE: return Key.Space;\n            case TAB: return Key.Tab;\n\n            case MENU: return Key.Menu;\n            case SEARCH: return Key.Search;\n        }\n\n        return Unknown(keyCode);\n    }\n\n    public static function toKeyCode (key :Key) :Int\n    {\n        switch (key) {\n            case Key.A: return A;\n            case Key.B: return B;\n            case Key.C: return C;\n            case Key.D: return D;\n            case Key.E: return E;\n            case Key.F: return F;\n            case Key.G: return G;\n            case Key.H: return H;\n            case Key.I: return I;\n            case Key.J: return J;\n            case Key.K: return K;\n            case Key.L: return L;\n            case Key.M: return M;\n            case Key.N: return N;\n            case Key.O: return O;\n            case Key.P: return P;\n            case Key.Q: return Q;\n            case Key.R: return R;\n            case Key.S: return S;\n            case Key.T: return T;\n            case Key.U: return U;\n            case Key.V: return V;\n            case Key.W: return W;\n            case Key.X: return X;\n            case Key.Y: return Y;\n            case Key.Z: return Z;\n\n            case Key.Number0: return NUMBER_0;\n            case Key.Number1: return NUMBER_1;\n            case Key.Number2: return NUMBER_2;\n            case Key.Number3: return NUMBER_3;\n            case Key.Number4: return NUMBER_4;\n            case Key.Number5: return NUMBER_5;\n            case Key.Number6: return NUMBER_6;\n            case Key.Number7: return NUMBER_7;\n            case Key.Number8: return NUMBER_8;\n            case Key.Number9: return NUMBER_9;\n\n            case Key.Numpad0: return NUMPAD_0;\n            case Key.Numpad1: return NUMPAD_1;\n            case Key.Numpad2: return NUMPAD_2;\n            case Key.Numpad3: return NUMPAD_3;\n            case Key.Numpad4: return NUMPAD_4;\n            case Key.Numpad5: return NUMPAD_5;\n            case Key.Numpad6: return NUMPAD_6;\n            case Key.Numpad7: return NUMPAD_7;\n            case Key.Numpad8: return NUMPAD_8;\n            case Key.Numpad9: return NUMPAD_9;\n\n            case Key.NumpadAdd: return NUMPAD_ADD;\n            case Key.NumpadDecimal: return NUMPAD_DECIMAL;\n            case Key.NumpadDivide: return NUMPAD_DIVIDE;\n            case Key.NumpadEnter: return NUMPAD_ENTER;\n            case Key.NumpadMultiply: return NUMPAD_MULTIPLY;\n            case Key.NumpadSubtract: return NUMPAD_SUBTRACT;\n\n            case Key.F1: return F1;\n            case Key.F2: return F2;\n            case Key.F3: return F3;\n            case Key.F4: return F4;\n            case Key.F5: return F5;\n            case Key.F6: return F6;\n            case Key.F7: return F7;\n            case Key.F8: return F8;\n            case Key.F9: return F9;\n            case Key.F10: return F10;\n            case Key.F11: return F11;\n            case Key.F12: return F12;\n            case Key.F13: return F13;\n            case Key.F14: return F14;\n            case Key.F15: return F15;\n\n            case Key.Left: return LEFT;\n            case Key.Up: return UP;\n            case Key.Right: return RIGHT;\n            case Key.Down: return DOWN;\n\n            case Key.Alt: return ALT;\n            case Key.Backquote: return BACKQUOTE;\n            case Key.Backslash: return BACKSLASH;\n            case Key.Backspace: return BACKSPACE;\n            case Key.CapsLock: return CAPS_LOCK;\n            case Key.Comma: return COMMA;\n            case Key.Command: return COMMAND;\n            case Key.Control: return CONTROL;\n            case Key.Delete: return DELETE;\n            case Key.End: return END;\n            case Key.Enter: return ENTER;\n            case Key.Equals: return EQUALS;\n            case Key.Escape: return ESCAPE;\n            case Key.Home: return HOME;\n            case Key.Insert: return INSERT;\n            case Key.LeftBracket: return LEFT_BRACKET;\n            case Key.Minus: return MINUS;\n            case Key.PageDown: return PAGE_DOWN;\n            case Key.PageUp: return PAGE_UP;\n            case Key.Period: return PERIOD;\n            case Key.Quote: return QUOTE;\n            case Key.RightBracket: return RIGHT_BRACKET;\n            case Key.Semicolon: return SEMICOLON;\n            case Key.Shift: return SHIFT;\n            case Key.Slash: return SLASH;\n            case Key.Space: return SPACE;\n            case Key.Tab: return TAB;\n\n            case Key.Menu: return MENU;\n            case Key.Search: return SEARCH;\n\n            case Key.Unknown(keyCode): return keyCode;\n        }\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.Component;\nimport flambe.Entity;\nimport flambe.System;\nimport flambe.display.Graphics;\nimport flambe.display.Sprite;\nimport flambe.scene.Director;\n\nusing Lambda;\nusing flambe.util.Arrays;\nusing flambe.util.BitSets;\n\n/**\n * Updates all components and renders.\n */\nclass MainLoop\n{\n    public function new ()\n    {\n        _tickables = [];\n    }\n\n    public function update (dt :Float)\n    {\n        if (dt <= 0) {\n            // This can happen on platforms that don't have monotonic timestamps and are prone to\n            // system clock adjustment\n            Log.warn(\"Zero or negative time elapsed since the last frame!\", [\"dt\", dt]);\n            return;\n        }\n        if (dt > 1) {\n            // Clamp deltaTime to a reasonable limit. Games tend not to cope well with huge\n            // deltaTimes. Platforms should skip the next frame after unpausing to prevent sending\n            // huge deltaTimes, but not all environments support detecting an unpause\n            dt = 1;\n        }\n\n        // First update any tickables, folding away nulls\n        var ii = 0;\n        while (ii < _tickables.length) {\n            var t = _tickables[ii];\n            if (t == null || t.update(dt)) {\n                _tickables.splice(ii, 1);\n            } else {\n                ++ii;\n            }\n        }\n\n        System.volume.update(dt);\n\n        updateEntity(System.root, dt);\n    }\n\n    public function render<A> (renderer :InternalRenderer<A>)\n    {\n        var graphics = renderer.graphics;\n        if (graphics != null) {\n            renderer.willRender();\n            Sprite.render(System.root, graphics);\n            renderer.didRender();\n        }\n    }\n\n    public function addTickable (t :Tickable)\n    {\n        _tickables.push(t);\n    }\n\n    public function removeTickable (t :Tickable)\n    {\n        var idx = _tickables.indexOf(t);\n        if (idx >= 0) {\n            // Actual removals only happen in update()\n            _tickables[idx] = null;\n        }\n    }\n\n    private static function updateEntity (entity :Entity, dt :Float)\n    {\n        // Handle update speed adjustment\n        var speed = entity.get(SpeedAdjuster);\n        if (speed != null) {\n            speed._realDt = dt;\n\n            dt *= speed.scale._;\n            if (dt <= 0) {\n                // This entity is paused, avoid descending into children. But do update the speed\n                // adjuster (so it can still be animated)\n                speed.onUpdate(dt);\n                return;\n            }\n        }\n\n        // Update components\n        var p = entity.firstComponent;\n        while (p != null) {\n            var next = p.next;\n            if (!p._flags.contains(Component.STARTED)) {\n                p._flags = p._flags.add(Component.STARTED);\n                p.onStart();\n            }\n            p.onUpdate(dt);\n            p = next;\n        }\n\n        // Update children\n        var p = entity.firstChild;\n        while (p != null) {\n            var next = p.next;\n            updateEntity(p, dt);\n            p = next;\n        }\n    }\n\n    private var _tickables :Array<Tickable>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nclass MathUtil\n{\n    /**\n     * Returns the smallest power of two >= n.\n     */\n    public static function nextPowerOfTwo (n :Int) :Int\n    {\n        var p = 1;\n        while (p < n) {\n            p <<= 1;\n        }\n        return p;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.input.MouseButton;\n\n/**\n * Mouse button codes used internally.\n */\nclass MouseCodes\n{\n    public static inline var LEFT = 0;\n    public static inline var MIDDLE = 1;\n    public static inline var RIGHT = 2;\n\n    public static function toButton (buttonCode :Int) :MouseButton\n    {\n        switch (buttonCode) {\n            case LEFT: return Left;\n            case MIDDLE: return Middle;\n            case RIGHT: return Right;\n        }\n\n        return Unknown(buttonCode);\n    }\n\n    public static function toButtonCode (button :MouseButton) :Int\n    {\n        switch (button) {\n            case Left: return LEFT;\n            case Middle: return MIDDLE;\n            case Right: return RIGHT;\n\n            case Unknown(buttonCode): return buttonCode;\n        }\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.display.BlendMode;\nimport flambe.display.Texture;\n\nclass OverdrawGraphics\n    implements InternalGraphics\n{\n    public function new (impl :InternalGraphics)\n    {\n        _impl = impl;\n    }\n\n    public function save ()\n    {\n        _impl.save();\n    }\n\n    public function translate (x :Float, y :Float)\n    {\n        _impl.translate(x, y);\n    }\n\n    public function scale (x :Float, y :Float)\n    {\n        _impl.scale(x, y);\n    }\n\n    public function rotate (rotation :Float)\n    {\n        _impl.rotate(rotation);\n    }\n\n    public function transform (m00 :Float, m10 :Float, m01 :Float, m11 :Float, m02 :Float, m12 :Float)\n    {\n        _impl.transform(m00, m10, m01, m11, m02, m12);\n    }\n\n    public function multiplyAlpha (factor :Float)\n    {\n        // Ignore\n    }\n\n    public function setAlpha (alpha :Float)\n    {\n        // Ignore\n    }\n\n    public function setBlendMode (blendMode :BlendMode)\n    {\n        // Ignore\n    }\n\n    public function applyScissor (x :Float, y :Float, width :Float, height :Float)\n    {\n        _impl.applyScissor(x, y, width, height);\n    }\n\n    public function restore ()\n    {\n        _impl.restore();\n    }\n\n    public function drawTexture (texture :Texture, destX :Float, destY :Float)\n    {\n        drawRegion(destX, destY, texture.width, texture.height);\n    }\n\n    public function drawSubTexture (texture :Texture, destX :Float, destY :Float,\n        sourceX :Float, sourceY :Float, sourceW :Float, sourceH :Float)\n    {\n        drawRegion(destX, destY, sourceW, sourceH);\n    }\n\n    public function drawPattern (texture :Texture, destX :Float, destY :Float, width :Float, height :Float)\n    {\n        drawRegion(destX, destY, width, height);\n    }\n\n    public function fillRect (color :Int, x :Float, y :Float, width :Float, height :Float)\n    {\n        drawRegion(x, y, width, height);\n    }\n\n    public function willRender ()\n    {\n        _impl.willRender();\n        _impl.save();\n        _impl.setBlendMode(Add);\n    }\n\n    public function didRender ()\n    {\n        _impl.restore();\n        _impl.didRender();\n    }\n\n    public function onResize (width :Int, height :Int)\n    {\n        _impl.onResize(width, height);\n    }\n\n    /** Draws an overdraw region rectangle. */\n    private function drawRegion (x :Float, y :Float, width :Float, height :Float)\n    {\n        _impl.fillRect(0x101008, x, y, width, height);\n    }\n\n    private var _impl :InternalGraphics;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nimport flambe.display.BlendMode;\nimport flambe.display.Graphics;\nimport flambe.display.Texture;\nimport flambe.math.FMath;\n\n// TODO(bruno): Remove pixel snapping once most browsers get canvas acceleration.\nclass CanvasGraphics\n    implements InternalGraphics\n{\n    public function new (canvas :CanvasElement, alpha :Bool)\n    {\n        _canvasCtx = (untyped canvas).getContext(\"2d\", {alpha: alpha});\n    }\n\n    public function save ()\n    {\n        _canvasCtx.save();\n    }\n\n    public function translate (x :Float, y :Float)\n    {\n        _canvasCtx.translate(Std.int(x), Std.int(y));\n    }\n\n    public function scale (x :Float, y :Float)\n    {\n        _canvasCtx.scale(x, y);\n    }\n\n    public function rotate (rotation :Float)\n    {\n        _canvasCtx.rotate(FMath.toRadians(rotation));\n    }\n\n    public function transform (m00 :Float, m10 :Float, m01 :Float, m11 :Float, m02 :Float, m12 :Float)\n    {\n        _canvasCtx.transform(m00, m10, m01, m11, m02, m12);\n    }\n\n    public function restore ()\n    {\n        _canvasCtx.restore();\n    }\n\n    public function drawTexture (texture :Texture, destX :Float, destY :Float)\n    {\n        drawSubTexture(texture, destX, destY, 0, 0, texture.width, texture.height);\n    }\n\n    public function drawSubTexture (texture :Texture, destX :Float, destY :Float,\n        sourceX :Float, sourceY :Float, sourceW :Float, sourceH :Float)\n    {\n        if (_firstDraw) {\n            _firstDraw = false;\n            _canvasCtx.globalCompositeOperation = \"copy\";\n            drawSubTexture(texture, destX, destY, sourceX, sourceY, sourceW, sourceH);\n            _canvasCtx.globalCompositeOperation = \"source-over\";\n            return;\n        }\n\n        var texture :CanvasTexture = cast texture;\n        var root = texture.root;\n        root.assertNotDisposed();\n\n        _canvasCtx.drawImage(root.image,\n            Std.int(texture.rootX+sourceX), Std.int(texture.rootY+sourceY),\n            Std.int(sourceW), Std.int(sourceH),\n            Std.int(destX), Std.int(destY), Std.int(sourceW), Std.int(sourceH));\n    }\n\n    public function drawPattern (texture :Texture, x :Float, y :Float, width :Float, height :Float)\n    {\n        if (_firstDraw) {\n            _firstDraw = false;\n            _canvasCtx.globalCompositeOperation = \"copy\";\n            drawPattern(texture, x, y, width, height);\n            _canvasCtx.globalCompositeOperation = \"source-over\";\n            return;\n        }\n\n        var texture :CanvasTexture = cast texture;\n        var root = texture.root;\n        root.assertNotDisposed();\n\n        _canvasCtx.fillStyle = texture.getPattern();\n        _canvasCtx.fillRect(Std.int(x), Std.int(y), Std.int(width), Std.int(height));\n    }\n\n    public function fillRect (color :Int, x :Float, y :Float, width :Float, height :Float)\n    {\n        if (_firstDraw) {\n            _firstDraw = false;\n            _canvasCtx.globalCompositeOperation = \"copy\";\n            fillRect(color, x, y, width, height);\n            _canvasCtx.globalCompositeOperation = \"source-over\";\n            return;\n        }\n\n        // Convert color into a hex string in the form of #RRGGBB\n        var hex = untyped (0xffffff & color).toString(16);\n        while (hex.length < 6) {\n            hex = \"0\"+hex;\n        }\n        _canvasCtx.fillStyle = \"#\"+hex;\n        _canvasCtx.fillRect(Std.int(x), Std.int(y), Std.int(width), Std.int(height));\n    }\n\n    public function multiplyAlpha (factor :Float)\n    {\n        _canvasCtx.globalAlpha *= factor;\n    }\n\n    public function setAlpha (alpha :Float)\n    {\n        _canvasCtx.globalAlpha = alpha;\n    }\n\n    public function setBlendMode (blendMode :BlendMode)\n    {\n        var op;\n        switch (blendMode) {\n            case Normal: op = \"source-over\";\n            case Add: op = \"lighter\";\n            case Multiply: op = \"multiply\";\n            case Screen: op = \"screen\";\n            case Mask: op = \"destination-in\";\n            case Copy: op = \"copy\";\n        };\n        _canvasCtx.globalCompositeOperation = op;\n    }\n\n    public function applyScissor (x :Float, y :Float, width :Float, height :Float)\n    {\n        _canvasCtx.beginPath();\n        _canvasCtx.rect(Std.int(x), Std.int(y), Std.int(width), Std.int(height));\n        _canvasCtx.clip();\n    }\n\n    public function willRender ()\n    {\n        // Disable blending for the first draw call. This squeezes a bit of performance out of games\n        // that have a single large background sprite, especially on older devices\n        _firstDraw = true;\n    }\n\n    public function didRender ()\n    {\n        // Nothing at all\n    }\n\n    public function onResize (width :Int, height :Int)\n    {\n        // Nothing at all\n    }\n\n    private var _canvasCtx :CanvasRenderingContext2D;\n    private var _firstDraw :Bool = false;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nimport haxe.io.Bytes;\n\nimport flambe.asset.AssetEntry;\nimport flambe.subsystem.RendererSystem;\nimport flambe.util.Assert;\nimport flambe.util.Value;\n\nclass CanvasRenderer\n    implements InternalRenderer<Dynamic>\n{\n    public var type (get, null) :RendererType;\n    public var maxTextureSize (get, null) :Int;\n    public var hasGPU (get, null) :Value<Bool>;\n\n    public var graphics :InternalGraphics;\n\n    public function new (canvas :CanvasElement)\n    {\n        graphics = new CanvasGraphics(canvas, #if flambe_transparent true #else false #end);\n        _hasGPU = new Value<Bool>(true);\n    }\n\n    inline private function get_type () :RendererType\n    {\n        return Canvas;\n    }\n\n    private function get_maxTextureSize () :Int\n    {\n        // Canvases larger than 1024 prevent hardware acceleration in iOS\n        // TODO(bruno): Return 2048 on non-iOS browsers?\n        return 1024;\n    }\n\n    inline private function get_hasGPU () :Value<Bool>\n    {\n        return _hasGPU;\n    }\n\n    public function createTextureFromImage (image :Dynamic) :CanvasTexture\n    {\n        var root = new CanvasTextureRoot(CANVAS_TEXTURES ? HtmlUtil.createCanvas(image) : image);\n        return root.createTexture(root.width, root.height);\n    }\n\n    public function createTexture (width :Int, height :Int) :CanvasTexture\n    {\n        var root = new CanvasTextureRoot(HtmlUtil.createEmptyCanvas(width, height));\n        return root.createTexture(width, height);\n    }\n\n    public function getCompressedTextureFormats () :Array<AssetFormat>\n    {\n        return [];\n    }\n\n    public function createCompressedTexture (format :AssetFormat, data :Bytes) :CanvasTexture\n    {\n        Assert.fail(); // Unsupported\n        return null;\n    }\n\n    public function willRender ()\n    {\n        graphics.willRender();\n    }\n\n    public function didRender ()\n    {\n        graphics.didRender();\n    }\n\n    public function getName () :String\n    {\n        return \"Canvas\";\n    }\n\n    /** If true, blit loaded images to a canvas and use that as the texture. */\n    private static var CANVAS_TEXTURES :Bool = (function () {\n        // On iOS, canvas textures are way faster\n        // http://jsperf.com/drawimage-vs-canvaspattern/8\n        var pattern = ~/(iPhone|iPod|iPad)/;\n        return pattern.match(Browser.window.navigator.userAgent);\n    })();\n\n    private var _hasGPU :Value<Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.html.*;\n\nclass CanvasTexture extends BasicTexture<CanvasTextureRoot>\n{\n    public function new (root :CanvasTextureRoot, width :Int, height :Int)\n    {\n        super(root, width, height);\n    }\n\n    public function getPattern () :CanvasPattern\n    {\n        if (_rootUpdateCount != root.updateCount || _pattern == null) {\n            _rootUpdateCount = root.updateCount;\n            _pattern = root.createPattern(rootX, rootY, width, height);\n        }\n        return _pattern;\n    }\n\n    private var _pattern :CanvasPattern = null;\n    private var _rootUpdateCount :Int = 0;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nimport haxe.io.Bytes;\n\nimport flambe.display.Graphics;\nimport flambe.display.Texture;\n\nclass CanvasTextureRoot extends BasicAsset<CanvasTextureRoot>\n    implements TextureRoot\n{\n    public var width (default, null) :Int;\n    public var height (default, null) :Int;\n\n    // The Image (or sometimes Canvas) used for most draw calls\n    public var image (default, null) :Dynamic;\n\n    public var updateCount :Int = 0;\n\n    public function new (image :Dynamic)\n    {\n        super();\n        this.image = image;\n        width = image.width;\n        height = image.height;\n    }\n\n    public function createTexture (width :Int, height :Int) :CanvasTexture\n    {\n        return new CanvasTexture(this, width, height);\n    }\n\n    public function readPixels (x :Int, y :Int, width :Int, height :Int) :Bytes\n    {\n        assertNotDisposed();\n\n        var data :Array<Int> = cast getContext2d().getImageData(x, y, width, height).data;\n        return Bytes.ofData(data);\n    }\n\n    public function writePixels (pixels :Bytes, x :Int, y :Int, sourceW :Int, sourceH :Int)\n    {\n        assertNotDisposed();\n\n        var ctx2d = getContext2d();\n        var imageData = ctx2d.createImageData(sourceW, sourceH);\n        var data :Dynamic = imageData.data;\n        if (data.set != null) {\n            // Data is a Uint8ClampedArray, copy it in one swoop\n            data.set(pixels.getData());\n        } else {\n            // Data is a normal array, copy it manually\n            var size = 4*sourceW*sourceH;\n            for (ii in 0...size) {\n                data[ii] = pixels.get(ii);\n            }\n        }\n\n        // Draw the pixels, and invalidate our contents\n        ctx2d.putImageData(imageData, x, y);\n        dirtyContents();\n    }\n\n    // Invalidates the cached patterns of all textures using this root\n    inline public function dirtyContents ()\n    {\n        ++updateCount;\n    }\n\n    public function getGraphics () :CanvasGraphics\n    {\n        assertNotDisposed();\n\n        if (_graphics == null) {\n            getContext2d(); // Force conversion\n            _graphics = new InternalGraphics(this);\n        }\n        return _graphics;\n    }\n\n    public function createPattern (x :Int, y :Int, width :Int, height :Int) :CanvasPattern\n    {\n        var ctx2d = getContext2d();\n        var source = image;\n        if (x != 0 || y != 0 || width != this.width || height != this.height) {\n            // Create a temporary canvas if the size doesn't match this root\n            source = HtmlUtil.createEmptyCanvas(width, height);\n            var crop = source.getContext2d();\n            crop.globalCompositeOperation = \"copy\";\n            crop.drawImage(image, -x, -y);\n        }\n        return ctx2d.createPattern(source, \"repeat\");\n    }\n\n    private function getContext2d () :CanvasRenderingContext2D\n    {\n        // Convert the image to a canvas when necessary. Why not have the image be a canvas to\n        // begin with, you ask? Some browsers (notably Android 4) render canvases a LOT slower\n        // than image elements, so we avoid using a canvas unless absolutely necessary. One day\n        // when Android's browser joins the modern age, this can be simplified.\n        // http://jsperf.com/canvas-drawimage\n        if (!Std.is(image, CanvasElement)) {\n            image = HtmlUtil.createCanvas(image);\n        }\n        var canvas :CanvasElement = cast image;\n        return canvas.getContext2d();\n    }\n\n    override private function copyFrom (that :CanvasTextureRoot)\n    {\n        this.image = that.image;\n        this._graphics = that._graphics;\n        dirtyContents();\n    }\n\n    override private function onDisposed ()\n    {\n        image = null;\n        _graphics = null;\n    }\n\n    private var _graphics :CanvasGraphics = null;\n}\n\n// A Graphics that invalidates its texture's cached pattern after every draw call\nprivate class InternalGraphics extends CanvasGraphics\n{\n    public function new (renderTarget :CanvasTextureRoot)\n    {\n        super(renderTarget.image, true);\n        _renderTarget = renderTarget;\n    }\n\n    override public function drawTexture (texture :Texture, x :Float, y :Float)\n    {\n        super.drawTexture(texture, x, y);\n        _renderTarget.dirtyContents();\n    }\n\n    override public function drawSubTexture (texture :Texture, destX :Float, destY :Float,\n        sourceX :Float, sourceY :Float, sourceW :Float, sourceH :Float)\n    {\n        super.drawSubTexture(texture, destX, destY, sourceX, sourceY, sourceW, sourceH);\n        _renderTarget.dirtyContents();\n    }\n\n    override public function drawPattern (texture :Texture, x :Float, y :Float,\n        width :Float, height :Float)\n    {\n        super.drawPattern(texture, x, y, width, height);\n        _renderTarget.dirtyContents();\n    }\n\n    override public function fillRect (color :Int, x :Float, y :Float, width :Float, height :Float)\n    {\n        super.fillRect(color, x, y, width, height);\n        _renderTarget.dirtyContents();\n    }\n\n    private var _renderTarget :CanvasTextureRoot;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nimport haxe.Http;\n\nimport flambe.asset.AssetEntry;\nimport flambe.asset.Manifest;\nimport flambe.util.Assert;\nimport flambe.util.Promise;\nimport flambe.util.Signal0;\nimport flambe.util.Signal1;\n\nclass HtmlAssetPackLoader extends BasicAssetPackLoader\n{\n    public function new (platform :HtmlPlatform, manifest :Manifest)\n    {\n        super(platform, manifest);\n    }\n\n    override private function loadEntry (url :String, entry :AssetEntry)\n    {\n        switch (entry.format) {\n        case WEBP, JXR, PNG, JPG, GIF:\n            var image = Browser.document.createImageElement();\n            var events = new EventGroup();\n\n            events.addDisposingListener(image, \"load\", function (_) {\n#if debug\n                if (image.width > 1024 || image.height > 1024) {\n                    Log.warn(\"Images larger than 1024px on a side will prevent GPU acceleration\" +\n                        \" on some platforms (iOS)\", [\"url\", url,\n                        \"width\", image.width, \"height\", image.height]);\n                }\n#end\n                if (supportsBlob()) {\n                    // Reclaim memory previously allocated by createObjectURL\n                    _URL.revokeObjectURL(image.src);\n                }\n\n                var texture = _platform.getRenderer().createTextureFromImage(image);\n                if (texture != null) {\n                    handleLoad(entry, texture);\n                } else {\n                    handleTextureError(entry);\n                }\n            });\n            events.addDisposingListener(image, \"error\", function (_) {\n                handleError(entry, \"Failed to load image\");\n            });\n\n            // If this browser supports Blob, load the image data over XHR to benefit from progress\n            // events, otherwise just set the src directly\n            if (supportsBlob()) {\n                downloadBlob(url, entry, function (blob) {\n                    image.src = _URL.createObjectURL(blob);\n                });\n            } else {\n                image.src = url;\n            }\n\n        case DDS, PVR, PKM:\n            downloadArrayBuffer(url, entry, function (buffer) {\n                // FIXME(bruno): Convert buffer to a Bytes and pass it along\n                var texture = _platform.getRenderer().createCompressedTexture(entry.format, null);\n                if (texture != null) {\n                    handleLoad(entry, texture);\n                } else {\n                    handleTextureError(entry);\n                }\n            });\n\n        case MP3, M4A, OPUS, OGG, WAV:\n            // If we made it this far, we definitely support audio and can play this asset\n            if (WebAudioSound.supported) {\n                downloadArrayBuffer(url, entry, function (buffer) {\n                    WebAudioSound.ctx.decodeAudioData(buffer, function (decoded) {\n                        handleLoad(entry, new WebAudioSound(decoded));\n                    }, function () {\n                        // Happens in iOS 6 beta for some sounds that should be able to play. It\n                        // seems that monochannel audio will always fail, try converting to stereo.\n                        // Since this happens unpredictably, continue with a DummySound rather than\n                        // rejecting the entire asset pack.\n                        Log.warn(\"Couldn't decode Web Audio, ignoring this asset\", [\"url\", url]);\n                        handleLoad(entry, DummySound.getInstance());\n                    });\n                });\n\n            } else {\n                var audio = Browser.document.createAudioElement();\n                audio.preload = \"auto\"; // Hint that we want to preload the entire file\n\n                // Maintain a hard reference to the audio during loading to prevent GC on some\n                // browsers\n                var ref = ++_mediaRefCount;\n                if (_mediaElements == null) {\n                    _mediaElements = new Map<Int,Dynamic>();\n                }\n                _mediaElements.set(ref, audio);\n\n                var events = new EventGroup();\n                events.addDisposingListener(audio, \"canplaythrough\", function (_) {\n                    _mediaElements.remove(ref);\n                    handleLoad(entry, new HtmlSound(audio));\n                });\n                events.addDisposingListener(audio, \"error\", function (_) {\n                    _mediaElements.remove(ref);\n                    var code = audio.error.code;\n                    if (code == 3 || code == 4) {\n                        // If the song successfully downloaded but this browser can't play it for\n                        // some reason (MEDIA_ERR_DECODE or MEDIA_ERR_SRC_NOT_SUPPORTED), warn and\n                        // press on with an empty sound.\n                        Log.warn(\"Couldn't decode HTML5 audio, ignoring this asset\",\n                            [\"url\", url, \"code\", code]);\n                        handleLoad(entry, DummySound.getInstance());\n                    } else {\n                        handleError(entry, \"Failed to load audio: \" + audio.error.code);\n                    }\n                });\n                events.addListener(audio, \"progress\", function (_) {\n                    if (audio.buffered.length > 0 && audio.duration > 0) {\n                        // Estimate the bytes downloaded based on the available time range\n                        var progress = audio.buffered.end(0) / audio.duration;\n                        handleProgress(entry, Std.int(progress*entry.bytes));\n                    }\n                });\n\n                audio.src = url;\n                audio.load();\n            }\n\n        case Data:\n            downloadText(url, entry, function (text) {\n                handleLoad(entry, new BasicFile(text));\n            });\n        }\n    }\n\n    override private function getAssetFormats (fn :Array<AssetFormat> -> Void)\n    {\n        if (_supportedFormats == null) {\n            _supportedFormats = new Promise();\n            detectImageFormats(function (imageFormats) {\n                _supportedFormats.result = _platform.getRenderer().getCompressedTextureFormats()\n                    .concat(imageFormats).concat(detectAudioFormats()).concat([Data]);\n            });\n        }\n        _supportedFormats.get(fn);\n    }\n\n    inline private function downloadArrayBuffer (url :String, entry :AssetEntry, onLoad :ArrayBuffer -> Void)\n    {\n        download(url, entry, \"arraybuffer\", onLoad);\n    }\n\n    inline private function downloadBlob (url :String, entry :AssetEntry, onLoad :Blob -> Void)\n    {\n        download(url, entry, \"blob\", onLoad);\n    }\n\n    inline private function downloadText (url :String, entry :AssetEntry, onLoad :String -> Void)\n    {\n        download(url, entry, \"text\", onLoad);\n    }\n\n    private function download (url :String, entry :AssetEntry, responseType :String, onLoad :Dynamic -> Void)\n    {\n        var xhr :XMLHttpRequest = null;\n        var start = null;\n\n        var intervalId = 0;\n        var hasInterval = false;\n        var clearRetryInterval = function () {\n            if (hasInterval) {\n                hasInterval = false;\n                Browser.window.clearInterval(intervalId);\n            }\n        };\n\n        var retries = XHR_RETRIES;\n        var maybeRetry = function () {\n            // Returns true if the download was retried\n            --retries;\n            if (retries >= 0) {\n                Log.warn(\"Retrying asset download\", [\"url\", entry.url]);\n                start();\n                return true;\n            }\n            return false;\n        };\n\n        start = function () {\n            clearRetryInterval();\n\n            if (xhr != null) {\n                xhr.abort();\n            }\n            xhr = new XMLHttpRequest();\n            xhr.open(\"GET\", url, true);\n            xhr.responseType = responseType;\n\n            var lastProgress = 0.0;\n            xhr.onprogress = function (event :ProgressEvent) {\n                // When the first progress event comes in, start detecting stalled downloads\n                if (!hasInterval) {\n                    hasInterval = true;\n                    intervalId = Browser.window.setInterval(function () {\n                        // If the download isn't finished, and enough time has passed since the last\n                        // progress event, consider it stalled and attempt to retry\n                        if (xhr.readyState != XMLHttpRequest.DONE && HtmlUtil.now() - lastProgress > XHR_TIMEOUT) {\n                            if (!maybeRetry()) {\n                                clearRetryInterval();\n                                handleError(entry, \"Download stalled\");\n                            }\n                        }\n                    }, 1000);\n                }\n\n                lastProgress = HtmlUtil.now();\n                handleProgress(entry, event.loaded);\n            };\n\n            xhr.onerror = function (_) {\n                if (xhr.status != 0 || !maybeRetry()) {\n                    clearRetryInterval();\n                    handleError(entry, \"HTTP error \" + xhr.status);\n                }\n            };\n\n            xhr.onload = function (_) {\n                var response :Dynamic = xhr.response;\n                if (response == null) {\n                    // Hack for IE9, which doesn't have xhr.response, only responseText\n                    response = xhr.responseText;\n                }\n                clearRetryInterval();\n                onLoad(response);\n            };\n\n            xhr.send();\n        };\n\n        start();\n    }\n\n    private static function detectImageFormats (fn :Array<AssetFormat> -> Void)\n    {\n        var formats = [PNG, JPG, GIF];\n\n        var formatTests = 2;\n        var checkRemaining = function () {\n            // Called when an image test completes\n            --formatTests;\n            if (formatTests == 0) {\n                fn(formats);\n            }\n        };\n\n        // Detect WebP-lossless support (and assume that lossy works where lossless does)\n        // https://github.com/Modernizr/Modernizr/blob/master/feature-detects/img/webp-lossless.js\n        var webp = Browser.document.createImageElement();\n        webp.onload = webp.onerror = function (_) {\n            if (webp.width == 1) {\n                formats.unshift(WEBP);\n            }\n            checkRemaining();\n        };\n        webp.src = \"data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==\";\n\n        // Detect JPEG XR support\n        var jxr = Browser.document.createImageElement();\n        jxr.onload = jxr.onerror = function (_) {\n            if (jxr.width == 1) {\n                formats.unshift(JXR);\n            }\n            checkRemaining();\n        };\n        // The smallest JXR I could generate (where pixel.tif is a 1x1 black image)\n        // ./jpegxr pixel.tif -c -o pixel.jxr -f YOnly -q 255 -b DCONLY -a 0 -w\n        jxr.src = \"data:image/vnd.ms-photo;base64,SUm8AQgAAAAFAAG8AQAQAAAASgAAAIC8BAABAAAAAQAAAIG8BAABAAAAAQAAAMC8BAABAAAAWgAAAMG8BAABAAAAHwAAAAAAAAAkw91vA07+S7GFPXd2jckNV01QSE9UTwAZAYBxAAAAABP/gAAEb/8AAQAAAQAAAA==\";\n    }\n\n    private static function detectAudioFormats () :Array<AssetFormat>\n    {\n        // Detect basic support for HTML5 audio\n        var audio = Browser.document.createAudioElement();\n        if (audio == null || audio.canPlayType == null) {\n            Log.warn(\"Audio is not supported at all in this browser!\");\n            return [];\n        }\n\n        // Reject browsers that claim to support audio, but are too buggy or incomplete\n#if flambe_html_audio_fix\n        var blacklist = ~/\\b(iPhone|iPod|iPad|Windows Phone)\\b/;\n#else\n        var blacklist = ~/\\b(iPhone|iPod|iPad|Android|Windows Phone)\\b/;\n#end\n        var userAgent = Browser.navigator.userAgent;\n        if (!WebAudioSound.supported && blacklist.match(userAgent)) {\n            Log.warn(\"HTML5 audio is blacklisted for this browser\", [\"userAgent\", userAgent]);\n            return [];\n        }\n\n        // Select what formats the browser supports\n        var types = [\n            { format: M4A,  mimeType: \"audio/mp4; codecs=mp4a\" },\n            { format: MP3,  mimeType: \"audio/mpeg\" },\n            { format: OPUS, mimeType: \"audio/ogg; codecs=opus\" },\n            { format: OGG,  mimeType: \"audio/ogg; codecs=vorbis\" },\n            { format: WAV,  mimeType: \"audio/wav\" },\n        ];\n#if flambe_disable_firefox_mp3\n        // Temporary hack to disable Firefox MP3 loading. This will no longer be necessary after\n        // Firefox 28: https://bugzilla.mozilla.org/show_bug.cgi?id=967007\n        if (userAgent.indexOf(\"Gecko/\") >= 0) {\n            types.splice(1, 1);\n        }\n#end\n        var result = [];\n        for (type in types) {\n            // IE9's canPlayType() will throw an error in some rare cases:\n            // https://github.com/Modernizr/Modernizr/issues/224\n            var canPlayType = \"\";\n            try canPlayType = audio.canPlayType(type.mimeType)\n            catch (_ :Dynamic) {}\n\n            if (canPlayType != \"\") {\n                result.push(type.format);\n            }\n        }\n        return result;\n    }\n\n    private static function supportsBlob () :Bool\n    {\n        // Checks for XHR Blob responseType support\n        // http://html5test.com/compare/feature/communication-xmlhttprequest2.response-blob/communication-websocket.binary.html\n        if (_detectBlobSupport) {\n            _detectBlobSupport = false;\n\n            // Blobs on Amazon Silk are buggy: https://github.com/aduros/flambe/issues/194\n            if (~/\\bSilk\\b/.match(Browser.navigator.userAgent)) {\n                return false;\n            }\n\n            if ((untyped Browser.window).Blob == null) {\n                return false; // No Blob constructor\n            }\n\n            var xhr = new XMLHttpRequest();\n            // Hack for IE, which throws an InvalidStateError upon setting the responseType when\n            // in the UNSENT state, despite the spec being clear about only throwing in LOADING\n            // or DONE: http://www.w3.org/TR/XMLHttpRequest2/#dom-xmlhttprequest-responsetype\n            //\n            // Forcing it into the OPENED state does the trick, and doesn't actually send the\n            // request so it's all good.\n            xhr.open(\"GET\", \".\", true);\n\n            if (xhr.responseType != \"\") {\n                return false; // No responseType supported at all\n            }\n            xhr.responseType = \"blob\";\n            if (xhr.responseType != \"blob\") {\n                return false; // Blob responseType not supported\n            }\n\n            _URL = HtmlUtil.loadExtension(\"URL\").value;\n        }\n        return _URL != null && _URL.createObjectURL != null;\n    }\n\n    private static inline var XHR_TIMEOUT = 5000;\n    private static inline var XHR_RETRIES = 3;\n\n    private static var _supportedFormats :Promise<Array<AssetFormat>> = null;\n\n    /**\n     * Media elements get GCed during loading in Chrome and IE9. The spec is clear that elements\n     * shouldn't be GCed while playing, but vague about GCing while loading. So, maintain a hard\n     * reference to all media elements being loaded to prevent GC.\n     */\n    private static var _mediaElements :Map<Int,Dynamic>;\n    private static var _mediaRefCount = 0;\n\n    private static var _detectBlobSupport = true;\n    private static var _URL :Dynamic = null;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nclass HtmlCatapultClient extends CatapultClient\n{\n    public static function canUse () :Bool\n    {\n        return Reflect.hasField(Browser.window, \"WebSocket\");\n    }\n\n    public function new ()\n    {\n        super();\n\n        _socket = new WebSocket(\"ws://\" + Browser.location.host);\n        _socket.onerror = function (event) {\n            onError(\"unknown\");\n        };\n        _socket.onopen = function (event) {\n            Log.info(\"Catapult connected\");\n        };\n        _socket.onmessage = function (event :MessageEvent) {\n            onMessage(event.data);\n        };\n    }\n\n    override private function onRestart ()\n    {\n        Browser.window.top.location.reload();\n    }\n\n    private var _socket :WebSocket;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\n\nimport flambe.subsystem.ExternalSystem;\n\nclass HtmlExternal\n    implements ExternalSystem\n{\n    public var supported (get, null) :Bool;\n\n    public function new ()\n    {\n    }\n\n    public function get_supported ()\n    {\n        return true;\n    }\n\n    public function call (name :String, ?params :Array<Dynamic>) :Dynamic\n    {\n        if (params == null) {\n            params = [];\n        }\n\n        var object = Browser.window;\n        var method = object;\n        for (fieldName in name.split(\".\")) {\n            object = method;\n            method = Reflect.field(object, fieldName);\n        }\n        return Reflect.callMethod(object, method, params);\n    }\n\n    public function bind (name :String, fn :Dynamic)\n    {\n        Reflect.setField(Browser.window, name, fn);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport flambe.util.Logger;\n\nclass HtmlLogHandler\n    implements LogHandler\n{\n    public static function isSupported () :Bool\n    {\n        return untyped __js__(\"typeof console\") == \"object\" && __js__(\"console\").info != null;\n    }\n\n    public function new (tag :String)\n    {\n        _tagPrefix = tag + \": \";\n    }\n\n    public function log (level :LogLevel, message :String)\n    {\n        message = _tagPrefix + message;\n\n        switch (level) {\n        case Info:\n            (untyped __js__(\"console\")).info(message);\n        case Warn:\n            (untyped __js__(\"console\")).warn(message);\n        case Error:\n            (untyped __js__(\"console\")).error(message);\n        }\n    }\n\n    private var _tagPrefix :String;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport flambe.input.MouseCursor;\n\nclass HtmlMouse extends BasicMouse\n{\n    public function new (pointer :BasicPointer, canvas :Dynamic)\n    {\n        super(pointer);\n        _canvas = canvas;\n    }\n\n    override public function set_cursor (cursor :MouseCursor) :MouseCursor\n    {\n        var name;\n        switch (cursor) {\n            case Default: name = \"\"; // inherit\n            case Button: name = \"pointer\";\n            case None: name = \"none\";\n        }\n        _canvas.style.cursor = name;\n\n        return super.set_cursor(cursor);\n    }\n\n    private var _canvas :Dynamic;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\n\nimport flambe.animation.AnimatedFloat;\nimport flambe.platform.Tickable;\nimport flambe.sound.Playback;\nimport flambe.sound.Sound;\nimport flambe.util.Disposable;\nimport flambe.util.Value;\n\nclass HtmlSound extends BasicAsset<HtmlSound>\n    implements Sound\n{\n    public var duration (get, null) :Float;\n    public var audioElement :Dynamic; // TODO(bruno): Use typed audio element extern\n\n    public function new (audioElement :Dynamic)\n    {\n        super();\n        this.audioElement = audioElement;\n    }\n\n    public function play (volume :Float = 1.0) :Playback\n    {\n        assertNotDisposed();\n\n        return new HtmlPlayback(this, volume, false);\n    }\n\n    public function loop (volume :Float = 1.0) :Playback\n    {\n        assertNotDisposed();\n\n        return new HtmlPlayback(this, volume, true);\n    }\n\n    public function get_duration () :Float\n    {\n        assertNotDisposed();\n\n        return audioElement.duration;\n    }\n\n    override private function copyFrom (that :HtmlSound)\n    {\n        this.audioElement = that.audioElement;\n    }\n\n    override private function onDisposed ()\n    {\n        audioElement = null;\n    }\n}\n\nprivate class HtmlPlayback\n    implements Playback\n    implements Tickable\n{\n    public var volume (default, null) :AnimatedFloat;\n    public var paused (get, set) :Bool;\n    public var complete (get, null) :Value<Bool>;\n    public var position (get, null) :Float;\n    public var sound (get, null) :Sound;\n\n    public function new (sound :HtmlSound, volume :Float, loop :Bool)\n    {\n        _sound = sound;\n        _tickableAdded = false;\n\n        // Create a copy of the original sound's element. Note that cloneNode() doesn't work in IE\n        _clonedElement = Browser.document.createAudioElement();\n        _clonedElement.loop = loop;\n        _clonedElement.src = sound.audioElement.src;\n\n        this.volume = new AnimatedFloat(volume, function (_,_) updateVolume());\n        updateVolume();\n        _complete = new Value<Bool>(false);\n\n        playAudio();\n\n        // Don't start playing until visible\n        if (System.hidden._) {\n            paused = true;\n        }\n    }\n\n    public function get_sound () :Sound\n    {\n        return _sound;\n    }\n\n    inline public function get_paused () :Bool\n    {\n        return _clonedElement.paused;\n    }\n\n    public function set_paused (paused :Bool) :Bool\n    {\n        if (_clonedElement.paused != paused) {\n            if (paused) {\n                _clonedElement.pause();\n            } else {\n                playAudio();\n            }\n        }\n        return paused;\n    }\n\n    public function get_complete () :Value<Bool>\n    {\n        return _complete;\n    }\n\n    public function get_position () :Float\n    {\n        return _clonedElement.currentTime;\n    }\n\n    public function update (dt :Float) :Bool\n    {\n        volume.update(dt);\n        _complete._ = _clonedElement.ended;\n\n        if (_complete._ || paused) {\n            // Allow complete or paused sounds to be garbage collected\n            _tickableAdded = false;\n\n            // Release System references\n            _volumeBinding.dispose();\n            _hideBinding.dispose();\n\n            return true;\n        }\n        return false;\n    }\n\n    public function dispose ()\n    {\n        paused = true;\n        _complete._ = true;\n    }\n\n    private function playAudio ()\n    {\n        #if flambe_html_audio_fix\n        // Only allow looping audio to play\n        // Assumes background music loops\n        if (!_clonedElement.loop) {\n            return;\n        }\n\n        // Only allow one background music\n        if (HtmlPlatform.instance.musicPlaying) {\n            return;\n        }\n        HtmlPlatform.instance.musicPlaying = true;\n        #end\n\n        _clonedElement.play();\n\n        if (!_tickableAdded) {\n            HtmlPlatform.instance.mainLoop.addTickable(this);\n            _tickableAdded = true;\n\n            // Claim System references\n            _volumeBinding = System.volume.changed.connect(function(_,_) updateVolume());\n            _hideBinding = System.hidden.changed.connect(function(hidden,_) {\n                if (hidden) {\n                    _wasPaused = get_paused();\n                    this.paused = true;\n                } else {\n                    this.paused = _wasPaused;\n                }\n            });\n        }\n    }\n\n    private function updateVolume ()\n    {\n        _clonedElement.volume = System.volume._ * volume._;\n    }\n\n    private var _sound :HtmlSound;\n    private var _clonedElement :Dynamic;\n    private var _volumeBinding :Disposable;\n    private var _tickableAdded :Bool;\n    private var _hideBinding :Disposable;\n    private var _wasPaused :Bool;\n\n    private var _complete :Value<Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nimport flambe.display.Orientation;\nimport flambe.subsystem.StageSystem;\nimport flambe.util.Signal0;\nimport flambe.util.Value;\n\nclass HtmlStage\n    implements StageSystem\n{\n    public var width (get, null) :Int;\n    public var height (get, null) :Int;\n    public var orientation (default, null) :Value<Orientation>;\n    public var fullscreen (default, null) :Value<Bool>;\n    public var fullscreenSupported (get, null) :Bool;\n\n    public var resize (default, null) :Signal0;\n\n    public var scaleFactor (default, null) :Float;\n\n    public function new (canvas :CanvasElement)\n    {\n        _canvas = canvas;\n        resize = new Signal0();\n\n#if flambe_disable_html_retina\n        scaleFactor = 1;\n#else\n        // If the DPI is being scaled by the browser, reverse it so that one canvas pixel equals\n        // one screen pixel\n        scaleFactor = computeScaleFactor();\n        if (scaleFactor != 1) {\n            Log.info(\"Reversing device DPI scaling\", [\"scaleFactor\", scaleFactor]);\n            HtmlUtil.setVendorStyle(_canvas, \"transform-origin\", \"top left\");\n            HtmlUtil.setVendorStyle(_canvas, \"transform\", \"scale(\" + (1/scaleFactor) + \")\");\n        }\n#end\n\n#if !flambe_disable_autoresize\n        if (HtmlUtil.SHOULD_HIDE_MOBILE_BROWSER) {\n            Browser.window.addEventListener(\"orientationchange\", function (_) {\n                // Wait for the orientation change to finish... sigh\n                HtmlUtil.callLater(hideMobileBrowser, 200);\n            }, false);\n            hideMobileBrowser();\n        }\n\n        Browser.window.addEventListener(\"resize\", onWindowResize, false);\n        onWindowResize(null);\n#end\n\n        orientation = new Value<Orientation>(null);\n        if ((untyped Browser.window).orientation != null) {\n            Browser.window.addEventListener(\"orientationchange\", onOrientationChange, false);\n            onOrientationChange(null);\n        }\n\n        fullscreen = new Value<Bool>(false);\n        HtmlUtil.addVendorListener(Browser.document, \"fullscreenchange\", function (_) {\n            updateFullscreen();\n        }, false);\n#if debug\n        HtmlUtil.addVendorListener(Browser.document, \"fullscreenerror\", function (_) {\n            // No useful error message since the event provides no reason. See the error conditions\n            // at http://dvcs.w3.org/hg/fullscreen/raw-file/tip/Overview.html#dom-element-requestfullscreen\n            Log.warn(\"Error when requesting fullscreen\");\n        }, false);\n#end\n        updateFullscreen();\n    }\n\n    public function get_width () :Int\n    {\n        return _canvas.width;\n    }\n\n    public function get_height () :Int\n    {\n        return _canvas.height;\n    }\n\n    public function get_fullscreenSupported () :Bool\n    {\n        return HtmlUtil.loadFirstExtension(\n            [\"fullscreenEnabled\", \"fullScreenEnabled\"], Browser.document).value == true;\n    }\n\n    public function lockOrientation (orient :Orientation)\n    {\n        var lockOrientation = HtmlUtil.loadExtension(\"lockOrientation\", Browser.window.screen).value;\n        if (lockOrientation != null) {\n            var htmlOrient = switch (orient) {\n                case Portrait: \"portrait\";\n                case Landscape: \"landscape\";\n            };\n            var allowed = Reflect.callMethod(Browser.window.screen, lockOrientation, [htmlOrient]);\n            if (!allowed) {\n                Log.warn(\"The request to lockOrientation() was refused by the browser\");\n            }\n        }\n    }\n\n    public function unlockOrientation ()\n    {\n        var unlockOrientation = HtmlUtil.loadExtension(\"unlockOrientation\", Browser.window.screen).value;\n        if (unlockOrientation != null) {\n            Reflect.callMethod(Browser.window.screen, unlockOrientation, []);\n        }\n    }\n\n    public function requestResize (width :Int, height :Int)\n    {\n        if (resizeCanvas(width, height)) {\n            // Fit the container to the requested canvas size\n            var container = _canvas.parentElement;\n            container.style.width = width + \"px\";\n            container.style.height = height + \"px\";\n        }\n    }\n\n    public function requestFullscreen (enable :Bool = true)\n    {\n        if (enable) {\n            var documentElement = Browser.document.documentElement;\n            var requestFullscreen = HtmlUtil.loadFirstExtension(\n               [\"requestFullscreen\", \"requestFullScreen\"], documentElement).value;\n            if (requestFullscreen != null) {\n                Reflect.callMethod(documentElement, requestFullscreen, []);\n            }\n\n        } else {\n            var cancelFullscreen = HtmlUtil.loadFirstExtension(\n                [\"cancelFullscreen\", \"cancelFullScreen\"], Browser.document).value;\n            if (cancelFullscreen != null) {\n                Reflect.callMethod(Browser.document, cancelFullscreen, []);\n            }\n        }\n    }\n\n    private function onWindowResize (_)\n    {\n        // Resize the canvas to match its container's bounds\n        var container = _canvas.parentElement;\n        var rect = container.getBoundingClientRect();\n        resizeCanvas(rect.width, rect.height);\n    }\n\n    private function resizeCanvas (width :Float, height :Float) :Bool\n    {\n        // Take device scaling into account...\n        var scaledWidth = scaleFactor*width;\n        var scaledHeight = scaleFactor*height;\n\n        if (_canvas.width == scaledWidth && _canvas.height == scaledHeight) {\n            return false;\n        }\n\n        _canvas.width = Std.int(scaledWidth);\n        _canvas.height = Std.int(scaledHeight);\n        resize.emit();\n        return true;\n    }\n\n    // Voodoo hacks required to move the address bar out of the way on Android and iOS\n    private function hideMobileBrowser ()\n    {\n        // The maximum size of the part of the browser that can be scrolled away\n        var mobileAddressBar = 100;\n\n        var htmlStyle = Browser.document.documentElement.style;\n\n        // Force the page to be tall enough to scroll\n        htmlStyle.height = (Browser.window.innerHeight + mobileAddressBar) + \"px\";\n        htmlStyle.width = Browser.window.innerWidth + \"px\";\n        htmlStyle.overflow = \"visible\"; // Need to have overflow to scroll...\n\n        HtmlUtil.callLater(function () {\n            // Scroll the address bar away\n            HtmlUtil.hideMobileBrowser();\n\n            HtmlUtil.callLater(function () {\n                // Fit the page to the new screen size\n                htmlStyle.height = Browser.window.innerHeight + \"px\";\n\n                onWindowResize(null);\n            }, 100);\n        });\n    }\n\n    private function onOrientationChange (_)\n    {\n        var value = HtmlUtil.orientation((untyped Browser.window).orientation);\n        orientation._ = value;\n    }\n\n    private function updateFullscreen ()\n    {\n        var state :Dynamic = HtmlUtil.loadFirstExtension(\n            [\"fullscreen\", \"fullScreen\", \"isFullScreen\"], Browser.document).value;\n        fullscreen._ = (state == true); // state will be null if fullscreen not supported\n    }\n\n    private static function computeScaleFactor () :Float\n    {\n        // Based on \"Delivering Web Content on High Resolution Displays\"\n        // https://developer.apple.com/videos/wwdc/2012/?id=602\n\n        var devicePixelRatio = Browser.window.devicePixelRatio;\n        if (devicePixelRatio == null) {\n            devicePixelRatio = 1;\n        }\n\n        // Take into account any behind-the-scenes scaling of canvas elements\n        var canvas = Browser.document.createCanvasElement();\n        var ctx = canvas.getContext2d();\n        var backingStorePixelRatio = HtmlUtil.loadExtension(\"backingStorePixelRatio\", ctx).value;\n        if (backingStorePixelRatio == null) {\n            backingStorePixelRatio = 1;\n        }\n\n        // Calculate the scale, but bail early if this would cause the canvas to be larger than some\n        // magic threshold. This was added to disable the retina display on the iPad 3, as\n        // performance plummets there when scaling such a huge canvas\n        var scale = devicePixelRatio / backingStorePixelRatio;\n        var screenWidth = Browser.window.screen.width;\n        var screenHeight = Browser.window.screen.height;\n        if (scale*screenWidth > 1136 || scale*screenHeight > 1136) {\n            return 1;\n        }\n        return scale;\n    }\n\n    private var _canvas :CanvasElement;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\nimport js.html.webgl.RenderingContext;\n\nimport flambe.display.Orientation;\n\nclass HtmlUtil\n{\n    public static var VENDOR_PREFIXES = [\"webkit\", \"moz\", \"ms\", \"o\", \"khtml\"];\n\n    /**\n     * Whether the annoying scrolling address bar in some iOS and Android browsers may be hidden.\n     */\n    public static var SHOULD_HIDE_MOBILE_BROWSER =\n#if !flambe_disable_hide_mobile_browser\n        Browser.window.top == Browser.window &&\n        ~/Mobile(\\/.*)? Safari/.match(Browser.navigator.userAgent);\n#else\n        false;\n#end\n\n    public static function callLater (func :Void -> Void, delay :Int = 0)\n    {\n        Browser.window.setTimeout(func, delay);\n    }\n\n    public static function hideMobileBrowser ()\n    {\n        Browser.window.scrollTo(1, 0);\n    }\n\n    // Load a prefixed vendor extension\n    public static function loadExtension (\n        name :String, ?obj :Dynamic) :{ prefix :String, field :String, value :Dynamic }\n    {\n        if (obj == null) {\n            obj = Browser.window;\n        }\n\n        // Try to load it as is\n        var extension = Reflect.field(obj, name);\n        if (extension != null) {\n            return {prefix: \"\", field: name, value: extension};\n        }\n\n        // Look through common vendor prefixes\n        var capitalized = name.charAt(0).toUpperCase() + name.substr(1);\n        for (prefix in VENDOR_PREFIXES) {\n            var field = prefix + capitalized;\n            var extension = Reflect.field(obj, field);\n            if (extension != null) {\n                return {prefix: prefix, field: field, value: extension};\n            }\n        }\n\n        // Not found\n        return {prefix: null, field: null, value: null};\n    }\n\n    public static function loadFirstExtension (\n        names :Array<String>, ?obj :Dynamic) :{ prefix :String, field :String, value :Dynamic }\n    {\n        for (name in names) {\n            var extension = loadExtension(name, obj);\n            if (extension.field != null) {\n                return extension;\n            }\n        }\n\n        // Not found\n        return {prefix: null, field: null, value: null};\n    }\n\n    // Loads a vendor extension and jams it into the supplied object\n    public static function polyfill (name :String, ?obj :Dynamic) :Bool\n    {\n        if (obj == null) {\n            obj = Browser.window;\n        }\n\n        var value = loadExtension(name, obj).value;\n        if (value == null) {\n            return false;\n        }\n        Reflect.setField(obj, name, value);\n        return true;\n    }\n\n    public static function setVendorStyle (element :Dynamic, name :String, value :String)\n    {\n        var style = element.style;\n        for (prefix in VENDOR_PREFIXES) {\n            style.setProperty(\"-\" + prefix + \"-\" + name, value);\n        }\n        style.setProperty(name, value);\n    }\n\n    public static function addVendorListener (dispatcher :EventTarget, type :String,\n        listener :Dynamic -> Void, useCapture :Bool)\n    {\n        for (prefix in VENDOR_PREFIXES) {\n            dispatcher.addEventListener(prefix + type, listener, useCapture);\n        }\n        dispatcher.addEventListener(type, listener, useCapture);\n    }\n\n    /**\n     * Get a Flambe orientation from a window.orientation angle.\n     */\n    public static function orientation (angle :Int) :Orientation\n    {\n        switch (angle) {\n            case -90, 90: return Landscape;\n            default: return Portrait;\n        }\n    }\n\n    /** Gets the current time in milliseconds since the Unix epoch. */\n    inline public static function now () :Float\n    {\n        // Same thing as Date.now().getTime(), but avoids creating a Date object\n        return (untyped Date).now();\n    }\n\n    public static function createEmptyCanvas (width :Int, height :Int) :CanvasElement\n    {\n        var canvas = Browser.document.createCanvasElement();\n        canvas.width = width;\n        canvas.height = height;\n        return canvas;\n    }\n\n    public static function createCanvas (source :CanvasElement) :CanvasElement\n    {\n        var canvas = createEmptyCanvas(source.width, source.height);\n\n        var ctx = canvas.getContext2d();\n        ctx.save();\n        ctx.globalCompositeOperation = \"copy\";\n        ctx.drawImage(source, 0, 0);\n        ctx.restore();\n\n        return canvas;\n    }\n\n    public static function detectSlowDriver (gl :RenderingContext) :Bool\n    {\n        // Try to detect SwiftShader. There will be some false positives here, but falling back to\n        // canvas in those cases is better than using WebGL on a software driver.\n        // http://stackoverflow.com/questions/10456491/detect-swiftshader-webgl-renderer-in-chrome-18\n        //\n        // TODO(bruno): Use http://www.khronos.org/registry/webgl/extensions/WEBGL_debug_renderer_info/\n\n        var windows = (Browser.navigator.platform.indexOf(\"Win\") >= 0);\n        if (windows) {\n            var chrome = ((untyped Browser.window).chrome != null);\n            if (chrome) {\n                for (ext in gl.getSupportedExtensions()) {\n                    if (ext.indexOf(\"WEBGL_compressed_texture\") >= 0) {\n                        return false;\n                    }\n                }\n                return true;\n            }\n        }\n        return false;\n    }\n\n    public static function fixAndroidMath ()\n    {\n        // Some versions of V8 on ARM (like the one in the stock Android 4 browser) are affected by\n        // this nasty bug: https://code.google.com/p/v8/issues/detail?id=2234\n        //\n        // So, hack around it. This doesn't affect Android 2. Hopefully 5 will use an updated V8\n        // with the real fix.\n\n        if (Browser.navigator.userAgent.indexOf(\"Linux; U; Android 4\") >= 0) {\n            Log.warn(\"Monkey patching around Android sin/cos bug\");\n            var sin = Math.sin, cos = Math.cos;\n            (untyped Math).sin = function (x) {\n                return (x == 0) ? 0 : sin(x);\n            };\n            (untyped Math).cos = function (x) {\n                return (x == 0) ? 1 : cos(x);\n            }\n        }\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport flambe.animation.AnimatedFloat;\nimport flambe.platform.Tickable;\nimport flambe.sound.Playback;\nimport flambe.sound.Sound;\nimport flambe.util.Disposable;\nimport flambe.util.Value;\n\nclass WebAudioSound extends BasicAsset<WebAudioSound>\n    implements Sound\n{\n    public static var supported (get, null) :Bool;\n\n    /**\n     * The shared AudioContext.\n     */\n    public static var ctx :Dynamic = null;\n\n    /**\n     * The shared gain node for global system volume.\n     */\n    public static var gain :Dynamic;\n\n    public var duration (get, null) :Float;\n\n    public var buffer :Dynamic;\n\n    public function new (buffer :Dynamic)\n    {\n        super();\n        this.buffer = buffer;\n    }\n\n    public function play (volume :Float = 1.0) :Playback\n    {\n        assertNotDisposed();\n\n        return new WebAudioPlayback(this, volume, false);\n    }\n\n    public function loop (volume :Float = 1.0) :Playback\n    {\n        assertNotDisposed();\n\n        return new WebAudioPlayback(this, volume, true);\n    }\n\n    public function get_duration () :Float\n    {\n        assertNotDisposed();\n\n        return buffer.duration;\n    }\n\n    override private function copyFrom (that :WebAudioSound)\n    {\n        this.buffer = that.buffer;\n    }\n\n    override private function onDisposed ()\n    {\n        buffer = null;\n    }\n\n    private static function get_supported () :Bool\n    {\n        if (_detectSupport) {\n            _detectSupport = false;\n\n            var AudioContext = HtmlUtil.loadExtension(\"AudioContext\").value;\n            if (AudioContext != null) {\n                ctx = untyped __new__(AudioContext);\n                gain = createGain();\n                gain.connect(ctx.destination);\n\n                System.volume.watch(function(volume, _) {\n                    gain.gain.value = volume;\n                });\n            }\n        }\n\n        return ctx != null;\n    }\n\n    public static function createGain () :Dynamic\n    {\n        // Fall back to createGainNode used in iOS Safari\n        // https://developer.mozilla.org/en-US/docs/Web_Audio_API/Porting_webkitAudioContext_code_to_standards_based_AudioContext\n        return (ctx.createGain != null) ? ctx.createGain() : ctx.createGainNode();\n    }\n\n    public static function start (node :Dynamic, time :Float)\n    {\n        // Fall back to noteOn used in iOS Safari\n        if (node.start != null) {\n            node.start(time);\n        } else {\n            node.noteOn(time);\n        }\n    }\n\n    private static var _detectSupport = true;\n}\n\nprivate class WebAudioPlayback\n    implements Playback\n    implements Tickable\n{\n    public var volume (default, null) :AnimatedFloat;\n    public var paused (get, set) :Bool;\n    public var complete (get, null) :Value<Bool>;\n    public var position (get, null) :Float;\n    public var sound (get, null) :Sound;\n\n    public function new (sound :WebAudioSound, volume :Float, loop :Bool)\n    {\n        _sound = sound;\n        _head = WebAudioSound.gain;\n        _complete = new Value<Bool>(false);\n\n        _sourceNode = WebAudioSound.ctx.createBufferSource();\n        _sourceNode.buffer = sound.buffer;\n        _sourceNode.loop = loop;\n        _sourceNode.onended = function () _complete._ = true; // Not supported on iOS!\n        WebAudioSound.start(_sourceNode, 0);\n        playAudio();\n\n        this.volume = new AnimatedFloat(volume, function (v, _) {\n            setVolume(v);\n        });\n        if (volume != 1) {\n            setVolume(volume);\n        }\n\n        // Don't start playing until visible\n        if (System.hidden._) {\n            paused = true;\n        }\n    }\n\n    public function get_sound () :Sound\n    {\n        return _sound;\n    }\n\n    inline public function get_paused () :Bool\n    {\n        return _pausedAt >= 0;\n    }\n\n    public function set_paused (paused :Bool) :Bool\n    {\n        if (paused != get_paused()) {\n            if (paused) {\n                _sourceNode.disconnect();\n                _pausedAt = position;\n            } else {\n                playAudio();\n            }\n        }\n        return paused;\n    }\n\n    inline public function get_complete () :Value<Bool>\n    {\n        return _complete;\n    }\n\n    public function get_position () :Float\n    {\n        // Web Audio sure doesn't make this simple...\n        if (_complete._) {\n            return _sound.duration;\n\n        } else if (paused) {\n            return _pausedAt;\n\n        } else {\n            var elapsed = WebAudioSound.ctx.currentTime - _startedAt;\n            return elapsed % _sound.duration;\n        }\n    }\n\n    public function update (dt :Float) :Bool\n    {\n        volume.update(dt);\n\n        // playbackState is used in old browsers that don't support onended (iOS)\n        if (_sourceNode.playbackState == 3 /* FINISHED_STATE */) {\n            _complete._ = true;\n        }\n\n        if (_complete._ || paused) {\n            // Allow complete or paused sounds to be garbage collected\n            _tickableAdded = false;\n\n            // Release System references\n            _hideBinding.dispose();\n\n            return true;\n        }\n        return false;\n    }\n\n    public function dispose ()\n    {\n        paused = true;\n        _complete._ = true;\n    }\n\n    private function setVolume (volume :Float)\n    {\n        if (_gainNode == null) {\n            _gainNode = WebAudioSound.createGain();\n            insertNode(_gainNode);\n        }\n        _gainNode.gain.value = volume;\n    }\n\n    private function insertNode (head :Dynamic)\n    {\n        if (!paused) {\n            _sourceNode.disconnect();\n            _sourceNode.connect(head);\n        }\n        head.connect(_head);\n        _head = head;\n    }\n\n    private function playAudio ()\n    {\n        _sourceNode.connect(_head);\n        _startedAt = WebAudioSound.ctx.currentTime;\n        _pausedAt = -1;\n\n        if (!_tickableAdded) {\n            HtmlPlatform.instance.mainLoop.addTickable(this);\n            _tickableAdded = true;\n\n            // Claim System references\n            _hideBinding = System.hidden.changed.connect(function(hidden,_) {\n                if (hidden) {\n                    _wasPaused = get_paused();\n                    this.paused = true;\n                } else {\n                    this.paused = _wasPaused;\n                }\n            });\n        }\n    }\n\n    private var _sound :WebAudioSound;\n\n    private var _pausedAt :Float;\n    private var _startedAt :Float;\n    private var _wasPaused :Bool;\n\n    private var _sourceNode :Dynamic;\n    private var _gainNode :Dynamic;\n\n    // The first node of the output chain, not including the source node\n    private var _head :Dynamic;\n\n    private var _hideBinding :Disposable;\n    private var _tickableAdded :Bool;\n\n    private var _complete :Value<Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.html.*;\nimport js.html.webgl.*;\nimport js.html.webgl.RenderingContext;\n\nimport flambe.display.BlendMode;\nimport flambe.math.Rectangle;\nimport flambe.platform.shader.DrawPatternGL;\nimport flambe.platform.shader.DrawTextureGL;\nimport flambe.platform.shader.FillRectGL;\nimport flambe.platform.shader.ShaderGL;\n\n/**\n * Batches up geometry to glDrawElements and avoids redundant state changes. All GL state changes\n * MUST go through the batcher.\n */\nclass WebGLBatcher\n{\n    public var data (default, null) :Float32Array;\n\n    public function new (gl :RenderingContext)\n    {\n        _gl = gl;\n\n        gl.clearColor(0, 0, 0, 0);\n        gl.enable(GL.BLEND);\n        gl.pixelStorei(GL.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1);\n\n        _vertexBuffer = gl.createBuffer();\n        gl.bindBuffer(GL.ARRAY_BUFFER, _vertexBuffer);\n\n        _quadIndexBuffer = gl.createBuffer();\n        gl.bindBuffer(GL.ELEMENT_ARRAY_BUFFER, _quadIndexBuffer);\n\n        _drawTextureShader = new DrawTextureGL(gl);\n        _drawPatternShader = new DrawPatternGL(gl);\n        _fillRectShader = new FillRectGL(gl);\n\n        resize(16);\n    }\n\n    public function resizeBackbuffer (width :Int, height :Int)\n    {\n        _gl.viewport(0, 0, width, height);\n        _backbufferWidth = width;\n        _backbufferHeight = height;\n    }\n\n    public function willRender ()\n    {\n#if flambe_transparent\n        _gl.clear(GL.COLOR_BUFFER_BIT);\n#end\n    }\n\n    public function didRender ()\n    {\n        flush();\n    }\n\n    /** Safely bind a texture. */\n    public function bindTexture (texture :Texture)\n    {\n        flush();\n        _lastTexture = null;\n        _currentTexture = null;\n\n        _gl.bindTexture(GL.TEXTURE_2D, texture);\n    }\n\n    /** Safely delete a texture. */\n    public function deleteTexture (texture :WebGLTextureRoot)\n    {\n        // If we have unflushed quads that use this texture, flush them now\n        if (_lastTexture != null && _lastTexture.root == texture) {\n            flush();\n            _lastTexture = null;\n            _currentTexture = null;\n        }\n\n        _gl.deleteTexture(texture.nativeTexture);\n    }\n\n    /** Safely bind a framebuffer. */\n    public function bindFramebuffer (texture :WebGLTextureRoot)\n    {\n        if (texture != _lastRenderTarget) {\n            flush();\n            bindRenderTarget(texture);\n        }\n    }\n\n    /** Safely delete a framebuffer. */\n    public function deleteFramebuffer (texture :WebGLTextureRoot)\n    {\n        // If we have unflushed quads that render to this texture, flush them now\n        if (texture == _lastRenderTarget) {\n            flush();\n            _lastRenderTarget = null;\n            _currentRenderTarget = null;\n        }\n\n        _gl.deleteFramebuffer(texture.framebuffer);\n    }\n\n    public function prepareDrawTexture (renderTarget :WebGLTextureRoot,\n        blendMode :BlendMode, scissor :Rectangle, texture :WebGLTexture) :Int\n    {\n        if (texture != _lastTexture) {\n            flush();\n            _lastTexture = texture;\n        }\n        return prepareQuad(5, renderTarget, blendMode, scissor, _drawTextureShader);\n    }\n\n    public function prepareDrawPattern (renderTarget :WebGLTextureRoot,\n        blendMode :BlendMode, scissor :Rectangle, texture :WebGLTexture) :Int\n    {\n        if (texture != _lastTexture) {\n            flush();\n            _lastTexture = texture;\n        }\n        return prepareQuad(5, renderTarget, blendMode, scissor, _drawPatternShader);\n    }\n\n    public function prepareFillRect (renderTarget :WebGLTextureRoot,\n        blendMode :BlendMode, scissor :Rectangle) :Int\n    {\n        return prepareQuad(6, renderTarget, blendMode, scissor, _fillRectShader);\n    }\n\n    private function prepareQuad (elementsPerVertex :Int, renderTarget :WebGLTextureRoot,\n        blendMode :BlendMode, scissor :Rectangle, shader :ShaderGL) :Int\n    {\n        if (renderTarget != _lastRenderTarget) {\n            flush();\n            _lastRenderTarget = renderTarget;\n        }\n        if (blendMode != _lastBlendMode) {\n            flush();\n            _lastBlendMode = blendMode;\n        }\n        if (shader != _lastShader) {\n            flush();\n            _lastShader = shader;\n        }\n\n        // Handle changes to the scissor rectangle\n        if (scissor != null || _lastScissor != null) {\n            if (scissor == null || _lastScissor == null || !_lastScissor.equals(scissor)) {\n                flush();\n                _lastScissor = (scissor != null) ? scissor.clone(_lastScissor) : null;\n                _pendingSetScissor = true;\n            }\n        }\n\n        if (_quads >= _maxQuads) {\n            resize(2*_maxQuads);\n        }\n        ++_quads;\n\n        var offset = _dataOffset;\n        _dataOffset += 4*elementsPerVertex;\n        return offset;\n    }\n\n    private function flush ()\n    {\n        if (_quads < 1) {\n            return;\n        }\n\n        if (_lastRenderTarget != _currentRenderTarget) {\n            bindRenderTarget(_lastRenderTarget);\n        }\n\n        if (_lastBlendMode != _currentBlendMode) {\n            switch (_lastBlendMode) {\n                case Normal: _gl.blendFunc(GL.ONE, GL.ONE_MINUS_SRC_ALPHA);\n                case Add: _gl.blendFunc(GL.ONE, GL.ONE);\n                case Multiply: _gl.blendFunc(GL.DST_COLOR, GL.ONE_MINUS_SRC_ALPHA);\n                case Screen: _gl.blendFunc(GL.ONE, GL.ONE_MINUS_SRC_COLOR);\n                case Mask: _gl.blendFunc(GL.ZERO, GL.SRC_ALPHA);\n                case Copy: _gl.blendFunc(GL.ONE, GL.ZERO); // TODO(bruno): Disable blending entirely?\n            }\n            _currentBlendMode = _lastBlendMode;\n        }\n\n        if (_pendingSetScissor) {\n            if (_lastScissor != null) {\n                _gl.enable(GL.SCISSOR_TEST);\n                _gl.scissor(Std.int(_lastScissor.x), Std.int(_lastScissor.y),\n                    Std.int(_lastScissor.width), Std.int(_lastScissor.height));\n            } else {\n                _gl.disable(GL.SCISSOR_TEST);\n            }\n            _pendingSetScissor = false;\n        }\n\n        if (_lastTexture != _currentTexture) {\n            _gl.bindTexture(GL.TEXTURE_2D, _lastTexture.root.nativeTexture);\n            _currentTexture = _lastTexture;\n        }\n\n        if (_lastShader != _currentShader) {\n            _lastShader.useProgram();\n            _lastShader.prepare();\n            _currentShader = _lastShader;\n        }\n\n        if (_lastShader == _drawPatternShader) {\n            var texture = _lastTexture;\n            var root = texture.root;\n            _drawPatternShader.setRegion(\n                texture.rootX / root.width,\n                texture.rootY / root.height,\n                texture.width / root.width,\n                texture.height / root.height);\n        }\n\n        // _gl.bufferSubData(GL.ARRAY_BUFFER, 0, data.subarray(0, _dataOffset));\n        _gl.bufferData(GL.ARRAY_BUFFER, data.subarray(0, _dataOffset), GL.STREAM_DRAW);\n        _gl.drawElements(GL.TRIANGLES, 6*_quads, GL.UNSIGNED_SHORT, 0);\n\n        _quads = 0;\n        _dataOffset = 0;\n    }\n\n    private function resize (maxQuads :Int)\n    {\n        flush();\n        if (maxQuads > MAX_BATCH_QUADS) {\n            return; // That's big enough, return right after the flush\n        }\n\n        _maxQuads = maxQuads;\n\n        // Set the new vertex buffer size\n        data = new Float32Array(maxQuads*4*MAX_ELEMENTS_PER_VERTEX);\n        _gl.bufferData(GL.ARRAY_BUFFER,\n            data.length*Float32Array.BYTES_PER_ELEMENT, GL.STREAM_DRAW);\n\n        var indices = new Uint16Array(6*maxQuads);\n        for (ii in 0...maxQuads) {\n            indices[ii*6 + 0] = ii*4 + 0;\n            indices[ii*6 + 1] = ii*4 + 1;\n            indices[ii*6 + 2] = ii*4 + 2;\n            indices[ii*6 + 3] = ii*4 + 2;\n            indices[ii*6 + 4] = ii*4 + 3;\n            indices[ii*6 + 5] = ii*4 + 0;\n        }\n        _gl.bufferData(GL.ELEMENT_ARRAY_BUFFER, indices, GL.STATIC_DRAW);\n    }\n\n    private function bindRenderTarget (texture :WebGLTextureRoot)\n    {\n        // Bind the texture framebuffer, or the original backbuffer\n        if (texture != null) {\n            _gl.bindFramebuffer(GL.FRAMEBUFFER, texture.framebuffer);\n            _gl.viewport(0, 0, texture.width, texture.height);\n        } else {\n            _gl.bindFramebuffer(GL.FRAMEBUFFER, null);\n            _gl.viewport(0, 0, _backbufferWidth, _backbufferHeight);\n        }\n        _currentRenderTarget = texture;\n        _lastRenderTarget = texture;\n    }\n\t\n\t//@HACK (aris) This whole function is mine. It resets the arrays to allow away3d to share the gl with flambe. called at WebGLGraphics\n\tpublic function resetLastStateVars():Void\n\t{\n\t\t//re enable/disable flags\n        _gl.enable(GL.BLEND);\n\t\t_gl.disable(GL.STENCIL_TEST);\n\t\t_gl.disable(GL.DEPTH_TEST);\n\t\t\n\t\t\n\t\t//re bind every buffer\n\t\t_gl.bindBuffer(GL.ARRAY_BUFFER, _vertexBuffer);\n\t\t_gl.bindBuffer(GL.ELEMENT_ARRAY_BUFFER, _quadIndexBuffer);\n\t\t\n\t\tif (_lastRenderTarget!=null)\n\t\t\tbindRenderTarget(_lastRenderTarget);\n\t\t\n\t\t_gl.blendFunc(GL.ONE, GL.ONE_MINUS_SRC_ALPHA);\n\t\t\n\t\tif (_lastTexture!=null)\n\t\t\t_gl.bindTexture(GL.TEXTURE_2D, _lastTexture.root.nativeTexture);\n\t\t\n\t\tif (_lastShader!=null)\n\t\t{\n\t\t\t_lastShader.useProgram();\n\t\t\t_lastShader.prepare();\n\t\t}\n\t\t\n\t\t/*\n\t\tif (false)\n\t\t{\n\t\t\t_lastBlendMode  = null;\n\t\t\t_lastRenderTarget  = null;\n\t\t\t_lastShader  = null;\n\t\t\t_lastTexture  = null;\n\t\t\t_lastScissor  = null;\n\t\t}\n\t\t\n\t\tif (false)\n\t\t{\n\t\t\t_currentBlendMode  = null;\n\t\t\t_currentShader  = null;\n\t\t\t_currentTexture  = null;\n\t\t\t_currentRenderTarget  = null;\n\t\t\t_pendingSetScissor  = false;\n\t\t}\n\n\t\t\n\t\tif (false)\n\t\t{\n\t\t\t_gl.bindBuffer(GL.ARRAY_BUFFER, _vertexBuffer);\n\t\t\t_gl.bindBuffer(GL.ELEMENT_ARRAY_BUFFER, _quadIndexBuffer);\n\t\t\t\n\t\t\tif (_currentRenderTarget!=null)\n\t\t\t\tbindRenderTarget(_currentRenderTarget);\n\t\t\t\n\t\t\t_gl.blendFunc(GL.ONE, GL.ONE_MINUS_SRC_ALPHA);\n\t\t\t\n\t\t\tif (_currentTexture!=null)\n\t\t\t\t_gl.bindTexture(GL.TEXTURE_2D, _currentTexture.nativeTexture);\n\t\t\t\n\t\t\tif (_currentShader!=null)\n\t\t\t{\n\t\t\t\t_currentShader.useProgram();\n\t\t\t\t_currentShader.prepare();\n\t\t\t}\n\t\t}\n\t\t*/\n\t}\n\n    private static inline var MAX_ELEMENTS_PER_VERTEX = 6;\n    private static inline var MAX_BATCH_QUADS = 1024;\n\n    private var _gl :RenderingContext;\n\n    // Used to keep track of context changes requiring a flush\n    private var _lastBlendMode :BlendMode = null;\n    private var _lastRenderTarget :WebGLTextureRoot = null;\n    private var _lastShader :ShaderGL = null;\n    private var _lastTexture :WebGLTexture = null;\n    private var _lastScissor :Rectangle = null;\n\n    // Used to avoid redundant GL calls\n    private var _currentBlendMode :BlendMode = null;\n    private var _currentShader :ShaderGL = null;\n    private var _currentTexture :WebGLTexture = null;\n    private var _currentRenderTarget :WebGLTextureRoot = null;\n    private var _pendingSetScissor :Bool = false;\n\n    private var _vertexBuffer :Buffer;\n    private var _quadIndexBuffer :Buffer;\n\n    private var _drawTextureShader :DrawTextureGL;\n    private var _drawPatternShader :DrawPatternGL;\n    private var _fillRectShader :FillRectGL;\n\n    private var _quads :Int = 0;\n    private var _maxQuads :Int = 0;\n    private var _dataOffset :Int = 0;\n\n    private var _backbufferWidth :Int = 0;\n    private var _backbufferHeight :Int = 0;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.html.*;\nimport js.html.webgl.*;\n\nimport flambe.display.BlendMode;\nimport flambe.display.Graphics;\nimport flambe.display.Texture;\nimport flambe.math.FMath;\nimport flambe.math.Matrix;\nimport flambe.math.Rectangle;\nimport flambe.util.Assert;\n\nclass WebGLGraphics\n    implements InternalGraphics\n{\n    public function new (batcher :WebGLBatcher, renderTarget :WebGLTextureRoot)\n    {\n        // Initialize this here to prevent blowing up during static init on browsers without typed\n        // array support\n        if (_scratchQuadArray == null) {\n            _scratchQuadArray = new Float32Array(8);\n        }\n\n        _batcher = batcher;\n        _renderTarget = renderTarget;\n    }\n\n    public function save ()\n    {\n        var current = _stateList;\n        var state = _stateList.next;\n\n        if (state == null) {\n            // Grow the list\n            state = new DrawingState();\n            state.prev = current;\n            current.next = state;\n        }\n\n        current.matrix.clone(state.matrix);\n        state.alpha = current.alpha;\n        state.blendMode = current.blendMode;\n        state.scissor = (current.scissor != null) ? current.scissor.clone(state.scissor) : null;\n        _stateList = state;\n    }\n\n    public function translate (x :Float, y :Float)\n    {\n        var matrix = getTopState().matrix;\n        matrix.m02 += matrix.m00*x + matrix.m01*y;\n        matrix.m12 += matrix.m10*x + matrix.m11*y;\n    }\n\n    public function scale (x :Float, y :Float)\n    {\n        var matrix = getTopState().matrix;\n        matrix.m00 *= x;\n        matrix.m10 *= x;\n        matrix.m01 *= y;\n        matrix.m11 *= y;\n    }\n\n    public function rotate (rotation :Float)\n    {\n        var matrix = getTopState().matrix;\n        rotation = FMath.toRadians(rotation);\n        var sin = Math.sin(rotation);\n        var cos = Math.cos(rotation);\n        var m00 = matrix.m00;\n        var m10 = matrix.m10;\n        var m01 = matrix.m01;\n        var m11 = matrix.m11;\n\n        matrix.m00 = m00*cos + m01*sin;\n        matrix.m10 = m10*cos + m11*sin;\n        matrix.m01 = m01*cos - m00*sin;\n        matrix.m11 = m11*cos - m10*sin;\n    }\n\n    public function transform (m00 :Float, m10 :Float, m01 :Float, m11 :Float, m02 :Float, m12 :Float)\n    {\n        var state = getTopState();\n        _scratchMatrix.set(m00, m10, m01, m11, m02, m12);\n        Matrix.multiply(state.matrix, _scratchMatrix, state.matrix);\n    }\n\n    public function restore ()\n    {\n        Assert.that(_stateList.prev != null, \"Can't restore without a previous save\");\n        _stateList = _stateList.prev;\n    }\n\n    public function drawTexture (texture :Texture, x :Float, y :Float)\n    {\n\t\t_batcher.resetLastStateVars(); //@HACK (aris)\n\t\t\n        drawSubTexture(texture, x, y, 0, 0, texture.width, texture.height);\n    }\n\n    public function drawSubTexture (texture :Texture, destX :Float, destY :Float,\n        sourceX :Float, sourceY :Float, sourceW :Float, sourceH :Float)\n    {\n        var state = getTopState();\n        var texture :WebGLTexture = cast texture;\n        var root = texture.root;\n        root.assertNotDisposed();\n\n        var pos = transformQuad(destX, destY, sourceW, sourceH);\n        var rootWidth = root.width;\n        var rootHeight = root.height;\n        var u1 = (texture.rootX+sourceX) / rootWidth;\n        var v1 = (texture.rootY+sourceY) / rootHeight;\n        var u2 = u1 + sourceW/rootWidth;\n        var v2 = v1 + sourceH/rootHeight;\n        var alpha = state.alpha;\n\n        var offset = _batcher.prepareDrawTexture(_renderTarget, state.blendMode, state.scissor, texture);\n        var data = _batcher.data;\n\n        data[  offset] = pos[0];\n        data[++offset] = pos[1];\n        data[++offset] = u1;\n        data[++offset] = v1;\n        data[++offset] = alpha;\n\n        data[++offset] = pos[2];\n        data[++offset] = pos[3];\n        data[++offset] = u2;\n        data[++offset] = v1;\n        data[++offset] = alpha;\n\n        data[++offset] = pos[4];\n        data[++offset] = pos[5];\n        data[++offset] = u2;\n        data[++offset] = v2;\n        data[++offset] = alpha;\n\n        data[++offset] = pos[6];\n        data[++offset] = pos[7];\n        data[++offset] = u1;\n        data[++offset] = v2;\n        data[++offset] = alpha;\n    }\n\n    public function drawPattern (texture :Texture, x :Float, y :Float, width :Float, height :Float)\n    {\n        var state = getTopState();\n        var texture :WebGLTexture = cast texture;\n        var root = texture.root;\n        root.assertNotDisposed();\n\n        var pos = transformQuad(x, y, width, height);\n        var u2 = width / root.width;\n        var v2 = height / root.height;\n        var alpha = state.alpha;\n\n        var offset = _batcher.prepareDrawPattern(_renderTarget, state.blendMode, state.scissor, texture);\n        var data = _batcher.data;\n\n        data[  offset] = pos[0];\n        data[++offset] = pos[1];\n        data[++offset] = 0;\n        data[++offset] = 0;\n        data[++offset] = alpha;\n\n        data[++offset] = pos[2];\n        data[++offset] = pos[3];\n        data[++offset] = u2;\n        data[++offset] = 0;\n        data[++offset] = alpha;\n\n        data[++offset] = pos[4];\n        data[++offset] = pos[5];\n        data[++offset] = u2;\n        data[++offset] = v2;\n        data[++offset] = alpha;\n\n        data[++offset] = pos[6];\n        data[++offset] = pos[7];\n        data[++offset] = 0;\n        data[++offset] = v2;\n        data[++offset] = alpha;\n    }\n\n    public function fillRect (color :Int, x :Float, y :Float, width :Float, height :Float)\n    {\n        var state = getTopState();\n\n        var pos = transformQuad(x, y, width, height);\n        var r = (color & 0xff0000) / 0xff0000;\n        var g = (color & 0x00ff00) / 0x00ff00;\n        var b = (color & 0x0000ff) / 0x0000ff;\n        var a = state.alpha;\n\n        var offset = _batcher.prepareFillRect(_renderTarget, state.blendMode, state.scissor);\n        var data = _batcher.data;\n\n        data[  offset] = pos[0];\n        data[++offset] = pos[1];\n        data[++offset] = r;\n        data[++offset] = g;\n        data[++offset] = b;\n        data[++offset] = a;\n\n        data[++offset] = pos[2];\n        data[++offset] = pos[3];\n        data[++offset] = r;\n        data[++offset] = g;\n        data[++offset] = b;\n        data[++offset] = a;\n\n        data[++offset] = pos[4];\n        data[++offset] = pos[5];\n        data[++offset] = r;\n        data[++offset] = g;\n        data[++offset] = b;\n        data[++offset] = a;\n\n        data[++offset] = pos[6];\n        data[++offset] = pos[7];\n        data[++offset] = r;\n        data[++offset] = g;\n        data[++offset] = b;\n        data[++offset] = a;\n    }\n\n    public function multiplyAlpha (factor :Float)\n    {\n        getTopState().alpha *= factor;\n    }\n\n    public function setAlpha (alpha :Float)\n    {\n        getTopState().alpha = alpha;\n    }\n\n    public function setBlendMode (blendMode :BlendMode)\n    {\n        getTopState().blendMode = blendMode;\n    }\n\n    public function applyScissor (x :Float, y :Float, width :Float, height :Float)\n    {\n        var state = getTopState();\n        var rect = _scratchQuadArray;\n        rect[0] = x;\n        rect[1] = y;\n        rect[2] = x + width;\n        rect[3] = y + height;\n\n        state.matrix.transformArray(cast rect, 4, cast rect);\n        _inverseProjection.transformArray(cast rect, 4, cast rect);\n\n        x = rect[0];\n        y = rect[1];\n        width = rect[2] - x;\n        height = rect[3] - y;\n\n        // Handle negative rectangles\n        if (width < 0) {\n            x += width;\n            width = -width;\n        }\n        if (height < 0) {\n            y += height;\n            height = -height;\n        }\n\n        state.applyScissor(x, y, width, height);\n    }\n\n    public function willRender ()\n    {\n\t\t_batcher.resetLastStateVars(); //@HACK (aris)\n\t\t\n        _batcher.willRender();\n    }\n\n    public function didRender ()\n    {\n\t\t_batcher.resetLastStateVars(); //@HACK (aris)\n\t\t\n        _batcher.didRender();\n    }\n\n    public function onResize (width :Int, height :Int)\n    {\n        _stateList = new DrawingState();\n\n        // Framebuffers need to be vertically flipped\n        var flip = (_renderTarget != null) ? -1 : 1;\n        _stateList.matrix.set(2/width, 0, 0, flip * -2/height, -1, flip);\n\n        // May be used to transform back into screen coordinates\n        _inverseProjection = new Matrix();\n        _inverseProjection.set(2/width, 0, 0, 2/height, -1, -1);\n        _inverseProjection.invert();\n    }\n\n    inline private function getTopState () :DrawingState\n    {\n        return _stateList;\n    }\n\n    private function transformQuad (x :Float, y :Float, width :Float, height :Float) :Float32Array\n    {\n        var x2 = x + width;\n        var y2 = y + height;\n        var pos = _scratchQuadArray;\n\n        pos[0] = x;\n        pos[1] = y;\n\n        pos[2] = x2;\n        pos[3] = y;\n\n        pos[4] = x2;\n        pos[5] = y2;\n\n        pos[6] = x;\n        pos[7] = y2;\n\n        getTopState().matrix.transformArray(cast pos, 8, cast pos);\n        return pos;\n    }\n\n    private static var _scratchMatrix = new Matrix();\n    private static var _scratchQuadArray :Float32Array = null;\n\n    private var _batcher :WebGLBatcher;\n    private var _renderTarget :WebGLTextureRoot;\n\n    private var _inverseProjection :Matrix = null;\n    private var _stateList :DrawingState = null;\n}\n\nprivate class DrawingState\n{\n    public var matrix :Matrix;\n    public var alpha :Float;\n    public var blendMode :BlendMode;\n    public var scissor :Rectangle = null;\n\n    public var prev :DrawingState = null;\n    public var next :DrawingState = null;\n\n    public function new ()\n    {\n        matrix = new Matrix();\n        alpha = 1;\n        blendMode = Normal;\n    }\n\n    public function applyScissor (x :Float, y :Float, width :Float, height :Float)\n    {\n        if (scissor != null) {\n            // Intersection with the previous scissor rectangle\n            var x1 = FMath.max(scissor.x, x);\n            var y1 = FMath.max(scissor.y, y);\n            var x2 = FMath.min(scissor.x + scissor.width, x + width);\n            var y2 = FMath.min(scissor.y + scissor.height, y + height);\n            x = x1;\n            y = y1;\n            width = x2 - x1;\n            height = y2 - y1;\n        } else {\n            scissor = new Rectangle();\n        }\n        scissor.set(Math.round(x), Math.round(y), Math.round(width), Math.round(height));\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.html.webgl.*;\n\nimport haxe.io.Bytes;\n\nimport flambe.asset.AssetEntry;\nimport flambe.subsystem.RendererSystem;\nimport flambe.util.Assert;\nimport flambe.util.Value;\n\nclass WebGLRenderer\n    implements InternalRenderer<Dynamic>\n{\n    public var type (get, null) :RendererType;\n    public var maxTextureSize (get, null) :Int;\n    public var hasGPU (get, null) :Value<Bool>;\n\n    public var graphics :InternalGraphics;\n\n    public var gl (default, null) :RenderingContext;\n    public var batcher (default, null) :WebGLBatcher;\n\n    public function new (stage :HtmlStage, gl :RenderingContext)\n    {\n        _hasGPU = new Value<Bool>(true);\n        this.gl = gl;\n\n        // Handle GL context loss\n        gl.canvas.addEventListener(\"webglcontextlost\", function (event) {\n            event.preventDefault();\n            Log.warn(\"WebGL context lost\");\n            _hasGPU._ = false;\n        }, false);\n        gl.canvas.addEventListener(\"webglcontextrestore\", function (event) {\n            Log.warn(\"WebGL context restored\");\n            init();\n            _hasGPU._ = true;\n        }, false);\n\n        stage.resize.connect(onResize);\n        init();\n    }\n\n    inline private function get_type () :RendererType\n    {\n        return WebGL;\n    }\n\n    private function get_maxTextureSize () :Int\n    {\n        return gl.getParameter(GL.MAX_TEXTURE_SIZE);\n    }\n\n    inline private function get_hasGPU () :Value<Bool>\n    {\n        return _hasGPU;\n    }\n\n    public function createTextureFromImage (image :Dynamic) :WebGLTexture\n    {\n        if (gl.isContextLost()) {\n            return null;\n        }\n        var root = new WebGLTextureRoot(this, image.width, image.height);\n        root.uploadImageData(image);\n        return root.createTexture(image.width, image.height);\n    }\n\n    public function createTexture (width :Int, height :Int) :WebGLTexture\n    {\n        if (gl.isContextLost()) {\n            return null;\n        }\n        var root = new WebGLTextureRoot(this, width, height);\n        root.clear();\n        return root.createTexture(width, height);\n    }\n\n    public function getCompressedTextureFormats () :Array<AssetFormat>\n    {\n        // TODO(bruno): Detect supported texture extensions\n        return [];\n    }\n\n    public function createCompressedTexture (format :AssetFormat, data :Bytes) :WebGLTexture\n    {\n        if (gl.isContextLost()) {\n            return null;\n        }\n        Assert.fail(); // Unsupported\n        return null;\n    }\n\n    public function willRender ()\n    {\n        graphics.willRender();\n    }\n\n    public function didRender ()\n    {\n        graphics.didRender();\n    }\n\n    private function onResize ()\n    {\n        var width = gl.canvas.width, height = gl.canvas.height;\n        batcher.resizeBackbuffer(width, height);\n        graphics.onResize(width, height);\n    }\n\n    private function init ()\n    {\n        batcher = new WebGLBatcher(gl);\n        graphics = new WebGLGraphics(batcher, null);\n        onResize();\n    }\n\n    private var _hasGPU :Value<Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nclass WebGLTexture extends BasicTexture<WebGLTextureRoot>\n{\n    public function new (root :WebGLTextureRoot, width :Int, height :Int)\n    {\n        super(root, width, height);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.html.CanvasElement;\nimport js.html.Uint8Array;\nimport js.html.webgl.*;\n\nimport haxe.io.Bytes;\n\nimport flambe.math.FMath;\nimport flambe.platform.MathUtil;\n\nclass WebGLTextureRoot extends BasicAsset<WebGLTextureRoot>\n    implements TextureRoot\n{\n    // The power of two dimensions of the texture\n    public var width (default, null) :Int;\n    public var height (default, null) :Int;\n\n    public var nativeTexture (default, null) :js.html.webgl.Texture;\n    public var framebuffer :Framebuffer = null;\n\n    public function new (renderer :WebGLRenderer, width :Int, height :Int)\n    {\n        super();\n        _renderer = renderer;\n        // 1 px textures cause weird DrawPattern sampling on some drivers\n        this.width = FMath.max(2, MathUtil.nextPowerOfTwo(width));\n        this.height = FMath.max(2, MathUtil.nextPowerOfTwo(height));\n\n        var gl = renderer.gl;\n        nativeTexture = gl.createTexture();\n        renderer.batcher.bindTexture(nativeTexture);\n        gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_WRAP_S, GL.CLAMP_TO_EDGE);\n        gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_WRAP_T, GL.CLAMP_TO_EDGE);\n        gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_MAG_FILTER, GL.LINEAR);\n    #if flambe_webgl_enable_mipmapping\n        gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_MIN_FILTER, GL.LINEAR_MIPMAP_NEAREST);\n    #elseif flambe_webgl_enable_linear\n        gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_MIN_FILTER, GL.LINEAR);\n    #else\n        gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_MIN_FILTER, GL.NEAREST);\n    #end\n    }\n\n    public function createTexture (width :Int, height :Int) :WebGLTexture\n    {\n        return new WebGLTexture(this, width, height);\n    }\n\n    public function uploadImageData (image :Dynamic)\n    {\n        assertNotDisposed();\n\n        if (width != image.width || height != image.height) {\n            // Resize up to the next power of two, padding with transparent black\n            var resized = HtmlUtil.createEmptyCanvas(width, height);\n            resized.getContext2d().drawImage(image, 0, 0);\n            drawBorder(resized, image.width, image.height);\n            image = resized;\n        }\n\n        _renderer.batcher.bindTexture(nativeTexture);\n        var gl = _renderer.gl;\n        gl.texImage2D(GL.TEXTURE_2D, 0, GL.RGBA, GL.RGBA, GL.UNSIGNED_BYTE, image);\n    #if flambe_webgl_enable_mipmapping\n        gl.generateMipmap(GL.TEXTURE_2D);\n    #end\n    }\n\n    public function clear ()\n    {\n        assertNotDisposed();\n\n        _renderer.batcher.bindTexture(nativeTexture);\n        var gl = _renderer.gl;\n        gl.texImage2D(GL.TEXTURE_2D, 0, GL.RGBA, width, height, 0, GL.RGBA, GL.UNSIGNED_BYTE, null);\n    #if flambe_webgl_enable_mipmapping\n        gl.generateMipmap(GL.TEXTURE_2D);\n    #end\n    }\n\n    public function readPixels (x :Int, y :Int, width :Int, height :Int) :Bytes\n    {\n        assertNotDisposed();\n\n        getGraphics(); // Ensure we have a framebuffer\n        _renderer.batcher.bindFramebuffer(this);\n\n        var pixels = new Uint8Array(4*width*height);\n        var gl = _renderer.gl;\n        gl.readPixels(x, y, width, height, GL.RGBA, GL.UNSIGNED_BYTE, pixels);\n\n        // Undo alpha premultiplication. This is lossy!\n        var ii = 0, ll = pixels.length;\n        while (ii < ll) {\n            var invAlpha = 255 / pixels[ii+3];\n            pixels[ii] = cast pixels[ii] * invAlpha;\n            ++ii;\n            pixels[ii] = cast pixels[ii] * invAlpha;\n            ++ii;\n            pixels[ii] = cast pixels[ii] * invAlpha;\n            ii += 2; // Advance to next pixel\n        }\n\n        return Bytes.ofData(cast pixels);\n    }\n\n    public function writePixels (pixels :Bytes, x :Int, y :Int, sourceW :Int, sourceH :Int)\n    {\n        assertNotDisposed();\n\n        _renderer.batcher.bindTexture(nativeTexture);\n\n        // Can't update a texture used by a bound framebuffer apparently\n        _renderer.batcher.bindFramebuffer(null);\n\n        var gl = _renderer.gl;\n        // TODO(bruno): Avoid the redundant Uint8Array copy\n        gl.texSubImage2D(GL.TEXTURE_2D, 0, x, y, sourceW, sourceH,\n            GL.RGBA, GL.UNSIGNED_BYTE, new Uint8Array(pixels.getData()));\n    }\n\n    public function getGraphics () :WebGLGraphics\n    {\n        assertNotDisposed();\n\n        if (_graphics == null) {\n            _graphics = new WebGLGraphics(_renderer.batcher, this);\n            _graphics.onResize(width, height);\n\n            var gl = _renderer.gl;\n            framebuffer = gl.createFramebuffer();\n            _renderer.batcher.bindFramebuffer(this);\n            gl.framebufferTexture2D(GL.FRAMEBUFFER, GL.COLOR_ATTACHMENT0,\n                GL.TEXTURE_2D, nativeTexture, 0);\n        }\n        return _graphics;\n    }\n\n    override private function copyFrom (that :WebGLTextureRoot)\n    {\n        this.nativeTexture = that.nativeTexture;\n        this.framebuffer = that.framebuffer;\n        this.width = that.width;\n        this.height = that.height;\n        this._graphics = that._graphics;\n    }\n\n    override private function onDisposed ()\n    {\n        var batcher = _renderer.batcher;\n        batcher.deleteTexture(this);\n        if (framebuffer != null) {\n            batcher.deleteFramebuffer(this);\n        }\n\n        nativeTexture = null;\n        framebuffer = null;\n        _graphics = null;\n    }\n\n    /**\n     * Extends the right and bottom edge pixels of a bitmap. This is to prevent artifacts caused by\n     * sampling the outer transparency when the edge pixels are sampled.\n     */\n    private static function drawBorder (canvas :CanvasElement, width :Int, height :Int)\n    {\n        var ctx = canvas.getContext2d();\n\n        // Right edge\n        ctx.drawImage(canvas, width-1, 0, 1, height, width, 0, 1, height);\n\n        // Bottom edge\n        ctx.drawImage(canvas, 0, height-1, width, 1, 0, height, width, 1);\n\n        // Is a one pixel border enough?\n    }\n\n    private var _renderer :WebGLRenderer;\n    private var _graphics :WebGLGraphics = null;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.shader;\n\nimport js.html.*;\nimport js.html.webgl.*;\nimport js.html.webgl.RenderingContext;\n\nimport flambe.util.Assert;\n\n/**\n * Since there's no HxSL GLSL compiler (yet?), all GL shaders extend this.\n */\nclass ShaderGL\n{\n    public function new (gl :RenderingContext, vertSource :String, fragSource :String)\n    {\n        // Prepend the required precision rigamarole\n        fragSource = [\n            \"#ifdef GL_ES\",\n                \"precision mediump float;\",\n            \"#endif\",\n        ].join(\"\\n\") + \"\\n\" + fragSource;\n\n        _gl = gl;\n        _program = gl.createProgram();\n        gl.attachShader(_program, createShader(gl, GL.VERTEX_SHADER, vertSource));\n        gl.attachShader(_program, createShader(gl, GL.FRAGMENT_SHADER, fragSource));\n        gl.linkProgram(_program);\n        gl.useProgram(_program);\n\n#if debug\n        if (!gl.getProgramParameter(_program, GL.LINK_STATUS)) {\n            Log.error(\"Error linking shader program\", [\"log\", gl.getProgramInfoLog(_program)]);\n        }\n#end\n    }\n\n    public function useProgram ()\n    {\n        _gl.useProgram(_program);\n    }\n\n    public function prepare ()\n    {\n        Assert.fail(\"abstract\");\n    }\n\n    private function getAttribLocation (name :String) :Int\n    {\n        var loc = _gl.getAttribLocation(_program, name);\n        Assert.that(loc >= 0, \"Missing attribute\", [\"name\", name]);\n        return loc;\n    }\n\n    private function getUniformLocation (name :String) :UniformLocation\n    {\n        var loc = _gl.getUniformLocation(_program, name);\n        Assert.that(loc != null, \"Missing uniform\", [\"name\", name]);\n        return loc;\n    }\n\n    private static function createShader (gl :RenderingContext, type :Int, source :String) :Shader\n    {\n        var shader = gl.createShader(type);\n        gl.shaderSource(shader, source);\n        gl.compileShader(shader);\n\n#if debug\n        if (!gl.getShaderParameter(shader, GL.COMPILE_STATUS)) {\n            var typeName = (type == GL.VERTEX_SHADER) ? \"vertex\" : \"fragment\";\n            Log.error(\"Error compiling \" + typeName + \" shader\", [\n                \"log\", gl.getShaderInfoLog(shader)]);\n        }\n#end\n        return shader;\n    }\n\n    private var _gl :RenderingContext;\n    private var _program :Program;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.shader;\n\nimport js.html.*;\nimport js.html.webgl.*;\nimport js.html.webgl.RenderingContext;\n\nimport flambe.platform.html.WebGLTexture;\n\nclass DrawPatternGL extends ShaderGL\n{\n    public function new (gl :RenderingContext)\n    {\n        super(gl,\n        [ // Vertex shader\n            \"attribute highp vec2 a_pos;\",\n            \"attribute mediump vec2 a_uv;\",\n            \"attribute lowp float a_alpha;\",\n\n            \"varying mediump vec2 v_uv;\",\n            \"varying lowp float v_alpha;\",\n\n            \"void main (void) {\",\n                \"v_uv = a_uv;\",\n                \"v_alpha = a_alpha;\",\n                \"gl_Position = vec4(a_pos, 0, 1);\",\n            \"}\",\n        ].join(\"\\n\"),\n\n        [ // Fragment shader\n            \"varying mediump vec2 v_uv;\",\n            \"varying lowp float v_alpha;\",\n\n            \"uniform lowp sampler2D u_texture;\",\n            \"uniform mediump vec4 u_region;\",\n\n            \"void main (void) {\",\n                \"gl_FragColor = texture2D(u_texture, u_region.xy + mod(v_uv, u_region.zw)) * v_alpha;\",\n            \"}\",\n        ].join(\"\\n\"));\n\n        a_pos = getAttribLocation(\"a_pos\");\n        a_uv = getAttribLocation(\"a_uv\");\n        a_alpha = getAttribLocation(\"a_alpha\");\n\n        u_texture = getUniformLocation(\"u_texture\");\n        u_region = getUniformLocation(\"u_region\");\n        setTexture(0);\n    }\n\n    public function setTexture (unit :Int)\n    {\n        _gl.uniform1i(u_texture, unit);\n    }\n\n    public function setRegion (x :Float, y :Float, width :Float, height :Float)\n    {\n        _gl.uniform4f(u_region, x, y, width, height);\n    }\n\n    override public function prepare ()\n    {\n        _gl.enableVertexAttribArray(a_pos);\n        _gl.enableVertexAttribArray(a_uv);\n        _gl.enableVertexAttribArray(a_alpha);\n\n        var bytesPerFloat = Float32Array.BYTES_PER_ELEMENT;\n        var stride = 5*bytesPerFloat;\n        _gl.vertexAttribPointer(a_pos, 2, GL.FLOAT, false, stride, 0*bytesPerFloat);\n        _gl.vertexAttribPointer(a_uv, 2, GL.FLOAT, false, stride, 2*bytesPerFloat);\n        _gl.vertexAttribPointer(a_alpha, 1, GL.FLOAT, false, stride, 4*bytesPerFloat);\n    }\n\n    private var a_pos :Int;\n    private var a_uv :Int;\n    private var a_alpha :Int;\n\n    private var u_texture :UniformLocation;\n    private var u_region :UniformLocation;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.shader;\n\nimport js.html.*;\nimport js.html.webgl.*;\nimport js.html.webgl.RenderingContext;\n\nimport flambe.platform.html.WebGLTexture;\n\nclass DrawTextureGL extends ShaderGL\n{\n    public function new (gl :RenderingContext)\n    {\n        super(gl,\n        [ // Vertex shader\n            \"attribute highp vec2 a_pos;\",\n            \"attribute mediump vec2 a_uv;\",\n            \"attribute lowp float a_alpha;\",\n\n            \"varying mediump vec2 v_uv;\",\n            \"varying lowp float v_alpha;\",\n\n            \"void main (void) {\",\n                \"v_uv = a_uv;\",\n                \"v_alpha = a_alpha;\",\n                \"gl_Position = vec4(a_pos, 0, 1);\",\n            \"}\",\n        ].join(\"\\n\"),\n\n        [ // Fragment shader\n            \"varying mediump vec2 v_uv;\",\n            \"varying lowp float v_alpha;\",\n\n            \"uniform lowp sampler2D u_texture;\",\n\n            \"void main (void) {\",\n                \"gl_FragColor = texture2D(u_texture, v_uv) * v_alpha;\",\n            \"}\",\n        ].join(\"\\n\"));\n\n        a_pos = getAttribLocation(\"a_pos\");\n        a_uv = getAttribLocation(\"a_uv\");\n        a_alpha = getAttribLocation(\"a_alpha\");\n\n        u_texture = getUniformLocation(\"u_texture\");\n        setTexture(0);\n    }\n\n    public function setTexture (unit :Int)\n    {\n        _gl.uniform1i(u_texture, unit);\n    }\n\n    override public function prepare ()\n    {\n        _gl.enableVertexAttribArray(a_pos);\n        _gl.enableVertexAttribArray(a_uv);\n        _gl.enableVertexAttribArray(a_alpha);\n\n        var bytesPerFloat = Float32Array.BYTES_PER_ELEMENT;\n        var stride = 5*bytesPerFloat;\n        _gl.vertexAttribPointer(a_pos, 2, GL.FLOAT, false, stride, 0*bytesPerFloat);\n        _gl.vertexAttribPointer(a_uv, 2, GL.FLOAT, false, stride, 2*bytesPerFloat);\n        _gl.vertexAttribPointer(a_alpha, 1, GL.FLOAT, false, stride, 4*bytesPerFloat);\n    }\n\n    private var a_pos :Int;\n    private var a_uv :Int;\n    private var a_alpha :Int;\n\n    private var u_texture :UniformLocation;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.shader;\n\nimport js.html.*;\nimport js.html.webgl.*;\nimport js.html.webgl.RenderingContext;\n\nclass FillRectGL extends ShaderGL\n{\n    public function new (gl :RenderingContext)\n    {\n        super(gl,\n        [ // Vertex shader\n            \"attribute highp vec2 a_pos;\",\n            \"attribute lowp vec3 a_rgb;\",\n            \"attribute lowp float a_alpha;\",\n\n            \"varying lowp vec4 v_color;\",\n\n            \"void main (void) {\",\n                \"v_color = vec4(a_rgb*a_alpha, a_alpha);\",\n                \"gl_Position = vec4(a_pos, 0, 1);\",\n            \"}\",\n        ].join(\"\\n\"),\n\n        [ // Fragment shader\n            \"varying lowp vec4 v_color;\",\n\n            \"void main (void) {\",\n                \"gl_FragColor = v_color;\",\n            \"}\",\n        ].join(\"\\n\"));\n\n        a_pos = getAttribLocation(\"a_pos\");\n        a_rgb = getAttribLocation(\"a_rgb\");\n        a_alpha = getAttribLocation(\"a_alpha\");\n    }\n\n    override public function prepare ()\n    {\n        _gl.enableVertexAttribArray(a_pos);\n        _gl.enableVertexAttribArray(a_rgb);\n        _gl.enableVertexAttribArray(a_alpha);\n\n        var bytesPerFloat = Float32Array.BYTES_PER_ELEMENT;\n        var stride = 6*bytesPerFloat;\n        _gl.vertexAttribPointer(a_pos, 2, GL.FLOAT, false, stride, 0*bytesPerFloat);\n        _gl.vertexAttribPointer(a_rgb, 3, GL.FLOAT, false, stride, 2*bytesPerFloat);\n        _gl.vertexAttribPointer(a_alpha, 1, GL.FLOAT, false, stride, 5*bytesPerFloat);\n    }\n\n    private var a_pos :Int;\n    private var a_rgb :Int;\n    private var a_alpha :Int;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.scene;\n\nimport flambe.Component;\n\n/**\n * Manages a stack of scenes. Only the front-most scene receives game updates.\n */\n// TODO(bruno): Major robustness cleanup and testing needed here\nclass Director extends Component\n{\n    /** The front-most scene. */\n    public var topScene (get, null) :Entity;\n\n    /** The complete list of scenes managed by this director, from back to front. */\n    public var scenes (default, null) :Array<Entity>;\n\n    /**\n     * The scenes that are partially occluded by a transparent or transitioning scene, from back to\n     * front. These scenes are not updated, but they're still drawn.\n     */\n    public var occludedScenes (default, null) :Array<Entity>;\n\n    /** Whether the director is currently transitioning between scenes. */\n    public var transitioning (get, null) :Bool;\n\n    /** The ideal width of the director's scenes. Used by some transitions. */\n    public var width (get, null) :Float;\n\n    /** The ideal height of the director's scenes. Used by some transitions. */\n    public var height (get, null) :Float;\n\n    public function new ()\n    {\n        scenes = [];\n        occludedScenes = [];\n        _root = new Entity();\n    }\n\n    /**\n     * Sets the ideal size of the scenes in this director. By default, the size is the full stage\n     * width and height. This size is used by some transitions, such as SlideTransition.\n     */\n    public function setSize (width :Float, height :Float) :Director\n    {\n        _width = width;\n        _height = height;\n        return this;\n    }\n\n    public function pushScene (scene :Entity, ?transition :Transition)\n    {\n        completeTransition();\n\n        var oldTop = get_topScene();\n        if (oldTop != null) {\n            playTransition(oldTop, scene, transition, function () {\n                hide(oldTop);\n            });\n        } else {\n            add(scene);\n            invalidateVisibility();\n        }\n    }\n\n    public function popScene (?transition :Transition)\n    {\n        completeTransition();\n\n        var oldTop = get_topScene();\n        if (oldTop != null) {\n            scenes.pop(); // Pop oldTop\n            var newTop = get_topScene();\n            if (newTop != null) {\n                playTransition(oldTop, newTop, transition, function () {\n                    hideAndDispose(oldTop);\n                });\n            } else {\n                hideAndDispose(oldTop);\n                invalidateVisibility();\n            }\n        }\n    }\n\n    /**\n     * Pops the scene stack until the given entity is the top scene, or adds the scene if the stack\n     * becomes empty while popping.\n     */\n    public function unwindToScene (scene :Entity, ?transition :Transition)\n    {\n        completeTransition();\n\n        var oldTop = get_topScene();\n        if (oldTop != null) {\n            if (oldTop == scene) {\n                return; // We're already there\n            }\n\n            scenes.pop(); // Pop oldTop\n            while (scenes.length > 0 && scenes[scenes.length-1] != scene) {\n                scenes.pop().dispose(); // Don't emit a hide, just dispose them\n            }\n\n            playTransition(oldTop, scene, transition, function () {\n                hideAndDispose(oldTop);\n            });\n\n        } else {\n            pushScene(scene, transition);\n        }\n    }\n\n    override public function onAdded ()\n    {\n        owner.addChild(_root);\n    }\n\n    override public function onRemoved ()\n    {\n        completeTransition();\n\n        for (scene in scenes) {\n            scene.dispose();\n        }\n        scenes = [];\n        occludedScenes = [];\n\n        _root.dispose();\n    }\n\n    override public function onUpdate (dt :Float)\n    {\n        if (_transitor != null && _transitor.update(dt)) {\n            completeTransition();\n        }\n    }\n\n    private function get_topScene () :Entity\n    {\n        var ll = scenes.length;\n        return (ll > 0) ? scenes[ll-1] : null;\n    }\n\n    inline private function get_transitioning () :Bool\n    {\n        return _transitor != null;\n    }\n\n    private function add (scene :Entity)\n    {\n        var oldTop = get_topScene();\n        if (oldTop != null) {\n            _root.removeChild(oldTop);\n        }\n\n        scenes.remove(scene);\n        scenes.push(scene);\n        _root.addChild(scene);\n    }\n\n    private function hide (scene :Entity)\n    {\n        var events = scene.get(Scene);\n        if (events != null) {\n            events.hidden.emit();\n        }\n    }\n\n    private function hideAndDispose (scene :Entity)\n    {\n        hide(scene);\n        scene.dispose();\n    }\n\n    private function show (scene :Entity)\n    {\n        var events = scene.get(Scene);\n        if (events != null) {\n            events.shown.emit();\n        }\n    }\n\n    private function invalidateVisibility ()\n    {\n        // Find the last index of an opaque scene, or 0\n        var ii = scenes.length;\n        while (ii > 0) {\n            var scene = scenes[--ii];\n            var comp = scene.get(Scene);\n            if (comp == null || comp.opaque) {\n                break;\n            }\n        }\n\n        // All visible scenes up to, but not including, the top scene\n        occludedScenes = (scenes.length > 0) ? scenes.slice(ii, scenes.length-1) : [];\n\n        // Notify the new top scene that it's being shown\n        var scene = get_topScene();\n        if (scene != null) {\n            show(scene);\n        }\n    }\n\n    // Notes:\n    // - Any method that modifies the scene stack should immediately call completeTransition.\n    private function completeTransition ()\n    {\n        if (_transitor != null) {\n            _transitor.complete();\n            _transitor = null;\n\n            invalidateVisibility();\n        }\n    }\n\n    private function playTransition (from :Entity, to :Entity,\n        transition :Transition, onComplete :Void->Void)\n    {\n        completeTransition();\n        add(to);\n\n        if (transition != null) {\n            occludedScenes.push(from);\n\n            _transitor = new Transitor(from, to, transition, onComplete);\n            _transitor.init(this);\n        } else {\n            onComplete();\n            invalidateVisibility();\n        }\n    }\n\n    private function get_width () :Float\n    {\n        return (_width < 0) ? System.stage.width : _width;\n    }\n\n    private function get_height () :Float\n    {\n        return (_height < 0) ? System.stage.height : _height;\n    }\n\n    /** The container for the current scene. */\n    private var _root :Entity;\n\n    private var _transitor :Transitor = null;\n    private var _width :Float = -1;\n    private var _height :Float = -1;\n}\n\nprivate class Transitor\n{\n    public function new (from :Entity, to :Entity, transition :Transition, onComplete :Void->Void)\n    {\n        _from = from;\n        _to = to;\n        _transition = transition;\n        _onComplete = onComplete;\n    }\n\n    public function init (director :Director)\n    {\n        _transition.init(director, _from, _to);\n    }\n\n    public function update (dt :Float) :Bool\n    {\n        return _transition.update(dt);\n    }\n\n    public function complete ()\n    {\n        _transition.complete();\n        _onComplete();\n    }\n\n    private var _from :Entity;\n    private var _to :Entity;\n    private var _transition :Transition;\n\n    private var _onComplete :Void->Void;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.scene;\n\n/**\n * A transition between two scenes.\n */\nclass Transition\n{\n    /**\n     * Called by the Director to start the transition.\n     * @param director The director that requested the transition.\n     * @param from The old scene being transitioned from.\n     * @param to The new scene being transitioned to.\n     */\n    public function init (director :Director, from :Entity, to :Entity)\n    {\n        _director = director;\n        _from = from;\n        _to = to;\n    }\n\n    /**\n     * Called by the Director to update the transition.\n     * @returns True if the transition is complete.\n     */\n    public function update (dt :Float) :Bool\n    {\n        // See subclasses\n        return true;\n    }\n\n    /**\n     * Completes the transition. Note that the Director may call this at any time to fast-forward\n     * the transition.\n     */\n    public function complete ()\n    {\n        // See subclasses\n    }\n\n    private var _director :Director;\n    private var _from :Entity;\n    private var _to :Entity;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * Utility mixins for Arrays. Designed to be imported with 'using'.\n */\nclass Arrays\n{\n    public static function sortedInsert<A> (arr :Array<A>, val :A, comp :A -> A -> Int) :Int\n    {\n        var insertedIdx = -1;\n        var nn = arr.length;\n        for (ii in 0...nn) {\n            var compVal = arr[ii];\n            if (comp(val, compVal) <= 0) {\n                arr.insert(ii, val);\n                insertedIdx = ii;\n                break;\n            }\n        }\n\n        if (insertedIdx < 0) {\n            arr.push(val);\n            insertedIdx = arr.length - 1;\n        }\n\n        return insertedIdx;\n    }\n\n    /** Allocate an array of a predetermined length. */\n    @:noUsing inline public static function create<A> (length :Int) :Array<A>\n    {\n#if (flash || js)\n        // This trick only works in Flash and JS\n        return untyped __new__(Array, length);\n#else\n        #error \"Arrays.create unimplemented on this target\"\n#end\n    }\n\n    /** Resizes an array in-place. */\n    inline public static function resize<A> (arr :Array<A>, length :Int)\n    {\n#if (flash || js)\n        // This trick only works in Flash and JS\n        (untyped arr).length = length;\n#else\n        #error \"Arrays.resize unimplemented on this target\"\n#end\n    }\n\n    inline public static function indexOf<A> (arr :Array<A>, element :A, ?fromIndex :Int) :Int\n    {\n#if (flash || js)\n        return (untyped arr).indexOf(element, fromIndex);\n#else\n        #error \"Arrays.indexOf unimplemented on this target\"\n#end\n    }\n\n    inline public static function lastIndexOf<A> (arr :Array<A>, element :A, ?fromIndex :Int) :Int\n    {\n#if (flash || js)\n        return (untyped arr).lastIndexOf(element, fromIndex);\n#else\n        #error \"Arrays.lastIndexOf unimplemented on this target\"\n#end\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\nusing flambe.util.Strings;\n\n/**\n * Simple runtime assertions. A failed assertion throws an error, which should NOT be caught and\n * handled. Assertions are stripped from release builds, unless the -D flambe_keep_asserts compiler\n * flag is used.\n */\nclass Assert\n{\n#if (debug || flambe_keep_asserts)\n    /**\n     * Asserts that a condition is true.\n     * @param message If this assertion fails, the message to include in the thrown error.\n     * @param fields Optional fields to be formatted with the message, see Strings.withFields.\n     */\n    public static function that (condition :Bool, ?message :String, ?fields :Array<Dynamic>)\n    {\n        if (!condition) {\n            fail(message, fields);\n        }\n    }\n\n    /**\n     * Immediately fails an assertion. Same as Assert.that(false).\n     * @param message The message to include in the thrown error.\n     * @param fields Optional fields to be formatted with the message, see Strings.withFields.\n     */\n    public static function fail (?message :String, ?fields :Array<Dynamic>)\n    {\n        var error = \"Assertion failed!\";\n        if (message != null) {\n            error += \" \" + message;\n        }\n        if (fields != null) {\n            error = error.withFields(fields);\n        }\n        throw error;\n    }\n\n#else\n    // In release builds, assertions are stripped out\n    inline public static function that (condition :Bool, ?message :String, ?fields :Array<Dynamic>) {}\n    inline public static function fail (?message :String, ?fields :Array<Dynamic>) {}\n#end\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * Utility mixins for bit sets. Designed to be imported with 'using' to supplement regular Ints with\n * bitset functions.\n */\nclass BitSets\n{\n    /**\n     * Adds all the bits included in the mask, and returns the new bitset.\n     */\n    inline public static function add (bits :Int, mask :Int) :Int\n    {\n        return bits | mask;\n    }\n\n    /**\n     * Removes all the bits included in the mask, and returns the new bitset.\n     */\n    inline public static function remove (bits :Int, mask :Int) :Int\n    {\n        return bits & ~mask;\n    }\n\n    /**\n     * Toggles all the bits included in the mask, and returns the new bitset.\n     */\n    inline public static function toggle (bits :Int, mask :Int) :Int\n    {\n        return bits ^ mask;\n    }\n\n    /**\n     * Returns true if the bitset contains ANY of the bits in the given mask.\n     */\n    inline public static function contains (bits :Int, mask :Int) :Bool\n    {\n        return bits & mask != 0;\n    }\n\n    /**\n     * Returns true if the bitset contains ALL of the bits in the given mask.\n     */\n    inline public static function containsAll (bits :Int, mask :Int) :Bool\n    {\n        return bits & mask == mask;\n    }\n\n    /**\n     * Either adds or removes all the bits included in the mask, and returns the new bitset.\n     */\n    public static function set (bits :Int, mask :Int, enabled :Bool) :Int\n    {\n        return enabled ? add(bits, mask) : remove(bits, mask);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\nimport flambe.math.FMath;\n\nusing flambe.util.Arrays;\n\n/**\n * A pool of reusable objects that can be used to avoid allocation.\n *\n * ```haxe\n * // Create a pool and preallocate it with 10 ExpensiveObjects.\n * var pool = new Pool(function () return new ExpensiveObject()).setSize(10);\n *\n * var obj = pool.take();\n * // ...\n * pool.put(obj);\n * ```\n */\nclass Pool<A>\n{\n    /**\n     * @param allocator A function that creates a new object.\n     */\n    public function new (allocator :Void -> A)\n    {\n        _allocator = allocator;\n        _freeObjects = [];\n    }\n\n    /**\n     * Take an object from the pool. If the pool is empty, a new object will be allocated.\n     *\n     * You should later release the object back into the pool by calling `put()`.\n     */\n    public function take () :A\n    {\n        if (_freeObjects.length > 0) {\n            return _freeObjects.pop();\n        }\n        var object = _allocator();\n        Assert.that(object != null);\n        return object;\n    }\n\n    /**\n     * Put an object into the pool. This should be called to release objects previously claimed with\n     * `take()`. Can also be called to pre-allocate the pool with new objects.\n     */\n    public function put (object :A)\n    {\n        Assert.that(object != null);\n        if (_freeObjects.length < _capacity) {\n            _freeObjects.push(object);\n        }\n    }\n\n    /**\n     * Resizes the pool. If the given size is larger than the current number of pooled objects, new\n     * objects are allocated to expand the pool. Otherwise, objects are trimmed out of the pool.\n     *\n     * @returns This instance, for chaining.\n     */\n    public function setSize (size :Int) :Pool<A>\n    {\n        if (_freeObjects.length > size) {\n            _freeObjects.resize(size);\n        } else {\n            var needed = size - _freeObjects.length;\n            for (ii in 0...needed) {\n                var object = _allocator();\n                Assert.that(object != null);\n                _freeObjects.push(object);\n            }\n        }\n        return this;\n    }\n\n    /**\n     * Sets the maximum capacity of the pool. By default, the pool can grow to any size.\n     *\n     * @returns This instance, for chaining.\n     */\n    public function setCapacity (capacity :Int) :Pool<A>\n    {\n        if (_freeObjects.length > capacity) {\n            _freeObjects.resize(capacity);\n        }\n        _capacity = capacity;\n        return this;\n    }\n\n    private var _allocator :Void -> A;\n    private var _freeObjects :Array<A>;\n    private var _capacity :Int = FMath.INT_MAX;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * Represents a value that isn't ready yet, but may become available in the future.\n */\nclass Promise<A>\n{\n    /**\n     * The end result fulfilled by the promise. When accessing, throws an error if the result is not\n     * yet available. Read hasResult to check availability first, or use get(). When setting, throws\n     * an error if the result was already previously assigned.\n     */\n    public var result (get, set) :A;\n\n    /**\n     * Whether the result is available yet.\n     */\n    public var hasResult (default, null) :Bool;\n\n    /**\n     * Emitted when the promise is fulfilled and the result has become available.\n     */\n    public var success (default, null) :Signal1<A>;\n\n    /**\n     * An error message emitted if there was a problem during loading.\n     */\n    public var error (default, null) :Signal1<String>;\n\n    /**\n     * May be emitted during loading when the progress or total counts have been updated.\n     */\n    public var progressChanged (default, null) :Signal0;\n\n    /**\n     * Context on how close this promise is to being fulfilled. For file IO, these are in bytes.\n     */\n    public var progress (get, set) :Float;\n    public var total (get, set) :Float;\n\n    public function new ()\n    {\n        success = new Signal1();\n        error = new Signal1();\n        progressChanged = new Signal0();\n        hasResult = false;\n        _progress = 0;\n        _total = 0;\n    }\n\n    private function get_result () :A\n    {\n        if (!hasResult) {\n            throw \"Promise result not yet available\";\n        }\n        return _result;\n    }\n\n    private function set_result (result :A) :A\n    {\n        if (hasResult) {\n            throw \"Promise result already assigned\";\n        }\n\n        _result = result;\n        hasResult = true;\n        success.emit(result);\n        return result;\n    }\n\n    /**\n     * Passes the result to the callback now if the result is available, otherwise calls it later.\n     * @returns If the callback was not called yet, a handle that can be disposed to cancel the\n     * request.\n     */\n    public function get (fn :A -> Void) :Disposable\n    {\n        if (hasResult) {\n            fn(_result);\n            return null;\n        }\n        return success.connect(fn).once();\n    }\n\n    inline private function get_progress () :Float\n    {\n        return _progress;\n    }\n\n    private function set_progress (progress :Float) :Float\n    {\n        if (_progress != progress) {\n            _progress = progress;\n            progressChanged.emit();\n        }\n        return progress;\n    }\n\n    private function set_total (total :Float) :Float\n    {\n        if (_total != total) {\n            _total = total;\n            progressChanged.emit();\n        }\n        return total;\n    }\n\n    inline private function get_total () :Float\n    {\n        return _total;\n    }\n\n    private var _result :A;\n    private var _progress :Float;\n    private var _total :Float;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * An alias for Signal0 listeners.\n */\ntypedef Listener0 = Void -> Void;\n\n/**\n * A zero-argument signal. See Signal1 and Signal2 for different arities.\n */\nclass Signal0 extends SignalBase\n{\n    /**\n     * @param listener An optional listener to immediately connect to the signal.\n     */\n    public function new (?listener :Listener0)\n    {\n        super(listener);\n    }\n\n    /**\n     * Connects a listener to this signal.\n     * @param prioritize True if this listener should fire before others.\n     * @returns A SignalConnection, that can be disposed to remove the listener.\n     */\n    public function connect (listener :Listener0, prioritize :Bool = false) :SignalConnection\n    {\n        return connectImpl(listener, prioritize);\n    }\n\n    /**\n     * Emit the signal, notifying each connected listener.\n     */\n    public function emit ()\n    {\n        if (dispatching()) {\n            defer(function () {\n                emitImpl();\n            });\n        } else {\n            emitImpl();\n        }\n    }\n\n    private function emitImpl ()\n    {\n        var head = willEmit();\n        var p = head;\n        while (p != null) {\n            p._listener();\n            if (!p.stayInList) {\n                p.dispose();\n            }\n            p = p._next;\n        }\n        didEmit(head);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\nusing StringTools;\n\n/**\n * Utility mixins for Strings. Designed to be imported with 'using'.\n */\nclass Strings\n{\n    /**\n     * Gets the extension of a file name, or null if there is no extension.\n     */\n    public static function getFileExtension (fileName :String) :String\n    {\n        var dot = fileName.lastIndexOf(\".\");\n        return (dot > 0) ? fileName.substr(dot+1) : null;\n    }\n\n    /**\n     * Returns a file name without its extension.\n     */\n    public static function removeFileExtension (fileName :String) :String\n    {\n        var dot = fileName.lastIndexOf(\".\");\n        return (dot > 0) ? fileName.substr(0, dot) : fileName;\n    }\n\n    /**\n     * Gets the extension of a full path or URL, with special handling for '/' and '?' characters.\n     * Returns null if there is no extension.\n     */\n    public static function getUrlExtension (url :String) :String\n    {\n        var question = url.lastIndexOf(\"?\");\n        if (question >= 0) {\n            url = url.substr(0, question);\n        }\n        var slash = url.lastIndexOf(\"/\");\n        if (slash >= 0) {\n            url = url.substr(slash+1);\n        }\n        return getFileExtension(url);\n    }\n\n    /**\n     * Joins two strings with a path separator.\n     */\n    public static function joinPath (base :String, relative :String) :String\n    {\n        if (base.length > 0 && base.fastCodeAt(base.length-1) != \"/\".code) {\n            base += \"/\"; // Ensure base ends with a trailing slash\n        }\n        return base + relative;\n    }\n\n    public static function hashCode (str :String) :Int\n    {\n        var code = 0;\n        if (str != null) {\n            for (ii in 0...str.length) {\n                code = Std.int(31*code + str.fastCodeAt(ii));\n            }\n        }\n        return code;\n    }\n\n    /**\n     * Substitute all \"{n}\" tokens with the corresponding values.\n     *\n     * ```haxe\n     * \"{1} sat on a {0}\".substitute([\"wall\", \"Humpty Dumpty\"]);\n     * // returns \"Humpty Dumpty sat on a wall\"\n     * ```\n     */\n    public static function substitute (str :String, values :Array<Dynamic>) :String\n    {\n        // FIXME(bruno): If your {0} replacement has a {1} in it, then that'll get replaced next\n        // iteration\n        for (ii in 0...values.length) {\n            str = str.replace(\"{\" + ii + \"}\", values[ii]);\n        }\n        return str;\n    }\n\n    /**\n     * Format a message with named parameters into a standard format for logging and errors.\n     *\n     * ```haxe\n     * \"Wobbles were frobulated\".withFields([\"count\", 5, \"silly\", true]);\n     * // returns \"Wobbles were frobulated [count=5, silly=true]\"\n     * ```\n     *\n     * @param fields The field names and values to be formatted. Must have an even length.\n     */\n    public static function withFields (message :String, fields :Array<Dynamic>) :String\n    {\n        var ll = fields.length;\n        if (ll > 0) {\n            message += (message.length > 0) ? \" [\" : \"[\";\n            var ii = 0;\n            while (ii < ll) {\n                if (ii > 0) {\n                    message += \", \";\n                }\n                var name = fields[ii];\n                var value :Dynamic = fields[ii + 1];\n\n                // Replace throwables with their stack trace\n#if flash\n                if (Std.is(value, flash.errors.Error)) {\n                    var stack :String = cast(value, flash.errors.Error).getStackTrace();\n                    if (stack != null) {\n                        value = stack;\n                    }\n                }\n#elseif js\n                if (Std.is(value, untyped __js__(\"Error\"))) {\n                    var stack :String = value.stack;\n                    if (stack != null) {\n                        value = stack;\n                    }\n                }\n#end\n                message += name + \"=\" + value;\n                ii += 2;\n            }\n            message += \"]\";\n        }\n\n        return message;\n    }\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe;\n\n/**\n\tLog primarily provides the trace() method, which is invoked upon a call to\n\ttrace() in haxe code.\n**/\nclass Log {\n\n\t/**\n\t\tOutputs `v` in a platform-dependent way.\n\n\t\tThe second parameter `infos` is injected by the compiler and contains\n\t\tinformation about the position where the trace() call was made.\n\n\t\tThis method can be rebound to a custom function:\n\t\t\tvar oldTrace = haxe.Log.trace; // store old function\n\t\t\thaxe.Log.trace = function(v,infos) { // handle trace }\n\t\t\t...\n\t\t\thaxe.Log.trace = oldTrace;\n\n\t\tIf it is bound to null, subsequent calls to trace() will cause an\n\t\texception.\n\t**/\n\tpublic static dynamic function trace( v : Dynamic, ?infos : PosInfos ) : Void {\n\t\t#if flash\n\t\t\t#if (fdb || native_trace)\n\t\t\t\tvar pstr = infos == null ? \"(null)\" : infos.fileName + \":\" + infos.lineNumber;\n\t\t\t\tvar str = flash.Boot.__string_rec(v, \"\");\n\t\t\t\tif( infos != null && infos.customParams != null ) for( v in infos.customParams ) str += \",\" + flash.Boot.__string_rec(v, \"\");\n\t\t\t\tuntyped #if flash9 __global__[\"trace\"] #else __trace__ #end(pstr+\": \"+str);\n\t\t\t#else\n\t\t\t\tuntyped flash.Boot.__trace(v,infos);\n\t\t\t#end\n\t\t#elseif neko\n\t\t\tuntyped {\n\t\t\t\t$print(infos.fileName + \":\" + infos.lineNumber + \": \", v);\n\t\t\t\tif( infos.customParams != null ) for( v in infos.customParams ) $print(\",\", v);\n\t\t\t\t$print(\"\\n\");\n\t\t\t}\n\t\t#elseif js\n\t\t\tuntyped js.Boot.__trace(v,infos);\n\t\t#elseif php\n\t\t\tif (infos!=null && infos.customParams!=null) {\n\t\t\t\tvar extra:String = \"\";\n\t\t\t\tfor( v in infos.customParams )\n\t\t\t\t\textra += \",\" + v;\n\t\t\t\tuntyped __call__('_hx_trace', v + extra, infos);\n\t\t\t}\n\t\t\telse\n\t\t\t\tuntyped __call__('_hx_trace', v, infos);\n\t\t#elseif cpp\n\t\t\tif (infos!=null && infos.customParams!=null) {\n\t\t\t\tvar extra:String = \"\";\n\t\t\t\tfor( v in infos.customParams )\n\t\t\t\t\textra += \",\" + v;\n\t\t\t\tuntyped __trace(v + extra,infos);\n\t\t\t}\n\t\t\telse\n\t\t\t\tuntyped __trace(v,infos);\n\t\t#elseif (cs || java)\n\t\t\tvar str:String = null;\n\t\t\tif (infos != null) {\n\t\t\t\tstr = infos.fileName + \":\" + infos.lineNumber + \": \" + v;\n\t\t\t\tif (infos.customParams != null)\n\t\t\t\t{\n\t\t\t\t\tstr += \",\" + infos.customParams.join(\",\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tstr = v;\n\t\t\t}\n\t\t\t#if cs\n\t\t\tcs.system.Console.WriteLine(str);\n\t\t\t#elseif java\n\t\t\tuntyped __java__(\"java.lang.System.out.println(str)\");\n\t\t\t#end\n\t\t#end\n\t}\n\n\t#if (flash || js)\n\t/**\n\t\tClears the trace output.\n\t**/\n\tpublic static dynamic function clear() : Void {\n\t\t#if flash\n\t\tuntyped flash.Boot.__clear_trace();\n\t\t#elseif js\n\t\tuntyped js.Boot.__clear_trace();\n\t\t#end\n\t}\n\t#end\n\n\t#if flash\n\t/**\n\t\tSets the color of the trace output to `rgb`.\n\t**/\n\tpublic static dynamic function setColor( rgb : Int ) {\n\t\tuntyped flash.Boot.__set_trace_color(rgb);\n\t}\n\t#end\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.crypto;\n\nclass Crc32 {\n\n\tvar crc : Int;\n\n\tpublic function new() {\n\t\tcrc = 0xFFFFFFFF;\n\t}\n\n\tpublic function byte( b : Int ) {\n\t\tvar tmp = (crc ^ b) & 0xFF;\n\t\tfor( j in 0...8 ) {\n\t\t\tif( tmp & 1 == 1 )\n\t\t\t\ttmp = (tmp >>> 1) ^ 0xEDB88320;\n\t\t\telse\n\t\t\t\ttmp >>>= 1;\n\t\t}\n\t\tcrc = (crc >>> 8) ^ tmp;\n\t}\n\n\tpublic function update( b : haxe.io.Bytes, pos, len ) {\n\t\tvar b = b.getData();\n\t\tfor( i in pos...pos+len ) {\n\t\t\tvar tmp = (crc ^ haxe.io.Bytes.fastGet(b,i)) & 0xFF;\n\t\t\tfor( j in 0...8 ) {\n\t\t\t\tif( tmp & 1 == 1 )\n\t\t\t\t\ttmp = (tmp >>> 1) ^ 0xEDB88320;\n\t\t\t\telse\n\t\t\t\t\ttmp >>>= 1;\n\t\t\t}\n\t\t\tcrc = (crc >>> 8) ^ tmp;\n\t\t}\n\t}\n\n\tpublic function get() {\n\t\treturn crc ^ 0xFFFFFFFF;\n\t}\n\n\t/**\n\t\tCalculates the CRC32 of the given data bytes\n\t**/\n\tpublic static function make( data : haxe.io.Bytes ) : Int {\n\t\tvar init = 0xFFFFFFFF;\n\t\tvar crc = init;\n\t\tvar b = data.getData();\n\t\tfor( i in 0...data.length ) {\n\t\t\tvar tmp = (crc ^ haxe.io.Bytes.fastGet(b,i)) & 0xFF;\n\t\t\tfor( j in 0...8 ) {\n\t\t\t\tif( tmp & 1 == 1 )\n\t\t\t\t\ttmp = (tmp >>> 1) ^ 0xEDB88320;\n\t\t\t\telse\n\t\t\t\t\ttmp >>>= 1;\n\t\t\t}\n\t\t\tcrc = (crc >>> 8) ^ tmp;\n\t\t}\n\t\treturn crc ^ init;\n\t}\n\n}","/*\n * Copyright (C)2005-2013 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.ds;\n\n/**\n\tBalancedTree allows key-value mapping with arbitrary keys, as long as they\n\tcan be ordered. By default, `Reflect.compare` is used in the `compare`\n\tmethod, which can be overridden in subclasses.\n\n\tOperations have a logarithmic average and worst-case cost.\n\n\tIteration over keys and values, using `keys` and `iterator` respectively,\n\tare in-order.\n**/\nclass BalancedTree<K,V> {\n\tvar root:TreeNode<K,V>;\n\n\t/**\n\t\tCreates a new BalancedTree, which is initially empty.\n\t**/\n\tpublic function new() { }\n\n\t/**\n\t\tBinds `key` to `value`.\n\n\t\tIf `key` is already bound to a value, that binding disappears.\n\n\t\tIf `key` is null, the result is unspecified.\n\t**/\n\tpublic function set(key:K, value:V) {\n\t\troot = setLoop(key, value, root);\n\t}\n\n\t/**\n\t\tReturns the value `key` is bound to.\n\n\t\tIf `key` is not bound to any value, `null` is returned.\n\n\t\tIf `key` is null, the result is unspecified.\n\t**/\n\tpublic function get(key:K):Null<V> {\n\t\tvar node = root;\n\t\twhile (node != null) {\n\t\t\tvar c = compare(key, node.key);\n\t\t\tif (c == 0) return node.value;\n\t\t\tif (c < 0) node = node.left;\n\t\t\telse node = node.right;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t\tRemoves the current binding of `key`.\n\n\t\tIf `key` has no binding, `this` BalancedTree is unchanged and false is\n\t\treturned.\n\n\t\tOtherwise the binding of `key` is removed and true is returned.\n\n\t\tIf `key` is null, the result is unspecified.\n\t**/\n\tpublic function remove(key:K) {\n\t\ttry {\n\t\t\troot = removeLoop(key, root);\n\t\t\treturn true;\n\t\t}\n\t\tcatch (e:String) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t\tTells if `key` is bound to a value.\n\n\t\tThis method returns true even if `key` is bound to null.\n\n\t\tIf `key` is null, the result is unspecified.\n\t**/\n\tpublic function exists(key:K) {\n\t\tvar node = root;\n\t\twhile (node != null) {\n\t\t\tvar c = compare(key, node.key);\n\t\t\tif (c == 0) return true;\n\t\t\telse if (c < 0) node = node.left;\n\t\t\telse node = node.right;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t\tIterates over the bound values of `this` BalancedTree.\n\n\t\tThis operation is performed in-order.\n\t**/\n\tpublic function iterator():Iterator<V> {\n\t\tvar ret = [];\n\t\titeratorLoop(root, ret);\n\t\treturn ret.iterator();\n\t}\n\n\t/**\n\t\tIterates over the keys of `this` BalancedTree.\n\n\t\tThis operation is performed in-order.\n\t**/\n\tpublic function keys():Iterator<K> {\n\t\tvar ret = [];\n\t\tkeysLoop(root, ret);\n\t\treturn ret.iterator();\n\t}\n\n\tfunction setLoop(k:K, v:V, node:TreeNode<K,V>) {\n\t\tif (node == null) return new TreeNode<K,V>(null, k, v, null);\n\t\tvar c = compare(k, node.key);\n\t\treturn if (c == 0) new TreeNode<K,V>(node.left, k, v, node.right, node.get_height());\n\t\telse if (c < 0) {\n\t\t\tvar nl = setLoop(k, v, node.left);\n\t\t\tbalance(nl, node.key, node.value, node.right);\n\t\t} else {\n\t\t\tvar nr = setLoop(k, v, node.right);\n\t\t\tbalance(node.left, node.key, node.value, nr);\n\t\t}\n\t}\n\n\tfunction removeLoop(k:K, node:TreeNode<K,V>) {\n\t\tif (node == null) throw \"Not_found\";\n\t\tvar c = compare(k, node.key);\n\t\treturn if (c == 0) merge(node.left, node.right);\n\t\telse if (c < 0) balance(removeLoop(k, node.left), node.key, node.value, node.right);\n\t\telse balance(node.left, node.key, node.value, removeLoop(k, node.right));\n\t}\n\n\tfunction iteratorLoop(node:TreeNode<K,V>, acc:Array<V>) {\n\t\tif (node != null) {\n\t\t\titeratorLoop(node.left, acc);\n\t\t\tacc.push(node.value);\n\t\t\titeratorLoop(node.right, acc);\n\t\t}\n\t}\n\n\tfunction keysLoop(node:TreeNode<K,V>, acc:Array<K>) {\n\t\tif (node != null) {\n\t\t\tkeysLoop(node.left, acc);\n\t\t\tacc.push(node.key);\n\t\t\tkeysLoop(node.right, acc);\n\t\t}\n\t}\n\n\tfunction merge(t1, t2) {\n\t\tif (t1 == null) return t2;\n\t\tif (t2 == null) return t1;\n\t\tvar t = minBinding(t2);\n\t\treturn balance(t1, t.key, t.value, removeMinBinding(t2));\n\t}\n\n\tfunction minBinding(t:TreeNode<K,V>) {\n\t\treturn if (t == null) throw \"Not_found\";\n\t\telse if (t.left == null) t;\n\t\telse minBinding(t.left);\n\t}\n\n\tfunction removeMinBinding(t:TreeNode<K,V>) {\n\t\treturn if (t.left == null) t.right;\n\t\telse balance(removeMinBinding(t.left), t.key, t.value, t.right);\n\t}\n\n\tfunction balance(l:TreeNode<K,V>, k:K, v:V, r:TreeNode<K,V>):TreeNode<K,V> {\n\t\tvar hl = l.get_height();\n\t\tvar hr = r.get_height();\n\t\treturn if (hl > hr + 2) {\n\t\t\tif (l.left.get_height() >= l.right.get_height()) new TreeNode<K,V>(l.left, l.key, l.value, new TreeNode<K,V>(l.right, k, v, r));\n\t\t\telse new TreeNode<K,V>(new TreeNode<K,V>(l.left,l.key, l.value, l.right.left), l.right.key, l.right.value, new TreeNode<K,V>(l.right.right, k, v, r));\n\t\t} else if (hr > hl + 2) {\n\t\t\tif (r.right.get_height() > r.left.get_height()) new TreeNode<K,V>(new TreeNode<K,V>(l, k, v, r.left), r.key, r.value, r.right);\n\t\t\telse new TreeNode<K,V>(new TreeNode<K,V>(l, k, v, r.left.left), r.left.key, r.left.value, new TreeNode<K,V>(r.left.right, r.key, r.value, r.right));\n\t\t} else {\n\t\t\tnew TreeNode<K,V>(l, k, v, r, (hl > hr ? hl : hr) + 1);\n\t\t}\n\t}\n\n\tfunction compare(k1:K, k2:K) {\n\t\treturn Reflect.compare(k1, k2);\n\t}\n\n\tpublic function toString() {\n\t\treturn '{${root.toString()}}';\n\t}\n}\n\nclass TreeNode<K,V> {\n\tpublic var left : TreeNode<K,V>;\n\tpublic var right : TreeNode<K,V>;\n\tpublic var key : K;\n\tpublic var value : V;\n\t#if as3\n\tpublic\n\t#end\n\tvar _height : Int;\n\n\tpublic function new(l, k, v, r, h = -1) {\n\t\tleft = l;\n\t\tkey = k;\n\t\tvalue = v;\n\t\tright = r;\n\t\tif (h == -1)\n\t\t\t_height = (left.get_height() > right.get_height() ? left.get_height() : right.get_height()) + 1;\n\t\telse\n\t\t\t_height = h;\n\t}\n\n\t@:extern public inline function get_height() return this == null ? 0 : _height;\n\n\tpublic function toString() {\n\t\treturn (left == null ? \"\" : left.toString() + \", \") + '$key=$value' + (right == null ? \"\" : \", \" +right.toString());\n\t}\n}","/*\n * Copyright (C)2005-2013 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.ds;\n\n/**\n\tEnumValueMap allows mapping of enum value keys to arbitrary values.\n\n\tKeys are compared by value and recursively over their parameters. If any\n\tparameter is not an enum value, `Reflect.compare` is used to compare them.\n**/\nclass EnumValueMap<K:EnumValue, V> extends haxe.ds.BalancedTree<K, V> implements Map.IMap<K,V> {\n\n\toverride function compare(k1:EnumValue, k2:EnumValue):Int {\n\t\tvar d = k1.getIndex() - k2.getIndex();\n\t\tif (d != 0) return d;\n\t\tvar p1 = k1.getParameters();\n\t\tvar p2 = k2.getParameters();\n\t\tif (p1.length == 0 && p2.length == 0) return 0;\n\t\treturn compareArgs(p1, p2);\n\t}\n\n\tfunction compareArgs(a1:Array<Dynamic>, a2:Array<Dynamic>):Int {\n\t\tvar ld = a1.length - a2.length;\n\t\tif (ld != 0) return ld;\n\t\tfor (i in 0...a1.length) {\n\t\t\tvar d = compareArg(a1[i], a2[i]);\n\t\t\tif (d != 0) return d;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tfunction compareArg(v1:Dynamic, v2:Dynamic):Int {\n\t\treturn if (Reflect.isEnumValue(v1) && Reflect.isEnumValue(v2)) {\n\t\t\tcompare(v1, v2);\n\t\t} else if (Std.is(v1, Array) && Std.is(v2, Array)) {\n\t\t\tcompareArgs(v1, v2);\n\t\t} else {\n\t\t\tReflect.compare(v1, v2);\n\t\t}\n\t}\n}","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.ds;\n\n#if (flash9 || cpp)\n@:generic\n#end\nclass GenericCell<T> {\n\tpublic var elt : T;\n\tpublic var next : GenericCell<T>;\n\tpublic function new(elt,next) { this.elt = elt; this.next = next; }\n}\n\n#if cpp\n@:generic\nprivate class GenericStackIterator<T> extends cpp.FastIterator<T> {\n\tpublic var current : GenericCell<T>;\n\toverride public function hasNext():Bool { return current!=null; }\n\toverride public function next():T { var result = current.elt; current = current.next; return result; }\n\n\tpublic function new(head) { current = head; }\n}\n\n#end\n\n/**\n\tA stack of elements.\n\n\tThis class is generic, which means one type is generated for each type\n\tparameter T on static targets. For example:\n\n\t- `new GenericStack<Int>()` generates `GenericStack_Int`\n\t- `new GenericStack<String>()` generates `GenericStack_String`\n\n\tThe generated name is an implementation detail and should not be relied\n\tupon.\n**/\n#if (flash9 || cpp)\n@:generic\n#end\nclass GenericStack<T> {\n\n\tpublic var head : GenericCell<T>;\n\n\t/**\n\t\tCreates a new empty GenericStack.\n\t**/\n\tpublic function new() {\n\t}\n\n\t/**\n\t\tPushes element `item` onto the stack.\n\t**/\n\tpublic inline function add( item : T ) {\n\t\thead = new GenericCell<T>(item,head);\n\t}\n\n\t/**\n\t\tReturns the topmost stack element without removing it.\n\n\t\tIf the stack is empty, null is returned.\n\t**/\n\tpublic inline function first() : Null<T> {\n\t\treturn if( head == null ) null else head.elt;\n\t}\n\n\t/**\n\t\tReturns the topmost stack element and removes it.\n\n\t\tIf the stack is empty, null is returned.\n\t**/\n\tpublic inline function pop() : Null<T> {\n\t\tvar k = head;\n\t\tif( k== null )\n\t\t\treturn null;\n\t\telse {\n\t\t\thead = k.next;\n\t\t\treturn k.elt;\n\t\t}\n\t}\n\n\t/**\n\t\tTells if the stack is empty.\n\t**/\n\tpublic inline function isEmpty() : Bool {\n\t\treturn (head == null);\n\t}\n\n\t/**\n\t\tRemoves the first element which is equal to `v` according to the `==`\n\t\toperator.\n\n\t\tThis method traverses the stack until it finds a matching element and\n\t\tunlinks it, returning true.\n\n\t\tIf no matching element is found, false is returned.\n\t**/\n\tpublic function remove( v : T ) : Bool {\n\t\tvar prev = null;\n\t\tvar l = head;\n\t\twhile( l != null ) {\n\t\t\tif( l.elt == v ) {\n\t\t\t\tif( prev == null )\n\t\t\t\t\thead = l.next;\n\t\t\t\telse\n\t\t\t\t\tprev.next = l.next;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tprev = l;\n\t\t\tl = l.next;\n\t\t}\n\t\treturn (l != null);\n\t}\n\n\t#if cpp\n\n\t/**\n\t\tReturns an iterator over the elements of `this` GenericStack.\n\t**/\n\tpublic function iterator() : Iterator<T> {\n\t\treturn new GenericStackIterator<T>(head);\n\t}\n\n\t#else\n\n\t/**\n\t\tReturns an iterator over the elements of `this` GenericStack.\n\t**/\n\tpublic function iterator() : Iterator<T> {\n\t\tvar l = head;\n\t\treturn {\n\t\t\thasNext : function() {\n\t\t\t\treturn l != null;\n\t\t\t},\n\t\t\tnext : function() {\n\t\t\t\tvar k = l;\n\t\t\t\tl = k.next;\n\t\t\t\treturn k.elt;\n\t\t\t}\n\t\t};\n\t}\n   #end\n\n\t/**\n\t\tReturns a String representation of `this` GenericStack.\n\t**/\n\tpublic function toString() {\n\t\tvar a = new Array();\n\t\tvar l = head;\n\t\twhile( l != null ) {\n\t\t\ta.push(l.elt);\n\t\t\tl = l.next;\n\t\t}\n\t\treturn \"{\"+a.join(\",\")+\"}\";\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.ds;\n\n@:coreApi class IntMap<T> implements Map.IMap<Int,T> {\n\n\tprivate var h : Dynamic;\n\n\tpublic function new() : Void {\n\t\th = {};\n\t}\n\n\tpublic function set( key : Int, value : T ) : Void {\n\t\tuntyped h[key] = value;\n\t}\n\n\tpublic function get( key : Int ) : Null<T> {\n\t\treturn untyped h[key];\n\t}\n\n\tpublic function exists( key : Int ) : Bool {\n\t\treturn untyped h.hasOwnProperty(key);\n\t}\n\n\tpublic function remove( key : Int ) : Bool {\n\t\tif( untyped !h.hasOwnProperty(key) ) return false;\n\t\tuntyped  __js__(\"delete\")(h[key]);\n\t\treturn true;\n\t}\n\n\tpublic function keys() : Iterator<Int> {\n\t\tvar a = [];\n\t\tuntyped {\n\t\t\t__js__(\"for( var key in this.h ) {\");\n\t\t\t\tif( h.hasOwnProperty(key) )\n\t\t\t\t\ta.push(key|0);\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn a.iterator();\n\t}\n\n\tpublic function iterator() : Iterator<T> {\n\t\treturn untyped {\n\t\t\tref : h,\n\t\t\tit : keys(),\n\t\t\thasNext : function() { return __this__.it.hasNext(); },\n\t\t\tnext : function() { var i = __this__.it.next(); return __this__.ref[i]; }\n\t\t};\n\t}\n\n\tpublic function toString() : String {\n\t\tvar s = new StringBuf();\n\t\ts.add(\"{\");\n\t\tvar it = keys();\n\t\tfor( i in it ) {\n\t\t\ts.add(i);\n\t\t\ts.add(\" => \");\n\t\t\ts.add(Std.string(get(i)));\n\t\t\tif( it.hasNext() )\n\t\t\t\ts.add(\", \");\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n\n}\n","/*\n * Copyright (C)2005-2013 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of h software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and h permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.ds;\n\n@:coreApi\nclass ObjectMap<K:{ }, V> implements Map.IMap<K,V> {\n\n\tstatic var count = 0;\n\n\tstatic inline function assignId(obj: { } ):Int {\n\t\treturn untyped obj.__id__ = ++count;\n\t}\n\n\tstatic inline function getId(obj: { } ):Int {\n\t\treturn untyped obj.__id__;\n\t}\n\n\tvar h : { };\n\n\tpublic function new() : Void {\n\t\th = { };\n\t\tuntyped h.__keys__ = { };\n\t}\n\n\tpublic function set(key:K, value:V):Void untyped {\n\t\tvar id : Int = untyped key.__id__ || assignId(key);\n\t\th[id] = value;\n\t\th.__keys__[id] = key;\n\t}\n\n\tpublic inline function get(key:K):Null<V> {\n\t\treturn untyped h[getId(key)];\n\t}\n\n\tpublic inline function exists(key:K):Bool {\n\t\treturn untyped h.__keys__[getId(key)] != null;\n\t}\n\n\tpublic function remove( key : K ) : Bool {\n\t\tvar id = getId(key);\n\t\tif ( untyped h.__keys__[id] == null ) return false;\n\t\tuntyped  __js__(\"delete\")(h[id]);\n\t\tuntyped  __js__(\"delete\")(h.__keys__[id]);\n\t\treturn true;\n\t}\n\n\tpublic function keys() : Iterator<K> {\n\t\tvar a = [];\n\t\tuntyped {\n\t\t\t__js__(\"for( var key in this.h.__keys__ ) {\");\n\t\t\t\tif( h.hasOwnProperty(key) )\n\t\t\t\t\ta.push(h.__keys__[key]);\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn a.iterator();\n\t}\n\n\tpublic function iterator() : Iterator<V> {\n\t\treturn untyped {\n\t\t\tref : h,\n\t\t\tit : keys(),\n\t\t\thasNext : function() { return __this__.it.hasNext(); },\n\t\t\tnext : function() { var i = __this__.it.next(); return __this__.ref[getId(i)]; }\n\t\t};\n\t}\n\n\tpublic function toString() : String {\n\t\tvar s = new StringBuf();\n\t\ts.add(\"{\");\n\t\tvar it = keys();\n\t\tfor( i in it ) {\n\t\t\ts.add(Std.string(i));\n\t\t\ts.add(\" => \");\n\t\t\ts.add(Std.string(get(i)));\n\t\t\tif( it.hasNext() )\n\t\t\t\ts.add(\", \");\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n}","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.ds;\n\n@:coreApi class StringMap<T> implements Map.IMap<String,T> {\n\n\tprivate var h : Dynamic;\n\n\tpublic function new() : Void {\n\t\th = {};\n\t}\n\n\tpublic function set( key : String, value : T ) : Void {\n\t\tuntyped h[\"$\"+key] = value;\n\t}\n\n\tpublic function get( key : String ) : Null<T> {\n\t\treturn untyped h[\"$\"+key];\n\t}\n\n\tpublic function exists( key : String ) : Bool {\n\t\treturn untyped h.hasOwnProperty(\"$\"+key);\n\t}\n\n\tpublic function remove( key : String ) : Bool {\n\t\tkey = \"$\"+key;\n\t\tif( untyped !h.hasOwnProperty(key) ) return false;\n\t\tuntyped __js__(\"delete\")(h[key]);\n\t\treturn true;\n\t}\n\n\tpublic function keys() : Iterator<String> {\n\t\tvar a = [];\n\t\tuntyped {\n\t\t\t__js__(\"for( var key in this.h ) {\");\n\t\t\t\tif( h.hasOwnProperty(key) )\n\t\t\t\t\ta.push(key.substr(1));\n\t\t\t__js__(\"}\");\n\t\t}\n\t\treturn a.iterator();\n\t}\n\n\tpublic function iterator() : Iterator<T> {\n\t\treturn untyped {\n\t\t\tref : h,\n\t\t\tit : keys(),\n\t\t\thasNext : function() { return __this__.it.hasNext(); },\n\t\t\tnext : function() { var i = __this__.it.next(); return __this__.ref[\"$\"+i]; }\n\t\t};\n\t}\n\n\tpublic function toString() : String {\n\t\tvar s = new StringBuf();\n\t\ts.add(\"{\");\n\t\tvar it = keys();\n\t\tfor( i in it ) {\n\t\t\ts.add(i);\n\t\t\ts.add(\" => \");\n\t\t\ts.add(Std.string(get(i)));\n\t\t\tif( it.hasNext() )\n\t\t\t\ts.add(\", \");\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.io;\n\n#if cpp\nusing cpp.NativeArray;\n#end\n\nclass Bytes {\n\n\tpublic var length(default,null) : Int;\n\tvar b : BytesData;\n\n\tfunction new(length,b) {\n\t\tthis.length = length;\n\t\tthis.b = b;\n\t\t#if flash9\n\t\tb.endian = flash.utils.Endian.LITTLE_ENDIAN;\n\t\t#end\n\t}\n\n\tpublic inline function get( pos : Int ) : Int {\n\t\t#if neko\n\t\treturn untyped __dollar__sget(b,pos);\n\t\t#elseif flash9\n\t\treturn b[pos];\n\t\t#elseif php\n\t\treturn untyped __call__(\"ord\", b[pos]);\n\t\t#elseif cpp\n\t\treturn untyped b[pos];\n\t\t#elseif java\n\t\treturn untyped b[pos] & 0xFF;\n\t\t#else\n\t\treturn b[pos];\n\t\t#end\n\t}\n\n\tpublic inline function set( pos : Int, v : Int ) : Void {\n\t\t#if neko\n\t\tuntyped __dollar__sset(b,pos,v);\n\t\t#elseif flash9\n\t\tb[pos] = v;\n\t\t#elseif php\n\t\tb[pos] = untyped __call__(\"chr\", v);\n\t\t#elseif cpp\n\t\tuntyped b[pos] = v;\n\t\t#elseif java\n\t\tb[pos] = cast v;\n\t\t#elseif cs\n\t\tb[pos] = cast v;\n\t\t#else\n\t\tb[pos] = v & 0xFF;\n\t\t#end\n\t}\n\n\tpublic function blit( pos : Int, src : Bytes, srcpos : Int, len : Int ) : Void {\n\t\t#if !neko\n\t\tif( pos < 0 || srcpos < 0 || len < 0 || pos + len > length || srcpos + len > src.length ) throw Error.OutsideBounds;\n\t\t#end\n\t\t#if neko\n\t\ttry untyped __dollar__sblit(b,pos,src.b,srcpos,len) catch( e : Dynamic ) throw Error.OutsideBounds;\n\t\t#elseif php\n\t\tb = untyped __php__(\"substr($this->b, 0, $pos) . substr($src->b, $srcpos, $len) . substr($this->b, $pos+$len)\"); //__call__(\"substr\", b, 0, pos)+__call__(\"substr\", src.b, srcpos, len)+__call__(\"substr\", b, pos+len);\n\t\t#elseif flash9\n\t\tb.position = pos;\n\t\tif( len > 0 ) b.writeBytes(src.b,srcpos,len);\n\t\t#elseif java\n\t\tjava.lang.System.arraycopy(src.b, srcpos, b, pos, len);\n\t\t#elseif cs\n\t\tcs.system.Array.Copy(src.b, srcpos, b, pos, len);\n\t\t#elseif cpp\n\t\tb.blit(pos, src.b, srcpos, len);\n\t\t#else\n\t\tvar b1 = b;\n\t\tvar b2 = src.b;\n\t\tif( b1 == b2 && pos > srcpos ) {\n\t\t\tvar i = len;\n\t\t\twhile( i > 0 ) {\n\t\t\t\ti--;\n\t\t\t\tb1[i + pos] = b2[i + srcpos];\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tfor( i in 0...len )\n\t\t\tb1[i+pos] = b2[i+srcpos];\n\t\t#end\n\t}\n\n\tpublic function fill( pos : Int, len : Int, value : Int ) {\n\t\t#if flash9\n\t\tvar v4 = value&0xFF;\n\t\tv4 |= v4<<8;\n\t\tv4 |= v4<<16;\n\t\tb.position = pos;\n\t\tfor( i in 0...len>>2 )\n\t\t\tb.writeUnsignedInt(v4);\n\t\tpos += len&~3;\n\t\tfor( i in 0...len&3 )\n\t\t\tset(pos++,value);\n\t\t#elseif cpp\n\t\tuntyped __global__.__hxcpp_memory_memset(b,pos,len,value);\n\t\t#else\n\t\tfor( i in 0...len )\n\t\t\tset(pos++, value);\n\t\t#end\n\t}\n\n\tpublic function sub( pos : Int, len : Int ) : Bytes {\n\t\t#if !neko\n\t\tif( pos < 0 || len < 0 || pos + len > length ) throw Error.OutsideBounds;\n\t\t#end\n\t\t#if neko\n\t\treturn try new Bytes(len,untyped __dollar__ssub(b,pos,len)) catch( e : Dynamic ) throw Error.OutsideBounds;\n\t\t#elseif flash9\n\t\tb.position = pos;\n\t\tvar b2 = new flash.utils.ByteArray();\n\t\tb.readBytes(b2,0,len);\n\t\treturn new Bytes(len,b2);\n\t\t#elseif php\n\t\treturn new Bytes(len, untyped __call__(\"substr\", b, pos, len));\n\t\t#elseif java\n\t\tvar newarr = new java.NativeArray(len);\n\t\tjava.lang.System.arraycopy(b, pos, newarr, 0, len);\n\t\treturn new Bytes(len, newarr);\n\t\t#elseif cs\n\t\tvar newarr = new cs.NativeArray(len);\n\t\tcs.system.Array.Copy(b, pos, newarr, 0, len);\n\t\treturn new Bytes(len, newarr);\n\t\t#else\n\t\treturn new Bytes(len,b.slice(pos,pos+len));\n\t\t#end\n\t}\n\n\tpublic function compare( other : Bytes ) : Int {\n\t\t#if neko\n\t\treturn untyped __dollar__compare(b,other.b);\n\t\t#elseif flash9\n\t\tvar len = (length < other.length) ? length : other.length;\n\t\tvar b1 = b;\n\t\tvar b2 = other.b;\n\t\tb1.position = 0;\n\t\tb2.position = 0;\n\t\tb1.endian = flash.utils.Endian.BIG_ENDIAN;\n\t\tb2.endian = flash.utils.Endian.BIG_ENDIAN;\n\t\tfor( i in 0...len>>2 )\n\t\t\tif( b1.readUnsignedInt() != b2.readUnsignedInt() ) {\n\t\t\t\tb1.position -= 4;\n\t\t\t\tb2.position -= 4;\n\t\t\t\tvar d = b1.readUnsignedInt() - b2.readUnsignedInt();\n\t\t\t\tb1.endian = flash.utils.Endian.LITTLE_ENDIAN;\n\t\t\t\tb2.endian = flash.utils.Endian.LITTLE_ENDIAN;\n\t\t\t\treturn d;\n\t\t\t}\n\t\tfor( i in 0...len & 3 )\n\t\t\tif( b1.readUnsignedByte() != b2.readUnsignedByte() ) {\n\t\t\t\tb1.endian = flash.utils.Endian.LITTLE_ENDIAN;\n\t\t\t\tb2.endian = flash.utils.Endian.LITTLE_ENDIAN;\n\t\t\t\treturn b1[b1.position-1] - b2[b2.position-1];\n\t\t\t}\n\t\tb1.endian = flash.utils.Endian.LITTLE_ENDIAN;\n\t\tb2.endian = flash.utils.Endian.LITTLE_ENDIAN;\n\t\treturn length - other.length;\n\t\t#elseif php\n\t\treturn untyped __php__(\"$this->b < $other->b ? -1 : ($this->b == $other->b ? 0 : 1)\");\n\t\t//#elseif cs\n\t\t//TODO: memcmp if unsafe flag is on\n\t\t#elseif cpp\n\t\treturn b.memcmp(other.b);\n\t\t#else\n\t\tvar b1 = b;\n\t\tvar b2 = other.b;\n\t\tvar len = (length < other.length) ? length : other.length;\n\t\tfor( i in 0...len )\n\t\t\tif( b1[i] != b2[i] )\n\t\t\t\t#if cpp\n\t\t\t\treturn untyped b1[i] - untyped b2[i];\n\t\t\t\t#else\n\t\t\t\treturn untyped b1[i] - untyped b2[i];\n\t\t\t\t#end\n\t\treturn length - other.length;\n\t\t#end\n\t}\n\n\tpublic function getDouble( pos : Int ) : Float {\n\t\t#if neko\n\t\treturn untyped Input._double_of_bytes(sub(pos,8).b,false);\n\t\t#elseif flash9\n\t\tb.position = pos;\n\t\treturn b.readDouble();\n\t\t#elseif cpp\n\t\tif( pos < 0 || pos + 8 > length ) throw Error.OutsideBounds;\n\t\treturn untyped __global__.__hxcpp_memory_get_double(b,pos);\n\t\t#else\n\t\tvar b = new haxe.io.BytesInput(this,pos,8);\n\t\treturn b.readDouble();\n\t\t#end\n\t}\n\n\tpublic function getFloat( pos : Int ) : Float {\n\t\t#if neko\n\t\treturn untyped Input._float_of_bytes(sub(pos,4).b,false);\n\t\t#elseif flash9\n\t\tb.position = pos;\n\t\treturn b.readFloat();\n\t\t#elseif cpp\n\t\tif( pos < 0 || pos + 4 > length ) throw Error.OutsideBounds;\n\t\treturn untyped __global__.__hxcpp_memory_get_float(b,pos);\n\t\t#else\n\t\tvar b = new haxe.io.BytesInput(this,pos,4);\n\t\treturn b.readFloat();\n\t\t#end\n\t}\n\n\tpublic function setDouble( pos : Int, v : Float ) : Void {\n\t\t#if neko\n\t\tuntyped $sblit(b, pos, Output._double_bytes(v,false), 0, 8);\n\t\t#elseif flash9\n\t\tb.position = pos;\n\t\tb.writeDouble(v);\n\t\t#elseif cpp\n\t\tif( pos < 0 || pos + 8 > length ) throw Error.OutsideBounds;\n\t\tuntyped __global__.__hxcpp_memory_set_double(b,pos,v);\n\t\t#else\n\t\tthrow \"Not supported\";\n\t\t#end\n\t}\n\n\tpublic function setFloat( pos : Int, v : Float ) : Void {\n\t\t#if neko\n\t\tuntyped $sblit(b, pos, Output._float_bytes(v,false), 0, 4);\n\t\t#elseif flash9\n\t\tb.position = pos;\n\t\tb.writeFloat(v);\n\t\t#elseif cpp\n\t\tif( pos < 0 || pos + 4 > length ) throw Error.OutsideBounds;\n\t\tuntyped __global__.__hxcpp_memory_set_float(b,pos,v);\n\t\t#else\n\t\tthrow \"Not supported\";\n\t\t#end\n\t}\n\n\tpublic function getString( pos : Int, len : Int ) : String {\n\t\t#if !neko\n\t\tif( pos < 0 || len < 0 || pos + len > length ) throw Error.OutsideBounds;\n\t\t#end\n\t\t#if neko\n\t\treturn try new String(untyped __dollar__ssub(b,pos,len)) catch( e : Dynamic ) throw Error.OutsideBounds;\n\t\t#elseif flash9\n\t\tb.position = pos;\n\t\treturn b.readUTFBytes(len);\n\t\t#elseif php\n\t\treturn untyped __call__(\"substr\", b, pos, len);\n\t\t#elseif cpp\n\t\tvar result:String=\"\";\n\t\tuntyped __global__.__hxcpp_string_of_bytes(b,result,pos,len);\n\t\treturn result;\n\t\t#elseif cs\n\t\treturn cs.system.text.Encoding.UTF8.GetString(b, pos, len);\n\t\t#elseif java\n\t\ttry\n\t\t\treturn new String(b, pos, len, \"UTF-8\")\n\t\tcatch (e:Dynamic) throw e;\n\t\t#else\n\t\tvar s = \"\";\n\t\tvar b = b;\n\t\tvar fcc = String.fromCharCode;\n\t\tvar i = pos;\n\t\tvar max = pos+len;\n\t\t// utf8-decode and utf16-encode\n\t\twhile( i < max ) {\n\t\t\tvar c = b[i++];\n\t\t\tif( c < 0x80 ) {\n\t\t\t\tif( c == 0 ) break;\n\t\t\t\ts += fcc(c);\n\t\t\t} else if( c < 0xE0 )\n\t\t\t\ts += fcc( ((c & 0x3F) << 6) | (b[i++] & 0x7F) );\n\t\t\telse if( c < 0xF0 ) {\n\t\t\t\tvar c2 = b[i++];\n\t\t\t\ts += fcc( ((c & 0x1F) << 12) | ((c2 & 0x7F) << 6) | (b[i++] & 0x7F) );\n\t\t\t} else {\n\t\t\t\tvar c2 = b[i++];\n\t\t\t\tvar c3 = b[i++];\n\t\t\t\tvar u = ((c & 0x0F) << 18) | ((c2 & 0x7F) << 12) | ((c3 & 0x7F) << 6) | (b[i++] & 0x7F);\n\t\t\t\t// surrogate pair\n\t\t\t\ts += fcc( (u >> 10) + 0xD7C0 );\n\t\t\t\ts += fcc( (u & 0x3FF) | 0xDC00 );\n\t\t\t}\n\t\t}\n\t\treturn s;\n\t\t#end\n\t}\n\n\t@:deprecated(\"readString is deprecated, use getString instead\")\n\t@:noCompletion\n\tpublic inline function readString(pos:Int, len:Int):String {\n\t\treturn getString(pos, len);\n\t}\n\n\tpublic function toString() : String {\n\t\t#if neko\n\t\treturn new String(untyped __dollar__ssub(b,0,length));\n\t\t#elseif flash9\n\t\tb.position = 0;\n\t\treturn b.readUTFBytes(length);\n\t\t#elseif php\n\t\treturn cast b;\n\t\t#elseif cs\n\t\treturn cs.system.text.Encoding.UTF8.GetString(b, 0, length);\n\t\t#elseif java\n\t\ttry\n\t\t{\n\t\t\treturn new String(b, 0, length, \"UTF-8\");\n\t\t}\n\t\tcatch (e:Dynamic) throw e;\n\t\t#else\n\t\treturn getString(0,length);\n\t\t#end\n\t}\n\n\tpublic function toHex() : String {\n\t\tvar s = new StringBuf();\n\t\tvar chars = [];\n\t\tvar str = \"0123456789abcdef\";\n\t\tfor( i in 0...str.length )\n\t\t\tchars.push(str.charCodeAt(i));\n\t\tfor( i in 0...length ) {\n\t\t\tvar c = get(i);\n\t\t\ts.addChar(chars[c >> 4]);\n\t\t\ts.addChar(chars[c & 15]);\n\t\t}\n\t\treturn s.toString();\n\t}\n\n\tpublic inline function getData() : BytesData {\n\t\treturn b;\n\t}\n\n\tpublic static function alloc( length : Int ) : Bytes {\n\t\t#if neko\n\t\treturn new Bytes(length,untyped __dollar__smake(length));\n\t\t#elseif flash9\n\t\tvar b = new flash.utils.ByteArray();\n\t\tb.length = length;\n\t\treturn new Bytes(length,b);\n\t\t#elseif php\n\t\treturn new Bytes(length, untyped __call__(\"str_repeat\", __call__(\"chr\", 0), length));\n\t\t#elseif cpp\n\t\tvar a = new BytesData();\n\t\tif (length>0) a[length-1] = untyped 0;\n\t\treturn new Bytes(length, a);\n\t\t#elseif cs\n\t\treturn new Bytes(length, new cs.NativeArray(length));\n\t\t#elseif java\n\t\treturn new Bytes(length, new java.NativeArray(length));\n\t\t#else\n\t\tvar a = new Array();\n\t\tfor( i in 0...length )\n\t\t\ta.push(0);\n\t\treturn new Bytes(length,a);\n\t\t#end\n\t}\n\n\tpublic static function ofString( s : String ) : Bytes {\n\t\t#if neko\n\t\treturn new Bytes(s.length,untyped __dollar__ssub(s.__s,0,s.length));\n\t\t#elseif flash9\n\t\tvar b = new flash.utils.ByteArray();\n\t\tb.writeUTFBytes(s);\n\t\treturn new Bytes(b.length,b);\n\t\t#elseif php\n\t\treturn new Bytes(untyped __call__(\"strlen\", s), cast s);\n//\t\treturn ofData(untyped __call__(\"new _hx_array\", __call__(\"array_values\", __call__(\"unpack\", \"C*\",  s))));\n\t\t#elseif cpp\n\t\tvar a = new BytesData();\n\t\tuntyped __global__.__hxcpp_bytes_of_string(a,s);\n\t\treturn new Bytes(a.length, a);\n\t\t#elseif cs\n\t\tvar b = cs.system.text.Encoding.UTF8.GetBytes(s);\n\t\treturn new Bytes(b.Length, b);\n\t\t#elseif java\n\t\ttry\n\t\t{\n\t\t\tvar b:BytesData = untyped s.getBytes(\"UTF-8\");\n\t\t\treturn new Bytes(b.length, b);\n\t\t}\n\t\tcatch (e:Dynamic) throw e;\n\t\t#else\n\t\tvar a = new Array();\n\t\t// utf16-decode and utf8-encode\n\t\tvar i = 0;\n\t\twhile( i < s.length ) {\n\t\t\tvar c : Int = StringTools.fastCodeAt(s,i++);\n\t\t\t// surrogate pair\n\t\t\tif( 0xD800 <= c && c <= 0xDBFF )\n\t\t\t       c = (c - 0xD7C0 << 10) | (StringTools.fastCodeAt(s,i++) & 0x3FF);\n\t\t\tif( c <= 0x7F )\n\t\t\t\ta.push(c);\n\t\t\telse if( c <= 0x7FF ) {\n\t\t\t\ta.push( 0xC0 | (c >> 6) );\n\t\t\t\ta.push( 0x80 | (c & 63) );\n\t\t\t} else if( c <= 0xFFFF ) {\n\t\t\t\ta.push( 0xE0 | (c >> 12) );\n\t\t\t\ta.push( 0x80 | ((c >> 6) & 63) );\n\t\t\t\ta.push( 0x80 | (c & 63) );\n\t\t\t} else {\n\t\t\t\ta.push( 0xF0 | (c >> 18) );\n\t\t\t\ta.push( 0x80 | ((c >> 12) & 63) );\n\t\t\t\ta.push( 0x80 | ((c >> 6) & 63) );\n\t\t\t\ta.push( 0x80 | (c & 63) );\n\t\t\t}\n\t\t}\n\t\treturn new Bytes(a.length,a);\n\t\t#end\n\t}\n\n\tpublic static function ofData( b : BytesData ) {\n\t\t#if flash9\n\t\treturn new Bytes(b.length,b);\n\t\t#elseif neko\n\t\treturn new Bytes(untyped __dollar__ssize(b),b);\n\t\t#elseif php\n\t\treturn new Bytes(untyped __call__(\"strlen\", b), b);\n\t\t#elseif cs\n\t\treturn new Bytes(b.Length,b);\n\t\t#else\n\t\treturn new Bytes(b.length,b);\n\t\t#end\n\t}\n\n\t/**\n\t\tRead the most efficiently possible the n-th byte of the data.\n\t\tBehavior when reading outside of the available data is unspecified.\n\t**/\n\tpublic inline static function fastGet( b : BytesData, pos : Int ) : Int {\n\t\t#if neko\n\t\treturn untyped __dollar__sget(b,pos);\n\t\t#elseif flash9\n\t\treturn b[pos];\n\t\t#elseif php\n\t\treturn untyped __call__(\"ord\", b[pos]);\n\t\t#elseif cpp\n\t\treturn untyped b.unsafeGet(pos);\n\t\t#elseif java\n\t\treturn untyped b[pos] & 0xFF;\n\t\t#else\n\t\treturn b[pos];\n\t\t#end\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.io;\n\nclass BytesBuffer {\n\n\t#if neko\n\tvar b : Dynamic; // neko string buffer\n\t#elseif flash9\n\tvar b : flash.utils.ByteArray;\n\t#elseif php\n\tvar b : String;\n\t#elseif cpp\n\tvar b : BytesData;\n\t#elseif cs\n\tvar b : cs.system.io.MemoryStream;\n\t#elseif java\n\tvar b : java.io.ByteArrayOutputStream;\n\t#else\n\tvar b : Array<Int>;\n\t#end\n\n\t/** The length of the buffer in bytes. **/\n\tpublic var length(get,never) : Int;\n\n\tpublic function new() {\n\t\t#if neko\n\t\tb = untyped StringBuf.__make();\n\t\t#elseif flash9\n\t\tb = new flash.utils.ByteArray();\n\t\tb.endian = flash.utils.Endian.LITTLE_ENDIAN;\n\t\t#elseif php\n\t\tb = \"\";\n\t\t#elseif cpp\n\t\tb = new BytesData();\n\t\t#elseif cs\n\t\tb = new cs.system.io.MemoryStream();\n\t\t#elseif java\n\t\tb = new java.io.ByteArrayOutputStream();\n\t\t#else\n\t\tb = new Array();\n\t\t#end\n\t}\n\n\tinline function get_length() : Int {\n\t\t#if neko\n\t\treturn untyped __dollar__ssize( StringBuf.__to_string(b) );\n\t\t#elseif cs\n\t\treturn haxe.Int64.toInt( b.Length );\n\t\t#elseif java\n\t\treturn b.size();\n\t\t#else\n\t\treturn b.length;\n\t\t#end\n\t}\n\n\tpublic inline function addByte( byte : Int ) {\n\t\t#if neko\n\t\tuntyped StringBuf.__add_char(b,byte);\n\t\t#elseif flash9\n\t\tb.writeByte(byte);\n\t\t#elseif php\n\t\tb += untyped __call__(\"chr\", byte);\n\t\t#elseif cpp\n\t\tb.push(untyped byte);\n\t\t#elseif cs\n\t\tb.WriteByte(cast byte);\n\t\t#elseif java\n\t\tb.write(byte);\n\t\t#else\n\t\tb.push(byte);\n\t\t#end\n\t}\n\n\tpublic inline function add( src : Bytes ) {\n\t\t#if neko\n\t\tuntyped StringBuf.__add(b,src.getData());\n\t\t#elseif flash9\n\t\tb.writeBytes(src.getData());\n\t\t#elseif php\n\t\tb += cast src.getData();\n\t\t#elseif cs\n\t\tb.Write(src.getData(), 0, src.length);\n\t\t#elseif java\n\t\tb.write(src.getData(), 0, src.length);\n\t\t#else\n\t\tvar b1 = b;\n\t\tvar b2 = src.getData();\n\t\tfor( i in 0...src.length )\n\t\t\tb.push(b2[i]);\n\t\t#end\n\t}\n\n\tpublic inline function addString( v : String ) {\n\t\t#if neko\n\t\tuntyped StringBuf.__add(b, v.__s);\n\t\t#elseif flash9\n\t\tb.writeUTFBytes(v);\n\t\t#else\n\t\tadd(Bytes.ofString(v));\n\t\t#end\n\t}\n\n\tpublic inline function addFloat( v : Float ) {\n\t\t#if neko\n\t\tuntyped StringBuf.__add(b, Output._float_bytes(v, false));\n\t\t#elseif flash9\n\t\tb.writeFloat(v);\n\t\t#else\n\t\tvar b = new BytesOutput();\n\t\tb.writeFloat(v);\n\t\tadd(b.getBytes());\n\t\t#end\n\t}\n\t\n\tpublic inline function addDouble( v : Float ) {\n\t\t#if neko\n\t\tuntyped StringBuf.__add(b, Output._double_bytes(v, false));\n\t\t#elseif flash9\n\t\tb.writeDouble(v);\n\t\t#else\n\t\tvar b = new BytesOutput();\n\t\tb.writeDouble(v);\n\t\tadd(b.getBytes());\n\t\t#end\n\t}\n\t\n\tpublic inline function addBytes( src : Bytes, pos : Int, len : Int ) {\n\t\t#if !neko\n\t\tif( pos < 0 || len < 0 || pos + len > src.length ) throw Error.OutsideBounds;\n\t\t#end\n\t\t#if neko\n\t\ttry untyped StringBuf.__add_sub(b,src.getData(),pos,len) catch( e : Dynamic ) throw Error.OutsideBounds;\n\t\t#elseif flash9\n\t\tif( len > 0 ) b.writeBytes(src.getData(),pos,len);\n\t\t#elseif php\n\t\tb += untyped __call__(\"substr\", src.b, pos, len);\n\t\t#elseif cs\n\t\tb.Write(src.getData(), pos, len);\n\t\t#elseif java\n\t\tb.write(src.getData(), pos, len);\n\t\t#else\n\t\tvar b1 = b;\n\t\tvar b2 = src.getData();\n\t\tfor( i in pos...pos+len )\n\t\t\tb.push(b2[i]);\n\t\t#end\n\t}\n\n\t/**\n\t\tReturns either a copy or a reference of the current bytes.\n\t\tOnce called, the buffer can no longer be used.\n\t**/\n\tpublic function getBytes() : Bytes untyped {\n\t\t#if neko\n\t\tvar str = StringBuf.__to_string(b);\n\t\tvar bytes = new Bytes(__dollar__ssize(str),str);\n\t\t#elseif flash9\n\t\tvar bytes = new Bytes(b.length,b);\n\t\tb.position = 0;\n\t\t#elseif php\n\t\tvar bytes = new Bytes(b.length, cast b);\n\t\t#elseif cs\n\t\tvar buf = b.GetBuffer();\n\t\tvar bytes = new Bytes(cast b.Length, buf);\n\t\t#elseif java\n\t\tvar buf = b.toByteArray();\n\t\tvar bytes = new Bytes(buf.length, buf);\n\t\t#else\n\t\tvar bytes = new Bytes(b.length,b);\n\t\t#end\n\t\tb = null;\n\t\treturn bytes;\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.io;\n\n/**\n\tAn Input is an abstract reader. See other classes in the [haxe.io] package\n\tfor several possible implementations.\n**/\nclass Input {\n\n\tpublic var bigEndian(default,set) : Bool;\n\t#if cs\n\tprivate var helper:BytesData;\n\t#elseif java\n\tprivate var helper:java.nio.ByteBuffer;\n\t#end\n\n\tpublic function readByte() : Int {\n\t#if cpp\n\t\tthrow \"Not implemented\";\n\t\treturn 0;\n\t#else\n\t\treturn throw \"Not implemented\";\n\t#end\n\t}\n\n\tpublic function readBytes( s : Bytes, pos : Int, len : Int ) : Int {\n\t\tvar k = len;\n\t\tvar b = s.getData();\n\t\tif( pos < 0 || len < 0 || pos + len > s.length )\n\t\t\tthrow Error.OutsideBounds;\n\t\twhile( k > 0 ) {\n\t\t\t#if neko\n\t\t\t\tuntyped __dollar__sset(b,pos,readByte());\n\t\t\t#elseif php\n\t\t\t\tb[pos] = untyped __call__(\"chr\", readByte());\n\t\t\t#elseif cpp\n\t\t\t\tb[pos] = untyped readByte();\n\t\t\t#else\n\t\t\t\tb[pos] = cast readByte();\n\t\t\t#end\n\t\t\tpos++;\n\t\t\tk--;\n\t\t}\n\t\treturn len;\n\t}\n\n\tpublic function close() {\n\t}\n\n\tfunction set_bigEndian(b) {\n\t\tbigEndian = b;\n\t\treturn b;\n\t}\n\n\t/* ------------------ API ------------------ */\n\n\tpublic function readAll( ?bufsize : Int ) : Bytes {\n\t\tif( bufsize == null )\n\t\t#if php\n\t\t\tbufsize = 8192; // default value for PHP and max under certain circumstances\n\t\t#else\n\t\t\tbufsize = (1 << 14); // 16 Ko\n\t\t#end\n\n\t\tvar buf = Bytes.alloc(bufsize);\n\t\tvar total = new haxe.io.BytesBuffer();\n\t\ttry {\n\t\t\twhile( true ) {\n\t\t\t\tvar len = readBytes(buf,0,bufsize);\n\t\t\t\tif( len == 0 )\n\t\t\t\t\tthrow Error.Blocked;\n\t\t\t\ttotal.addBytes(buf,0,len);\n\t\t\t}\n\t\t} catch( e : Eof ) {\n\t\t}\n\t\treturn total.getBytes();\n\t}\n\n\tpublic function readFullBytes( s : Bytes, pos : Int, len : Int ) {\n\t\twhile( len > 0 ) {\n\t\t\tvar k = readBytes(s,pos,len);\n\t\t\tpos += k;\n\t\t\tlen -= k;\n\t\t}\n\t}\n\n\tpublic function read( nbytes : Int ) : Bytes {\n\t\tvar s = Bytes.alloc(nbytes);\n\t\tvar p = 0;\n\t\twhile( nbytes > 0 ) {\n\t\t\tvar k = readBytes(s,p,nbytes);\n\t\t\tif( k == 0 ) throw Error.Blocked;\n\t\t\tp += k;\n\t\t\tnbytes -= k;\n\t\t}\n\t\treturn s;\n\t}\n\n\tpublic function readUntil( end : Int ) : String {\n\t\tvar buf = new StringBuf();\n\t\tvar last : Int;\n\t\twhile( (last = readByte()) != end )\n\t\t\tbuf.addChar( last );\n\t\treturn buf.toString();\n\t}\n\n\tpublic function readLine() : String {\n\t\tvar buf = new StringBuf();\n\t\tvar last : Int;\n\t\tvar s;\n\t\ttry {\n\t\t\twhile( (last = readByte()) != 10 )\n\t\t\t\tbuf.addChar( last );\n\t\t\ts = buf.toString();\n\t\t\tif( s.charCodeAt(s.length-1) == 13 ) s = s.substr(0,-1);\n\t\t} catch( e : Eof ) {\n\t\t\ts = buf.toString();\n\t\t\tif( s.length == 0 )\n\t\t\t\t#if neko neko.Lib.rethrow #else throw #end (e);\n\t\t}\n\t\treturn s;\n\t}\n\n\tpublic function readFloat() : Float {\n\t\t#if neko\n\t\t\treturn _float_of_bytes(untyped read(4).b,bigEndian);\n\t\t#elseif cpp\n\t\t\treturn _float_of_bytes(read(4).getData(),bigEndian);\n\t\t#elseif php\n\t\t\tvar a = untyped __call__('unpack', 'f', readString(4));\n\t\t\treturn a[1];\n\t\t#elseif cs\n\t\t\tif (helper == null) helper = new cs.NativeArray(8);\n\n\t\t\tvar helper = helper;\n\t\t\tif (bigEndian == !cs.system.BitConverter.IsLittleEndian)\n\t\t\t{\n\t\t\t\thelper[0] = readByte();\n\t\t\t\thelper[1] = readByte();\n\t\t\t\thelper[2] = readByte();\n\t\t\t\thelper[3] = readByte();\n\t\t\t} else {\n\t\t\t\thelper[3] = readByte();\n\t\t\t\thelper[2] = readByte();\n\t\t\t\thelper[1] = readByte();\n\t\t\t\thelper[0] = readByte();\n\t\t\t}\n\n\t\t\treturn cs.system.BitConverter.ToSingle(helper, 0);\n\t\t#elseif java\n\t\t\tif (helper == null) helper = java.nio.ByteBuffer.allocateDirect(8);\n\t\t\tvar helper = helper;\n\t\t\thelper.order(bigEndian ? java.nio.ByteOrder.BIG_ENDIAN : java.nio.ByteOrder.LITTLE_ENDIAN);\n\n\t\t\thelper.put(0, cast readByte());\n\t\t\thelper.put(1, cast readByte());\n\t\t\thelper.put(2, cast readByte());\n\t\t\thelper.put(3, cast readByte());\n\n\t\t\treturn helper.getFloat(0);\n\t\t#else\n\t\t\tvar bytes = [];\n\t\t\tbytes.push(cast readByte());\n\t\t\tbytes.push(cast readByte());\n\t\t\tbytes.push(cast readByte());\n\t\t\tbytes.push(cast readByte());\n\t\t\tif (!bigEndian)\n\t\t\t\tbytes.reverse();\n\t\t\tvar sign = 1 - ((bytes[0] >> 7) << 1);\n\t\t\tvar exp = (((bytes[0] << 1) & 0xFF) | (bytes[1] >> 7)) - 127;\n\t\t\tvar sig = ((bytes[1] & 0x7F) << 16) | (bytes[2] << 8) | bytes[3];\n\t\t\tif (sig == 0 && exp == -127)\n\t\t\t\treturn 0.0;\n\t\t\treturn sign*(1 + Math.pow(2, -23)*sig) * Math.pow(2, exp);\n\t\t#end\n\t}\n\n\tpublic function readDouble() : Float {\n\t\t#if neko\n\t\t\treturn _double_of_bytes(untyped read(8).b,bigEndian);\n\t\t#elseif cpp\n\t\t\treturn _double_of_bytes(read(8).getData(),bigEndian);\n\t\t#elseif php\n\t\t\tvar a = untyped __call__('unpack', 'd', readString(8));\n\t\t\treturn a[1];\n\t\t#elseif (flash || js)\n\t\tvar bytes = [];\n\t\tbytes.push(readByte());\n\t\tbytes.push(readByte());\n\t\tbytes.push(readByte());\n\t\tbytes.push(readByte());\n\t\tbytes.push(readByte());\n\t\tbytes.push(readByte());\n\t\tbytes.push(readByte());\n\t\tbytes.push(readByte());\n\t\tif (!bigEndian)\n\t\t\tbytes.reverse();\n\n\t\tvar sign = 1 - ((bytes[0] >> 7) << 1); // sign = bit 0\n\t\tvar exp = (((bytes[0] << 4) & 0x7FF) | (bytes[1] >> 4)) - 1023; // exponent = bits 1..11\n\t\tvar sig = getDoubleSig(bytes);\n\t\tif (sig == 0 && exp == -1023)\n\t\t\treturn 0.0;\n\t\treturn sign * (1.0 + Math.pow(2, -52) * sig) * Math.pow(2, exp);\n\t\t#elseif cs\n\t\tif (helper == null) helper = new cs.NativeArray(8);\n\n\t\tvar helper = helper;\n\t\tif (bigEndian == !cs.system.BitConverter.IsLittleEndian)\n\t\t{\n\t\t\thelper[0] = readByte();\n\t\t\thelper[1] = readByte();\n\t\t\thelper[2] = readByte();\n\t\t\thelper[3] = readByte();\n\t\t\thelper[4] = readByte();\n\t\t\thelper[5] = readByte();\n\t\t\thelper[6] = readByte();\n\t\t\thelper[7] = readByte();\n\t\t} else {\n\t\t\thelper[7] = readByte();\n\t\t\thelper[6] = readByte();\n\t\t\thelper[5] = readByte();\n\t\t\thelper[4] = readByte();\n\t\t\thelper[3] = readByte();\n\t\t\thelper[2] = readByte();\n\t\t\thelper[1] = readByte();\n\t\t\thelper[0] = readByte();\n\t\t}\n\n\t\treturn cs.system.BitConverter.ToDouble(helper, 0);\n\t\t#elseif java\n\t\tif (helper == null) helper = java.nio.ByteBuffer.allocateDirect(8);\n\t\tvar helper = helper;\n\t\thelper.order(bigEndian ? java.nio.ByteOrder.BIG_ENDIAN : java.nio.ByteOrder.LITTLE_ENDIAN);\n\n\t\thelper.put(0, cast readByte());\n\t\thelper.put(1, cast readByte());\n\t\thelper.put(2, cast readByte());\n\t\thelper.put(3, cast readByte());\n\t\thelper.put(4, cast readByte());\n\t\thelper.put(5, cast readByte());\n\t\thelper.put(6, cast readByte());\n\t\thelper.put(7, cast readByte());\n\n\t\treturn helper.getDouble(0);\n\t\t#else\n\t\treturn throw \"not implemented\";\n\t\t#end\n\t}\n\n\tpublic function readInt8() {\n\t\tvar n = readByte();\n\t\tif( n >= 128 )\n\t\t\treturn n - 256;\n\t\treturn n;\n\t}\n\n\tpublic function readInt16() {\n\t\tvar ch1 = readByte();\n\t\tvar ch2 = readByte();\n\t\tvar n = bigEndian ? ch2 | (ch1 << 8) : ch1 | (ch2 << 8);\n\t\tif( n & 0x8000 != 0 )\n\t\t\treturn n - 0x10000;\n\t\treturn n;\n\t}\n\n\tpublic function readUInt16() {\n\t\tvar ch1 = readByte();\n\t\tvar ch2 = readByte();\n\t\treturn bigEndian ? ch2 | (ch1 << 8) : ch1 | (ch2 << 8);\n\t}\n\n\tpublic function readInt24() {\n\t\tvar ch1 = readByte();\n\t\tvar ch2 = readByte();\n\t\tvar ch3 = readByte();\n\t\tvar n = bigEndian ? ch3 | (ch2 << 8) | (ch1 << 16) : ch1 | (ch2 << 8) | (ch3 << 16);\n\t\tif( n & 0x800000 != 0 )\n\t\t\treturn n - 0x1000000;\n\t\treturn n;\n\t}\n\n\tpublic function readUInt24() {\n\t\tvar ch1 = readByte();\n\t\tvar ch2 = readByte();\n\t\tvar ch3 = readByte();\n\t\treturn bigEndian ? ch3 | (ch2 << 8) | (ch1 << 16) : ch1 | (ch2 << 8) | (ch3 << 16);\n\t}\n\n\tpublic function readInt32() {\n\t\tvar ch1 = readByte();\n\t\tvar ch2 = readByte();\n\t\tvar ch3 = readByte();\n\t\tvar ch4 = readByte();\n#if php\n        // php will overflow integers.  Convert them back to signed 32-bit ints.\n        var n = bigEndian ? ch4 | (ch3 << 8) | (ch2 << 16) | (ch1 << 24) : ch1 | (ch2 << 8) | (ch3 << 16) | (ch4 << 24);\n        if (n & 0x80000000 != 0)\n            return ( n | 0x80000000);\n        else return n;\n#else\n\t\treturn bigEndian ? ch4 | (ch3 << 8) | (ch2 << 16) | (ch1 << 24) : ch1 | (ch2 << 8) | (ch3 << 16) | (ch4 << 24);\n#end\n\t}\n\n\tpublic function readString( len : Int ) : String {\n\t\tvar b = Bytes.alloc(len);\n\t\treadFullBytes(b,0,len);\n\t\t#if neko\n\t\treturn neko.Lib.stringReference(b);\n\t\t#else\n\t\treturn b.toString();\n\t\t#end\n\t}\n\n#if neko\n\tstatic var _float_of_bytes = neko.Lib.load(\"std\",\"float_of_bytes\",2);\n\tstatic var _double_of_bytes = neko.Lib.load(\"std\",\"double_of_bytes\",2);\n\tstatic function __init__() untyped {\n\t\tInput.prototype.bigEndian = false;\n\t}\n#elseif cpp\n\tstatic var _float_of_bytes = cpp.Lib.load(\"std\",\"float_of_bytes\",2);\n\tstatic var _double_of_bytes = cpp.Lib.load(\"std\",\"double_of_bytes\",2);\n#end\n\n#if (flash || js)\n\tfunction getDoubleSig(bytes:Array<Int>)\n    {\n        return (((bytes[1]&0xF) << 16) | (bytes[2] << 8) | bytes[3] ) * 4294967296. +\n            (bytes[4] >> 7) * 2147483648 +\n            (((bytes[4]&0x7F) << 24) | (bytes[5] << 16) | (bytes[6] << 8) | bytes[7]);\n    }\n#end\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.io;\n\nclass BytesInput extends Input {\n\tvar b : BytesData;\n\t#if !flash9\n\tvar pos : Int;\n\tvar len : Int;\n\tvar totlen : Int;\n\t#end\n\n\t/** The current position in the stream in bytes. */\n\tpublic var position(get,set) : Int;\n\n\t/** The length of the stream in bytes. */\n\tpublic var length(get,never) : Int;\n\n\tpublic function new( b : Bytes, ?pos : Int, ?len : Int ) {\n\t\tif( pos == null ) pos = 0;\n\t\tif( len == null ) len = b.length - pos;\n\t\tif( pos < 0 || len < 0 || pos + len > b.length ) throw Error.OutsideBounds;\n\t\t#if flash9\n\t\tvar ba = b.getData();\n\t\tba.position = pos;\n\t\tif( len != ba.bytesAvailable ) {\n\t\t\t// truncate\n\t\t\tthis.b = new flash.utils.ByteArray();\n\t\t\tba.readBytes(this.b,0,len);\n\t\t} else\n\t\t\tthis.b = ba;\n\t\tthis.b.endian = flash.utils.Endian.LITTLE_ENDIAN;\n\t\t#else\n\t\tthis.b = b.getData();\n\t\tthis.pos = pos;\n\t\tthis.len = len;\n\t\tthis.totlen = len;\n\t\t#end\n\t}\n\n\tinline function get_position() : Int {\n\t\t#if flash9\n\t\treturn b.position;\n\t\t#else\n\t\treturn pos;\n\t\t#end\n\t}\n\n\tinline function get_length() : Int {\n\t\t#if flash9\n\t\treturn b.length;\n\t\t#else\n\t\treturn totlen;\n\t\t#end\n\t}\n\n\tfunction set_position( p : Int ) : Int {\n\t\tif( p < 0 ) p = 0;\n\t\telse if( p > length ) p = length;\n\t\t#if flash9\n\t\treturn b.position = p;\n\t\t#else\n\t\tlen = totlen - p;\n\t\treturn pos = p;\n\t\t#end\n\t}\n\n\tpublic override function readByte() : Int {\n\t\t#if flash9\n\t\t\treturn try b.readUnsignedByte() catch( e : Dynamic ) throw new Eof();\n\t\t#else\n\t\t\tif( this.len == 0 )\n\t\t\t\tthrow new Eof();\n\t\t\tlen--;\n\t\t\t#if neko\n\t\t\treturn untyped __dollar__sget(b,pos++);\n\t\t\t#elseif php\n\t\t\treturn untyped __call__(\"ord\", b[pos++]);\n\t\t\t#elseif cpp\n\t\t\treturn untyped b[pos++];\n\t\t\t#elseif java\n\t\t\treturn untyped b[pos++] & 0xFF;\n\t\t\t#else\n\t\t\treturn b[pos++];\n\t\t\t#end\n\t\t#end\n\t}\n\n\tpublic override function readBytes( buf : Bytes, pos, len ) : Int {\n\t\t#if !neko\n\t\t\tif( pos < 0 || len < 0 || pos + len > buf.length )\n\t\t\t\tthrow Error.OutsideBounds;\n\t\t#end\n\t\t#if flash9\n\t\t\tvar avail : Int = b.bytesAvailable;\n\t\t\tif( len > avail && avail > 0 ) len = avail;\n\t\t\ttry b.readBytes(buf.getData(),pos,len) catch( e : Dynamic ) throw new Eof();\n\t\t#elseif java\n\t\t\tvar avail : Int = this.len;\n\t\t\tif ( len > avail ) len = avail;\n\t\t\tif (len == 0)\n\t\t\t\tthrow new Eof();\n\t\t\tjava.lang.System.arraycopy(this.b, this.pos, buf.getData(), pos, len);\n\t\t\tthis.pos += len;\n\t\t\tthis.len -= len;\n\t\t#elseif cs\n\t\t\tvar avail : Int = this.len;\n\t\t\tif ( len > avail ) len = avail;\n\t\t\tif (len == 0)\n\t\t\t\tthrow new Eof();\n\t\t\tcs.system.Array.Copy(this.b,this.pos, buf.getData(), pos, len);\n\t\t\tthis.pos += len;\n\t\t\tthis.len -= len;\n\t\t#else\n\t\t\tif( this.len == 0 && len > 0 )\n\t\t\t\tthrow new Eof();\n\t\t\tif( this.len < len )\n\t\t\t\tlen = this.len;\n\t\t\t#if neko\n\t\t\ttry untyped __dollar__sblit(buf.getData(),pos,b,this.pos,len) catch( e : Dynamic ) throw Error.OutsideBounds;\n\t\t\t#elseif php\n\t\t\tuntyped __php__(\"$buf->b = substr($buf->b, 0, $pos) . substr($this->b, $this->pos, $len) . substr($buf->b, $pos+$len)\");\n\t\t\t#else\n\t\t\tvar b1 = b;\n\t\t\tvar b2 = buf.getData();\n\t\t\tfor( i in 0...len )\n\t\t\t\tb2[pos+i] = b1[this.pos+i];\n\t\t\t#end\n\t\t\tthis.pos += len;\n\t\t\tthis.len -= len;\n\t\t#end\n\t\treturn len;\n\t}\n\n\t#if flash9\n\toverride function set_bigEndian(e) {\n\t\tbigEndian = e;\n\t\tb.endian = e ? flash.utils.Endian.BIG_ENDIAN : flash.utils.Endian.LITTLE_ENDIAN;\n\t\treturn e;\n\t}\n\n\toverride function readFloat() {\n\t\treturn try b.readFloat() catch( e : Dynamic ) throw new Eof();\n\t}\n\n\toverride function readDouble() {\n\t\treturn try b.readDouble() catch( e : Dynamic ) throw new Eof();\n\t}\n\n\toverride function readInt8() {\n\t\treturn try b.readByte() catch( e : Dynamic ) throw new Eof();\n\t}\n\n\toverride function readInt16() {\n\t\treturn try b.readShort() catch( e : Dynamic ) throw new Eof();\n\t}\n\n\toverride function readUInt16() : Int {\n\t\treturn try b.readUnsignedShort() catch( e : Dynamic ) throw new Eof();\n\t}\n\n\toverride function readInt32() : Int {\n\t\treturn try b.readInt() catch( e : Dynamic ) throw new Eof();\n\t}\n\n\toverride function readString( len : Int ) {\n\t\treturn try b.readUTFBytes(len) catch( e : Dynamic ) throw new Eof();\n\t}\n\n\t#end\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.io;\n\nclass BytesOutput extends Output {\n\n\t#if flash9\n\tvar b : flash.utils.ByteArray;\n\t#else\n\tvar b : BytesBuffer;\n\t#end\n\n\t/** The length of the stream in bytes. **/\n\tpublic var length(get,never) : Int;\n\n\tpublic function new() {\n\t\t#if flash9\n\t\tb = new flash.utils.ByteArray();\n\t\tb.endian = flash.utils.Endian.LITTLE_ENDIAN;\n\t\t#else\n\t\tb = new BytesBuffer();\n\t\t#end\n\t}\n\n\tinline function get_length() : Int {\n\t\treturn b.length;\n\t}\n\n\toverride function writeByte(c) {\n\t\t#if flash9\n\t\tb.writeByte(c);\n\t\t#else\n\t\tb.addByte(c);\n\t\t#end\n\t}\n\n\toverride function writeBytes( buf : Bytes, pos, len ) : Int {\n\t\t#if flash9\n\t\tif( pos < 0 || len < 0 || pos + len > buf.length ) throw Error.OutsideBounds;\n\t\tb.writeBytes(buf.getData(),pos,len);\n\t\t#else\n\t\tb.addBytes(buf,pos,len);\n\t\t#end\n\t\treturn len;\n\t}\n\n\t#if flash9\n\t// optimized operations\n\n\toverride function set_bigEndian(e) {\n\t\tbigEndian = e;\n\t\tb.endian = e ? flash.utils.Endian.BIG_ENDIAN : flash.utils.Endian.LITTLE_ENDIAN;\n\t\treturn e;\n\t}\n\n\toverride function writeFloat( f : Float ) {\n\t\tb.writeFloat(f);\n\t}\n\n\toverride function writeDouble( f : Float ) {\n\t\tb.writeDouble(f);\n\t}\n\n\toverride function writeInt8( x : Int ) {\n\t\tif( x < -0x80 || x >= 0x80 )\n\t\t\tthrow Error.Overflow;\n\t\tb.writeByte(x);\n\t}\n\n\toverride function writeInt16( x : Int ) {\n\t\tif( x < -0x8000 || x >= 0x8000 ) throw Error.Overflow;\n\t\tb.writeShort(x);\n\t}\n\n\toverride function writeUInt16( x : Int ) {\n\t\tif( x < 0 || x >= 0x10000 ) throw Error.Overflow;\n\t\tb.writeShort(x);\n\t}\n\n\toverride function writeInt32( x : Int ) {\n\t\tb.writeInt(x);\n\t}\n\n\toverride function prepare( size : Int ) {\n\t\tif( size > 0 ) b[size-1] = b[size-1];\n\t}\n\n\toverride function writeString( s : String ) {\n\t\tb.writeUTFBytes(s);\n\t}\n\n\t#end\n\n\tpublic function getBytes() : Bytes {\n\t\t#if flash9\n\t\tvar bytes = b;\n\t\tb = null;\n\t\treturn untyped new Bytes(bytes.length,bytes);\n\t\t#else\n\t\treturn b.getBytes();\n\t\t#end\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.io;\n\n/**\n\tThis exception is raised when reading while data is no longer available in the [Input].\n**/\nclass Eof {\n\tpublic function new() {\n\t}\n\t@:keep function toString() {\n\t\treturn \"Eof\";\n\t}\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.io;\n\nclass StringInput extends BytesInput {\n\n\tpublic function new( s : String ) {\n\t\t#if neko\n\t\t// don't copy the string\n\t\tsuper( neko.Lib.bytesReference(s) );\n\t\t#else\n\t\tsuper( haxe.io.Bytes.ofString(s) );\n\t\t#end\n\t}\n\n}","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.xml;\n\nenum Filter {\n\tFInt;\n\tFBool;\n\tFEnum( values : Array<String> );\n\tFReg( matcher : EReg );\n}\n\nenum Attrib {\n\tAtt( name : String, ?filter : Filter, ?defvalue : String );\n}\n\nenum Rule {\n\tRNode( name : String, ?attribs : Array<Attrib>, ?childs : Rule );\n\tRData( ?filter : Filter );\n\tRMulti( rule : Rule, ?atLeastOne : Bool );\n\tRList( rules : Array<Rule>, ?ordered : Bool );\n\tRChoice( choices : Array<Rule> );\n\tROptional( rule : Rule );\n}\n\nprivate enum CheckResult {\n\tCMatch;\n\tCMissing( r : Rule );\n\tCExtra( x : Xml );\n\tCElementExpected( name : String, x : Xml );\n\tCDataExpected( x : Xml );\n\tCExtraAttrib( att : String, x : Xml );\n\tCMissingAttrib( att : String, x : Xml );\n\tCInvalidAttrib( att : String, x : Xml, f : Filter );\n\tCInvalidData( x : Xml, f : Filter );\n\tCInElement( x : Xml, r : CheckResult );\n}\n\nclass Check {\n\n\tstatic var blanks = ~/^[ \\r\\n\\t]*$/;\n\n\tstatic function isBlank( x : Xml ) {\n\t\treturn( x.nodeType == Xml.PCData && blanks.match(x.nodeValue) ) || x.nodeType == Xml.Comment;\n\t}\n\n\tstatic function filterMatch( s : String, f : Filter ) {\n\t\tswitch( f ) {\n\t\tcase FInt: return filterMatch(s,FReg(~/[0-9]+/));\n\t\tcase FBool: return filterMatch(s,FEnum([\"true\",\"false\",\"0\",\"1\"]));\n\t\tcase FEnum(values):\n\t\t\tfor( v in values )\n\t\t\t\tif( s == v )\n\t\t\t\t\treturn true;\n\t\t\treturn false;\n\t\tcase FReg(r):\n\t\t\treturn r.match(s);\n\t\t}\n\t}\n\n\tstatic function isNullable( r : Rule ) {\n\t\tswitch( r ) {\n\t\tcase RMulti(r,one):\n\t\t\treturn( one != true || isNullable(r) );\n\t\tcase RList(rl,_):\n\t\t\tfor( r in rl )\n\t\t\t\tif( !isNullable(r) )\n\t\t\t\t\treturn false;\n\t\t\treturn true;\n\t\tcase RChoice(rl):\n\t\t\tfor( r in rl )\n\t\t\t\tif( isNullable(r) )\n\t\t\t\t\treturn true;\n\t\t\treturn false;\n\t\tcase RData(_):\n\t\t\treturn false;\n\t\tcase RNode(_,_,_):\n\t\t\treturn false;\n\t\tcase ROptional(_):\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tstatic function check( x : Xml, r : Rule ) {\n\t\tswitch( r ) {\n\t\t// check the node validity\n\t\tcase RNode(name,attribs,childs):\n\t\t\tif( x.nodeType != Xml.Element || x.nodeName != name )\n\t\t\t\treturn CElementExpected(name,x);\n\t\t\tvar attribs = if( attribs == null ) new Array() else attribs.copy();\n\t\t\t// check defined attributes\n\t\t\tfor( xatt in x.attributes() ) {\n\t\t\t\tvar found = false;\n\t\t\t\tfor( att in attribs )\n\t\t\t\t\tswitch( att ) {\n\t\t\t\t\tcase Att(name,filter,_):\n\t\t\t\t\t\tif( xatt != name )\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\tif( filter != null && !filterMatch(x.get(xatt),filter) )\n\t\t\t\t\t\t\treturn CInvalidAttrib(name,x,filter);\n\t\t\t\t\t\tattribs.remove(att);\n\t\t\t\t\t\tfound = true;\n\t\t\t\t\t}\n\t\t\t\tif( !found )\n\t\t\t\t\treturn CExtraAttrib(xatt,x);\n\t\t\t}\n\t\t\t// check remaining unchecked attributes\n\t\t\tfor( att in attribs )\n\t\t\t\tswitch( att ) {\n\t\t\t\tcase Att(name,_,defvalue):\n\t\t\t\t\tif( defvalue == null )\n\t\t\t\t\t\treturn CMissingAttrib(name,x);\n\t\t\t\t}\n\t\t\t// check childs\n\t\t\tif( childs == null )\n\t\t\t\tchilds = RList([]);\n\t\t\tvar m = checkList(x.iterator(),childs);\n\t\t\tif( m != CMatch )\n\t\t\t\treturn CInElement(x,m);\n\t\t\t// set default attribs values\n\t\t\tfor( att in attribs )\n\t\t\t\tswitch( att ) {\n\t\t\t\tcase Att(name,_,defvalue):\n\t\t\t\t\tx.set(name,defvalue);\n\t\t\t\t}\n\t\t\treturn CMatch;\n\t\t// check the data validity\n\t\tcase RData(filter):\n\t\t\tif( x.nodeType != Xml.PCData && x.nodeType != Xml.CData )\n\t\t\t\treturn CDataExpected(x);\n\t\t\tif( filter != null && !filterMatch(x.nodeValue,filter) )\n\t\t\t\treturn CInvalidData(x,filter);\n\t\t\treturn CMatch;\n\t\t// several choices\n\t\tcase RChoice(choices):\n\t\t\tif( choices.length == 0 )\n\t\t\t\tthrow \"No choice possible\";\n\t\t\tfor( c in choices )\n\t\t\t\tif( check(x,c) == CMatch )\n\t\t\t\t\treturn CMatch;\n\t\t\treturn check(x,choices[0]);\n\t\tcase ROptional(r):\n\t\t\treturn check(x,r);\n\t\tdefault:\n\t\t\tthrow \"Unexpected \"+Std.string(r);\n\t\t}\n\t}\n\n\tstatic function checkList( it : Iterator<Xml>, r : Rule ) {\n\t\tswitch( r ) {\n\t\tcase RList(rules,ordered):\n\t\t\tvar rules = rules.copy();\n\t\t\tfor( x in it ) {\n\t\t\t\tif( isBlank(x) )\n\t\t\t\t\tcontinue;\n\t\t\t\tvar found = false;\n\t\t\t\tfor( r in rules ) {\n\t\t\t\t\tvar m = checkList([x].iterator(),r);\n\t\t\t\t\tif( m == CMatch ) {\n\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\tswitch(r) {\n\t\t\t\t\t\tcase RMulti(rsub,one):\n\t\t\t\t\t\t\tif( one ) {\n\t\t\t\t\t\t\t\tvar i;\n\t\t\t\t\t\t\t\tfor( i in 0...rules.length )\n\t\t\t\t\t\t\t\t\tif( rules[i] == r )\n\t\t\t\t\t\t\t\t\t\trules[i] = RMulti(rsub);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\trules.remove(r);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if( ordered && !isNullable(r) )\n\t\t\t\t\t\treturn m;\n\t\t\t\t}\n\t\t\t\tif( !found )\n\t\t\t\t\treturn CExtra(x);\n\t\t\t}\n\t\t\tfor( r in rules )\n\t\t\t\tif( !isNullable(r) )\n\t\t\t\t\treturn CMissing(r);\n\t\t\treturn CMatch;\n\t\tcase RMulti(r,one):\n\t\t\tvar found = false;\n\t\t\tfor( x in it ) {\n\t\t\t\tif( isBlank(x) )\n\t\t\t\t\tcontinue;\n\t\t\t\tvar m = checkList([x].iterator(),r);\n\t\t\t\tif( m != CMatch )\n\t\t\t\t\treturn m;\n\t\t\t\tfound = true;\n\t\t\t}\n\t\t\tif( one && !found )\n\t\t\t\treturn CMissing(r);\n\t\t\treturn CMatch;\n\t\tdefault:\n\t\t\tvar found = false;\n\t\t\tfor( x in it ) {\n\t\t\t\tif( isBlank(x) )\n\t\t\t\t\tcontinue;\n\t\t\t\tvar m = check(x,r);\n\t\t\t\tif( m != CMatch )\n\t\t\t\t\treturn m;\n\t\t\t\tfound = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif( !found ) {\n\t\t\t\tswitch(r) {\n\t\t\t\tcase ROptional(_):\n\t\t\t\tdefault: return CMissing(r);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor( x in it ) {\n\t\t\t\tif( isBlank(x) )\n\t\t\t\t\tcontinue;\n\t\t\t\treturn CExtra(x);\n\t\t\t}\n\t\t\treturn CMatch;\n\t\t}\n\t}\n\n\tstatic function makeWhere( path : Array<Xml> ) {\n\t\tif( path.length == 0 )\n\t\t\treturn \"\";\n\t\tvar s = \"In \";\n\t\tvar first = true;\n\t\tfor( x in path ) {\n\t\t\tif( first )\n\t\t\t\tfirst = false;\n\t\t\telse\n\t\t\t\ts += \".\";\n\t\t\ts += x.nodeName;\n\t\t}\n\t\treturn s+\": \";\n\t}\n\n\tstatic function makeString( x : Xml ) {\n\t\tif( x.nodeType == Xml.Element )\n\t\t\treturn \"element \"+x.nodeName;\n\t\tvar s = x.nodeValue.split(\"\\r\").join(\"\\\\r\").split(\"\\n\").join(\"\\\\n\").split(\"\\t\").join(\"\\\\t\");\n\t\tif( s.length > 20 )\n\t\t\treturn s.substr(0,17)+\"...\";\n\t\treturn s;\n\t}\n\n\tstatic function makeRule( r : Rule ) {\n\t\tswitch( r ) {\n\t\tcase RNode(name,_,_): return \"element \"+name;\n\t\tcase RData(_): return \"data\";\n\t\tcase RMulti(r,_): return makeRule(r);\n\t\tcase RList(rules,_): return makeRule(rules[0]);\n\t\tcase RChoice(choices): return makeRule(choices[0]);\n\t\tcase ROptional(r): return makeRule(r);\n\t\t}\n\t}\n\n\tstatic function makeError(m,?path) {\n\t\tif( path == null )\n\t\t\tpath = new Array();\n\t\tswitch( m ) {\n\t\tcase CMatch: throw \"assert\";\n\t\tcase CMissing(r):\n\t\t\treturn makeWhere(path)+\"Missing \"+makeRule(r);\n\t\tcase CExtra(x):\n\t\t\treturn makeWhere(path)+\"Unexpected \"+makeString(x);\n\t\tcase CElementExpected(name,x):\n\t\t\treturn makeWhere(path)+makeString(x)+\" while expected element \"+name;\n\t\tcase CDataExpected(x):\n\t\t\treturn makeWhere(path)+makeString(x)+\" while data expected\";\n\t\tcase CExtraAttrib(att,x):\n\t\t\tpath.push(x);\n\t\t\treturn makeWhere(path)+\"unexpected attribute \"+att;\n\t\tcase CMissingAttrib(att,x):\n\t\t\tpath.push(x);\n\t\t\treturn makeWhere(path)+\"missing required attribute \"+att;\n\t\tcase CInvalidAttrib(att,x,_):\n\t\t\tpath.push(x);\n\t\t\treturn makeWhere(path)+\"invalid attribute value for \"+att;\n\t\tcase CInvalidData(x,_):\n\t\t\treturn makeWhere(path)+\"invalid data format for \"+makeString(x);\n\t\tcase CInElement(x,m):\n\t\t\tpath.push(x);\n\t\t\treturn makeError(m,path);\n\t\t}\n\t}\n\n\tpublic static function checkNode( x : Xml, r : Rule ) {\n\t\tvar m = checkList([x].iterator(),r);\n\t\tif( m == CMatch )\n\t\t\treturn;\n\t\tthrow makeError(m);\n\t}\n\n\tpublic static function checkDocument( x : Xml, r : Rule ) {\n\t\tif( x.nodeType != Xml.Document )\n\t\t\tthrow \"Document expected\";\n\t\tvar m = checkList(x.iterator(),r);\n\t\tif( m == CMatch )\n\t\t\treturn;\n\t\tthrow makeError(m);\n\t}\n\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.xml;\n\nprivate class NodeAccess implements Dynamic<Fast> {\n\n\tvar __x : Xml;\n\n\tpublic function new( x : Xml ) {\n\t\t__x = x;\n\t}\n\n\tpublic function resolve( name : String ) : Fast {\n\t\tvar x = __x.elementsNamed(name).next();\n\t\tif( x == null ) {\n\t\t\tvar xname = if( __x.nodeType == Xml.Document ) \"Document\" else __x.nodeName;\n\t\t\tthrow xname+\" is missing element \"+name;\n\t\t}\n\t\treturn new Fast(x);\n\t}\n\n}\n\nprivate class AttribAccess implements Dynamic<String> {\n\n\tvar __x : Xml;\n\n\tpublic function new( x : Xml ) {\n\t\t__x = x;\n\t}\n\n\tpublic function resolve( name : String ) : String {\n\t\tif( __x.nodeType == Xml.Document )\n\t\t\tthrow \"Cannot access document attribute \"+name;\n\t\tvar v = __x.get(name);\n\t\tif( v == null )\n\t\t\tthrow __x.nodeName+\" is missing attribute \"+name;\n\t\treturn v;\n\t}\n\n}\n\nprivate class HasAttribAccess implements Dynamic<Bool> {\n\n\tvar __x : Xml;\n\n\tpublic function new( x : Xml ) {\n\t\t__x = x;\n\t}\n\n\tpublic function resolve( name : String ) : Bool {\n\t\tif( __x.nodeType == Xml.Document )\n\t\t\tthrow \"Cannot access document attribute \"+name;\n\t\treturn __x.exists(name);\n\t}\n\n}\n\nprivate class HasNodeAccess implements Dynamic<Bool> {\n\n\tvar __x : Xml;\n\n\tpublic function new( x : Xml ) {\n\t\t__x = x;\n\t}\n\n\tpublic function resolve( name : String ) : Bool {\n\t\treturn __x.elementsNamed(name).hasNext();\n\t}\n\n}\n\nprivate class NodeListAccess implements Dynamic<List<Fast>> {\n\n\tvar __x : Xml;\n\n\tpublic function new( x : Xml ) {\n\t\t__x = x;\n\t}\n\n\tpublic function resolve( name : String ) : List<Fast> {\n\t\tvar l = new List();\n\t\tfor( x in __x.elementsNamed(name) )\n\t\t\tl.add(new Fast(x));\n\t\treturn l;\n\t}\n\n}\n\nclass Fast {\n\n\tpublic var x(default,null) : Xml;\n\tpublic var name(get,null) : String;\n\tpublic var innerData(get,null) : String;\n\tpublic var innerHTML(get,null) : String;\n\tpublic var node(default,null) : NodeAccess;\n\tpublic var nodes(default,null) : NodeListAccess;\n\tpublic var att(default,null) : AttribAccess;\n\tpublic var has(default,null) : HasAttribAccess;\n\tpublic var hasNode(default,null) : HasNodeAccess;\n\tpublic var elements(get,null) : Iterator<Fast>;\n\n\tpublic function new( x : Xml ) {\n\t\tif( x.nodeType != Xml.Document && x.nodeType != Xml.Element )\n\t\t\tthrow \"Invalid nodeType \"+x.nodeType;\n\t\tthis.x = x;\n\t\tnode = new NodeAccess(x);\n\t\tnodes = new NodeListAccess(x);\n\t\tatt = new AttribAccess(x);\n\t\thas = new HasAttribAccess(x);\n\t\thasNode = new HasNodeAccess(x);\n\t}\n\n\tfunction get_name() {\n\t\treturn if( x.nodeType == Xml.Document ) \"Document\" else x.nodeName;\n\t}\n\n\tfunction get_innerData() {\n\t\tvar it = x.iterator();\n\t\tif( !it.hasNext() )\n\t\t\tthrow name+\" does not have data\";\n\t\tvar v = it.next();\n\t\tvar n = it.next();\n\t\tif( n != null ) {\n\t\t\t// handle <spaces>CDATA<spaces>\n\t\t\tif( v.nodeType == Xml.PCData && n.nodeType == Xml.CData && StringTools.trim(v.nodeValue) == \"\" ) {\n\t\t\t\tvar n2 = it.next();\n\t\t\t\tif( n2 == null || (n2.nodeType == Xml.PCData && StringTools.trim(n2.nodeValue) == \"\" && it.next() == null) )\n\t\t\t\t\treturn n.nodeValue;\n\t\t\t}\n\t\t\tthrow name+\" does not only have data\";\n\t\t}\n\t\tif( v.nodeType != Xml.PCData && v.nodeType != Xml.CData )\n\t\t\tthrow name+\" does not have data\";\n\t\treturn v.nodeValue;\n\t}\n\n\tfunction get_innerHTML() {\n\t\tvar s = new StringBuf();\n\t\tfor( x in x )\n\t\t\ts.add(x.toString());\n\t\treturn s.toString();\n\t}\n\n\tfunction get_elements() {\n\t\tvar it = x.elements();\n\t\treturn {\n\t\t\thasNext : it.hasNext,\n\t\t\tnext : function() {\n\t\t\t\tvar x = it.next();\n\t\t\t\tif( x == null )\n\t\t\t\t\treturn null;\n\t\t\t\treturn new Fast(x);\n\t\t\t}\n\t\t};\n\t}\n}\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe.xml;\n\nusing StringTools;\n\n/* poor'man enum : reduce code size + a bit faster since inlined */\nextern private class S {\n\tpublic static inline var IGNORE_SPACES \t= 0;\n\tpublic static inline var BEGIN\t\t\t= 1;\n\tpublic static inline var BEGIN_NODE\t\t= 2;\n\tpublic static inline var TAG_NAME\t\t= 3;\n\tpublic static inline var BODY\t\t\t= 4;\n\tpublic static inline var ATTRIB_NAME\t= 5;\n\tpublic static inline var EQUALS\t\t\t= 6;\n\tpublic static inline var ATTVAL_BEGIN\t= 7;\n\tpublic static inline var ATTRIB_VAL\t\t= 8;\n\tpublic static inline var CHILDS\t\t\t= 9;\n\tpublic static inline var CLOSE\t\t\t= 10;\n\tpublic static inline var WAIT_END\t\t= 11;\n\tpublic static inline var WAIT_END_RET\t= 12;\n\tpublic static inline var PCDATA\t\t\t= 13;\n\tpublic static inline var HEADER\t\t\t= 14;\n\tpublic static inline var COMMENT\t\t= 15;\n\tpublic static inline var DOCTYPE\t\t= 16;\n\tpublic static inline var CDATA\t\t\t= 17;\n\tpublic static inline var ESCAPE\t\t\t= 18;\n}\n\nclass Parser\n{\n\tstatic var escapes = {\n\t\tvar h = new haxe.ds.StringMap();\n\t\th.set(\"lt\", \"<\");\n\t\th.set(\"gt\", \">\");\n\t\th.set(\"amp\", \"&\");\n\t\th.set(\"quot\", '\"');\n\t\th.set(\"apos\", \"'\");\n\t\th.set(\"nbsp\", String.fromCharCode(160));\n\t\th;\n\t}\n\n\tstatic public function parse(str:String)\n\t{\n\t\tvar doc = Xml.createDocument();\n\t\tdoParse(str, 0, doc);\n\t\treturn doc;\n\t}\n\n\tstatic function doParse(str:String, p:Int = 0, ?parent:Xml):Int\n\t{\n\t\tvar xml:Xml = null;\n\t\tvar state = S.BEGIN;\n\t\tvar next = S.BEGIN;\n\t\tvar aname = null;\n\t\tvar start = 0;\n\t\tvar nsubs = 0;\n\t\tvar nbrackets = 0;\n\t\tvar c = str.fastCodeAt(p);\n\t\tvar buf = new StringBuf();\n\t\twhile (!StringTools.isEof(c))\n\t\t{\n\t\t\tswitch(state)\n\t\t\t{\n\t\t\t\tcase S.IGNORE_SPACES:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase\n\t\t\t\t\t\t\t'\\n'.code,\n\t\t\t\t\t\t\t'\\r'.code,\n\t\t\t\t\t\t\t'\\t'.code,\n\t\t\t\t\t\t\t' '.code:\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tstate = next;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.BEGIN:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '<'.code:\n\t\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\t\tnext = S.BEGIN_NODE;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tstart = p;\n\t\t\t\t\t\t\tstate = S.PCDATA;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.PCDATA:\n\t\t\t\t\tif (c == '<'.code)\n\t\t\t\t\t{\n\t\t\t\t\t\t#if php\n\t\t\t\t\t\tvar child = Xml.createPCDataFromCustomParser(buf.toString() + str.substr(start, p - start));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\tvar child = Xml.createPCData(buf.toString() + str.substr(start, p - start));\n\t\t\t\t\t\t#end\n\t\t\t\t\t\tbuf = new StringBuf();\n\t\t\t\t\t\tparent.addChild(child);\n\t\t\t\t\t\tnsubs++;\n\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\tnext = S.BEGIN_NODE;\n\t\t\t\t\t}\n\t\t\t\t\t#if !flash9\n\t\t\t\t\telse if (c == '&'.code) {\n\t\t\t\t\t\tbuf.addSub(str, start, p - start);\n\t\t\t\t\t\tstate = S.ESCAPE;\n\t\t\t\t\t\tnext = S.PCDATA;\n\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t}\n\t\t\t\t\t#end\n\t\t\t\tcase S.CDATA:\n\t\t\t\t\tif (c == ']'.code && str.fastCodeAt(p + 1) == ']'.code && str.fastCodeAt(p + 2) == '>'.code)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar child = Xml.createCData(str.substr(start, p - start));\n\t\t\t\t\t\tparent.addChild(child);\n\t\t\t\t\t\tnsubs++;\n\t\t\t\t\t\tp += 2;\n\t\t\t\t\t\tstate = S.BEGIN;\n\t\t\t\t\t}\n\t\t\t\tcase S.BEGIN_NODE:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '!'.code:\n\t\t\t\t\t\t\tif (str.fastCodeAt(p + 1) == '['.code)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tp += 2;\n\t\t\t\t\t\t\t\tif (str.substr(p, 6).toUpperCase() != \"CDATA[\")\n\t\t\t\t\t\t\t\t\tthrow(\"Expected <![CDATA[\");\n\t\t\t\t\t\t\t\tp += 5;\n\t\t\t\t\t\t\t\tstate = S.CDATA;\n\t\t\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (str.fastCodeAt(p + 1) == 'D'.code || str.fastCodeAt(p + 1) == 'd'.code)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif(str.substr(p + 2, 6).toUpperCase() != \"OCTYPE\")\n\t\t\t\t\t\t\t\t\tthrow(\"Expected <!DOCTYPE\");\n\t\t\t\t\t\t\t\tp += 8;\n\t\t\t\t\t\t\t\tstate = S.DOCTYPE;\n\t\t\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if( str.fastCodeAt(p + 1) != '-'.code || str.fastCodeAt(p + 2) != '-'.code )\n\t\t\t\t\t\t\t\tthrow(\"Expected <!--\");\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tp += 2;\n\t\t\t\t\t\t\t\tstate = S.COMMENT;\n\t\t\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tcase '?'.code:\n\t\t\t\t\t\t\tstate = S.HEADER;\n\t\t\t\t\t\t\tstart = p;\n\t\t\t\t\t\tcase '/'.code:\n\t\t\t\t\t\t\tif( parent == null )\n\t\t\t\t\t\t\t\tthrow(\"Expected node name\");\n\t\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\t\tnext = S.CLOSE;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tstate = S.TAG_NAME;\n\t\t\t\t\t\t\tstart = p;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.TAG_NAME:\n\t\t\t\t\tif (!isValidChar(c))\n\t\t\t\t\t{\n\t\t\t\t\t\tif( p == start )\n\t\t\t\t\t\t\tthrow(\"Expected node name\");\n\t\t\t\t\t\txml = Xml.createElement(str.substr(start, p - start));\n\t\t\t\t\t\tparent.addChild(xml);\n\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\tnext = S.BODY;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.BODY:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '/'.code:\n\t\t\t\t\t\t\tstate = S.WAIT_END;\n\t\t\t\t\t\t\tnsubs++;\n\t\t\t\t\t\tcase '>'.code:\n\t\t\t\t\t\t\tstate = S.CHILDS;\n\t\t\t\t\t\t\tnsubs++;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tstate = S.ATTRIB_NAME;\n\t\t\t\t\t\t\tstart = p;\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.ATTRIB_NAME:\n\t\t\t\t\tif (!isValidChar(c))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar tmp;\n\t\t\t\t\t\tif( start == p )\n\t\t\t\t\t\t\tthrow(\"Expected attribute name\");\n\t\t\t\t\t\ttmp = str.substr(start,p-start);\n\t\t\t\t\t\taname = tmp;\n\t\t\t\t\t\tif( xml.exists(aname) )\n\t\t\t\t\t\t\tthrow(\"Duplicate attribute\");\n\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\tnext = S.EQUALS;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.EQUALS:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '='.code:\n\t\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\t\tnext = S.ATTVAL_BEGIN;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow(\"Expected =\");\n\t\t\t\t\t}\n\t\t\t\tcase S.ATTVAL_BEGIN:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '\"'.code, '\\''.code:\n\t\t\t\t\t\t\tstate = S.ATTRIB_VAL;\n\t\t\t\t\t\t\tstart = p;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow(\"Expected \\\"\");\n\t\t\t\t\t}\n\t\t\t\tcase S.ATTRIB_VAL:\n\t\t\t\t\tif (c == str.fastCodeAt(start))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar val = str.substr(start+1,p-start-1);\n\t\t\t\t\t\txml.set(aname, val);\n\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\tnext = S.BODY;\n\t\t\t\t\t}\n\t\t\t\tcase S.CHILDS:\n\t\t\t\t\tp = doParse(str, p, xml);\n\t\t\t\t\tstart = p;\n\t\t\t\t\tstate = S.BEGIN;\n\t\t\t\tcase S.WAIT_END:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '>'.code:\n\t\t\t\t\t\t\tstate = S.BEGIN;\n\t\t\t\t\t\tdefault :\n\t\t\t\t\t\t\tthrow(\"Expected >\");\n\t\t\t\t\t}\n\t\t\t\tcase S.WAIT_END_RET:\n\t\t\t\t\tswitch(c)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase '>'.code:\n\t\t\t\t\t\t\tif( nsubs == 0 )\n\t\t\t\t\t\t\t\tparent.addChild(Xml.createPCData(\"\"));\n\t\t\t\t\t\t\treturn p;\n\t\t\t\t\t\tdefault :\n\t\t\t\t\t\t\tthrow(\"Expected >\");\n\t\t\t\t\t}\n\t\t\t\tcase S.CLOSE:\n\t\t\t\t\tif (!isValidChar(c))\n\t\t\t\t\t{\n\t\t\t\t\t\tif( start == p )\n\t\t\t\t\t\t\tthrow(\"Expected node name\");\n\n\t\t\t\t\t\tvar v = str.substr(start,p - start);\n\t\t\t\t\t\tif (v != parent.nodeName)\n\t\t\t\t\t\t\tthrow \"Expected </\" +parent.nodeName + \">\";\n\n\t\t\t\t\t\tstate = S.IGNORE_SPACES;\n\t\t\t\t\t\tnext = S.WAIT_END_RET;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\tcase S.COMMENT:\n\t\t\t\t\tif (c == '-'.code && str.fastCodeAt(p +1) == '-'.code && str.fastCodeAt(p + 2) == '>'.code)\n\t\t\t\t\t{\n\t\t\t\t\t\tparent.addChild(Xml.createComment(str.substr(start, p - start)));\n\t\t\t\t\t\tp += 2;\n\t\t\t\t\t\tstate = S.BEGIN;\n\t\t\t\t\t}\n\t\t\t\tcase S.DOCTYPE:\n\t\t\t\t\tif(c == '['.code)\n\t\t\t\t\t\tnbrackets++;\n\t\t\t\t\telse if(c == ']'.code)\n\t\t\t\t\t\tnbrackets--;\n\t\t\t\t\telse if (c == '>'.code && nbrackets == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tparent.addChild(Xml.createDocType(str.substr(start, p - start)));\n\t\t\t\t\t\tstate = S.BEGIN;\n\t\t\t\t\t}\n\t\t\t\tcase S.HEADER:\n\t\t\t\t\tif (c == '?'.code && str.fastCodeAt(p + 1) == '>'.code)\n\t\t\t\t\t{\n\t\t\t\t\t\tp++;\n\t\t\t\t\t\tvar str = str.substr(start + 1, p - start - 2);\n\t\t\t\t\t\tparent.addChild(Xml.createProcessingInstruction(str));\n\t\t\t\t\t\tstate = S.BEGIN;\n\t\t\t\t\t}\n\t\t\t\tcase S.ESCAPE:\n\t\t\t\t\tif (c == ';'.code)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar s = str.substr(start, p - start);\n\t\t\t\t\t\tif (s.fastCodeAt(0) == '#'.code) {\n\t\t\t\t\t\t\tvar i = s.fastCodeAt(1) == 'x'.code\n\t\t\t\t\t\t\t\t? Std.parseInt(\"0\" +s.substr(1, s.length - 1))\n\t\t\t\t\t\t\t\t: Std.parseInt(s.substr(1, s.length - 1));\n\t\t\t\t\t\t\tbuf.add(String.fromCharCode(i));\n\t\t\t\t\t\t} else if (!escapes.exists(s))\n\t\t\t\t\t\t\tbuf.add('&$s;');\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tbuf.add(escapes.get(s));\n\t\t\t\t\t\tstart = p + 1;\n\t\t\t\t\t\tstate = next;\n\t\t\t\t\t}\n\t\t\t}\n\t\t\tc = str.fastCodeAt(++p);\n\t\t}\n\n\t\tif (state == S.BEGIN)\n\t\t{\n\t\t\tstart = p;\n\t\t\tstate = S.PCDATA;\n\t\t}\n\n\t\tif (state == S.PCDATA)\n\t\t{\n\t\t\tif (p != start || nsubs == 0)\n\t\t\t\tparent.addChild(Xml.createPCData(buf.toString() + str.substr(start, p - start)));\n\t\t\treturn p;\n\t\t}\n\n\t\tthrow \"Unexpected end\";\n\t}\n\n\tstatic inline function isValidChar(c) {\n\t\treturn (c >= 'a'.code && c <= 'z'.code) || (c >= 'A'.code && c <= 'Z'.code) || (c >= '0'.code && c <= '9'.code) || c == ':'.code || c == '.'.code || c == '_'.code || c == '-'.code;\n\t}\n}","/*\r\n * Copyright (c) 2008, Nicolas Cannasse\r\n * All rights reserved.\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *\r\n *   - Redistributions of source code must retain the above copyright\r\n *     notice, this list of conditions and the following disclaimer.\r\n *   - Redistributions in binary form must reproduce the above copyright\r\n *     notice, this list of conditions and the following disclaimer in the\r\n *     documentation and/or other materials provided with the distribution.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE HAXE PROJECT CONTRIBUTORS \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL THE HAXE PROJECT CONTRIBUTORS BE LIABLE FOR\r\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\r\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\r\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\r\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT\r\n * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY\r\n * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH\r\n * DAMAGE.\r\n */\r\npackage hscript;\r\nimport hscript.Expr;\r\n\r\nprivate enum Stop {\r\n\tSBreak;\r\n\tSContinue;\r\n\tSReturn( v : Dynamic );\r\n}\r\n\r\nclass Interp {\r\n\r\n\t#if haxe3\r\n\tpublic var variables : Map<String,Dynamic>;\r\n\tvar locals : Map<String,{ r : Dynamic }>;\r\n\tvar binops : Map<String, Expr -> Expr -> Dynamic >;\r\n\t#else\r\n\tpublic var variables : Hash<Dynamic>;\r\n\tvar locals : Hash<{ r : Dynamic }>;\r\n\tvar binops : Hash< Expr -> Expr -> Dynamic >;\r\n\t#end\r\n\r\n\tvar depth : Int;\r\n\tvar declared : Array<{ n : String, old : { r : Dynamic } }>;\r\n\r\n\t#if hscriptPos\r\n\tvar curExpr : Expr;\r\n\t#end\r\n\r\n\tpublic function new() {\r\n\t\t#if haxe3\r\n\t\tvariables = new Map<String,Dynamic>();\r\n\t\tlocals = new Map();\r\n\t\t#else\r\n\t\tvariables = new Hash();\r\n\t\tlocals = new Hash();\r\n\t\t#end\r\n\t\tvariables.set(\"null\",null);\r\n\t\tvariables.set(\"true\",true);\r\n\t\tvariables.set(\"false\",false);\r\n\t\tvariables.set(\"trace\",function(e) haxe.Log.trace(Std.string(e),cast { fileName : \"hscript\", lineNumber : 0 }));\r\n\t\tinitOps();\r\n\t}\r\n\r\n\tfunction initOps() {\r\n\t\tvar me = this;\r\n\t\t#if haxe3\r\n\t\tbinops = new Map();\r\n\t\t#else\r\n\t\tbinops = new Hash();\r\n\t\t#end\r\n\t\tbinops.set(\"+\",function(e1,e2) return me.expr(e1) + me.expr(e2));\r\n\t\tbinops.set(\"-\",function(e1,e2) return me.expr(e1) - me.expr(e2));\r\n\t\tbinops.set(\"*\",function(e1,e2) return me.expr(e1) * me.expr(e2));\r\n\t\tbinops.set(\"/\",function(e1,e2) return me.expr(e1) / me.expr(e2));\r\n\t\tbinops.set(\"%\",function(e1,e2) return me.expr(e1) % me.expr(e2));\r\n\t\tbinops.set(\"&\",function(e1,e2) return me.expr(e1) & me.expr(e2));\r\n\t\tbinops.set(\"|\",function(e1,e2) return me.expr(e1) | me.expr(e2));\r\n\t\tbinops.set(\"^\",function(e1,e2) return me.expr(e1) ^ me.expr(e2));\r\n\t\tbinops.set(\"<<\",function(e1,e2) return me.expr(e1) << me.expr(e2));\r\n\t\tbinops.set(\">>\",function(e1,e2) return me.expr(e1) >> me.expr(e2));\r\n\t\tbinops.set(\">>>\",function(e1,e2) return me.expr(e1) >>> me.expr(e2));\r\n\t\tbinops.set(\"==\",function(e1,e2) return me.expr(e1) == me.expr(e2));\r\n\t\tbinops.set(\"!=\",function(e1,e2) return me.expr(e1) != me.expr(e2));\r\n\t\tbinops.set(\">=\",function(e1,e2) return me.expr(e1) >= me.expr(e2));\r\n\t\tbinops.set(\"<=\",function(e1,e2) return me.expr(e1) <= me.expr(e2));\r\n\t\tbinops.set(\">\",function(e1,e2) return me.expr(e1) > me.expr(e2));\r\n\t\tbinops.set(\"<\",function(e1,e2) return me.expr(e1) < me.expr(e2));\r\n\t\tbinops.set(\"||\",function(e1,e2) return me.expr(e1) == true || me.expr(e2) == true);\r\n\t\tbinops.set(\"&&\",function(e1,e2) return me.expr(e1) == true && me.expr(e2) == true);\r\n\t\tbinops.set(\"=\",assign);\r\n\t\tbinops.set(\"...\",function(e1,e2) return new #if (haxe_211 || haxe3) IntIterator #else IntIter #end(me.expr(e1),me.expr(e2)));\r\n\t\tassignOp(\"+=\",function(v1:Dynamic,v2:Dynamic) return v1 + v2);\r\n\t\tassignOp(\"-=\",function(v1:Float,v2:Float) return v1 - v2);\r\n\t\tassignOp(\"*=\",function(v1:Float,v2:Float) return v1 * v2);\r\n\t\tassignOp(\"/=\",function(v1:Float,v2:Float) return v1 / v2);\r\n\t\tassignOp(\"%=\",function(v1:Float,v2:Float) return v1 % v2);\r\n\t\tassignOp(\"&=\",function(v1,v2) return v1 & v2);\r\n\t\tassignOp(\"|=\",function(v1,v2) return v1 | v2);\r\n\t\tassignOp(\"^=\",function(v1,v2) return v1 ^ v2);\r\n\t\tassignOp(\"<<=\",function(v1,v2) return v1 << v2);\r\n\t\tassignOp(\">>=\",function(v1,v2) return v1 >> v2);\r\n\t\tassignOp(\">>>=\",function(v1,v2) return v1 >>> v2);\r\n\t}\r\n\r\n\tfunction assign( e1 : Expr, e2 : Expr ) : Dynamic {\r\n\t\tvar v = expr(e2);\r\n\t\tswitch( edef(e1) ) {\r\n\t\tcase EIdent(id):\r\n\t\t\tvar l = locals.get(id);\r\n\t\t\tif( l == null )\r\n\t\t\t\tvariables.set(id,v)\r\n\t\t\telse\r\n\t\t\t\tl.r = v;\r\n\t\tcase EField(e,f):\r\n\t\t\tv = set(expr(e),f,v);\r\n\t\tcase EArray(e,index):\r\n\t\t\texpr(e)[expr(index)] = v;\r\n\t\tdefault:\r\n\t\t\terror(EInvalidOp(\"=\"));\r\n\t\t}\r\n\t\treturn v;\r\n\t}\r\n\r\n\tfunction assignOp( op, fop : Dynamic -> Dynamic -> Dynamic ) {\r\n\t\tvar me = this;\r\n\t\tbinops.set(op,function(e1,e2) return me.evalAssignOp(op,fop,e1,e2));\r\n\t}\r\n\r\n\tfunction evalAssignOp(op,fop,e1,e2) : Dynamic {\r\n\t\tvar v;\r\n\t\tswitch( edef(e1) ) {\r\n\t\tcase EIdent(id):\r\n\t\t\tvar l = locals.get(id);\r\n\t\t\tv = fop(expr(e1),expr(e2));\r\n\t\t\tif( l == null )\r\n\t\t\t\tvariables.set(id,v)\r\n\t\t\telse\r\n\t\t\t\tl.r = v;\r\n\t\tcase EField(e,f):\r\n\t\t\tvar obj = expr(e);\r\n\t\t\tv = fop(get(obj,f),expr(e2));\r\n\t\t\tv = set(obj,f,v);\r\n\t\tcase EArray(e,index):\r\n\t\t\tvar arr = expr(e);\r\n\t\t\tvar index = expr(index);\r\n\t\t\tv = fop(arr[index],expr(e2));\r\n\t\t\tarr[index] = v;\r\n\t\tdefault:\r\n\t\t\treturn error(EInvalidOp(op));\r\n\t\t}\r\n\t\treturn v;\r\n\t}\r\n\r\n\tfunction increment( e : Expr, prefix : Bool, delta : Int ) : Dynamic {\r\n\t\t#if hscriptPos\r\n\t\tcurExpr = e;\r\n\t\tvar e = e.e;\r\n\t\t#end\r\n\t\tswitch(e) {\r\n\t\tcase EIdent(id):\r\n\t\t\tvar l = locals.get(id);\r\n\t\t\tvar v : Dynamic = (l == null) ? variables.get(id) : l.r;\r\n\t\t\tif( prefix ) {\r\n\t\t\t\tv += delta;\r\n\t\t\t\tif( l == null ) variables.set(id,v) else l.r = v;\r\n\t\t\t} else\r\n\t\t\t\tif( l == null ) variables.set(id,v + delta) else l.r = v + delta;\r\n\t\t\treturn v;\r\n\t\tcase EField(e,f):\r\n\t\t\tvar obj = expr(e);\r\n\t\t\tvar v : Dynamic = get(obj,f);\r\n\t\t\tif( prefix ) {\r\n\t\t\t\tv += delta;\r\n\t\t\t\tset(obj,f,v);\r\n\t\t\t} else\r\n\t\t\t\tset(obj,f,v + delta);\r\n\t\t\treturn v;\r\n\t\tcase EArray(e,index):\r\n\t\t\tvar arr = expr(e);\r\n\t\t\tvar index = expr(index);\r\n\t\t\tvar v = arr[index];\r\n\t\t\tif( prefix ) {\r\n\t\t\t\tv += delta;\r\n\t\t\t\tarr[index] = v;\r\n\t\t\t} else\r\n\t\t\t\tarr[index] = v + delta;\r\n\t\t\treturn v;\r\n\t\tdefault:\r\n\t\t\treturn error(EInvalidOp((delta > 0)?\"++\":\"--\"));\r\n\t\t}\r\n\t}\r\n\r\n\tpublic function execute( expr : Expr ) : Dynamic {\r\n\t\tdepth = 0;\r\n\t\t#if haxe3\r\n\t\tlocals = new Map();\r\n\t\t#else\r\n\t\tlocals = new Hash();\r\n\t\t#end\r\n\t\tdeclared = new Array();\r\n\t\treturn exprReturn(expr);\r\n\t}\r\n\r\n\tfunction exprReturn(e) : Dynamic {\r\n\t\ttry {\r\n\t\t\treturn expr(e);\r\n\t\t} catch( e : Stop ) {\r\n\t\t\tswitch( e ) {\r\n\t\t\tcase SBreak: throw \"Invalid break\";\r\n\t\t\tcase SContinue: throw \"Invalid continue\";\r\n\t\t\tcase SReturn(v): return v;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction duplicate<T>( h : #if haxe3 Map < String, T > #else Hash<T> #end ) {\r\n\t\t#if haxe3\r\n\t\tvar h2 = new Map();\r\n\t\t#else\r\n\t\tvar h2 = new Hash();\r\n\t\t#end\r\n\t\tfor( k in h.keys() )\r\n\t\t\th2.set(k,h.get(k));\r\n\t\treturn h2;\r\n\t}\r\n\r\n\tfunction restore( old : Int ) {\r\n\t\twhile( declared.length > old ) {\r\n\t\t\tvar d = declared.pop();\r\n\t\t\tlocals.set(d.n,d.old);\r\n\t\t}\r\n\t}\r\n\r\n\tinline function edef( e : Expr ) {\r\n\t\t#if hscriptPos\r\n\t\treturn e.e;\r\n\t\t#else\r\n\t\treturn e;\r\n\t\t#end\r\n\t}\r\n\r\n\tinline function error(e : #if hscriptPos ErrorDef #else Error #end ) : Dynamic {\r\n\t\t#if hscriptPos\r\n\t\tthrow new Error(e, curExpr.pmin, curExpr.pmax);\r\n\t\t#else\r\n\t\tthrow e;\r\n\t\t#end\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction resolve( id : String ) : Dynamic {\r\n\t\tvar l = locals.get(id);\r\n\t\tif( l != null )\r\n\t\t\treturn l.r;\r\n\t\tvar v = variables.get(id);\r\n\t\tif( v == null && !variables.exists(id) )\r\n\t\t\terror(EUnknownVariable(id));\r\n\t\treturn v;\r\n\t}\r\n\r\n\tpublic function expr( e : Expr ) : Dynamic {\r\n\t\t#if hscriptPos\r\n\t\tcurExpr = e;\r\n\t\tvar e = e.e;\r\n\t\t#end\r\n\t\tswitch( e ) {\r\n\t\tcase EConst(c):\r\n\t\t\tswitch( c ) {\r\n\t\t\tcase CInt(v): return v;\r\n\t\t\tcase CFloat(f): return f;\r\n\t\t\tcase CString(s): return s;\r\n\t\t\t#if !haxe3\r\n\t\t\tcase CInt32(v): return v;\r\n\t\t\t#end\r\n\t\t\t}\r\n\t\tcase EIdent(id):\r\n\t\t\treturn resolve(id);\r\n\t\tcase EVar(n,_,e):\r\n\t\t\tdeclared.push({ n : n, old : locals.get(n) });\r\n\t\t\tlocals.set(n,{ r : (e == null)?null:expr(e) });\r\n\t\t\treturn null;\r\n\t\tcase EParent(e):\r\n\t\t\treturn expr(e);\r\n\t\tcase EBlock(exprs):\r\n\t\t\tvar old = declared.length;\r\n\t\t\tvar v = null;\r\n\t\t\tfor( e in exprs )\r\n\t\t\t\tv = expr(e);\r\n\t\t\trestore(old);\r\n\t\t\treturn v;\r\n\t\tcase EField(e,f):\r\n\t\t\treturn get(expr(e),f);\r\n\t\tcase EBinop(op,e1,e2):\r\n\t\t\tvar fop = binops.get(op);\r\n\t\t\tif( fop == null ) error(EInvalidOp(op));\r\n\t\t\treturn fop(e1,e2);\r\n\t\tcase EUnop(op,prefix,e):\r\n\t\t\tswitch(op) {\r\n\t\t\tcase \"!\":\r\n\t\t\t\treturn expr(e) != true;\r\n\t\t\tcase \"-\":\r\n\t\t\t\treturn -expr(e);\r\n\t\t\tcase \"++\":\r\n\t\t\t\treturn increment(e,prefix,1);\r\n\t\t\tcase \"--\":\r\n\t\t\t\treturn increment(e,prefix,-1);\r\n\t\t\tcase \"~\":\r\n\t\t\t\t#if (neko && !haxe3)\r\n\t\t\t\treturn haxe.Int32.complement(expr(e));\r\n\t\t\t\t#else\r\n\t\t\t\treturn ~expr(e);\r\n\t\t\t\t#end\r\n\t\t\tdefault:\r\n\t\t\t\terror(EInvalidOp(op));\r\n\t\t\t}\r\n\t\tcase ECall(e,params):\r\n\t\t\tvar args = new Array();\r\n\t\t\tfor( p in params )\r\n\t\t\t\targs.push(expr(p));\r\n\r\n\t\t\tswitch( edef(e) ) {\r\n\t\t\tcase EField(e,f):\r\n\t\t\t\tvar obj = expr(e);\r\n\t\t\t\tif( obj == null ) error(EInvalidAccess(f));\r\n\t\t\t\treturn fcall(obj,f,args);\r\n\t\t\tdefault:\r\n\t\t\t\treturn call(null,expr(e),args);\r\n\t\t\t}\r\n\t\tcase EIf(econd,e1,e2):\r\n\t\t\treturn if( expr(econd) == true ) expr(e1) else if( e2 == null ) null else expr(e2);\r\n\t\tcase EWhile(econd,e):\r\n\t\t\twhileLoop(econd,e);\r\n\t\t\treturn null;\r\n\t\tcase EFor(v,it,e):\r\n\t\t\tforLoop(v,it,e);\r\n\t\t\treturn null;\r\n\t\tcase EBreak:\r\n\t\t\tthrow SBreak;\r\n\t\tcase EContinue:\r\n\t\t\tthrow SContinue;\r\n\t\tcase EReturn(e):\r\n\t\t\tthrow SReturn((e == null)?null:expr(e));\r\n\t\tcase EFunction(params,fexpr,name,_):\r\n\t\t\tvar capturedLocals = duplicate(locals);\r\n\t\t\tvar me = this;\r\n\t\t\tvar hasOpt = false, minParams = 0;\r\n\t\t\tfor( p in params )\r\n\t\t\t\tif( p.opt )\r\n\t\t\t\t\thasOpt = true;\r\n\t\t\t\telse\r\n\t\t\t\t\tminParams++;\r\n\t\t\tvar f = function(args:Array<Dynamic>) {\r\n\t\t\t\tif( args.length != params.length ) {\r\n\t\t\t\t\tif( args.length < minParams ) {\r\n\t\t\t\t\t\tvar str = \"Invalid number of parameters. Got \" + args.length + \", required \" + minParams;\r\n\t\t\t\t\t\tif( name != null ) str += \" for function '\" + name+\"'\";\r\n\t\t\t\t\t\tthrow str;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// make sure mandatory args are forced\r\n\t\t\t\t\tvar args2 = [];\r\n\t\t\t\t\tvar extraParams = args.length - minParams;\r\n\t\t\t\t\tvar pos = 0;\r\n\t\t\t\t\tfor( p in params )\r\n\t\t\t\t\t\tif( p.opt ) {\r\n\t\t\t\t\t\t\tif( extraParams > 0 ) {\r\n\t\t\t\t\t\t\t\targs2.push(args[pos++]);\r\n\t\t\t\t\t\t\t\textraParams--;\r\n\t\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\t\targs2.push(null);\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\targs2.push(args[pos++]);\r\n\t\t\t\t\targs = args2;\r\n\t\t\t\t}\r\n\t\t\t\tvar old = me.locals, depth = me.depth;\r\n\t\t\t\tme.depth++;\r\n\t\t\t\tme.locals = me.duplicate(capturedLocals);\r\n\t\t\t\tfor( i in 0...params.length )\r\n\t\t\t\t\tme.locals.set(params[i].name,{ r : args[i] });\r\n\t\t\t\tvar r = null;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tr = me.exprReturn(fexpr);\r\n\t\t\t\t} catch( e : Dynamic ) {\r\n\t\t\t\t\tme.locals = old;\r\n\t\t\t\t\tme.depth = depth;\r\n\t\t\t\t\t#if neko\r\n\t\t\t\t\tneko.Lib.rethrow(e);\r\n\t\t\t\t\t#else\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t\t#end\r\n\t\t\t\t}\r\n\t\t\t\tme.locals = old;\r\n\t\t\t\tme.depth = depth;\r\n\t\t\t\treturn r;\r\n\t\t\t};\r\n\t\t\tvar f = Reflect.makeVarArgs(f);\r\n\t\t\tif( name != null ) {\r\n\t\t\t\tif( depth == 0 ) {\r\n\t\t\t\t\t// global function\r\n\t\t\t\t\tvariables.set(name, f);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// function-in-function is a local function\r\n\t\t\t\t\tdeclared.push( { n : name, old : locals.get(name) } );\r\n\t\t\t\t\tvar ref = { r : f };\r\n\t\t\t\t\tlocals.set(name, ref);\r\n\t\t\t\t\tcapturedLocals.set(name, ref); // allow self-recursion\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn f;\r\n\t\tcase EArrayDecl(arr):\r\n\t\t\tvar a = new Array();\r\n\t\t\tfor( e in arr )\r\n\t\t\t\ta.push(expr(e));\r\n\t\t\treturn a;\r\n\t\tcase EArray(e,index):\r\n\t\t\treturn expr(e)[expr(index)];\r\n\t\tcase ENew(cl,params):\r\n\t\t\tvar a = new Array();\r\n\t\t\tfor( e in params )\r\n\t\t\t\ta.push(expr(e));\r\n\t\t\treturn cnew(cl,a);\r\n\t\tcase EThrow(e):\r\n\t\t\tthrow expr(e);\r\n\t\tcase ETry(e,n,_,ecatch):\r\n\t\t\tvar old = declared.length;\r\n\t\t\ttry {\r\n\t\t\t\tvar v : Dynamic = expr(e);\r\n\t\t\t\trestore(old);\r\n\t\t\t\treturn v;\r\n\t\t\t} catch( err : Stop ) {\r\n\t\t\t\tthrow err;\r\n\t\t\t} catch( err : Dynamic ) {\r\n\t\t\t\t// restore vars\r\n\t\t\t\trestore(old);\r\n\t\t\t\t// declare 'v'\r\n\t\t\t\tdeclared.push({ n : n, old : locals.get(n) });\r\n\t\t\t\tlocals.set(n,{ r : err });\r\n\t\t\t\tvar v : Dynamic = expr(ecatch);\r\n\t\t\t\trestore(old);\r\n\t\t\t\treturn v;\r\n\t\t\t}\r\n\t\tcase EObject(fl):\r\n\t\t\tvar o = {};\r\n\t\t\tfor( f in fl )\r\n\t\t\t\tset(o,f.name,expr(f.e));\r\n\t\t\treturn o;\r\n\t\tcase ETernary(econd,e1,e2):\r\n\t\t\treturn if( expr(econd) == true ) expr(e1) else expr(e2);\r\n\t\tcase ESwitch(e, cases, def):\r\n\t\t\tvar val : Dynamic = expr(e);\r\n\t\t\tvar match = false;\r\n\t\t\tfor( c in cases ) {\r\n\t\t\t\tfor( v in c.values )\r\n\t\t\t\t\tif( expr(v) == val ) {\r\n\t\t\t\t\t\tmatch = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\tif( match ) {\r\n\t\t\t\t\tval = expr(c.expr);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif( !match )\r\n\t\t\t\tval = def == null ? null : expr(def);\r\n\t\t\treturn val;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction whileLoop(econd,e) {\r\n\t\tvar old = declared.length;\r\n\t\twhile( expr(econd) == true ) {\r\n\t\t\ttry {\r\n\t\t\t\texpr(e);\r\n\t\t\t} catch( err : Stop ) {\r\n\t\t\t\tswitch(err) {\r\n\t\t\t\tcase SContinue:\r\n\t\t\t\tcase SBreak: break;\r\n\t\t\t\tcase SReturn(_): throw err;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\trestore(old);\r\n\t}\r\n\r\n\tfunction makeIterator( v : Dynamic ) : Iterator<Dynamic> {\r\n\t\t#if (flash && !flash9)\r\n\t\tif( v.iterator != null ) v = v.iterator();\r\n\t\t#else\r\n\t\ttry v = v.iterator() catch( e : Dynamic ) {};\r\n\t\t#end\r\n\t\tif( v.hasNext == null || v.next == null ) error(EInvalidIterator(v));\r\n\t\treturn v;\r\n\t}\r\n\r\n\tfunction forLoop(n,it,e) {\r\n\t\tvar old = declared.length;\r\n\t\tdeclared.push({ n : n, old : locals.get(n) });\r\n\t\tvar it = makeIterator(expr(it));\r\n\t\twhile( it.hasNext() ) {\r\n\t\t\tlocals.set(n,{ r : it.next() });\r\n\t\t\ttry {\r\n\t\t\t\texpr(e);\r\n\t\t\t} catch( err : Stop ) {\r\n\t\t\t\tswitch( err ) {\r\n\t\t\t\tcase SContinue:\r\n\t\t\t\tcase SBreak: break;\r\n\t\t\t\tcase SReturn(_): throw err;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\trestore(old);\r\n\t}\r\n\r\n\tfunction get( o : Dynamic, f : String ) : Dynamic {\r\n\t\tif( o == null ) error(EInvalidAccess(f));\r\n\t\treturn Reflect.field(o,f);\r\n\t}\r\n\r\n\tfunction set( o : Dynamic, f : String, v : Dynamic ) : Dynamic {\r\n\t\tif( o == null ) error(EInvalidAccess(f));\r\n\t\tReflect.setField(o,f,v);\r\n\t\treturn v;\r\n\t}\r\n\r\n\tfunction fcall( o : Dynamic, f : String, args : Array<Dynamic> ) : Dynamic {\r\n\t\treturn call(o, Reflect.field(o, f), args);\r\n\t}\r\n\r\n\tfunction call( o : Dynamic, f : Dynamic, args : Array<Dynamic> ) : Dynamic {\r\n\t\treturn Reflect.callMethod(o,f,args);\r\n\t}\r\n\r\n\tfunction cnew( cl : String, args : Array<Dynamic> ) : Dynamic {\r\n\t\tvar c = Type.resolveClass(cl);\r\n\t\tif( c == null ) c = resolve(cl);\r\n\t\treturn Type.createInstance(c,args);\r\n\t}\r\n\r\n}","/*\r\n * Copyright (c) 2008, Nicolas Cannasse\r\n * All rights reserved.\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *\r\n *   - Redistributions of source code must retain the above copyright\r\n *     notice, this list of conditions and the following disclaimer.\r\n *   - Redistributions in binary form must reproduce the above copyright\r\n *     notice, this list of conditions and the following disclaimer in the\r\n *     documentation and/or other materials provided with the distribution.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE HAXE PROJECT CONTRIBUTORS \"AS IS\" AND ANY\r\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL THE HAXE PROJECT CONTRIBUTORS BE LIABLE FOR\r\n * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\r\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\r\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\r\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT\r\n * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY\r\n * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH\r\n * DAMAGE.\r\n */\r\npackage hscript;\r\nimport hscript.Expr;\r\n\r\nenum Token {\r\n\tTEof;\r\n\tTConst( c : Const );\r\n\tTId( s : String );\r\n\tTOp( s : String );\r\n\tTPOpen;\r\n\tTPClose;\r\n\tTBrOpen;\r\n\tTBrClose;\r\n\tTDot;\r\n\tTComma;\r\n\tTSemicolon;\r\n\tTBkOpen;\r\n\tTBkClose;\r\n\tTQuestion;\r\n\tTDoubleDot;\r\n}\r\n\r\nclass Parser {\r\n\r\n\t// config / variables\r\n\tpublic var line : Int;\r\n\tpublic var opChars : String;\r\n\tpublic var identChars : String;\r\n\t#if haxe3\r\n\tpublic var opPriority : Map<String,Int>;\r\n\tpublic var opRightAssoc : Map<String,Bool>;\r\n\tpublic var unops : Map<String,Bool>; // true if allow postfix\r\n\t#else\r\n\tpublic var opPriority : Hash<Int>;\r\n\tpublic var opRightAssoc : Hash<Bool>;\r\n\tpublic var unops : Hash<Bool>; // true if allow postfix\r\n\t#end\r\n\r\n\t/**\r\n\t\tactivate JSON compatiblity\r\n\t**/\r\n\tpublic var allowJSON : Bool;\r\n\r\n\t/**\r\n\t\tallow types declarations\r\n\t**/\r\n\tpublic var allowTypes : Bool;\r\n\r\n\t// implementation\r\n\tvar input : haxe.io.Input;\r\n\tvar char : Int;\r\n\tvar ops : Array<Bool>;\r\n\tvar idents : Array<Bool>;\r\n\tvar uid : Int = 0;\r\n\r\n\t#if hscriptPos\r\n\tvar readPos : Int;\r\n\tvar tokenMin : Int;\r\n\tvar tokenMax : Int;\r\n\tvar oldTokenMin : Int;\r\n\tvar oldTokenMax : Int;\r\n\tvar tokens : List<{ min : Int, max : Int, t : Token }>;\r\n\t#else\r\n\tstatic inline var p1 = 0;\r\n\tstatic inline var readPos = 0;\r\n\tstatic inline var tokenMin = 0;\r\n\tstatic inline var tokenMax = 0;\r\n\t#if haxe3\r\n\tvar tokens : haxe.ds.GenericStack<Token>;\r\n\t#else\r\n\tvar tokens : haxe.FastList<Token>;\r\n\t#end\r\n\r\n\t#end\r\n\r\n\r\n\tpublic function new() {\r\n\t\tline = 1;\r\n\t\topChars = \"+*/-=!><&|^%~\";\r\n\t\tidentChars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_\";\r\n\t\tvar priorities = [\r\n\t\t\t[\"%\"],\r\n\t\t\t[\"*\", \"/\"],\r\n\t\t\t[\"+\", \"-\"],\r\n\t\t\t[\"<<\", \">>\", \">>>\"],\r\n\t\t\t[\"|\", \"&\", \"^\"],\r\n\t\t\t[\"==\", \"!=\", \">\", \"<\", \">=\", \"<=\"],\r\n\t\t\t[\"...\"],\r\n\t\t\t[\"&&\"],\r\n\t\t\t[\"||\"],\r\n\t\t\t[\"=\",\"+=\",\"-=\",\"*=\",\"/=\",\"%=\",\"<<=\",\">>=\",\">>>=\",\"|=\",\"&=\",\"^=\"],\r\n\t\t];\r\n\t\t#if haxe3\r\n\t\topPriority = new Map();\r\n\t\topRightAssoc = new Map();\r\n\t\tunops = new Map();\r\n\t\t#else\r\n\t\topPriority = new Hash();\r\n\t\topRightAssoc = new Hash();\r\n\t\tunops = new Hash();\r\n\t\t#end\r\n\t\tfor( i in 0...priorities.length )\r\n\t\t\tfor( x in priorities[i] ) {\r\n\t\t\t\topPriority.set(x, i);\r\n\t\t\t\tif( i == 9 ) opRightAssoc.set(x, true);\r\n\t\t\t}\r\n\t\tfor( x in [\"!\", \"++\", \"--\", \"-\", \"~\"] )\r\n\t\t\tunops.set(x, x == \"++\" || x == \"--\");\r\n\t}\r\n\r\n\tpublic inline function error( err, pmin, pmax ) {\r\n\t\t#if hscriptPos\r\n\t\tthrow new Error(err, pmin, pmax);\r\n\t\t#else\r\n\t\tthrow err;\r\n\t\t#end\r\n\t}\r\n\r\n\tpublic function invalidChar(c) {\r\n\t\terror(EInvalidChar(c), readPos, readPos);\r\n\t}\r\n\r\n\tpublic function parseString( s : String ) {\r\n\t\tline = 1;\r\n\t\tuid = 0;\r\n\t\treturn parse( new haxe.io.StringInput(s) );\r\n\t}\r\n\r\n\tpublic function parse( s : haxe.io.Input ) {\r\n\t\t#if hscriptPos\r\n\t\treadPos = 0;\r\n\t\ttokenMin = oldTokenMin = 0;\r\n\t\ttokenMax = oldTokenMax = 0;\r\n\t\ttokens = new List();\r\n\t\t#elseif haxe3\r\n\t\ttokens = new haxe.ds.GenericStack<Token>();\r\n\t\t#else\r\n\t\ttokens = new haxe.FastList<Token>();\r\n\t\t#end\r\n\t\tchar = -1;\r\n\t\tinput = s;\r\n\t\tops = new Array();\r\n\t\tidents = new Array();\r\n\t\tfor( i in 0...opChars.length )\r\n\t\t\tops[opChars.charCodeAt(i)] = true;\r\n\t\tfor( i in 0...identChars.length )\r\n\t\t\tidents[identChars.charCodeAt(i)] = true;\r\n\t\tvar a = new Array();\r\n\t\twhile( true ) {\r\n\t\t\tvar tk = token();\r\n\t\t\tif( tk == TEof ) break;\r\n\t\t\tpush(tk);\r\n\t\t\ta.push(parseFullExpr());\r\n\t\t}\r\n\t\treturn if( a.length == 1 ) a[0] else mk(EBlock(a),0);\r\n\t}\r\n\r\n\tfunction unexpected( tk ) : Dynamic {\r\n\t\terror(EUnexpected(tokenString(tk)),tokenMin,tokenMax);\r\n\t\treturn null;\r\n\t}\r\n\r\n\tinline function push(tk) {\r\n\t\t#if hscriptPos\r\n\t\ttokens.push( { t : tk, min : tokenMin, max : tokenMax } );\r\n\t\ttokenMin = oldTokenMin;\r\n\t\ttokenMax = oldTokenMax;\r\n\t\t#else\r\n\t\ttokens.add(tk);\r\n\t\t#end\r\n\t}\r\n\r\n\tinline function ensure(tk) {\r\n\t\tvar t = token();\r\n\t\tif( t != tk ) unexpected(t);\r\n\t}\r\n\r\n\tinline function expr(e:Expr) {\r\n\t\t#if hscriptPos\r\n\t\treturn e.e;\r\n\t\t#else\r\n\t\treturn e;\r\n\t\t#end\r\n\t}\r\n\r\n\tinline function pmin(e:Expr) {\r\n\t\t#if hscriptPos\r\n\t\treturn e.pmin;\r\n\t\t#else\r\n\t\treturn 0;\r\n\t\t#end\r\n\t}\r\n\r\n\tinline function pmax(e:Expr) {\r\n\t\t#if hscriptPos\r\n\t\treturn e.pmax;\r\n\t\t#else\r\n\t\treturn 0;\r\n\t\t#end\r\n\t}\r\n\r\n\tinline function mk(e,?pmin,?pmax) : Expr {\r\n\t\t#if hscriptPos\r\n\t\tif( pmin == null ) pmin = tokenMin;\r\n\t\tif( pmax == null ) pmax = tokenMax;\r\n\t\treturn { e : e, pmin : pmin, pmax : pmax };\r\n\t\t#else\r\n\t\treturn e;\r\n\t\t#end\r\n\t}\r\n\r\n\tfunction isBlock(e) {\r\n\t\treturn switch( expr(e) ) {\r\n\t\tcase EBlock(_), EObject(_), ESwitch(_): true;\r\n\t\tcase EFunction(_,e,_,_): isBlock(e);\r\n\t\tcase EVar(_,_,e): e != null && isBlock(e);\r\n\t\tcase EIf(_,e1,e2): if( e2 != null ) isBlock(e2) else isBlock(e1);\r\n\t\tcase EBinop(_,_,e): isBlock(e);\r\n\t\tcase EUnop(_,prefix,e): !prefix && isBlock(e);\r\n\t\tcase EWhile(_,e): isBlock(e);\r\n\t\tcase EFor(_,_,e): isBlock(e);\r\n\t\tcase EReturn(e): e != null && isBlock(e);\r\n\t\tdefault: false;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction parseFullExpr() {\r\n\t\tvar e = parseExpr();\r\n\t\tvar tk = token();\r\n\t\tif( tk != TSemicolon && tk != TEof ) {\r\n\t\t\tif( isBlock(e) )\r\n\t\t\t\tpush(tk);\r\n\t\t\telse\r\n\t\t\t\tunexpected(tk);\r\n\t\t}\r\n\t\treturn e;\r\n\t}\r\n\r\n\tfunction parseObject(p1) {\r\n\t\t// parse object\r\n\t\tvar fl = new Array();\r\n\t\twhile( true ) {\r\n\t\t\tvar tk = token();\r\n\t\t\tvar id = null;\r\n\t\t\tswitch( tk ) {\r\n\t\t\tcase TId(i): id = i;\r\n\t\t\tcase TConst(c):\r\n\t\t\t\tif( !allowJSON )\r\n\t\t\t\t\tunexpected(tk);\r\n\t\t\t\tswitch( c ) {\r\n\t\t\t\tcase CString(s): id = s;\r\n\t\t\t\tdefault: unexpected(tk);\r\n\t\t\t\t}\r\n\t\t\tcase TBrClose:\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tunexpected(tk);\r\n\t\t\t}\r\n\t\t\tensure(TDoubleDot);\r\n\t\t\tfl.push({ name : id, e : parseExpr() });\r\n\t\t\ttk = token();\r\n\t\t\tswitch( tk ) {\r\n\t\t\tcase TBrClose:\r\n\t\t\t\tbreak;\r\n\t\t\tcase TComma:\r\n\t\t\tdefault:\r\n\t\t\t\tunexpected(tk);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn parseExprNext(mk(EObject(fl),p1));\r\n\t}\r\n\r\n\tfunction parseExpr() {\r\n\t\tvar tk = token();\r\n\t\t#if hscriptPos\r\n\t\tvar p1 = tokenMin;\r\n\t\t#end\r\n\t\tswitch( tk ) {\r\n\t\tcase TId(id):\r\n\t\t\tvar e = parseStructure(id);\r\n\t\t\tif( e == null )\r\n\t\t\t\te = mk(EIdent(id));\r\n\t\t\treturn parseExprNext(e);\r\n\t\tcase TConst(c):\r\n\t\t\treturn parseExprNext(mk(EConst(c)));\r\n\t\tcase TPOpen:\r\n\t\t\tvar e = parseExpr();\r\n\t\t\tensure(TPClose);\r\n\t\t\treturn parseExprNext(mk(EParent(e),p1,tokenMax));\r\n\t\tcase TBrOpen:\r\n\t\t\ttk = token();\r\n\t\t\tswitch( tk ) {\r\n\t\t\tcase TBrClose:\r\n\t\t\t\treturn parseExprNext(mk(EObject([]),p1));\r\n\t\t\tcase TId(_):\r\n\t\t\t\tvar tk2 = token();\r\n\t\t\t\tpush(tk2);\r\n\t\t\t\tpush(tk);\r\n\t\t\t\tswitch( tk2 ) {\r\n\t\t\t\tcase TDoubleDot:\r\n\t\t\t\t\treturn parseExprNext(parseObject(p1));\r\n\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\tcase TConst(c):\r\n\t\t\t\tif( allowJSON ) {\r\n\t\t\t\t\tswitch( c ) {\r\n\t\t\t\t\tcase CString(_):\r\n\t\t\t\t\t\tvar tk2 = token();\r\n\t\t\t\t\t\tpush(tk2);\r\n\t\t\t\t\t\tpush(tk);\r\n\t\t\t\t\t\tswitch( tk2 ) {\r\n\t\t\t\t\t\tcase TDoubleDot:\r\n\t\t\t\t\t\t\treturn parseExprNext(parseObject(p1));\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tpush(tk);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else\r\n\t\t\t\t\tpush(tk);\r\n\t\t\tdefault:\r\n\t\t\t\tpush(tk);\r\n\t\t\t}\r\n\t\t\tvar a = new Array();\r\n\t\t\twhile( true ) {\r\n\t\t\t\ta.push(parseFullExpr());\r\n\t\t\t\ttk = token();\r\n\t\t\t\tif( tk == TBrClose )\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tpush(tk);\r\n\t\t\t}\r\n\t\t\treturn mk(EBlock(a),p1);\r\n\t\tcase TOp(op):\r\n\t\t\tif( unops.exists(op) )\r\n\t\t\t\treturn makeUnop(op,parseExpr());\r\n\t\t\treturn unexpected(tk);\r\n\t\tcase TBkOpen:\r\n\t\t\tvar a = new Array();\r\n\t\t\ttk = token();\r\n\t\t\twhile( tk != TBkClose ) {\r\n\t\t\t\tpush(tk);\r\n\t\t\t\ta.push(parseExpr());\r\n\t\t\t\ttk = token();\r\n\t\t\t\tif( tk == TComma )\r\n\t\t\t\t\ttk = token();\r\n\t\t\t}\r\n\t\t\tif( a.length == 1 )\r\n\t\t\t\tswitch( expr(a[0]) ) {\r\n\t\t\t\tcase EFor(_), EWhile(_):\r\n\t\t\t\t\tvar tmp = \"__a_\" + (uid++);\r\n\t\t\t\t\tvar e = mk(EBlock([\r\n\t\t\t\t\t\tmk(EVar(tmp, null, mk(EArrayDecl([]), p1)), p1),\r\n\t\t\t\t\t\tmapCompr(tmp, a[0]),\r\n\t\t\t\t\t\tmk(EIdent(tmp),p1),\r\n\t\t\t\t\t]),p1);\r\n\t\t\t\t\treturn parseExprNext(e);\r\n\t\t\t\tdefault:\r\n\t\t\t\t}\r\n\t\t\treturn parseExprNext(mk(EArrayDecl(a),p1));\r\n\t\tdefault:\r\n\t\t\treturn unexpected(tk);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction mapCompr( tmp : String, e : Expr ) {\r\n\t\tvar edef = switch( expr(e) ) {\r\n\t\tcase EFor(v, it, e2):\r\n\t\t\tEFor(v, it, mapCompr(tmp, e2));\r\n\t\tcase EWhile(cond, e2):\r\n\t\t\tEWhile(cond, mapCompr(tmp, e2));\r\n\t\tcase EIf(cond, e1, e2) if( e2 == null ):\r\n\t\t\tEIf(cond, mapCompr(tmp, e1), null);\r\n\t\tcase EBlock([e]):\r\n\t\t\tEBlock([mapCompr(tmp, e)]);\r\n\t\tcase EParent(e2):\r\n\t\t\tEParent(mapCompr(tmp, e2));\r\n\t\tdefault:\r\n\t\t\tECall( mk(EField(mk(EIdent(tmp), pmin(e), pmax(e)), \"push\"), pmin(e), pmax(e)), [e]);\r\n\t\t}\r\n\t\treturn mk(edef, pmin(e), pmax(e));\r\n\t}\r\n\r\n\tfunction makeUnop( op, e ) {\r\n\t\treturn switch( expr(e) ) {\r\n\t\tcase EBinop(bop, e1, e2): mk(EBinop(bop, makeUnop(op, e1), e2), pmin(e1), pmax(e2));\r\n\t\tcase ETernary(e1, e2, e3): mk(ETernary(makeUnop(op, e1), e2, e3), pmin(e1), pmax(e3));\r\n\t\tdefault: mk(EUnop(op,true,e),pmin(e),pmax(e));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction makeBinop( op, e1, e ) {\r\n\t\treturn switch( expr(e) ) {\r\n\t\tcase EBinop(op2,e2,e3):\r\n\t\t\tif( opPriority.get(op) <= opPriority.get(op2) && !opRightAssoc.exists(op) )\r\n\t\t\t\tmk(EBinop(op2,makeBinop(op,e1,e2),e3),pmin(e1),pmax(e3));\r\n\t\t\telse\r\n\t\t\t\tmk(EBinop(op, e1, e), pmin(e1), pmax(e));\r\n\t\tcase ETernary(e2,e3,e4):\r\n\t\t\tif( opRightAssoc.exists(op) )\r\n\t\t\t\tmk(EBinop(op,e1,e),pmin(e1),pmax(e));\r\n\t\t\telse\r\n\t\t\t\tmk(ETernary(makeBinop(op, e1, e2), e3, e4), pmin(e1), pmax(e));\r\n\t\tdefault:\r\n\t\t\tmk(EBinop(op,e1,e),pmin(e1),pmax(e));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction parseStructure(id) {\r\n\t\t#if hscriptPos\r\n\t\tvar p1 = tokenMin;\r\n\t\t#end\r\n\t\treturn switch( id ) {\r\n\t\tcase \"if\":\r\n\t\t\tvar cond = parseExpr();\r\n\t\t\tvar e1 = parseExpr();\r\n\t\t\tvar e2 = null;\r\n\t\t\tvar semic = false;\r\n\t\t\tvar tk = token();\r\n\t\t\tif( tk == TSemicolon ) {\r\n\t\t\t\tsemic = true;\r\n\t\t\t\ttk = token();\r\n\t\t\t}\r\n\t\t\tif( Type.enumEq(tk,TId(\"else\")) )\r\n\t\t\t\te2 = parseExpr();\r\n\t\t\telse {\r\n\t\t\t\tpush(tk);\r\n\t\t\t\tif( semic ) push(TSemicolon);\r\n\t\t\t}\r\n\t\t\tmk(EIf(cond,e1,e2),p1,(e2 == null) ? tokenMax : pmax(e2));\r\n\t\tcase \"var\":\r\n\t\t\tvar tk = token();\r\n\t\t\tvar ident = null;\r\n\t\t\tswitch(tk) {\r\n\t\t\tcase TId(id): ident = id;\r\n\t\t\tdefault: unexpected(tk);\r\n\t\t\t}\r\n\t\t\ttk = token();\r\n\t\t\tvar t = null;\r\n\t\t\tif( tk == TDoubleDot && allowTypes ) {\r\n\t\t\t\tt = parseType();\r\n\t\t\t\ttk = token();\r\n\t\t\t}\r\n\t\t\tvar e = null;\r\n\t\t\tif( Type.enumEq(tk,TOp(\"=\")) )\r\n\t\t\t\te = parseExpr();\r\n\t\t\telse\r\n\t\t\t\tpush(tk);\r\n\t\t\tmk(EVar(ident,t,e),p1,(e == null) ? tokenMax : pmax(e));\r\n\t\tcase \"while\":\r\n\t\t\tvar econd = parseExpr();\r\n\t\t\tvar e = parseExpr();\r\n\t\t\tmk(EWhile(econd,e),p1,pmax(e));\r\n\t\tcase \"for\":\r\n\t\t\tensure(TPOpen);\r\n\t\t\tvar tk = token();\r\n\t\t\tvar vname = null;\r\n\t\t\tswitch( tk ) {\r\n\t\t\tcase TId(id): vname = id;\r\n\t\t\tdefault: unexpected(tk);\r\n\t\t\t}\r\n\t\t\ttk = token();\r\n\t\t\tif( !Type.enumEq(tk,TId(\"in\")) ) unexpected(tk);\r\n\t\t\tvar eiter = parseExpr();\r\n\t\t\tensure(TPClose);\r\n\t\t\tvar e = parseExpr();\r\n\t\t\tmk(EFor(vname,eiter,e),p1,pmax(e));\r\n\t\tcase \"break\": mk(EBreak);\r\n\t\tcase \"continue\": mk(EContinue);\r\n\t\tcase \"else\": unexpected(TId(id));\r\n\t\tcase \"function\":\r\n\t\t\tvar tk = token();\r\n\t\t\tvar name = null;\r\n\t\t\tswitch( tk ) {\r\n\t\t\tcase TId(id): name = id;\r\n\t\t\tdefault: push(tk);\r\n\t\t\t}\r\n\t\t\tensure(TPOpen);\r\n\t\t\tvar args = new Array();\r\n\t\t\ttk = token();\r\n\t\t\tif( tk != TPClose ) {\r\n\t\t\t\tvar done = false;\r\n\t\t\t\twhile( !done ) {\r\n\t\t\t\t\tvar name = null, opt = false;\r\n\t\t\t\t\tswitch( tk ) {\r\n\t\t\t\t\tcase TQuestion:\r\n\t\t\t\t\t\topt = true;\r\n\t\t\t\t\t\ttk = token();\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t}\r\n\t\t\t\t\tswitch( tk ) {\r\n\t\t\t\t\tcase TId(id): name = id;\r\n\t\t\t\t\tdefault: unexpected(tk);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttk = token();\r\n\t\t\t\t\tvar arg : Argument = { name : name };\r\n\t\t\t\t\targs.push(arg);\r\n\t\t\t\t\tif( opt ) arg.opt = true;\r\n\t\t\t\t\tif( tk == TDoubleDot && allowTypes ) {\r\n\t\t\t\t\t\targ.t = parseType();\r\n\t\t\t\t\t\ttk = token();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tswitch( tk ) {\r\n\t\t\t\t\tcase TComma:\r\n\t\t\t\t\t\ttk = token();\r\n\t\t\t\t\tcase TPClose:\r\n\t\t\t\t\t\tdone = true;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tunexpected(tk);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar ret = null;\r\n\t\t\tif( allowTypes ) {\r\n\t\t\t\ttk = token();\r\n\t\t\t\tif( tk != TDoubleDot )\r\n\t\t\t\t\tpush(tk);\r\n\t\t\t\telse\r\n\t\t\t\t\tret = parseType();\r\n\t\t\t}\r\n\t\t\tvar body = parseExpr();\r\n\t\t\tmk(EFunction(args, body, name, ret),p1,pmax(body));\r\n\t\tcase \"return\":\r\n\t\t\tvar tk = token();\r\n\t\t\tpush(tk);\r\n\t\t\tvar e = if( tk == TSemicolon ) null else parseExpr();\r\n\t\t\tmk(EReturn(e),p1,if( e == null ) tokenMax else pmax(e));\r\n\t\tcase \"new\":\r\n\t\t\tvar a = new Array();\r\n\t\t\tvar tk = token();\r\n\t\t\tswitch( tk ) {\r\n\t\t\tcase TId(id): a.push(id);\r\n\t\t\tdefault: unexpected(tk);\r\n\t\t\t}\r\n\t\t\tvar next = true;\r\n\t\t\twhile( next ) {\r\n\t\t\t\ttk = token();\r\n\t\t\t\tswitch( tk ) {\r\n\t\t\t\tcase TDot:\r\n\t\t\t\t\ttk = token();\r\n\t\t\t\t\tswitch(tk) {\r\n\t\t\t\t\tcase TId(id): a.push(id);\r\n\t\t\t\t\tdefault: unexpected(tk);\r\n\t\t\t\t\t}\r\n\t\t\t\tcase TPOpen:\r\n\t\t\t\t\tnext = false;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tunexpected(tk);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar args = parseExprList(TPClose);\r\n\t\t\tmk(ENew(a.join(\".\"),args),p1);\r\n\t\tcase \"throw\":\r\n\t\t\tvar e = parseExpr();\r\n\t\t\tmk(EThrow(e),p1,pmax(e));\r\n\t\tcase \"try\":\r\n\t\t\tvar e = parseExpr();\r\n\t\t\tvar tk = token();\r\n\t\t\tif( !Type.enumEq(tk, TId(\"catch\")) ) unexpected(tk);\r\n\t\t\tensure(TPOpen);\r\n\t\t\ttk = token();\r\n\t\t\tvar vname = switch( tk ) {\r\n\t\t\tcase TId(id): id;\r\n\t\t\tdefault: unexpected(tk);\r\n\t\t\t}\r\n\t\t\tensure(TDoubleDot);\r\n\t\t\tvar t = null;\r\n\t\t\tif( allowTypes )\r\n\t\t\t\tt = parseType();\r\n\t\t\telse {\r\n\t\t\t\ttk = token();\r\n\t\t\t\tif( !Type.enumEq(tk, TId(\"Dynamic\")) ) unexpected(tk);\r\n\t\t\t}\r\n\t\t\tensure(TPClose);\r\n\t\t\tvar ec = parseExpr();\r\n\t\t\tmk(ETry(e, vname, t, ec), p1, pmax(ec));\r\n\t\tcase \"switch\":\r\n\t\t\tvar e = parseExpr();\r\n\t\t\tvar def = null, cases = [];\r\n\t\t\tensure(TBrOpen);\r\n\t\t\twhile( true ) {\r\n\t\t\t\tvar tk = token();\r\n\t\t\t\tswitch( tk ) {\r\n\t\t\t\tcase TId(\"case\"):\r\n\t\t\t\t\tvar c = { values : [], expr : null };\r\n\t\t\t\t\tcases.push(c);\r\n\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\tvar e = parseExpr();\r\n\t\t\t\t\t\tc.values.push(e);\r\n\t\t\t\t\t\ttk = token();\r\n\t\t\t\t\t\tswitch( tk ) {\r\n\t\t\t\t\t\tcase TComma:\r\n\t\t\t\t\t\t\t// next expr\r\n\t\t\t\t\t\tcase TDoubleDot:\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tunexpected(tk);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar exprs = [];\r\n\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\ttk = token();\r\n\t\t\t\t\t\tpush(tk);\r\n\t\t\t\t\t\tswitch( tk ) {\r\n\t\t\t\t\t\tcase TId(\"case\"), TId(\"default\"), TBrClose:\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\texprs.push(parseFullExpr());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tc.expr = if( exprs.length == 1)\r\n\t\t\t\t\t\texprs[0];\r\n\t\t\t\t\telse if( exprs.length == 0 )\r\n\t\t\t\t\t\tmk(EBlock([]), tokenMin, tokenMin);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tmk(EBlock(exprs), pmin(exprs[0]), pmax(exprs[exprs.length - 1]));\r\n\t\t\t\tcase TId(\"default\"):\r\n\t\t\t\t\tif( def != null ) unexpected(tk);\r\n\t\t\t\t\tensure(TDoubleDot);\r\n\t\t\t\t\tvar exprs = [];\r\n\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\ttk = token();\r\n\t\t\t\t\t\tpush(tk);\r\n\t\t\t\t\t\tswitch( tk ) {\r\n\t\t\t\t\t\tcase TId(\"case\"), TId(\"default\"), TBrClose:\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\texprs.push(parseFullExpr());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdef = if( exprs.length == 1)\r\n\t\t\t\t\t\texprs[0];\r\n\t\t\t\t\telse if( exprs.length == 0 )\r\n\t\t\t\t\t\tmk(EBlock([]), tokenMin, tokenMin);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tmk(EBlock(exprs), pmin(exprs[0]), pmax(exprs[exprs.length - 1]));\r\n\t\t\t\tcase TBrClose:\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tunexpected(tk);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tmk(ESwitch(e, cases, def), p1, tokenMax);\r\n\t\tdefault:\r\n\t\t\tnull;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction parseExprNext( e1 : Expr ) {\r\n\t\tvar tk = token();\r\n\t\tswitch( tk ) {\r\n\t\tcase TOp(op):\r\n\t\t\tif( unops.get(op) ) {\r\n\t\t\t\tif( isBlock(e1) || switch(expr(e1)) { case EParent(_): true; default: false; } ) {\r\n\t\t\t\t\tpush(tk);\r\n\t\t\t\t\treturn e1;\r\n\t\t\t\t}\r\n\t\t\t\treturn parseExprNext(mk(EUnop(op,false,e1),pmin(e1)));\r\n\t\t\t}\r\n\t\t\treturn makeBinop(op,e1,parseExpr());\r\n\t\tcase TDot:\r\n\t\t\ttk = token();\r\n\t\t\tvar field = null;\r\n\t\t\tswitch(tk) {\r\n\t\t\tcase TId(id): field = id;\r\n\t\t\tdefault: unexpected(tk);\r\n\t\t\t}\r\n\t\t\treturn parseExprNext(mk(EField(e1,field),pmin(e1)));\r\n\t\tcase TPOpen:\r\n\t\t\treturn parseExprNext(mk(ECall(e1,parseExprList(TPClose)),pmin(e1)));\r\n\t\tcase TBkOpen:\r\n\t\t\tvar e2 = parseExpr();\r\n\t\t\tensure(TBkClose);\r\n\t\t\treturn parseExprNext(mk(EArray(e1,e2),pmin(e1)));\r\n\t\tcase TQuestion:\r\n\t\t\tvar e2 = parseExpr();\r\n\t\t\tensure(TDoubleDot);\r\n\t\t\tvar e3 = parseExpr();\r\n\t\t\treturn mk(ETernary(e1,e2,e3),pmin(e1),pmax(e3));\r\n\t\tdefault:\r\n\t\t\tpush(tk);\r\n\t\t\treturn e1;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction parseType() : CType {\r\n\t\tvar t = token();\r\n\t\tswitch( t ) {\r\n\t\tcase TId(v):\r\n\t\t\tvar path = [v];\r\n\t\t\twhile( true ) {\r\n\t\t\t\tt = token();\r\n\t\t\t\tif( t != TDot )\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tt = token();\r\n\t\t\t\tswitch( t ) {\r\n\t\t\t\tcase TId(v):\r\n\t\t\t\t\tpath.push(v);\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tunexpected(t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar params = null;\r\n\t\t\tswitch( t ) {\r\n\t\t\tcase TOp(op):\r\n\t\t\t\tif( op == \"<\" ) {\r\n\t\t\t\t\tparams = [];\r\n\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\tparams.push(parseType());\r\n\t\t\t\t\t\tt = token();\r\n\t\t\t\t\t\tswitch( t ) {\r\n\t\t\t\t\t\tcase TComma: continue;\r\n\t\t\t\t\t\tcase TOp(op): if( op ==\t\">\" ) break;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tunexpected(t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\tdefault:\r\n\t\t\t\tpush(t);\r\n\t\t\t}\r\n\t\t\treturn parseTypeNext(CTPath(path, params));\r\n\t\tcase TPOpen:\r\n\t\t\tvar t = parseType();\r\n\t\t\tensure(TPClose);\r\n\t\t\treturn parseTypeNext(CTParent(t));\r\n\t\tcase TBrOpen:\r\n\t\t\tvar fields = [];\r\n\t\t\twhile( true ) {\r\n\t\t\t\tt = token();\r\n\t\t\t\tswitch( t ) {\r\n\t\t\t\tcase TBrClose: break;\r\n\t\t\t\tcase TId(name):\r\n\t\t\t\t\tensure(TDoubleDot);\r\n\t\t\t\t\tfields.push( { name : name, t : parseType() } );\r\n\t\t\t\t\tt = token();\r\n\t\t\t\t\tswitch( t ) {\r\n\t\t\t\t\tcase TComma:\r\n\t\t\t\t\tcase TBrClose: break;\r\n\t\t\t\t\tdefault: unexpected(t);\r\n\t\t\t\t\t}\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tunexpected(t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn parseTypeNext(CTAnon(fields));\r\n\t\tdefault:\r\n\t\t\treturn unexpected(t);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction parseTypeNext( t : CType ) {\r\n\t\tvar tk = token();\r\n\t\tswitch( tk ) {\r\n\t\tcase TOp(op):\r\n\t\t\tif( op != \"->\" ) {\r\n\t\t\t\tpush(tk);\r\n\t\t\t\treturn t;\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\tpush(tk);\r\n\t\t\treturn t;\r\n\t\t}\r\n\t\tvar t2 = parseType();\r\n\t\tswitch( t2 ) {\r\n\t\tcase CTFun(args, _):\r\n\t\t\targs.unshift(t);\r\n\t\t\treturn t2;\r\n\t\tdefault:\r\n\t\t\treturn CTFun([t], t2);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction parseExprList( etk ) {\r\n\t\tvar args = new Array();\r\n\t\tvar tk = token();\r\n\t\tif( tk == etk )\r\n\t\t\treturn args;\r\n\t\tpush(tk);\r\n\t\twhile( true ) {\r\n\t\t\targs.push(parseExpr());\r\n\t\t\ttk = token();\r\n\t\t\tswitch( tk ) {\r\n\t\t\tcase TComma:\r\n\t\t\tdefault:\r\n\t\t\t\tif( tk == etk ) break;\r\n\t\t\t\tunexpected(tk);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn args;\r\n\t}\r\n\r\n\tinline function incPos() {\r\n\t\t#if hscriptPos\r\n\t\treadPos++;\r\n\t\t#end\r\n\t}\r\n\r\n\tfunction readChar() {\r\n\t\tincPos();\r\n\t\treturn try input.readByte() catch( e : Dynamic ) 0;\r\n\t}\r\n\r\n\tfunction readString( until ) {\r\n\t\tvar c = 0;\r\n\t\tvar b = new haxe.io.BytesOutput();\r\n\t\tvar esc = false;\r\n\t\tvar old = line;\r\n\t\tvar s = input;\r\n\t\t#if hscriptPos\r\n\t\tvar p1 = readPos - 1;\r\n\t\t#end\r\n\t\twhile( true ) {\r\n\t\t\ttry {\r\n\t\t\t\tincPos();\r\n\t\t\t\tc = s.readByte();\r\n\t\t\t} catch( e : Dynamic ) {\r\n\t\t\t\tline = old;\r\n\t\t\t\terror(EUnterminatedString, p1, p1);\r\n\t\t\t}\r\n\t\t\tif( esc ) {\r\n\t\t\t\tesc = false;\r\n\t\t\t\tswitch( c ) {\r\n\t\t\t\tcase 'n'.code: b.writeByte(10);\r\n\t\t\t\tcase 'r'.code: b.writeByte(13);\r\n\t\t\t\tcase 't'.code: b.writeByte(9);\r\n\t\t\t\tcase \"'\".code, '\"'.code, '\\\\'.code: b.writeByte(c);\r\n\t\t\t\tcase '/'.code: if( allowJSON ) b.writeByte(c) else invalidChar(c);\r\n\t\t\t\tcase \"u\".code:\r\n\t\t\t\t\tif( !allowJSON ) throw invalidChar(c);\r\n\t\t\t\t\tvar code = null;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tincPos();\r\n\t\t\t\t\t\tincPos();\r\n\t\t\t\t\t\tincPos();\r\n\t\t\t\t\t\tincPos();\r\n\t\t\t\t\t\tcode = s.readString(4);\r\n\t\t\t\t\t} catch( e : Dynamic ) {\r\n\t\t\t\t\t\tline = old;\r\n\t\t\t\t\t\terror(EUnterminatedString, p1, p1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar k = 0;\r\n\t\t\t\t\tfor( i in 0...4 ) {\r\n\t\t\t\t\t\tk <<= 4;\r\n\t\t\t\t\t\tvar char = code.charCodeAt(i);\r\n\t\t\t\t\t\tswitch( char ) {\r\n\t\t\t\t\t\tcase 48,49,50,51,52,53,54,55,56,57: // 0-9\r\n\t\t\t\t\t\t\tk += char - 48;\r\n\t\t\t\t\t\tcase 65,66,67,68,69,70: // A-F\r\n\t\t\t\t\t\t\tk += char - 55;\r\n\t\t\t\t\t\tcase 97,98,99,100,101,102: // a-f\r\n\t\t\t\t\t\t\tk += char - 87;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tinvalidChar(char);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// encode k in UTF8\r\n\t\t\t\t\tif( k <= 0x7F )\r\n\t\t\t\t\t\tb.writeByte(k);\r\n\t\t\t\t\telse if( k <= 0x7FF ) {\r\n\t\t\t\t\t\tb.writeByte( 0xC0 | (k >> 6));\r\n\t\t\t\t\t\tb.writeByte( 0x80 | (k & 63));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tb.writeByte( 0xE0 | (k >> 12) );\r\n\t\t\t\t\t\tb.writeByte( 0x80 | ((k >> 6) & 63) );\r\n\t\t\t\t\t\tb.writeByte( 0x80 | (k & 63) );\r\n\t\t\t\t\t}\r\n\t\t\t\tdefault: invalidChar(c);\r\n\t\t\t\t}\r\n\t\t\t} else if( c == 92 )\r\n\t\t\t\tesc = true;\r\n\t\t\telse if( c == until )\r\n\t\t\t\tbreak;\r\n\t\t\telse {\r\n\t\t\t\tif( c == 10 ) line++;\r\n\t\t\t\tb.writeByte(c);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn b.getBytes().toString();\r\n\t}\r\n\r\n\tfunction token() {\r\n\t\t#if hscriptPos\r\n\t\tvar t = tokens.pop();\r\n\t\tif( t != null ) {\r\n\t\t\ttokenMin = t.min;\r\n\t\t\ttokenMax = t.max;\r\n\t\t\treturn t.t;\r\n\t\t}\r\n\t\toldTokenMin = tokenMin;\r\n\t\toldTokenMax = tokenMax;\r\n\t\ttokenMin = (this.char < 0) ? readPos : readPos - 1;\r\n\t\tvar t = _token();\r\n\t\ttokenMax = (this.char < 0) ? readPos - 1 : readPos - 2;\r\n\t\treturn t;\r\n\t}\r\n\r\n\tfunction _token() {\r\n\t\t#else\r\n\t\tif( !tokens.isEmpty() )\r\n\t\t\treturn tokens.pop();\r\n\t\t#end\r\n\t\tvar char;\r\n\t\tif( this.char < 0 )\r\n\t\t\tchar = readChar();\r\n\t\telse {\r\n\t\t\tchar = this.char;\r\n\t\t\tthis.char = -1;\r\n\t\t}\r\n\t\twhile( true ) {\r\n\t\t\tswitch( char ) {\r\n\t\t\tcase 0: return TEof;\r\n\t\t\tcase 32,9,13: // space, tab, CR\r\n\t\t\t\t#if hscriptPos\r\n\t\t\t\ttokenMin++;\r\n\t\t\t\t#end\r\n\t\t\tcase 10: line++; // LF\r\n\t\t\t\t#if hscriptPos\r\n\t\t\t\ttokenMin++;\r\n\t\t\t\t#end\r\n\t\t\tcase 48,49,50,51,52,53,54,55,56,57: // 0...9\r\n\t\t\t\tvar n = (char - 48) * 1.0;\r\n\t\t\t\tvar exp = 0.;\r\n\t\t\t\twhile( true ) {\r\n\t\t\t\t\tchar = readChar();\r\n\t\t\t\t\texp *= 10;\r\n\t\t\t\t\tswitch( char ) {\r\n\t\t\t\t\tcase 48,49,50,51,52,53,54,55,56,57:\r\n\t\t\t\t\t\tn = n * 10 + (char - 48);\r\n\t\t\t\t\tcase 46:\r\n\t\t\t\t\t\tif( exp > 0 ) {\r\n\t\t\t\t\t\t\t// in case of '...'\r\n\t\t\t\t\t\t\tif( exp == 10 && readChar() == 46 ) {\r\n\t\t\t\t\t\t\t\tpush(TOp(\"...\"));\r\n\t\t\t\t\t\t\t\tvar i = Std.int(n);\r\n\t\t\t\t\t\t\t\treturn TConst( (i == n) ? CInt(i) : CFloat(n) );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tinvalidChar(char);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\texp = 1.;\r\n\t\t\t\t\tcase 120: // x\r\n\t\t\t\t\t\tif( n > 0 || exp > 0 )\r\n\t\t\t\t\t\t\tinvalidChar(char);\r\n\t\t\t\t\t\t// read hexa\r\n\t\t\t\t\t\t#if haxe3\r\n\t\t\t\t\t\tvar n = 0;\r\n\t\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\t\tchar = readChar();\r\n\t\t\t\t\t\t\tswitch( char ) {\r\n\t\t\t\t\t\t\tcase 48,49,50,51,52,53,54,55,56,57: // 0-9\r\n\t\t\t\t\t\t\t\tn = (n << 4) + char - 48;\r\n\t\t\t\t\t\t\tcase 65,66,67,68,69,70: // A-F\r\n\t\t\t\t\t\t\t\tn = (n << 4) + (char - 55);\r\n\t\t\t\t\t\t\tcase 97,98,99,100,101,102: // a-f\r\n\t\t\t\t\t\t\t\tn = (n << 4) + (char - 87);\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tthis.char = char;\r\n\t\t\t\t\t\t\t\treturn TConst(CInt(n));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t#else\r\n\t\t\t\t\t\tvar n = haxe.Int32.ofInt(0);\r\n\t\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\t\tchar = readChar();\r\n\t\t\t\t\t\t\tswitch( char ) {\r\n\t\t\t\t\t\t\tcase 48,49,50,51,52,53,54,55,56,57: // 0-9\r\n\t\t\t\t\t\t\t\tn = haxe.Int32.add(haxe.Int32.shl(n,4), cast (char - 48));\r\n\t\t\t\t\t\t\tcase 65,66,67,68,69,70: // A-F\r\n\t\t\t\t\t\t\t\tn = haxe.Int32.add(haxe.Int32.shl(n,4), cast (char - 55));\r\n\t\t\t\t\t\t\tcase 97,98,99,100,101,102: // a-f\r\n\t\t\t\t\t\t\t\tn = haxe.Int32.add(haxe.Int32.shl(n,4), cast (char - 87));\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tthis.char = char;\r\n\t\t\t\t\t\t\t\t// we allow to parse hexadecimal Int32 in Neko, but when the value will be\r\n\t\t\t\t\t\t\t\t// evaluated by Interpreter, a failure will occur if no Int32 operation is\r\n\t\t\t\t\t\t\t\t// performed\r\n\t\t\t\t\t\t\t\tvar v = try CInt(haxe.Int32.toInt(n)) catch( e : Dynamic ) CInt32(n);\r\n\t\t\t\t\t\t\t\treturn TConst(v);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t#end\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthis.char = char;\r\n\t\t\t\t\t\tvar i = Std.int(n);\r\n\t\t\t\t\t\treturn TConst( (exp > 0) ? CFloat(n * 10 / exp) : ((i == n) ? CInt(i) : CFloat(n)) );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\tcase 59: return TSemicolon;\r\n\t\t\tcase 40: return TPOpen;\r\n\t\t\tcase 41: return TPClose;\r\n\t\t\tcase 44: return TComma;\r\n\t\t\tcase 46:\r\n\t\t\t\tchar = readChar();\r\n\t\t\t\tswitch( char ) {\r\n\t\t\t\tcase 48,49,50,51,52,53,54,55,56,57:\r\n\t\t\t\t\tvar n = char - 48;\r\n\t\t\t\t\tvar exp = 1;\r\n\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\tchar = readChar();\r\n\t\t\t\t\t\texp *= 10;\r\n\t\t\t\t\t\tswitch( char ) {\r\n\t\t\t\t\t\tcase 48,49,50,51,52,53,54,55,56,57:\r\n\t\t\t\t\t\t\tn = n * 10 + (char - 48);\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tthis.char = char;\r\n\t\t\t\t\t\t\treturn TConst( CFloat(n/exp) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\tcase 46:\r\n\t\t\t\t\tchar = readChar();\r\n\t\t\t\t\tif( char != 46 )\r\n\t\t\t\t\t\tinvalidChar(char);\r\n\t\t\t\t\treturn TOp(\"...\");\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis.char = char;\r\n\t\t\t\t\treturn TDot;\r\n\t\t\t\t}\r\n\t\t\tcase 123: return TBrOpen;\r\n\t\t\tcase 125: return TBrClose;\r\n\t\t\tcase 91: return TBkOpen;\r\n\t\t\tcase 93: return TBkClose;\r\n\t\t\tcase 39: return TConst( CString(readString(39)) );\r\n\t\t\tcase 34: return TConst( CString(readString(34)) );\r\n\t\t\tcase 63: return TQuestion;\r\n\t\t\tcase 58: return TDoubleDot;\r\n\t\t\tdefault:\r\n\t\t\t\tif( ops[char] ) {\r\n\t\t\t\t\tvar op = String.fromCharCode(char);\r\n\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\tchar = readChar();\r\n\t\t\t\t\t\tif( !ops[char] ) {\r\n\t\t\t\t\t\t\tif( op.charCodeAt(0) == 47 )\r\n\t\t\t\t\t\t\t\treturn tokenComment(op,char);\r\n\t\t\t\t\t\t\tthis.char = char;\r\n\t\t\t\t\t\t\treturn TOp(op);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\top += String.fromCharCode(char);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif( idents[char] ) {\r\n\t\t\t\t\tvar id = String.fromCharCode(char);\r\n\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\tchar = readChar();\r\n\t\t\t\t\t\tif( !idents[char] ) {\r\n\t\t\t\t\t\t\tthis.char = char;\r\n\t\t\t\t\t\t\treturn TId(id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tid += String.fromCharCode(char);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tinvalidChar(char);\r\n\t\t\t}\r\n\t\t\tchar = readChar();\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction tokenComment( op : String, char : Int ) {\r\n\t\tvar c = op.charCodeAt(1);\r\n\t\tvar s = input;\r\n\t\tif( c == 47 ) { // comment\r\n\t\t\ttry {\r\n\t\t\t\twhile( char != 10 && char != 13 ) {\r\n\t\t\t\t\tincPos();\r\n\t\t\t\t\tchar = s.readByte();\r\n\t\t\t\t}\r\n\t\t\t\tthis.char = char;\r\n\t\t\t} catch( e : Dynamic ) {\r\n\t\t\t}\r\n\t\t\treturn token();\r\n\t\t}\r\n\t\tif( c == 42 ) { /* comment */\r\n\t\t\tvar old = line;\r\n\t\t\ttry {\r\n\t\t\t\twhile( true ) {\r\n\t\t\t\t\twhile( char != 42 ) {\r\n\t\t\t\t\t\tif( char == 10 ) line++;\r\n\t\t\t\t\t\tincPos();\r\n\t\t\t\t\t\tchar = s.readByte();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tincPos();\r\n\t\t\t\t\tchar = s.readByte();\r\n\t\t\t\t\tif( char == 47 )\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} catch( e : Dynamic ) {\r\n\t\t\t\tline = old;\r\n\t\t\t\terror(EUnterminatedComment, tokenMin, tokenMin);\r\n\t\t\t}\r\n\t\t\treturn token();\r\n\t\t}\r\n\t\tthis.char = char;\r\n\t\treturn TOp(op);\r\n\t}\r\n\r\n\tfunction constString( c ) {\r\n\t\treturn switch(c) {\r\n\t\tcase CInt(v): Std.string(v);\r\n\t\tcase CFloat(f): Std.string(f);\r\n\t\tcase CString(s): s; // TODO : escape + quote\r\n\t\t#if !haxe3\r\n\t\tcase CInt32(v): Std.string(v);\r\n\t\t#end\r\n\t\t}\r\n\t}\r\n\r\n\tfunction tokenString( t ) {\r\n\t\treturn switch( t ) {\r\n\t\tcase TEof: \"<eof>\";\r\n\t\tcase TConst(c): constString(c);\r\n\t\tcase TId(s): s;\r\n\t\tcase TOp(s): s;\r\n\t\tcase TPOpen: \"(\";\r\n\t\tcase TPClose: \")\";\r\n\t\tcase TBrOpen: \"{\";\r\n\t\tcase TBrClose: \"}\";\r\n\t\tcase TDot: \".\";\r\n\t\tcase TComma: \",\";\r\n\t\tcase TSemicolon: \";\";\r\n\t\tcase TBkOpen: \"[\";\r\n\t\tcase TBkClose: \"]\";\r\n\t\tcase TQuestion: \"?\";\r\n\t\tcase TDoubleDot: \":\";\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage js;\n\nclass Boot {\n\n\tprivate static function __unhtml(s : String) {\n\t\treturn s.split(\"&\").join(\"&amp;\").split(\"<\").join(\"&lt;\").split(\">\").join(\"&gt;\");\n\t}\n\n\tprivate static function __trace(v,i : haxe.PosInfos) {\n\t\tuntyped {\n\t\t\tvar msg = if( i != null ) i.fileName+\":\"+i.lineNumber+\": \" else \"\";\n\t\t\t#if jsfl\n\t\t\tmsg += __string_rec(v,\"\");\n\t\t\tfl.trace(msg);\n\t\t\t#else\n\t\t\tmsg += __string_rec(v, \"\");\n\t\t\tif( i != null && i.customParams != null )\n\t\t\t\tfor( v in i.customParams )\n\t\t\t\t\tmsg += \",\" + __string_rec(v, \"\");\n\t\t\tvar d;\n\t\t\tif( __js__(\"typeof\")(document) != \"undefined\" && (d = document.getElementById(\"haxe:trace\")) != null )\n\t\t\t\td.innerHTML += __unhtml(msg)+\"<br/>\";\n\t\t\telse if( __js__(\"typeof console\") != \"undefined\" && __js__(\"console\").log != null )\n\t\t\t\t__js__(\"console\").log(msg);\n\t\t\t#end\n\t\t}\n\t}\n\n\tprivate static function __clear_trace() {\n\t\tuntyped {\n\t\t\t#if jsfl\n\t\t\tfl.outputPanel.clear();\n\t\t\t#else\n\t\t\tvar d = document.getElementById(\"haxe:trace\");\n\t\t\tif( d != null )\n\t\t\t\td.innerHTML = \"\";\n\t\t\t#end\n\t\t}\n\t}\n\n\tstatic inline function isClass(o:Dynamic) : Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isClass\", o.__name__);\n\t}\n\n\tstatic inline function isEnum(e:Dynamic) : Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isEnum\", e.__ename__);\n\t}\n\n\tstatic inline function getClass(o:Dynamic) : Dynamic {\n\t\tif (Std.is(o, Array))\n\t\t\treturn Array;\n\t\telse\n\t\t\treturn untyped __define_feature__(\"js.Boot.getClass\", o.__class__);\n\t}\n\n\t@:ifFeature(\"may_print_enum\")\n\tprivate static function __string_rec(o,s:String) {\n\t\tuntyped {\n\t\t\tif( o == null )\n\t\t\t    return \"null\";\n\t\t\tif( s.length >= 5 )\n\t\t\t\treturn \"<...>\"; // too much deep recursion\n\t\t\tvar t = __js__(\"typeof(o)\");\n\t\t\tif( t == \"function\" && (isClass(o) || isEnum(o)) )\n\t\t\t\tt = \"object\";\n\t\t\tswitch( t ) {\n\t\t\tcase \"object\":\n\t\t\t\tif( __js__(\"o instanceof Array\") ) {\n\t\t\t\t\tif( o.__enum__ ) {\n\t\t\t\t\t\tif( o.length == 2 )\n\t\t\t\t\t\t\treturn o[0];\n\t\t\t\t\t\tvar str = o[0]+\"(\";\n\t\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\t\tfor( i in 2...o.length ) {\n\t\t\t\t\t\t\tif( i != 2 )\n\t\t\t\t\t\t\t\tstr += \",\" + __string_rec(o[i],s);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tstr += __string_rec(o[i],s);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn str + \")\";\n\t\t\t\t\t}\n\t\t\t\t\tvar l = o.length;\n\t\t\t\t\tvar i;\n\t\t\t\t\tvar str = \"[\";\n\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\tfor( i in 0...l )\n\t\t\t\t\t\tstr += (if (i > 0) \",\" else \"\")+__string_rec(o[i],s);\n\t\t\t\t\tstr += \"]\";\n\t\t\t\t\treturn str;\n\t\t\t\t}\n\t\t\t\tvar tostr;\n\t\t\t\ttry {\n\t\t\t\t\ttostr = untyped o.toString;\n\t\t\t\t} catch( e : Dynamic ) {\n\t\t\t\t\t// strange error on IE\n\t\t\t\t\treturn \"???\";\n\t\t\t\t}\n\t\t\t\tif( tostr != null && tostr != __js__(\"Object.toString\") ) {\n\t\t\t\t\tvar s2 = o.toString();\n\t\t\t\t\tif( s2 != \"[object Object]\")\n\t\t\t\t\t\treturn s2;\n\t\t\t\t}\n\t\t\t\tvar k : String = null;\n\t\t\t\tvar str = \"{\\n\";\n\t\t\t\ts += \"\\t\";\n\t\t\t\tvar hasp = (o.hasOwnProperty != null);\n\t\t\t\t__js__(\"for( var k in o ) {\");\n\t\t\t\t\tif( hasp && !o.hasOwnProperty(k) )\n\t\t\t\t\t\t__js__(\"continue\");\n\t\t\t\t\tif( k == \"prototype\" || k == \"__class__\" || k == \"__super__\" || k == \"__interfaces__\" || k == \"__properties__\" )\n\t\t\t\t\t\t__js__(\"continue\");\n\t\t\t\t\tif( str.length != 2 )\n\t\t\t\t\t\tstr += \", \\n\";\n\t\t\t\t\tstr += s + k + \" : \"+__string_rec(o[k],s);\n\t\t\t\t__js__(\"}\");\n\t\t\t\ts = s.substring(1);\n\t\t\t\tstr += \"\\n\" + s + \"}\";\n\t\t\t\treturn str;\n\t\t\tcase \"function\":\n\t\t\t\treturn \"<function>\";\n\t\t\tcase \"string\":\n\t\t\t\treturn o;\n\t\t\tdefault:\n\t\t\t\treturn String(o);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static function __interfLoop(cc : Dynamic,cl : Dynamic) {\n\t\tif( cc == null )\n\t\t\treturn false;\n\t\tif( cc == cl )\n\t\t\treturn true;\n\t\tvar intf : Dynamic = cc.__interfaces__;\n\t\tif( intf != null )\n\t\t\tfor( i in 0...intf.length ) {\n\t\t\t\tvar i : Dynamic = intf[i];\n\t\t\t\tif( i == cl || __interfLoop(i,cl) )\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\treturn __interfLoop(cc.__super__,cl);\n\t}\n\n\t@:ifFeature(\"typed_catch\") private static function __instanceof(o : Dynamic,cl : Dynamic) {\n\t\tif( cl == null )\n\t\t\treturn false;\n\t\tswitch( cl ) {\n\t\tcase Int:\n\t\t\treturn (untyped __js__(\"(o|0) === o\"));\n\t\tcase Float:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"number\";\n\t\tcase Bool:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"boolean\";\n\t\tcase String:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"string\";\n\t\tcase Array:\n\t\t\treturn (untyped __js__(\"(o instanceof Array)\")) && o.__enum__ == null;\n\t\tcase Dynamic:\n\t\t\treturn true;\n\t\tdefault:\n\t\t\tif( o != null ) {\n\t\t\t\t// Check if o is an instance of a Haxe class\n\t\t\t\tif( (untyped __js__(\"typeof\"))(cl) == \"function\" ) {\n\t\t\t\t\tif( untyped __js__(\"o instanceof cl\") ) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tif( __interfLoop(getClass(o),cl) )\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// do not use isClass/isEnum here\n\t\t\tuntyped __feature__(\"Class.*\",if( cl == Class && o.__name__ != null ) return true);\n\t\t\tuntyped __feature__(\"Enum.*\",if( cl == Enum && o.__ename__ != null ) return true);\n\t\t\treturn o.__enum__ == cl;\n\t\t}\n\t}\n\n\t@:ifFeature(\"typed_cast\") private static function __cast(o : Dynamic, t : Dynamic) {\n\t\tif (__instanceof(o, t)) return o;\n\t\telse throw \"Cannot cast \" +Std.string(o) + \" to \" +Std.string(t);\n\t}\n\n}\n","/*\n * Copyright (C)2005-2014 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n// This file is generated, do not edit!\npackage js.html;\n\n/** DOM&nbsp;canvas elements expose the <code><a class=\"external\" href=\"http://www.w3.org/TR/html5/the-canvas-element.html#htmlcanvaselement\" rel=\"external nofollow\" target=\"_blank\" title=\"http://www.w3.org/TR/html5/the-canvas-element.html#htmlcanvaselement\">HTMLCanvasElement</a></code> interface, which provides properties and methods for manipulating the layout and presentation of canvas elements. The <code>HTMLCanvasElement</code> interface inherits the properties and methods of the <code><a rel=\"custom\" href=\"/api/js/html/Element\">element</a></code>\n object interface.<br><br>\nDocumentation for this class was provided by <a href=\"https://developer.mozilla.org/en/DOM/HTMLCanvasElement\">MDN</a>. */\n@:native(\"HTMLCanvasElement\")\nextern class CanvasElement extends Element\n{\n\t/** Reflects the \n\n<code><a rel=\"custom\" href=\"https://developer.mozilla.org/en/HTML/Element/canvas#attr-height\">height</a></code>\n HTML attribute, specifying the height of the coordinate space in CSS pixels. */\n\tvar height : Int;\n\n\t/** Reflects the \n\n<code><a rel=\"custom\" href=\"https://developer.mozilla.org/en/HTML/Element/canvas#attr-width\">width</a></code>\n HTML attribute, specifying the width of the coordinate space in CSS pixels. */\n\tvar width : Int;\n\n\tfunction getContext( contextId : String ) : Dynamic;\n\n\tfunction toDataURL( ?type : String ) : String;\n\n\t/** A typed shortcut for <code>getContext(\"2d\")</code>. */\n\tpublic inline function getContext2d() : CanvasRenderingContext2D { return cast getContext(\"2d\"); }\n\n\tpublic inline function getContextWebGL( ?attribs :js.html.webgl.ContextAttributes ) :js.html.webgl.RenderingContext {\n\t\treturn CanvasUtil.getContextWebGL(this, attribs);\n\t}\n}\n\nprivate class CanvasUtil {\n\tpublic static function getContextWebGL( canvas :CanvasElement, attribs :Dynamic ) {\n\t\tfor (name in [\"webgl\", \"experimental-webgl\"]) {\n\t\t\tvar ctx = (untyped canvas).getContext(name, attribs);\n\t\t\tif (ctx != null) return ctx;\n\t\t}\n\t\treturn null;\n\t}\n}","package spriter.definitions;\nimport haxe.xml.Fast;\nimport spriter.definitions.TimelineKey.CurveType;\n\n/**\n * ...\n * @author Loudo\n */\nenum CurveType\n{\n\tINSTANT;\n\tLINEAR;\n\tQUADRATIC;\n\tCUBIC;\n}\n \nclass TimelineKey\n{\n\tpublic var id:Int;\n\tpublic var time:Int = 0;\n    public var curveType:CurveType; // enum : INSTANT,LINEAR,QUADRATIC,CUBIC\n    public var  c1:Float; \n    public var  c2:Float; \n\t\n\tpublic function new(fast:Fast = null) \n\t{\n\t\tif(fast != null){\n\t\t\tid = fast.has.id ? Std.parseInt(fast.att.id) : 0;\n\t\t\ttime = fast.has.time ? Std.parseInt(fast.att.time) : 0;\n\t\t\tcurveType = fast.has.curve_type ? Type.createEnum(CurveType, fast.att.curve_type.toUpperCase()) : CurveType.LINEAR;\n\t\t\tc1 = fast.has.c1 ? Std.parseFloat(fast.att.c1) : 0;\n\t\t\tc2 = fast.has.c2 ? Std.parseFloat(fast.att.c2) : 0;\n\t\t}\n\t}\n\t\n\tpublic function copy ():TimelineKey\n\t{\n\t\tvar\tcopy:TimelineKey = new TimelineKey();\n\t\treturn clone (copy);\n\t}\n\n\tpublic function clone (clone:TimelineKey):TimelineKey\n\t{\n\t\tclone.id = id;\n\t\tclone.time = time;\n\t\tclone.curveType = curveType;\n\t\tclone.c1 = c1;\n\t\tclone.c2 = c2;\n\t\treturn clone;\n\t}\n\t\n\tpublic function interpolate(nextKey:TimelineKey, nextKeyTime:Int, currentTime:Float):Void\n    {\n        linearKey(nextKey, getTWithNextKey(nextKey, nextKeyTime, currentTime));\n    }           \n\n    public function getTWithNextKey(nextKey:TimelineKey, nextKeyTime:Int, currentTime:Float):Float\n    {\n        if(curveType == INSTANT || time == nextKey.time)\n        {\n            return 0;\n        }\n        \n        var t:Float = (currentTime - time) / (nextKey.time - time);\n\n        if(curveType == LINEAR)\n        {\n            return t;        \n        }\n        else if(curveType == QUADRATIC)\n        {\n            return(quadratic(0.0,c1,1.0,t));\n        }\n        else if(curveType == CUBIC)\n        {  \n            return(cubic(0.0,c1,c2,1.0,t));\n        }\n    \n        return 0; // Runtime should never reach here        \n    }\t\n\n    public function linear(a:Float, b:Float, t:Float):Float\n    {\n\t\treturn ((b-a)*t)+a;\n    }\n\tpublic function linearKey (keyB:TimelineKey, t:Float):Void\n\t{\n\t\t// overridden in inherited types  return linear(this,keyB,t);\n\t\ttrace(\"Has to be overriden\");\n\t\treturn null;\n\t}\n\n\tpublic function angleLinear(angleA:Float, angleB:Float, spin:Int, t:Float):Float\n\t{\n\t\tif(spin == 0)\n\t\t{\n\t\t\treturn angleA;\n\t\t}\n\t\tif(spin > 0)\n\t\t{\n\t\t\tif((angleB-angleA) < 0)\n\t\t\t{\n\t\t\t\tangleB += 360;\n\t\t\t}\n\t\t}\n\t\telse if(spin < 0)\n\t\t{\n\t\t\tif((angleB-angleA) > 0)\n\t\t\t{    \n\t\t\t\tangleB -= 360;\n\t\t\t}\n\t\t}\n\n\t\treturn linear(angleA,angleB,t);\n\t}\n\n\tpublic function  quadratic(a:Float, b:Float, c:Float, t:Float):Float\n\t{\n\t\treturn linear(linear(a,b,t),linear(b,c,t),t);\n\t}\n\n\tpublic function  cubic(a:Float, b:Float, c:Float, d:Float, t:Float):Float\n\t{\n\t\treturn linear(quadratic(a,b,c,t),quadratic(b,c,d,t),t);\n\t}\n}","package spriter.definitions;\nimport haxe.xml.Fast;\nimport spriter.util.SpriterUtil;\n\n/**\n * ...\n * @author Loudo\n */\nclass SpatialTimelineKey extends TimelineKey\n{\n\tpublic var info:SpatialInfo;\n\n\t\n\tpublic function new(fast:Fast = null) \n\t{\n\t\tsuper(fast);\n\t\t\n\t\tif(fast != null){\n\t\t\tvar spin = fast.has.spin ? Std.parseInt(fast.att.spin) : 1;\n\t\t\t\n\t\t\tif (fast.hasNode.object){\n\t\t\t\tfast = fast.node.object;\n\t\t\t}else {\n\t\t\t\tfast = fast.node.bone;\n\t\t\t}\n\t\t\t\n\t\t\tvar x = fast.has.x ? Std.parseFloat(fast.att.x) : 0;\n\t\t\tvar y = fast.has.y ? Std.parseFloat(fast.att.y) : 0;\n\t\t\tvar angle = fast.has.angle ? Std.parseFloat(fast.att.angle) : 0;\n\t\t\tvar scale_x = fast.has.scale_x ? Std.parseFloat(fast.att.scale_x) : 1;\n\t\t\tvar scale_y = fast.has.scale_y ? Std.parseFloat(fast.att.scale_y) : 1;\n\t\t\tvar alpha = fast.has.a ? Std.parseFloat(fast.att.a) : 1;\n\t\t\t\n\t\t\tinfo = new SpatialInfo(x, y, angle, scale_x, scale_y, alpha, spin);\n\t\t}\n\t}\n\t\n\toverride public function copy ():TimelineKey\n\t{\n\t\tvar\tcopy:TimelineKey = new SpatialTimelineKey();\n\t\treturn clone (copy);\n\t}\n\n\toverride public function clone (clone:TimelineKey):TimelineKey\n\t{\n\t\tsuper.clone(clone);\n\n\t\tvar\tc:SpatialTimelineKey = cast clone;\n\t\tc.info = info.copy();\n\t\treturn c;\n\t}\n\t\n\t/**\n\t * SCML Ref : function written in SpatialInfo\n\t * @param\tinfoA\n\t * @param\tinfoB\n\t * @param\tspin\n\t * @param\tt\n\t * @return\n\t */\n\tpublic\tfunction linearSpatialInfo (infoA:SpatialInfo, infoB:SpatialInfo, spin:Int, t:Float):Void\n\t{\n\t\tinfo.x = linear (infoA.x, infoB.x, t); \n\t\tinfo.y = linear (infoA.y, infoB.y, t);  \n\t\tinfo.angle = angleLinear (infoA.angle, infoB.angle, spin, t); \n\t\tinfo.scaleX = linear (infoA.scaleX, infoB.scaleX, t); \n\t\tinfo.scaleY = linear (infoA.scaleY, infoB.scaleY, t); \n\t\tinfo.a = linear (infoA.a, infoB.a, t);\n\t}\n\t\n\tpublic function paint(pivotX:Float, pivotY:Float):PivotInfo\n\t{\n\t\treturn new PivotInfo(pivotX,pivotY);\n\t}\n\t\n}","package spriter.definitions;\nimport haxe.xml.Fast;\n\n/**\n * ...\n * @author Loudo\n */\nclass BoneTimelineKey extends SpatialTimelineKey\n{\n\t// unimplemented in Spriter\n    public var length:Int;\n    public var width:Int;\n\tpublic var paintDebugBones:Bool;\n\t\n\tpublic function new(fast:Fast=null) \n\t{\n\t\tpaintDebugBones = true;\n\t\t\n\t\tif(fast != null){\n\t\t\tlength = fast.has.length ? Std.parseInt(fast.att.length) : 200;\n\t\t\twidth = fast.has.width ? Std.parseInt(fast.att.width) : 10;\n\t\t}\n\t\t\n\t\tsuper(fast);\n\t}\n\t\n\toverride public function copy ():TimelineKey\n\t{\n\t\tvar\tcopy:TimelineKey = new BoneTimelineKey();\n\t\treturn clone (copy);\n\t}\n\n\toverride public function clone (clone:TimelineKey):TimelineKey\n\t{\n\t\tsuper.clone(clone);\n\t\t\n\t\tvar\tc:BoneTimelineKey = cast clone;\n\t\t\n\t\tc.length = length;\n\t\tc.width = width;\n\t\tc.paintDebugBones = paintDebugBones;\n\t\t\n\t\treturn c;\n\t}\n\t\n\toverride public function paint(pivotX:Float, pivotY:Float):PivotInfo\n    {\n        if(paintDebugBones)\n        {\n            var drawLength:Float = length * info.scaleX;\n           //var drawHeight:Float = info.height*info.scaleY;\n            var drawHeight:Float = width * info.scaleY;\n            // paint debug bone representation \n            // e.g. line starting at x,y,at angle, \n            // of length drawLength, and height drawHeight\n\t\t\t\n         }\n\t\t return new PivotInfo(pivotX, pivotY);\n    }           \n\n    override public function linearKey(keyB:TimelineKey,t:Float):Void\n    {\n\t\tif (!Std.is(keyB, BoneTimelineKey))\n\t\t\tthrow \"keyB must be BoneTimelineKeys\";\n\t\t\t\n        var keyBBone:BoneTimelineKey = cast(keyB, BoneTimelineKey);\n        linearSpatialInfo(info, keyBBone.info, info.spin, t);\n\n        if(paintDebugBones)\n        {\n            length\t= Std.int(linear(length,keyBBone.length,t));\n            width\t= Std.int(linear(width, keyBBone.width, t));\n        }\n    }\n}","package spriter.definitions;\nimport haxe.xml.Fast;\n\n/**\n * ...\n * @author Loudo\n */\nclass CharacterMap\n{\n\tpublic var id:Int;\n\tpublic var name:String;\n    public var maps:Array<MapInstruction>;\n\t\n\tpublic function new(fast:Fast) \n\t{\n\t\tmaps = new Array<MapInstruction>();\n\t\t\n\t\tid = Std.parseInt(fast.att.id);\n\t\tname = fast.att.name;\n\t\t\n\t\tfor (m in fast.nodes.map)\n\t\t{\n\t\t\tmaps.push(new MapInstruction(m));\n\t\t}\n\t}\n\t\n}","package spriter.definitions;\nimport haxe.xml.Fast;\n\n/**\n * ...\n * @author Loudo\n */\nclass MainlineKey\n{\n\tpublic var id:Int;\n\tpublic var time:Int;\n    public var boneRefs:Array<Ref>; // <bone_ref> tags\n    public var objectRefs:Array<Ref>; // <object_ref> tags \n\t\n\tpublic function new(fast:Fast) \n\t{\n\t\tboneRefs = new Array<Ref>();\n\t\tobjectRefs = new Array<Ref>();\n\t\t\n\t\tid = Std.parseInt(fast.att.id);\n\t\ttime = fast.has.time ? Std.parseInt(fast.att.time) : 0;\n\t\t\n\t\tfor (br in fast.nodes.bone_ref)\n\t\t{\n\t\t\tboneRefs.push(new Ref(br));\n\t\t}\n\t\t\n\t\tfor (or in fast.nodes.object_ref)\n\t\t{\n\t\t\tobjectRefs.push(new Ref(or));\n\t\t}\n\t}\n\t\n}","package spriter.definitions;\nimport haxe.xml.Fast;\n\n/**\n * ...\n * @author Loudo\n */\nclass MapInstruction\n{\n\tpublic var folder:Int;\n    public var file:Int;\n    public var tarFolder:Int;\n    public var tarFile:Int;\n\t\n\tpublic function new(fast:Fast) \n\t{\n\t\tfolder = Std.parseInt(fast.att.folder);\n\t\tfile = Std.parseInt(fast.att.file);\n\t\ttarFolder = fast.has.target_folder ? Std.parseInt(fast.att.target_folder) : -1;\n\t\ttarFile = fast.has.target_file ? Std.parseInt(fast.att.target_file) : -1;\n\t}\n\t\n}","package spriter.definitions;\nimport haxe.xml.Fast;\nimport spriter.definitions.SpriterTimeline.ObjectType;\n\n/**\n * ...\n * @author Loudo\n */\nclass ObjectTimelineKey extends SpatialTimelineKey\n{\n    public var useDefaultPivot:Bool; // true if missing pivot_x and pivot_y in object tag\n    public var pivot_x:Float;\n    public var pivot_y:Float;\n\tpublic var type:ObjectType;\n\t\n\tpublic function new(fast:Fast = null, ?objectType:ObjectType) \n\t{\n\t\tsuper(fast);\n\t\t\n\t\tif(fast != null){\n\t\t\t\n\t\t\ttype = objectType;\n\t\t\t\n\t\t\tfast = fast.node.object;\n\t\t\t\n\t\t\tuseDefaultPivot = (!fast.has.pivot_x && !fast.has.pivot_y);\n\t\t\tpivot_x = fast.has.pivot_x ? Std.parseFloat(fast.att.pivot_x) : 0;\n\t\t\tpivot_y = fast.has.pivot_y ? Std.parseFloat(fast.att.pivot_y) : 1;\n\t\t\t\n\t\t}\n\t}\n\t\n\toverride public function copy ():TimelineKey\n\t{\n\t\tvar\tcopy:TimelineKey = new ObjectTimelineKey();\n\t\treturn clone (copy);\n\t}\n\n\toverride public function clone (clone:TimelineKey):TimelineKey\n\t{\n\t\tsuper.clone(clone);\n\n\t\tvar\tc:ObjectTimelineKey = cast clone;\n\t\t\n\t\tc.useDefaultPivot = useDefaultPivot;\n\t\tc.pivot_x = pivot_x;\n\t\tc.pivot_y = pivot_y;\n\t\tc.type = type;\n\t\treturn c;\n\t}\n\t\n\toverride public function paint(pivotX:Float, pivotY:Float):PivotInfo\n    {\n        var paintPivotX:Float;\n        var paintPivotY:Float;\n        if(useDefaultPivot)\n        {\n            paintPivotX = pivotX;\n            paintPivotY = pivotY;\n        }\n        else\n        {\n            paintPivotX = pivot_x;\n            paintPivotY = pivot_y;\n        }\n\t\t\n\t\treturn new PivotInfo(paintPivotX , paintPivotY);\n    }\n\n    override public function linearKey(keyB:TimelineKey, t:Float):Void\n    // keyB must be ObjectTimelineKey\n    {\n\t\tif (!Std.is(keyB, ObjectTimelineKey))\n\t\t\tthrow \"keyB must be ObjectTimelineKey\";\n\t\t\t\n        var keyBSprite:ObjectTimelineKey = cast(keyB, ObjectTimelineKey);\n\t\t\n        linearSpatialInfo(info, keyBSprite.info, info.spin, t);\n\n         if(!useDefaultPivot)\n        {\n            pivot_x = linear(pivot_x,keyBSprite.pivot_x,t);\n            pivot_y = linear(pivot_y,keyBSprite.pivot_y,t);\n        }\n    }\n}","package spriter.definitions;\n\n/**\n * ...\n * @author Loudo\n */\nclass PivotInfo\n{\n\tpublic var pivotX:Float; \n    public var pivotY:Float; \n\t\n\tpublic function new(pivotX:Float = 0, pivotY:Float = 1) \n\t{\n\t\tthis.pivotX = pivotX;\n\t\tthis.pivotY = pivotY;\n\t}\n\t\n}","package spriter.definitions;\n// import openfl.geom.Point;\n\n/**\n * ...\n * @author Loudo\n */\nclass Quadrilateral\n{\n\tpublic var p1:QuadPoint;\n\tpublic var p2:QuadPoint;\n\tpublic var p3:QuadPoint;\n\tpublic var p4:QuadPoint;\n\n\tpublic function new(p1:QuadPoint, p2:QuadPoint, p3:QuadPoint, p4:QuadPoint) \n\t{\n\t\tthis.p1 = p1;\n\t\tthis.p2 = p2;\n\t\tthis.p3 = p3;\n\t\tthis.p4 = p4;\n\t}\n}\n\nclass QuadPoint {\n\t\n\t/** The x position. */\n\tpublic var x :Float;\n\t/** The y position */\n\tpublic var y :Float;\n\n\tpublic function new(?x :Float = 0, ?y :Float = 0):Void\n\t{\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n}","package spriter.definitions;\nimport haxe.xml.Fast;\n\n/**\n * ...\n * @author Loudo\n */\nclass Ref\n{\n\tpublic var id : Int;\n\tpublic var parent:Int; // -1==no parent - uses ScmlObject spatialInfo as parentInfo\n    public var timeline:Int;\n    public var key:Int;  \n\t\n\tpublic function new(fast:Fast) \n\t{\n\t\tid = Std.parseInt(fast.att.id);\n\t\tparent = fast.has.parent ? Std.parseInt(fast.att.parent) : -1;\n\t\ttimeline = Std.parseInt(fast.att.timeline);\n\t\tkey = Std.parseInt(fast.att.key);\n\t}\n\t\n}","package spriter.definitions;\n\nimport haxe.xml.Fast;\nimport spriter.interfaces.IScml;\nimport spriter.library.AbstractLibrary;\nimport spriter.vars.Variable;\n\n/**\n * ...\n * @author Loudo\n */\nenum MetaDispatch\n{\n\tONCE;\n\tONCE_PER_LOOP;\n\tALWAYS;\n}\nclass ScmlObject implements IScml\n{\n\n\tpublic var folders:Array<SpriterFolder>;\n\tpublic var activeCharacterMap:Array<SpriterFolder>;\n\tpublic var entities:Map<String, SpriterEntity>;\n\tpublic var tags:Array<String>;\n\n    public var currentEntity:String \t= \"\"; \n    public var currentAnimation:String  = \"\"; \n\n    public var currentTime:Float; \n\t\n\tpublic var spriterName:String;\n\t\n\tpublic var spriterSpatialInfo:SpatialInfo;\n\t\n\t/**\n\t * Callback called at the end of the anim\n\t */\n\tpublic var endAnimCallback:Void->Void;\n\t/**\n\t * Auto Remove the callback at the end of the anim\n\t */\n\tpublic var endAnimRemoval:Bool = true;\n\t/**\n\t * Callback called when variable value changes\n\t */\n\tpublic var varChangeCallback:Variable<Dynamic>->Void;\n\t/**\n\t * Callback called when tag dispatched\n\t */\n\tpublic var tagCallback:String->Void;\n\tpublic var metaDispatch:MetaDispatch = ONCE_PER_LOOP;\n\t\t\n\tpublic function new(source:Xml = null) \n\t{\n\t\tif(source != null){\n\t\t\tfolders = new Array<SpriterFolder>();\n\t\t\tentities = new Map<String,SpriterEntity>();\n\t\t\t\n\t\t\tvar fast = new Fast(source.firstElement());\n\t\t\t\n\t\t\tif (fast.att.scml_version != \"1.0\")\n\t\t\t\ttrace(\"Warning, unsupported format.\");\n\t\t\t\n\t\t\tfor(el in fast.elements)\n\t\t\t{\n\t\t\t\tif(el.name == \"folder\")\n\t\t\t\t{\n\t\t\t\t\tfolders.push(new SpriterFolder(el));\n\t\t\t\t}\n\t\t\t\telse if(el.name == \"entity\")\n\t\t\t\t{\n\t\t\t\t\tentities.set(el.att.name, new SpriterEntity(el));\n\t\t\t\t\tif (el.att.id == \"0\") {\n\t\t\t\t\t\tcurrentEntity = el.att.name;\n\t\t\t\t\t\tcurrentAnimation = el.node.animation.att.name;\n\t\t\t\t\t}\n\t\t\t\t}else if (el.name == \"tag_list\")\n\t\t\t\t{\n\t\t\t\t\tif (tags == null)\n\t\t\t\t\t\ttags = [];\n\t\t\t\t\tfor (t in el.elements)\n\t\t\t\t\t{\n\t\t\t\t\t\ttags.push(t.att.name);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tactiveCharacterMap = copyFolders();\n\t\t}\n\t}\n\t//interface IScml begin\n\tpublic function getPivots(folder:Int, file:Int):PivotInfo\n\t{\n\t\tvar currentFile:SpriterFile = activeCharacterMap[folder].files[file];\n\t\tif(currentFile != null){\n\t\t\treturn new PivotInfo(currentFile.pivotX, currentFile.pivotY);\n\t\t}else {\n\t\t\treturn new PivotInfo();\n\t\t}\n\t}\n\tpublic function getFileName(folder:Int, file:Int):String\n\t{\n\t\tvar currentFile:SpriterFile = activeCharacterMap[folder].files[file];\n\t\tif(currentFile != null){\n\t\t\treturn currentFile.name;\n\t\t}else {\n\t\t\treturn null;\n\t\t}\n\t}\n\tpublic function onEndAnim():Void\n\t{\n\t\tif (endAnimCallback != null) {\n\t\t\tvar tempCallback:Void->Void = endAnimCallback;\n\t\t\tif (endAnimRemoval)\n\t\t\t\tendAnimCallback = null;\n\t\t\ttempCallback();\n\t\t}\n\t}\n\tpublic function onTag(tag:Int):Void\n\t{\n\t\tif (tagCallback != null) {\n\t\t\ttagCallback(tags[tag]);\n\t\t}\n\t}\n\tpublic function onVar(id:Int, value:String):Void\n\t{\n\t\tvar variable:Variable<Dynamic> = entities[currentEntity].variables[id];\n\t\t//callback only if var changes\n\t\tif (variable.set(value))\n\t\t{\n\t\t\tif (varChangeCallback != null) {\n\t\t\t\tvarChangeCallback(variable);\n\t\t\t}\n\t\t}\n\t}\n\t//interface IScml end\n    public function setCurrentTime(newTime:Int, library:AbstractLibrary, characterInfo:SpatialInfo):Void\n    {\n        var currentEnt:SpriterEntity \t\t=\tentities.get(currentEntity);\n\t\tvar currentAnim:SpriterAnimation\t=\tcurrentEnt.animations.get(currentAnimation);\n\t\tspriterSpatialInfo = characterInfo;\n\t\tcurrentAnim.setCurrentTime(newTime, library, this, currentEnt);\n    }\t\t\n\n    public function applyCharacterMap(name:String, reset:Bool):Bool\n    {\n\t\tif(reset)\n\t\t{\n\t\t\tactiveCharacterMap = copyFolders();\n\t\t}\n\t\t\n\t\tvar\tentity:SpriterEntity = entities.get(currentEntity);\n\t\t\n\t\tif (entity.characterMaps.exists(name)) {\n\t\t\t\n\t\t\tvar charMap:CharacterMap = entity.characterMaps.get(name);\n\t\t\t\n\t\t\tvar len:Int = charMap.maps.length;\n\t\t\tfor(m in 0...len)\n\t\t\t{\n\t\t\t\tvar currentMap:MapInstruction = charMap.maps[m];\n\t\t\t\tif(currentMap.tarFolder > -1 && currentMap.tarFile > -1)\n\t\t\t\t{\n\t\t\t\t\tvar targetFolder:SpriterFolder\t=\tactiveCharacterMap[currentMap.tarFolder];\n\t\t\t\t\tvar targetFile:SpriterFile\t\t=\ttargetFolder.files[currentMap.tarFile];\n\t\t\t\t\tactiveCharacterMap[currentMap.folder].files[currentMap.file]\t=\ttargetFile;\n\t\t\t\t}else {\n\t\t\t\t\tactiveCharacterMap[currentMap.folder].files[currentMap.file]\t=\tnull;//hidden\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}else {\n\t\t\treturn false;\n\t\t}\n    }\n\t/**\n\t * Get the names of all entities in the scml file\n\t */\n\tpublic function getEntitiesName():Array<String>\n\t{\n\t\tvar returnEntities:Array<String> = [];\n\t\tfor (key in entities.keys())\n\t\t{\n\t\t\treturnEntities.push(key);\n\t\t}\n\t\treturn returnEntities;\n\t}\n\t/**\n\t * Get the names of all animations in the scml file\n\t * @param\tentity you have to speficy an entity where we can search the animations.\n\t */\n\tpublic function getAnimationsName(entity:String):Array<String>\n\t{\n\t\tif (entities.exists(entity)) {\n\t\t\tvar entity:SpriterEntity = entities.get(entity);\n\t\t\tvar returnAnimations:Array<String> = [];\n\t\t\tfor (key in entity.animations.keys())\n\t\t\t{\n\t\t\t\treturnAnimations.push(key);\n\t\t\t}\n\t\t\treturn returnAnimations;\n\t\t}\n\t\treturn null;\n\t}\n\t/**\n\t * Get the names of all character mapping in the scml file\n\t * @param\tentity you have to speficy an entity where we can search the character mapping.\n\t */\n\tpublic function getCharMaps(entity:String):Array<String>\n\t{\n\t\tif (entities.exists(entity)) {\n\t\t\tvar entity:SpriterEntity = entities.get(entity);\n\t\t\tvar returnCharMaps:Array<String> = [];\n\t\t\tfor (key in entity.characterMaps.keys())\n\t\t\t{\n\t\t\t\treturnCharMaps.push(key);\n\t\t\t}\n\t\t\treturn returnCharMaps;\n\t\t}\n\t\treturn null;\n\t}\n\t\n\tprivate function copyFolders():Array<SpriterFolder>\n\t{\n\t\tvar newFolders = new Array<SpriterFolder>();\n\t\tfor (i in 0...folders.length)\n\t\t{\n\t\t\tnewFolders[i] = folders[i].copy();\n\t\t}\n\t\treturn newFolders;\n\t}\n\t\n\tpublic function copy():ScmlObject\n\t{\n\t\tvar newSCML:ScmlObject = new ScmlObject();\n\t\tnewSCML.folders = copyFolders();\n\t\tnewSCML.activeCharacterMap = copyFolders();\n\t\tnewSCML.entities = entities;//TODO copy ?\n\t\tnewSCML.tags = tags;\n\t\t\n\t\tnewSCML.currentEntity \t= Std.string(currentEntity); \n\t\tnewSCML.currentAnimation  = Std.string(currentAnimation); \n\t\tnewSCML.currentTime = 0; \n\t\treturn newSCML;\n\t}\n\t\n\tpublic function destroy():Void\n\t{\n\t\tfolders = null;\n\t\tactiveCharacterMap = null;\n\t\tentities = null;\n\t\ttags = null;\n\t}\n}","package spriter.definitions;\nimport spriter.util.SpriterUtil;\n\n/**\n * ...\n * @author Loudo\n */\nclass SpatialInfo\n{\n\tpublic var x:Float=0; \n    public var y:Float=0; \n    public var angle:Float=0;\n    public var scaleX:Float=1; \n    public var scaleY:Float=1; \n\t/**\n\t * Alpha\n\t */\n    public var a:Float=1;\n    public var spin:Int=1;\n\t\n\tpublic function new(x:Float = 0, y:Float = 0, angle:Float = 0, scaleX:Float = 1, scaleY:Float = 1, a:Float = 1, spin:Int = 1) \n\t{\n\t\tthis.x = x; \n\t\tthis.y = y; \n\t\tthis.angle = angle;\n\t\tthis.scaleX = scaleX; \n\t\tthis.scaleY = scaleY; \n\t\tthis.a = a;\n\t\tthis.spin = spin;\n\t}\n\t\n\tpublic function unmapFromParent(parentInfo:SpatialInfo):SpatialInfo\n    {\n        var unmapped_x : Float;\n\t\tvar unmapped_y : Float;\n\t\tvar unmapped_angle = angle + parentInfo.angle;\n\t\tvar unmapped_scaleX = scaleX * parentInfo.scaleX;\n\t\tvar unmapped_scaleY = scaleY * parentInfo.scaleY;\n\t\tvar unmapped_alpha = a * parentInfo.a;\n\t\t\n\t\tif (x != 0 || y != 0)\n\t\t{\n\t\t\tvar preMultX = x * parentInfo.scaleX;\n\t\t\tvar preMultY = y * parentInfo.scaleY;\n\t\t\tvar parentRad = SpriterUtil.toRadians(SpriterUtil.under360(parentInfo.angle));\n\t\t\tvar s = Math.sin(parentRad);\n\t\t\tvar c = Math.cos(parentRad);\n\t\t\t\n\t\t\tunmapped_x = (preMultX * c) - (preMultY * s) + parentInfo.x;\n\t\t\tunmapped_y = (preMultX * s) + (preMultY * c) + parentInfo.y;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tunmapped_x = parentInfo.x;\n\t\t\tunmapped_y = parentInfo.y;\n\t\t}\n\t\t\n\t\treturn new SpatialInfo(unmapped_x, unmapped_y, unmapped_angle, unmapped_scaleX, unmapped_scaleY, unmapped_alpha, spin);\n    }\n\t\n\tpublic function copy():SpatialInfo\n\t{\n\t\tvar c:SpatialInfo = new SpatialInfo(x, y, angle, scaleX, scaleY, a, spin);\n\t\treturn c;\n\t}\n\t\n\t/*public function linear(infoA:SpatialInfo, infoB:SpatialInfo, spin:Int, t:Float):SpatialInfo\n\t{\n\t\tvar resultInfo:SpatialInfo;\n\t\tresultInfo.x = linear(infoA.x,infoB.x,t); \n\t\tresultInfo.y = linear(infoA.y,infoB.y,t);  \n\t\tresultInfo.angle = angleLinear(infoA.angle,infoB.angle,spin,t); \n\t\tresultInfo.scaleX = linear(infoA.scaleX,infoB.scaleX,t); \n\t\tresultInfo.scaleY = linear(infoA.scaleY,infoB.scaleY,t); \n\t\tresultInfo.a = linear(infoA.a,infoB.a,t); \n\t}*/\n\t\n}","package spriter.definitions;\nimport haxe.xml.Fast;\n\n/**\n * ...\n * @author Loudo\n */\nclass SpriteTimelineKey extends ObjectTimelineKey\n{\n\tpublic var folder:Int; // index of the folder within the ScmlObject\n    public var file:Int;  \n\t\n\tpublic function new(fast:Fast = null) \n\t{\n\t\tsuper(fast);\n\t\t\n\t\tif(fast != null){\n\t\t\n\t\t\tfast = fast.node.object;\n\t\t\t\n\t\t\tfolder = fast.has.folder ? Std.parseInt(fast.att.folder) : 0;\n\t\t\tfile = fast.has.file ? Std.parseInt(fast.att.file) : 0;\n\t\t}\n\t}\n\t\n\toverride public function copy ():TimelineKey\n\t{\n\t\tvar\tcopy:TimelineKey = new SpriteTimelineKey();\n\t\treturn clone (copy);\n\t}\n\n\toverride public function clone (clone:TimelineKey):TimelineKey\n\t{\n\t\tsuper.clone(clone);\n\n\t\tvar\tc:SpriteTimelineKey = cast clone;\n\t\t\n\t\tc.folder = folder;\n\t\tc.file = file;\n\t\tc.useDefaultPivot = useDefaultPivot;\n\t\tc.pivot_x = pivot_x;\n\t\tc.pivot_y = pivot_y;\n\t\treturn c;\n\t}\n}","package spriter.definitions;\nimport haxe.xml.Fast;\nimport spriter.definitions.Quadrilateral;\nimport spriter.definitions.SpriterAnimation.LoopType;\nimport spriter.definitions.SpriterTimeline.ObjectType;\nimport spriter.interfaces.IScml;\nimport spriter.library.AbstractLibrary;\n\n/**\n * ...\n * @author Loudo\n */\nenum LoopType\n{\n    LOOPING;\n    NO_LOOPING;\n}\n \nclass SpriterAnimation\n{\n\t/*\n\t * SCML definitions\n\t */\n\tpublic var id:Int;\n\tpublic var name:String;\n    public var length:Int;\n    public var loopType:LoopType;\n    public var mainlineKeys:Array<MainlineKey>;\n    public var timelines:Array<SpriterTimeline>;\n\tpublic var taglines:Array<TaglineKey>;\n\tpublic var varlines:Array<Varline>;\n\t\n\t/*\n\t * Custom definitions\n\t * \n\t */\n\tvar loop:Int = 0;\n\tpublic var points:Array<SpatialInfo>;\n\tpublic var boxes:Array<Quadrilateral>;\n\t\n\tpublic function new(fast:Fast) \n\t{\n\t\tmainlineKeys = new Array<MainlineKey>();\n\t\ttimelines = new Array<SpriterTimeline>();\n\t\t\n\t\t\n\t\tid = Std.parseInt(fast.att.id);\n\t\tname = fast.att.name;\n\t\tlength = Std.parseInt(fast.att.length);\n\t\t//loopType = fast.has.looping ? Type.createEnum(LoopType, fast.att.looping.toUpperCase()) : LOOPING;\n\t\tif (fast.has.looping) {\n\t\t\tif (fast.att.looping == \"true\") {\n\t\t\t\tloopType = LOOPING;\n\t\t\t}else {\n\t\t\t\tloopType = NO_LOOPING;\n\t\t\t}\n\t\t}else {\n\t\t\tloopType = LOOPING;\n\t\t}\n\t\t\n\t\tfor (mk in fast.node.mainline.nodes.key)\n\t\t{\n\t\t\tmainlineKeys.push(new MainlineKey(mk));\n\t\t}\n\t\t\n\t\tfor (t in fast.nodes.timeline)\n\t\t{\n\t\t\ttimelines.push(new SpriterTimeline(t));\n\t\t}\n\t\tif (fast.hasNode.meta)\n\t\t{\n\t\t\tfast = fast.node.meta;\n\t\t\tif (fast.hasNode.tagline)\n\t\t\t{\n\t\t\t\ttaglines = [];\n\t\t\t\tfor (tag in fast.node.tagline.nodes.key)\n\t\t\t\t{\n\t\t\t\t\ttaglines.push(new TaglineKey(tag));\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (fast.hasNode.varline)\n\t\t\t{\n\t\t\t\tvarlines = [];\n\t\t\t\tfor (currVar in fast.nodes.varline)\n\t\t\t\t{\n\t\t\t\t\tvarlines.push(new Varline(currVar));\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t}\n\t}\n\t\n\tpublic function setCurrentTime(newTime:Int, library:AbstractLibrary, root:IScml, currentEntity:SpriterEntity):Void\n    {\n\t\tvar currentTime:Int;\n\t\tvar tempLoop:Int;\n\t\tswitch(loopType)\n        {\n\t\t\tcase LOOPING:\n\t\t\t\ttempLoop = loop;\n\t\t\t\tloop = Std.int(newTime / length);\n\t\t\t\tcurrentTime = newTime % length;\n\t\t\t\t//update\n\t\t\t\tupdateCharacter(mainlineKeyFromTime(currentTime), currentTime, library, root, currentEntity);\n\t\t\t\tif (root.metaDispatch == ONCE_PER_LOOP && tempLoop != loop) {\n\t\t\t\t\tresetMetaDispatch();\n\t\t\t\t}\n\t\t\t\t//callback only at the first loop and once\n\t\t\t\tif (loop == 1 && tempLoop < 1)\n\t\t\t\t\troot.onEndAnim();\n\t\t\t\t\n\t\t\tcase NO_LOOPING:\n\t\t\t\tcurrentTime = Std.int(Math.min(newTime, length));\n\t\t\t\t//update\n\t\t\t\tupdateCharacter(mainlineKeyFromTime(currentTime), currentTime, library, root, currentEntity);\n\t\t\t\t//callback\n\t\t\t\tif (currentTime == length)\n\t\t\t\t\troot.onEndAnim();\n        }\n    }\n\n    public function updateCharacter(mainKey:MainlineKey, newTime:Int, library:AbstractLibrary, root:IScml, currentEntity:SpriterEntity):Void\n    {\n        var transformedBoneKeys:Array<SpatialInfo> = new Array<SpatialInfo>();\n\t\tvar currentKey:SpatialTimelineKey;\n\t\t\n\t\tvar\tcurrentRef:Ref;\n\t\tvar spatialInfo:SpatialInfo;\n\t\tvar len:Int = mainKey.boneRefs.length;\n        for (b in 0...len)\n        {\n            currentRef = mainKey.boneRefs[b];\n\t\t\tcurrentKey = cast keyFromRef(currentRef, newTime);\n            if (currentRef.parent >= 0)\n\t\t\t{\n                spatialInfo = transformedBoneKeys[currentRef.parent];\n            }\n\t\t\telse \n\t\t\t{\n\t\t\t\tspatialInfo = root.spriterSpatialInfo;\n\t\t\t}\n\n            spatialInfo = currentKey.info.unmapFromParent(spatialInfo);\n            transformedBoneKeys.push(spatialInfo);\n        }\n\n        //var objectKeys:Array<TimelineKey>;\n\t\tpoints = [];\n\t\tboxes = [];\n\t\tlen = mainKey.objectRefs.length;\n        for(o in 0...len)\n        {\n            currentRef = mainKey.objectRefs[o];\n\t\t\tcurrentKey = cast keyFromRef(currentRef,newTime);\n\t\t\t//trace(currentKey.info.a);\n            if(currentRef.parent >= 0)\n            {\n                spatialInfo = transformedBoneKeys[currentRef.parent];\n            }\n            else\n            {\n                spatialInfo = root.spriterSpatialInfo;\n            }\n\t\t\t\n\t\t    //currentKey.info = currentKey.info.unmapFromParent(parentInfo);//TOFIX and remove next line ?\n\t\t\tspatialInfo = currentKey.info.unmapFromParent(spatialInfo);\n\t\t\tvar activePivots:PivotInfo;\n\t\t\tif (Std.is(currentKey, SpriteTimelineKey)) {\n\t\t\t\tvar currentSpriteKey:SpriteTimelineKey = cast(currentKey, SpriteTimelineKey);\n\t\t\t\tactivePivots = root.getPivots(currentSpriteKey.folder, currentSpriteKey.file);\n\t\t\t\tactivePivots = currentKey.paint(activePivots.pivotX, activePivots.pivotY);\n\t\t\t\t//render from library\n\t\t\t\tvar currentKeyName:String = root.getFileName(currentSpriteKey.folder, currentSpriteKey.file);\n\t\t\t\tif (currentKeyName != null) {//hidden object test (via mapping)\n\t\t\t\t\tlibrary.addGraphic(root.spriterName, currentRef.timeline, currentRef.key, currentKeyName, spatialInfo, activePivots);\n\t\t\t\t}\n\t\t\t}else {\n\t\t\t\tactivePivots = new PivotInfo();\n\t\t\t\tactivePivots = currentKey.paint(activePivots.pivotX, activePivots.pivotY);\n\t\t\t\tvar currentObjectKey:ObjectTimelineKey = cast(currentKey, ObjectTimelineKey);\n\t\t\t\t\n\t\t\t\tif (currentObjectKey.type == ObjectType.POINT)\n\t\t\t\t{\n\t\t\t\t\tpoints.push(library.compute(spatialInfo, activePivots,0,0));\n\t\t\t\t}else {//BOX\n\t\t\t\t\tvar currentBox:SpriterBox = currentEntity.boxes_info.get(getTimelineName(currentRef.timeline));\n\t\t\t\t\tboxes.push(library.computeRectCoordinates(spatialInfo, activePivots, currentBox.width, currentBox.height));\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\n            //objectKeys.push(currentKey);\n        }\n\n        //SCML REF : <expose objectKeys to api users to retrieve AND replace objectKeys>\n\t\t//(devnote :I'm not doing that, instead I add directly the element in the library (since libraries compute differently))\n\t\t\n\t\t/*len = objectKeys.length;\n        for(k in 0...len)\n        {            \n            objectKeys[k].paint();\n        }*/\n\t\t\n\t\t//following lines not in scml references yet\n\t\t\n\t\tif(taglines != null){\n\t\t\tfor (tag in taglines) {\n\t\t\t\tif (tag.time == mainKey.time)\n\t\t\t\t{\n\t\t\t\t\tif (root.metaDispatch == ALWAYS)\n\t\t\t\t\t{\n\t\t\t\t\t\troot.onTag(tag.id);\n\t\t\t\t\t}else if (root.metaDispatch == ONCE_PER_LOOP && mainKey.time != tag.lastDispatched) {\n\t\t\t\t\t\ttag.lastDispatched = mainKey.time;\n\t\t\t\t\t\troot.onTag(tag.id);\n\t\t\t\t\t}else if (root.metaDispatch == ONCE && !tag.dispatched) {\n\t\t\t\t\t\ttag.lastDispatched = mainKey.time;\n\t\t\t\t\t\troot.onTag(tag.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (varlines != null)\n\t\t{\n\t\t\tfor (_var in varlines) {\n\t\t\t\tfor (keyVar in _var.keys)\n\t\t\t\t{\n\t\t\t\t\tif (keyVar.time == mainKey.time)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (root.metaDispatch == ALWAYS)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\troot.onVar(_var.id, keyVar.value);\n\t\t\t\t\t\t}else if (root.metaDispatch == ONCE_PER_LOOP && mainKey.time != keyVar.lastDispatched) {\n\t\t\t\t\t\t\tkeyVar.lastDispatched = mainKey.time;\n\t\t\t\t\t\t\troot.onVar(_var.id, keyVar.value);\n\t\t\t\t\t\t}else if (root.metaDispatch == ONCE && !keyVar.dispatched) {\n\t\t\t\t\t\t\tkeyVar.lastDispatched = mainKey.time;\n\t\t\t\t\t\t\troot.onVar(_var.id, keyVar.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n    }\n\n    public function mainlineKeyFromTime(time:Int):MainlineKey\n    {\n        var\tcurrentMainKey:Int = 0;\n\t\tvar len:Int = mainlineKeys.length;\n\t\tfor (m in 0...len)\n\t\t{\n\t\t\tif(mainlineKeys[m].time <= time)\n\t\t\t{\n\t\t\t\tcurrentMainKey = m;\n\t\t\t}\n\t\t\t\n\t\t\tif(mainlineKeys[m].time >= time)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn mainlineKeys[currentMainKey];\n    }\t\n   \n    public function keyFromRef(ref:Ref, newTime:Int):TimelineKey\n    {\n        var timeline:SpriterTimeline = timelines[ref.timeline];\n        var keyA:TimelineKey = timeline.keys[ref.key].copy();\n        \n        if(timeline.keys.length == 1 || keyA.curveType == INSTANT)\n        {\n\t\t\treturn keyA;\n        }\n        \n        var nextKeyIndex:Int = ref.key + 1;\n        \n        if(nextKeyIndex >= timeline.keys.length)\n        {\n            if(loopType == LOOPING)\n            {\n                nextKeyIndex = 0; \n            }\n            else\n            {\n                return keyA;\n            }\n        }\n  \n        var keyB:TimelineKey = timeline.keys[nextKeyIndex].copy();\n        var keyBTime:Int = keyB.time;\n\n        if(keyBTime < keyA.time)\n        {\n            keyBTime = keyBTime+length;\n        }\n\t\t\n        keyA.interpolate(keyB, keyBTime, newTime);\n\t\treturn keyA;\n    }\n\t\n\tprivate function getTimelineName(id:Int):String\n\t{\n\t\treturn timelines[id].name;\n\t}\n\t\n\tprivate function resetMetaDispatch():Void\n\t{\n\t\tif(taglines != null){\n\t\t\tfor (tag in taglines) {\n\t\t\t\ttag.dispatched = false;\n\t\t\t}\n\t\t}\n\t}\n\t\n}","package spriter.definitions;\nimport haxe.xml.Fast;\n\n/**\n * ...\n * @author Loudo\n */\nclass SpriterBox\n{\n\tpublic var name:String; \n    public var pivotX:Float;\n    public var pivotY:Float;\n\tpublic var width:Float;\n\tpublic var height:Float;\n\t\n\tpublic function new(fast:Fast = null) \n\t{\n\t\tif(fast != null){\n\t\t\tname = fast.att.name;\n\t\t\tpivotX = fast.has.pivot_x ? Std.parseFloat(fast.att.pivot_x) : 0;\n\t\t\tpivotY = fast.has.pivot_y ? Std.parseFloat(fast.att.pivot_y) : 0;\n\t\t\t\n\t\t\twidth = fast.has.w ? Std.parseFloat(fast.att.w) : 0;\n\t\t\theight = fast.has.h ? Std.parseFloat(fast.att.h) : 0;\n\t\t}\n\t}\n\t\n\tpublic function copy():SpriterBox\n\t{\n\t\tvar copy:SpriterBox = new SpriterBox();\n\t\tcopy.name = name;\n\t\tcopy.pivotX = pivotX;\n\t\tcopy.pivotY = pivotY;\n\t\tcopy.width = width;\n\t\tcopy.height = height;\n\t\treturn copy;\n\t}\n\t\n}","package spriter.definitions;\nimport haxe.xml.Fast;\nimport spriter.vars.Variable;\nimport spriter.vars.VariableFloat;\nimport spriter.vars.VariableInt;\nimport spriter.vars.VariableString;\n\n/**\n * ...\n * @author Loudo\n */\nclass SpriterEntity\n{\n\n    public var id:Int;\n\tpublic var name:String;\n    public var characterMaps:Map<String,CharacterMap>;\n    public var animations:Map<String,SpriterAnimation>;\n\tpublic var variables:Array<Variable<Dynamic>>;\n\tpublic var boxes_info:Map<String, SpriterBox>;\n\n\t\n\tpublic function new(fast:Fast) \n\t{\n\t\tcharacterMaps = new Map<String,CharacterMap>();\n\t\tanimations = new Map<String,SpriterAnimation>();\n\t\tvariables = new Array<Variable<Dynamic>>();\n\t\tboxes_info = new Map<String, SpriterBox>();\n\t\t\n\t\tid = Std.parseInt(fast.att.id);\n\t\tname = fast.att.name;\n\t\t\n\t\tfor (cm in fast.nodes.character_map)\n\t\t{\n\t\t\tcharacterMaps.set(cm.att.name, new CharacterMap(cm));\n\t\t}\n\t\t\n\t\tif(fast.hasNode.var_defs){\n\t\t\tfor (v in fast.node.var_defs.elements)\n\t\t\t{\n\t\t\t\tswitch(v.att.type)\n\t\t\t\t{\n\t\t\t\t\tcase \"int\":\n\t\t\t\t\t\tvariables.push(new VariableInt(v.att.name, Std.parseInt(v.att.resolve(\"default\"))));\n\t\t\t\t\tcase \"string\":\n\t\t\t\t\t\tvariables.push(new VariableString(v.att.name, Std.string(v.att.resolve(\"default\"))));\n\t\t\t\t\tcase \"float\":\n\t\t\t\t\t\tvariables.push(new VariableFloat(v.att.name, Std.parseFloat(v.att.resolve(\"default\"))));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfor (oi in fast.nodes.obj_info)\n\t\t{\n\t\t\tboxes_info.set(oi.att.name, new SpriterBox(oi));\n\t\t}\n\t\t\n\t\t\n\t\tfor (a in fast.nodes.animation)\n\t\t{\n\t\t\tanimations.set(a.att.name,new SpriterAnimation(a));\n\t\t}\n\t\t/*\n\t\t<obj_info name=\"box_000\" type=\"box\" w=\"65\" h=\"53\" pivot_x=\"0\" pivot_y=\"0\"/>\n\t\t*/\n\t}\n}","package spriter.definitions;\nimport haxe.xml.Fast;\n\n/**\n * ...\n * @author Loudo\n */\nclass SpriterFile\n{\n\tpublic var id:Int;\n\tpublic var name:String; \n    public var pivotX:Float;\n    public var pivotY:Float;\n\tpublic var width:Float;\n\tpublic var height:Float;\n\t\n\tpublic function new(fast:Fast = null) \n\t{\n\t\tif(fast != null){\n\t\t\tid = Std.parseInt(fast.att.id);\n\t\t\tname = fast.att.name;\n\t\t\tpivotX = fast.has.pivot_x ? Std.parseFloat(fast.att.pivot_x) : 0;\n\t\t\tpivotY = fast.has.pivot_y ? Std.parseFloat(fast.att.pivot_y) : 1;\n\t\t\t\n\t\t\twidth = fast.has.width ? Std.parseFloat(fast.att.width) : 0;\n\t\t\theight = fast.has.height ? Std.parseFloat(fast.att.height) : 0;\n\t\t}\n\t}\n\t\n\tpublic function copy():SpriterFile\n\t{\n\t\tvar copy:SpriterFile = new SpriterFile();\n\t\tcopy.name = name;\n\t\tcopy.id = id;\n\t\tcopy.pivotX = pivotX;\n\t\tcopy.pivotY = pivotY;\n\t\tcopy.width = width;\n\t\tcopy.height = height;\n\t\treturn copy;\n\t}\n\t\n}","package spriter.definitions;\nimport haxe.xml.Fast;\n\n/**\n * ...\n * @author Loudo\n */\nclass SpriterFolder\n{\n\n\tpublic var id:Int;\n\tpublic var name:String = '';\n    public var files:Array<SpriterFile>;\n\t\n\t\n\tpublic function new(fast:Fast = null) \n\t{\n\t\tfiles = new Array<SpriterFile>();\n\t\t\n\t\tif(fast != null){\n\t\t\tid = Std.parseInt(fast.att.id);\n\t\t\tif(fast.hasNode.name){\n\t\t\t\tname = fast.att.name;\n\t\t\t}\n\t\t\t\n\t\t\tfor (f in fast.nodes.file)\n\t\t\t{\n\t\t\t\tfiles.push(new SpriterFile(f));\n\t\t\t}\n\t\t}\n\t}\n\t\n\tpublic function copy():SpriterFolder\n\t{\n\t\tvar copy:SpriterFolder = new SpriterFolder();\n\t\tcopy.name = name;\n\t\tcopy.id = id;\n\t\tfor (i in 0...files.length)\n\t\t{\n\t\t\tcopy.files[i] = files[i].copy();\n\t\t}\n\t\treturn copy;\n\t}\n\t\n}","package spriter.definitions;\nimport haxe.xml.Fast;\nimport spriter.definitions.SpriterTimeline.ObjectType;\n\n/**\n * ...\n * @author Loudo\n */\nenum ObjectType\n{\n\tSPRITE;\n\tBONE;\n\tBOX;\n\tPOINT;\n\tSOUND;\n\tENTITY;\n\tVARIABLE;\n}\n \nclass SpriterTimeline\n{\n\tpublic var id:Int;\n\tpublic var name:String;\n    public var objectType:ObjectType; // enum : SPRITE,BONE,BOX,POINT,SOUND,ENTITY,VARIABLE\n    public var keys:Array<TimelineKey>;\n\t\n\tpublic function new(fast:Fast) \n\t{\n\t\tkeys = new Array<TimelineKey>();\n\t\t\n\t\tid = Std.parseInt(fast.att.id);\n\t\tname = fast.has.name ? fast.att.name : \"\";\n\t\tobjectType = fast.has.object_type ? Type.createEnum(ObjectType, fast.att.object_type.toUpperCase()) : ObjectType.SPRITE;\n\t\t\n\t\tswitch (objectType)//TODO over objectType\n\t\t{\n\t\t\tcase ObjectType.SPRITE:\t\t\t\t\t\n\t\t\t\tfor (k in fast.nodes.key)\n\t\t\t\t{\n\t\t\t\t\tkeys.push(new SpriteTimelineKey(k));\n\t\t\t\t}\n\t\n\t\t\tcase ObjectType.BONE:\n\t\t\t\tfor (k in fast.nodes.key)\n\t\t\t\t{\n\t\t\t\t\tkeys.push(new BoneTimelineKey(k));\n\t\t\t\t}\n\t\t\tcase ObjectType.POINT:\n\t\t\t\tfor (k in fast.nodes.key)\n\t\t\t\t{\n\t\t\t\t\tkeys.push(new ObjectTimelineKey(k, objectType));\n\t\t\t\t}\n\t\t\tcase ObjectType.BOX:\n\t\t\t\tfor (k in fast.nodes.key)\n\t\t\t\t{\n\t\t\t\t\tkeys.push(new ObjectTimelineKey(k, objectType));\n\t\t\t\t}\n\t\t\tdefault:\n\t\t\t\t\n\t\t}\n\t\t\n\t}\n\t\n}","package spriter.definitions;\nimport haxe.xml.Fast;\n\n/**\n * ...\n * @author Loudo\n */\nclass TaglineKey\n{\n\tpublic var id:Int;\n\tpublic var time:Int = 0;\n\tpublic var t:Int;\n\tpublic var dispatched(get, set):Bool;\n\tvar _dispatched:Bool = false;\n\tpublic var lastDispatched(get, set):Int;\n\tvar _lastDispatched:Int = -1;\n\tpublic function new(fast:Fast = null) \n\t{\n\t\tif(fast != null){\n\t\t\tid = fast.has.id ? Std.parseInt(fast.att.id) : 0;\n\t\t\ttime = fast.has.time ? Std.parseInt(fast.att.time) : 0;\n\t\t\tfast = fast.node.tag;\n\t\t\tt = Std.parseInt(fast.att.t);\n\t\t}\n\t}\n\tpublic function copy ():TaglineKey\n\t{\n\t\tvar\tcopy:TaglineKey = new TaglineKey();\n\t\treturn clone (copy);\n\t}\n\n\tpublic function clone (clone:TaglineKey):TaglineKey\n\t{\n\t\tclone.id = id;\n\t\tclone.time = time;\n\t\tclone.t = t;\n\t\treturn clone;\n\t}\n\tpublic function set_lastDispatched(val:Int):Int\n\t{\n\t\t_lastDispatched = val;\n\t\t_dispatched = val != -1;\n\t\treturn val;\n\t}\n\tpublic function get_lastDispatched():Int\n\t{\n\t\treturn _lastDispatched;\n\t}\n\tpublic function set_dispatched(val:Bool):Bool\n\t{\n\t\t_dispatched = val;\n\t\tif (!val)\n\t\t\t_lastDispatched = -1;\n\t\treturn val;\n\t}\n\tpublic function get_dispatched():Bool\n\t{\n\t\treturn _dispatched;\n\t}\n\t\n}","package spriter.definitions;\nimport haxe.xml.Fast;\n\n/**\n * ...\n * @author Loudo\n */\nclass Varline\n{\n\n\t/**\n\t * id of variable. Attribut def in scml.\n\t */\n\tpublic var id:Int;\n\tpublic var keys:Array<VarlineKey>;\n\t\n\tpublic function new(fast:Fast = null) \n\t{\n\t\tif(fast != null){\n\t\t\tid = Std.parseInt(fast.att.def);\n\t\t\tkeys = [];\n\t\t\tfor (key in fast.nodes.key)\n\t\t\t{\n\t\t\t\tkeys.push(new VarlineKey(key));\n\t\t\t}\n\t\t}\n\t}\n}","package spriter.definitions;\nimport haxe.xml.Fast;\n\n/**\n * ...\n * @author Loudo\n */\nclass VarlineKey\n{\n\tpublic var id:Int;\n\tpublic var time:Int = 0;\n\tpublic var value:String;\n\tpublic var dispatched(get, set):Bool;\n\tvar _dispatched:Bool = false;\n\tpublic var lastDispatched(get, set):Int;\n\tvar _lastDispatched:Int = -1;\n\tpublic function new(fast:Fast = null) \n\t{\n\t\tif(fast != null){\n\t\t\tid = fast.has.id ? Std.parseInt(fast.att.id) : 0;\n\t\t\ttime = fast.has.time ? Std.parseInt(fast.att.time) : 0;\n\t\t\tvalue = fast.att.val;\n\t\t}\n\t}\n\tpublic function copy ():VarlineKey\n\t{\n\t\tvar\tcopy:VarlineKey = new VarlineKey();\n\t\treturn clone (copy);\n\t}\n\n\tpublic function clone (clone:VarlineKey):VarlineKey\n\t{\n\t\tclone.id = id;\n\t\tclone.time = time;\n\t\tclone.value = value;\n\t\treturn clone;\n\t}\n\tpublic function set_lastDispatched(val:Int):Int\n\t{\n\t\t_lastDispatched = val;\n\t\t_dispatched = val != -1;\n\t\treturn val;\n\t}\n\tpublic function get_lastDispatched():Int\n\t{\n\t\treturn _lastDispatched;\n\t}\n\tpublic function set_dispatched(val:Bool):Bool\n\t{\n\t\t_dispatched = val;\n\t\tif (!val)\n\t\t\t_lastDispatched = -1;\n\t\treturn val;\n\t}\n\tpublic function get_dispatched():Bool\n\t{\n\t\treturn _dispatched;\n\t}\n}","package spriter.engine;\nimport spriter.definitions.ScmlObject;\nimport spriter.definitions.SpatialInfo;\nimport spriter.definitions.Quadrilateral;\nimport spriter.library.AbstractLibrary;\nimport spriter.vars.Variable;\n\n/**\n * ...\n * @author Loudo\n */\nclass Spriter\n{\n\n\tpublic var scml:ScmlObject;\n\tpublic var library:AbstractLibrary;\n\tpublic var spriterName:String;\n\tpublic var timeMS:Int = 0;\n\t\n\tpublic var info:SpatialInfo;\n\t\n\t/**\n\t * If the Spriter is paused.\n\t */\n\tpublic var paused:Bool = false;\n\t\n\t/**\n\t * To slow down or speed up an animation.\n\t */\n\tpublic var playbackSpeed:Float = 1;\n\t\n\tpublic function new(_name:String, _scml:ScmlObject, _library:AbstractLibrary, _info:SpatialInfo) \n\t{\n\t\tscml \t= _scml;\n\t\tlibrary = _library;\n\t\tspriterName = _name;\n\t\tscml.spriterName = spriterName;\n\t\tinfo = _info;\n\t}\n\t\n\tpublic function advanceTime(elapsedMS:Int):Void\n\t{\n\t\tif(!paused)\n\t\t\ttimeMS += Std.int(elapsedMS * playbackSpeed);\n\t\t\t\n\t\tscml.setCurrentTime(timeMS, library, info);//even if paused we need to draw it\n\t}\n\t/**\n\t * Apply character mapping to change an element in the animation.\n\t * @param\tname of the character map in the xml\n\t * @param\treset to apply only the new character map, if not, you can have multiple character map at the same time\n\t * @return  true if the character map exist, false if doesn't exist\n\t */\n\tinline public function applyCharacterMap(name:String, reset:Bool):Bool\n\t{\n\t\treturn scml.applyCharacterMap(name, reset);\n\t}\n\t\n\t/**\n\t * Play a specific animation\n\t * @param\tname of the animation\n\t * @param\tendAnimCallback function callback, return (s:Spriter, entity:String, anim:String)\n\t * @param\tremoveCallback remove function callback after dispatch\n\t * @return  true if the animation exist, false if doesn't exist\n\t */\n\tpublic function playAnim(?name:String, ?endAnimCallback:Spriter->String->String->Void, removeCallback:Bool = true):Bool\n\t{\n\t\tif (name == null) {\n\t\t\tif (paused) \n\t\t\t\tpaused = false;\n\t\t\tresetTime();\n\t\t\tif (endAnimCallback != null) {\n\t\t\t\tscml.endAnimCallback = endAnimCallback.bind(this, scml.currentEntity, scml.currentAnimation);\n\t\t\t\tscml.endAnimRemoval = removeCallback;\n\t\t\t}\n\t\t\treturn true;\n\t\t}else if (scml.entities.get(scml.currentEntity).animations.exists(name)) {\n\t\t\tif (paused) \n\t\t\t\tpaused = false;\n\t\t\tresetTime();\n\t\t\tscml.currentAnimation = name;\n\t\t\tif (endAnimCallback != null) {\n\t\t\t\tscml.endAnimCallback = endAnimCallback.bind(this, scml.currentEntity, name);\n\t\t\t\tscml.endAnimRemoval = removeCallback;\n\t\t\t}\n\t\t\treturn true;\n\t\t}else {\n\t\t\treturn false;\n\t\t}\n\t}\n\t/**\n\t * Play a specific entity.\n\t * @param\tentity name of the entity\n\t * @param\tanim name of the animation (optional)\n\t * @param\tendAnimCallback function callback, return (s:Spriter, entity:String, anim:String)\n\t * @param\tremoveCallback remove function callback after dispatch\n\t * @return  true if the entity exist, false if doesn't exist\n\t */\n\tpublic function playAnimFromEntity(entity:String, anim:String = '', ?endAnimCallback:Spriter->String->String->Void, removeCallback:Bool = true):Bool\n\t{\n\t\tif (scml.entities.exists(entity)) {\n\t\t\tif (paused) \n\t\t\t\tpaused = false;\n\t\t\tresetTime();\n\t\t\tscml.currentEntity = entity;\n\t\t\tif(anim != ''){\n\t\t\t\tif (scml.entities.get(entity).animations.exists(anim)) {\n\t\t\t\t\tscml.currentAnimation = anim;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(endAnimCallback != null){\n\t\t\t\tscml.endAnimCallback = endAnimCallback.bind(this, entity, scml.currentAnimation);\n\t\t\t\tscml.endAnimRemoval = removeCallback;\n\t\t\t}\n\t\t\treturn true;\n\t\t}else {\n\t\t\treturn false;\n\t\t}\n\t}\n\t/**\n\t * Play a stack of animations\n\t * @param\tnames of the animations in order\n\t * @param\tendAnimCallback function callback, return (s:Spriter, entity:String, anim:String)\n\t * @param\tremoveCallback remove function callback after dispatch\n\t * @return  true if the animation exist, false if doesn't exist\n\t */\n\tpublic function playAnimsStack(names:Array<String>, ?endAnimCallback:Spriter->String->String->Void):Bool\n\t{\n\t\tif (scml.entities.get(scml.currentEntity).animations.exists(names[0])) {\n\t\t\tif (paused) \n\t\t\t\tpaused = false;\n\t\t\tresetTime();\n\t\t\tscml.currentAnimation = names[0];\n\t\t\tscml.endAnimCallback = stackAnims.bind(names, 1, endAnimCallback);\n\t\t\tscml.endAnimRemoval = true;\n\t\t\treturn true;\n\t\t}else {\n\t\t\treturn false;\n\t\t}\n\t}\n\t/**\n\t * Play a stack of animations from a specific entity.\n\t * @param\tentity name of the entity\n\t * @param\tanims names of the animations in order\n\t * @param\tendAnimCallback function callback, return (s:Spriter, entity:String, anim:String)\n\t * @param\tremoveCallback remove function callback after dispatch\n\t * @return  true if the entity exist, false if doesn't exist\n\t */\n\tpublic function playAnimsStackFromEntity(entity:String, anims:Array<String>, ?endAnimCallback:Spriter->String->String->Void):Bool\n\t{\n\t\tif (scml.entities.exists(entity)) {\n\t\t\tif (paused) \n\t\t\t\tpaused = false;\n\t\t\tresetTime();\n\t\t\tscml.currentEntity = entity;\n\t\t\tif (scml.entities.get(entity).animations.exists(anims[0])) {\n\t\t\t\tscml.currentAnimation = anims[0];\n\t\t\t}\n\t\t\tscml.endAnimCallback = stackAnims.bind(anims, 1, endAnimCallback);\n\t\t\tscml.endAnimRemoval = true;\n\t\t\treturn true;\n\t\t}else {\n\t\t\treturn false;\n\t\t}\n\t}\n\t\n\t/**\n\t * Play a stack of animations whatever the entity.\n\t * @param\tname of the entity\n\t * @param\tanims names of the animations in order\n\t * @param\tendAnimCallback function callback, return (s:Spriter, entity:String, anim:String)\n\t * @param\tremoveCallback remove function callback after dispatch\n\t * @return  true if the entity exist, false if doesn't exist\n\t */\n\tpublic function playAnimsStackFromEntities(entities:Array<String>, anims:Array<String>, ?endAnimCallback:Spriter->String->String->Void):Bool\n\t{\n\t\tif (scml.entities.exists(entities[0])) {\n\t\t\tif (paused) \n\t\t\t\tpaused = false;\n\t\t\tresetTime();\n\t\t\tscml.currentEntity = entities[0];\n\t\t\tif (scml.entities.get(entities[0]).animations.exists(anims[0])) {\n\t\t\t\tscml.currentAnimation = anims[0];\n\t\t\t}\n\t\t\tscml.endAnimCallback = stackAnimsWithEntitiesChange.bind(entities , anims, 1, endAnimCallback);\n\t\t\tscml.endAnimRemoval = true;\n\t\t\treturn true;\n\t\t}else {\n\t\t\treturn false;\n\t\t}\n\t}\n\t\n\tprivate function stackAnims(anims:Array<String>, nextAnim:Int, endAnimsCallback:Spriter->String->String->Void):Void\n\t{\n\t\tif (scml.entities.get(scml.currentEntity).animations.exists(anims[nextAnim])) {\n\t\t\tif (paused) \n\t\t\t\tpaused = false;\n\t\t\tresetTime();\n\t\t\tscml.currentAnimation = anims[nextAnim];\n\t\t}\n\t\ttrace('stackAnims', scml.currentAnimation);\n\t\t//anim after next anim handler\n\t\tif (++nextAnim >= anims.length) {\n\t\t\tif(endAnimsCallback != null)\n\t\t\t\tscml.endAnimCallback = endAnimsCallback.bind(this, scml.currentEntity, scml.currentAnimation);\n\t\t}else {\n\t\t\t\tscml.endAnimCallback = stackAnims.bind(anims, nextAnim, endAnimsCallback);\n\t\t}\n\t}\n\t\n\tprivate function stackAnimsWithEntitiesChange(entities:Array<String>, anims:Array<String>, nextAnim:Int, endAnimsCallback:Spriter->String->String->Void):Void\n\t{\n\t\tif (scml.entities.exists(entities[nextAnim])) {\n\t\t\tscml.currentEntity = entities[nextAnim];\n\t\t\tif (scml.entities.get(scml.currentEntity).animations.exists(anims[nextAnim])) {\n\t\t\t\tif (paused) \n\t\t\t\t\tpaused = false;\n\t\t\t\tresetTime();\n\t\t\t\tscml.currentAnimation = anims[nextAnim];\n\t\t\t}\n\t\t}\n\t\ttrace('stackAnims', scml.currentAnimation);\n\t\t//anim after next anim handler\n\t\tif (++nextAnim >= anims.length) {\n\t\t\tif(endAnimsCallback != null)\n\t\t\t\tscml.endAnimCallback = endAnimsCallback.bind(this, scml.currentEntity, scml.currentAnimation);\n\t\t}else {\n\t\t\t\tscml.endAnimCallback = stackAnimsWithEntitiesChange.bind(entities, anims, nextAnim, endAnimsCallback);\n\t\t}\n\t}\n\t\n\tinline public function getBoxes():Array<Quadrilateral>\n\t{\n\t\treturn scml.entities[scml.currentEntity].animations[scml.currentAnimation].boxes;\n\t}\n\tinline public function getPoints():Array<SpatialInfo>\n\t{\n\t\treturn scml.entities[scml.currentEntity].animations[scml.currentAnimation].points;\n\t}\n\tpublic function getVariable(name:String):Variable<Dynamic>//TODO generic\n\t{\n\t\tfor (currVar in scml.entities[scml.currentEntity].variables)\n\t\t{\n\t\t\tif (currVar.name == name)\n\t\t\t\treturn currVar;\n\t\t}\n\t\treturn null;\n\t}\n\tinline public function getVariableFromId(id:Int):Variable<Dynamic>//TODO generic\n\t{\n\t\treturn scml.entities[scml.currentEntity].variables[id];\n\t}\n\t\n\tinline public function resetTime():Void\n\t{\n\t\ttimeMS = 0;\n\t}\n\t\n\tpublic function destroy():Void\n\t{\n\t\tscml.destroy();\n\t\tinfo = null;\n\t\t//don't destroy library here since library is shared between all Spriter in the engine\n\t}\n\t\n}","package spriter.flambe;\n\nimport flambe.asset.AssetPack;\nimport flambe.Component;\nimport flambe.display.Sprite;\nimport flambe.Entity;\nimport spriter.definitions.ScmlObject;\nimport spriter.definitions.SpatialInfo;\nimport spriter.engine.Spriter;\nimport spriter.library.FlambeLibrary;\n\n\n/**\n * Used in Flambe as the root controller for the Spriter animations.\n *\n * @author Quinn Hoener\n */\nclass SpriterMovie extends Component\n{\n\t// The Flambe library that updates the graphics. \n\tprivate var _library \t:FlambeLibrary;\n\t// The spriter object to update.\n\tprivate var _spriter \t:Spriter;\n\t// The AssetPack with all the assets.\n\tprivate var _pack \t\t:AssetPack;\n\t// The base path to get assets from.\n\tprivate var _basePath\t:String;\n\t// The scml object this is using. \n\tprivate var _scml \t\t:ScmlObject;\n\t// The root entity to render to.\n\tprivate var _container \t:Entity;\n\t\n\n\tpublic function new(pack:AssetPack, scmlFilePath:String, spriterEntityName:String)\n\t{\n\t\t_pack = pack;\n\t\t\n\t\t// Get the base path.\n\t\tvar aPath:Array<String> = scmlFilePath.split(\"/\");\n\t\taPath.pop();\n\t\t_basePath = aPath.join(\"/\");\n\n\t\t// Get the SCML Object.\n\t\tvar scml_str:String = _pack.getFile(scmlFilePath).toString();\n\t\t_scml = new ScmlObject(Xml.parse(scml_str));\n\n\t\t_container = new Entity().add( new Sprite() );\n\t\t// Setup the library for rendering. \n\t\t_library = new FlambeLibrary(_container, _pack, _basePath);\n\n\t\t// Create the Spriter element. \n\t\t_spriter = new Spriter(spriterEntityName, _scml, _library, new SpatialInfo());\n\t}\n\n\toverride public function onStart():Void\n\t{\n\t\towner.addChild(_container);\n\t}\n\n\toverride public function onUpdate(dt:Float):Void\n\t{\n\t\t_library.clear(); // Won't need this in future. \n\n\t\t_spriter.advanceTime(Std.int(dt * 1000));\n\t}\n\n\t/**\n\t * Chainable method for playing an animation. \n\t * @param  sAnimName Name of the animation to play. \n\t * @return           [description]\n\t */\n\tpublic function playAnim(sAnimName:String):SpriterMovie\n\t{\n\t\t_spriter.playAnim(sAnimName);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Chainable method for setting the character map.\n\t * @param  sAnimName Name of the animation to play. \n\t * @return           [description]\n\t */\n\tpublic function applyCharacterMap(sMapName:String):SpriterMovie\n\t{\n\t\tvar bMapExists:Bool = _spriter.applyCharacterMap(sMapName, false);\n\t\tif ( !bMapExists )\n\t\t{\n\t\t\tthrow \"Character Map: \" + sMapName + \" doesn't exist on Spriter \" + _spriter.spriterName;\n\t\t}\n\t\treturn this;\n\t}\n}","package spriter.library;\n// import openfl.geom.Point;\nimport spriter.definitions.PivotInfo;\nimport spriter.definitions.Quadrilateral;\nimport spriter.definitions.SpatialInfo;\nimport spriter.util.SpriterUtil;\n\n/**\n * ...\n * @author Loudo\n */\nclass AbstractLibrary\n{\n\tprivate var _basePath:String;\n\n\t\n\t\n\t/**\n\t * \n\t * @param\t_basePath \n\t */\n\tpublic function new(basePath :String) \n\t{\n\t\t_basePath = basePath;\n\t}\n\t\n\t/**\n\t * \n\t * @param\tname of the image\n\t * @return  dynamic\n\t */\n\tpublic function getFile(name:String):Dynamic\n\t{\n\t\tthrow (\"must be overrided\");\n\t\treturn null;\n\t}\n\t\n\tpublic function clear():Void\n\t{\n\t\tthrow (\"must be overrided\");\n\t}\n\t\n\tpublic function addGraphic(group:String, timeline:Int, key:Int, name:String, info:SpatialInfo, pivots:PivotInfo):Void\n\t{\n\t\tthrow (\"must be overrided\");\n\t}\n\t\n\tpublic function compute(info:SpatialInfo, pivots:PivotInfo, width:Float, height:Float):SpatialInfo\n\t{\n\t\tvar degreesUnder360 = SpriterUtil.under360(info.angle);\n\t\tvar rad = SpriterUtil.toRadians(degreesUnder360);\n\t\tvar s = Math.sin(rad);\n\t\tvar c = Math.cos(rad);\n\t\t\n\t\tvar pivotX =  info.x;\n\t\tvar pivotY =  info.y;\n\t\t\n\t\tvar preX = info.x - pivots.pivotX * width * info.scaleX;\n\t\tvar preY = info.y + (1 - pivots.pivotY) * height * info.scaleY;\t\n\t\t\n\t\tvar x2 = (preX - pivotX) * c - (preY - pivotY) * s + pivotX;\n        var y2 = (preX - pivotX) * s + (preY - pivotY) * c + pivotY;\n\t\treturn new SpatialInfo(x2, -y2, degreesUnder360, info.scaleX, info.scaleY, info.a, info.spin);\n\t}\n\t\n\tpublic function computeRectCoordinates(info:SpatialInfo, pivots:PivotInfo, width:Float, height:Float):Quadrilateral\n\t{\n\t\tvar degreesUnder360 = -SpriterUtil.under360(info.angle);\n\t\tvar rad = SpriterUtil.toRadians(degreesUnder360);\n\t\tvar s = Math.sin(rad);\n\t\tvar c = Math.cos(rad);\n\t\t\n\t\tvar pivotX = info.x;\n\t\tvar pivotY = -info.y;\n\t\t\n\t\t//1\n\t\tvar x1 = pivotX - width * info.scaleX * pivots.pivotX;\n\t\tvar y1 = pivotY - height * info.scaleY * (1 - pivots.pivotY);\n\t\t\n\t\t//2\n \t\tvar x2 = x1 + width * info.scaleX;\n\t\tvar y2 = y1;\n\t\t\n\t\tx2 = (x2 - pivotX) * c - (y2 - pivotY) * s + pivotX;\n\t\ty2 = (x2 - pivotX) * s + (y2 - pivotY) * c + pivotY;\n\t\t\n\t\t//3\n\t\tvar x3 = x1 + width * info.scaleX;\n\t\tvar y3 = y1 + height * info.scaleY;\t\n\t\t\n\t\tx3 = (x3 - pivotX) * c - (y3 - pivotY) * s + pivotX;\n\t\ty3 = (x3 - pivotX) * s + (y3 - pivotY) * c + pivotY;\n\t\t\n\t\t//4\n\t\tvar x4 = x1;\n\t\tvar y4 = y1 + height * info.scaleY;\t\n\t\t\n\t\tx4 = (x4 - pivotX) * c - (y4 - pivotY) * s + pivotX;\n\t\ty4 = (x4 - pivotX) * s + (y4 - pivotY) * c + pivotY;\n\t\t\n\t\tx1 = (x1 - pivotX) * c - (y1 - pivotY) * s + pivotX;\n\t\ty1 = (x1 - pivotX) * s + (y1 - pivotY) * c + pivotY;\n\t\t\n\t\treturn new Quadrilateral(new QuadPoint(x1, y1), new QuadPoint(x2, y2), new QuadPoint(x3, y3), new QuadPoint(x4, y4));\n\t}\n\t\n\tpublic function render():Void\n\t{\n\t\t\n\t}\n\t\n\tpublic function destroy():Void\n\t{\n\t\t\n\t}\n\t\n}","package spriter.library;\n\nimport flambe.asset.AssetPack;\nimport flambe.display.ImageSprite;\nimport flambe.display.Sprite;\nimport flambe.display.Texture;\nimport flambe.Entity;\nimport flambe.math.FMath;\nimport flambe.math.Point;\nimport flambe.math.Matrix;\nimport flambe.util.Pool;\nimport spriter.definitions.PivotInfo;\nimport spriter.definitions.SpatialInfo;\nimport spriter.util.ColorUtils;\nimport spriter.util.SpriterUtil;\n\n/**\n * ...\n * @author Loudo, Quinn Hoener\n */\nclass FlambeLibrary extends AbstractLibrary\n{\n\t\n    private var _point \t\t:Point;\n    private var _matrix \t:Matrix;\n    private var _pack \t\t:AssetPack;\n    // The root entity that stores all the graphics for this Spriter Library. \n    private var _rootEntity :Entity;\n\t// Contains a String map of the Textures that could be used in this movie. \n\tprivate static var _textures \t:Map<String, Texture>;\n\t// A pool of entities to use since multiple are being added per frame update.\n\tprivate var _entityPool :Pool<Entity>;\n\n\t/**\n\t * Creates a new Flambe Spriter Library.\n\t * @param  entity   The entity to add the graphics to.\n\t * @param  pack     AssetPack to load assets from.\n\t * @param  basePath The base path to the assets.\n\t * @return          [description]\n\t */\n\tpublic function new(rootEntity:Entity, pack:AssetPack, basePath:String) \n\t{\n\t\tsuper(basePath);\n\t\t_pack = pack;\n        _point = new Point();\n        _matrix = new Matrix();\n        _rootEntity = rootEntity;\n        _textures = new Map<String, Texture>();\n        _entityPool = new Pool<Entity>(function () return new Entity()).setSize(25);\n\n        // _rootEntity = new Entity().add( new Sprite() );\n\t}\n\toverride public function getFile(name:String):Dynamic\n\t{\n\t\treturn null;\n\t}\n\n\tprivate function getTexture(name:String):Texture\n\t{\n\t\tif ( !_textures.exists(name) )\n\t\t{\n\t\t\tvar noExtension:String = name.substring(0, name.lastIndexOf(\".\"));\n\t\t\t\n\t\t\t_textures.set(name, _pack.getTexture(_basePath + \"/\" + noExtension) );\n\t\t}\n\n\t\treturn _textures.get(name);\n\t}\n\n\toverride public function clear():Void\n\t{\n\t\twhile ( _rootEntity.firstChild != null )\n\t\t{\n\t\t\tvar child:Entity = _rootEntity.firstChild;\n\t\t\t_rootEntity.removeChild( child );\n\t\t\t_entityPool.put( child );\n\t\t}\n        _rootEntity.add( new Sprite() );\n    }\n\toverride public function addGraphic(group:String, timeline:Int, key:Int, name:String, info:SpatialInfo, pivots:PivotInfo):Void\n\t{\n\t\tvar bmp:Texture = getTexture(name);\n\n\t\tvar spatialResult:SpatialInfo = compute(info, pivots, bmp.width, bmp.height);\n\t\t\n\t\t// Setup the Flambe Sprite.\t\t\n\t\tvar sprite:ImageSprite = new ImageSprite(bmp);\n\t\tvar localMatrix:Matrix = sprite.getLocalMatrix();\n\t\tlocalMatrix.compose(spatialResult.x, spatialResult.y, spatialResult.scaleX, spatialResult.scaleY, FMath.toRadians(SpriterUtil.fixRotation(spatialResult.angle)));\n\t\tsprite.alpha._ = spatialResult.a;\n\t\t\n\t\t// Add as new child to the root. \n\t\t_rootEntity.addChild(_entityPool.take().add(sprite));\n\t}\n\n\toverride public function render():Void\n\t{\n\n\t}\n\toverride public function destroy():Void\n\t{\n\t\tclear();\n\t\t_point = null;\n        _matrix = null;\n        _pack = null;\n        _rootEntity.dispose();\n        _rootEntity = null;\n\t}\n\t\n}","package spriter.util;\n\n/**\n * ...\n * @author Loudo\n */\nclass SpriterUtil\n{\n\n\tinline static public function toRadians(deg : Float) : Float\n    {\n        return deg * Math.PI / 180;\n    }\n\t//because rotation on spriter vs flash are inverted\n\tinline static public function fixRotation(rotation : Float) : Float \n\t{\n\t\tif (rotation == 0)\n\t\t\trotation = 360;\n\t\t\n\t\treturn 360 - rotation;\n\t}\n\t\n\tinline static public function under360(rotation : Float) : Float \n\t{\t\n\t\twhile (rotation > 360)\n\t\t{\n\t\t\trotation -= 360;\n\t\t}\n\n\t\twhile (rotation < 0)\n\t\t{\n\t\t\trotation += 360;\n\t\t}\n\t\treturn rotation;\n\t}\n\t\n\tinline static public function normalizeRotation(rotation : Float) : Float\n\t{\n\t\treturn rotation / 360;\n\t}\n\t\n\tinline static public function fixPivotY(pivotY : Float) : Float \n\t{\n\t\treturn 1 - pivotY;\n\t}\n\t\n    \n\n\t\n}","package spriter.vars;\n\n/**\n * ...\n * @author Loudo\n */\nclass Variable<T>\n{\n\tpublic var name:String;\n\tpublic var value(default,null):T;\n\tpublic var def:T;\n\tpublic function new(name:String, def:T) \n\t{\n\t\tthis.name = name;\n\t\tvalue = def;\n\t\tthis.def = def;\n\t}\n\t/**\n\t * \n\t * @param\tvalue\n\t * @return true if value changes\n\t */\n\tpublic function set(value:String):Bool\n\t{\n\t\treturn false;\n\t}\n\tpublic function toString():String\n\t{\n\t\treturn '[var $name : v:$value, d:$def]';\n\t}\n\t\n}","package spriter.vars;\n\n/**\n * ...\n * @author Loudo\n */\nclass VariableFloat extends Variable<Float>\n{\n\n\tpublic function new(name:String,value:Float) \n\t{\n\t\tsuper(name,value);\n\t}\n\toverride public function set(value:String):Bool\n\t{\n\t\tvar temp = this.value;\n\t\tthis.value = Std.parseFloat(value);\n\t\tif (temp != this.value)\n\t\t\treturn true;\n\t\treturn false;\n\t}\n\t\n}","package spriter.vars;\n\n/**\n * ...\n * @author Loudo\n */\nclass VariableInt extends Variable<Int>\n{\n\n\tpublic function new(name:String,value:Int) \n\t{\n\t\tsuper(name,value);\n\t}\n\toverride public function set(value:String):Bool\n\t{\n\t\tvar temp:Int = this.value;\n\t\tthis.value = Std.parseInt(value);\n\t\tif (temp != this.value)\n\t\t\treturn true;\n\t\treturn false;\n\t}\n\t\n}","package spriter.vars;\n\n/**\n * ...\n * @author Loudo\n */\nclass VariableString extends Variable<String>\n{\n\n\tpublic function new(name:String,value:String) \n\t{\n\t\tsuper(name,value);\n\t}\n\toverride public function set(value:String):Bool\n\t{\n\t\tvar temp:String = this.value;\n\t\tthis.value = value;\n\t\tif (temp != this.value)\n\t\t\treturn true;\n\t\treturn false;\n\t}\n\t\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2013\r\n */\r\n\r\npackage tools.spark;\r\n\r\nimport tools.spark.framework.Project;\r\nimport tools.spark.framework.ModuleManager;\r\nimport tools.spark.sliced.core.Sliced;\r\nimport tools.spark.framework.Framework;\r\nimport tools.spark.framework.Assets;\r\nimport tools.spark.framework.config.Config;\r\nimport tools.spark.framework.RootComponent;\r\nimport flambe.System;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Main\r\n{\r\n\tprivate static function main()\r\n    {\r\n\t\t//Init Framework (flambe, graphics, etc..)\r\n\t\tFramework.init();\r\n\t\t\r\n\t\t//Load config\r\n\t\t_loadClientConfig();\r\n    }\r\n\r\n\tprivate static function _loadClientConfig():Void\r\n\t{\r\n\t\tAssets.successSignal.connect(_onClientConfigLoaded).once();\r\n\t\t\r\n\t\tAssets.initiateBatch();\r\n\t\tAssets.addFile(_getSkcUrl(), \"config\");\r\n\t\tAssets.loadBatch();\r\n\t}\r\n\t\r\n\tprivate static function _onClientConfigLoaded()\r\n    {\r\n\t\t//Init Config\r\n\t\tvar l_configurator:Config = new Config(Assets.getFile(\"config\"));\r\n\t\t\r\n\t\tif (l_configurator.parseClient() == false)\r\n\t\t{\r\n\t\t\tConsole.error(\"Failed to parse configuration file. Aborting...\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//Init Sliced (For Client)\r\n\t\tSliced.init();\r\n\t\t\r\n\t\t//Create Display Renderers\r\n\t\tFramework.createDisplayRenderers();\r\n\t\t\r\n\t\t//Execute Modules\r\n\t\tfor (moduleName in Project.executeModules)\r\n\t\t\tModuleManager.execute(moduleName);\r\n\t\t\t\r\n\t\t//Create Spark's Flambe Root Component\r\n\t\tSystem.root.add(new RootComponent());\r\n    }\r\n\t\r\n\t//Get External skc url if provided\r\n\tprivate static function _getSkcUrl():String\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tvar l_skcUrl:String = System.external.call(\"getMainSparkClientUrl\");\r\n\t\t\tif (l_skcUrl.length==0) return \"main.skc\";\r\n\t\t\telse return l_skcUrl;\r\n\t\t}\r\n\t\tcatch (e : Dynamic)\r\n\t\t\treturn \"main.skc\";\r\n\t}\r\n}\r\n","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2013\r\n */\r\n\r\npackage tools.spark.framework;\r\n\r\nimport flambe.asset.AssetPack;\r\nimport tools.spark.framework.assets.FlambeLoader;\r\nimport flambe.asset.File;\r\nimport flambe.display.Texture;\r\nimport flambe.sound.Sound;\r\nimport flambe.util.Signal0;\r\nimport flambe.util.Signal1;\r\nimport flambe.util.Signal2;\r\n\r\n/**\r\n * Client Version of the Assets System\r\n * The Server Version will be almost similar\r\n * But will use mloader for the loader, and will not support many features\r\n * just statically loading a lot of XML files at once\r\n * then delivering them upon request\r\n * Also, instead of Flambe Signals it uses msignal\r\n * @author Aris Kostakos\r\n */\r\nclass Assets\r\n{ \r\n\tpublic static var successSignal:Signal0;\r\n\tpublic static var errorSignal:Signal1<String>;\r\n\tpublic static var progressSignal:Signal2<Float,Float>;\r\n\t\r\n\tprivate static var _loader:FlambeLoader;\r\n\t\r\n\tpublic static function init():Void\r\n\t{\r\n\t\t_loader = new FlambeLoader();\r\n\t\t_loader.successSignal.connect(_onLoaderSuccess);\r\n\t\t_loader.errorSignal.connect(_onLoaderError);\r\n\t\t_loader.progressSignal.connect(_onLoaderProgress);\r\n\t\t\r\n\t\tsuccessSignal = new Signal0();\r\n\t\terrorSignal = new Signal1<String>();\r\n\t\tprogressSignal = new Signal2<Float,Float>();\r\n\t}\r\n\t\r\n\tprivate static function _onLoaderSuccess():Void\r\n\t{\r\n\t\ttrace(\"Assets: SUCCESS!\");\r\n\t\tsuccessSignal.emit();\r\n\t}\r\n\t\r\n\tprivate static function _onLoaderError(p_error:String):Void\r\n\t{\r\n\t\ttrace(\"Assets: ERROR: \" + p_error);\r\n\t\terrorSignal.emit(p_error);\r\n\t}\r\n\t\r\n\tprivate static function _onLoaderProgress(p_progress:Float, p_total:Float):Void\r\n\t{\r\n\t\t//trace(\"Assets: Progress: Loaded \" + p_progress + \" Bytes out of \" + p_total + \" total Bytes...\");\r\n\t\tprogressSignal.emit(p_progress, p_total);\r\n\t}\r\n\t\r\n\tpublic static function initiateBatch():Void\r\n\t{\r\n\t\t_loader.startNewBatchLoad();\r\n\t}\r\n\t\r\n\tpublic static function addFile(p_url:String, ?p_name:String, p_forceLoadAsData:Bool=false):Void\r\n\t{\r\n\t\tif (p_name == null) p_name = p_url;\r\n\t\t\r\n\t\t_loader.addFile(p_name, p_url, p_forceLoadAsData);\r\n\t}\r\n\t\r\n\tpublic static function loadBatch():Void\r\n\t{\r\n\t\t_loader.initiateLoad();\r\n\t}\r\n\t\r\n\t\r\n\tpublic static function getAssetPackOf(p_name:String):AssetPack\r\n\t{\r\n\t\treturn _loader.getAssetPackOf(p_name);\r\n\t}\r\n\t\r\n\tpublic static function getFile(p_name:String):File\r\n\t{\r\n\t\treturn _loader.getFile(p_name);\r\n\t}\r\n\t\r\n\tpublic static function getTexture(p_name:String):Texture\r\n\t{\r\n\t\treturn _loader.getTexture(p_name);\r\n\t}\r\n\t\r\n\tpublic static function getSound(p_name:String):Sound\r\n\t{\r\n\t\treturn _loader.getSound(p_name);\r\n\t}\r\n\t\r\n\tpublic static function testLoadFile(p_name:String, p_url:String, p_forceLoadAsData:Bool):Void\r\n\t{\r\n\t\t_loader.startNewBatchLoad();\r\n\t\t_loader.addFile(p_name, p_url, p_forceLoadAsData);\r\n\t\t_loader.initiateLoad();\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2013\r\n */\r\n\r\npackage tools.spark.framework;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\n@:keep class Console\r\n{\r\n#if (debug || flambe_keep_logs)\r\n\tinline public static function log(p_message:String):Void\r\n\t{\r\n\t\tSparkLog.info(p_message);\r\n\t}\r\n\t\r\n\tinline public static function info(p_message:String):Void\r\n\t{\r\n\t\tSparkLog.info(p_message);\r\n\t}\r\n\t\r\n\tinline public static function debug(p_message:String):Void\r\n\t{\r\n\t\tSparkLog.info(p_message);\r\n\t}\r\n\t\r\n\tinline public static function warn(p_message:String):Void\r\n\t{\r\n\t\tSparkLog.warn(p_message);\r\n\t}\r\n\t\r\n\tinline public static function error(p_message:String):Void\r\n\t{\r\n\t\tSparkLog.error(p_message);\r\n\t}\r\n\t\r\n#else\r\n    // In release builds, logging calls are stripped out\r\n    inline public static function log(p_message:String):Void {}\r\n    inline public static function info(p_message:String):Void { }\r\n\tinline public static function debug(p_message:String):Void { }\r\n\tinline public static function warn(p_message:String):Void { }\r\n\tinline public static function error(p_message:String):Void {}\r\n#end\r\n\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2013\r\n */\r\n\r\npackage tools.spark.framework;\r\nimport flambe.System;\r\n\r\n#if flash\r\n\timport tools.spark.framework.platform.flash.Graphics;\r\n#else\r\n\timport tools.spark.framework.platform.html.Graphics;\r\n#end\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Framework\r\n{\t\r\n\tpublic static function init():Void\r\n\t{\r\n\t\t//In case of html, fix the haxe/js bug to have external js code able to run\r\n\t\t#if html\r\n\t\t\t//fix the haxe/js bug before running any js code\r\n\t\t\tuntyped __js__('if (Object.defineProperty) Object.defineProperty(Array.prototype, \"__class__\", {enumerable: false});');\r\n\t\t#end\r\n\t\t\r\n\t\t// Init Flambe\r\n\t\tSystem.init();\r\n\t\t\r\n\t\t//Init Platform Specific Graphics\r\n\t\tGraphics.init();\r\n\t\t\r\n\t\t//Init Assets System\r\n\t\tAssets.init();\r\n\t\t\r\n\t\t//Init Project Data Object\r\n\t\tProject.init();\r\n\t\t\r\n\t\t//Init Module Manager\r\n\t\tModuleManager.init();\r\n\t}\r\n\t\r\n\tpublic static function createDisplayRenderers():Void\r\n\t{\r\n\t\tGraphics.createDisplayRenderers();\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, December 2014\r\n */\r\n\r\npackage tools.spark.framework;\r\nimport tools.spark.framework.assets.Module;\r\nimport tools.spark.framework.assets.EModuleState;\r\nimport tools.spark.sliced.core.Sliced;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ModuleManager\r\n{\r\n\tprivate static var _moduleStates:Map<String,EModuleState>;\r\n\tprivate static var _modulesLoadQueue:Array<String>;\r\n\tprivate static var _modulesLoadQueueBytes:Array<Int>;\r\n\tprivate static var _loadingBatch:Bool;\r\n\t\r\n\tpublic static function init():Void\r\n\t{\r\n\t\t_moduleStates = new Map<String,EModuleState>();\r\n\t\t_modulesLoadQueue = new Array<String>();\r\n\t\t_modulesLoadQueueBytes = new Array<Int>();\r\n\t\t_loadingBatch = false;\r\n\t\t\r\n\t\tAssets.successSignal.connect(_onLoaderSuccess);\r\n\t\tAssets.errorSignal.connect(_onLoaderError);\r\n\t\tAssets.progressSignal.connect(_onLoaderProgress);\r\n\t}\r\n\t\r\n\tprivate static function _onLoaderSuccess():Void\r\n\t{\r\n\t\tif (_loadingBatch == false)\r\n\t\t{\r\n\t\t\t//Got signal but it wasn't initiated from Module Manager. Ignoring (this solution sucks, see warning at the end)\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t//Loader not busy anymore\r\n\t\t_loadingBatch = false;\r\n\t\t\r\n\t\t//Get loaded module\r\n\t\tvar l_moduleName:String = _modulesLoadQueue[0];\r\n\t\t\r\n\t\tConsole.log(\"Module Loader: SUCCESS LOADING: \" + l_moduleName);\r\n\t\t\r\n\t\t//Mark it as loaded\r\n\t\t_moduleStates[l_moduleName] = LOADED;\r\n\t\t\r\n\t\t//Remove module from Queues\r\n\t\t_modulesLoadQueue.shift();\r\n\t\t_modulesLoadQueueBytes.shift();\r\n\t\t\r\n\t\t//Attempt to execute it if possible\r\n\t\t_executeModule(l_moduleName);\r\n\t\t\r\n\t\t//Load Next item in Queue (if any)\r\n\t\t_startLoadBatch();\r\n\t}\r\n\t\r\n\tprivate static function _onLoaderError(p_error:String):Void\r\n\t{\r\n\t\tConsole.error(\"Module Loader: ERROR: \" + p_error);\r\n\t\t//errorSignal.emit(p_error);\r\n\t}\r\n\t\r\n\tprivate static function _onLoaderProgress(p_progress:Float, p_total:Float):Void\r\n\t{\r\n\t\t//trace(\"Module Loader: Progress: Loaded \" + p_progress + \" Bytes out of \" + p_total + \" total Bytes...\");\r\n\t\t//progressSignal.emit(p_progress, p_total);\r\n\t}\r\n\t\r\n\tpublic static function execute(p_moduleName:String):Void\r\n\t{\r\n\t\tif (isModuleLoaded(p_moduleName)) _executeModule(p_moduleName);\r\n\t\telse\r\n\t\t{\r\n\t\t\t_loadModule(p_moduleName);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic static function getModuleState(p_ModuleName:String):EModuleState\r\n\t{\r\n\t\tif (_moduleStates[p_ModuleName] == null) _moduleStates[p_ModuleName] = NOT_LOADED;\r\n\t\t\r\n\t\treturn _moduleStates[p_ModuleName];\r\n\t}\r\n\t\r\n\tpublic static function isModuleLoaded(p_ModuleName:String):Bool\r\n\t{\r\n\t\tswitch (getModuleState(p_ModuleName))\r\n\t\t{\r\n\t\t\tcase NOT_LOADED, LOADING:\r\n\t\t\t\treturn false;\r\n\t\t\tcase LOADED, RUNNING, PAUSED:\r\n\t\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic static function isModuleExecuted(p_ModuleName:String):Bool\r\n\t{\r\n\t\tswitch (getModuleState(p_ModuleName))\r\n\t\t{\r\n\t\t\tcase NOT_LOADED, LOADING, LOADED:\r\n\t\t\t\treturn false;\r\n\t\t\tcase RUNNING, PAUSED:\r\n\t\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate static function _executeModule(p_moduleName:String):Void\r\n\t{\r\n\t\tif (isModuleExecuted(p_moduleName))\r\n\t\t{\r\n\t\t\tConsole.warn(\"Error while trying to execute Module [\" + p_moduleName + \"]. Module already executed. Ignoring..\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (isModuleExecutable(p_moduleName))\r\n\t\t\t{\r\n\t\t\t\tSliced.logic.createAndRun(Project.modules[p_moduleName].executeEntity);\r\n\t\t\t\t_moduleStates[p_moduleName] = RUNNING;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tConsole.warn(\"Warning while trying to execute Module [\" + p_moduleName + \"]. Module is not executable. Ignoring..\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic static function isModuleExecutable(p_moduleName:String):Bool\r\n\t{\r\n\t\tif (Project.modules[p_moduleName].executeEntity == \"none\")\r\n\t\t\treturn false;\r\n\t\telse\r\n\t\t\treturn true;\r\n\t}\r\n\t\r\n\tprivate static function _loadModule(p_moduleName:String):Void\r\n\t{\r\n\t\tConsole.log(\"LOADING MODULE: \" + p_moduleName);\r\n\t\tif (getModuleState(p_moduleName) == NOT_LOADED)\r\n\t\t{\r\n\t\t\t//@todo Watch for Recursion for two modules both requiring one another!\r\n\t\t\tfor (f_requiredModuleName in Project.modules[p_moduleName].requiresModules)\r\n\t\t\t{\r\n\t\t\t\tConsole.log(\"LOADING MODULE REQUIREMENT: \" + f_requiredModuleName);\r\n\t\t\t\tif (getModuleState(f_requiredModuleName) == NOT_LOADED)\r\n\t\t\t\t\t_loadModule(f_requiredModuleName);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t_loadAssetsOfModule(p_moduleName);\r\n\t\t}\r\n\t}\r\n\t\r\n\t//@donow: two things plz. insert bytes to Assets, and the Asset loaded, so we can check here if asset already loaded.\r\n\tprivate static function _loadAssetsOfModule(p_moduleName:String):Void\r\n\t{\r\n\t\tvar l_bytes:Int = 0;\r\n\t\t\r\n\t\tfor (asset in Project.modules[p_moduleName].assets)\r\n\t\t\tl_bytes += Std.parseInt(asset.bytes);\r\n\t\t\r\n\t\t_moduleStates[p_moduleName] = LOADING;\r\n\t\t_modulesLoadQueue.push(p_moduleName);\r\n\t\t_modulesLoadQueueBytes.push(l_bytes);\r\n\t\t\r\n\t\tif (_loadingBatch==false) _startLoadBatch();\r\n\t}\r\n\t\r\n\t//@warning: If the user uses the Asset Service himself manually, it will interfere with the signals sent here\r\n\t//and fuck everything up! figure it out!\r\n\tprivate static function _startLoadBatch():Void\r\n\t{\r\n\t\t//do a check here if _loadingBatch is false? don't have to currently due to logic, but maybe just \r\n\t\t//do be safe? performance vs safety, hmmmm\r\n\t\t\r\n\t\t\r\n\t\tif (_modulesLoadQueue.length > 0)\r\n\t\t{\r\n\t\t\tvar l_moduleName:String = _modulesLoadQueue[0];\r\n\t\t\t\r\n\t\t\tAssets.initiateBatch();\r\n\t\t\t\r\n\t\t\tfor (asset in Project.modules[l_moduleName].assets)\r\n\t\t\t{\r\n\t\t\t\t//Console.log(\"adding file: \" + asset.id);\r\n\t\t\t\tAssets.addFile(Project.getPath(asset.location,asset.type)+asset.url, asset.id, asset.forceLoadAsData == \"true\");\r\n\t\t\t}\r\n\t\t\tAssets.loadBatch();\r\n\t\t\t\r\n\t\t\t_loadingBatch = true;\r\n\t\t}\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, December 2014\r\n */\r\n\r\npackage tools.spark.framework;\r\nimport tools.spark.framework.config.ENodeType;\r\nimport tools.spark.framework.assets.Module;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Project\r\n{\r\n\tpublic static var name( default, default ):String;\r\n\tpublic static var version( default, default ):String;\r\n\tpublic static var type( default, default ):ENodeType;\r\n\tpublic static var executeModules( default, null ):Array< String>;\r\n\tpublic static var sliced( default, null ):Map< ENodeType, String>;\r\n\tpublic static var paths( default, null ):Map< String, Map < String, String > >; //Location, Type, Url\r\n\tpublic static var modules( default, null ):Map< String, Module>;\r\n\t\r\n\tpublic static function init():Void\r\n\t{\r\n\t\texecuteModules = new Array< String>();\r\n\t\tsliced = new Map< ENodeType, String>();\r\n\t\tpaths = new Map< String, Map < String, String > >();\r\n\t\tmodules = new Map< String, Module>();\r\n\t}\r\n\t\r\n\tpublic static function setPath(p_location:String, p_type:String, p_url):Void\r\n\t{\r\n\t\tif (paths[p_location] == null) paths[p_location] = new Map<String, String>();\r\n\t\t\r\n\t\tpaths[p_location][p_type] = p_url;\r\n\t}\r\n\t\r\n\tpublic static function getPath(p_location: String, p_type:String):String\r\n\t{\r\n\t\tif (paths[p_location] == null) return null;\r\n\t\t\r\n\t\treturn paths[p_location][p_type];\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2013\r\n */\r\n\r\npackage tools.spark.framework;\r\n\r\nimport tools.spark.sliced.core.Sliced;\r\nimport flambe.Component;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass RootComponent extends Component\r\n{\r\n\tpublic function new()\r\n\t{\r\n\t\t/*\r\n\t\t//Create Root GameEntity\r\n\t\t//Sliced.logic.rootGameEntity = Sliced.logic.gameFactory.createGameEntity(Config.getConfig( \"game.rootGameEntity\" ));\r\n\t\t\r\n\t\tif (Sliced.logic.rootGameEntity == null)\r\n\t\t{\r\n\t\t\tConsole.error(\"Root Game Entity could not be created!\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tConsole.info(\"Root Game Entity was created successfully!\");\r\n\t\t}\r\n\t\t*/\r\n\t}\r\n\r\n\toverride public function onUpdate (dt :Float)\r\n\t{\r\n\t\tSliced.update();\r\n\t}\r\n}\r\n","package tools.spark.framework.assets;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Asset\r\n{\r\n\tpublic var id(default, null):String;\r\n\tpublic var url(default, default):String;\r\n\tpublic var type(default, default):String;\r\n\tpublic var subtype(default, default):String;\r\n\tpublic var location(default, default):String;\r\n\tpublic var bytes(default, default):String;\r\n\tpublic var condition(default, default):String;\r\n\tpublic var forceLoadAsData(default, default):String;\r\n\t\r\n\tpublic function new(p_id:String) \r\n\t{\r\n\t\tid = p_id;\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2013\r\n */\r\n\r\npackage tools.spark.framework.assets;\r\n\r\nimport flambe.asset.File;\r\nimport flambe.display.Texture;\r\nimport flambe.sound.Sound;\r\nimport flambe.System;\r\nimport flambe.asset.AssetPack;\r\nimport flambe.asset.Manifest;\r\nimport flambe.util.Promise;\r\nimport flambe.util.Signal0;\r\nimport flambe.util.Signal1;\r\nimport flambe.util.Signal2;\r\nimport flambe.util.SignalConnection;\r\nimport flambe.asset.AssetEntry.AssetFormat;\r\nimport flambe.asset.Asset;\r\n\r\n/**\r\n * Load the config folder statically...\r\n * Load the lionscript\\std folder statically...\r\n * Load the lionscript\\workingProject folder dynamically\r\n * should also load all other asset folders (data, images, models, sounds)\r\n * dynamically as well. BUT should load the std parts in those folders\r\n * statically here. For example a font that I should always have\r\n * available for ALL projects.. Should be very limited.\r\n * FOR NOW, load lionscript\\workingProject folder statically as well...\r\n * FOR NOW, load all assets statically...\r\n * @author Aris Kostakos\r\n */\r\nclass FlambeLoader\r\n{\t\r\n\tpublic var successSignal:Signal0;\r\n\tpublic var errorSignal:Signal1<String>;\r\n\tpublic var progressSignal:Signal2<Float,Float>;\r\n\t\r\n\tprivate var _assetInUse:Map<String,Bool>;\r\n\tprivate var _assetToBatchLoad:Map<String,Manifest>;\r\n\tprivate var _batchLoadToAssetPack:Map<Manifest,AssetPack>;\r\n\t\r\n\tprivate var _manifest:Manifest;\r\n\tprivate var _promise:Promise<AssetPack>;\r\n\tprivate var _promiseSignalSuccess:SignalConnection;\r\n\tprivate var _promiseSignalError:SignalConnection;\r\n\tprivate var _promiseSignalProgress:SignalConnection;\r\n\t\r\n\tpublic function new()\r\n\t{\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\tsuccessSignal = new Signal0();\r\n\t\terrorSignal = new Signal1<String>();\r\n\t\tprogressSignal = new Signal2<Float,Float>();\r\n\t\t\r\n\t\t_assetInUse = new Map<String,Bool>();\r\n\t\t_assetToBatchLoad = new Map<String,Manifest>();\r\n\t\t_batchLoadToAssetPack = new Map<Manifest,AssetPack>();\r\n\t}\r\n\t\r\n\t//Interface function for ServerLoader as well\r\n\tpublic function startNewBatchLoad():Void\r\n\t{\r\n\t\t_manifest = new Manifest();\r\n\t}\r\n\t\r\n\t//Interface function for ServerLoader as well\r\n\tpublic function addFile(p_name:String, p_url:String, p_forceLoadAsData:Bool):Void\r\n\t{\r\n\t\tif (p_forceLoadAsData)\r\n\t\t{\r\n\t\t\t_manifest.add(p_name, p_url +\"?\" + Std.random(10000), 1, AssetFormat.Data);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t_manifest.add(p_name, p_url +\"?\" + Std.random(10000), 1);\r\n\t\t}\r\n\t\t\r\n\t\t_assetToBatchLoad[p_name]= _manifest;\r\n\t}\r\n\t\r\n\tpublic function getAssetPackOf(p_name:String):AssetPack\r\n\t{\r\n\t\treturn _batchLoadToAssetPack[_assetToBatchLoad[p_name]];\r\n\t}\r\n\t\r\n\tpublic function getFile(p_name:String):File\r\n\t{\r\n\t\treturn _batchLoadToAssetPack[_assetToBatchLoad[p_name]].getFile(p_name);\r\n\t}\r\n\t\r\n\tpublic function getTexture(p_name:String):Texture\r\n\t{\r\n\t\treturn _batchLoadToAssetPack[_assetToBatchLoad[p_name]].getTexture(p_name);\r\n\t}\r\n\t\r\n\tpublic function getSound(p_name:String):Sound\r\n\t{\r\n\t\treturn _batchLoadToAssetPack[_assetToBatchLoad[p_name]].getSound(p_name);\r\n\t}\r\n\t\r\n\t\r\n\t//Interface function for ServerLoader as well.\r\n\tpublic function initiateLoad():Void\r\n\t{\r\n\t\t_promise = System.loadAssetPack(_manifest);\r\n\t\t\r\n\t\t_promiseSignalSuccess = _promise.success.connect(_onPromiseSuccess);\r\n\t\t_promiseSignalError = _promise.error.connect(_onPromiseError);\r\n\t\t_promiseSignalProgress = _promise.progressChanged.connect(_onPromiseProgress);\r\n\t}\r\n\t\r\n\tprivate function _onPromiseSuccess(p_assettPack:AssetPack):Void\r\n\t{\r\n\t\t_disposePromiseSignals();\r\n\t\t\r\n\t\t_batchLoadToAssetPack[_manifest] = p_assettPack;\r\n\t\tsuccessSignal.emit();\r\n\t}\r\n\t\r\n\tprivate function _onPromiseError(p_error:String):Void\r\n\t{\r\n\t\t_disposePromiseSignals();\r\n\t\t\r\n\t\terrorSignal.emit(p_error);\r\n\t}\r\n\t\r\n\tprivate function _onPromiseProgress():Void\r\n\t{\r\n\t\tprogressSignal.emit(_promise.progress, _promise.total);\r\n\t}\r\n\t\r\n\tprivate function _disposePromiseSignals():Void\r\n\t{\r\n\t\t_promiseSignalSuccess.dispose();\r\n\t\t_promiseSignalError.dispose();\r\n\t\t_promiseSignalProgress.dispose();\r\n\t}\r\n}","package tools.spark.framework.assets;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Module\r\n{\r\n\tpublic var requiresModules( default, null ):Array<String>;\r\n\tpublic var assets( default, null ):Map< String, Asset>;\r\n\tpublic var id(default, null):String;\r\n\tpublic var executeEntity(default, default):String;\r\n\t\r\n\tpublic function new(p_id:String) \r\n\t{\r\n\t\tid = p_id;\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate inline function _init():Void\r\n\t{\r\n\t\trequiresModules = new Array<String>();\r\n\t\tassets = new Map< String, Asset>();\r\n\t}\r\n}","package tools.spark.framework.config;\r\nimport flambe.asset.File;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Config\r\n{\r\n\tprivate var _configValidator:ConfigValidator;\r\n\tprivate var _configInstantiator:ConfigInstantiator;\r\n\tprivate var _configFile:File;\r\n\tprivate var _xmlNodeTypeToNodeName:Map<ENodeType,String>;\r\n\tprivate var _xmlNodeNameToNodeType:Map<String,ENodeType>;\r\n\t\r\n\tpublic function new(p_configFile:File) \r\n\t{\r\n\t\t_configFile = p_configFile;\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tinline private function _init():Void\r\n\t{\r\n\t\t_initNodeNamesMap();\r\n\t\t_initNodeTypesMap();\r\n\t\t\r\n\t\t_configValidator = new ConfigValidator(_xmlNodeTypeToNodeName);\r\n\t\t_configInstantiator = new ConfigInstantiator(_xmlNodeTypeToNodeName);\r\n\t}\r\n\t\r\n\tpublic function parseClient():Bool\r\n\t{\r\n\t\treturn _parse(ENodeType.CLIENT);\r\n\t}\r\n\t\r\n\tpublic function parseServer():Bool\r\n\t{\r\n\t\treturn _parse(ENodeType.SERVER);\r\n\t}\r\n\t\r\n\tprivate function _parse(p_rootNodeType:ENodeType):Bool\r\n\t{\r\n\t\tvar l_configNode:Xml;\r\n\t\t\r\n\t\t//Parse\r\n\t\tConsole.info('Config: Parsing...');\r\n\t\ttry \r\n\t\t{\r\n\t\t\tl_configNode=Xml.parse(_configFile.toString());\r\n\t\t}\r\n\t\tcatch (err:Dynamic) \r\n\t\t{\r\n\t\t\tConsole.error(Std.string(err));\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\t//Get First Element Node\r\n\t\tl_configNode = l_configNode.firstElement();\r\n\t\t\r\n\t\t//Make Sure the Config file is correct (Client or Server)\r\n\t\tvar l_configNodeType:ENodeType = _xmlNodeNameToNodeType[l_configNode.nodeName];\r\n\t\tif (l_configNodeType != p_rootNodeType)\r\n\t\t{\r\n\t\t\tConsole.error('Config file is not correct. Expected Root Child: ' + p_rootNodeType + ', got: ' + l_configNodeType +'.');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t//Validate\r\n\t\tConsole.info('Config: Validating...');\r\n\t\t\r\n\t\t//Init Validation (construct rules for either client or server config)\r\n\t\t_configValidator.init(p_rootNodeType);\r\n\t\t\r\n\t\tif (_validateConfigNode(l_configNode)==false)\r\n\t\t{\r\n\t\t\tConsole.error('Config file could not be validated');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t//Instantiate\r\n\t\tConsole.info('Config: Instantiating...');\r\n\t\t//Console.info(l_configNode.toString());\r\n\r\n\t\t//Init\r\n\t\t_configInstantiator.init(l_configNode, p_rootNodeType);\r\n\t\t\r\n\t\t//Project\r\n\t\t_configInstantiator.instantiateProject();\r\n\t\t\r\n\t\t//Sliced\r\n\t\t_configInstantiator.instantiateSliced();\r\n\t\t\r\n\t\t//Paths\r\n\t\t_configInstantiator.instantiatePaths();\r\n\t\t\r\n\t\t//Assets\r\n\t\t//@todo: instantiateAssets should return bool for succeeded or not. If two modules has the same id,\r\n\t\t//or two assets inside a module share the same id, return false. and figure other problems as well\r\n\t\t//mostly here in Assets, but maybe above as well (non-validation problems that is..) logical problems that validation cannot catch\r\n\t\t_configInstantiator.instantiateAssets();\r\n\t\t\r\n\t\tConsole.info('Config: Completed!');\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\tprivate function _validateConfigNode(p_configNode:Xml):Bool\r\n\t{\r\n\t\tvar l_configNodeType:ENodeType = _xmlNodeNameToNodeType[p_configNode.nodeName];\r\n\t\t\r\n\t\tif (_configValidator.validateConfigNode(p_configNode, l_configNodeType))\r\n\t\t{\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfor ( elt in p_configNode.elements() ) \r\n\t\t\t{\r\n\t\t\t\tif (_validateConfigNode(elt) == false)\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t\r\n\t//Mapping\r\n\t\r\n\tprivate function _initNodeNamesMap():Void\r\n\t{\r\n\t\t_xmlNodeTypeToNodeName = new Map<ENodeType,String>();\r\n\t\t\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.CLIENT] = \"Client\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.SERVER] = \"Server\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.PROJECT] = \"Project\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.SLICED] = \"Sliced\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.PATHS] = \"Paths\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.ASSETS] = \"Assets\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.PROJECT_NAME] = \"Name\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.PROJECT_VERSION] = \"Version\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.EXECUTE_AT_LAUNCH] = \"ExecuteAtLaunch\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.EXECUTE_MODULE] = \"ExecuteModule\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.SOUND_SERVICE] = \"Sound\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.LOGIC_SERVICE] = \"Logic\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.INPUT_SERVICE] = \"Input\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.COMMUNICATIONS_SERVICE] = \"Comms\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.EVENT_SERVICE] = \"Event\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.DISPLAY_SERVICE] = \"Display\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.PATH] = \"Path\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.MODULE] = \"Module\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.ASSET] = \"Asset\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.REQUIRES] = \"Requires\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.REQUIRES_MODULE] = \"RequiresModule\";\r\n\t}\r\n\t\r\n\tprivate function _initNodeTypesMap():Void\r\n\t{\r\n\t\t_xmlNodeNameToNodeType = new Map<String,ENodeType>();\r\n\t\t\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.CLIENT]] = ENodeType.CLIENT;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.SERVER]] = ENodeType.SERVER;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.PROJECT]] = ENodeType.PROJECT;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.SLICED]] = ENodeType.SLICED;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.PATHS]] = ENodeType.PATHS;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.ASSETS]] = ENodeType.ASSETS;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.PROJECT_NAME]] = ENodeType.PROJECT_NAME;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.PROJECT_VERSION]] = ENodeType.PROJECT_VERSION;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.EXECUTE_AT_LAUNCH]] = ENodeType.EXECUTE_AT_LAUNCH;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.EXECUTE_MODULE]] = ENodeType.EXECUTE_MODULE;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.SOUND_SERVICE]] = ENodeType.SOUND_SERVICE;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.LOGIC_SERVICE]] = ENodeType.LOGIC_SERVICE;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.INPUT_SERVICE]] = ENodeType.INPUT_SERVICE;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.COMMUNICATIONS_SERVICE]] = ENodeType.COMMUNICATIONS_SERVICE;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.EVENT_SERVICE]] = ENodeType.EVENT_SERVICE;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.DISPLAY_SERVICE]] = ENodeType.DISPLAY_SERVICE;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.PATH]] = ENodeType.PATH;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.MODULE]] = ENodeType.MODULE;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.ASSET]] = ENodeType.ASSET;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.REQUIRES]] = ENodeType.REQUIRES;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.REQUIRES_MODULE]] = ENodeType.REQUIRES_MODULE;\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, December 2014\r\n */\r\n\r\npackage tools.spark.framework.config;\r\nimport tools.spark.framework.assets.Asset;\r\nimport tools.spark.framework.assets.Module;\r\n\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ConfigInstantiator\r\n{\r\n\tprivate var _xmlNodeTypeToNodeName:Map<ENodeType,String>;\r\n\tprivate var _configNode:Xml;\r\n\tprivate var _rootNodeType:ENodeType;\r\n\t\r\n\tpublic function new(p_xmlNodeTypeToNodeName:Map<ENodeType,String>) \r\n\t{\r\n\t\t_xmlNodeTypeToNodeName = p_xmlNodeTypeToNodeName;\r\n\t}\r\n\t\r\n\tpublic function init(p_configNode:Xml, p_rootNodeType:ENodeType):Void\r\n\t{\r\n\t\t_configNode = p_configNode;\r\n\t\t_rootNodeType = p_rootNodeType;\r\n\t}\r\n\t\r\n\tpublic function instantiateProject():Void\r\n\t{\t\r\n\t\t//Project Node\r\n\t\tvar l_projectNode:Xml = _configNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.PROJECT]).next();\r\n\t\t\r\n\t\t//Project Name\r\n\t\tProject.name = l_projectNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.PROJECT_NAME]).next().firstChild().nodeValue;\r\n\t\t\r\n\t\t//Project Version\r\n\t\tProject.version = l_projectNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.PROJECT_VERSION]).next().firstChild().nodeValue;\r\n\t\t\r\n\t\t//Project Type\r\n\t\tProject.type = _rootNodeType;\r\n\t\t\r\n\t\t//Project Execute Modules Node\r\n\t\tvar l_ExecuteModules:Xml = l_projectNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.EXECUTE_AT_LAUNCH]).next();\r\n\t\t\r\n\t\tfor ( executeModule in l_ExecuteModules.elements()) \r\n\t\t{\r\n\t\t\tProject.executeModules.push(executeModule.firstChild().nodeValue);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function instantiateSliced():Void\r\n\t{\t\r\n\t\t//Sliced Node\r\n\t\tvar l_slicedNode:Xml = _configNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.SLICED]).next();\r\n\t\t\r\n\t\t//Common\r\n\t\tProject.sliced[ENodeType.LOGIC_SERVICE]= l_slicedNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.LOGIC_SERVICE]).next().firstChild().nodeValue;\r\n\t\tProject.sliced[ENodeType.COMMUNICATIONS_SERVICE] = l_slicedNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.COMMUNICATIONS_SERVICE]).next().firstChild().nodeValue;\r\n\t\tProject.sliced[ENodeType.EVENT_SERVICE]= l_slicedNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.EVENT_SERVICE]).next().firstChild().nodeValue;\r\n\t\t\r\n\t\t//Client Only\r\n\t\tif (Project.type == ENodeType.CLIENT)\r\n\t\t{\r\n\t\t\tProject.sliced[ENodeType.SOUND_SERVICE] = l_slicedNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.SOUND_SERVICE]).next().firstChild().nodeValue;\r\n\t\t\tProject.sliced[ENodeType.INPUT_SERVICE] = l_slicedNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.INPUT_SERVICE]).next().firstChild().nodeValue;\r\n\t\t\tProject.sliced[ENodeType.DISPLAY_SERVICE]= l_slicedNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.DISPLAY_SERVICE]).next().firstChild().nodeValue;\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function instantiatePaths():Void\r\n\t{\t\r\n\t\t//Paths Node\r\n\t\tvar l_pathsNode:Xml = _configNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.PATHS]).next();\r\n\r\n\t\tfor ( f_pathNode in l_pathsNode.elements()) \r\n\t\t{\r\n\t\t\tProject.setPath(f_pathNode.get(\"location\"), f_pathNode.get(\"type\"), f_pathNode.firstChild().nodeValue);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function instantiateAssets():Void\r\n\t{\t\r\n\t\t//Assets Node\r\n\t\tvar l_assetsNode:Xml = _configNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.ASSETS]).next();\r\n\t\t\r\n\t\t//Modules\r\n\t\tfor ( f_moduleNode in l_assetsNode.elements()) \r\n\t\t{\r\n\t\t\tProject.modules[f_moduleNode.get(\"id\")] = _instantiateModule(f_moduleNode);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tprivate function _instantiateModule(p_moduleNode:Xml):Module\r\n\t{\r\n\t\tvar l_module:Module = new Module(p_moduleNode.get(\"id\"));\r\n\t\t\r\n\t\t//Execute Entity\r\n\t\tl_module.executeEntity = p_moduleNode.get(\"executeEntity\");\r\n\t\t\r\n\t\t//Create the Modules's Required Modules\r\n\t\t//@todo: //when i check whether the array xml element exists, and then access the first node it found (the hasNext and next functions),\r\n\t\t\t//I actually search through the xml TWICE. Instead, save the iterator from the first call(the hasNext), and use that to do the next()\r\n\t\tif (p_moduleNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.REQUIRES]).hasNext())\r\n\t\t{\r\n\t\t\tvar l_requiresNode:Xml = p_moduleNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.REQUIRES]).next();\r\n\t\t\tfor ( requiresModuleNode in  l_requiresNode.elements()) \r\n\t\t\t{\r\n\t\t\t\tl_module.requiresModules.push(requiresModuleNode.firstChild().nodeValue);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Assets\r\n\t\tvar l_assetChildren:Iterator<Xml> = p_moduleNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.ASSET]);\r\n\t\twhile (l_assetChildren.hasNext())\r\n\t\t{\r\n\t\t\tvar w_assetNode:Xml = l_assetChildren.next();\r\n\t\t\t\r\n\t\t\tvar w_asset:Asset = _instantiateAsset(w_assetNode);\r\n\t\t\t\r\n\t\t\tl_module.assets[w_asset.id] = w_asset;\r\n\t\t}\r\n\t\t\r\n\t\treturn l_module;\r\n\t}\r\n\t\r\n\tprivate function _instantiateAsset(p_assetNode:Xml):Asset\r\n\t{\r\n\t\tvar l_assetId:String = p_assetNode.get(\"id\")==\"useUrl\"?p_assetNode.firstChild().nodeValue:p_assetNode.get(\"id\");\r\n\t\t\r\n\t\tvar l_asset:Asset = new Asset(l_assetId);\r\n\t\t\r\n\t\tl_asset.url = p_assetNode.firstChild().nodeValue;\r\n\t\tl_asset.type =  p_assetNode.get(\"type\");\r\n\t\tl_asset.subtype =  p_assetNode.get(\"subtype\");\r\n\t\tl_asset.location =  p_assetNode.get(\"location\");\r\n\t\tl_asset.bytes =  p_assetNode.get(\"bytes\");\r\n\t\tl_asset.condition =  p_assetNode.get(\"condition\");\r\n\t\tl_asset.forceLoadAsData =  p_assetNode.get(\"forceLoadAsData\");\r\n\t\t\r\n\t\treturn l_asset;\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, December 2014\r\n */\r\n\r\npackage tools.spark.framework.config;\r\n\r\nimport haxe.xml.Check;\r\nimport haxe.xml.Check.Filter;\r\nimport haxe.xml.Check.Rule;\r\nimport haxe.xml.Check.Rule.RList;\r\nimport haxe.xml.Check.Rule.RNode;\r\nimport haxe.xml.Check.Rule.RChoice;\r\nimport haxe.xml.Check.Rule.RData;\r\nimport haxe.xml.Check.Rule.RMulti;\r\nimport haxe.xml.Check.Rule.ROptional;\r\n\r\n/**\r\n * //@todo: filters for everything. And maybe special filter/logic for asset types. Like, script asset types cannot have an id parameter, etc..\r\n * @author Aris Kostakos\r\n */\r\nclass ConfigValidator\r\n{\r\n\tprivate var _xmlNodeTypeToNodeName:Map<ENodeType,String>;\r\n\tprivate var _xmlNodeTypeToNodeRule:Map<ENodeType,Rule>;\r\n\t\r\n\tpublic function new(p_xmlNodeTypeToNodeName:Map<ENodeType,String>) \r\n\t{\r\n\t\t_xmlNodeTypeToNodeName = p_xmlNodeTypeToNodeName;\r\n\t}\r\n\t\r\n\tpublic function init(p_rootNodeType:ENodeType):Void\r\n\t{\r\n\t\t_initNodeRulesMap(p_rootNodeType);\r\n\t}\r\n\t\t\r\n\t\r\n\t\r\n\tprivate function _initNodeRulesMap(p_rootNodeType:ENodeType):Void\r\n\t{\r\n\t\t_xmlNodeTypeToNodeRule = new Map<ENodeType,Rule>();\r\n\t\t\r\n\t\t//Common\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.REQUIRES_MODULE] = _createRequiresModuleNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.REQUIRES] = _createRequiresNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.ASSET] = _createAssetNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.MODULE] = _createModuleNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.ASSETS] = _createAssetsNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.PATH] = _createPathNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.PATHS] = _createPathsNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.SOUND_SERVICE] = _createSoundServiceNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.LOGIC_SERVICE] = _createLogicServiceNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.INPUT_SERVICE] = _createInputServiceNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.COMMUNICATIONS_SERVICE] = _createCommsServiceNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.EVENT_SERVICE] = _createEventServiceNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.DISPLAY_SERVICE] = _createDisplayServiceNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.EXECUTE_MODULE] = _createExecuteModuleNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.EXECUTE_AT_LAUNCH] = _createExecuteAtLaunchNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.PROJECT_NAME] = _createProjectNameNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.PROJECT_VERSION] = _createProjectVersionNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.PROJECT] = _createProjectNodeRule();\r\n\t\t\r\n\t\t//Client Only\r\n\t\tif (p_rootNodeType == ENodeType.CLIENT)\r\n\t\t{\r\n\t\t\t_xmlNodeTypeToNodeRule[ENodeType.SLICED] = _createSlicedClientNodeRule();\r\n\t\t\t_xmlNodeTypeToNodeRule[ENodeType.CLIENT] = _createClientNodeRule();\r\n\t\t}\r\n\t\t//Server Only\r\n\t\telse if (p_rootNodeType == ENodeType.SERVER)\r\n\t\t{\r\n\t\t\t_xmlNodeTypeToNodeRule[ENodeType.SLICED] = _createSlicedServerNodeRule();\r\n\t\t\t_xmlNodeTypeToNodeRule[ENodeType.SERVER] = _createServerNodeRule();\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t//METHODS\r\n\t\r\n\tpublic inline function validateConfigNode(p_configNode:Xml, p_nodeType:ENodeType):Bool\r\n\t{\r\n\t\tif (_xmlNodeTypeToNodeRule[p_nodeType] == null)\r\n\t\t{\r\n\t\t\tConsole.error(\"This Config Node Rule has not been created Yet!\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\ttry \r\n\t\t{\r\n\t\t\tCheck.checkNode(p_configNode, _xmlNodeTypeToNodeRule[p_nodeType]);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tcatch (m:String) \r\n\t\t{\r\n\t\t\tConsole.error(m);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t//XML RULES (Schema)\r\n\t\r\n\tinline private function _createClientNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RList(\r\n\t\t\t[\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.PROJECT],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.SLICED],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.PATHS],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.ASSETS]\r\n\t\t\t],\r\n\t\t\tfalse\r\n\t\t);\r\n\t\t\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.CLIENT], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createServerNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RList(\r\n\t\t\t[\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.PROJECT],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.SLICED],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.PATHS],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.ASSETS]\r\n\t\t\t],\r\n\t\t\tfalse\r\n\t\t);\r\n\t\t\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.SERVER], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createProjectNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RList(\r\n\t\t\t[\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.PROJECT_NAME],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.PROJECT_VERSION],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.EXECUTE_AT_LAUNCH]\r\n\t\t\t],\r\n\t\t\tfalse\r\n\t\t);\r\n\t\t\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.PROJECT], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createProjectNameNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.PROJECT_NAME], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createProjectVersionNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.PROJECT_VERSION], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createExecuteAtLaunchNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RMulti(_xmlNodeTypeToNodeRule[ENodeType.EXECUTE_MODULE], true);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.EXECUTE_AT_LAUNCH], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createExecuteModuleNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.EXECUTE_MODULE], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createSlicedClientNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RList(\r\n\t\t\t[\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.SOUND_SERVICE],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.LOGIC_SERVICE],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.INPUT_SERVICE],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.COMMUNICATIONS_SERVICE],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.EVENT_SERVICE],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.DISPLAY_SERVICE]\r\n\t\t\t],\r\n\t\t\tfalse\r\n\t\t);\r\n\t\t\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.SLICED], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createSlicedServerNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RList(\r\n\t\t\t[\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.LOGIC_SERVICE],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.COMMUNICATIONS_SERVICE],\r\n\t\t\t\t_xmlNodeTypeToNodeRule[ENodeType.EVENT_SERVICE]\r\n\t\t\t],\r\n\t\t\tfalse\r\n\t\t);\r\n\t\t\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.SLICED], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createSoundServiceNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.SOUND_SERVICE], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createLogicServiceNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.LOGIC_SERVICE], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createInputServiceNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.INPUT_SERVICE], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createCommsServiceNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.COMMUNICATIONS_SERVICE], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createEventServiceNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.EVENT_SERVICE], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createDisplayServiceNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.DISPLAY_SERVICE], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createPathsNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RMulti(_xmlNodeTypeToNodeRule[ENodeType.PATH], true);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.PATHS], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createPathNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\tvar l_attributes:Array<Attrib> = [\tAttrib.Att(\"location\"),\r\n\t\t\t\t\t\t\t\t\t\t\tAttrib.Att(\"type\")\r\n\t\t\t\t\t\t\t\t\t\t ];\r\n\t\t\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.PATH], l_attributes, l_children);\r\n\t}\r\n\t\r\n\tinline private function _createAssetsNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RMulti(_xmlNodeTypeToNodeRule[ENodeType.MODULE], true);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.ASSETS], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createModuleNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RList(\r\n\t\t\t[\r\n\t\t\t\tROptional(_xmlNodeTypeToNodeRule[ENodeType.REQUIRES]),\r\n\t\t\t\tRMulti(_xmlNodeTypeToNodeRule[ENodeType.ASSET], true)\r\n\t\t\t],\r\n\t\t\tfalse\r\n\t\t);\r\n\t\t\r\n\t\t\r\n\t\tvar l_attributes:Array<Attrib> = [\tAttrib.Att(\"id\"),\r\n\t\t\t\t\t\t\t\t\t\t\tAttrib.Att(\"executeEntity\",null,\"none\")\r\n\t\t\t\t\t\t\t\t\t\t ];\r\n\t\t\t\t\t\t\t\t\t\t \r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.MODULE], l_attributes, l_children);\r\n\t}\r\n\t\r\n\tinline private function _createAssetNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\tvar l_attributes:Array<Attrib> = [\tAttrib.Att(\"location\"),\r\n\t\t\t\t\t\t\t\t\t\t\tAttrib.Att(\"type\"),\r\n\t\t\t\t\t\t\t\t\t\t\tAttrib.Att(\"bytes\"),\r\n\t\t\t\t\t\t\t\t\t\t\tAttrib.Att(\"subtype\",null,\"none\"),\r\n\t\t\t\t\t\t\t\t\t\t\tAttrib.Att(\"id\",null,\"useUrl\"),\r\n\t\t\t\t\t\t\t\t\t\t\tAttrib.Att(\"condition\",null,\"always\"),\r\n\t\t\t\t\t\t\t\t\t\t\tAttrib.Att(\"forceLoadAsData\",null,\"false\")\r\n\t\t\t\t\t\t\t\t\t\t ];\r\n\t\t\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.ASSET], l_attributes, l_children);\r\n\t}\r\n\t\r\n\tinline private function _createRequiresNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RMulti(_xmlNodeTypeToNodeRule[ENodeType.REQUIRES_MODULE], true);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.REQUIRES], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createRequiresModuleNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.REQUIRES_MODULE], [], l_children);\r\n\t}\r\n\t/*\r\n\tinline private function _createConcurrencyNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData(FEnum([_xmlConcurrencyTypeToName[EConcurrencyType.PARALLEL],\r\n\t\t\t\t\t\t\t\t_xmlConcurrencyTypeToName[EConcurrencyType.PERSISTENT],\r\n\t\t\t\t\t\t\t\t_xmlConcurrencyTypeToName[EConcurrencyType.TRANSIENT]\r\n\t\t\t\t\t\t\t\t])\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.CONCURRENCY], [], l_children);\r\n\t}\r\n\t*/\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.framework.space2_5D.core;\r\nimport tools.spark.framework.space2_5D.interfaces.IBase2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ABase2_5D implements IBase2_5D\r\n{\r\n\tpublic var gameEntity( default, null ):IGameEntity;\r\n  \r\n\tprivate function new(p_gameEntity:IGameEntity) \r\n\t{\r\n\t\tgameEntity = p_gameEntity;\r\n\t}\r\n\t\r\n\tpublic function setPosSize(?p_x:Null<Float>, ?p_y:Null<Float>, ?p_width:Null<Float>, ?p_height:Null<Float>, ?p_view:IView2_5D):Void\r\n\t{\r\n\t\t//override me\r\n\t\t//..\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2014\r\n */\r\n\r\npackage tools.spark.framework.space2_5D.core;\r\nimport tools.spark.framework.space2_5D.interfaces.IObject2_5D;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass AObject2_5D extends ABase2_5D implements IObject2_5D\r\n{\r\n  \r\n\tprivate function new(p_gameEntity:IGameEntity)\r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2014\r\n */\r\n\r\npackage tools.spark.framework.space2_5D.core;\r\n\r\nimport tools.spark.framework.space2_5D.interfaces.ICamera2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ACamera2_5D extends AObject2_5D implements ICamera2_5D\r\n{\r\n\tprivate var _attachedToViews:Map<IView2_5D,IView2_5D>;\r\n\t\r\n\tprivate function new(p_gameEntity:IGameEntity) \r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t\t_initACamera2_5D();\r\n\t}\r\n\t\r\n\tprivate function _initACamera2_5D()\r\n\t{\r\n\t\t_attachedToViews = new Map<IView2_5D,IView2_5D>();\r\n\t}\r\n\t\r\n\tpublic function attachToView(p_view2_5D:IView2_5D):Dynamic\r\n\t{\r\n\t\t_attachedToViews[p_view2_5D] = p_view2_5D;\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.framework.dom2_5D;\r\n\r\nimport tools.spark.framework.space2_5D.core.ACamera2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass DomCamera2_5D extends ACamera2_5D\r\n{\r\n\tpublic function new(p_gameEntity:IGameEntity)\r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2014\r\n */\r\n\r\npackage tools.spark.framework.space2_5D.core;\r\n\r\nimport tools.spark.framework.space2_5D.interfaces.IObjectContainer2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IEntity2_5D;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * An object container can also have multiple instances. Used for Scenes and Entities\r\n * @author Aris Kostakos\r\n */\r\nclass AObjectContainer2_5D extends AObject2_5D implements IObjectContainer2_5D\r\n{\r\n\tpublic var children( default, null ):Array<IEntity2_5D>;\r\n\t\r\n\tprivate function new(p_gameEntity:IGameEntity) \r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t\tchildren = new Array<IEntity2_5D>();\r\n\t}\r\n\t\r\n\tpublic function addChild( p_entity2_5D:IEntity2_5D):Void\r\n\t{\r\n\t\tchildren.push(p_entity2_5D);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2014\r\n */\r\n\r\npackage tools.spark.framework.space2_5D.core;\r\n\r\nimport tools.spark.framework.space2_5D.interfaces.IInstantiable2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IEntity2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.framework.layout.containers.Group;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * @author Aris Kostakos\r\n */\r\nclass AInstantiable2_5D extends AObjectContainer2_5D implements IInstantiable2_5D\r\n{\r\n\tprivate var _instances:Map<IView2_5D,Dynamic>;\r\n\tprivate var _updateStateFunctions:Map < String, Dynamic->IView2_5D->Void >;\r\n\tpublic var groupInstances( default, null ):Map<IView2_5D, Group>;\r\n\t\r\n\tprivate function new(p_gameEntity:IGameEntity) \r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t\t_initInstantiable2_5D();\r\n\t}\r\n\t\r\n\tinline private function _initInstantiable2_5D()\r\n\t{\r\n\t\t_instances = new Map<IView2_5D, Dynamic>();\r\n\t\t_updateStateFunctions = new Map < String, Dynamic->IView2_5D->Void > ();\r\n\t\t\r\n\t\t//if (gameEntity.getState('layoutable') == true)\r\n\t\t\tgroupInstances = new Map<IView2_5D, Group>();\r\n\t}\r\n\t\r\n\t//For optimization purposes.. to be able to inline the publics\r\n\tprivate function _updateState(p_state:String, ?p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tupdateState(p_state,p_view2_5D);\r\n\t}\r\n\t\r\n\tinline public function updateState(p_state:String, ?p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tif (p_view2_5D == null)\r\n\t\t{\r\n\t\t\t//do for all instances\r\n\t\t\tfor (f_view in _instances.keys())\r\n\t\t\t\t_updateStateOfInstance(p_state, f_view);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//do for p_View2_5D instance\r\n\t\t\t_updateStateOfInstance(p_state, p_view2_5D);\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _updateLayoutGroup( ?p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tif (p_view2_5D == null)\r\n\t\t{\r\n\t\t\t//do for all instances\r\n\t\t\tfor (f_view in groupInstances.keys())\r\n\t\t\t\tgroupInstances[f_view].update();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//do for p_View2_5D instance\r\n\t\t\tgroupInstances[p_view2_5D].update();\r\n\t\t}\r\n\t}\r\n\t\r\n\t//@think: inline here, good idea or not?\r\n\tinline private function _updateStateOfInstance(p_state:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tif (_updateStateFunctions[p_state]!=null)\r\n\t\t\t_updateStateFunctions[p_state](gameEntity.getState(p_state),p_view2_5D);\r\n\t\telse\r\n\t\t\tConsole.warn(\"State \" + p_state + \" does not have a function handler! Ignoring :(\");\r\n\t}\r\n\t\r\n\tprivate function _createChildrenOfInstance(p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Instantiate Children (and add to scene instance)\r\n\t\tfor (f_childEntity in children)\r\n\t\t\t_createChildOfInstance(f_childEntity, p_view2_5D);\r\n\t}\r\n\t\r\n\tpublic function createInstance (p_view2_5D:IView2_5D):Dynamic\r\n\t{\r\n\t\t//override to create platform specific instance here and store it in _instances[p_view2_5D]\r\n\t\t//also to create the group instance\r\n\t\t\r\n\t\t_createChildrenOfInstance(p_view2_5D);\r\n\t\t\r\n\t\treturn _instances[p_view2_5D];\r\n\t}\r\n\t\r\n\tprivate function _createChildOfInstance(p_childEntity:IEntity2_5D, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//override me!!\r\n\t}\r\n\t\r\n\tpublic function update(?p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//override me!!\r\n\t}\r\n\t\r\n\toverride public function addChild( p_entity2_5D:IEntity2_5D):Void\r\n\t{\r\n\t\t//Console.error(\"adding child (instanciable here)\");\r\n\t\tsuper.addChild(p_entity2_5D);\r\n\t\t\r\n\t\t//do for all instances (hack?)\r\n\t\tfor (f_view in _instances.keys())\r\n\t\t{\r\n\t\t\t_createChildOfInstance(p_entity2_5D, f_view);\r\n\t\t\tp_entity2_5D.update(f_view);\r\n\t\t}\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2014\r\n */\r\n\r\npackage tools.spark.framework.space2_5D.core;\r\n\r\nimport tools.spark.framework.space2_5D.interfaces.IEntity2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IScene2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.framework.layout.containers.Group;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass AEntity2_5D extends AInstantiable2_5D implements IEntity2_5D\r\n{\r\n\tprivate var _parentScene:IScene2_5D;\r\n\t\r\n\tprivate function new(p_gameEntity:IGameEntity) \r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t\t\r\n\t}\r\n\t\r\n\toverride public function createInstance (p_view2_5D:IView2_5D):Dynamic\r\n\t{\r\n\t\tif (gameEntity.getState('layoutable') == true)\r\n\t\t\tgroupInstances[p_view2_5D] = new Group(gameEntity, \"Entity\", this);\r\n\t\t\t\r\n\t\treturn super.createInstance(p_view2_5D);\r\n\t}\r\n\t\r\n\toverride private function _createChildOfInstance(p_childEntity:IEntity2_5D, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tif (p_childEntity.gameEntity.getState('layoutable') == true)\r\n\t\t\tgroupInstances[p_view2_5D].children.push(p_childEntity.groupInstances[p_view2_5D]);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.framework.dom2_5D;\r\n\r\nimport js.html.DivElement;\r\nimport js.html.InputElement;\r\nimport js.html.ImageElement;\r\nimport js.html.ButtonElement;\r\nimport js.html.Element;\r\nimport js.Browser;\r\nimport tools.spark.framework.assets.Asset;\r\nimport tools.spark.framework.space2_5D.core.AEntity2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IEntity2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.sliced.core.Sliced;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EEventType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass DomEntity2_5D extends AEntity2_5D\r\n{\r\n\tpublic function new(p_gameEntity:IGameEntity) \r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t\t_initDomEntity2_5D();\r\n\t}\r\n\t\r\n\tprivate function _initDomEntity2_5D()\r\n\t{\r\n\t\t_updateStateFunctions['NCmeshType'] = _updateNCmeshType;\r\n\t\t_updateStateFunctions['touchable'] = _updateTouchable;\r\n\t\t_updateStateFunctions['NCstyleable'] = _updateNCstyleable;\r\n\t\t_updateStateFunctions['visibility'] = _updateVisibility;\r\n\t\t_updateStateFunctions['opacity'] = _updateOpacity;\r\n\t\t_updateStateFunctions['display'] = _updateDisplay;\r\n\t\t_updateStateFunctions['text'] = _updateText;\r\n\t\t_updateStateFunctions['fontColor'] = _updateFontColor;\r\n\t\t_updateStateFunctions['src'] = _updateImageSrc;\r\n\t\t_updateStateFunctions['fontSize'] = _updateFontSize;\r\n\t\t_updateStateFunctions['overflow'] = _updateOverflow;\r\n\t\t_updateStateFunctions['width'] = _updateWidth;\r\n\t\t_updateStateFunctions['height'] = _updateHeight;\r\n\t}\r\n\t\r\n\t\r\n\toverride public function createInstance (p_view2_5D:IView2_5D):Dynamic\r\n\t{\r\n\t\tswitch (gameEntity.getState( 'NCmeshType' ))\r\n\t\t{\r\n\t\t\tcase \"Div\":\r\n\t\t\t\t_instances[p_view2_5D] = Browser.document.createDivElement();\r\n\t\t\tcase \"Input\":\r\n\t\t\t\t_instances[p_view2_5D] = Browser.document.createInputElement();\r\n\t\t\t\t_instances[p_view2_5D].onchange = _onChange;\r\n\t\t\t\t_instances[p_view2_5D].style.outline = \"0\"; //remove blue border when selected.. it's a hack, fix me\r\n\t\t\tcase \"Button\":\r\n\t\t\t\t//_instances[p_view2_5D] = Browser.document.createButtonElement();\r\n\t\t\t\t_instances[p_view2_5D] = Browser.document.createDivElement();\r\n\t\t\t\t_instances[p_view2_5D].style.outline = \"0\"; //remove blue border when selected.. it's a hack, fix me\r\n\t\t\tcase \"Image\":\r\n\t\t\t\t_instances[p_view2_5D] = Browser.document.createImageElement();\r\n\t\t\tcase \"Ace\":\r\n\t\t\t\t_instances[p_view2_5D] = Browser.document.createDivElement();\r\n\t\t\tcase \"Tree\":\r\n\t\t\t\t_instances[p_view2_5D] = Browser.document.createDivElement();\r\n\t\t\tdefault:\r\n\t\t\t\t//@fixme: If this element was not meant to be rendered at all, don't let it create a DomEntity at all!!!\r\n\t\t\t\tConsole.error(\"Unrecognised NCMeshType input. Creating a Div By Default.\");\r\n\t\t\t\t_instances[p_view2_5D] = Browser.document.createDivElement();\r\n\t\t}\r\n\t\t\r\n\t\t_instances[p_view2_5D].style.position = \"absolute\";\r\n\r\n\t\treturn super.createInstance(p_view2_5D);\r\n\t}\r\n\r\n\toverride private function _createChildOfInstance(p_childEntity:IEntity2_5D, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//This is an 'instance' addChild... a flambe addChild..\r\n\t\t_instances[p_view2_5D].appendChild(cast(p_childEntity.createInstance(p_view2_5D), Element));\r\n\t\t\r\n\t\tsuper._createChildOfInstance(p_childEntity, p_view2_5D);\r\n\t}\r\n\r\n\toverride public function update(?p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Temp way to batch everything together.. not good for updating individual properties, but good for implementing shit faast\r\n\t\t_updateState('NCmeshType', p_view2_5D); //this should nest all relevant attribute updates\r\n\t\t\r\n\t\t//Update Style\r\n\t\tif (gameEntity.getState('NCstyleable') == true)\r\n\t\t{\r\n\t\t\t_updateState('NCstyleable', p_view2_5D);\r\n\t\t\t_updateState('visibility', p_view2_5D);\r\n\t\t\t_updateState('opacity', p_view2_5D);\r\n\t\t\t_updateState('display', p_view2_5D);\r\n\t\t\t_updateState('fontSize', p_view2_5D);\r\n\t\t\t_updateState('fontColor', p_view2_5D);\r\n\t\t\t_updateState('overflow', p_view2_5D);\r\n\t\t}\r\n\t\t\r\n\t\t//Update Touchable Stuff\r\n\t\t_updateState('touchable', p_view2_5D);\r\n\t\t\r\n\t\t//Update Text Stuff\r\n\t\tif (gameEntity.getState('text')!=null)\r\n\t\t\t_updateState('text', p_view2_5D);\r\n\t\t\t\r\n\t\t//Update my layoutObject\r\n\t\tif (gameEntity.getState('layoutable') == true)\r\n\t\t\t_updateLayoutGroup(p_view2_5D);\r\n\t\t\r\n\t\t//Update Children\r\n\t\tfor (f_childEntity in children)\r\n\t\t\tf_childEntity.update(p_view2_5D);\r\n\t}\r\n\t\r\n\toverride public function setPosSize(?p_x:Null<Float>, ?p_y:Null<Float>, ?p_width:Null<Float>, ?p_height:Null<Float>, ?p_view:IView2_5D):Void\r\n\t{\r\n\t\t//Get Mesh\r\n\t\tvar l_mesh:Element = _instances[p_view];\r\n\t\t\r\n\t\tif (l_mesh != null)\t\t\r\n\t\t{\r\n\t\t\tif (p_x != null) l_mesh.style.left = Std.string(p_x) + \"px\";\r\n\t\t\tif (p_y != null) l_mesh.style.top = Std.string(p_y) + \"px\";\r\n\t\t\tif (p_width != null) l_mesh.style.width = Std.string(p_width) + \"px\";\r\n\t\t\tif (p_height != null) l_mesh.style.height = Std.string(p_height) + \"px\";\r\n\t\t}\r\n\t}\r\n\t\r\n\t//Temp way to batch everything together.. not good for updating individual properties, but good for implementing shit faast\r\n\tinline private function _updateNCstyleable(p_NCstyleable:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tif (gameEntity.getState('backgroundColor') != null && gameEntity.getState('backgroundColor')!=\"Undefined\")\r\n\t\t\t_instances[p_view2_5D].style.backgroundColor = gameEntity.getState('backgroundColor');\r\n\t\t\r\n\t\tif (gameEntity.getState('border') != null && gameEntity.getState('border')!=\"Undefined\")\r\n\t\t\t_instances[p_view2_5D].style.border = gameEntity.getState('border');\r\n\t\t\t\r\n\t\tif (gameEntity.getState('borderRadius') != null && gameEntity.getState('borderRadius')!=\"Undefined\")\r\n\t\t\t_instances[p_view2_5D].style.borderRadius = gameEntity.getState('borderRadius');\r\n\t\t\t\r\n\t\tif (gameEntity.getState('boxShadow') != null && gameEntity.getState('boxShadow')!=\"Undefined\")\r\n\t\t\t_instances[p_view2_5D].style.boxShadow = gameEntity.getState('boxShadow');\r\n\t\t\t\r\n\t\tif (gameEntity.getState('fontFamily') != null && gameEntity.getState('fontFamily')!=\"Undefined\")\r\n\t\t\t_instances[p_view2_5D].style.fontFamily = gameEntity.getState('fontFamily');\r\n\t\t\t\r\n\t\tif (gameEntity.getState('textAlign') != null && gameEntity.getState('textAlign')!=\"Undefined\")\r\n\t\t\t_instances[p_view2_5D].style.textAlign = gameEntity.getState('textAlign');\r\n\t\t\t\r\n\t\tif (gameEntity.getState('textVerticalAlign') != null && gameEntity.getState('textVerticalAlign') != \"Undefined\")\r\n\t\t{\t//Huge hack..:) but I'm ok with it..\r\n\t\t\tif (gameEntity.getState('textVerticalAlign')=='middle')\r\n\t\t\t\t_instances[p_view2_5D].style.lineHeight = gameEntity.getState('height') + \"px\";\r\n\t\t}\r\n\t\t\t\r\n\t\tif (gameEntity.getState('textIndent') != null && gameEntity.getState('textIndent')!=\"Undefined\")\r\n\t\t\t_instances[p_view2_5D].style.textIndent = gameEntity.getState('textIndent');\r\n\t\t\t\r\n\t\tif (gameEntity.getState('cursor') != null && gameEntity.getState('cursor')!=\"Undefined\")\r\n\t\t\t_instances[p_view2_5D].style.cursor = gameEntity.getState('cursor');\r\n\t\t\t\r\n\t\tif (gameEntity.getState('white-space') != null && gameEntity.getState('white-space')!=\"Undefined\")\r\n\t\t\t_instances[p_view2_5D].style.whiteSpace = gameEntity.getState('white-space');\r\n\t}\r\n\t\r\n\r\n\t//much better way.. should be done for everything\r\n\tinline private function _updateImageSrc(p_src:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get the instance we're updating\r\n\t\tvar l_instance:ImageElement = _instances[p_view2_5D];\r\n\t\t\r\n\t\tif (p_src != \"Undefined\")\r\n\t\t{\r\n\t\t\t //hack.. for full length dom image urls\r\n\t\t\tif (p_src.indexOf('assets/') == -1)\r\n\t\t\t{\r\n\t\t\t\t//Normal loading (but not quite, still there's the DoNotLoad hacky thing, for Dom stuff..)\r\n\t\t\t\tvar l_asset:Asset = Project.modules[\"DoNotLoad\"].assets[p_src];\r\n\t\t\t\tl_instance.src = Project.getPath(l_asset.location, l_asset.type) + l_asset.url;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t//pass whole url hack ( and another hack for relative url)\r\n\t\t\t\tl_instance.src = \"../\" + p_src;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t//much better way.. should be done for everything\r\n\tinline private function _updateWidth(p_width:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tif (gameEntity.getState('layoutable') == true)\r\n\t\t{\r\n\t\t\t//This is bad.. put it in Space2_5D for everyone..\r\n\t\t\tgroupInstances[p_view2_5D].updateState('width');\r\n\t\t\t\r\n\t\t\t//Invalidate Layout (hack?)\r\n\t\t\tSliced.display.projectActiveSpaceReference.activeStageReference.layoutManager.validated=false;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//..\r\n\t\t}\r\n\t}\r\n\t\r\n\t//much better way.. should be done for everything\r\n\tinline private function _updateHeight(p_height:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tif (gameEntity.getState('layoutable') == true)\r\n\t\t{\r\n\t\t\t//This is bad.. put it in Space2_5D for everyone..\r\n\t\t\tgroupInstances[p_view2_5D].updateState('height');\r\n\t\t\t\r\n\t\t\t//Invalidate Layout (hack?)\r\n\t\t\tSliced.display.projectActiveSpaceReference.activeStageReference.layoutManager.validated=false;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//..\r\n\t\t}\r\n\t}\r\n\t\r\n\t//much better way.. should be done for everything\r\n\tinline private function _updateOverflow(p_overflow:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tif (p_overflow!=\"Undefined\")\r\n\t\t\t_instances[p_view2_5D].style.overflow = p_overflow;\r\n\t}\r\n\t\r\n\t//much better way.. should be done for everything\r\n\tinline private function _updateFontSize(p_fontSize:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tif (p_fontSize!=\"Undefined\")\r\n\t\t\t_instances[p_view2_5D].style.fontSize = p_fontSize;\r\n\t}\r\n\t\r\n\t//much better way.. should be done for everything\r\n\tinline private function _updateFontColor(p_fontColor:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tif (p_fontColor!=\"Undefined\")\r\n\t\t\t_instances[p_view2_5D].style.color = p_fontColor;\r\n\t}\r\n\t\r\n\t//much better way.. should be done for everything (also visibility should be for all dom elements not just ncStylables\r\n\tinline private function _updateVisibility(p_visibility:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t_instances[p_view2_5D].style.visibility = p_visibility;\r\n\t}\r\n\t\r\n\t//much better way.. should be done for everything\r\n\tinline private function _updateOpacity(p_opacity:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t_instances[p_view2_5D].style.opacity= p_opacity;\r\n\t}\r\n\t\r\n\t//much better way.. should be done for everything\r\n\tinline private function _updateDisplay(p_display:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t_instances[p_view2_5D].style.display = p_display;\r\n\t\t/*\r\n\t\tif (p_display == \"none\")\r\n\t\t\t_instances[p_view2_5D].style.setProperty(\"pointer-events\", \"none\");\r\n\t\telse\r\n\t\t\t_instances[p_view2_5D].style.setProperty(\"pointer-events\", \"auto\");*/\r\n\t}\r\n\t\r\n\t//much better way.. should be done for everything (also visibility should be for all dom elements not just ncStylables\r\n\tinline private function _updateText(p_text:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tif (p_text!=\"Undefined\")\r\n\t\t\tswitch (gameEntity.getState( 'NCmeshType' ))\r\n\t\t\t{\r\n\t\t\t\tcase \"Div\":\r\n\t\t\t\t\t_instances[p_view2_5D].innerHTML = p_text;\r\n\t\t\t\tcase \"Input\":\r\n\t\t\t\t\t_instances[p_view2_5D].value = p_text;\r\n\t\t\t\tcase \"Button\":\r\n\t\t\t\t\t_instances[p_view2_5D].innerHTML = p_text;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t//Temp way to batch everything together.. not good for updating individual properties, but good for implementing shit faast\r\n\tinline private function _updateNCmeshType(p_NCmeshType:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tswitch (p_NCmeshType)\r\n\t\t{\r\n\t\t\tcase 'Div':\r\n\t\t\t\t//...\r\n\t\t\tcase 'Button':\r\n\t\t\t\t_updateButtonProperties(p_view2_5D);\r\n\t\t\tcase 'Input':\r\n\t\t\t\t_updateInputProperties(p_view2_5D);\r\n\t\t\tcase 'Image':\r\n\t\t\t\t_updateImageSrc(gameEntity.getState('src') , p_view2_5D);\r\n\t\t\tcase 'Ace':\r\n\t\t\t\t_updateAceProperties(p_view2_5D);\r\n\t\t\tcase 'Tree':\r\n\t\t\t\t_updateTreeProperties(p_view2_5D);\r\n\t\t\tcase 'Undefined':\r\n\t\t\t\tConsole.warn('Undefined NCmeshType value');\r\n\t\t\tdefault:\r\n\t\t\t\tConsole.warn('Unhandled NCmeshType value: ' + p_NCmeshType);\r\n\t\t}\r\n\t}\r\n\t\r\n\t//Temp way to batch everything together.. not good for updating individual properties, but good for implementing shit faast\r\n\tprivate function _updateInputProperties( p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get the instance we're updating\r\n\t\tvar l_instance:InputElement = _instances[p_view2_5D];\r\n\t\t\r\n\t\tif (gameEntity.getState('text') != null && gameEntity.getState('text')!=\"Undefined\")\r\n\t\t\tl_instance.value = gameEntity.getState('text');\r\n\t\t\r\n\t\tif (gameEntity.getState('placeholder') != null && gameEntity.getState('placeholder')!=\"Undefined\")\r\n\t\t\tl_instance.placeholder = gameEntity.getState('placeholder');\r\n\t\t\t\r\n\t\tif (gameEntity.getState('type') != null && gameEntity.getState('type')!=\"Undefined\")\r\n\t\t\tl_instance.type = gameEntity.getState('type');\r\n\t\t\t\r\n\t\tif (gameEntity.getState('type') == \"file\")\r\n\t\t\tif (gameEntity.getState('accept') != null && gameEntity.getState('accept')!=\"Undefined\")\r\n\t\t\t\tl_instance.accept = gameEntity.getState('accept');\r\n\t}\r\n\t\r\n\t\r\n\t//Temp way to batch everything together.. not good for updating individual properties, but good for implementing shit faast\r\n\tprivate function _updateButtonProperties( p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get the instance we're updating\r\n\t\tvar l_instance:ButtonElement = _instances[p_view2_5D];\r\n\r\n\t\tif (gameEntity.getState('text') != null && gameEntity.getState('text')!=\"Undefined\")\r\n\t\t\tl_instance.innerHTML = gameEntity.getState('text');\r\n\t}\r\n\t\r\n\t//Temp way to batch everything together.. not good for updating individual properties, but good for implementing shit faast\r\n\tprivate function _updateAceProperties( p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get the instance we're updating\r\n\t\tvar l_instance:DivElement = _instances[p_view2_5D];\r\n\r\n\t\tl_instance.id = \"editor\";\r\n\t\tvar editor:Dynamic = untyped ace.edit(\"editor\");\r\n\t\teditor.setTheme(\"ace/theme/idle_fingers\");\r\n\t\teditor.getSession().setMode(\"ace/mode/xml\");\r\n\t\t\r\n\t\tgameEntity.setState('aceObject', editor);\r\n\t}\r\n\t\r\n\t//Temp way to batch everything together.. not good for updating individual properties, but good for implementing shit faast\r\n\tprivate function _updateTreeProperties( p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get the instance we're updating\r\n\t\tvar l_instance:DivElement = _instances[p_view2_5D];\r\n\r\n\t\tl_instance.id = \"tree\";\r\n\t\tvar tree:Dynamic = untyped $('#tree');\r\n\t\t\r\n\t\tgameEntity.setState('treeObject', tree);\r\n\t}\r\n\t\r\n\tprivate function _updateTouchable(p_touchableFlag:Bool, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Gt Mesh\r\n\t\tvar l_instance:Element = _instances[p_view2_5D];\r\n\t\t\r\n\t\tif (l_instance != null)\r\n\t\t{\r\n\t\t\tif (p_touchableFlag)\r\n\t\t\t{\r\n\t\t\t\t//@think: another way to do this without having a touchable flag it to check if there are triggers actually connected to the gameEntity that want these signals, ad play like that\r\n\t\t\t\t//also be sure to update if someone adds a trigger to the entity at runtime (do an addTrigger event, the same fashion you update states, childs, etc)\r\n\t\t\t\t//l_instance.pointerEnabled = true;\r\n\t\t\t\t\r\n\t\t\t\t/*\r\n\t\t\t\tif (!l_instance.pointerIn.hasListeners())\r\n\t\t\t\t\tl_instance.pointerIn.connect(_onPointerIn);\r\n\t\t\t\t\t\r\n\t\t\t\tif (!l_instance.pointerOut.hasListeners())\r\n\t\t\t\t\tl_instance.pointerOut.connect(_onPointerOut);\r\n\t\t\t\t*/\r\n\t\t\t\t\r\n\t\t\t\tl_instance.onclick = _onPointerClick;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t//@todo: should really consider actually removing those listeners, here.... use the disposer component thing\r\n\t\t\t\t//if you don't want to store the signal Connections..and retrieve disposer here, from the entity. Disposer way looks better anyway...\r\n\t\t\t\t//l_instance.pointerEnabled = false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\t/*\r\n\tprivate function _onPointerIn(p_pointerEvent:PointerEvent):Void\r\n\t{\r\n\t\tSliced.input.pointer.submitPointerEvent(MOUSE_ENTERED, gameEntity);\r\n\t}\r\n\t\r\n\tprivate function _onPointerOut(p_pointerEvent:PointerEvent):Void\r\n\t{\r\n\t\tSliced.input.pointer.submitPointerEvent(MOUSE_LEFT, gameEntity);\r\n\t}\r\n\t*/\r\n\tprivate function _onPointerClick(p_pointerEvent:Dynamic):Void\r\n\t{\r\n\t\tSliced.input.pointer.submitPointerEvent(MOUSE_LEFT_CLICK, gameEntity);\r\n\t}\r\n\t\r\n\tprivate function _onChange(p_changeEvent:Dynamic):Void\r\n\t{\r\n\t\t//you should emit a spark event here at some point..\r\n\t\tif (gameEntity.getState('type') == \"file\")\r\n\t\t{\r\n\t\t\tgameEntity.setState('files', p_changeEvent.target.files);\r\n\t\t\tSliced.input.pointer.submitPointerEvent(MOUSE_LEFT_CLICK, gameEntity);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tgameEntity.setState('text', p_changeEvent.target.value);\r\n\t\t}\r\n\t}\r\n}\r\n","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2014\r\n */\r\n\r\npackage tools.spark.framework.space2_5D.core;\r\n\r\nimport tools.spark.framework.space2_5D.interfaces.IEntity2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IScene2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.framework.layout.containers.Group;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.core.Sliced;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass AScene2_5D extends AInstantiable2_5D implements IScene2_5D\r\n{\r\n\tprivate function new(p_gameEntity:IGameEntity) \r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t}\r\n\t\r\n\toverride public function createInstance (p_view2_5D:IView2_5D):Dynamic\r\n\t{\r\n\t\treturn super.createInstance(p_view2_5D);\r\n\t}\r\n\t\r\n\toverride private function _createChildOfInstance(p_childEntity:IEntity2_5D, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\tif (p_childEntity.gameEntity.getState('layoutable') == true)\r\n\t\t\tp_view2_5D.group.children.push(p_childEntity.groupInstances[p_view2_5D]);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.framework.dom2_5D;\r\n\r\nimport js.html.DivElement;\r\nimport js.html.Element;\r\nimport js.Browser;\r\nimport tools.spark.framework.space2_5D.core.AScene2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IEntity2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass DomScene2_5D extends AScene2_5D\r\n{\r\n\tpublic function new(p_gameEntity:IGameEntity)\r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t\t_initDomScene2_5D();\r\n\t}\r\n\t\r\n\tprivate function _initDomScene2_5D()\r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\toverride public function createInstance (p_view2_5D:IView2_5D):Dynamic\r\n\t{\r\n\t\t_instances[p_view2_5D] = Browser.document.createDivElement();\r\n\t\t_instances[p_view2_5D].style.position = \"absolute\";\r\n\r\n\t\treturn super.createInstance(p_view2_5D);\r\n\t}\r\n\t\r\n\toverride public function update(?p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//_updateState('2DmeshType', p_view2_5D);\r\n\t\t//_updateState('spaceX',p_view2_5D);\r\n\t\t//_updateState('spaceY',p_view2_5D);\r\n\t\t//_updateState('spaceZ', p_view2_5D);\r\n\t\t\r\n\t\t//Update Children\r\n\t\tfor (f_childEntity in children)\r\n\t\t\tf_childEntity.update(p_view2_5D);\r\n\t}\r\n\t\r\n\t\r\n\toverride private function _createChildOfInstance(p_childEntity:IEntity2_5D, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//This is an 'instance' addChild... a flambe addChild..\r\n\t\t_instances[p_view2_5D].appendChild(cast(p_childEntity.createInstance(p_view2_5D), Element));\r\n\t\t\r\n\t\tsuper._createChildOfInstance(p_childEntity, p_view2_5D);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2014\r\n */\r\n\r\npackage tools.spark.framework.space2_5D.core;\r\n\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IScene2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.ICamera2_5D;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.framework.layout.containers.Group;\r\nimport tools.spark.sliced.core.Sliced;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass AView2_5D extends ABase2_5D implements IView2_5D\r\n{\r\n\tpublic var scene( default, set ):IScene2_5D;\r\n\tpublic var camera( default, set ):ICamera2_5D;\r\n\tpublic var group( default, null ):Group;\r\n\t\r\n\tprivate function new(p_gameEntity:IGameEntity) \r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t\t\r\n\t\tgroup = Sliced.display.projectActiveSpaceReference.activeStageReference.layoutManager.getViewGroupByGameEntity(gameEntity);\r\n\t\t//Console.error(\"did recursion while looking for: \" + gameEntity.getState('name') + \", and found this: \" + group.layoutableEntity.getState('name'));\r\n\t\tgroup.layoutableInstance = this;\r\n\t\t\r\n\t\t//if (gameEntity.getState('layoutable') == true)\r\n\t\t\t//group = new GroupSpace2_5D(\"view\", null, this);\r\n\t\t\t\r\n\t\t//do Layout Call??????????????\r\n\t\t//...\r\n\t}\r\n\t\r\n\tpublic function render():Void\r\n\t{\r\n\t\t//override me\r\n\t}\r\n\t\r\n\tprivate function set_camera( v : ICamera2_5D ) : ICamera2_5D {\r\n        return camera = v;\r\n    }\r\n\t\r\n\tprivate function set_scene( v : IScene2_5D ) : IScene2_5D {\r\n        return scene = v;\r\n    }\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.framework.dom2_5D;\r\n\r\nimport tools.spark.framework.layout.containers.Group;\r\nimport tools.spark.framework.space2_5D.core.AView2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.ICamera2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IEntity2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IScene2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.core.Sliced;\r\nimport js.Browser;\r\nimport js.html.Document;\r\nimport js.html.Element;\r\nimport js.html.InputElement;\r\nimport js.html.DivElement;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass DomView2_5D extends AView2_5D\r\n{\r\n\tprivate var _instanceView:DivElement;\r\n\tprivate var _instanceScene:DivElement;\r\n\t\r\n\tpublic function new(p_gameEntity:IGameEntity) \r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t\t\r\n\t\t_initDomView2_5D();\r\n\t}\r\n\t\r\n\tpublic function updateState(p_state:String):Void\r\n\t{\r\n\t\tswitch (p_state)\r\n\t\t{\r\n\t\t\tcase 'visible':\r\n\t\t\t\tif (gameEntity.getState(p_state)==true)\r\n\t\t\t\t\t_instanceView.style.display = \"inline\";\r\n\t\t\t\telse\r\n\t\t\t\t\t_instanceView.style.display = \"none\";\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate inline function _initDomView2_5D():Void\r\n\t{\t\r\n\t\tvar content:Element = Browser.document.getElementById(\"content\");\r\n\t\t\r\n\t\t_instanceView = Browser.document.createDivElement();\r\n\t\t_instanceView.style.position = \"absolute\";\r\n\t\t\r\n\t\t//Add to 'stage'\r\n\t\tcontent.insertBefore(_instanceView, content.firstElementChild);\r\n\t}\r\n\t\r\n\t\r\n\t//i think this belongs to AView2_5D instead.. i don't see any flambe relevant code...\r\n\toverride private function set_camera( p_value : ICamera2_5D ) : ICamera2_5D \r\n\t{\r\n\t\t//If the camera is already attached to this view, do nothing\r\n\t\tif (camera == p_value)\r\n\t\t\treturn camera;\r\n\t\t\t\r\n\t\tif (p_value == null)\r\n\t\t{\r\n\t\t\tcamera = null;\r\n\t\t\t//_disposeCurrentCamera();\r\n\t\t\t_updateCurrentView();\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\t\r\n\t\t//attach camera\r\n\t\tcamera = p_value;\r\n\t\tcamera.attachToView(this);\r\n\t\t\r\n\t\t//UPDATE VIEW\r\n\t\t_updateCurrentView();\r\n\t\t\r\n\t\treturn camera;\r\n    }\r\n\t\r\n\t//i think this belongs to AView2_5D instead.. i don't see any flambe relevant code...\r\n\toverride private function set_scene( p_value : IScene2_5D ) : IScene2_5D \r\n\t{\r\n\t\t//If the scene is already attached to this view, do nothing\r\n\t\tif (scene == p_value)\r\n\t\t\treturn scene;\r\n\t\t\r\n\t\t//This means, everything should be destroyed.. except, if you want to keep them and just 'remove them from stage'\r\n\t\tif (p_value == null)\r\n\t\t{\r\n\t\t\tscene = null;\r\n\t\t\t_disposeCurrentScene();\r\n\t\t\t_updateCurrentView();\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\t\r\n\t\t//@todo: remove previous scene, possibly dispose a lot of stuff..\r\n\t\t//if I actually do NOT remove the entity instances of a scene of a view here, then when that scene is readded below,\r\n\t\t//check if their entities correspond with this view before creating them again\r\n\t\t//if (scene!=null)\r\n\t\t//...\r\n\t\t\r\n\t\t//Instanciate current scene\r\n\t\tscene = p_value;\r\n\t\t_instanceScene = cast(scene.createInstance(this), DivElement);\r\n\t\t\r\n\t\t//LAYOUT MANAGER\r\n\t\t//if (gameEntity.getState('layoutable') == true)\r\n\t\t\t//..\r\n\t\t\r\n\t\t//UPDATE VIEW\r\n\t\t_updateCurrentView();\r\n\t\t\r\n        return scene;\r\n    }\r\n\t\r\n\t\r\n\t//i think this belongs to AView2_5D instead.. i don't see any flambe relevant code... or is there...\r\n\t//or maybe there is.. just override and keep the for loop in AView2_5D instead\r\n\tprivate function _updateCurrentView():Void\r\n\t{\r\n\t\t//If scene or camera is not found, if scene instance in on a view, remove it, then quit\r\n\t\tif (scene == null || camera == null)\r\n\t\t{\r\n\t\t\t//if it's added already, remove it\r\n\t\t\tif (_instanceView.firstElementChild!=null)\r\n\t\t\t\t_instanceView.removeChild(_instanceView.firstElementChild);\r\n\t\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t//Update Scene\r\n\t\t\r\n\t\t//If scene not added yet, add it\r\n\t\tif (_instanceView.firstElementChild==null)\r\n\t\t\t_instanceView.appendChild(_instanceScene);\r\n\t\t\t\r\n\t\t\t\r\n\t\t//Update it\r\n\t\tscene.update(this);\r\n\t}\r\n\t\r\n\tprivate function _disposeCurrentScene():Void\r\n\t{\r\n\t\t_instanceScene = null;\r\n\t}\r\n\t\r\n\toverride public function setPosSize(?p_x:Null<Float>, ?p_y:Null<Float>, ?p_width:Null<Float>, ?p_height:Null<Float>, ?p_view:IView2_5D):Void\r\n\t{\r\n\t\tif (p_x != null) _instanceView.style.left = Std.string(p_x) + \"px\";\r\n\t\tif (p_y != null) _instanceView.style.top = Std.string(p_y) + \"px\";\r\n\t\tif (p_width != null) _instanceView.style.width = Std.string(p_width) + \"px\";\r\n\t\tif (p_height != null) _instanceView.style.height = Std.string(p_height) + \"px\";\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2014\r\n */\r\n\r\npackage tools.spark.framework.flambe2_5D;\r\n\r\nimport tools.spark.framework.space2_5D.core.ACamera2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass FlambeCamera2_5D extends ACamera2_5D\r\n{\r\n\tpublic function new(p_gameEntity:IGameEntity)\r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2014\r\n */\r\n\r\npackage tools.spark.framework.flambe2_5D;\r\n\r\nimport flambe.display.FillSprite;\r\nimport flambe.display.ImageSprite;\r\nimport flambe.display.Sprite;\r\nimport flambe.Entity;\r\nimport flambe.input.PointerEvent;\r\nimport flambe.math.Rectangle;\r\nimport tools.spark.framework.space2_5D.core.AEntity2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IEntity2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport flambe.display.BlendMode;\r\nimport tools.spark.sliced.core.Sliced;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EEventType;\r\nimport spriter.flambe.SpriterMovie;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass FlambeEntity2_5D extends AEntity2_5D\r\n{\r\n\tprivate var _instancesMesh:Map<IView2_5D,Sprite>;\r\n\t\r\n\tpublic function new(p_gameEntity:IGameEntity) \r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t\t_initFlambeEntity2_5D();\r\n\t}\r\n\t\r\n\tprivate function _initFlambeEntity2_5D()\r\n\t{\r\n\t\t_instancesMesh = new Map<IView2_5D,Sprite>();\r\n\t\t\r\n\t\t_updateStateFunctions['2DmeshType'] = _update2DMeshType; //this will also update nested states here like 2DMeshImageForm,..\r\n\t\t_updateStateFunctions['spaceX'] = _updatePositionX; //for pure 2d.. for 3d coordinates, its not that simple..\r\n\t\t_updateStateFunctions['spaceY'] = _updatePositionY; //for pure 2d.. for 3d coordinates, its not that simple..\r\n\t\t_updateStateFunctions['scaleX'] = _updateSizeX; //for pure 2d.. for 3d coordinates, its not that simple..\r\n\t\t_updateStateFunctions['scaleY'] = _updateSizeY; //for pure 2d.. for 3d coordinates, its not that simple..\r\n\t\t_updateStateFunctions['touchable'] = _updateTouchable;\r\n\t\t_updateStateFunctions['visible'] = _updateVisible;\r\n\t\t_updateStateFunctions['opacity'] = _updateOpacity;\r\n\t\t_updateStateFunctions['spaceWidth'] = _updateSpaceWidth;\t//this is iffy.. should do it with forms instead\r\n\t\t_updateStateFunctions['spaceHeight'] = _updateSpaceHeight;\t//this is iffy.. should do it with forms instead\r\n\t\t_updateStateFunctions['2DMeshImageForm'] = _update2DMeshImageForm;\r\n\t\t_updateStateFunctions['2DMeshSpriterForm'] = _update2DMeshSpriterForm;\r\n\t\t_updateStateFunctions['2DMeshFillRectForm'] = _update2DMeshFillRectForm;\r\n\t\t_updateStateFunctions['2DMeshSpriteForm'] = _update2DMeshSpriteForm;\r\n\t\t_updateStateFunctions['2DMeshSpriterAnimForm'] = _update2DMeshSpriterAnimForm;\r\n\t}\r\n\t\r\n\t\r\n\toverride public function createInstance (p_view2_5D:IView2_5D):Dynamic\r\n\t{\r\n\t\t_instances[p_view2_5D] = new Entity();\r\n\t\t\r\n\t\treturn super.createInstance(p_view2_5D);\r\n\t}\r\n\r\n\toverride private function _createChildOfInstance(p_childEntity:IEntity2_5D, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//This is an 'instance' addChild... a flambe addChild..\r\n\t\t_instances[p_view2_5D].addChild(cast(p_childEntity.createInstance(p_view2_5D), Entity));\r\n\t\t\r\n\t\tsuper._createChildOfInstance(p_childEntity, p_view2_5D);\r\n\t}\r\n\r\n\toverride public function update(?p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t_updateState('2DmeshType', p_view2_5D); //THIS NEEDS TO BE FIRST AT THE UPDATE TO GET THE SPRITE!!!!!!\r\n\t\t\r\n\t\tif (gameEntity.getState('layoutable') == null || gameEntity.getState('layoutable') == false)\r\n\t\t{\r\n\t\t\t_updateState('spaceX',p_view2_5D);\r\n\t\t\t_updateState('spaceY', p_view2_5D);\r\n\t\t}\r\n\t\t//_updateState('spaceZ', p_view2_5D);\r\n\t\t\r\n\t\t_updateState('scaleX',p_view2_5D);\r\n\t\t_updateState('scaleY',p_view2_5D);\r\n\t\t//_updateState('scaleZ', p_view2_5D);\r\n\t\t\r\n\t\t_updateState('touchable', p_view2_5D);\r\n\t\t\r\n\t\t_updateState('visible', p_view2_5D);\r\n\t\t\r\n\t\t_updateState('opacity', p_view2_5D);\r\n\t\t//_updateState('2DMeshImageForm', p_view2_5D); //this is nested.. not for global update i think\r\n\t\t//_updateState('2DMeshSpriterForm', p_view2_5D); //this is nested.. not for global update i think\r\n\t\t//more spriter nested things exist also don't update them\r\n\t\t\r\n\t\t\r\n\t\t//Update my layoutObject\r\n\t\tif (gameEntity.getState('layoutable') == true)\r\n\t\t\t_updateLayoutGroup(p_view2_5D);\r\n\t\t\r\n\t\t//Update Children\r\n\t\tfor (f_childEntity in children)\r\n\t\t\tf_childEntity.update(p_view2_5D);\r\n\t}\r\n\t\r\n\t\r\n\tinline private function _update2DMeshType(p_2DMeshType:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get the instance we're updating\r\n\t\tvar l_instance:Entity = _instances[p_view2_5D];\r\n\t\t\r\n\t\t//If sprite already has a mesh and it's the same do nothing?? or maybe, update its form??\r\n\t\t//...\r\n\t\t\r\n\t\t//if sprite already has a different mesh, remove it as a component and discard previous..right? yes here yes... if not defined yet?\r\n\t\t//@todo: DISCARD PREVIOUS MESH INSTANCE AND EVERYTHING IN IT, IF ANY\r\n\t\t//if (_instancesMesh[p_view2_5D]!=null)\r\n\t\t//...\r\n\t\t\r\n\t\t//If there's actually a change from one meshtype, to another, after you've cleared all previous meshes and shit\r\n\t\t//see if we can actually create the mesh, if the property is also set\r\n\t\tswitch (p_2DMeshType) //this is where our state nesting happens for diplay form stuff\r\n\t\t{\r\n\t\t\tcase 'Image':\r\n\t\t\t\t_updateStateOfInstance('2DMeshImageForm', p_view2_5D);\r\n\t\t\tcase 'Spriter':\r\n\t\t\t\t_updateStateOfInstance('2DMeshSpriterForm', p_view2_5D);\r\n\t\t\tcase 'FillRect':\r\n\t\t\t\t_updateStateOfInstance('2DMeshFillRectForm', p_view2_5D);\r\n\t\t\tcase 'Sprite':\r\n\t\t\t\t_updateStateOfInstance('2DMeshSpriteForm', p_view2_5D);\r\n\t\t\tcase 'Undefined':\r\n\t\t\t\tConsole.warn('Undefined 2DmeshType value');\r\n\t\t\tdefault:\r\n\t\t\t\tConsole.warn('Unhandled 2DmeshType value: ' + p_2DMeshType);\r\n\t\t}\r\n\t\t\r\n\t\t//Feedback back to the game Entity about the Entities Size (lil bit of a hack, if many views render the same scene,\r\n\t\t//then this is updated with the last rendered view)\r\n\t\t_updateBounds(p_view2_5D);\r\n\t\t\r\n\t\t//@think: if old mesh is lost, should probably update touchable too, since signals would be lost as well\r\n\t\t//and again.. old signals MUST be disposed.. for memory leaks...\r\n\t}\r\n\r\n\tprivate function _update2DMeshImageForm(p_2DMeshImageForm:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//If the Entity's mesh type is not image, ignore this update\r\n\t\tif (gameEntity.getState('2DmeshType') != 'Image')\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\t//If the Form Name is Undefined, ignore this update\r\n\t\tif (p_2DMeshImageForm == 'Undefined')\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\t//Get the instance we're updating\r\n\t\tvar l_instance:Entity = _instances[p_view2_5D];\r\n\t\t\r\n\t\tvar l_mesh:ImageSprite;\r\n\t\t\r\n\t\tif (_instancesMesh[p_view2_5D]!=null)\t//Get it's existing mesh, if any\r\n\t\t\tl_mesh= cast(_instancesMesh[p_view2_5D],ImageSprite); //(the cast should always work due to logic.. but not very sure..)\r\n\t\telse\r\n\t\t\tl_mesh = null;\r\n\t\t\t\r\n\t\t\t\r\n\t\tif (l_mesh == null)\r\n\t\t{\r\n\t\t\tl_mesh = new ImageSprite(Assets.getTexture(gameEntity.gameForm.getState( p_2DMeshImageForm )));\r\n\t\t\tl_mesh.blendMode = BlendMode.Copy;\r\n\t\t\tl_instance.add(l_mesh);\r\n\t\t\t_instancesMesh[p_view2_5D] = l_mesh;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tl_mesh.texture = Assets.getTexture(gameEntity.gameForm.getState( p_2DMeshImageForm ));\t\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _update2DMeshSpriterForm(p_2DMeshSpriterForm:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//If the Entity's mesh type is not spriter, ignore this update\r\n\t\tif (gameEntity.getState('2DmeshType') != 'Spriter')\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\t//If the Form Name is Undefined, ignore this update\r\n\t\tif (p_2DMeshSpriterForm == 'Undefined')\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\t//Get the instance we're updating\r\n\t\tvar l_instance:Entity = _instances[p_view2_5D];\r\n\t\t\r\n\t\t//Get it's existing mesh, if any. Not sure if this mesh is guaranteed to be a mesh used previously by spriter, or something else.\r\n\t\t//should be fine due to logic but not sure. by logic i mean, if we update 2dmeshtype it will always reset mesh and stuff\r\n\t\tvar l_mesh:Sprite = _instancesMesh[p_view2_5D];\r\n\t\t\r\n\t\tif (l_mesh == null)\r\n\t\t{\r\n\t\t\tl_mesh = new Sprite();\r\n\t\t\tvar l_SpriterFormName:String = gameEntity.gameForm.getState( p_2DMeshSpriterForm );\r\n\t\t\tvar l_spriterMovie:SpriterMovie = new SpriterMovie(Assets.getAssetPackOf(l_SpriterFormName), l_SpriterFormName, null); //this null thing is supposed to be character name (string).. doesn't work though... always plays first character found\r\n\t\t\tl_mesh.blendMode = BlendMode.Copy;\r\n\t\t\tl_instance.add(l_mesh);\r\n\t\t\tl_instance.add( l_spriterMovie);\r\n\t\t\t_instancesMesh[p_view2_5D] = l_mesh;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//l_mesh.texture = Assets.getTexture(gameEntity.gameForm.getState( l_imageForm ));\t\r\n\t\t}\r\n\t\t\r\n\t\t//Play Animation (nesting)\r\n\t\t_updateStateOfInstance('2DMeshSpriterAnimForm', p_view2_5D);\r\n\t}\r\n\t\r\n\tprivate function _update2DMeshFillRectForm(p_2DMeshFillRectForm:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//If the Entity's mesh type is not image, ignore this update\r\n\t\tif (gameEntity.getState('2DmeshType') != 'FillRect')\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\t//If the Form Name is Undefined, ignore this update\r\n\t\tif (p_2DMeshFillRectForm == 'Undefined')\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\t//Get the instance we're updating\r\n\t\tvar l_instance:Entity = _instances[p_view2_5D];\r\n\t\t\r\n\t\tvar l_mesh:FillSprite;\r\n\t\t\r\n\t\tif (_instancesMesh[p_view2_5D]!=null)\t//Get it's existing mesh, if any\r\n\t\t\tl_mesh= cast(_instancesMesh[p_view2_5D],FillSprite); //(the cast should always work due to logic.. but not very sure..)\r\n\t\telse\r\n\t\t\tl_mesh = null;\r\n\t\t\t\r\n\t\t\t\r\n\t\tif (l_mesh == null)\r\n\t\t{\r\n\t\t\t//do Layout Call??????????????\r\n\t\t\t//...\r\n\t\t\t\r\n\t\t\t//if (gameEntity.getState('layoutable') == true)\r\n\t\t\t\t//l_mesh = new FillSprite(gameEntity.gameForm.getState( p_2DMeshFillRectForm ),groupInstances[p_view2_5D].width, groupInstances[p_view2_5D].height);\r\n\t\t\tl_mesh = new FillSprite(gameEntity.gameForm.getState( p_2DMeshFillRectForm ),gameEntity.getState( 'spaceWidth' ), gameEntity.getState( 'spaceHeight' ));\r\n\t\t\tl_mesh.blendMode = BlendMode.Copy;\r\n\t\t\tl_instance.add(l_mesh);\r\n\t\t\t_instancesMesh[p_view2_5D] = l_mesh;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//l_mesh.color =\r\n\t\t\t//l_mesh.setSize = \r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _update2DMeshSpriteForm(p_2DMeshSpriteForm:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//If the Entity's mesh type is not image, ignore this update\r\n\t\tif (gameEntity.getState('2DmeshType') != 'Sprite')\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\t//If the Form Name is Undefined, ignore this update\r\n\t\tif (p_2DMeshSpriteForm == 'Undefined')\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\t//Get the instance we're updating\r\n\t\tvar l_instance:Entity = _instances[p_view2_5D];\r\n\t\t\r\n\t\tvar l_mesh:Sprite;\r\n\t\t\r\n\t\tif (_instancesMesh[p_view2_5D]!=null)\t//Get it's existing mesh, if any\r\n\t\t\tl_mesh= cast(_instancesMesh[p_view2_5D],Sprite); //(the cast should always work due to logic.. but not very sure..)\r\n\t\telse\r\n\t\t\tl_mesh = null;\r\n\t\t\t\r\n\t\t\t\r\n\t\tif (l_mesh == null)\r\n\t\t{\r\n\t\t\tl_mesh = new Sprite();\r\n\t\t\tl_mesh.blendMode = BlendMode.Copy;\r\n\t\t\t\r\n\t\t\t//do Layout Call??????????????\r\n\t\t\t//...\r\n\t\t\t//if (gameEntity.getState('layoutable') == true)\r\n\r\n\t\t\t\t\r\n\t\t\tl_instance.add(l_mesh);\r\n\t\t\t_instancesMesh[p_view2_5D] = l_mesh;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//l_mesh.color =\r\n\t\t\t//l_mesh.setSize = \r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _update2DMeshSpriterAnimForm(p_2DMeshSpriterAnimForm:String, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//If the Entity's mesh type is not spriter, ignore this update\r\n\t\tif (gameEntity.getState('2DmeshType') != 'Spriter')\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\t//If the Entity's mesh type is not spriter, ignore this update\r\n\t\tif (gameEntity.getState('2DMeshSpriterForm') == 'Undefined')\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\t//If the Form Name is Undefined, ignore this update\r\n\t\tif (p_2DMeshSpriterAnimForm == 'Undefined')\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\t//Get the instance we're updating\r\n\t\tvar l_instance:Entity = _instances[p_view2_5D];\r\n\t\t\r\n\t\t//Get it's existing mesh, if any. Not sure if this mesh is guaranteed to be a mesh used previously by spriter, or something else.\r\n\t\t//should be fine due to logic but not sure. by logic i mean, if we update 2dmeshtype it will always reset mesh and stuff\r\n\t\tvar l_spriterMovie:SpriterMovie = l_instance.get(SpriterMovie);\r\n\t\t\r\n\t\tif (l_spriterMovie != null)\r\n\t\t{\r\n\t\t\tl_spriterMovie.playAnim(gameEntity.gameForm.getState( p_2DMeshSpriterAnimForm ));\r\n\t\t}\r\n\t}\r\n\t\r\n\r\n\t//@todo: for pure 2d.. for 3d coordinates, its not that simple..\r\n\tinline private function _updatePositionX(p_newPos:Int, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get Mesh\r\n\t\tvar l_mesh:Sprite = _instancesMesh[p_view2_5D];\r\n\t\t\r\n\t\tif (l_mesh != null) //this really nesseccery?\r\n\t\t\tl_mesh.x._ = p_newPos;\r\n\t}\r\n\t\r\n\t//@todo: for pure 2d.. for 3d coordinates, its not that simple..\r\n\tinline private function _updatePositionY(p_newPos:Int, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get Mesh\r\n\t\tvar l_mesh:Sprite = _instancesMesh[p_view2_5D];\r\n\t\t\r\n\t\tif (l_mesh != null) //this really nesseccery?\r\n\t\t\tl_mesh.y._ = p_newPos;\r\n\t}\r\n\t\r\n\t//@todo: for pure 2d.. for 3d coordinates, its not that simple..\r\n\tinline private function _updateSizeX(p_newScale:Float, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get Mesh\r\n\t\tvar l_mesh:Sprite = _instancesMesh[p_view2_5D];\r\n\t\t\r\n\t\tif (l_mesh != null)\r\n\t\t\tl_mesh.scaleX._ = p_newScale;\r\n\t}\r\n\t\r\n\t//@todo: for pure 2d.. for 3d coordinates, its not that simple..\r\n\tinline private function _updateSizeY(p_newScale:Float, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get Mesh\r\n\t\tvar l_mesh:Sprite = _instancesMesh[p_view2_5D];\r\n\t\t\r\n\t\tif (l_mesh != null)\r\n\t\t\tl_mesh.scaleY._ = p_newScale;\r\n\t}\r\n\t\r\n\tprivate function _updateVisible(p_visibleFlag:Bool, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get Mesh\r\n\t\tvar l_mesh:Sprite = _instancesMesh[p_view2_5D];\r\n\t\t\r\n\t\tif (l_mesh != null)\r\n\t\t{\r\n\t\t\tl_mesh.visible = p_visibleFlag;\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _updateOpacity(p_opacity:Float, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get Mesh\r\n\t\tvar l_mesh:Sprite = _instancesMesh[p_view2_5D];\r\n\t\t\r\n\t\tif (l_mesh != null)\r\n\t\t{\r\n\t\t\tl_mesh.setAlpha(p_opacity);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate function _updateTouchable(p_touchableFlag:Bool, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Gt Mesh\r\n\t\tvar l_mesh:Sprite = _instancesMesh[p_view2_5D];\r\n\t\t\r\n\t\tif (l_mesh != null)\r\n\t\t{\r\n\t\t\tif (p_touchableFlag)\r\n\t\t\t{\r\n\t\t\t\t//@think: another way to do this without having a touchable flag it to check if there are triggers actually connected to the gameEntity that want these signals, ad play like that\r\n\t\t\t\t//also be sure to update if someone adds a trigger to the entity at runtime (do an addTrigger event, the same fashion you update states, childs, etc)\r\n\t\t\t\tl_mesh.pointerEnabled = true;\r\n\t\t\t\t\r\n\t\t\t\tif (!l_mesh.pointerIn.hasListeners())\r\n\t\t\t\t\tl_mesh.pointerIn.connect(_onPointerIn);\r\n\t\t\t\t\t\r\n\t\t\t\tif (!l_mesh.pointerMove.hasListeners())\r\n\t\t\t\t\tl_mesh.pointerMove.connect(_onPointerMove);\r\n\t\t\t\t\t\r\n\t\t\t\tif (!l_mesh.pointerOut.hasListeners())\r\n\t\t\t\t\tl_mesh.pointerOut.connect(_onPointerOut);\r\n\t\t\t\t\t\r\n\t\t\t\tif (!l_mesh.pointerDown.hasListeners())\r\n\t\t\t\t\tl_mesh.pointerDown.connect(_onPointerDown);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t//@todo: should really consider actually removing those listeners, here.... use the disposer component thing\r\n\t\t\t\t//if you don't want to store the signal Connections..and retrieve disposer here, from the entity. Disposer way looks better anyway...\r\n\t\t\t\t//l_mesh.pointerEnabled = false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\t\r\n\tinline private function _updateRotation():Void\r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\tprivate function _onPointerIn(p_pointerEvent:PointerEvent):Void\r\n\t{\r\n\t\tSliced.input.pointer.submitPointerEvent(MOUSE_ENTERED, gameEntity);\r\n\t}\r\n\t\r\n\tprivate function _onPointerMove(p_pointerEvent:PointerEvent):Void\r\n\t{\r\n\t\tSliced.input.pointer.submitPointerEvent(MOUSE_MOVED, gameEntity);\r\n\t}\r\n\t\r\n\tprivate function _onPointerOut(p_pointerEvent:PointerEvent):Void\r\n\t{\r\n\t\tSliced.input.pointer.submitPointerEvent(MOUSE_LEFT, gameEntity);\r\n\t}\r\n\t\r\n\tprivate function _onPointerDown(p_pointerEvent:PointerEvent):Void\r\n\t{\r\n\t\tSliced.input.pointer.submitPointerEvent(MOUSE_LEFT_CLICK, gameEntity);\r\n\t}\r\n\t\r\n\toverride public function setPosSize(?p_x:Null<Float>, ?p_y:Null<Float>, ?p_width:Null<Float>, ?p_height:Null<Float>, ?p_view:IView2_5D):Void\r\n\t{\r\n\t\t//Get Mesh\r\n\t\tvar l_mesh:Sprite = _instancesMesh[p_view];\r\n\t\t//Console.error(\"RESIZING: \" + gameEntity.getState('name') + '. width: ' + p_width + ', height: ' + p_height);\r\n\t\tif (l_mesh != null)\t\t\r\n\t\t{\r\n\t\t\tif (p_x != null) l_mesh.x._ = p_x;\r\n\t\t\tif (p_y != null) l_mesh.y._ = p_y;\r\n\t\t\t//if (p_width != null) l_mesh.scissor.width = p_width;\r\n\t\t\t//if (p_height != null) l_mesh.scissor.height = p_height;\r\n\t\t}\r\n\t\t\r\n\t\tvar l_instance:Entity = _instances[p_view];\r\n\t\tvar l_fillSprite:FillSprite = l_instance.get(FillSprite);\r\n\t\t\r\n\t\tif (l_fillSprite != null) \r\n\t\t{\r\n\t\t\tl_fillSprite.setSize(p_width,p_height);\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _updateSpaceWidth(p_spaceWidth:Float, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get Mesh\r\n\t\tvar l_instance:Entity = _instances[p_view2_5D];\r\n\t\tvar l_fillSprite:FillSprite = l_instance.get(FillSprite);\r\n\t\t\r\n\t\tif (l_fillSprite != null) \r\n\t\t{\r\n\t\t\tl_fillSprite.width._ = p_spaceWidth;\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _updateSpaceHeight(p_spaceHeight:Float, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get Mesh\r\n\t\tvar l_instance:Entity = _instances[p_view2_5D];\r\n\t\tvar l_fillSprite:FillSprite = l_instance.get(FillSprite);\r\n\t\t\r\n\t\tif (l_fillSprite != null) \r\n\t\t{\r\n\t\t\tl_fillSprite.height._ = p_spaceHeight;\r\n\t\t}\r\n\t}\r\n\t\r\n\t//Feedback back to the game Entity\r\n\tprivate function _updateBounds(p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//Get Entity\r\n\t\tvar l_instance:Entity = _instances[p_view2_5D];\r\n\r\n\t\tif (l_instance != null)\r\n\t\t{\r\n\t\t\tgameEntity.setState('boundsRect', Sprite.getBounds(l_instance));\r\n\t\t}\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2014\r\n */\r\n\r\npackage tools.spark.framework.flambe2_5D;\r\n\r\nimport flambe.Entity;\r\nimport tools.spark.framework.space2_5D.core.AScene2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IEntity2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass FlambeScene2_5D extends AScene2_5D\r\n{\r\n\tpublic function new(p_gameEntity:IGameEntity)\r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t\t_initFlambeScene2_5D();\r\n\t}\r\n\t\r\n\tprivate function _initFlambeScene2_5D()\r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\toverride public function createInstance (p_view2_5D:IView2_5D):Dynamic\r\n\t{\r\n\t\t_instances[p_view2_5D] = new Entity();\r\n\r\n\t\treturn super.createInstance(p_view2_5D);\r\n\t}\r\n\t\r\n\toverride public function update(?p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//_updateState('2DmeshType', p_view2_5D);\r\n\t\t//_updateState('spaceX',p_view2_5D);\r\n\t\t//_updateState('spaceY',p_view2_5D);\r\n\t\t//_updateState('spaceZ', p_view2_5D);\r\n\t\t\r\n\t\t//Update Children\r\n\t\tfor (f_childEntity in children)\r\n\t\t\tf_childEntity.update(p_view2_5D);\r\n\t}\r\n\t\r\n\t\r\n\toverride private function _createChildOfInstance(p_childEntity:IEntity2_5D, p_view2_5D:IView2_5D):Void\r\n\t{\r\n\t\t//This is an 'instance' addChild... a flambe addChild..\r\n\t\t_instances[p_view2_5D].addChild(cast(p_childEntity.createInstance(p_view2_5D), Entity));\r\n\t\t\r\n\t\tsuper._createChildOfInstance(p_childEntity, p_view2_5D);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2014\r\n */\r\n\r\npackage tools.spark.framework.flambe2_5D;\r\n\r\nimport flambe.display.FillSprite;\r\nimport flambe.platform.InternalGraphics;\r\nimport flambe.math.Rectangle;\r\nimport tools.spark.framework.layout.containers.Group;\r\nimport tools.spark.framework.space2_5D.core.AView2_5D;\r\nimport flambe.Entity;\r\nimport flambe.display.Sprite;\r\nimport flambe.display.BlendMode;\r\nimport tools.spark.framework.space2_5D.interfaces.ICamera2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IEntity2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IScene2_5D;\r\nimport flambe.System;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass FlambeView2_5D extends AView2_5D\r\n{\r\n\tprivate var _flambeGraphics:InternalGraphics;\r\n\tprivate var _instanceView:Entity;\r\n\tprivate var _instanceScene:Entity;\r\n\t\r\n\t\r\n\tpublic function new(p_gameEntity:IGameEntity, p_flambeGraphics:InternalGraphics) \r\n\t{\r\n\t\tsuper(p_gameEntity);\r\n\t\t\r\n\t\t_flambeGraphics = p_flambeGraphics;\r\n\t\t\r\n\t\t_initFlambeView2_5D();\r\n\t}\r\n\t\r\n\tprivate inline function _initFlambeView2_5D():Void\r\n\t{\r\n\t\t_instanceView = new Entity();\r\n\t\t\r\n\t\t//var l_viewSprite:FillSprite = new FillSprite(0x00ff00,1024,580);\r\n\t\tvar l_viewSprite:Sprite = new Sprite();\r\n\t\tl_viewSprite.blendMode = BlendMode.Copy;\r\n\t\t//l_viewSprite.scissor = new Rectangle(0, 0, 640, 480);\r\n\t\t//l_viewSprite.x._ = 100;\r\n\t\t//l_viewSprite.y._ = 0;\r\n\t\t_instanceView.add(l_viewSprite);\r\n\t\t\r\n\t\t//Add flambe views that are active on root, for mouse listeners, physics, etc.. make sure you remove them if hidden, not active. remember this is for physics/event listeners only.. view will still render and be visible even if removed from the root\r\n\t\tSystem.root.addChild(_instanceView);\r\n\t}\r\n\t\r\n\toverride public function render():Void\r\n\t{\r\n\t\t//render\r\n\t\tSprite.render(_instanceView, _flambeGraphics);\r\n\t}\r\n\t\r\n\t//i think this belongs to AView2_5D instead.. i don't see any flambe relevant code...\r\n\toverride private function set_camera( p_value : ICamera2_5D ) : ICamera2_5D \r\n\t{\r\n\t\t//If the camera is already attached to this view, do nothing\r\n\t\tif (camera == p_value)\r\n\t\t\treturn camera;\r\n\t\t\t\r\n\t\tif (p_value == null)\r\n\t\t{\r\n\t\t\tcamera = null;\r\n\t\t\t//_disposeCurrentCamera();\r\n\t\t\t_updateCurrentView();\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\t\r\n\t\t//attach camera\r\n\t\tcamera = p_value;\r\n\t\tcamera.attachToView(this);\r\n\t\t\r\n\t\t//UPDATE VIEW\r\n\t\t_updateCurrentView();\r\n\t\t\r\n\t\treturn camera;\r\n    }\r\n\t\r\n\t//i think this belongs to AView2_5D instead.. i don't see any flambe relevant code...\r\n\toverride private function set_scene( p_value : IScene2_5D ) : IScene2_5D \r\n\t{\r\n\t\t//If the scene is already attached to this view, do nothing\r\n\t\tif (scene == p_value)\r\n\t\t\treturn scene;\r\n\t\t\r\n\t\t//This means, everything should be destroyed.. except, if you want to keep them and just 'remove them from stage'\r\n\t\tif (p_value == null)\r\n\t\t{\r\n\t\t\tscene = null;\r\n\t\t\t_disposeCurrentScene();\r\n\t\t\t_updateCurrentView();\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\t\r\n\t\t//@todo: remove previous scene, possibly dispose a lot of stuff..\r\n\t\t//if I actually do NOT remove the entity instances of a scene of a view here, then when that scene is readded below,\r\n\t\t//check if their entities correspond with this view before creating them again\r\n\t\t//if (scene!=null)\r\n\t\t//...\r\n\t\t\r\n\t\t//Instanciate current scene\r\n\t\tscene = p_value;\r\n\t\t_instanceScene = cast(scene.createInstance(this), Entity);\r\n\t\t\r\n\t\t//LAYOUT MANAGER\r\n\t\t//if (gameEntity.getState('layoutable') == true)\r\n\t\t\t//..\r\n\t\t\r\n\t\t//UPDATE VIEW\r\n\t\t_updateCurrentView();\r\n\t\t\r\n        return scene;\r\n    }\r\n\t\r\n\t//NEXT\r\n\t//then, see how we will add children when called by the renderers, dynamically.. later on..\r\n\t//END NEXT\r\n\t\r\n\t\r\n\t//i think this belongs to AView2_5D instead.. i don't see any flambe relevant code... or is there...\r\n\t//or maybe there is.. just override and keep the for loop in AView2_5D instead\r\n\tprivate function _updateCurrentView():Void\r\n\t{\r\n\t\t//If scene or camera is not found, if scene instance in on a view, remove it, then quit\r\n\t\tif (scene == null || camera == null)\r\n\t\t{\r\n\t\t\t//if it's added already, remove it\r\n\t\t\tif (_instanceView.firstChild!=null)\r\n\t\t\t\t_instanceView.removeChild(_instanceView.firstChild);\r\n\t\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t//Update Scene\r\n\t\t\r\n\t\t//If scene not added yet, add it\r\n\t\tif (_instanceView.firstChild==null)\r\n\t\t\t_instanceView.addChild(_instanceScene);\r\n\t\t\t\r\n\t\t\t\r\n\t\t//Update it\r\n\t\tscene.update(this);\r\n\t}\r\n\t\r\n\tprivate function _disposeCurrentScene():Void\r\n\t{\r\n\t\t_instanceScene = null;\r\n\t}\r\n\t\r\n\toverride public function setPosSize(?p_x:Null<Float>, ?p_y:Null<Float>, ?p_width:Null<Float>, ?p_height:Null<Float>, ?p_view:IView2_5D):Void\r\n\t{\r\n\t\tvar l_viewSprite:Sprite = _instanceView.get(Sprite);\r\n\t\t\r\n\t\tif (p_x != null) l_viewSprite.x._ = p_x;\r\n\t\tif (p_y != null) l_viewSprite.y._ = p_y;\r\n\t\t//if (p_width != null) l_viewSprite.scissor.width = p_width;\r\n\t\t//if (p_height != null) l_viewSprite.scissor.height = p_height;\r\n\t}\r\n}","/*\r\n * Copyright (C)2005-2012 Haxe Foundation\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a\r\n * copy of this software and associated documentation files (the \"Software\"),\r\n * to deal in the Software without restriction, including without limitation\r\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\r\n * and/or sell copies of the Software, and to permit persons to whom the\r\n * Software is furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\r\n * DEALINGS IN THE SOFTWARE.\r\n */\r\npackage tools.spark.framework.haxe;\r\n\r\n//@warning: This works, but LooseCheck has bugs. Benefit of loose check, i get good error messages, since\r\n//i check every node individually. Bad things is attribute validation won't work properly, i broke it\r\n//when modifying haxe.Check. If you need attribute validation in the future, just remove LooseCheck\r\n//and use Haxe's original Check the same way I use it in framework.config (the proper way to use Check, not check\r\n//node by node.. But the problem was, I was getting too abstract error messages, so I had to recheck all nodes,\r\n//in order to get proper messages about where the fault in the xml is.\r\n//Currently this class is used for GameClassValidator only.\r\n\r\nenum Filter {\r\n\tFInt;\r\n\tFBool;\r\n\tFEnum( values : Array<String> );\r\n\tFReg( matcher : EReg );\r\n}\r\n\r\nenum Attrib {\r\n\tAtt( name : String, ?filter : Filter, ?defvalue : String );\r\n}\r\n\r\nenum Rule {\r\n\tRNode( name : String, ?attribs : Array<Attrib>, ?childs : Rule );\r\n\tRData( ?filter : Filter );\r\n\tRMulti( rule : Rule, ?atLeastOne : Bool );\r\n\tRList( rules : Array<Rule>, ?ordered : Bool );\r\n\tRChoice( choices : Array<Rule> );\r\n\tROptional( rule : Rule );\r\n}\r\n\r\nprivate enum CheckResult {\r\n\tCMatch;\r\n\tCMissing( r : Rule );\r\n\tCExtra( x : Xml );\r\n\tCElementExpected( name : String, x : Xml );\r\n\tCDataExpected( x : Xml );\r\n\tCExtraAttrib( att : String, x : Xml );\r\n\tCMissingAttrib( att : String, x : Xml );\r\n\tCInvalidAttrib( att : String, x : Xml, f : Filter );\r\n\tCInvalidData( x : Xml, f : Filter );\r\n\tCInElement( x : Xml, r : CheckResult );\r\n}\r\n\r\nclass LooseCheck {\r\n\r\n\tstatic var blanks = ~/^[ \\r\\n\\t]*$/;\r\n\r\n\tstatic function isBlank( x : Xml ) {\r\n\t\treturn( x.nodeType == Xml.PCData && blanks.match(x.nodeValue) ) || x.nodeType == Xml.Comment;\r\n\t}\r\n\r\n\tstatic function filterMatch( s : String, f : Filter ) {\r\n\t\tswitch( f ) {\r\n\t\tcase FInt: return filterMatch(s,FReg(~/[0-9]+/));\r\n\t\tcase FBool: return filterMatch(s,FEnum([\"true\",\"false\",\"0\",\"1\"]));\r\n\t\tcase FEnum(values):\r\n\t\t\tfor( v in values )\r\n\t\t\t\tif( s == v )\r\n\t\t\t\t\treturn true;\r\n\t\t\treturn false;\r\n\t\tcase FReg(r):\r\n\t\t\treturn r.match(s);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic function isNullable( r : Rule ) {\r\n\t\tswitch( r ) {\r\n\t\tcase RMulti(r,one):\r\n\t\t\treturn( one != true || isNullable(r) );\r\n\t\tcase RList(rl,_):\r\n\t\t\tfor( r in rl )\r\n\t\t\t\tif( !isNullable(r) )\r\n\t\t\t\t\treturn false;\r\n\t\t\treturn true;\r\n\t\tcase RChoice(rl):\r\n\t\t\tfor( r in rl )\r\n\t\t\t\tif( isNullable(r) )\r\n\t\t\t\t\treturn true;\r\n\t\t\treturn false;\r\n\t\tcase RData(_):\r\n\t\t\treturn false;\r\n\t\tcase RNode(_,_,_):\r\n\t\t\treturn false;\r\n\t\tcase ROptional(_):\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic function check( x : Xml, r : Rule ) {\r\n\t\tswitch( r ) {\r\n\t\t// check the node validity\r\n\t\tcase RNode(name,attribs,childs):\r\n\t\t\tif( x.nodeType != Xml.Element || x.nodeName != name )\r\n\t\t\t\treturn CElementExpected(name, x);\r\n\t\t\tif (attribs != null) { //@larry: changed this section\r\n\t\t\t\tvar attribs = attribs.copy();\r\n\t\t\t\t// check defined attributes\r\n\t\t\t\tfor( xatt in x.attributes() ) {\r\n\t\t\t\t\tvar found = false;\r\n\t\t\t\t\tfor( att in attribs )\r\n\t\t\t\t\t\tswitch( att ) {\r\n\t\t\t\t\t\tcase Att(name,filter,_):\r\n\t\t\t\t\t\t\tif( xatt != name )\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\tif( filter != null && !filterMatch(x.get(xatt),filter) )\r\n\t\t\t\t\t\t\t\treturn CInvalidAttrib(name,x,filter);\r\n\t\t\t\t\t\t\tattribs.remove(att);\r\n\t\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tif( !found )\r\n\t\t\t\t\t\treturn CExtraAttrib(xatt,x);\r\n\t\t\t\t}\r\n\t\t\t\t// check remaining unchecked attributes\r\n\t\t\t\tfor( att in attribs )\r\n\t\t\t\t\tswitch( att ) {\r\n\t\t\t\t\tcase Att(name,_,defvalue):\r\n\t\t\t\t\t\tif( defvalue == null )\r\n\t\t\t\t\t\t\treturn CMissingAttrib(name,x);\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// check childs\r\n\t\t\tif( childs != null ) { //@larry: changed this section\r\n\t\t\t\tvar m = checkList(x.iterator(),childs);\r\n\t\t\t\tif( m != CMatch )\r\n\t\t\t\t\treturn CInElement(x, m);\r\n\t\t\t}\r\n\t\t\tif (attribs != null) { //@larry: changed this section\r\n\t\t\t\t// set default attribs values\r\n\t\t\t\tfor( att in attribs )\r\n\t\t\t\t\tswitch( att ) {\r\n\t\t\t\t\tcase Att(name,_,defvalue):\r\n\t\t\t\t\t\tx.set(name,defvalue);\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn CMatch;\r\n\t\t// check the data validity\r\n\t\tcase RData(filter):\r\n\t\t\tif( x.nodeType != Xml.PCData && x.nodeType != Xml.CData )\r\n\t\t\t\treturn CDataExpected(x);\r\n\t\t\tif( filter != null && !filterMatch(x.nodeValue,filter) )\r\n\t\t\t\treturn CInvalidData(x,filter);\r\n\t\t\treturn CMatch;\r\n\t\t// several choices\r\n\t\tcase RChoice(choices):\r\n\t\t\tif( choices.length == 0 )\r\n\t\t\t\tthrow \"No choice possible\";\r\n\t\t\tfor( c in choices )\r\n\t\t\t\tif( check(x,c) == CMatch )\r\n\t\t\t\t\treturn CMatch;\r\n\t\t\treturn check(x,choices[0]);\r\n\t\tcase ROptional(r):\r\n\t\t\treturn check(x,r);\r\n\t\tdefault:\r\n\t\t\tthrow \"Unexpected \"+Std.string(r);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic function checkList( it : Iterator<Xml>, r : Rule ) {\r\n\t\tswitch( r ) {\r\n\t\tcase RList(rules,ordered):\r\n\t\t\tvar rules = rules.copy();\r\n\t\t\tfor( x in it ) {\r\n\t\t\t\tif( isBlank(x) )\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tvar found = false;\r\n\t\t\t\tfor( r in rules ) {\r\n\t\t\t\t\tvar m = checkList([x].iterator(),r);\r\n\t\t\t\t\tif( m == CMatch ) {\r\n\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\tswitch(r) {\r\n\t\t\t\t\t\tcase RMulti(rsub,one):\r\n\t\t\t\t\t\t\tif( one ) {\r\n\t\t\t\t\t\t\t\tvar i;\r\n\t\t\t\t\t\t\t\tfor( i in 0...rules.length )\r\n\t\t\t\t\t\t\t\t\tif( rules[i] == r )\r\n\t\t\t\t\t\t\t\t\t\trules[i] = RMulti(rsub);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\trules.remove(r);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t} else if( ordered && !isNullable(r) )\r\n\t\t\t\t\t\treturn m;\r\n\t\t\t\t}\r\n\t\t\t\tif( !found )\r\n\t\t\t\t\treturn CExtra(x);\r\n\t\t\t}\r\n\t\t\tfor( r in rules )\r\n\t\t\t\tif( !isNullable(r) )\r\n\t\t\t\t\treturn CMissing(r);\r\n\t\t\treturn CMatch;\r\n\t\tcase RMulti(r,one):\r\n\t\t\tvar found = false;\r\n\t\t\tfor( x in it ) {\r\n\t\t\t\tif( isBlank(x) )\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tvar m = checkList([x].iterator(),r);\r\n\t\t\t\tif( m != CMatch )\r\n\t\t\t\t\treturn m;\r\n\t\t\t\tfound = true;\r\n\t\t\t}\r\n\t\t\tif( one && !found )\r\n\t\t\t\treturn CMissing(r);\r\n\t\t\treturn CMatch;\r\n\t\tdefault:\r\n\t\t\tvar found = false;\r\n\t\t\tfor( x in it ) {\r\n\t\t\t\tif( isBlank(x) )\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tvar m = check(x,r);\r\n\t\t\t\tif( m != CMatch )\r\n\t\t\t\t\treturn m;\r\n\t\t\t\tfound = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif( !found ) {\r\n\t\t\t\tswitch(r) {\r\n\t\t\t\tcase ROptional(_):\r\n\t\t\t\tdefault: return CMissing(r);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor( x in it ) {\r\n\t\t\t\tif( isBlank(x) )\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\treturn CExtra(x);\r\n\t\t\t}\r\n\t\t\treturn CMatch;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic function makeWhere( path : Array<Xml> ) {\r\n\t\tif( path.length == 0 )\r\n\t\t\treturn \"\";\r\n\t\tvar s = \"In \";\r\n\t\tvar first = true;\r\n\t\tfor( x in path ) {\r\n\t\t\tif( first )\r\n\t\t\t\tfirst = false;\r\n\t\t\telse\r\n\t\t\t\ts += \".\";\r\n\t\t\ts += x.nodeName;\r\n\t\t}\r\n\t\treturn s+\": \";\r\n\t}\r\n\r\n\tstatic function makeString( x : Xml ) {\r\n\t\tif( x.nodeType == Xml.Element )\r\n\t\t\treturn \"element \"+x.nodeName;\r\n\t\tvar s = x.nodeValue.split(\"\\r\").join(\"\\\\r\").split(\"\\n\").join(\"\\\\n\").split(\"\\t\").join(\"\\\\t\");\r\n\t\tif( s.length > 20 )\r\n\t\t\treturn s.substr(0,17)+\"...\";\r\n\t\treturn s;\r\n\t}\r\n\r\n\tstatic function makeRule( r : Rule ) {\r\n\t\tswitch( r ) {\r\n\t\tcase RNode(name,_,_): return \"element \"+name;\r\n\t\tcase RData(_): return \"data\";\r\n\t\tcase RMulti(r,_): return makeRule(r);\r\n\t\tcase RList(rules,_): return makeRule(rules[0]);\r\n\t\tcase RChoice(choices): return makeRule(choices[0]);\r\n\t\tcase ROptional(r): return makeRule(r);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic function makeError(m,?path) {\r\n\t\tif( path == null )\r\n\t\t\tpath = new Array();\r\n\t\tswitch( m ) {\r\n\t\tcase CMatch: throw \"assert\";\r\n\t\tcase CMissing(r):\r\n\t\t\treturn makeWhere(path)+\"Missing \"+makeRule(r);\r\n\t\tcase CExtra(x):\r\n\t\t\treturn makeWhere(path)+\"Unexpected \"+makeString(x);\r\n\t\tcase CElementExpected(name,x):\r\n\t\t\treturn makeWhere(path)+makeString(x)+\" while expected element \"+name;\r\n\t\tcase CDataExpected(x):\r\n\t\t\treturn makeWhere(path)+makeString(x)+\" while data expected\";\r\n\t\tcase CExtraAttrib(att,x):\r\n\t\t\tpath.push(x);\r\n\t\t\treturn makeWhere(path)+\"unexpected attribute \"+att;\r\n\t\tcase CMissingAttrib(att,x):\r\n\t\t\tpath.push(x);\r\n\t\t\treturn makeWhere(path)+\"missing required attribute \"+att;\r\n\t\tcase CInvalidAttrib(att,x,_):\r\n\t\t\tpath.push(x);\r\n\t\t\treturn makeWhere(path)+\"invalid attribute value for \"+att;\r\n\t\tcase CInvalidData(x,_):\r\n\t\t\treturn makeWhere(path)+\"invalid data format for \"+makeString(x);\r\n\t\tcase CInElement(x,m):\r\n\t\t\tpath.push(x);\r\n\t\t\treturn makeError(m,path);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic static function checkNode( x : Xml, r : Rule ) {\r\n\t\tvar m = checkList([x].iterator(),r);\r\n\t\tif( m == CMatch )\r\n\t\t\treturn;\r\n\t\tthrow makeError(m);\r\n\t}\r\n\r\n\tpublic static function checkDocument( x : Xml, r : Rule ) {\r\n\t\tif( x.nodeType != Xml.Document )\r\n\t\t\tthrow \"Document expected\";\r\n\t\tvar m = checkList(x.iterator(),r);\r\n\t\tif( m == CMatch )\r\n\t\t\treturn;\r\n\t\tthrow makeError(m);\r\n\t}\r\n\r\n}\r\n","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.framework.layout.containers;\r\nimport tools.spark.framework.layout.interfaces.EHorizontalAlign;\r\nimport tools.spark.framework.layout.interfaces.EVerticalAlign;\r\nimport tools.spark.framework.layout.layouts.ALayoutBase;\r\nimport tools.spark.framework.layout.layouts.BasicLayout;\r\nimport tools.spark.framework.layout.layouts.HorizontalLayout;\r\nimport tools.spark.framework.layout.layouts.VerticalLayout;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Group\r\n{\r\n\tpublic var layout( default, set ):ALayoutBase;\r\n\t\r\n\r\n\t//public var minWidth( default, default ):Float;\r\n\t//public var minHeight( default, default ):Float;\r\n\t//public var maxWidth( default, default ):Null<Float>;\r\n\t//public var maxHeight( default, default ):Null<Float>;\r\n\r\n\tpublic var includeInLayout( default, default ):Bool;\r\n\t\r\n\t//ACTUAL SHIT\r\n\t//positions\r\n\tpublic var x( default, default ):Float;\r\n\tpublic var y( default, default ):Float;\r\n\t//sizes\r\n\tpublic var width( default, default ):Float;\r\n\tpublic var height( default, default ):Float;\r\n\t\r\n\t//SIZES\r\n\t//auto-calculated size stuff\r\n\tpublic var measuredWidth( default, default ):Null<Float>;\r\n\tpublic var measuredHeight( default, default ):Null<Float>;\r\n\t\r\n\tpublic var preferredWidth( get, null ):Null<Float>;\r\n\tpublic var preferredHeight( get, null ):Null<Float>;\r\n\t\r\n\t//user input size stuff\r\n\tpublic var explicitWidth( default, default ):Null<Float>;\r\n\tpublic var explicitHeight( default, default ):Null<Float>;\r\n\t\r\n\t//MIN MAX SIZES\r\n\t////auto-calculated Min Max Size stuff\r\n\tpublic var measuredMinWidth( default, default ):Null<Float>;\r\n\tpublic var measuredMinHeight( default, default ):Null<Float>;\r\n\tpublic var measuredMaxWidth( default, default ):Null<Float>;\r\n\tpublic var measuredMaxHeight( default, default ):Null<Float>;\r\n\r\n\t\r\n\tpublic var preferredMinWidth( get, null ):Null<Float>;\r\n\tpublic var preferredMinHeight( get, null ):Null<Float>;\r\n\tpublic var preferredMaxWidth( get, null ):Null<Float>;\r\n\tpublic var preferredMaxHeight( get, null ):Null<Float>;\r\n\t\r\n\t//user input Min Max Size stuff\r\n\tpublic var explicitMinWidth( default, default ):Null<Float>;\r\n\tpublic var explicitMinHeight( default, default ):Null<Float>;\r\n\tpublic var explicitMaxWidth( default, default ):Null<Float>;\r\n\tpublic var explicitMaxHeight( default, default ):Null<Float>;\r\n\t\r\n\t\r\n\t//CONSTRAINTS\r\n\tpublic var left( default, default ):Null<Float>;\r\n\tpublic var right( default, default ):Null<Float>;\r\n\tpublic var top( default, default ):Null<Float>;\r\n\tpublic var bottom( default, default ):Null<Float>;\r\n\t\r\n\tpublic var horizontalCenter( default, default ):Null<Float>;\r\n\tpublic var verticalCenter( default, default ):Null<Float>;\r\n\t\r\n\tpublic var percentWidth( default, default ):Null<Float>;\r\n\tpublic var percentHeight( default, default ):Null<Float>;\r\n\r\n\t//HORIZONTAL-VERTICAL\r\n\tpublic var paddingLeft( default, default ):Float;\r\n\tpublic var paddingRight( default, default ):Float;\r\n\tpublic var paddingTop( default, default ):Float;\r\n\tpublic var paddingBottom( default, default ):Float;\r\n\tpublic var gap( default, default ):Float;\r\n\tpublic var horizontalAlign( default, default ):EHorizontalAlign;\r\n\tpublic var verticalAlign( default, default ):EVerticalAlign;\r\n\t\r\n\t//HORIZONTAL\r\n\tpublic var columnWidth( default, default ):String;\r\n\tpublic var requestedColumnCount( default, default ):Int;\r\n\tpublic var requestedMaxColumnCount( default, default ):Int;\r\n\tpublic var requestedMinColumnCount( default, default ):Int;\r\n\tpublic var variableColumnWidth( default, default ):Bool;\r\n\t\r\n\t//VERTICAL\r\n\tpublic var rowHeight( default, default ):String;\r\n\tpublic var requestedRowCount( default, default ):Int;\r\n\tpublic var requestedMaxRowCount( default, default ):Int;\r\n\tpublic var requestedMinRowCount( default, default ):Int;\r\n\tpublic var variableRowHeight( default, default ):Bool;\r\n\t\r\n\t//children (if this group is a container)\r\n\tpublic var children( default, null):Array<Group>;\r\n\t\r\n\tpublic var layoutableEntity ( default, null):IGameEntity;\r\n\tpublic var layoutableInstanceType (default, null):String;\r\n\tpublic var layoutableInstance (default, default):Dynamic;\r\n\t\r\n\t\r\n\t\r\n\tpublic function new(p_layoutableEntity : IGameEntity, p_layoutableInstanceType:String, p_layoutableInstance:Dynamic) \r\n\t{\r\n\t\tlayoutableEntity = p_layoutableEntity;\r\n\t\tlayoutableInstanceType = p_layoutableInstanceType;\r\n\t\tlayoutableInstance = p_layoutableInstance;\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tinline private function _init():Void\r\n\t{\r\n\t\tchildren = new Array<Group>();\r\n\t\t\r\n\t\tx = y = width = height = 0;\r\n\t}\r\n\t\r\n\tpublic function update():Void\r\n\t{\r\n\t\t//@fixme soon: i guess here if soemething called update, somehow layoutmanager should get invalidated.\r\n\t\t//maybe pass all updates and even add childs through layout manager after all... so we can invalidate as well\r\n\t\t//seems about right....\r\n\t\t\r\n\t\t//layout\r\n\t\tupdateState('layout');\r\n\t\tupdateState('includeInLayout');\r\n\t\t\r\n\t\t//absolute\r\n\t\tupdateState('x');\r\n\t\tupdateState('y');\r\n\t\t\r\n\t\t//width stuff\r\n\t\tupdateState('width');\r\n\t\tupdateState('height');\r\n\t\t\r\n\t\t//normal constraints\r\n\t\tupdateState('left');\r\n\t\tupdateState('top');\r\n\t\tupdateState('right');\r\n\t\tupdateState('bottom');\r\n\t\tupdateState('horizontalCenter');\r\n\t\tupdateState('verticalCenter');\r\n\t\t\r\n\t\t//horizontal-vertical\r\n\t\tif (layout != null)\r\n\t\t{\r\n\t\t\tif (layout.layoutType != \"Basic\")\r\n\t\t\t{\r\n\t\t\t\tupdateState('paddingLeft');\r\n\t\t\t\tupdateState('paddingRight');\r\n\t\t\t\tupdateState('paddingTop');\r\n\t\t\t\tupdateState('paddingBottom');\r\n\t\t\t\tupdateState('gap');\r\n\t\t\t\tupdateState('horizontalAlign');\r\n\t\t\t\tupdateState('verticalAlign');\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif (layout.layoutType == \"Horizontal\")\r\n\t\t\t\t{\r\n\t\t\t\t\tupdateState('columnWidth');\r\n\t\t\t\t\tupdateState('requestedColumnCount');\r\n\t\t\t\t\tupdateState('requestedMaxColumnCount');\r\n\t\t\t\t\tupdateState('requestedMinColumnCount');\r\n\t\t\t\t\tupdateState('variableColumnWidth');\r\n\t\t\t\t}\r\n\t\t\t\telse if (layout.layoutType == \"Vertical\")\r\n\t\t\t\t{\r\n\t\t\t\t\tupdateState('rowHeight');\r\n\t\t\t\t\tupdateState('requestedRowCount');\r\n\t\t\t\t\tupdateState('requestedMaxRowCount');\r\n\t\t\t\t\tupdateState('requestedMinRowCount');\r\n\t\t\t\t\tupdateState('variableRowHeight');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function updateState(p_state:String):Void\r\n\t{\r\n\t\tswitch (p_state)\r\n\t\t{\r\n\t\t\t//Layout\r\n\t\t\tcase \"layout\":\r\n\t\t\t\t_updateLayout(layoutableEntity.getState(p_state));\r\n\t\t\t\t\r\n\t\t\tcase \"includeInLayout\":\r\n\t\t\t\tincludeInLayout = layoutableEntity.getState(p_state);\r\n\t\t\t\t\r\n\t\t\t//Basic\r\n\t\t\tcase \"x\":\r\n\t\t\t\tif (!Math.isNaN(layoutableEntity.getState(p_state))) \r\n\t\t\t\t\tx = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"y\":\r\n\t\t\t\tif (!Math.isNaN(layoutableEntity.getState(p_state))) \r\n\t\t\t\t\ty = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"width\":\r\n\t\t\t\t_updateExplicitSize(layoutableEntity.getState(p_state), \"width\");\r\n\t\t\tcase \"height\":\r\n\t\t\t\t_updateExplicitSize(layoutableEntity.getState(p_state), \"height\");\r\n\t\t\tcase \"left\":\r\n\t\t\t\tif (!Math.isNaN(layoutableEntity.getState(p_state))) \r\n\t\t\t\t\tleft = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"top\":\r\n\t\t\t\tif (!Math.isNaN(layoutableEntity.getState(p_state))) \r\n\t\t\t\t\ttop = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"right\":\r\n\t\t\t\tif (!Math.isNaN(layoutableEntity.getState(p_state))) \r\n\t\t\t\t\tright = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"bottom\":\r\n\t\t\t\tif (!Math.isNaN(layoutableEntity.getState(p_state))) \r\n\t\t\t\t\tbottom = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"horizontalCenter\":\r\n\t\t\t\tif (!Math.isNaN(layoutableEntity.getState(p_state))) \r\n\t\t\t\t\thorizontalCenter = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"verticalCenter\":\r\n\t\t\t\tif (!Math.isNaN(layoutableEntity.getState(p_state))) \r\n\t\t\t\t\tverticalCenter = layoutableEntity.getState(p_state);\r\n\t\t\t\t\t\r\n\t\t\t//Horizontal/Vertical\r\n\t\t\tcase \"paddingLeft\":\r\n\t\t\t\tpaddingLeft = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"paddingRight\":\r\n\t\t\t\tpaddingRight = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"paddingTop\":\r\n\t\t\t\tpaddingTop = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"paddingBottom\":\r\n\t\t\t\tpaddingBottom = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"gap\":\r\n\t\t\t\tgap = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"horizontalAlign\":\r\n\t\t\t\tvar s_horAlignStr:String = layoutableEntity.getState(p_state);\r\n\t\t\t\tif (s_horAlignStr == \"left\") horizontalAlign = EHorizontalAlign.LEFT;\r\n\t\t\t\telse if (s_horAlignStr == \"center\") horizontalAlign = EHorizontalAlign.CENTER;\r\n\t\t\t\telse if (s_horAlignStr == \"right\") horizontalAlign = EHorizontalAlign.RIGHT;\r\n\t\t\t\telse if (s_horAlignStr == \"justify\") horizontalAlign = EHorizontalAlign.JUSTIFY;\r\n\t\t\t\telse if (s_horAlignStr == \"contentJustify\") horizontalAlign = EHorizontalAlign.CONTENT_JUSTIFY;\r\n\t\t\tcase \"verticalAlign\":\r\n\t\t\t\tvar s_verAlignStr:String = layoutableEntity.getState(p_state);\r\n\t\t\t\tif (s_verAlignStr == \"top\") verticalAlign = EVerticalAlign.TOP;\r\n\t\t\t\telse if (s_verAlignStr == \"middle\") verticalAlign = EVerticalAlign.MIDDLE;\r\n\t\t\t\telse if (s_verAlignStr == \"bottom\") verticalAlign = EVerticalAlign.BOTTOM;\r\n\t\t\t\telse if (s_verAlignStr == \"justify\") verticalAlign = EVerticalAlign.JUSTIFY;\r\n\t\t\t\telse if (s_verAlignStr == \"contentJustify\") verticalAlign = EVerticalAlign.CONTENT_JUSTIFY;\r\n\t\t\t\t\r\n\t\t\t//Horizontal\r\n\t\t\tcase \"columnWidth\":\r\n\t\t\t\tcolumnWidth = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"requestedColumnCount\":\r\n\t\t\t\trequestedColumnCount = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"requestedMaxColumnCount\":\r\n\t\t\t\trequestedMaxColumnCount = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"requestedMinColumnCount\":\r\n\t\t\t\trequestedMinColumnCount = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"variableColumnWidth\":\r\n\t\t\t\tvariableColumnWidth = layoutableEntity.getState(p_state);\r\n\t\t\t\t\r\n\t\t\t//Vertical\r\n\t\t\tcase \"rowHeight\":\r\n\t\t\t\trowHeight = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"requestedRowCount\":\r\n\t\t\t\trequestedRowCount = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"requestedMaxRowCount\":\r\n\t\t\t\trequestedMaxRowCount = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"requestedMinRowCount\":\r\n\t\t\t\trequestedMinRowCount = layoutableEntity.getState(p_state);\r\n\t\t\tcase \"variableRowHeight\":\r\n\t\t\t\tvariableRowHeight = layoutableEntity.getState(p_state);\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _updateLayout(p_stateValue:String):Void\r\n\t{\r\n\t\tif (p_stateValue == \"Basic\")\r\n\t\t{\r\n\t\t\tif (layout == null)\r\n\t\t\t\tlayout = new BasicLayout();\r\n\t\t\telse\r\n\t\t\t\tif (layout.layoutType != p_stateValue)\r\n\t\t\t\t\tlayout = new BasicLayout();\r\n\t\t}\r\n\t\telse if (p_stateValue == \"Horizontal\")\r\n\t\t{\r\n\t\t\tif (layout == null)\r\n\t\t\t\tlayout = new HorizontalLayout();\r\n\t\t\telse\r\n\t\t\t\tif (layout.layoutType != p_stateValue)\r\n\t\t\t\t\tlayout = new HorizontalLayout();\r\n\t\t}\r\n\t\telse if (p_stateValue == \"Vertical\")\r\n\t\t{\r\n\t\t\tif (layout == null)\r\n\t\t\t\tlayout = new VerticalLayout();\r\n\t\t\telse\r\n\t\t\t\tif (layout.layoutType != p_stateValue)\r\n\t\t\t\t\tlayout = new VerticalLayout();\r\n\t\t}\r\n\t\t\r\n\t\tlayout.target = this;\r\n\t}\r\n\t\r\n\tprivate function _updateExplicitSize(p_stateValue:String, p_dimension:String):Void\r\n\t{\r\n\t\tvar l_explicitSize:Null<Float>=null;\r\n\t\tvar l_percentSize:Null<Float>=null;\r\n\t\t//Console.error(\"updating \" + p_dimension + \" of entity: \" + layoutableEntity.getState('name') + \", which is: \" + p_stateValue);\r\n\t\t\r\n\t\tif (p_stateValue != \"Implicit\")\r\n\t\t{\r\n\t\t\tif (p_stateValue.indexOf(\"%\") != -1)\r\n\t\t\t\tl_percentSize = Std.parseFloat(p_stateValue);\r\n\t\t\telse\r\n\t\t\t\tl_explicitSize = Std.parseFloat(p_stateValue);\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tif (p_dimension == \"width\")\r\n\t\t{\r\n\t\t\texplicitWidth = l_explicitSize;\r\n\t\t\tpercentWidth = l_percentSize;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\texplicitHeight = l_explicitSize;\r\n\t\t\tpercentHeight = l_percentSize;\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function set_layout( p_value : ALayoutBase ) : ALayoutBase \r\n\t{\r\n\t\t//If the layout is already attached to this Group, do nothing\r\n\t\tif (layout == p_value)\r\n\t\t\treturn layout;\r\n\t\t\t\r\n\t\tlayout = p_value;\r\n\t\t\r\n\t\treturn layout;\r\n\t}\r\n\t\r\n\tpublic function measure():Void\r\n\t{\r\n\t\tlayout.measure();\r\n\t}\r\n\t\r\n\tpublic function updateDisplayList(p_width:Float, p_height:Float):Void\r\n    {\r\n\t\tlayout.updateDisplayList(p_width, p_height);\r\n    }\r\n\t/*\r\n\tpublic function setActualSize(?p_width:Float, ?p_height:Float):Void\r\n\t{\r\n\t\tif (p_width == null && p_height == null)\r\n\t\t{\r\n\t\t\twidth = preferredWidth;\r\n\t\t\theight = preferredHeight;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (p_width != null) width = p_width;\r\n\t\t\tif (p_height != null) height = p_height;\r\n\t\t}\r\n\t}*/\r\n\t\r\n\t//the horror......\r\n\tpublic function setActualSize(?p_width:Float, ?p_height:Float):Void\r\n\t{\r\n\t\t//Width\r\n\t\tif (explicitWidth != null)\r\n\t\t{\r\n\t\t\twidth = explicitWidth;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (p_width != null && p_width != 0)\r\n\t\t\t{\r\n\t\t\t\twidth = p_width;\r\n\t\t\t\tmeasuredWidth = p_width;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (preferredWidth != 0)\r\n\t\t\t\t{\r\n\t\t\t\t\twidth = preferredWidth;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Height\r\n\t\tif (explicitHeight != null)\r\n\t\t{\r\n\t\t\theight = explicitHeight;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (p_height != null && p_height != 0)\r\n\t\t\t{\r\n\t\t\t\theight = p_height;\r\n\t\t\t\tmeasuredHeight = p_height;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (preferredHeight != 0)\r\n\t\t\t\t{\r\n\t\t\t\t\theight = preferredHeight;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function get_preferredWidth():Float\r\n    {\r\n        return explicitWidth==null ? measuredWidth : explicitWidth;\r\n    }\r\n\t\r\n\tpublic function get_preferredHeight():Float\r\n    {\r\n        return explicitHeight==null ? measuredHeight : explicitHeight;\r\n    }\r\n\t\r\n\tpublic function get_preferredMinWidth():Float\r\n    {\r\n        return explicitMinWidth==null ? measuredMinWidth : explicitMinWidth;\r\n    }\r\n\t\r\n\tpublic function get_preferredMinHeight():Float\r\n    {\r\n        return explicitMinHeight==null ? measuredMinHeight : explicitMinHeight;\r\n    }\r\n\t\r\n\tpublic function get_preferredMaxWidth():Float\r\n    {\r\n        return explicitMaxWidth==null ? measuredMaxWidth : explicitMaxWidth;\r\n    }\r\n\t\r\n\tpublic function get_preferredMaxHeight():Float\r\n    {\r\n        return explicitMaxHeight==null ? measuredMaxHeight : explicitMaxHeight;\r\n    }\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, February 2015\r\n */\r\n\r\npackage tools.spark.framework.layout.helpers ;\r\nimport tools.spark.framework.layout.containers.Group;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ChildInfo\r\n{\r\n\tpublic var size( default, default) :Float = 0;\r\n\tpublic var preferred( default, default) :Float = 0;\r\n\tpublic var flex( default, default) :Float = 0;\r\n\tpublic var percent( default, default) :Float;\r\n\tpublic var min( default, default) :Float;\r\n\tpublic var max( default, default) :Float;\r\n\tpublic var width( default, default) :Float;\r\n\tpublic var height( default, default) :Float;\r\n\tpublic var layoutElement( default, default) :Group;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, February 2015\r\n */\r\n\r\npackage tools.spark.framework.layout.helpers;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass LayoutHelper\r\n{\r\n\t/**\r\n\t *  This function distributes excess space among the flexible children.\r\n\t *  It does so with a view to keep the children's overall size\r\n\t *  close the ratios specified by their percent.\r\n\t *\r\n\t *  @param spaceForChildren The total space for all children\r\n\t *\r\n\t *  @param spaceToDistribute The space that needs to be distributed\r\n\t *  among the flexible children.\r\n\t *\r\n\t *  @param childInfoArray An array of Objects. When this function\r\n\t *  is called, each object should define the following properties:\r\n\t *  - percent: the percentWidth or percentHeight of the child (depending\r\n\t *  on whether we're growing in a horizontal or vertical direction)\r\n\t *  - min: the minimum width (or height) for that child\r\n\t *  - max: the maximum width (or height) for that child\r\n\t *\r\n\t *  @return When this function finishes executing, a \"size\" property\r\n\t *  will be defined for each child object. The size property contains\r\n\t *  the portion of the spaceToDistribute to be distributed to the child.\r\n\t *  Ideally, the sum of all size properties is spaceToDistribute.\r\n\t *  If all the children hit their minWidth/maxWidth/minHeight/maxHeight\r\n\t *  before the space was distributed, then the remaining unused space\r\n\t *  is returned. Otherwise, the return value is zero.\r\n\t *  \r\n\t *  @langversion 3.0\r\n\t *  @playerversion Flash 9\r\n\t *  @playerversion AIR 1.1\r\n\t *  @productversion Flex 3\r\n\t */\r\n\tpublic static function flexChildrenProportionally(\r\n\t\t\t\t\t\t\t\tp_spaceForChildren:Float,\r\n\t\t\t\t\t\t\t\tp_spaceToDistribute:Float,\r\n\t\t\t\t\t\t\t\tp_totalPercent:Float,\r\n\t\t\t\t\t\t\t\tp_childInfoArray:Array<ChildInfo>):Float\r\n\t{\r\n\t\t// The algorithm iterivately attempts to break down the space that \r\n\t\t// is consumed by \"flexible\" containers into ratios that are related\r\n\t\t// to the percentWidth/percentHeight of the participating containers.\r\n\t\t\r\n\t\tvar l_numChildren:Int = p_childInfoArray.length;\r\n\t\tvar l_flexConsumed:Float; // space consumed by flexible compontents\r\n\t\tvar l_done:Bool;\r\n        \r\n\t\tvar l_unused:Float;\r\n\t\t\r\n\t\t// Continue as long as there are some remaining flexible children.\r\n\t\t// The \"done\" flag isn't strictly necessary, except that it catches\r\n\t\t// cases where round-off error causes totalPercent to not exactly\r\n\t\t// equal zero.\r\n\t\tdo\r\n\t\t{\r\n\t\t\tl_flexConsumed = 0; // space consumed by flexible compontents\r\n\t\t\tl_done = true; // we are optimistic\r\n\t\t\t\r\n            // We now do something a little tricky so that we can \r\n            // support partial filling of the space. If our total\r\n            // percent < 100% then we can trim off some space.\r\n            // This unused space can be used to fulfill mins and maxes.\r\n            l_unused = p_spaceToDistribute -\r\n                                (p_spaceForChildren * p_totalPercent / 100);\r\n            if (l_unused > 0)\r\n                p_spaceToDistribute -= l_unused;\r\n            else\r\n                l_unused = 0;\r\n            \r\n\t\t\t// Space for flexible children is the total amount of space\r\n\t\t\t// available minus the amount of space consumed by non-flexible\r\n\t\t\t// components.Divide that space in proportion to the percent\r\n\t\t\t// of the child\r\n\t\t\tvar l_spacePerPercent:Float = p_spaceToDistribute / p_totalPercent;\r\n\t\t\t\r\n\t\t\t// Attempt to divide out the space using our percent amounts,\r\n\t\t\t// if we hit its limit then that control becomes 'non-flexible'\r\n\t\t\t// and we run the whole space to distribute calculation again.\r\n\t\t\tvar l_i:Int = 0;\r\n\t\t\twhile (l_i < l_numChildren)\r\n\t\t\t{\r\n\t\t\t\tvar w_childInfo:ChildInfo = p_childInfoArray[l_i];\r\n\r\n\t\t\t\t// Set its size in proportion to its percent.\r\n\t\t\t\tvar w_size:Float = w_childInfo.percent * l_spacePerPercent;\r\n\r\n\t\t\t\t// If our flexiblity calc say grow/shrink more than we are\r\n\t\t\t\t// allowed, then we grow/shrink whatever we can, remove\r\n\t\t\t\t// ourselves from the array for the next pass, and start\r\n\t\t\t\t// the loop over again so that the space that we weren't\r\n\t\t\t\t// able to consume / release can be re-used by others.\r\n\t\t\t\tif (w_size < w_childInfo.min)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar w_min:Float = w_childInfo.min;\r\n\t\t\t\t\tw_childInfo.size = w_min;\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Move this object to the end of the array\r\n\t\t\t\t\t// and decrement the length of the array. \r\n\t\t\t\t\t// This is slightly expensive, but we don't expect\r\n\t\t\t\t\t// to hit these min/max limits very often.\r\n\t\t\t\t\tp_childInfoArray[l_i] = p_childInfoArray[--l_numChildren];\r\n\t\t\t\t\tp_childInfoArray[l_numChildren] = w_childInfo;\r\n\r\n\t\t\t\t\tp_totalPercent -= w_childInfo.percent;\r\n                    // Use unused space first before reducing flexible space.\r\n                    if (l_unused >= w_min)\r\n                    {\r\n                        l_unused -= w_min;\r\n                    }\r\n                    else\r\n                    {\r\n                        p_spaceToDistribute -= w_min - l_unused;\r\n                        l_unused = 0;\r\n                    }\r\n\t\t\t\t\tl_done = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse if (w_size > w_childInfo.max)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar w_max:Float = w_childInfo.max;\r\n\t\t\t\t\tw_childInfo.size = w_max;\r\n\r\n\t\t\t\t\tp_childInfoArray[l_i] = p_childInfoArray[--l_numChildren];\r\n\t\t\t\t\tp_childInfoArray[l_numChildren] = w_childInfo;\r\n\r\n\t\t\t\t\tp_totalPercent -= w_childInfo.percent;\r\n                    // Use unused space first before reducing flexible space.\r\n                    if (l_unused >= w_max)\r\n                    {\r\n                        l_unused -= w_max;\r\n                    }\r\n                    else\r\n                    {\r\n                        p_spaceToDistribute -= w_max - l_unused;\r\n                        l_unused = 0;\r\n                    }\r\n\t\t\t\t\tl_done = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// All is well, let's carry on...\r\n\t\t\t\t\tw_childInfo.size = w_size;\r\n\t\t\t\t\tl_flexConsumed += w_size;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tl_i++;\r\n\t\t\t}\r\n\t\t} \r\n\t\twhile (!l_done);\r\n\r\n\t\treturn Math.max(0, Math.floor((p_spaceToDistribute + l_unused) - l_flexConsumed));\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, February 2015\r\n */\r\n\r\npackage tools.spark.framework.layout.helpers ;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass SizesAndLimit\r\n{\r\n    public var preferredSize( default, default ):Float;\r\n    public var minSize( default, default ):Float;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.framework.layout.layouts;\r\nimport tools.spark.framework.layout.containers.Group;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ALayoutBase\r\n{\r\n\tpublic var target( default, set ):Group;\r\n\tpublic var layoutType( default, default ):String;\r\n\tpublic var typicalLayoutElement( get, null ):Group;\r\n\tprivate var _typicalLayoutElement:Group;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function get_typicalLayoutElement():Group\r\n    {\r\n        if (_typicalLayoutElement==null && target!=null && (target.children.length > 0))\r\n            _typicalLayoutElement = target.children[0];\r\n        return _typicalLayoutElement;\r\n    }\r\n\t\r\n\tprivate function set_target( p_value : Group ) : Group \r\n\t{\r\n\t\t//If the target is already attached to this Layout, do nothing\r\n\t\tif (target == p_value)\r\n\t\t\treturn target;\r\n\t\t\t\r\n\t\ttarget = p_value;\r\n\t\t\r\n\t\treturn target;\r\n\t}\r\n\t\r\n\t /**\r\n     *  Measures the target's default size based on its content, and optionally\r\n     *  measures the target's default minimum size.\r\n     *\r\n     *  <p>This is one of the methods that you must override when creating a\r\n     *  subclass of LayoutBase. The other method is <code>updateDisplayList()</code>.\r\n     *  You do not call these methods directly. Flex calls this method as part\r\n     *  of a layout pass. A layout pass consists of three phases.</p>\r\n     *\r\n     *  <p>First, if the target's properties are invalid, the LayoutManager calls\r\n     *  the target's <code>commitProperties</code> method.</p>\r\n     *\r\n     *  <p>Second, if the target's size is invalid, LayoutManager calls the target's\r\n     *  <code>validateSize()</code> method. The target's <code>validateSize()</code>\r\n     *  will in turn call the layout's <code>measure()</code> to calculate the\r\n     *  target's default size unless it was explicitly specified by both target's\r\n     *  <code>explicitWidth</code> and <code>explicitHeight</code> properties.\r\n     *  If the default size changes, Flex will invalidate the target's display list.</p>\r\n     *\r\n     *  <p>Last, if the target's display list is invalid, LayoutManager calls the target's\r\n     *  <code>validateDisplayList</code>. The target's <code>validateDisplayList</code>\r\n     *  will in turn call the layout's <code>updateDisplayList</code> method to\r\n     *  size and position the target's elements.</p>\r\n     *\r\n     *  <p>When implementing this method, you must set the target's\r\n     *  <code>measuredWidth</code> and <code>measuredHeight</code> properties\r\n     *  to define the target's default size. You may optionally set the\r\n     *  <code>measuredMinWidth</code> and <code>measuredMinHeight</code>\r\n     *  properties to define the default minimum size.\r\n     *  A typical implementation iterates through the target's elements\r\n     *  and uses the methods defined by the <code>ILayoutElement</code> to\r\n     *  accumulate the preferred and/or minimum sizes of the elements and then sets\r\n     *  the target's <code>measuredWidth</code>, <code>measuredHeight</code>,\r\n     *  <code>measuredMinWidth</code> and <code>measuredMinHeight</code>.</p>\r\n     *\r\n     *  @see #updateDisplayList()\r\n     */\r\n    public function measure():Void\r\n    {\r\n\t\t//override me\r\n    }\r\n    \r\n    /**\r\n     *  Sizes and positions the target's elements.\r\n     *\r\n     *  <p>This is one of the methods that you must override when creating a\r\n     *  subclass of LayoutBase. The other method is <code>measure()</code>.\r\n     *  You do not call these methods directly. Flex calls this method as part\r\n     *  of a layout pass. A layout pass consists of three phases.</p>\r\n     *\r\n     *  <p>First, if the target's properties are invalid, the LayoutManager calls\r\n     *  the target's <code>commitProperties</code> method.</p>\r\n     *\r\n     *  <p>Second, if the target's size is invalid, LayoutManager calls the target's\r\n     *  <code>validateSize()</code> method. The target's <code>validateSize()</code>\r\n     *  will in turn call the layout's <code>measure()</code> to calculate the\r\n     *  target's default size unless it was explicitly specified by both target's\r\n     *  <code>explicitWidth</code> and <code>explicitHeight</code> properties.\r\n     *  If the default size changes, Flex will invalidate the target's display list.</p>\r\n     *\r\n     *  <p>Last, if the target's display list is invalid, LayoutManager calls the target's\r\n     *  <code>validateDisplayList</code>. The target's <code>validateDisplayList</code>\r\n     *  will in turn call the layout's <code>updateDisplayList</code> method to\r\n     *  size and position the target's elements.</p>\r\n     *\r\n     *  <p>A typical implementation iterates through the target's elements\r\n     *  and uses the methods defined by the <code>ILayoutElement</code> to\r\n     *  position and resize the elements. Then the layout must also calculate and set\r\n     *  the target's <code>contentWidth</code> and <code>contentHeight</code>\r\n     *  properties to define the target's scrolling region.</p>\r\n     *\r\n     *  @param unscaledWidth Specifies the width of the target, in pixels,\r\n     *  in the targets's coordinates.\r\n     *\r\n     *  @param unscaledHeight Specifies the height of the component, in pixels,\r\n     *  in the target's coordinates.\r\n     *\r\n     *  @see #measure()\r\n     */\r\n    public function updateDisplayList(p_unscaledWidth:Float, p_unscaledHeight:Float):Void\r\n    {\r\n\t\t//override me\r\n    }\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.framework.layout.layouts;\r\nimport tools.spark.framework.layout.containers.Group;\r\n\r\n/**\r\n * The BasicLayout class arranges the layout elements according to their individual settings, independent of each-other.\r\n * BasicLayout, also called absolute layout, requires that you explicitly position each container child. \r\n * You can use the x and y properties of the child, or constraints to position each child.\r\n * @author Aris Kostakos\r\n */\r\nclass BasicLayout extends ALayoutBase\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\tlayoutType = \"Basic\";\r\n\t}\r\n\t\r\n\tprivate static function _constraintsDetermineWidth(p_group:Group):Bool\r\n    {\r\n        return p_group.percentWidth!=null ||\r\n               p_group.left!=null &&\r\n               p_group.right!=null;\r\n    }\r\n\r\n    private static function _constraintsDetermineHeight(p_group:Group):Bool\r\n    {\r\n        return p_group.percentHeight!=null ||\r\n               p_group.top!=null &&\r\n               p_group.bottom!=null;\r\n    }\r\n\t\r\n\t\r\n\t/**\r\n     *  @return Returns the maximum value for an element's dimension so that the component doesn't\r\n     *  spill out of the container size. Calculations are based on the layout rules.\r\n     *  Pass in unscaledWidth, hCenter, left, right, childX to get a maxWidth value.\r\n     *  Pass in unscaledHeight, vCenter, top, bottom, childY to get a maxHeight value.\r\n     */\r\n    static private function _maxSizeToFitIn(p_totalSize:Float,\r\n                                           p_center:Null<Float>,\r\n                                           p_lowConstraint:Null<Float>,\r\n                                           p_highConstraint:Null<Float>,\r\n                                           p_position:Float):Float\r\n    {\r\n        if (p_center!=null)\r\n        {\r\n            // (1) x == (totalSize - childWidth) / 2 + hCenter\r\n            // (2) x + childWidth <= totalSize\r\n            // (3) x >= 0\r\n            //\r\n            // Substitue x in (2):\r\n            // (totalSize - childWidth) / 2 + hCenter + childWidth <= totalSize\r\n            // totalSize - childWidth + 2 * hCenter + 2 * childWidth <= 2 * totalSize\r\n            // 2 * hCenter + childWidth <= totalSize se we get:\r\n            // (3) childWidth <= totalSize - 2 * hCenter\r\n            //\r\n            // Substitute x in (3):\r\n            // (4) childWidth <= totalSize + 2 * hCenter\r\n            //\r\n            // From (3) & (4) above we get:\r\n            // childWidth <= totalSize - 2 * abs(hCenter)\r\n\r\n            return p_totalSize - 2 * Math.abs(p_center);\r\n        }\r\n        else if (p_lowConstraint!=null)\r\n        {\r\n            // childWidth + left <= totalSize\r\n            return p_totalSize - p_lowConstraint;\r\n        }\r\n        else if (p_highConstraint!=null)\r\n        {\r\n            // childWidth + right <= totalSize\r\n            return p_totalSize - p_highConstraint;\r\n        }\r\n        else\r\n        {\r\n            // childWidth + childX <= totalSize\r\n            return p_totalSize - p_position;\r\n        }\r\n    }\r\n\t\r\n\t\r\n\toverride public function measure():Void\r\n\t{\r\n        var l_width:Float = 0;\r\n        var l_height:Float = 0;\r\n\t\tvar l_minWidth:Float = 0;\r\n        var l_minHeight:Float = 0;\r\n\r\n        for (f_child in target.children)\r\n        {\r\n            if (f_child==null || f_child.includeInLayout==false)\r\n                continue;\r\n\t\t\t\t\r\n            // Extents of the element - how much additional space (besides its own width/height)\r\n            // the element needs based on its constraints.\r\n            var f_extX:Float;\r\n            var f_extY:Float;\r\n\r\n\t\t\t//LETS DO X\r\n\t\t\tif (f_child.left!=null && f_child.right!=null)\r\n            {\r\n                // If both left & right are set, then the extents is always\r\n                // left + right so that the element is resized to its preferred\r\n                // size (if it's the one that pushes out the default size of the container).\r\n                f_extX = f_child.left + f_child.right;                \r\n            }\r\n\t\t\telse if (f_child.horizontalCenter!=null)\r\n            {\r\n                // If we have horizontalCenter, then we want to have at least enough space\r\n                // so that the element is within the parent container.\r\n                // If the element is aligned to the left/right edge of the container and the\r\n                // distance between the centers is hCenter, then the container width will be\r\n                // parentWidth = 2 * (abs(hCenter) + elementWidth / 2)\r\n                // <=> parentWidth = 2 * abs(hCenter) + elementWidth\r\n                // Since the extents is the additional space that the element needs\r\n                // extX = parentWidth - elementWidth = 2 * abs(hCenter)\r\n                f_extX = Math.abs(f_child.horizontalCenter) * 2;\r\n            }\r\n            else if (f_child.left!=null || f_child.right!=null)\r\n            {\r\n                f_extX = f_child.left == null ? 0 : f_child.left;\r\n                f_extX += f_child.right == null ? 0 : f_child.right;\r\n            }\r\n            else\r\n            {\r\n                f_extX = f_child.x;\r\n            }\r\n            \r\n            if (f_child.top!=null && f_child.bottom!=null)\r\n            {\r\n                // If both top & bottom are set, then the extents is always\r\n                // top + bottom so that the element is resized to its preferred\r\n                // size (if it's the one that pushes out the default size of the container).\r\n                f_extY = f_child.top + f_child.bottom;                \r\n            }\r\n            else if (f_child.verticalCenter!=null)\r\n            {\r\n                // If we have verticalCenter, then we want to have at least enough space\r\n                // so that the element is within the parent container.\r\n                // If the element is aligned to the top/bottom edge of the container and the\r\n                // distance between the centers is vCenter, then the container height will be\r\n                // parentHeight = 2 * (abs(vCenter) + elementHeight / 2)\r\n                // <=> parentHeight = 2 * abs(vCenter) + elementHeight\r\n                // Since the extents is the additional space that the element needs\r\n                // extY = parentHeight - elementHeight = 2 * abs(vCenter)\r\n                f_extY = Math.abs(f_child.verticalCenter) * 2;\r\n            }\r\n            else if (f_child.top!=null || f_child.bottom!=null)\r\n            {\r\n                f_extY = f_child.top == null ? 0 : f_child.top;\r\n                f_extY += f_child.bottom == null ? 0 : f_child.bottom;\r\n            }\r\n            else\r\n            {\r\n                f_extY = f_child.y;\r\n            }\r\n\t\t\t\r\n            l_width = Math.max(l_width, f_extX + f_child.preferredWidth);\r\n            l_height = Math.max(l_height, f_extY + f_child.preferredHeight);\r\n\t\t\t\r\n\t\t\t// Find the minimum default extents, we take the minimum width/height only\r\n            // when the element size is determined by the parent size\r\n            var l_elementMinWidth:Float =\r\n                _constraintsDetermineWidth(f_child) ? f_child.preferredMinWidth :\r\n                                                           f_child.preferredWidth;\r\n            var l_elementMinHeight:Float =\r\n                _constraintsDetermineHeight(f_child) ? f_child.preferredMinHeight : \r\n                                                            f_child.preferredHeight;\r\n\r\n            l_minWidth = Math.max(l_minWidth, f_extX + l_elementMinWidth);\r\n            l_minHeight = Math.max(l_minHeight, f_extY + l_elementMinHeight);\r\n\t\t}\r\n\r\n\t\t// Use Math.ceil() to make sure that if the content partially occupies\r\n        // the last pixel, we'll count it as if the whole pixel is occupied.\r\n        target.measuredWidth = Math.ceil(Math.max(l_width, l_minWidth));\r\n        target.measuredHeight = Math.ceil(Math.max(l_height, l_minHeight));\r\n\t\ttarget.measuredMinWidth = Math.ceil(l_minWidth);\r\n        target.measuredMinHeight = Math.ceil(l_minHeight);\r\n\t\t\r\n\t\t//aris addition so things start make some sense... not good ofc. without it results are same so far\r\n\t\ttarget.measuredMaxWidth = 999999;\r\n\t\ttarget.measuredMaxHeight = 999999;\r\n\t}\r\n\t\r\n\toverride public function updateDisplayList(p_unscaledWidth:Float, p_unscaledHeight:Float):Void\r\n    {\r\n        var l_maxX:Float = 0;\r\n        var l_maxY:Float = 0;\r\n\t\t//Console.error(target.layoutableEntity.getState('name') + \" updateDisplayList(w:\"+p_unscaledWidth+\",h:\"+p_unscaledHeight+\"):\");\r\n        for (f_child in target.children)\r\n        {\r\n\t\t\tif (f_child==null || f_child.includeInLayout==false)\r\n\t\t\t\tcontinue;\r\n\t\t\t\t\r\n            var f_elementMaxWidth:Null<Float> = null; \r\n            var f_elementMaxHeight:Null<Float> = null;\r\n\r\n            // Calculate size\r\n            var f_childWidth:Null<Float> = null;\r\n            var f_childHeight:Null<Float> = null;\r\n\t\t\t\r\n\t\t\tif (f_child.percentWidth!=null)\r\n            {\r\n                var f_availableWidth:Float = p_unscaledWidth;\r\n                if (f_child.left!=null)\r\n                    f_availableWidth -= f_child.left;\r\n                if (f_child.right!=null)\r\n                     f_availableWidth -= f_child.right;\r\n\t\t\t\t\r\n                f_childWidth = Math.round(f_availableWidth * Math.min(f_child.percentWidth * 0.01, 1));\r\n                f_elementMaxWidth = Math.min(f_child.preferredMaxWidth,\r\n                    _maxSizeToFitIn(p_unscaledWidth, f_child.horizontalCenter, f_child.left, f_child.right, f_child.x));\r\n\t\t\t\t\t\r\n            }\r\n            else if (f_child.left!=null && f_child.right!=null)\r\n            {\r\n                f_childWidth = p_unscaledWidth - f_child.right - f_child.left;\r\n            }\r\n\r\n            if (f_child.percentHeight!=null)\r\n            {\r\n                var f_availableHeight:Float = p_unscaledHeight;\r\n                if (f_child.top!=null)\r\n                    f_availableHeight -= f_child.top;\r\n                if (f_child.bottom!=null)\r\n                    f_availableHeight -= f_child.bottom;    \r\n                    \r\n                f_childHeight = Math.round(f_availableHeight * Math.min(f_child.percentHeight * 0.01, 1));\r\n                f_elementMaxHeight = Math.min(f_child.preferredMaxHeight,\r\n                    _maxSizeToFitIn(p_unscaledHeight, f_child.verticalCenter, f_child.top, f_child.bottom, f_child.y));\r\n            }\r\n            else if (f_child.top!=null && f_child.bottom!=null)\r\n            {\r\n                f_childHeight = p_unscaledHeight - f_child.bottom - f_child.top;\r\n            }\r\n\r\n            // Apply min and max constraints, make sure min is applied last. In the cases\r\n            // where childWidth and childHeight are NaN, setLayoutBoundsSize will use preferredSize\r\n            // which is already constrained between min and max.\r\n            if (f_childWidth!=null)\r\n            {\r\n                if (f_elementMaxWidth==null)\r\n                    f_elementMaxWidth = f_child.preferredMaxWidth;\r\n                f_childWidth = Math.max(f_child.preferredMinWidth, Math.min(f_elementMaxWidth, f_childWidth));\r\n            }\r\n            if (f_childHeight!=null)\r\n            {\r\n                if (f_elementMaxHeight==null)\r\n                    f_elementMaxHeight = f_child.preferredMaxHeight;\r\n                f_childHeight = Math.max(f_child.preferredMinHeight, Math.min(f_elementMaxHeight, f_childHeight));\r\n            }\r\n\r\n            // Set the size.\r\n\r\n            //layoutElement.setLayoutBoundsSize(childWidth, childHeight);\r\n\t\t\tf_child.setActualSize(f_childWidth, f_childHeight);\r\n\t\t\t\r\n            var f_elementWidth:Float = f_child.width;\r\n            var f_elementHeight:Float = f_child.height;\r\n\r\n            var f_childX:Null<Float> = null;\r\n            var f_childY:Null<Float> = null;\r\n            \r\n            // Horizontal position\r\n            if (f_child.horizontalCenter!=null)\r\n                f_childX = Math.round((p_unscaledWidth - f_elementWidth) / 2 + f_child.horizontalCenter);\r\n            else if (f_child.left!=null)\r\n                f_childX = f_child.left;\r\n            else if (f_child.right!=null)\r\n                f_childX = p_unscaledWidth - f_elementWidth - f_child.right;\r\n            else\r\n                f_childX = f_child.x;\r\n\r\n            // Vertical position\r\n            if (f_child.verticalCenter!=null)\r\n                f_childY = Math.round((p_unscaledHeight - f_elementHeight) / 2 + f_child.verticalCenter);\r\n            else if (f_child.top!=null)\r\n                f_childY = f_child.top;\r\n            else if (f_child.bottom!=null)\r\n                f_childY = p_unscaledHeight - f_elementHeight - f_child.bottom;\r\n            else\r\n                f_childY = f_child.y;\r\n\r\n            // Set position\r\n            //layoutElement.setLayoutBoundsPosition(childX, childY);\r\n\t\t\tf_child.x = f_childX;\r\n\t\t\tf_child.y = f_childY;\r\n\r\n            // update content limits\r\n            l_maxX = Math.max(l_maxX, f_childX + f_elementWidth);\r\n            l_maxY = Math.max(l_maxY, f_childY + f_elementHeight);\r\n        }\r\n\r\n        // Make sure that if the content spans partially over a pixel to the right/bottom,\r\n        // the content size includes the whole pixel.\r\n        //layoutTarget.setContentSize(Math.ceil(maxX), Math.ceil(maxY));\r\n\t\t//target.width = Math.ceil(l_maxX);\r\n\t\t//target.height = Math.ceil(l_maxY);\r\n\r\n\t\t//target.width = target.explicitWidth==null ? Math.ceil(l_maxX) : target.explicitWidth;\r\n\t\t//target.height = target.explicitHeight == null ? Math.ceil(l_maxY) : target.explicitHeight;\r\n\t\t//target.setActualSize(Math.ceil(l_maxX), Math.ceil(l_maxY));\r\n\t\t//OK THIS ONE NEEDS WORK...\r\n\t\ttarget.width = Math.ceil(p_unscaledWidth);\r\n\t\ttarget.height = Math.ceil(p_unscaledHeight);\r\n    }   \r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, February 2015\r\n */\r\n\r\npackage tools.spark.framework.layout.layouts;\r\nimport tools.spark.framework.layout.containers.Group;\r\nimport tools.spark.framework.layout.helpers.ChildInfo;\r\nimport tools.spark.framework.layout.helpers.LayoutHelper;\r\nimport tools.spark.framework.layout.helpers.SizesAndLimit;\r\nimport tools.spark.framework.layout.interfaces.EHorizontalAlign;\r\nimport tools.spark.framework.layout.interfaces.EVerticalAlign;\r\n\r\n/**\r\n * The HorizontalLayout class arranges the layout elements in a horizontal sequence, left to right, with optional gaps between the elements and optional padding around the elements.\r\n * The horizontal position of the elements is determined by arranging them in a horizontal sequence, left to right, taking into account the padding before the first element and the gaps between the elements.\r\n * The vertical position of the elements is determined by the layout's verticalAlign property.\r\n * @author Aris Kostakos\r\n */\r\nclass HorizontalLayout extends ALayoutBase\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\tlayoutType = \"Horizontal\";\r\n\t}\r\n\t\r\n\t /**\r\n     *  @private\r\n     *  @return columns to measure based on elements in layout and any requested/min/max rowCount settings. \r\n     */\r\n    private function _getColumsToMeasure(p_numElementsInLayout:Int):Int\r\n    {\r\n        var l_columnsToMeasure:Int;\r\n        if (target.requestedColumnCount != -1)\r\n            l_columnsToMeasure = target.requestedColumnCount;\r\n        else\r\n        {\r\n            l_columnsToMeasure = p_numElementsInLayout;\r\n            if (target.requestedMaxColumnCount != -1)\r\n                l_columnsToMeasure = Std.int(Math.min(target.requestedMaxColumnCount, l_columnsToMeasure));\r\n            if (target.requestedMinColumnCount != -1)\r\n                l_columnsToMeasure = Std.int(Math.max(target.requestedMinColumnCount, l_columnsToMeasure));\r\n        }\r\n        return l_columnsToMeasure;\r\n    }\r\n\t\r\n\t\r\n    /**\r\n     *  @private\r\n     *  Fills in the result with preferred and min sizes of the element.\r\n     */\r\n    private function _getElementWidth(p_element:Group, p_fixedColumnWidth:Null<Float>, p_result:SizesAndLimit):Void\r\n    {\r\n        // Calculate preferred width first, as it's being used to calculate min width\r\n        var l_elementPreferredWidth:Float = p_fixedColumnWidth==null ? Math.ceil(p_element.preferredWidth) :\r\n                                                                     p_fixedColumnWidth;\r\n        // Calculate min width\r\n        var l_flexibleWidth:Bool = p_element.percentWidth != null;\r\n        var l_elementMinWidth:Float = l_flexibleWidth ? Math.ceil(p_element.preferredMinWidth) : \r\n                                                     l_elementPreferredWidth;\r\n        p_result.preferredSize = l_elementPreferredWidth;\r\n        p_result.minSize = l_elementMinWidth;\r\n    }\r\n    \r\n    /**\r\n     *  @private\r\n     *  Fills in the result with preferred and min sizes of the element.\r\n     */\r\n    private function _getElementHeight(p_element:Group, p_justify:Bool, p_result:SizesAndLimit):Void\r\n    {\r\n        // Calculate preferred height first, as it's being used to calculate min height below\r\n        var l_elementPreferredHeight:Float = Math.ceil(p_element.preferredHeight);\r\n        \r\n        // Calculate min height\r\n        var l_flexibleHeight:Bool = (p_element.percentHeight != null) || p_justify;\r\n        var l_elementMinHeight:Float = l_flexibleHeight ? Math.ceil(p_element.preferredMinHeight) : \r\n                                                       l_elementPreferredHeight;\r\n        p_result.preferredSize = l_elementPreferredHeight;\r\n        p_result.minSize = l_elementMinHeight;\r\n    }\r\n\t\r\n\tprivate static function _pinBetween(p_val:Float, p_min:Float, p_max:Float):Float\r\n    {\r\n        return Math.min(p_max, Math.max(p_min, p_val));\r\n    }\r\n\t\r\n\tprivate static function _calculatePercentHeight(p_layoutElement:Group, p_height:Float):Float\r\n    {\r\n        var l_percentHeight:Float;\r\n\r\n\t\tl_percentHeight = _pinBetween(Math.min(Math.round(p_layoutElement.percentHeight * 0.01 * p_height), p_height),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   p_layoutElement.preferredMinHeight,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   p_layoutElement.preferredMaxHeight );\r\n\t\treturn l_percentHeight;\r\n    }\r\n\t\r\n\t\r\n    private static function _sizeLayoutElement(p_layoutElement:Group, p_height:Float, \r\n                                              p_verticalAlign:EVerticalAlign, p_restrictedHeight:Float, \r\n                                              p_width:Null<Float>, p_variableColumnWidth:Bool, \r\n                                              p_columnWidth:Float):Void\r\n    {\r\n        var l_newHeight:Null<Float> = null;\r\n        \r\n        // if verticalAlign is \"justify\" or \"contentJustify\", \r\n        // restrict the height to restrictedHeight.  Otherwise, \r\n        // size it normally\r\n        if (p_verticalAlign == EVerticalAlign.JUSTIFY ||\r\n            p_verticalAlign == EVerticalAlign.CONTENT_JUSTIFY)\r\n        {\r\n            l_newHeight = p_restrictedHeight;\r\n        }\r\n        else\r\n        {\r\n            if (p_layoutElement.percentHeight!=null)\r\n               l_newHeight = _calculatePercentHeight(p_layoutElement, p_height);   \r\n        }\r\n        \r\n        if (p_variableColumnWidth)\r\n            //p_layoutElement.setLayoutBoundsSize(p_width, l_newHeight);\r\n\t\t\tp_layoutElement.setActualSize(p_width, l_newHeight);\r\n        else\r\n            //p_layoutElement.setLayoutBoundsSize(p_columnWidth, l_newHeight);\r\n\t\t\tp_layoutElement.setActualSize(p_columnWidth, l_newHeight);\r\n    }\r\n\t\r\n\t\r\n    /**\r\n     *  @private\r\n     * \r\n     *  This function sets the width of each child\r\n     *  so that the widths add up to <code>width</code>. \r\n     *  Each child is set to its preferred width\r\n     *  if its percentWidth is zero.\r\n     *  If its percentWidth is a positive number,\r\n     *  the child grows (or shrinks) to consume its\r\n     *  share of extra space.\r\n     *  \r\n     *  The return value is any extra space that's left over\r\n     *  after growing all children to their maxWidth.\r\n     */\r\n    private function _distributeWidth(p_width:Float,\r\n                                     p_height:Float,\r\n                                     p_restrictedHeight:Float):Float\r\n    {\r\n        var l_spaceToDistribute:Float = p_width;\r\n        var l_totalPercentWidth:Float = 0;\r\n        var l_childInfoArray:Array<ChildInfo> = new Array<ChildInfo>();\r\n        var l_childInfo:ChildInfo;\r\n        var l_newHeight:Float;\r\n        var l_layoutElement:Group;\r\n        \r\n        // columnWidth can be expensive to compute\r\n        var l_cw:Float = (target.variableColumnWidth) ? 0 : Math.ceil(Std.parseFloat(target.columnWidth));\r\n        var l_totalCount:Int = target.children.length; // number of elements to use in gap calculation\r\n        \r\n        // If the child is flexible, store information about it in the\r\n        // childInfoArray. For non-flexible children, just set the child's\r\n        // width and height immediately.\r\n        for (f_child in target.children)\r\n        {\r\n            if (f_child==null || f_child.includeInLayout==false)\r\n            {\r\n                l_totalCount--;\r\n                continue;\r\n            }\r\n            \r\n            if (f_child.percentWidth!=null && target.variableColumnWidth)\r\n            {\r\n                l_totalPercentWidth += f_child.percentWidth;\r\n\r\n                l_childInfo = new ChildInfo();\r\n                l_childInfo.layoutElement = f_child;\r\n                l_childInfo.percent    = f_child.percentWidth;\r\n                l_childInfo.min        = f_child.preferredMinWidth;\r\n                l_childInfo.max        = f_child.preferredMaxWidth;\r\n                \r\n                l_childInfoArray.push(l_childInfo);                \r\n            }\r\n            else\r\n            {\r\n                _sizeLayoutElement(f_child, p_height, target.verticalAlign, \r\n                                  p_restrictedHeight, null, target.variableColumnWidth, l_cw);\r\n                \r\n                l_spaceToDistribute -= Math.ceil(f_child.width);\r\n            } \r\n        }\r\n        \r\n        if (l_totalCount > 1)\r\n            l_spaceToDistribute -= (l_totalCount-1) * target.gap;\r\n\r\n        // Distribute the extra space among the flexible children\r\n        if (l_totalPercentWidth!=0)\r\n        {\r\n            LayoutHelper.flexChildrenProportionally(p_width,\r\n                                            l_spaceToDistribute,\r\n                                            l_totalPercentWidth,\r\n                                            l_childInfoArray);\r\n            var l_roundOff:Float = 0;\r\n            for (f_childInfo in l_childInfoArray)\r\n            {\r\n                // Make sure the calculated percentages are rounded to pixel boundaries\r\n                var l_childSize:Int = Math.round(f_childInfo.size + l_roundOff);\r\n                l_roundOff += f_childInfo.size - l_childSize;\r\n\r\n                _sizeLayoutElement(f_childInfo.layoutElement, p_height, target.verticalAlign, \r\n                                  p_restrictedHeight, l_childSize, \r\n                                  target.variableColumnWidth, l_cw);\r\n                l_spaceToDistribute -= l_childSize;\r\n            }\r\n        }\r\n        return l_spaceToDistribute;\r\n    }\r\n\t\r\n\t /**\r\n     *  @private\r\n     * \r\n     *  Compute exact values for measuredWidth,Height and  measuredMinWidth,Height.\r\n     *  \r\n     *  Measure each of the layout elements.  If requestedColumnCount >= 0 we \r\n     *  consider the height and width of as many layout elements, padding with \r\n     *  typicalLayoutElement if needed, starting with index 0. We then only \r\n     *  consider the height of the elements remaining.\r\n     * \r\n     *  If requestedColumnCount is -1, we consider width/height of each element.\r\n     */\r\n\toverride public function measure():Void\r\n\t{\r\n\t\tvar l_size:SizesAndLimit          = new SizesAndLimit();\r\n        var l_justify:Bool\t              = target.verticalAlign == EVerticalAlign.JUSTIFY;\r\n        var l_numElements:Int             = target.children.length;     // How many elements there are in the target\r\n        var l_numElementsInLayout:Int     = l_numElements;                  // How many elements have includeInLayout == true, start off with numElements.\r\n        var l_requestedColumnCount:Int    = target.requestedColumnCount;\r\n        var l_columnsMeasured:Int         = 0;                            // How many columns have been measured\r\n        \r\n        var l_preferredHeight:Float      = 0; // sum of the elt preferred heights\r\n        var l_preferredWidth:Float       = 0; // max of the elt preferred widths\r\n        var l_minHeight:Float            = 0; // sum of the elt minimum heights\r\n        var l_minWidth:Float             = 0; // max of the elt minimum widths\r\n        \r\n        var l_fixedColumnWidth:Null<Float> = null;\r\n        if (!target.variableColumnWidth)\r\n\t\t\tif (target.columnWidth == \"calculated\")\r\n\t\t\t\tl_fixedColumnWidth = typicalLayoutElement.preferredWidth;  // query typicalLayoutElement, elt at index=0\r\n\t\t\telse\r\n\t\t\t\tl_fixedColumnWidth = Std.parseFloat(target.columnWidth);\r\n        \r\n        // Get the numElementsInLayout clamped to requested min/max\r\n        var l_columnsToMeasure:Int = _getColumsToMeasure(l_numElementsInLayout);\r\n\r\n        for (f_child in target.children)\r\n        {\r\n\t\t\tif (f_child==null || f_child.includeInLayout==false)\r\n            {\r\n                l_numElementsInLayout--;\r\n                continue;\r\n            }\r\n\t\t\t\r\n\t\t\t// Consider the height of each element, inclusive of those outside\r\n\t\t\t// the requestedColumnCount range.\r\n\t\t\t_getElementHeight(f_child, l_justify, l_size);\r\n\t\t\tl_preferredHeight = Math.max(l_preferredHeight, l_size.preferredSize);\r\n\t\t\tl_minHeight = Math.max(l_minHeight, l_size.minSize);\r\n\r\n            \r\n            // Can we measure the width of this column?\r\n            if (l_columnsMeasured < l_columnsToMeasure)\r\n            {\r\n                _getElementWidth(f_child, l_fixedColumnWidth, l_size);\r\n                l_preferredWidth += l_size.preferredSize;\r\n                l_minWidth += l_size.minSize;\r\n                l_columnsMeasured++;\r\n            }\r\n        }\r\n        \r\n        // Calculate the total number of columns to measure again, since numElementsInLayout may have changed \r\n        l_columnsToMeasure = _getColumsToMeasure(l_numElementsInLayout);\r\n\r\n        // Do we need to measure more columns?\r\n        if (l_columnsMeasured < l_columnsToMeasure)\r\n        {\r\n            // Use the typical element\r\n            var l_element:Group = typicalLayoutElement;\r\n            if (l_element!=null)\r\n            {\r\n\t\t\t\t// Height\r\n\t\t\t\t_getElementHeight(l_element, l_justify, l_size);\r\n\t\t\t\tl_preferredHeight = Math.max(l_preferredHeight, l_size.preferredSize);\r\n\t\t\t\tl_minHeight = Math.max(l_minHeight, l_size.minSize);\r\n    \r\n                // Width\r\n                _getElementWidth(l_element, l_fixedColumnWidth, l_size);\r\n                l_preferredWidth += l_size.preferredSize * (l_columnsToMeasure - l_columnsMeasured);\r\n                l_minWidth += l_size.minSize * (l_columnsToMeasure - l_columnsMeasured);\r\n                l_columnsMeasured = l_columnsToMeasure;\r\n            }\r\n        }\r\n\r\n        // Add gaps\r\n        if (l_columnsMeasured > 1)\r\n        { \r\n            var l_hgap:Float = target.gap * (l_columnsMeasured - 1);\r\n            l_preferredWidth += l_hgap;\r\n            l_minWidth += l_hgap;\r\n        }\r\n        \r\n        var l_hPadding:Float = target.paddingLeft + target.paddingRight;\r\n        var l_vPadding:Float = target.paddingTop + target.paddingBottom;\r\n        \r\n        target.measuredHeight = Math.ceil(l_preferredHeight + l_vPadding);\r\n        target.measuredWidth = Math.ceil(l_preferredWidth + l_hPadding);\r\n        target.measuredMinHeight = Math.ceil(l_minHeight + l_vPadding);\r\n        target.measuredMinWidth  = Math.ceil(l_minWidth + l_hPadding);\r\n\t\t\r\n\t\t//aris addition so things start make some sense... not good ofc. without it results are same so far\r\n\t\ttarget.measuredMaxWidth = 999999;\r\n\t\ttarget.measuredMaxHeight = 999999;\r\n\t}\r\n\t\r\n\toverride public function updateDisplayList(p_unscaledWidth:Float, p_unscaledHeight:Float):Void\r\n    {\r\n        if ((target.children.length == 0) || (p_unscaledWidth == 0) || (p_unscaledHeight == 0))\r\n        {\r\n/*\r\n            setColumnCount(0);\r\n            setIndexInView(-1, -1);\r\n*/\r\n            if (target.children.length == 0)\r\n\t\t\t{\r\n\t\t\t\ttarget.width = Math.ceil(target.paddingLeft + target.paddingRight);\r\n\t\t\t\ttarget.height = Math.ceil(target.paddingTop + target.paddingBottom);\r\n\t\t\t}\r\n            return;         \r\n        }\r\n\t\t\r\n        var l_targetWidth:Float = Math.max(0, target.width - target.paddingLeft - target.paddingRight);\r\n        var l_targetHeight:Float = Math.max(0, target.height - target.paddingTop - target.paddingBottom);\r\n        \r\n        \r\n        // If verticalAlign is top, we don't need to figure out the contentHeight.\r\n        // Otherwise the contentHeight is used to position the element and even size \r\n        // the element if it's \"contentJustify\" or \"justify\".\r\n        var l_containerHeight:Float = l_targetHeight;\r\n        if (target.verticalAlign == EVerticalAlign.CONTENT_JUSTIFY /*||\r\n           (clipAndEnableScrolling && (target.verticalAlign == EVerticalAlign.MIDDLE ||\r\n                                       target.verticalAlign == EVerticalAlign.BOTTOM))*/) \r\n        {\r\n            for (f_child in target.children)\r\n            {\r\n\t\t\t\tif (f_child==null || f_child.includeInLayout==false)\r\n\t\t\t\t\tcontinue;\r\n                \r\n                var l_layoutElementHeight:Float;\r\n                if (f_child.percentHeight!=null)\r\n                    l_layoutElementHeight = _calculatePercentHeight(f_child, l_targetHeight);\r\n                else\r\n                    l_layoutElementHeight = f_child.preferredHeight;\r\n                    \r\n                l_containerHeight = Math.max(l_containerHeight, Math.ceil(l_layoutElementHeight));\r\n            }\r\n        }\r\n\r\n        var l_excessWidth:Float = _distributeWidth(l_targetWidth, l_targetHeight, l_containerHeight);\r\n        \r\n        // default to top (0)\r\n        var l_vAlign:Float = 0;\r\n        if (target.verticalAlign == EVerticalAlign.MIDDLE)\r\n            l_vAlign = .5;\r\n        else if (target.verticalAlign == EVerticalAlign.BOTTOM)\r\n            l_vAlign = 1;\r\n/*\r\n        // If columnCount wasn't set, then as the LayoutElements are positioned\r\n        // we'll count how many columns fall within the layoutTarget's scrollRect\r\n        var visibleColumns:uint = 0;\r\n        var minVisibleX:Number = layoutTarget.horizontalScrollPosition;\r\n        var maxVisibleX:Number = minVisibleX + targetWidth\r\n*/\r\n        // Finally, position the LayoutElements and find the first/last\r\n        // visible indices, the content size, and the number of \r\n        // visible elements. \r\n        var l_x:Float = target.paddingLeft;\r\n        var l_y0:Float = target.paddingTop;\r\n        var l_maxX:Float = target.paddingLeft;\r\n        var l_maxY:Float = target.paddingTop; \r\n/*\r\n        var firstColInView:int = -1;\r\n        var lastColInView:int = -1;\r\n*/\r\n        // Take horizontalAlign into account\r\n        if (l_excessWidth > 0 || true/*!clipAndEnableScrolling*/)\r\n        {\r\n            var l_hAlign:EHorizontalAlign = target.horizontalAlign;\r\n            if (l_hAlign == EHorizontalAlign.CENTER)\r\n            {\r\n                l_x = target.paddingLeft + Math.round(l_excessWidth / 2);   \r\n            }\r\n            else if (l_hAlign == EHorizontalAlign.RIGHT)\r\n            {\r\n                l_x = target.paddingLeft + l_excessWidth;   \r\n            }\r\n        }\r\n\r\n\t\tfor (f_child in target.children)\r\n        {\r\n\t\t\tif (f_child==null || f_child.includeInLayout==false)\r\n\t\t\t\tcontinue;\r\n\r\n            // Set the layout element's position\r\n            var l_dx:Float = Math.ceil(f_child.width);\r\n            var l_dy:Float = Math.ceil(f_child.height);\r\n\r\n            var l_y:Float;\r\n\r\n\t\t\tl_y = l_y0 + (l_containerHeight - l_dy) * l_vAlign;\r\n\t\t\t// In case we have VerticalAlign.MIDDLE we have to round\r\n\t\t\tif (l_vAlign == 0.5)\r\n\t\t\t\tl_y = Math.round(l_y);\r\n\r\n\t\t\t\r\n            //layoutElement.setLayoutBoundsPosition(x, y);\r\n\t\t\tf_child.x = l_x;\r\n\t\t\tf_child.y = l_y;\r\n\r\n            // Update maxX,Y, first,lastVisibleIndex, and x\r\n            l_maxX = Math.max(l_maxX, l_x + l_dx);\r\n            l_maxY = Math.max(l_maxY, l_y + l_dy);   \r\n/*\r\n            if (!clipAndEnableScrolling || \r\n                ((x < maxVisibleX) && ((x + dx) > minVisibleX)) || \r\n                ((dx <= 0) && ((x == maxVisibleX) || (x == minVisibleX))))\r\n            {\r\n                visibleColumns += 1;\r\n                if (firstColInView == -1)\r\n                   firstColInView = lastColInView = index;\r\n                else\r\n                   lastColInView = index;\r\n\t\t\t}\r\n*/          \r\n            l_x += l_dx + target.gap;\r\n        }\r\n/*\r\n        setColumnCount(visibleColumns);  \r\n        setIndexInView(firstColInView, lastColInView);\r\n*/ \r\n        // Make sure that if the content spans partially over a pixel to the right/bottom,\r\n        // the content size includes the whole pixel.\r\n       // layoutTarget.setContentSize(Math.ceil(maxX + paddingRight),\r\n        //                            Math.ceil(maxY + paddingBottom));\r\n\t\t\r\n\t\t//OK THIS ONE NEEDS WORK...\r\n\t\ttarget.width = Math.ceil(p_unscaledWidth);\r\n\t\ttarget.height = Math.ceil(p_unscaledHeight);\r\n    }\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, February 2015\r\n */\r\n\r\npackage tools.spark.framework.layout.layouts;\r\nimport tools.spark.framework.layout.containers.Group;\r\nimport tools.spark.framework.layout.helpers.ChildInfo;\r\nimport tools.spark.framework.layout.helpers.LayoutHelper;\r\nimport tools.spark.framework.layout.helpers.SizesAndLimit;\r\nimport tools.spark.framework.layout.interfaces.EHorizontalAlign;\r\nimport tools.spark.framework.layout.interfaces.EVerticalAlign;\r\n\r\n/**\r\n * The VerticalLayout class arranges the layout elements in a vertical sequence, top to bottom, with optional gaps between the elements and optional padding around the sequence of elements.\r\n * The vertical position of the elements is determined by arranging them in a vertical sequence, top to bottom, taking into account the padding before the first element and the gaps between the elements.\r\n * The horizontal position of the elements is determined by the layout's horizontalAlign property.\r\n * @author Aris Kostakos\r\n */\r\nclass VerticalLayout extends ALayoutBase\r\n{\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\tlayoutType = \"Vertical\";\r\n\t}\r\n\t\r\n\t    /**\r\n     *  @private\r\n     *  @return rows to measure based on elements in layout and any requested/min/max rowCount settings. \r\n     */\r\n    private function _getRowsToMeasure(p_numElementsInLayout:Int):Int\r\n    {\r\n        var l_rowsToMeasure:Int;\r\n        if (target.requestedRowCount != -1)\r\n            l_rowsToMeasure = target.requestedRowCount;\r\n        else\r\n        {\r\n            l_rowsToMeasure = p_numElementsInLayout;\r\n            if (target.requestedMaxRowCount != -1)\r\n                l_rowsToMeasure = Std.int(Math.min(target.requestedMaxRowCount, l_rowsToMeasure));\r\n            if (target.requestedMinRowCount != -1)\r\n                l_rowsToMeasure = Std.int(Math.max(target.requestedMinRowCount, l_rowsToMeasure));\r\n        }\r\n        return l_rowsToMeasure;\r\n    }\r\n\t\r\n\t\r\n\t/**\r\n     *  @private\r\n     *  Fills in the result with preferred and min sizes of the element.\r\n     */\r\n    private function _getElementWidth(p_element:Group, p_justify:Bool, p_result:SizesAndLimit):Void\r\n    {\r\n        // Calculate preferred width first, as it's being used to calculate min width\r\n        var l_elementPreferredWidth:Float = Math.ceil(p_element.preferredWidth);\r\n        \r\n        // Calculate min width\r\n        var l_flexibleWidth:Bool = (p_element.percentWidth != null) || p_justify;\r\n        var l_elementMinWidth:Float = l_flexibleWidth ? Math.ceil(p_element.preferredMinWidth) : \r\n                                                     l_elementPreferredWidth;\r\n        p_result.preferredSize = l_elementPreferredWidth;\r\n        p_result.minSize = l_elementMinWidth;\r\n    }\r\n\t\r\n\t/**\r\n     *  @private\r\n     *  Fills in the result with preferred and min sizes of the element.\r\n     */\r\n    private function _getElementHeight(p_element:Group, p_fixedRowHeight:Null<Float>, p_result:SizesAndLimit):Void\r\n    {\r\n        // Calculate preferred height first, as it's being used to calculate min height below\r\n        var l_elementPreferredHeight:Float = p_fixedRowHeight==null ? Math.ceil(p_element.preferredHeight) :\r\n                                                                    p_fixedRowHeight;\r\n        // Calculate min height\r\n        var l_flexibleHeight:Bool = p_element.percentHeight != null;\r\n        var l_elementMinHeight:Float = l_flexibleHeight ? Math.ceil(p_element.preferredMinHeight) : \r\n                                                       l_elementPreferredHeight;\r\n        p_result.preferredSize = l_elementPreferredHeight;\r\n        p_result.minSize = l_elementMinHeight;\r\n    }\r\n\t\r\n\tprivate static function _pinBetween(p_val:Float, p_min:Float, p_max:Float):Float\r\n    {\r\n        return Math.min(p_max, Math.max(p_min, p_val));\r\n    }\r\n\t\r\n    private static function _calculatePercentWidth(p_layoutElement:Group, p_width:Float):Float\r\n    {\r\n        var l_percentWidth:Float;\r\n\r\n\t\tl_percentWidth = _pinBetween(Math.min(Math.round(p_layoutElement.percentWidth * 0.01 * p_width), p_width),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t  p_layoutElement.preferredMinWidth,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t  p_layoutElement.preferredMaxWidth );\r\n\t\treturn l_percentWidth;\r\n    }\r\n\t\r\n    private static function _sizeLayoutElement(p_layoutElement:Group, \r\n                                              p_width:Float, \r\n                                              p_horizontalAlign:EHorizontalAlign, \r\n                                              p_restrictedWidth:Float, \r\n                                              p_height:Null<Float>, \r\n                                              p_variableRowHeight:Bool, \r\n                                              p_rowHeight:Float):Void\r\n    {\r\n        var l_newWidth:Null<Float> = null;\r\n        \r\n        // if horizontalAlign is \"justify\" or \"contentJustify\", \r\n        // restrict the width to restrictedWidth.  Otherwise, \r\n        // size it normally\r\n        if (p_horizontalAlign == EHorizontalAlign.JUSTIFY ||\r\n            p_horizontalAlign == EHorizontalAlign.CONTENT_JUSTIFY)\r\n        {\r\n            l_newWidth = p_restrictedWidth;\r\n        }\r\n        else\r\n        {\r\n            if (p_layoutElement.percentWidth!=null)\r\n               l_newWidth = _calculatePercentWidth(p_layoutElement, p_width);\r\n        }\r\n        \r\n        if (p_variableRowHeight)\r\n            //layoutElement.setLayoutBoundsSize(newWidth, height);\r\n\t\t\tp_layoutElement.setActualSize(l_newWidth, p_height);\r\n        else\r\n            //layoutElement.setLayoutBoundsSize(newWidth, rowHeight);\r\n\t\t\tp_layoutElement.setActualSize(l_newWidth, p_rowHeight);\r\n    }\r\n\t\r\n\t\r\n\t\r\n\t/**\r\n     *  @private\r\n     * \r\n     *  This function sets the height of each child\r\n     *  so that the heights add up to <code>height</code>. \r\n     *  Each child is set to its preferred height\r\n     *  if its percentHeight is zero.\r\n     *  If its percentHeight is a positive number,\r\n     *  the child grows (or shrinks) to consume its\r\n     *  share of extra space.\r\n     *  \r\n     *  The return value is any extra space that's left over\r\n     *  after growing all children to their maxHeight.\r\n     */\r\n    private function _distributeHeight(p_width:Float, \r\n                                      p_height:Float, \r\n                                      p_restrictedWidth:Float):Float\r\n    {\r\n        var l_spaceToDistribute:Float = p_height;\r\n        var l_totalPercentHeight:Float = 0;\r\n        var l_childInfoArray:Array<ChildInfo> = new Array<ChildInfo>();\r\n        var l_childInfo:ChildInfo;\r\n        var l_layoutElement:Group;\r\n        \r\n        // rowHeight can be expensive to compute\r\n        var l_rh:Float = (target.variableRowHeight) ? 0 : Math.ceil(Std.parseFloat(target.rowHeight));\r\n        var l_totalCount:Int = target.children.length; // number of elements to use in gap calculation\r\n        \r\n        // If the child is flexible, store information about it in the\r\n        // childInfoArray. For non-flexible children, just set the child's\r\n        // width and height immediately.\r\n        for (f_child in target.children)\r\n        {\r\n            if (f_child==null || f_child.includeInLayout==false)\r\n            {\r\n                l_totalCount--;\r\n                continue;\r\n            }\r\n            \r\n            if (f_child.percentHeight!=null && target.variableRowHeight)\r\n            {\r\n                l_totalPercentHeight += f_child.percentHeight;\r\n\r\n                l_childInfo = new ChildInfo();\r\n                l_childInfo.layoutElement = f_child;\r\n                l_childInfo.percent    = f_child.percentHeight;\r\n                l_childInfo.min        = f_child.preferredMinHeight;\r\n                l_childInfo.max        = f_child.preferredMaxHeight;\r\n                \r\n                l_childInfoArray.push(l_childInfo);                \r\n            }\r\n            else\r\n            {\r\n                _sizeLayoutElement(f_child, p_width, target.horizontalAlign, \r\n                               p_restrictedWidth, null, target.variableRowHeight, l_rh);\r\n                \r\n                l_spaceToDistribute -= Math.ceil(f_child.height);\r\n            } \r\n        }\r\n        \r\n        if (l_totalCount > 1)\r\n            l_spaceToDistribute -= (l_totalCount-1) * target.gap;\r\n\r\n        // Distribute the extra space among the flexible children\r\n        if (l_totalPercentHeight!=0)\r\n        {\r\n            LayoutHelper.flexChildrenProportionally(p_height,\r\n                                            l_spaceToDistribute,\r\n                                            l_totalPercentHeight,\r\n                                            l_childInfoArray);\r\n\r\n            var l_roundOff:Float = 0;            \r\n            for (f_childInfo in l_childInfoArray)\r\n            {\r\n                // Make sure the calculated percentages are rounded to pixel boundaries\r\n                var l_childSize:Int = Math.round(f_childInfo.size + l_roundOff);\r\n                l_roundOff += f_childInfo.size - l_childSize;\r\n\r\n                _sizeLayoutElement(f_childInfo.layoutElement, p_width, target.horizontalAlign, \r\n                               p_restrictedWidth, l_childSize, \r\n                               target.variableRowHeight, l_rh);\r\n                l_spaceToDistribute -= l_childSize;\r\n            }\r\n        }\r\n        return l_spaceToDistribute;\r\n    }\r\n\t\r\n    /**\r\n     *  @private\r\n     * \r\n     *  Compute exact values for measuredWidth,Height and measuredMinWidth,Height.\r\n     * \r\n     *  Measure each of the layout elements.  If requestedRowCount >= 0 we \r\n     *  consider the height and width of as many layout elements, padding with \r\n     *  typicalLayoutElement if needed, starting with index 0. We then only \r\n     *  consider the width of the elements remaining.\r\n     * \r\n     *  If requestedRowCount is -1, we measure all of the layout elements.\r\n     */\r\n\toverride public function measure():Void\r\n\t{\r\n\t\tvar l_size:SizesAndLimit \t\t= new SizesAndLimit();\r\n        var l_justify:Bool \t\t\t\t= target.horizontalAlign == EHorizontalAlign.JUSTIFY;\r\n        var l_numElements:Int \t\t\t= target.children.length; // How many elements there are in the target\r\n        var l_numElementsInLayout:Int \t= l_numElements;      // How many elements have includeInLayout == true, start off with numElements.\r\n        var l_requestedRowCount:Int\t\t= target.requestedRowCount;\r\n        var l_rowsMeasured:Int\t\t\t= 0;                       // How many rows have been measured\r\n        \r\n        var l_preferredHeight:Float \t= 0; // sum of the elt preferred heights\r\n        var l_preferredWidth:Float \t\t= 0; // max of the elt preferred widths\r\n        var l_minHeight:Float \t\t\t= 0; // sum of the elt minimum heights\r\n        var l_minWidth:Float \t\t\t= 0; // max of the elt minimum widths\r\n        \r\n        var l_fixedRowHeight:Null<Float> = null;\r\n        if (!target.variableRowHeight)\r\n\t\t\tif (target.rowHeight == \"calculated\")\r\n\t\t\t\tl_fixedRowHeight = typicalLayoutElement.preferredHeight;  // query typicalLayoutElement, elt at index=0\r\n\t\t\telse\r\n\t\t\t\tl_fixedRowHeight = Std.parseFloat(target.rowHeight);\r\n        \r\n        // Get the numElementsInLayout clamped to requested min/max\r\n        var l_rowsToMeasure:Int = _getRowsToMeasure(l_numElementsInLayout);\r\n\r\n        for (f_child in target.children)\r\n        {\r\n\t\t\tif (f_child==null || f_child.includeInLayout==false)\r\n            {\r\n                l_numElementsInLayout--;\r\n                continue;\r\n            }\r\n            \r\n            // Can we measure this row height?\r\n            if (l_rowsMeasured < l_rowsToMeasure)\r\n            {\r\n                _getElementHeight(f_child, l_fixedRowHeight, l_size);\r\n                l_preferredHeight += l_size.preferredSize;\r\n                l_minHeight += l_size.minSize;\r\n                l_rowsMeasured++;\r\n            }\r\n            \r\n            // Consider the width of each element, inclusive of those outside\r\n            // the requestedRowCount range.\r\n            _getElementWidth(f_child, l_justify, l_size);\r\n            l_preferredWidth = Math.max(l_preferredWidth, l_size.preferredSize);\r\n            l_minWidth = Math.max(l_minWidth, l_size.minSize);\r\n        }\r\n        \r\n        // Calculate the total number of rows to measure again, since numElementsInLayout may have changed\r\n        l_rowsToMeasure = _getRowsToMeasure(l_numElementsInLayout);\r\n\r\n        // Do we need to measure more rows?\r\n        if (l_rowsMeasured < l_rowsToMeasure)\r\n        {\r\n            // Use the typical element\r\n            var l_element:Group = typicalLayoutElement;\r\n            if (l_element!=null)\r\n            {\r\n                // Height\r\n                _getElementHeight(l_element, l_fixedRowHeight, l_size);\r\n                l_preferredHeight += l_size.preferredSize * (l_rowsToMeasure - l_rowsMeasured);\r\n                l_minHeight += l_size.minSize * (l_rowsToMeasure - l_rowsMeasured);\r\n    \r\n                // Width\r\n                _getElementWidth(l_element, l_justify, l_size);\r\n                l_preferredWidth = Math.max(l_preferredWidth, l_size.preferredSize);\r\n                l_minWidth = Math.max(l_minWidth, l_size.minSize);\r\n                l_rowsMeasured = l_rowsToMeasure;\r\n            }\r\n        }\r\n\r\n        // Add gaps\r\n        if (l_rowsMeasured > 1)\r\n        { \r\n            var l_vgap:Float = target.gap * (l_rowsMeasured - 1);\r\n            l_preferredHeight += l_vgap;\r\n            l_minHeight += l_vgap;\r\n        }\r\n        \r\n        var l_hPadding:Float = target.paddingLeft + target.paddingRight;\r\n        var l_vPadding:Float = target.paddingTop + target.paddingBottom;\r\n        \r\n        target.measuredHeight = Math.ceil(l_preferredHeight + l_vPadding);\r\n        target.measuredWidth = Math.ceil(l_preferredWidth + l_hPadding);\r\n        target.measuredMinHeight = Math.ceil(l_minHeight + l_vPadding);\r\n        target.measuredMinWidth  = Math.ceil(l_minWidth + l_hPadding);\r\n\t\t\r\n\t\t//aris addition so things start make some sense... not good ofc. without it results are same so far\r\n\t\ttarget.measuredMaxWidth = 999999;\r\n\t\ttarget.measuredMaxHeight = 999999;\r\n\t}\r\n\t\r\n\toverride public function updateDisplayList(p_unscaledWidth:Float, p_unscaledHeight:Float):Void\r\n    {\r\n        if ((target.children.length == 0) || (p_unscaledWidth == 0) || (p_unscaledHeight == 0))\r\n        {\r\n/*\r\n            setRowCount(0);\r\n            setIndexInView(-1, -1);\r\n*/\r\n            if (target.children.length == 0)\r\n\t\t\t{\r\n\t\t\t\ttarget.width = Math.ceil(target.paddingLeft + target.paddingRight);\r\n\t\t\t\ttarget.height = Math.ceil(target.paddingTop + target.paddingBottom);\r\n\t\t\t}\r\n            return;         \r\n        }\r\n        \r\n        var l_targetWidth:Float = Math.max(0, target.width - target.paddingLeft - target.paddingRight);\r\n        var l_targetHeight:Float = Math.max(0, target.height - target.paddingTop - target.paddingBottom);\r\n        \r\n        // If horizontalAlign is left, we don't need to figure out the contentWidth\r\n        // Otherwise the contentWidth is used to position the element and even size \r\n        // the element if it's \"contentJustify\" or \"justify\".\r\n        var l_containerWidth:Float = l_targetWidth;        \r\n        if (target.horizontalAlign == EHorizontalAlign.CONTENT_JUSTIFY /*||\r\n           (clipAndEnableScrolling && (target.horizontalAlign == EHorizontalAlign.CENTER ||\r\n                                       target.horizontalAlign == EHorizontalAlign.RIGHT))*/) \r\n        {\r\n            for (f_child in target.children)\r\n            {\r\n\t\t\t\tif (f_child==null || f_child.includeInLayout==false)\r\n\t\t\t\t\tcontinue;\r\n\r\n                var l_layoutElementWidth:Float;\r\n                if (f_child.percentWidth!=null)\r\n                    l_layoutElementWidth = _calculatePercentWidth(f_child, l_targetWidth);\r\n                else\r\n                    l_layoutElementWidth = f_child.preferredWidth;\r\n                \r\n                l_containerWidth = Math.max(l_containerWidth, Math.ceil(l_layoutElementWidth));\r\n            }\r\n        }\r\n\r\n        var l_excessHeight:Float = _distributeHeight(l_targetWidth, l_targetHeight, l_containerWidth);\r\n        \r\n        // default to left (0)\r\n        var l_hAlign:Float = 0;\r\n        if (target.horizontalAlign == EHorizontalAlign.CENTER)\r\n            l_hAlign = .5;\r\n        else if (target.horizontalAlign == EHorizontalAlign.RIGHT)\r\n            l_hAlign = 1;\r\n/*\r\n        // As the layoutElements are positioned, we'll count how many rows \r\n        // fall within the layoutTarget's scrollRect\r\n        var visibleRows:uint = 0;\r\n        var minVisibleY:Number = layoutTarget.verticalScrollPosition;\r\n        var maxVisibleY:Number = minVisibleY + targetHeight;\r\n*/\r\n        // Finally, position the layoutElements and find the first/last\r\n        // visible indices, the content size, and the number of \r\n        // visible elements.    \r\n        var l_x0:Float = target.paddingLeft;\r\n        var l_y:Float = target.paddingTop;\r\n        var l_maxX:Float = target.paddingLeft;\r\n        var l_maxY:Float = target.paddingTop;\r\n/*\r\n        var firstRowInView:int = -1;\r\n        var lastRowInView:int = -1;\r\n*/\r\n        // Take verticalAlign into account\r\n        if (l_excessHeight > 0 || true/*!clipAndEnableScrolling*/)\r\n        {\r\n            var l_vAlign:EVerticalAlign = target.verticalAlign;\r\n            if (l_vAlign == EVerticalAlign.MIDDLE)\r\n            {\r\n                l_y = target.paddingTop + Math.round(l_excessHeight / 2);   \r\n            }\r\n            else if (l_vAlign == EVerticalAlign.BOTTOM)\r\n            {\r\n                l_y = target.paddingTop + l_excessHeight;   \r\n            }\r\n        }\r\n\r\n\t\tfor (f_child in target.children)\r\n        {\r\n\t\t\tif (f_child==null || f_child.includeInLayout==false)\r\n\t\t\t\tcontinue;\r\n                \r\n            // Set the layout element's position\r\n            var l_dx:Float = Math.ceil(f_child.width);\r\n            var l_dy:Float = Math.ceil(f_child.height);\r\n\r\n            var l_x:Float = l_x0 + (l_containerWidth - l_dx) * l_hAlign;\r\n            // In case we have HorizontalAlign.CENTER we have to round\r\n            if (l_hAlign == 0.5)\r\n                l_x = Math.round(l_x);\r\n\t\t\t\t\r\n            //layoutElement.setLayoutBoundsPosition(x, y);\r\n\t\t\tf_child.x = l_x;\r\n\t\t\tf_child.y = l_y;\r\n                            \r\n            // Update maxX,Y, first,lastVisibleIndex, and y\r\n            l_maxX = Math.max(l_maxX, l_x + l_dx);\r\n            l_maxY = Math.max(l_maxY, l_y + l_dy);\r\n/*\r\n            if (!clipAndEnableScrolling ||\r\n                ((y < maxVisibleY) && ((y + dy) > minVisibleY)) || \r\n                ((dy <= 0) && ((y == maxVisibleY) || (y == minVisibleY))))\r\n            {\r\n                visibleRows += 1;\r\n                if (firstRowInView == -1)\r\n                   firstRowInView = lastRowInView = index;\r\n                else\r\n                   lastRowInView = index;\r\n            }\r\n*/  \r\n            l_y += l_dy + target.gap;\r\n        }\r\n/*\r\n        setRowCount(visibleRows);\r\n        setIndexInView(firstRowInView, lastRowInView);\r\n*/ \r\n        // Make sure that if the content spans partially over a pixel to the right/bottom,\r\n        // the content size includes the whole pixel.\r\n       // layoutTarget.setContentSize(Math.ceil(maxX + paddingRight),\r\n        //                            Math.ceil(maxY + paddingBottom));\r\n\t\t\r\n\t\t//OK THIS ONE NEEDS WORK...\r\n\t\ttarget.width = Math.ceil(p_unscaledWidth);\r\n\t\ttarget.height = Math.ceil(p_unscaledHeight);\r\n    }\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.framework.layout.managers;\r\nimport flambe.display.Sprite;\r\nimport flambe.math.Rectangle;\r\nimport tools.spark.framework.layout.containers.Group;\r\nimport tools.spark.framework.space2_5D.interfaces.IEntity2_5D;\r\nimport tools.spark.framework.space2_5D.interfaces.IView2_5D;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.core.Sliced;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass LayoutManager\r\n{\r\n\tpublic var validated (default, default):Bool;\r\n\tpublic var rootLayoutElement (default, null):Group;\r\n\t\r\n\tpublic function new (p_rootLayoutElement)\r\n\t{\r\n\t\trootLayoutElement = p_rootLayoutElement;\r\n\t\tvalidated = false;\r\n\t}\r\n\t\r\n\tpublic function validate():Void\r\n\t{\r\n\t\tif (!validated)\r\n\t\t{\r\n\t\t\tConsole.error(\"VALIDATING LAYOUT...\");\r\n\t\t\tmeasure(rootLayoutElement);\r\n\t\t\t//logPreffered(rootLayoutElement);\r\n\t\t\tupdateDisplayList(rootLayoutElement);\r\n\t\t\t//log(rootLayoutElement);\r\n\t\t\tupdateRealObjects(rootLayoutElement);\r\n\t\t\tvalidated = true;\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function getViewGroupByGameEntity(p_gameEntity:IGameEntity, ?p_Group:Group):Group\r\n\t{\r\n\t\tif (p_Group == null)\r\n\t\t\tp_Group = rootLayoutElement;\r\n\t\t\r\n\t\tif (p_Group.layoutableEntity == p_gameEntity)\r\n\t\t\treturn p_Group;\r\n\t\t\t\r\n\t\tfor (f_child in p_Group.children)\r\n\t\t{\r\n\t\t\tif (f_child.layoutableInstanceType != \"Entity\")\r\n\t\t\t{\r\n\t\t\t\tvar l_found:Group = getViewGroupByGameEntity(p_gameEntity, f_child);\r\n\t\t\t\tif (l_found != null)\r\n\t\t\t\t\treturn l_found;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tpublic function updateRealObjects(p_Group:Group, p_parentsX:Float=0, p_parentsY:Float=0, p_parentView:IView2_5D=null):Void\r\n\t{\r\n\t\tvar l_view2_5D:IView2_5D = p_parentView;\r\n\t\t\r\n\t\t//up here cause it's top to bottom\r\n\t\tif (p_Group.layoutableInstanceType == \"View\")\r\n\t\t{\r\n\t\t\t//@todo: Here's the problem. Away3d view instances are not IView2_5Ds yet.. fix this..\r\n\t\t\tif (p_Group.layoutableEntity.getState('renderer') == '3D')\r\n\t\t\t{\r\n\t\t\t\tvar l_view3D:Dynamic = p_Group.layoutableInstance;\r\n\t\t\t\tl_view3D.x = p_Group.x + p_parentsX;\r\n\t\t\t\tl_view3D.y = p_Group.y + p_parentsY;\r\n\t\t\t\tl_view3D.width = p_Group.width;\r\n\t\t\t\tl_view3D.height = p_Group.height;\r\n\t\t\t\t//NEXT....\r\n\t\t\t\t//THIS DOESNT DO ANYTHING. SO START YOUR RESEARCH FROM HERE\r\n\t\t\t\t//MAYBE ITS TIME TO GET THE NEWEST VRSION OF AWAYJS ON!\r\n\t\t\t\t//why Im struggling to get 3d to work?\r\n\t\t\t\t//1) impressive results\r\n\t\t\t\t//2) its easier to understand how views, scenes and cameras will work here\r\n\t\t\t\t//because in away3d they already work properly (or should work properly..)\r\n\t\t\t\t//in 2d, i dont have the concept of viewports implemented yet..\r\n\t\t\t\t//so im scared to do it there..\r\n\t\t\t\t//why is this important for level editor?\r\n\t\t\t\t//because level editor must have a concept of viewports and real game stage, etc, etc..\r\n\t\t\t\t//BUT 2d physics, also impressive.. do spark machines!\r\n\t\t\t\t//Console.error('View3d x: ' + l_view3D.x  + ', y: ' + l_view3D.y + ', width: ' + l_view3D.width + ', height: ' + l_view3D.height);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tl_view2_5D = p_Group.layoutableInstance;\r\n\t\t\t\tl_view2_5D.setPosSize(p_Group.x + p_parentsX, p_Group.y + p_parentsY, p_Group.width, p_Group.height);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (p_Group.layoutableInstanceType == \"Entity\")\r\n\t\t{\r\n\t\t\tvar l_entity2_5D:IEntity2_5D = p_Group.layoutableInstance;\r\n\t\t\tl_entity2_5D.setPosSize(p_Group.x, p_Group.y, p_Group.width, p_Group.height, l_view2_5D);\r\n\t\t}\r\n\t\t\r\n\t\tfor (f_child in p_Group.children)\r\n\t\t{\r\n\t\t\tupdateRealObjects(f_child, p_Group.x+p_parentsX,p_Group.y+p_parentsY, l_view2_5D);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function log(p_group:Group, p_deepCount:Int=0):Void\r\n\t{\r\n\t\tvar logStr:String = \"\";\r\n\t\tvar i:Int = 0;\r\n\t\twhile (i < p_deepCount)\r\n\t\t{\r\n\t\t\tlogStr += \"***\";\r\n\t\t\ti++;\r\n\t\t}\r\n\t\t\r\n\t\tConsole.error(logStr + p_group.layoutableEntity.getState('name') \r\n\t\t\t\t\t\t\t+ \", x: \" + p_group.x\r\n\t\t\t\t\t\t\t+ \", y: \" + p_group.y\r\n\t\t\t\t\t\t\t+ \", w: \" + p_group.width\r\n\t\t\t\t\t\t\t+ \", h: \" + p_group.height);\r\n\r\n\t\tfor (f_child in p_group.children)\r\n\t\t{\r\n\t\t\tlog(f_child, p_deepCount+1);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function logPreffered(p_group:Group, p_deepCount:Int=0):Void\r\n\t{\r\n\t\tvar logStr:String = \"\";\r\n\t\tvar i:Int = 0;\r\n\t\twhile (i < p_deepCount)\r\n\t\t{\r\n\t\t\tlogStr += \"***\";\r\n\t\t\ti++;\r\n\t\t}\r\n\t\t\r\n\t\tConsole.error(logStr + p_group.layoutableEntity.getState('name') \r\n\t\t\t\t\t\t\t+ \", Prf Width: \" + p_group.preferredWidth\r\n\t\t\t\t\t\t\t+ \", Prf Height: \" + p_group.preferredHeight);\r\n\r\n\t\tfor (f_child in p_group.children)\r\n\t\t{\r\n\t\t\tlogPreffered(f_child, p_deepCount+1);\r\n\t\t}\r\n\t}\r\n\t\t\r\n\tpublic function measure(p_Group:Group):Void\r\n\t{\r\n\t\tfor (f_child in p_Group.children)\r\n\t\t{\r\n\t\t\tmeasure(f_child);\r\n\t\t}\r\n\t\t\r\n\t\t//down here cause it's bottom-up\r\n\t\t//only measure if explicit not set?\r\n\t\tp_Group.measure();\r\n\t}\r\n\t\r\n\tpublic function updateDisplayList(p_Group:Group):Void\r\n\t{\r\n\t\t//up here cause it's top to bottom\r\n\t\tp_Group.updateDisplayList(p_Group.preferredWidth, p_Group.preferredHeight);\r\n\t\t\r\n\t\tfor (f_child in p_Group.children)\r\n\t\t{\r\n\t\t\tupdateDisplayList(f_child);\r\n\t\t}\r\n\t}\r\n\t\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2013\r\n */\r\n\r\npackage tools.spark.framework.platform.html;\r\nimport tools.spark.sliced.core.Sliced;\r\n\r\n#if includeAway3D\r\n\timport tools.spark.framework.platform.html.away3d.Subgraphics;\r\n#else\r\n\timport tools.spark.framework.platform.html.flambe2_5.Subgraphics;\r\n#end\r\n\r\n#if includeNativeComponents\r\n\timport tools.spark.sliced.services.std.display.renderers.core.platform.html.NativeControlsHtmlRenderer;\r\n#end\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Graphics\r\n{\t\r\n\tpublic static function init():Void\r\n\t{\r\n\t\tSubgraphics.init();\r\n\t}\r\n\t\r\n\tpublic static function createDisplayRenderers():Void\r\n\t{\r\n\t\tSubgraphics.createDisplayRenderers();\r\n\t\t\r\n\t\t#if includeNativeComponents\r\n\t\t\t//Create Dom Renderer\r\n\t\t\tSliced.display.platformRendererSet[\"NativeControls\"] = new NativeControlsHtmlRenderer();\r\n\t\t#end\r\n\t}\r\n\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2013\r\n */\r\n\r\npackage tools.spark.framework.platform.html.flambe2_5;\r\nimport flambe.platform.InternalRenderer;\r\nimport tools.spark.sliced.core.Sliced;\r\nimport tools.spark.sliced.services.std.display.renderers.core.platform.html.Flambe2_5DHtmlRenderer;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.IRenderer;\r\nimport flambe.platform.html.HtmlPlatform;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Subgraphics\r\n{\t\r\n\tprivate static var _flambeDisplaySystem:InternalRenderer<Dynamic>;\r\n\t\r\n\tpublic static function createDisplayRenderers():Void\r\n\t{\r\n\t\t//Create Flambe Renderer\r\n\t\tSliced.display.platformRendererSet[\"2D\"] = new Flambe2_5DHtmlRenderer();\r\n\t}\r\n\t\r\n\t\r\n\tpublic static function init():Void\r\n\t{\r\n\t\t//Flambe Init\r\n\t\t_flambeDisplaySystem = HtmlPlatform.instance.getRenderer();\r\n\t}\r\n\t\r\n\r\n\tpublic static function onRender():Void\r\n\t{\r\n\t\t//Flambe Prepare Render\r\n\t\t_flambeDisplaySystem.willRender();\r\n\t\t\r\n\t\t//query display for views in order (far away first)\r\n\t\tif (Sliced.display!=null)\r\n\t\t{\r\n\t\t\t//@todo WTF, two more ifs here, JUST to check if there are active Views available???? DO SOMETHING ABOUT THAT, THIS THING RUNS EVERY - SINGLE - FRAME\r\n\t\t\tif (Sliced.display.projectActiveSpaceReference!=null)\r\n\t\t\t{\r\n\t\t\t\tif (Sliced.display.projectActiveSpaceReference.activeStageReference!=null)\r\n\t\t\t\t{\r\n\t\t\t\t\t//for each Active View Reference (there are in z-order)\r\n\t\t\t\t\tfor (activeViewReference in Sliced.display.projectActiveSpaceReference.activeStageReference.activeViewReferences)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t//Render viewEntity\r\n\t\t\t\t\t\tactiveViewReference.renderer.renderView(activeViewReference.viewEntity);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Flambe Finish Render\r\n\t\t_flambeDisplaySystem.didRender();\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.core;\r\n\r\nimport tools.spark.sliced.interfaces.IService;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\n@:keepSub class AService implements IService\r\n{\r\n\tprivate function new() \r\n\t{\r\n\t\t//private constructor...\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.core;\r\nimport tools.spark.framework.config.ENodeType;\r\nimport tools.spark.sliced.interfaces.IServiceFactory;\r\nimport tools.spark.sliced.interfaces.ISound;\r\nimport tools.spark.sliced.interfaces.ILogic;\r\nimport tools.spark.sliced.interfaces.IInput;\r\nimport tools.spark.sliced.interfaces.IComms;\r\nimport tools.spark.sliced.interfaces.IEvent;\r\nimport tools.spark.sliced.interfaces.IDisplay;\r\nimport tools.spark.framework.Project;\r\n\r\n/**\r\n * Every Available Service must be included below.\r\n * So that it is packaged to the application, in case\r\n * it needs to be reflected.\r\n */\r\n//Std\r\nimport tools.spark.sliced.services.std.sound.core.Sound;\r\nimport tools.spark.sliced.services.std.logic.core.Logic;\r\nimport tools.spark.sliced.services.std.input.core.Input;\r\nimport tools.spark.sliced.services.std.comms.core.Comms;\r\nimport tools.spark.sliced.services.std.event.core.Event;\r\nimport tools.spark.sliced.services.std.display.core.Display;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ServiceFactory implements IServiceFactory\r\n{\t\r\n\tpublic function new()\r\n\t{\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\t//Create Services (S.L.I.C.E.D.)\r\n\t\t_createServices();\r\n\t}\r\n\t\r\n\tprivate function _createServices():Void\r\n\t{\r\n\t\tvar l_soundService:ISound = _reflectService(ENodeType.SOUND_SERVICE);\r\n\t\tvar l_logicService:ILogic = _reflectService(ENodeType.LOGIC_SERVICE);\r\n\t\tvar l_inputService:IInput = _reflectService(ENodeType.INPUT_SERVICE);\r\n\t\tvar l_commsService:IComms = _reflectService(ENodeType.COMMUNICATIONS_SERVICE);\r\n\t\tvar l_eventService:IEvent = _reflectService(ENodeType.EVENT_SERVICE);\r\n\t\tvar l_displayService:IDisplay = _reflectService(ENodeType.DISPLAY_SERVICE);\r\n\t\t\r\n\t\tSliced.assignServices(l_soundService, l_logicService, l_inputService, l_commsService, l_eventService, l_displayService);\r\n\t}\r\n\t\r\n\tinline private function _reflectService(p_slicedService:ENodeType):Dynamic\r\n\t{\r\n\t\t//@todo: create throw/catch for an exception when the url cannot be resolved or cannot be created.\r\n\t\tvar l_classPath:String = Project.sliced[p_slicedService];\r\n\t\treturn Type.createInstance(Type.resolveClass(l_classPath), []);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.core;\r\nimport tools.spark.sliced.interfaces.ISound;\r\nimport tools.spark.sliced.interfaces.ILogic;\r\nimport tools.spark.sliced.interfaces.IInput;\r\nimport tools.spark.sliced.interfaces.IComms;\r\nimport tools.spark.sliced.interfaces.IEvent;\r\nimport tools.spark.sliced.interfaces.IDisplay;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Sliced\r\n{\r\n\tpublic static var sound( default, null ):ISound;\r\n\tpublic static var logic( default, null ):ILogic;\r\n\tpublic static var input( default, null ):IInput;\r\n\tpublic static var comms( default, null ):IComms;\r\n\tpublic static var event( default, null ):IEvent;\r\n\tpublic static var display( default, null ):IDisplay;\r\n\t\r\n\tpublic static function init():Void\r\n\t{\r\n\t\t//Create Service Factory (which will create S.L.I.C.E.D.)\r\n\t\tvar l_serviceFactory:ServiceFactory = new ServiceFactory();\r\n\t}\r\n\t\r\n\tpublic static function assignServices(p_sound:ISound, p_logic:ILogic, p_input:IInput, p_comms:IComms, p_event:IEvent, p_display:IDisplay):Void\r\n\t{\r\n\t\tConsole.log(\"Init Core (S.L.I.C.E.D.)...\");\r\n\t\tsound = p_sound;\r\n\t\tlogic = p_logic;\r\n\t\tinput = p_input;\r\n\t\tcomms = p_comms;\r\n\t\tevent = p_event;\r\n\t\tdisplay = p_display;\r\n\t}\r\n\t\r\n\t//@todo: maybe inline all the update functions?\r\n\tinline public static function update():Void\r\n\t{\r\n\t\t//Input Update\r\n\t\tSliced.input.update();\r\n\t\t\r\n\t\t//Event Update\r\n\t\tSliced.event.update();\r\n\t\t\r\n\t\t//Logic Update\r\n\t\tSliced.logic.update();\r\n\t\t\r\n\t\t//Display Update\r\n\t\tSliced.display.update();\r\n\t\t\r\n\t\t//Comms Update\r\n\t\tSliced.comms.update();\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, December 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.comms.core;\r\n\r\nimport tools.spark.sliced.interfaces.IComms;\r\nimport tools.spark.sliced.core.AService;\r\nimport tools.spark.sliced.services.std.comms.filetransfer.interfaces.IFileTransfer;\r\nimport tools.spark.sliced.services.std.comms.sockets.interfaces.ISocket;\r\nimport tools.spark.sliced.core.Sliced;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EEventType;\r\n\r\n//@think: loading sources for both socket io and native websocket will make the runtime file bigger unnessecerily\r\n//however, adding more ifdefs here (if io, if websocket, if none) etc, will create way, waaay too many runtimes\r\n//for all combinations, for example: html5->2d->withPhysics->with socketIo, etc... so we want that? only if it's easy to\r\n//create all those runtimes easily with one click... (me the developer, the end-user will have no idea, or care of course)\r\n//benefit of course is, thin runtimes..\r\n#if flash\r\n\t#if socketIO\r\n\t\timport tools.spark.sliced.services.std.comms.sockets.core.pomelo.platform.flash.socketio.Socket;\r\n\t#else\r\n\t\timport tools.spark.sliced.services.std.comms.sockets.core.pomelo.platform.flash.websocket.Socket;\r\n\t#end\r\n#else\r\n\t#if socketIO\r\n\t\timport tools.spark.sliced.services.std.comms.sockets.core.pomelo.platform.html5.socketio.Socket;\r\n\t#else\r\n\t\timport tools.spark.sliced.services.std.comms.sockets.core.pomelo.platform.html5.websocket.Socket;\r\n\t#end\r\n#end\r\n\r\n//File Transfer\r\n#if flash\r\n\r\n#else\r\n\timport tools.spark.sliced.services.std.comms.filetransfer.core.platform.html5.websocket.binaryjs.FileTransfer;\r\n#end\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Comms extends AService implements IComms\r\n{\r\n\tprivate var _socket:ISocket;\r\n\tprivate var _requestsData:Map<String, Dynamic>;\r\n\tprivate var _serverEventsData:Map<String, Dynamic>;\r\n\t\r\n\tpublic var isConnected( default, null ):Bool;\r\n\tpublic var connectedServerName( default, null ):String;\r\n\t\r\n\t\r\n\tpublic var file_isConnected( default, null ):Bool;\r\n\tpublic var file_connectedServerName( default, null ):String;\r\n\t\r\n\tprivate var _fileTransfer:IFileTransfer;\r\n\tprivate var _file_requestsData:Map<String, Dynamic>;\r\n\t\r\n\t\r\n\t//have some info here for polling... connected or not... connected to where, etc... logging maybe..\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\tConsole.log(\"Init Comms std Service...\");\r\n\t\t\r\n\t\t//if you remove ifdefs for socket io, include full path of Socket class here.. otherwise, it's ok\r\n\t\t_socket = new Socket();\r\n\t\t\r\n\t\t_requestsData = new Map<String, Dynamic>();\r\n\t\t_serverEventsData = new Map<String, Dynamic>();\r\n\t\t\r\n\t\tisConnected = false;\r\n\t\t\r\n\t\t_file_requestsData = new Map<String, Dynamic>();\r\n\t\tfile_isConnected = false;\r\n\t}\r\n\t\r\n\tpublic function update():Void\r\n\t{\r\n\t\t_requestsData = new Map<String, Dynamic>();\r\n\t\t_serverEventsData = new Map<String, Dynamic>();\r\n\t\t_file_requestsData = new Map<String, Dynamic>();\r\n\t}\r\n\t\r\n\tpublic function getRequestData(p_requestName:String):Dynamic\r\n\t{\r\n\t\treturn _requestsData[p_requestName];\r\n\t}\r\n\t\r\n\tpublic function getServerEventData(p_serverEventName:String):Dynamic\r\n\t{\r\n\t\treturn _serverEventsData[p_serverEventName];\r\n\t}\r\n\t\r\n\tpublic function connectTo(p_hostname:String, p_port:String, ?p_serverIdentifier:String):Void\r\n\t{\r\n\t\tif (p_serverIdentifier == null)\r\n\t\t\tp_serverIdentifier = p_hostname+\":\"+p_port;\r\n\t\t\t\r\n\t\t//Using Closures to preserve server id\r\n\t\tvar l_connectToCallback:Void->Void = function () \r\n\t\t{\r\n\t\t\tisConnected = true;\r\n\t\t\tconnectedServerName = p_serverIdentifier;\r\n\t\t\tSliced.event.raiseEvent(NETWORK_CONNECTED);\r\n\t\t}\r\n\t\t\r\n\t\t_socket.init(p_hostname, p_port, l_connectToCallback);\r\n\t}\r\n\t\r\n\tpublic function request(p_remoteRoute:String, p_message:Dynamic, ?p_requestIdentifier:String):Void\r\n\t{\r\n\t\tif (p_requestIdentifier == null)\r\n\t\t\tp_requestIdentifier = p_remoteRoute;\r\n\t\t\t\r\n\t\t//Using Closures to preserve request id\r\n\t\tvar l_requestCallback:Dynamic->Void = function (p_data:Dynamic) \r\n\t\t{\r\n\t\t\t_requestsData[p_requestIdentifier] = p_data;\r\n\t\t\tSliced.event.raiseEvent(NETWORK_REQUEST);\r\n\t\t}\r\n\t\t\r\n\t\t_socket.request(p_remoteRoute, p_message, l_requestCallback);\r\n\t}\r\n\t\r\n\t\r\n\tpublic function disconnect():Void\r\n\t{\r\n\t\t_socket.disconnect();\r\n\t\tisConnected = false;\r\n\t\tconnectedServerName = null;\r\n\t}\r\n\t\r\n\t\r\n\t//public function notify\r\n\t//...\r\n\t\r\n\t\r\n\tpublic function addServerEvent(p_serverEventName:String, ?p_serverEventIdentifier:String):Void\r\n\t{\r\n\t\tif (p_serverEventIdentifier == null)\r\n\t\t\tp_serverEventIdentifier = p_serverEventName;\r\n\t\t\t\r\n\t\t//Using Closures to preserve request id\r\n\t\tvar l_serverEventCallback:Dynamic->Void = function (p_data:Dynamic) \r\n\t\t{\r\n\t\t\t_serverEventsData[p_serverEventIdentifier] = p_data;\r\n\t\t\tSliced.event.raiseEvent(NETWORK_SERVER_EVENT);\r\n\t\t}\r\n\t\t\r\n\t\t_socket.on(p_serverEventName, l_serverEventCallback);\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t//FILE TRANSFER FUNCTIONS\r\n\t\r\n\tpublic function file_connectTo(p_hostname:String, p_port:String, ?p_serverIdentifier:String):Void\r\n\t{\r\n\t\tif (file_isConnected)\r\n\t\t{\r\n\t\t\tConsole.warn(\"Attempting to connect to file server: File Transfer already connected. Disconnect first.\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (p_serverIdentifier == null)\r\n\t\t\t\tp_serverIdentifier = p_hostname+\":\"+p_port;\r\n\t\t\t\t\r\n\t\t\t//Using Closures to preserve server id\r\n\t\t\tvar l_connectToCallback:Void->Void = function () \r\n\t\t\t{\r\n\t\t\t\tfile_isConnected = true;\r\n\t\t\t\tfile_connectedServerName = p_serverIdentifier;\r\n\t\t\t\tSliced.event.raiseEvent(FILETRANSFER_CONNECTED);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t_fileTransfer = new FileTransfer(\"ws://\" + p_hostname+\":\" + p_port);\r\n\t\t\t\r\n\t\t\t_fileTransfer.onConnected(l_connectToCallback);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function file_getSendFileRequestData(p_fileRequestName:String):Dynamic\r\n\t{\r\n\t\treturn _file_requestsData[p_fileRequestName];\r\n\t}\r\n\t\r\n\tpublic function file_disconnect():Void\r\n\t{\r\n\t\t_fileTransfer.disconnect();\r\n\t\tfile_isConnected = false;\r\n\t\t_fileTransfer = null;\r\n\t\tfile_connectedServerName = null;\r\n\t}\r\n\r\n\tpublic function file_sendFileRequest(p_fileReference:Dynamic, p_fileMeta:Dynamic, ?p_fileRequestIdentifier:String):Void\r\n\t{\r\n\t\tif (!file_isConnected)\r\n\t\t{\r\n\t\t\tConsole.warn(\"Attempting to send a file: File Transfer is not connected.\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (p_fileRequestIdentifier == null)\r\n\t\t\t\tp_fileRequestIdentifier = p_fileMeta.name;\r\n\t\t\t\t\r\n\t\t\tvar clsr_progressBytes:Float = 0;\r\n\t\t\t\r\n\t\t\t//Using Closures to preserve request id\r\n\t\t\tvar l_requestCallback:Dynamic->Void = function (p_data:Dynamic) \r\n\t\t\t{\r\n\t\t\t\tclsr_progressBytes += p_data.length;\r\n\t\t\t\t\r\n\t\t\t\tp_data.progress = clsr_progressBytes / p_fileMeta.size;\r\n\t\t\t\t\r\n\t\t\t\tp_data.progressPercent = Math.round((clsr_progressBytes / p_fileMeta.size)* 100);\r\n\t\t\t\t\r\n\t\t\t\t_file_requestsData[p_fileRequestIdentifier] = p_data;\r\n\t\t\t\tSliced.event.raiseEvent(FILETRANSFER_SENDREQUEST);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t_fileTransfer.sendFile(p_fileReference, p_fileMeta, l_requestCallback);\r\n\t\t}\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, February 2015\r\n */\r\n\r\npackage tools.spark.sliced.services.std.comms.filetransfer.core.platform.html5.websocket.binaryjs;\r\n\r\nimport tools.spark.sliced.services.std.comms.filetransfer.core.platform.html5.websocket.binaryjs.externs.IBinaryJs;\r\nimport tools.spark.sliced.services.std.comms.filetransfer.interfaces.IFileTransfer;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass FileTransfer implements IFileTransfer\r\n{\r\n\tprivate var _binaryJs:IBinaryJs;\r\n\t\r\n\tpublic function new(p_address:String) \r\n\t{\r\n\t\t_binaryJs = new IBinaryJs(p_address);\r\n\t}\r\n\t\r\n\tpublic function onConnected(p_callback:Void->Void):Void\r\n\t{\r\n\t\t_binaryJs.on(\"open\", p_callback);\r\n\t}\r\n\t\r\n\tpublic function disconnect():Void\r\n\t{\r\n\t\t_binaryJs.close();\r\n\t\t_binaryJs = null;\r\n\t}\r\n\t\r\n\tpublic function sendFile(p_fileReference:Dynamic, p_fileMeta:Dynamic, ?p_callBack:Dynamic->Void):Void\r\n\t{\r\n\t\tvar l_stream:Dynamic = _binaryJs.send(p_fileReference, p_fileMeta);\r\n\t\t\r\n\t\tl_stream.on('data', p_callBack);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, December 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.comms.sockets.core.pomelo.platform.html5.websocket ;\r\n\r\nimport tools.spark.sliced.services.std.comms.sockets.core.pomelo.platform.html5.websocket.externs.IPomeloClientWebSocketJs;\r\nimport tools.spark.sliced.services.std.comms.sockets.interfaces.ISocket;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Socket implements ISocket\r\n{\r\n\tpublic function new() \r\n\t{\r\n\t\t\r\n\t}\r\n\r\n\tpublic function init(p_hostName:String, p_port:String, p_log:Bool=false, ?p_callBack:Void->Void):Void\r\n\t{\r\n\t\tIPomeloClientWebSocketJs.init({host:p_hostName, port:p_port, log: p_log}, p_callBack);\r\n\t}\r\n\t\r\n\tpublic function request(p_route:String, p_msg:Dynamic, ?p_callBack:Dynamic->Void):Void\r\n\t{\r\n\t\tIPomeloClientWebSocketJs.request(p_route, p_msg, p_callBack);\r\n\t}\r\n\t\r\n\tpublic function notify(p_route:Dynamic, p_msg:Dynamic):Void\r\n\t{\r\n\t\tIPomeloClientWebSocketJs.notify(p_route, p_msg);\r\n\t}\r\n\t\r\n\tpublic function on(p_route:String, ?p_callback:Dynamic->Void):Void\r\n\t{\r\n\t\tIPomeloClientWebSocketJs.on(p_route, p_callback);\r\n\t}\r\n\t\r\n\tpublic function disconnect():Void\r\n\t{\r\n\t\tIPomeloClientWebSocketJs.disconnect();\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.active_displayentity_references.core;\r\n\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveSpaceReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveStageReference;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ActiveSpaceReference implements IActiveSpaceReference\r\n{\r\n\tpublic var activeStageReference( default, default ):IActiveStageReference;\r\n\tpublic var spaceEntity( default, null ):IGameEntity;\r\n\t\r\n\tpublic function new(p_spaceEntity:IGameEntity) \r\n\t{\r\n\t\tspaceEntity = p_spaceEntity;\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.active_displayentity_references.core;\r\n\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveStageAreaReference;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.framework.layout.containers.Group;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ActiveStageAreaReference implements IActiveStageAreaReference\r\n{\r\n\tpublic var stageAreaEntity( default, null ):IGameEntity;\r\n\tpublic var layoutElement( default, null ):Group;\r\n\t\r\n\tpublic function new(p_stageAreaEntity:IGameEntity) \r\n\t{\r\n\t\tstageAreaEntity = p_stageAreaEntity;\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tinline private function _init():Void\r\n\t{\r\n\t\t//A brand new root Group is created..\r\n\t\tlayoutElement = new Group(stageAreaEntity, \"StageArea\", this);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.active_displayentity_references.core;\r\n\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveStageReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveStageAreaReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveViewReference;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.framework.layout.containers.Group;\r\nimport tools.spark.framework.layout.managers.LayoutManager;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ActiveStageReference implements IActiveStageReference\r\n{\r\n\tpublic var activeViewReferences (default, null ):Array<IActiveViewReference>;\r\n\tpublic var activeStageAreaReferences (default, null ):Array<IActiveStageAreaReference>;\r\n\tpublic var stageEntity( default, null ):IGameEntity;\r\n\tpublic var layoutRoot( default, null ):Group;\r\n\tpublic var layoutManager( default, null ):LayoutManager;\r\n\t\r\n\tpublic function new(p_stageEntity:IGameEntity) \r\n\t{\r\n\t\tstageEntity = p_stageEntity;\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tinline private function _init():Void\r\n\t{\r\n\t\tactiveViewReferences = new Array<IActiveViewReference>();\r\n\t\tactiveStageAreaReferences = new Array<IActiveStageAreaReference>();\r\n\t\t\r\n\t\t//A brand new root Group is created..\r\n\t\tlayoutRoot = new Group(stageEntity, \"Stage\", this);\r\n\t\t\r\n\t\t//the idea is, the stageEntity might give instructions for a specific layout manager, although right now we just have the one\r\n\t\t//also since we give the manager a rootElement on constructor, discard the whole manager if we change activeStage\r\n\t\tlayoutManager = new LayoutManager(layoutRoot);\r\n\t\t\r\n\t\t//not sure if I should put this here... it's the flambe's native resize event..\r\n\t\t// System.stage.resize is a Signal, listen to it.\r\n\t\tflambe.System.stage.resize.connect(_onResize);\r\n\t}\r\n\r\n\tprivate function _onResize()\r\n\t{\r\n\t\t//this is a new low of sloppiness.. fix plzz... soon\r\n\t\t#if html\r\n\t\t\tlayoutRoot.explicitWidth = js.Browser.window.innerWidth;\r\n\t\t\tlayoutRoot.explicitHeight = js.Browser.window.innerHeight;\r\n\t\t#else\r\n\t\t\tlayoutRoot.explicitWidth = flambe.System.stage.width;\r\n\t\t\tlayoutRoot.explicitHeight = flambe.System.stage.height;\r\n\t\t#end\r\n\r\n\t\t//Console.error(\"*****WIDTH******: \" + layoutRoot.explicitWidth);\r\n\t\t//Console.error(\"*****HEIGHT******: \" + layoutRoot.explicitHeight);\r\n\t\tlayoutManager.validated = false;\r\n\t}\r\n\t\r\n\tpublic function logViewReferences():Void\r\n\t{\r\n\t\tConsole.log(\"Printing Active Views\");\r\n\t\tConsole.log(\"---------------------\");\r\n\t\tfor (activeViewReference in activeViewReferences)\r\n\t\t{\r\n\t\t\tConsole.log(\"View \" + activeViewReference.viewEntity.getState('name') + \" Index: \" + activeViewReference.viewEntity.getState('zIndex'));\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function addView(p_viewReference:IActiveViewReference):Void\r\n\t{\r\n\t\t//Push the new View Reference\r\n\t\tactiveViewReferences.push(p_viewReference);\r\n\t\t\r\n\t\t//Reorder View References\r\n\t\tactiveViewReferences.sort(_orderViews);\r\n\t\t\r\n\t\t//update layout tree as well\r\n\t\t_addLayoutElement(p_viewReference.layoutElement);\r\n\t}\r\n\t\r\n\tpublic function addStageArea(p_stageAreaReference:IActiveStageAreaReference):Void\r\n\t{\r\n\t\t//Push the new StageArea Reference\r\n\t\tactiveStageAreaReferences.push(p_stageAreaReference);\r\n\t\t\r\n\t\t//update layout tree as well\r\n\t\t_addLayoutElement(p_stageAreaReference.layoutElement);\r\n\t}\r\n\t\r\n\tprivate function _addLayoutElement(p_layoutElement:Group):Void\r\n\t{\r\n\t\tif (p_layoutElement.layoutableEntity.getState('parent') == \"Implicit\")\r\n\t\t{\r\n\t\t\tlayoutRoot.children.push(p_layoutElement);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfor (activeStageAreaReference in activeStageAreaReferences)\r\n\t\t\t{\r\n\t\t\t\tif (activeStageAreaReference.stageAreaEntity.getState('name') == p_layoutElement.layoutableEntity.getState('parent'))\r\n\t\t\t\t{\r\n\t\t\t\t\tactiveStageAreaReference.layoutElement.children.push(p_layoutElement);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _orderViews(viewReference1:IActiveViewReference, viewReference2:IActiveViewReference):Int\r\n\t{\r\n\t\tif (viewReference1.viewEntity.getState('zIndex')>viewReference2.viewEntity.getState('zIndex')) return 1;\r\n\t\telse if (viewReference1.viewEntity.getState('zIndex') < viewReference2.viewEntity.getState('zIndex')) return -1;\r\n\t\telse return 0;\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.active_displayentity_references.core;\r\n\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveViewReference;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.IPlatformSpecificRenderer;\r\nimport tools.spark.framework.layout.containers.Group;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ActiveViewReference implements IActiveViewReference\r\n{\r\n\tpublic var viewEntity( default, null ):IGameEntity;\r\n\tpublic var renderer( default, default ):IPlatformSpecificRenderer;\r\n\tpublic var layoutElement( default, null ):Group;\r\n\t\r\n\tpublic function new(p_viewEntity:IGameEntity) \r\n\t{\r\n\t\tviewEntity = p_viewEntity;\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tinline private function _init():Void\r\n\t{\r\n\t\t//A brand new root Group is created..\r\n\t\tlayoutElement = new Group(viewEntity, \"View\", this);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.core;\r\n\r\nimport tools.spark.framework.Framework;\r\nimport tools.spark.sliced.interfaces.IDisplay;\r\nimport tools.spark.sliced.core.AService;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveSpaceReference;\r\nimport tools.spark.sliced.services.std.display.databuffer.core.DataBuffer;\r\nimport tools.spark.sliced.services.std.display.databuffer.interfaces.EBufferEntryType;\r\nimport tools.spark.sliced.services.std.display.databuffer.interfaces.IDataBuffer;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveSpaceReference;\r\nimport tools.spark.sliced.services.std.display.managers.core.ActiveReferenceMediator;\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IActiveReferenceMediator;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.IPlatformSpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameSpace;\r\nimport tools.spark.framework.layout.managers.LayoutManager;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Display extends AService implements IDisplay\r\n{\r\n\t//@TODO: When you create the std .egc, .fgc, etc templates, DO ONE THING. You have an .egc (extension) called \"Positionable\". That's excellent, but \r\n\t//it should create an extra Boolean state called \"Positionable\" with value to true. So, now we practically have COMPONENT BASED LOGIC in LionML. Just like that!\r\n\t//So we is this here at Display? Well, after you do this, go to the renderers, and when you update things (put the data to the actual renderer), check against States\r\n\t//like \"Positionable\", or \"3DForm\" or \"2DForm\" or \"Physicsable\" or AAANYTHING else, and only update if it is a component like that... This can decide if the whole\r\n\t//game can be run on both 3d and 2d... it can decide everything.. it links the component system with Display and all its renderers in a neat and clean way. Do it!!!\r\n\t\r\n\t\r\n\t//@todo: somewhere here, add a filtering mechanism for choosing the appropriate renderer\r\n\t//do this by enumerating all the available renderers added for the current platform\r\n\t//and start disqualifing renderers due to platform requirements and restrictions\r\n\t//order by gRenderer request, then chose the top one\r\n\t//@todo: Reflection needed here!!! See above todo\r\n\t\r\n\t//@think: this is a nice way to check if a new view/scene/entity/etc has been created, \r\n\t//instead of itterating the virtual world. The Renderer may find this useful.\r\n\t//do i need to itterate anything now that I ditched the logicalSpace?\r\n\t\r\n\t\r\n\tprivate var _dataBuffer:IDataBuffer;\r\n\t\r\n\t//This array will be modified from Subgraphic modules, depending on which renderers are available on the platform\r\n\tpublic var platformRendererSet( default, null ):Map<String, IPlatformSpecificRenderer>;\r\n\tpublic var projectActiveSpaceReference( default, null ):IActiveSpaceReference;\r\n\t\r\n\tprivate var _activeReferenceMediator:IActiveReferenceMediator;\r\n\t\r\n\tprivate var _renderStateNames:Map<String,Bool>;\r\n\tprivate var _renderFormStateNames:Map<String,Bool>;\r\n\t\r\n\tprivate function _initRenderStateNames():Void\r\n\t{\r\n\t\t_renderStateNames['2DmeshType'] = true;\r\n\t\t_renderStateNames['3DmeshType'] = true;\r\n\t\t_renderStateNames['touchable'] = true;\r\n\t\t_renderStateNames['2DMeshImageForm'] = true;\r\n\t\t_renderStateNames['2DMeshSpriterForm'] = true;\r\n\t\t_renderStateNames['2DMeshFillRectForm'] = true;\r\n\t\t_renderStateNames['2DMeshSpriteForm'] = true;\r\n\t\t\r\n\t\t_renderStateNames['2DMeshSpriterAnimForm'] = true;\r\n\t\t\r\n\t\t_renderStateNames['visibility'] = true;\r\n\t\t_renderStateNames['visible'] = true;\r\n\t\t_renderStateNames['width'] = true;\r\n\t\t_renderStateNames['height'] = true;\r\n\t\t_renderStateNames['opacity'] = true;\r\n\t\t_renderStateNames['display'] = true;\r\n\t\t_renderStateNames['text'] = true;\r\n\t\t_renderStateNames['fontSize'] = true;\r\n\t\t_renderStateNames['fontColor'] = true;\r\n\t\t_renderStateNames['src'] = true;\r\n\t\t_renderStateNames['overflow'] = true;\r\n\t\t\r\n\t\t_renderStateNames['spaceX'] = true;\r\n\t\t_renderStateNames['spaceY'] = true;\r\n\t\t_renderStateNames['spaceZ'] = true;\r\n\t\t\r\n\t\t_renderStateNames['scaleX'] = true;\r\n\t\t_renderStateNames['scaleY'] = true;\r\n\t\t_renderStateNames['scaleZ'] = true;\r\n\t\t\r\n\t\t_renderStateNames['spaceWidth'] = true;\t//just for fillsprites\r\n\t\t_renderStateNames['spaceHeight'] = true;\t//just for fillsprites\r\n\t\t\r\n\t\t_renderStateNames['stage'] = true;\r\n\t\t_renderStateNames['view'] = true;\r\n\t\t_renderStateNames['camera'] = true;\r\n\t\t_renderStateNames['scene'] = true;\r\n\t\t_renderStateNames['space'] = true;\r\n\t\t\r\n\t\t_renderStateNames['active'] = true;\r\n\t}\r\n\t\r\n/*  ****************************FORM STATE UPDATE DEPRECATED*************************\r\n\tprivate function _initRenderFormStateNames():Void\r\n\t{\r\n\t\t_renderFormStateNames['SpriteUrl'] = true;\r\n\t\t_renderFormStateNames['ModelUrl'] = true;\r\n\t}\r\n*/\t\r\n\t\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\t//Log\r\n\t\tConsole.log(\"Init Display std Service...\");\r\n\t\t\r\n\t\t//Init Render StateNames\r\n\t\t_renderStateNames = new Map<String,Bool>();\r\n\t\t_initRenderStateNames();\r\n\t\t\r\n\t\t//Init Render Form StateNames\r\n\t\t_renderFormStateNames = new Map<String,Bool>();\r\n\t\t//_initRenderFormStateNames();\r\n\t\t\r\n\t\t//Active Reference Mediator\r\n\t\t_activeReferenceMediator = new ActiveReferenceMediator(this);\r\n\t\t\r\n\t\t//Renderer Set\r\n\t\tplatformRendererSet = new Map<String, IPlatformSpecificRenderer>();\r\n\t\t\r\n\t\t//Data Buffer\r\n\t\t_dataBuffer = new DataBuffer();\r\n\t}\r\n\t\r\n\t//@TODO: Quite a lot of public functions here, all dealing with the activeXReferences.. \r\n\t//Maybe create a mediator to handle all that, and lighten the Display Service a bit\r\n\t\r\n\t\r\n\tpublic function setActiveSpace(p_spaceEntity:IGameEntity):Bool\r\n\t{\r\n\t\t//weakcast the p_spaceEntity\r\n\t\tif (p_spaceEntity.getState('displayType') == \"Space\")\r\n\t\t{\r\n\t\t\t_dataBuffer.addEntry(SET_SPACE, p_spaceEntity);\r\n\t\t\t\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _setActiveSpace(p_spaceEntity:IGameEntity):Void\r\n\t{\r\n\t\tif (_activeReferenceMediator.getActiveSpaceReference(p_spaceEntity) != null)\r\n\t\t{\r\n\t\t\tConsole.warn(\"This space object is already bound to the Project. Ignoring...\");\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (projectActiveSpaceReference != null)\r\n\t\t\t{\r\n\t\t\t\t//@note if another space already exists, maybe you can warn better the user, or take\r\n\t\t\t\t\t//other action. may need rerendering, changing renderers, etc, etc, etc\r\n\t\t\t\tConsole.warn(\"Another space object was already set to this Project! Resetting...\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tprojectActiveSpaceReference = _activeReferenceMediator.createSpaceReference(p_spaceEntity);\r\n\t\t\t_activeReferenceMediator.spaceReferenceManager.update(projectActiveSpaceReference, p_spaceEntity);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function update():Void \r\n\t{\r\n\t\t//Buffer\r\n\t\tfor (f_bufferEntry in _dataBuffer.dataBuffer)\r\n\t\t{\r\n\t\t\t//Console.warn(\"DISPLAY UPDATE: Updating Type: [\" + f_bufferEntry.type + \"], Name: [\" +f_bufferEntry.source.getState('name') + \"], State [\" + f_bufferEntry.field+\"]\");\r\n\t\t\t\r\n\t\t\tswitch (f_bufferEntry.type)\r\n\t\t\t{\r\n\t\t\t\tcase SET_SPACE:\r\n\t\t\t\t\t_setActiveSpace(f_bufferEntry.source);\r\n\t\t\t\tcase ADDED:\r\n\t\t\t\t\tswitch (f_bufferEntry.source.getState('displayType'))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase \"Space\":\r\n\t\t\t\t\t\t\tConsole.warn(\"adding something to a space\");//...\r\n\t\t\t\t\t\tcase \"Stage\":\r\n\t\t\t\t\t\t\tConsole.warn(\"adding something to a stage\");//...\r\n\t\t\t\t\t\tcase \"StageArea\":\r\n\t\t\t\t\t\t\tConsole.warn(\"adding something to a stageArea\");//...\r\n\t\t\t\t\t\tcase \"View\":\r\n\t\t\t\t\t\t\tConsole.warn(\"adding something to a view\");//...\r\n\t\t\t\t\t\t\tfor (renderer in platformRendererSet)\r\n\t\t\t\t\t\t\t\tConsole.warn(\"adding something to a view, renderer logic\");//...\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tfor (renderer in platformRendererSet)\r\n\t\t\t\t\t\t\t\trenderer.addChild(f_bufferEntry.source, f_bufferEntry.target);\r\n\t\t\t\t\t}\r\n\t\t\t\tcase UPDATED_STATE:\r\n\t\t\t\t\tswitch (f_bufferEntry.source.getState('displayType'))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcase \"Space\":\r\n\t\t\t\t\t\t\t_activeReferenceMediator.spaceReferenceManager.updateState(_activeReferenceMediator.getActiveSpaceReference(f_bufferEntry.source), f_bufferEntry.source, f_bufferEntry.field);\r\n\t\t\t\t\t\tcase \"Stage\":\r\n\t\t\t\t\t\t\t_activeReferenceMediator.stageReferenceManager.updateState(_activeReferenceMediator.getActiveStageReference(f_bufferEntry.source), f_bufferEntry.source, f_bufferEntry.field);\r\n\t\t\t\t\t\tcase \"StageArea\":\r\n\t\t\t\t\t\t\t_activeReferenceMediator.stageAreaReferenceManager.updateState(_activeReferenceMediator.getActiveStageAreaReference(f_bufferEntry.source), f_bufferEntry.source, f_bufferEntry.field);\r\n\t\t\t\t\t\tcase \"View\":\r\n\t\t\t\t\t\t\t_activeReferenceMediator.viewReferenceManager.updateState(_activeReferenceMediator.getActiveViewReference(f_bufferEntry.source), f_bufferEntry.source, f_bufferEntry.field);\r\n\t\t\t\t\t\t\tfor (renderer in platformRendererSet)\r\n\t\t\t\t\t\t\t\trenderer.updateState(f_bufferEntry.source, f_bufferEntry.field);\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tfor (renderer in platformRendererSet)\r\n\t\t\t\t\t\t\t\trenderer.updateState(f_bufferEntry.source, f_bufferEntry.field);\r\n\t\t\t\t\t}\r\n\t\t\t\t/*  ****************************FORM STATE UPDATE DEPRECATED*************************\r\n\t\t\t\tcase UPDATED_FORM_STATE:\r\n\t\t\t\t\tfor (renderer in platformRendererSet)\r\n\t\t\t\t\t\trenderer.updateFormState(f_bufferEntry.source, f_bufferEntry.field);\r\n\t\t\t\t*/\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tConsole.warn(\"DISPLAY: Unhandled request: \" + f_bufferEntry.type);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Clear buffer\r\n\t\t_dataBuffer.clearBuffer();\r\n\t\t\r\n\t\t//Layout\r\n\t\t//@think: should this be before the buffer, or after the buffer? should this be here at all? prob, not..\r\n\t\t//put me in a buffer event, so i don't check for this every single FUCKING frame.. this is so WRONG\r\n\t\tif (projectActiveSpaceReference!=null)\r\n\t\t\tprojectActiveSpaceReference.activeStageReference.layoutManager.validate();\r\n\t\t\r\n\t\t\r\n\t\t//all renderers are up to date in this point, so...\r\n\t\t//after the Display.update, the platform.subgraphics system will request a render() for each view from their assigned renderer\r\n\t}\r\n\t\r\n\tinline public function addDisplayObjectChild(p_gameEntityParent:IGameEntity, p_gameEntityChild:IGameEntity):Void\r\n\t{\r\n\t\tif (p_gameEntityParent.getState('displayType')!=null && p_gameEntityChild.getState('displayType')!=null)\r\n\t\t\t_addChild(p_gameEntityParent, p_gameEntityChild);\r\n\t}\r\n\t\r\n\tinline public function updateDisplayObjectState(p_gameEntity:IGameEntity, p_state:String):Void\r\n\t{\r\n\t\tif (p_gameEntity.getState('displayType')!=null && _renderStateNames[p_state]==true)\r\n\t\t\t_updateState(p_gameEntity, p_state);\r\n\t}\r\n\t\r\n\tinline public function updateDisplayObjectFormState(p_gameEntity:IGameEntity, p_state:String):Void\r\n\t{\r\n\t\tif (p_gameEntity.getState('displayType')!=null && _renderFormStateNames[p_state]==true)\r\n\t\t\t_updateFormState(p_gameEntity, p_state);\r\n\t}\r\n\t\r\n\tinline private function _addChild(p_gameEntityParent:IGameEntity, p_gameEntityChild:IGameEntity):Void\r\n\t{\r\n\t\t_dataBuffer.addEntry(ADDED, p_gameEntityParent, p_gameEntityChild);\r\n\t}\r\n\t\r\n\tinline private function _updateState(p_gameEntity:IGameEntity, p_state:String):Void\r\n\t{\r\n\t\t_dataBuffer.addEntry(UPDATED_STATE, p_gameEntity, p_state);\r\n\t}\r\n\t\r\n\tinline private function _updateFormState(p_gameEntity:IGameEntity, p_state:String):Void\r\n\t{\r\n\t\t_dataBuffer.addEntry(UPDATED_FORM_STATE, p_gameEntity, p_state);\r\n\t}\r\n\t\r\n\t//@todo: The display service should DISPLAY the console messages ON SCREEN\r\n\t//platform independant..\r\n\t//merge mconsole's view with flambe's renderer to make this possible\r\n\t//probably in a separate view created by the Display service\r\n\t//for this purpose alone.\r\n\tpublic function log(message:String):Void \r\n\t{\r\n\t\tConsole.log(message);\r\n\t}\r\n\t\r\n\tpublic function info(message:String):Void \r\n\t{\r\n\t\tConsole.info(message);\r\n\t}\r\n\t\r\n\tpublic function debug(message:String):Void \r\n\t{\r\n\t\tConsole.debug(message);\r\n\t}\r\n\t\r\n\tpublic function warn(message:String):Void \r\n\t{\r\n\t\tConsole.warn(message);\r\n\t}\r\n\t\r\n\tpublic function error(message:String):Void \r\n\t{\r\n\t\tConsole.error(message);\r\n\t}\r\n\t\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.databuffer.core;\r\n\r\nimport tools.spark.sliced.services.std.display.databuffer.interfaces.EBufferEntryType;\r\nimport tools.spark.sliced.services.std.display.databuffer.interfaces.IBufferEntry;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass BufferEntry implements IBufferEntry\r\n{\r\n\tpublic var type( default, null ):EBufferEntryType;\r\n\tpublic var source( default, null ):IGameEntity;\r\n\tpublic var target( default, null ):IGameEntity;\r\n\tpublic var field( default, null ):String;\r\n\t\r\n\tpublic function new(p_type:EBufferEntryType, p_source:IGameEntity, ?p_target:IGameEntity, ?p_field:String) \r\n\t{\r\n\t\ttype = p_type;\r\n\t\tsource = p_source;\r\n\t\ttarget = p_target;\r\n\t\tfield = p_field;\r\n\t}\r\n\t\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.databuffer.core;\r\n\r\nimport tools.spark.sliced.services.std.display.databuffer.interfaces.EBufferEntryType;\r\nimport tools.spark.sliced.services.std.display.databuffer.interfaces.IBufferEntry;\r\nimport tools.spark.sliced.services.std.display.databuffer.interfaces.IDataBuffer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass DataBuffer implements IDataBuffer\r\n{\r\n\tpublic var dataBuffer( default, null ):Array<IBufferEntry>;\r\n\r\n\tpublic function new() \r\n\t{\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tinline private function _init():Void\r\n\t{\r\n\t\tdataBuffer = new Array<IBufferEntry>();\r\n\t}\r\n\t\r\n\tpublic function addEntry(p_type:EBufferEntryType, p_source:IGameEntity, ?p_target:IGameEntity, ?p_field:String):Void\r\n\t{\r\n\t\tdataBuffer.push(new BufferEntry(p_type, p_source, p_target, p_field));\r\n\t}\r\n\t\r\n\tpublic function clearBuffer():Void\r\n\t{\r\n\t\tdataBuffer = new Array<IBufferEntry>();\r\n\t}\r\n\t\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2014\r\n */\r\n\r\n package tools.spark.sliced.services.std.display.managers.core;\r\n\r\nimport tools.spark.sliced.interfaces.IDisplay;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveSpaceReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveStageAreaReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveStageReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveViewReference;\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IActiveReferenceMediator;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveSpaceReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveStageReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveViewReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveStageAreaReference;\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ActiveReferenceMediator implements IActiveReferenceMediator\r\n{\r\n\tpublic var display( default, null ):IDisplay;\r\n\tpublic var spaceReferenceManager( default, null ):IDisplayObjectManager;\r\n\tpublic var stageReferenceManager( default, null ):IDisplayObjectManager;\r\n\tpublic var viewReferenceManager( default, null ):IDisplayObjectManager;\r\n\tpublic var stageAreaReferenceManager( default, null ):IDisplayObjectManager;\r\n\t\r\n\tpublic function new(p_display:IDisplay) \r\n\t{\r\n\t\tdisplay = p_display;\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tinline private function _init():Void\r\n\t{\r\n\t\t//Display Entity Reference Managers\r\n\t\tspaceReferenceManager = new SpaceReferenceManager(this);\r\n\t\tstageReferenceManager = new StageReferenceManager(this);\r\n\t\tviewReferenceManager = new ViewReferenceManager(this);\r\n\t\tstageAreaReferenceManager = new StageAreaReferenceManager(this);\r\n\t}\r\n\t\r\n\tpublic function createSpaceReference(p_spaceEntity:IGameEntity):IActiveSpaceReference\r\n\t{\r\n\t\treturn cast(spaceReferenceManager.create(p_spaceEntity), ActiveSpaceReference);\r\n\t}\r\n\t\r\n\tpublic function createStageReference(p_stageEntity:IGameEntity):IActiveStageReference\r\n\t{\r\n\t\treturn cast(stageReferenceManager.create(p_stageEntity), ActiveStageReference);\r\n\t}\r\n\t\r\n\tpublic function createViewReference(p_viewEntity:IGameEntity):IActiveViewReference\r\n\t{\r\n\t\treturn cast(viewReferenceManager.create(p_viewEntity), ActiveViewReference);\r\n\t}\r\n\t\r\n\tpublic function createStageAreaReference(p_stageAreaEntity:IGameEntity):IActiveStageAreaReference\r\n\t{\r\n\t\treturn cast(stageAreaReferenceManager.create(p_stageAreaEntity), ActiveStageAreaReference);\r\n\t}\r\n\t\r\n\tpublic function getActiveSpaceReference(p_spaceEntity:IGameEntity):IActiveSpaceReference\r\n\t{\r\n\t\tif (display.projectActiveSpaceReference == null) return null;\r\n\t\t\r\n\t\tif (p_spaceEntity == display.projectActiveSpaceReference.spaceEntity)\r\n\t\t\treturn display.projectActiveSpaceReference;\r\n\t\telse\r\n\t\t\treturn null;\r\n\t}\r\n\t\r\n\tpublic function getActiveStageReference(p_stageEntity:IGameEntity):IActiveStageReference\r\n\t{\r\n\t\tif (display.projectActiveSpaceReference == null) return null;\r\n\t\telse if (display.projectActiveSpaceReference.activeStageReference == null) return null;\r\n\t\t\r\n\t\tif (p_stageEntity == display.projectActiveSpaceReference.activeStageReference.stageEntity)\r\n\t\t\treturn display.projectActiveSpaceReference.activeStageReference;\r\n\t\telse\r\n\t\t\treturn null;\r\n\t}\r\n\t\r\n\tpublic function getActiveViewReference(p_viewEntity:IGameEntity):IActiveViewReference\r\n\t{\r\n\t\tif (display.projectActiveSpaceReference == null) return null;\r\n\t\telse if (display.projectActiveSpaceReference.activeStageReference == null) return null;\r\n\t\t\r\n\t\tfor (f_activeViewReference in display.projectActiveSpaceReference.activeStageReference.activeViewReferences)\r\n\t\t{\r\n\t\t\tif (f_activeViewReference.viewEntity == p_viewEntity)\r\n\t\t\t\treturn f_activeViewReference;\r\n\t\t}\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tpublic function getActiveStageAreaReference(p_stageAreaEntity:IGameEntity):IActiveStageAreaReference\r\n\t{\r\n\t\tif (display.projectActiveSpaceReference == null) return null;\r\n\t\telse if (display.projectActiveSpaceReference.activeStageReference == null) return null;\r\n\t\t\r\n\t\tfor (f_activeStageAreaReference in display.projectActiveSpaceReference.activeStageReference.activeStageAreaReferences)\r\n\t\t{\r\n\t\t\tif (f_activeStageAreaReference.stageAreaEntity == p_stageAreaEntity)\r\n\t\t\t\treturn f_activeStageAreaReference;\r\n\t\t}\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.managers.core;\r\n\r\n\r\nimport tools.spark.framework.dom2_5D.DomCamera2_5D;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.ILibrarySpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\n\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass DomCameraManager implements IDisplayObjectManager\r\n{\r\n\tprivate var _renderer:ILibrarySpecificRenderer;\r\n\t\r\n\tpublic function new(p_renderer:ILibrarySpecificRenderer) \r\n\t{\r\n\t\t_renderer = p_renderer;\r\n\t}\r\n\t\r\n\t\r\n\tpublic function create(p_gameEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_camera2_5D:DomCamera2_5D = new DomCamera2_5D(p_gameEntity);\r\n\t\t\r\n\t\treturn l_camera2_5D;\r\n\t}\r\n\t\r\n\tpublic function destroy(p_object:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function update(p_object:Dynamic, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function updateState(p_object:Dynamic, p_gameEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function updateFormState(p_object:Dynamic, p_gameForm:IGameForm, p_state:String):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function addTo(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function removeFrom(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.managers.core;\r\n\r\nimport tools.spark.framework.dom2_5D.DomEntity2_5D;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.ILibrarySpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\n\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass DomObjectManager implements IDisplayObjectManager\r\n{\r\n\tprivate var _renderer:ILibrarySpecificRenderer;\r\n\t\r\n\tpublic function new(p_renderer:ILibrarySpecificRenderer) \r\n\t{\r\n\t\t_renderer = p_renderer;\r\n\t}\r\n\t\r\n\t\r\n\tpublic function create(p_gameEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_object2_5D:DomEntity2_5D = new DomEntity2_5D(p_gameEntity);\r\n\t\t\r\n\t\tupdate(l_object2_5D, p_gameEntity);\r\n\t\t\r\n\t\treturn l_object2_5D;\r\n\t}\r\n\t\r\n\tpublic function destroy(p_object:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function update(p_object:Dynamic, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//typecast\r\n\t\tvar l_entity2_5D:DomEntity2_5D = cast(p_object, DomEntity2_5D);\r\n\t\t\r\n\t\t//No need for this. space 2_5D entities get updated only when added to an active view\r\n\t\t//l_entity2_5D.update();\r\n\t\t\r\n\t\t//Update is usually responsible for two things.. update all entity states and form states, and update all children\r\n\t\t\r\n\t\t//Before doing this, shouldn't we remove all children from this entity?\r\n\t\t//l_entity2_5D.removeChildren(); ??\r\n\t\t\r\n\t\t//FOR EACH ENTITY CHILD INSIDE ENTITY\r\n\t\tfor (f_childEntity in p_gameEntity.children)\r\n\t\t{\r\n\t\t\taddTo(_renderer.createObject(f_childEntity), l_entity2_5D);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function updateState(p_object:Dynamic, p_gameEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t//typecast\r\n\t\tvar l_entity2_5D:DomEntity2_5D = cast(p_object, DomEntity2_5D);\r\n\t\t\r\n\t\tl_entity2_5D.updateState(p_state);\r\n\t}\r\n\t\r\n\tpublic function updateFormState(p_object:Dynamic, p_gameForm:IGameForm, p_state:String):Void \r\n\t{\r\n\t\t/*  ****************************FORM STATE UPDATE DEPRECATED*************************\r\n\t\t//typecast\r\n\t\tvar l_entity2_5D:FlambeEntity2_5D = cast(p_object, FlambeEntity2_5D);\r\n\t\t\r\n\t\tl_entity2_5D.updateFormState(p_state);\r\n\t\t*/\r\n\t}\r\n\t\r\n\tpublic function addTo(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//typecast\r\n\t\tvar l_entity2_5D:DomEntity2_5D = cast(p_objectParent, DomEntity2_5D);\r\n\t\t\r\n\t\t//objetChild may be null if it failed to be typecasted as a display object when being created\r\n\t\tif (p_objectChild!=null)\r\n\t\t\tl_entity2_5D.addChild(p_objectChild);\r\n\t}\r\n\t\r\n\tpublic function removeFrom(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.managers.core;\r\n\r\nimport tools.spark.framework.dom2_5D.DomScene2_5D;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.ILibrarySpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\n\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass DomSceneManager implements IDisplayObjectManager\r\n{\r\n\tprivate var _renderer:ILibrarySpecificRenderer;\r\n\t\r\n\tpublic function new(p_renderer:ILibrarySpecificRenderer) \r\n\t{\r\n\t\t_renderer = p_renderer;\r\n\t}\r\n\t\r\n\t\r\n\tpublic function create(p_gameEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_scene2_5D:DomScene2_5D = new DomScene2_5D(p_gameEntity);\r\n\t\t\r\n\t\tupdate(l_scene2_5D,p_gameEntity);\r\n\t\t\r\n\t\treturn l_scene2_5D;\r\n\t}\r\n\t\r\n\tpublic function destroy(p_object:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function update(p_object:Dynamic, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//typecast\r\n\t\tvar l_scene2_5D:DomScene2_5D = cast(p_object, DomScene2_5D);\r\n\t\t\r\n\t\t//Update is usually responsible for two things.. update all entity states and form states, and update all children\r\n\t\t\r\n\t\t//Before doing this, shouldn't we remove all children from this entity?\r\n\t\t//l_scene2_5D.removeChildren(); ??\r\n\t\t\r\n\t\t//FOR EACH ENTITY CHILD INSIDE SCENE\r\n\t\tfor (f_childEntity in p_gameEntity.children)\r\n\t\t{\r\n\t\t\taddTo(_renderer.createObject(f_childEntity), l_scene2_5D);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function updateState(p_object:Dynamic, p_gameEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function updateFormState(p_object:Dynamic, p_gameForm:IGameForm, p_state:String):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function addTo(p_objectChild:Dynamic, p_objectParent:Dynamic):Void \r\n\t{\r\n\t\t//typecast\r\n\t\tvar l_scene2_5D:DomScene2_5D = cast(p_objectParent, DomScene2_5D);\r\n\t\t\r\n\t\t//objetChild may be null if it failed to be typeasted as a display object when being created\r\n\t\tif (p_objectChild!=null)\r\n\t\t\tl_scene2_5D.addChild(p_objectChild);\r\n\t}\r\n\t\r\n\tpublic function removeFrom(p_objectChild:Dynamic, p_objectParent:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\n package tools.spark.sliced.services.std.display.managers.core;\r\n\r\nimport flambe.platform.InternalGraphics;\r\nimport tools.spark.framework.dom2_5D.DomView2_5D;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.ILibrarySpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\n\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass DomViewManager implements IDisplayObjectManager\r\n{\r\n\tprivate var _renderer:ILibrarySpecificRenderer;\r\n\t\r\n\tpublic function new(p_renderer:ILibrarySpecificRenderer) \r\n\t{\r\n\t\t_renderer = p_renderer;\r\n\t}\r\n\t\r\n\tpublic function create(p_gameEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_view2_5D:DomView2_5D = new DomView2_5D(p_gameEntity);\r\n\t\t\r\n\t\tupdate(l_view2_5D, p_gameEntity);\r\n\t\t\r\n\t\treturn l_view2_5D;\r\n\t}\r\n\t\r\n\tpublic function destroy(p_object:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function update(p_object:Dynamic, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tupdateState(p_object, p_gameEntity, 'scene');\r\n\t\tupdateState(p_object, p_gameEntity, 'camera');\r\n\t\tupdateState(p_object,p_gameEntity, 'visible');\r\n\t}\r\n\t\r\n\tpublic function updateState(p_object:Dynamic, p_gameEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t//typecast\r\n\t\tvar l_view2_5D:DomView2_5D = cast(p_object, DomView2_5D);\r\n\t\t\r\n\t\tswitch (p_state)\r\n\t\t{\r\n\t\t\tcase 'scene':\r\n\t\t\t\tvar l_sceneEntity:IGameEntity = p_gameEntity.getState(p_state);\r\n\t\t\t\t\r\n\t\t\t\tl_view2_5D.scene = _renderer.createScene(l_sceneEntity);\r\n\t\t\tcase 'camera':\r\n\t\t\t\tvar l_cameraEntity:IGameEntity = p_gameEntity.getState(p_state);\r\n\t\t\t\t\r\n\t\t\t\tl_view2_5D.camera = _renderer.createCamera(l_cameraEntity);\r\n\t\t\t\t\r\n\t\t\tcase 'visible':\r\n\t\t\t\tl_view2_5D.updateState(p_state);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function updateFormState(p_object:Dynamic, p_gameForm:IGameForm, p_state:String):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function addTo(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function removeFrom(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.managers.core;\r\n\r\n\r\nimport tools.spark.framework.flambe2_5D.FlambeCamera2_5D;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.ILibrarySpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\n\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Flambe2_5DCameraManager implements IDisplayObjectManager\r\n{\r\n\tprivate var _renderer:ILibrarySpecificRenderer;\r\n\t\r\n\tpublic function new(p_renderer:ILibrarySpecificRenderer) \r\n\t{\r\n\t\t_renderer = p_renderer;\r\n\t}\r\n\t\r\n\t\r\n\tpublic function create(p_gameEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_camera2_5D:FlambeCamera2_5D = new FlambeCamera2_5D(p_gameEntity);\r\n\t\t\r\n\t\treturn l_camera2_5D;\r\n\t}\r\n\t\r\n\tpublic function destroy(p_object:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function update(p_object:Dynamic, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function updateState(p_object:Dynamic, p_gameEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function updateFormState(p_object:Dynamic, p_gameForm:IGameForm, p_state:String):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function addTo(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function removeFrom(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.managers.core;\r\n\r\nimport tools.spark.framework.flambe2_5D.FlambeEntity2_5D;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.ILibrarySpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\n\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Flambe2_5DObjectManager implements IDisplayObjectManager\r\n{\r\n\tprivate var _renderer:ILibrarySpecificRenderer;\r\n\t\r\n\tpublic function new(p_renderer:ILibrarySpecificRenderer) \r\n\t{\r\n\t\t_renderer = p_renderer;\r\n\t}\r\n\t\r\n\t\r\n\tpublic function create(p_gameEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_object2_5D:FlambeEntity2_5D = new FlambeEntity2_5D(p_gameEntity);\r\n\t\t\r\n\t\tupdate(l_object2_5D, p_gameEntity);\r\n\t\t\r\n\t\treturn l_object2_5D;\r\n\t}\r\n\t\r\n\tpublic function destroy(p_object:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function update(p_object:Dynamic, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//typecast\r\n\t\tvar l_entity2_5D:FlambeEntity2_5D = cast(p_object, FlambeEntity2_5D);\r\n\t\t\r\n\t\t//No need for this. space 2_5D entities get updated only when added to an active view\r\n\t\t//l_entity2_5D.update();\r\n\t\t\r\n\t\t//Update is usually responsible for two things.. update all entity states and form states, and update all children\r\n\t\t\r\n\t\t//Before doing this, shouldn't we remove all children from this entity?\r\n\t\t//l_entity2_5D.removeChildren(); ??\r\n\t\t\r\n\t\t//FOR EACH ENTITY CHILD INSIDE ENTITY\r\n\t\tfor (f_childEntity in p_gameEntity.children)\r\n\t\t{\r\n\t\t\taddTo(_renderer.createObject(f_childEntity), l_entity2_5D);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function updateState(p_object:Dynamic, p_gameEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t//typecast\r\n\t\tvar l_entity2_5D:FlambeEntity2_5D = cast(p_object, FlambeEntity2_5D);\r\n\t\t\r\n\t\tl_entity2_5D.updateState(p_state);\r\n\t}\r\n\t\r\n\tpublic function updateFormState(p_object:Dynamic, p_gameForm:IGameForm, p_state:String):Void \r\n\t{\r\n\t\t/*  ****************************FORM STATE UPDATE DEPRECATED*************************\r\n\t\t//typecast\r\n\t\tvar l_entity2_5D:FlambeEntity2_5D = cast(p_object, FlambeEntity2_5D);\r\n\t\t\r\n\t\tl_entity2_5D.updateFormState(p_state);\r\n\t\t*/\r\n\t}\r\n\t\r\n\tpublic function addTo(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//typecast\r\n\t\tvar l_entity2_5D:FlambeEntity2_5D = cast(p_objectParent, FlambeEntity2_5D);\r\n\t\t\r\n\t\t//objetChild may be null if it failed to be typeasted as a display object when being created\r\n\t\tif (p_objectChild!=null)\r\n\t\t\tl_entity2_5D.addChild(p_objectChild);\r\n\t}\r\n\t\r\n\tpublic function removeFrom(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.managers.core;\r\n\r\nimport tools.spark.framework.flambe2_5D.FlambeScene2_5D;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.ILibrarySpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\n\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Flambe2_5DSceneManager implements IDisplayObjectManager\r\n{\r\n\tprivate var _renderer:ILibrarySpecificRenderer;\r\n\t\r\n\tpublic function new(p_renderer:ILibrarySpecificRenderer) \r\n\t{\r\n\t\t_renderer = p_renderer;\r\n\t}\r\n\t\r\n\t\r\n\tpublic function create(p_gameEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_scene2_5D:FlambeScene2_5D = new FlambeScene2_5D(p_gameEntity);\r\n\t\t\r\n\t\tupdate(l_scene2_5D,p_gameEntity);\r\n\t\t\r\n\t\treturn l_scene2_5D;\r\n\t}\r\n\t\r\n\tpublic function destroy(p_object:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function update(p_object:Dynamic, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//typecast\r\n\t\tvar l_scene2_5D:FlambeScene2_5D = cast(p_object, FlambeScene2_5D);\r\n\t\t\r\n\t\t//Update is usually responsible for two things.. update all entity states and form states, and update all children\r\n\t\t\r\n\t\t//Before doing this, shouldn't we remove all children from this entity?\r\n\t\t//l_scene2_5D.removeChildren(); ??\r\n\t\t\r\n\t\t//FOR EACH ENTITY CHILD INSIDE SCENE\r\n\t\tfor (f_childEntity in p_gameEntity.children)\r\n\t\t{\r\n\t\t\taddTo(_renderer.createObject(f_childEntity), l_scene2_5D);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function updateState(p_object:Dynamic, p_gameEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function updateFormState(p_object:Dynamic, p_gameForm:IGameForm, p_state:String):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function addTo(p_objectChild:Dynamic, p_objectParent:Dynamic):Void \r\n\t{\r\n\t\t//typecast\r\n\t\tvar l_scene2_5D:FlambeScene2_5D = cast(p_objectParent, FlambeScene2_5D);\r\n\t\t\r\n\t\t//objetChild may be null if it failed to be typeasted as a display object when being created\r\n\t\tif (p_objectChild!=null)\r\n\t\t\tl_scene2_5D.addChild(p_objectChild);\r\n\t}\r\n\t\r\n\tpublic function removeFrom(p_objectChild:Dynamic, p_objectParent:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2014\r\n */\r\n\r\n package tools.spark.sliced.services.std.display.managers.core;\r\n\r\nimport flambe.platform.InternalGraphics;\r\nimport tools.spark.framework.flambe2_5D.FlambeView2_5D;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.ILibrarySpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\n\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Flambe2_5DViewManager implements IDisplayObjectManager\r\n{\r\n\tprivate var _renderer:ILibrarySpecificRenderer;\r\n\tprivate var _flambeGraphics:InternalGraphics;\r\n\t\r\n\tpublic function new(p_renderer:ILibrarySpecificRenderer, p_flambeGraphics:InternalGraphics) \r\n\t{\r\n\t\t_renderer = p_renderer;\r\n\t\t\r\n\t\t_flambeGraphics = p_flambeGraphics;\r\n\t}\r\n\t\r\n\tpublic function create(p_gameEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_view2_5D:FlambeView2_5D = new FlambeView2_5D(p_gameEntity, _flambeGraphics);\r\n\t\t\r\n\t\tupdate(l_view2_5D, p_gameEntity);\r\n\t\t\r\n\t\treturn l_view2_5D;\r\n\t}\r\n\t\r\n\tpublic function destroy(p_object:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function update(p_object:Dynamic, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tupdateState(p_object, p_gameEntity, 'scene');\r\n\t\tupdateState(p_object,p_gameEntity,'camera');\r\n\t}\r\n\t\r\n\tpublic function updateState(p_object:Dynamic, p_gameEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t//typecast\r\n\t\tvar l_view2_5D:FlambeView2_5D = cast(p_object, FlambeView2_5D);\r\n\t\t\r\n\t\tswitch (p_state)\r\n\t\t{\r\n\t\t\tcase 'scene':\r\n\t\t\t\tvar l_sceneEntity:IGameEntity = p_gameEntity.getState(p_state);\r\n\t\t\t\t\r\n\t\t\t\tl_view2_5D.scene = _renderer.createScene(l_sceneEntity);\r\n\t\t\t\t//Console.log(\"Scene Name: \" + l_view2_5D.scene.name);\r\n\t\t\tcase 'camera':\r\n\t\t\t\tvar l_cameraEntity:IGameEntity = p_gameEntity.getState(p_state);\r\n\t\t\t\t\r\n\t\t\t\tl_view2_5D.camera = _renderer.createCamera(l_cameraEntity);\r\n\t\t\t\t//Console.log(\"Camera Name: \" + l_view2_5D.camera.name);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function updateFormState(p_object:Dynamic, p_gameForm:IGameForm, p_state:String):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function addTo(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function removeFrom(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.managers.core;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveSpaceReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveStageReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveSpaceReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveStageReference;\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IActiveReferenceMediator;\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.core.Sliced;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass SpaceReferenceManager implements IDisplayObjectManager\r\n{\t\r\n\tprivate var _activeReferenceMediator:IActiveReferenceMediator;\r\n\t\r\n\tpublic function new(p_activeReferenceMediator:IActiveReferenceMediator) \r\n\t{\r\n\t\t_activeReferenceMediator = p_activeReferenceMediator;\r\n\t}\r\n\t\r\n\tpublic function create(p_gameEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_spaceReference:IActiveSpaceReference = new ActiveSpaceReference(p_gameEntity);\r\n\t\t\r\n\t\treturn l_spaceReference;\r\n\t}\r\n\t\r\n\tpublic function destroy(p_object:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function update(p_object:Dynamic, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_object == null) return;\r\n\t\t\r\n\t\t//typecast?\r\n\t\t\r\n\t\tupdateState(p_object, p_gameEntity, 'stage');\r\n\t}\r\n\t\r\n\tpublic function updateState(p_object:Dynamic, p_gameEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_object == null) return;\r\n\t\t\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_spaceReference:IActiveSpaceReference = cast(p_object, ActiveSpaceReference);\r\n\t\t\r\n\t\tswitch (p_state)\r\n\t\t{\r\n\t\t\tcase 'stage':\r\n\t\t\t\tif (p_gameEntity.getState(p_state) != null)\r\n\t\t\t\t{\r\n\t\t\t\t\t_setStage(l_spaceReference,_activeReferenceMediator.createStageReference(p_gameEntity.getState(p_state)),p_gameEntity.getState(p_state));\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _setStage(p_spaceReference:IActiveSpaceReference, p_stageReference:IActiveStageReference, p_stageEntity:IGameEntity):Void\r\n\t{\r\n\t\tif (_activeReferenceMediator.getActiveStageReference(p_stageEntity) != null)\r\n\t\t{\r\n\t\t\tConsole.warn(\"This stage object [\" + p_stageEntity.getState('name') + \"] is already bound to the Active Space. Ignoring...\");\r\n\t\t\t//in this case, the newly created stageReference pointer won't be held anywhere and the stageReference object will be garbage collected :/\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (_activeReferenceMediator.display.projectActiveSpaceReference.activeStageReference != null)\r\n\t\t\t{\r\n\t\t\t\t//@note if another stage already exists, maybe you can warn better the user, or take\r\n\t\t\t\t\t//other action. may need rerendering, changing renderers, etc, etc, etc\r\n\t\t\t\tConsole.warn(\"Another stage object was already set to this Project! Resetting...\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tp_spaceReference.activeStageReference = p_stageReference;\r\n\t\t\t_activeReferenceMediator.stageReferenceManager.update(p_stageReference, p_stageEntity);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function updateFormState(p_object:Dynamic, p_gameForm:IGameForm, p_state:String):Void \r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_object == null) return;\r\n\t\t\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function addTo(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_objectParent == null) return;\r\n\t\t\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function removeFrom(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_objectParent == null) return;\r\n\t\t\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2014\r\n */\r\n\r\n package tools.spark.sliced.services.std.display.managers.core;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveStageAreaReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveStageAreaReference;\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IActiveReferenceMediator;\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass StageAreaReferenceManager implements IDisplayObjectManager\r\n{\t\r\n\tprivate var _activeReferenceMediator:IActiveReferenceMediator;\r\n\t\r\n\tpublic function new(p_activeReferenceMediator:IActiveReferenceMediator) \r\n\t{\r\n\t\t_activeReferenceMediator = p_activeReferenceMediator;\r\n\t}\r\n\t\r\n\tpublic function create(p_gameEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_stageAreaReference:IActiveStageAreaReference = new ActiveStageAreaReference(p_gameEntity);\r\n\t\t\r\n\t\treturn l_stageAreaReference;\r\n\t}\r\n\t\r\n\tpublic function destroy(p_object:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function update(p_object:Dynamic, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_object == null) return;\r\n\t\t\r\n\t\t//typecast\r\n\t\tvar l_stageAreaReference:IActiveStageAreaReference = cast(p_object, IActiveStageAreaReference);\r\n\t\t\r\n\t\t//Update my layoutObject\r\n\t\tl_stageAreaReference.layoutElement.update();\r\n\t}\r\n\t\r\n\tpublic function updateState(p_object:Dynamic, p_gameEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_object == null) return;\r\n\t\t\r\n\t\t//typecast\r\n\t\tvar l_stageAreaReference:IActiveStageAreaReference = cast(p_object, IActiveStageAreaReference);\r\n\t\t\r\n\t\tl_stageAreaReference.layoutElement.updateState(p_state);\r\n\t}\r\n\t\r\n\tpublic function addTo(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_objectParent == null) return;\r\n\t\t\r\n\t\t//StageArea doesn't have children..\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function removeFrom(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_objectParent == null) return;\r\n\t\t\r\n\t\t//StageArea doesn't have children..\r\n\t\t\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2014\r\n */\r\n\r\n package tools.spark.sliced.services.std.display.managers.core;\r\nimport tools.spark.framework.layout.containers.Group;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveStageReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveStageAreaReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveStageReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveViewReference;\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IActiveReferenceMediator;\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\nimport tools.spark.sliced.services.std.logic.gde.core.GameEntity;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass StageReferenceManager implements IDisplayObjectManager\r\n{\t\r\n\tprivate var _activeReferenceMediator:IActiveReferenceMediator;\r\n\t\r\n\tpublic function new(p_activeReferenceMediator:IActiveReferenceMediator) \r\n\t{\r\n\t\t_activeReferenceMediator = p_activeReferenceMediator;\r\n\t}\r\n\t\r\n\tpublic function create(p_gameEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_stageReference:IActiveStageReference = new ActiveStageReference(p_gameEntity);\r\n\t\t\r\n\t\treturn l_stageReference;\r\n\t}\r\n\t\r\n\tpublic function destroy(p_object:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function update(p_object:Dynamic, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_object == null) return;\r\n\t\t\r\n\t\t//typecast\r\n\t\tvar l_stageReference:IActiveStageReference = cast(p_object, IActiveStageReference);\r\n\t\t\r\n\t\tupdateState(l_stageReference, p_gameEntity, 'test');\r\n\t\tupdateState(l_stageReference, p_gameEntity, 'width');\r\n\t\tupdateState(l_stageReference, p_gameEntity, 'height');\r\n\t\t\r\n\t\t//Update my layoutObject\r\n\t\tl_stageReference.layoutRoot.update();\r\n\t\t\r\n\t\t//this.. yeah....hmm\r\n\t\tl_stageReference.layoutRoot.explicitWidth = flambe.System.stage.width;\r\n\t\tl_stageReference.layoutRoot.explicitHeight = flambe.System.stage.height;\r\n\t\t\r\n\t\t//FOR ALL CHILDREN\r\n\t\t//@FIX ME VERY VERY SOON!: OMG, if I keep updating the Stage it will keep adding the same views and stageAreas!! REMOVE THEM FIRST!!!!!!!! or smth..\r\n\t\tfor (f_stageChildEntity in p_gameEntity.getChildren())\r\n\t\t{\r\n\t\t\taddTo(f_stageChildEntity,l_stageReference);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function updateState(p_object:Dynamic, p_gameEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_object == null) return;\r\n\t\t\r\n\t\t//typecast?\r\n\t\tvar l_activeStageReference:IActiveStageReference = cast(p_object, IActiveStageReference);\r\n\t\t\r\n\t\tswitch (p_state)\r\n\t\t{\r\n\t\t\t//case 'test':\r\n\t\t\t\t//_createStageLayOutThing(l_activeStageReference, p_gameEntity);\r\n\t\t\tcase 'width':\r\n\t\t\t\t//_createStageLayOutThing(l_activeStageReference, p_gameEntity);\r\n\t\t\tcase 'height':\r\n\t\t\t\t//_createStageLayOutThing(l_activeStageReference, p_gameEntity);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t/*\r\n\tprivate function _createStageLayOutThing(p_activeStageReference:IActiveStageReference, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//i guess we create our thing on the activeStageRegerence eyh? where else..\r\n\t\t\r\n\t\tvar fullStage:Group = new Group();\r\n\t\t\r\n\t\t//give skata real stage width and stuff..\r\n\t\tfullStage.explicitWidth = flambe.System.stage.width;\r\n\t\tfullStage.explicitHeight = flambe.System.stage.height;\r\n\t\t\r\n\t\t//add substages and stuff\r\n\t\t//..\r\n\t\t\r\n\t\t//add test children\r\n\t\tvar childOne:Group = new Group();\r\n\t\tchildOne.horizontalCenter = 0;\r\n\t\t\r\n\t\tvar childOneInChildOne:Group = new Group();\r\n\t\t\r\n\t\tchildOneInChildOne.explicitWidth = 50;\r\n\t\tchildOneInChildOne.explicitHeight = 50;\r\n\t\tchildOneInChildOne.left = 200;\r\n\t\tchildOneInChildOne.top = 200;\r\n\t\t\r\n\t\tchildOne.children.push(childOneInChildOne);\r\n\t\t\r\n\t\t\r\n\t\tfullStage.children.push(childOne);\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t//So now if we measure everything, ChildOne's width and height were not explicit (like everything else)\r\n\t\t//so they should be measured as 250,250\r\n\t\t_layoutManagerMeasure(fullStage);\r\n\t\t\r\n\t\t//let's try this shit...\r\n\t\tConsole.error('====================================================');\r\n\t\tConsole.error(\"Full Stage Preferred Width: \" + fullStage.preferredWidth);\r\n\t\tConsole.error(\"Full Stage Preferred Height: \" + fullStage.preferredHeight);\r\n\t\tConsole.error(\"Child One Preferred Width: \" + childOne.preferredWidth);\r\n\t\tConsole.error(\"Child One Preferred Height: \" + childOne.preferredHeight);\r\n\t\tConsole.error(\"childOneInChildOne Preferred Width: \" + childOneInChildOne.preferredWidth);\r\n\t\tConsole.error(\"childOneInChildOne Preferred Height: \" + childOneInChildOne.preferredHeight);\r\n\t\tConsole.error('====================================================');\r\n\t\t\r\n\t\t//fuck yeah..\r\n\t\t\r\n\t\t//now layout manager actually positions layouts..\r\n\t\t_layoutManagerUpdateDisplayList(fullStage);\r\n\t\t\r\n\t\t\r\n\t\t//when it doesnt crash, trace some x,y,width,height of our groups\r\n\t\t//on init they are 0 but updatedisplaylist updates them all\r\n\t\tConsole.error('----------------full stage----------------');\r\n\t\tConsole.error(\"Full Stage REAL x: \" + fullStage.x);\r\n\t\tConsole.error(\"Full Stage REAL y: \" + fullStage.y);\r\n\t\tConsole.error(\"Full Stage REAL Width: \" + fullStage.width);\r\n\t\tConsole.error(\"Full Stage REAL Height: \" + fullStage.height);\r\n\t\tConsole.error('----------------Child One----------------');\r\n\t\tConsole.error(\"Child One REAL x: \" + childOne.x);\r\n\t\tConsole.error(\"Child One REAL y: \" + childOne.y);\r\n\t\tConsole.error(\"Child One REAL Width: \" + childOne.width);\r\n\t\tConsole.error(\"Child One REAL Height: \" + childOne.height);\r\n\t\tConsole.error('----------------childOneInChildOne----------------');\r\n\t\tConsole.error(\"childOneInChildOne REAL x: \" + childOneInChildOne.x);\r\n\t\tConsole.error(\"childOneInChildOne REAL y: \" + childOneInChildOne.y);\r\n\t\tConsole.error(\"childOneInChildOne REAL Width: \" + childOneInChildOne.width);\r\n\t\tConsole.error(\"childOneInChildOne REAL Height: \" + childOneInChildOne.height);\r\n\t\tConsole.error('-------------------------------------------------');\r\n\t}*/\r\n\t\r\n\t\r\n\tpublic function addTo(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_objectParent == null) return;\r\n\t\t\r\n\t\t//typecast?\r\n\r\n\t\tvar l_stageReference:IActiveStageReference = cast(p_objectParent, ActiveStageReference);\r\n\t\tvar l_stageChildEntity:IGameEntity = cast(p_objectChild, GameEntity);\r\n\t\t\r\n\t\tif (l_stageChildEntity.getState('displayType') == \"View\") //weak typecasting\r\n\t\t\t_addView(l_stageReference, _activeReferenceMediator.createViewReference(l_stageChildEntity), l_stageChildEntity);\r\n\t\telse if (l_stageChildEntity.getState('displayType') == \"StageArea\") //weak typecasting\r\n\t\t\t_addStageArea(l_stageReference,_activeReferenceMediator.createStageAreaReference(l_stageChildEntity),l_stageChildEntity);\r\n\t\telse\r\n\t\t\tConsole.warn(\"A child of a Stage gameEntity is NOT a View or a StageArea! Ignoring...\");\r\n\t}\r\n\t\r\n\tpublic function removeFrom(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_objectParent == null) return;\r\n\t\t\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tprivate function _addView(p_stageReference:IActiveStageReference, p_viewReference:IActiveViewReference, p_viewEntity:IGameEntity):Void\r\n\t{\r\n\t\t//somewhere around here, you should make sure if the view being added previously belonged somewhere else, it should get removed from that place\r\n\t\t\r\n\t\tif (_activeReferenceMediator.getActiveViewReference(p_viewEntity) != null)\r\n\t\t{\r\n\t\t\tConsole.warn(\"This view object [\" + p_viewEntity.getState('name') + \"] is already bound to the Active Stage. Ignoring...\");\r\n\t\t\t//in this case, the newly created viewReference pointer won't be held anywhere and the viewRererence object will be garbage collected :/\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (p_viewEntity.getState('scene') == null || p_viewEntity.getState('camera') == null)\r\n\t\t\t{\r\n\t\t\t\t//weakly typecast scene and camera?\r\n\t\t\t\t\r\n\t\t\t\tConsole.warn(\"This view object [\" + p_viewEntity.getState('name') + \"] is not ready yet (missing camera or scene). Ignoring...\");\r\n\t\t\t\t//in this case, the newly created viewReference pointer won't be held anywhere and the viewRererence object will be garbage collected :/\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tp_stageReference.addView(p_viewReference);\r\n\t\t\t\t_activeReferenceMediator.viewReferenceManager.update(p_viewReference, p_viewEntity);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _addStageArea(p_stageReference:IActiveStageReference, p_stageAreaReference:IActiveStageAreaReference, p_stageAreaEntity:IGameEntity):Void\r\n\t{\r\n\t\t//somewhere around here, you should make sure if the stageArea being added previously belonged somewhere else, it should get removed from that place\r\n\t\t\r\n\t\tif (_activeReferenceMediator.getActiveStageAreaReference(p_stageAreaEntity) != null)\r\n\t\t{\r\n\t\t\tConsole.warn(\"This stageArea object [\" + p_stageAreaEntity.getState('name') + \"] is already bound to the Active Stage. Ignoring...\");\r\n\t\t\t//in this case, the newly created stageAreaReference pointer won't be held anywhere and the stageAreaReference object will be garbage collected :/\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tp_stageReference.addStageArea(p_stageAreaReference);\r\n\t\t\t_activeReferenceMediator.stageAreaReferenceManager.update(p_stageAreaReference, p_stageAreaEntity);\r\n\t\t}\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, October 2014\r\n */\r\n\r\n package tools.spark.sliced.services.std.display.managers.core;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.core.ActiveViewReference;\r\nimport tools.spark.sliced.services.std.display.active_displayentity_references.interfaces.IActiveViewReference;\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IActiveReferenceMediator;\r\nimport tools.spark.sliced.services.std.display.managers.interfaces.IDisplayObjectManager;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ViewReferenceManager implements IDisplayObjectManager\r\n{\t\r\n\tprivate var _activeReferenceMediator:IActiveReferenceMediator;\r\n\t\r\n\tpublic function new(p_activeReferenceMediator:IActiveReferenceMediator) \r\n\t{\r\n\t\t_activeReferenceMediator = p_activeReferenceMediator;\r\n\t}\r\n\t\r\n\tpublic function create(p_gameEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t\tvar l_viewReference:IActiveViewReference = new ActiveViewReference(p_gameEntity);\r\n\t\t\r\n\t\treturn l_viewReference;\r\n\t}\r\n\t\r\n\tpublic function destroy(p_object:Dynamic):Void \r\n\t{\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function update(p_object:Dynamic, p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_object == null) return;\r\n\t\t\r\n\t\t//typecast\r\n\t\tvar l_viewReference:IActiveViewReference = cast(p_object, IActiveViewReference);\r\n\t\t\r\n\t\tupdateState(l_viewReference, p_gameEntity, 'scene');\r\n\t\tupdateState(l_viewReference, p_gameEntity, 'camera');\r\n\t\t\r\n\t\t//Update my layoutObject\r\n\t\tl_viewReference.layoutElement.update();\r\n\t\t\r\n\t\t_updateRenderer(l_viewReference);\r\n\t}\r\n\t\r\n\tpublic function updateState(p_object:Dynamic, p_gameEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_object == null) return;\r\n\t\t\r\n\t\t//typecast?\r\n\t\t\r\n\t\tswitch (p_state)\r\n\t\t{\r\n\t\t\t//@TODO: Here, do the following.. if you set its scene or camera to null or something, the View immediately becomes invalid and needs to be removed\r\n\t\t\t//from the active Stage. Then think how to make it valid again since now it's removed and won't listen to UpdateState anymore... hmmmm HEY! what if it's not active\r\n\t\t\t//at the beginning and we need to activate it later then? SHIT....hmmmmm\r\n\t\t\t//maybe still add it to the active stage but set it as inactive so the renderers know to ignore the request from the Graphics Platform\r\n\t\t\tcase 'scene':\r\n\t\t\t\t//Update again, in case renderer needs to be modified, with the new 'scene' value\r\n\t\t\t\t_updateRenderer(cast(p_object, ActiveViewReference));\r\n\t\t\tcase 'camera':\r\n\t\t\t\t//Update again, in case renderer needs to be modified, with the new 'camera' value\r\n\t\t\t\t_updateRenderer(cast(p_object, ActiveViewReference));\r\n\t\t}\r\n\t}\r\n\t\r\n\t//@TODO: After the updates, a view becomes invalidated, in which case it needs to be REMOVED from a renderer instead...and stuff like that...\r\n\t//SO, although in order to be ADDED, camera and scene are set, you should ALWAYS check again for them both to be valid here and act accordingly\r\n\tprivate function _updateRenderer(p_viewReference:IActiveViewReference):Void\r\n\t{\r\n\t\t//@FIXME: Do tests like these again, and act accordingly...\r\n\t\t//if (p_viewEntity.getState('scene') == null || p_viewEntity.getState('camera') == null)....\r\n\t\t\r\n\t\t//Add to Renderer, if you haven't already\r\n\t\tif (p_viewReference.renderer == null)\r\n\t\t{\r\n\t\t\t//@FIX NOW: Only explicit renderer selection has been implemented.. work on the auto one later\r\n\t\t\tif (p_viewReference.viewEntity.getState('renderer') != \"Implicit\")\r\n\t\t\t{\r\n\t\t\t\tp_viewReference.renderer = _activeReferenceMediator.display.platformRendererSet[p_viewReference.viewEntity.getState('renderer')];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tConsole.error(\"Implicit Renderer selection has not been implemented yet. View \" + p_viewReference.viewEntity.getState('name') + \" cannot be rendered!\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (p_viewReference.renderer != null)\r\n\t\t\t{\r\n\t\t\t\t//This is huge... starting to talk to renderers here!! right place to do that??? Sure why not...\r\n\t\t\t\tp_viewReference.renderer.createView(p_viewReference.viewEntity);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tConsole.error(\"Could not create renderer: \" + p_viewReference.viewEntity.getState('renderer') + \".\");\r\n\t\t\t}\r\n\t\t}\r\n\t\t//else\r\n\t\t//{\r\n\t\t//\tConsole.warn(\"This view object [\" + p_viewReference.viewEntity.getState('name') + \"] already has a renderer assigned. So whatever changes you made to it, didn't make it assign to a new one or whatever, it just ignored it.\");\r\n\t\t//}\r\n\t}\r\n\t\r\n\t\t\r\n\tpublic function updateFormState(p_object:Dynamic, p_gameForm:IGameForm, p_state:String):Void \r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_object == null) return;\r\n\t\t\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function addTo(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_objectParent == null) return;\r\n\t\t\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function removeFrom(p_objectChild:Dynamic, p_objectParent:Dynamic):Void\r\n\t{\r\n\t\t//Check if this gameEntity was Active\r\n\t\tif (p_objectParent == null) return;\r\n\t\t\r\n\t\t//typecast?\r\n\t\t\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2013\r\n */\r\n\r\n package tools.spark.sliced.services.std.display.renderers.core;\r\n\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.IRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ARenderer implements IRenderer\r\n{\r\n\tprivate function new() \r\n\t{\r\n\t\t_aRendererInit();\r\n\t}\r\n\r\n\tinline private function _aRendererInit():Void\r\n\t{\r\n\t\t\r\n\t}\r\n}","/* Copyrtools.spark.sliced.services.std.display.renderers.core.dimensionized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, December 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.renderers.core.dimension;\r\n\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.IDimensionSpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n//import tools.spark.framework.pseudo3d.core.PseudoEntity;\r\n//import tools.spark.framework.pseudo3d.core.PseudoScene;\r\n//import tools.spark.framework.pseudo3d.interfaces.IPseudoCamera;\r\n//import tools.spark.framework.pseudo3d.interfaces.IPseudoEntity;\r\n//import tools.spark.framework.pseudo3d.interfaces.IPseudoScene;\r\n//import tools.spark.framework.pseudo3d.interfaces.IPseudoView;\r\n//import tools.spark.framework.pseudo3d.core.PseudoCamera;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass A2_5DRenderer extends ARenderer implements IDimensionSpecificRenderer\r\n{\r\n\r\n\t\r\n\tprivate function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\r\n\t\t_a2DRendererInit();\r\n\t}\r\n\t\r\n\t\r\n\tinline private function _a2DRendererInit():Void\r\n\t{\r\n\r\n\t}\t\r\n\t\r\n\t\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.renderers.core.library;\r\n\r\nimport flambe.platform.InternalGraphics;\r\nimport flambe.platform.Platform;\r\nimport tools.spark.framework.flambe2_5D.FlambeScene2_5D;\r\nimport tools.spark.framework.flambe2_5D.FlambeView2_5D;\r\nimport tools.spark.framework.flambe2_5D.FlambeCamera2_5D;\r\nimport tools.spark.framework.space2_5D.core.AObjectContainer2_5D;\r\nimport tools.spark.sliced.services.std.display.managers.core.Flambe2_5DCameraManager;\r\nimport tools.spark.sliced.services.std.display.managers.core.Flambe2_5DObjectManager;\r\nimport tools.spark.sliced.services.std.display.managers.core.Flambe2_5DSceneManager;\r\nimport tools.spark.sliced.services.std.display.managers.core.Flambe2_5DViewManager;\r\nimport tools.spark.sliced.services.std.display.renderers.core.dimension.A2_5DRenderer;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.ILibrarySpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n\r\n/**\r\n * This abstraction level of the Renderer will always act as a mediator between its managers\r\n * @author Aris Kostakos\r\n */\r\nclass AFlambe2_5DRenderer extends A2_5DRenderer implements ILibrarySpecificRenderer\r\n{\r\n\tprivate var _views:Map<IGameEntity,FlambeView2_5D>;\r\n\tprivate var _scenes:Map<IGameEntity,FlambeScene2_5D>;\r\n\tprivate var _cameras:Map<IGameEntity,FlambeCamera2_5D>;\r\n\tprivate var _objects:Map<IGameEntity,AObjectContainer2_5D>;\r\n\t\r\n\tprivate var _viewManager:Flambe2_5DViewManager;\r\n\tprivate var _sceneManager:Flambe2_5DSceneManager;\r\n\tprivate var _cameraManager:Flambe2_5DCameraManager;\r\n\tprivate var _objectManager:Flambe2_5DObjectManager;\r\n\t\r\n\tprivate var _platform:Platform;\r\n\tprivate var _internalGraphics:InternalGraphics;\r\n\t\r\n\tprivate function new()\r\n\t{\r\n\t\t//Abstract class, private constructor\r\n\t\tsuper();\r\n\r\n\t\t_aFlambe2_5dRendererInit();\r\n\t}\r\n\r\n\tinline private function _aFlambe2_5dRendererInit():Void\r\n\t{\r\n        _internalGraphics = _platform.getRenderer().graphics;\r\n\t\t\r\n\t\tif (_internalGraphics == null)\r\n\t\t{\r\n\t\t\tConsole.error(\"Flambe renderer does NOT have internal graphics!\");\r\n\t\t}\r\n\t\t\r\n\t\t//@THINK: keep this? or just one map to rule them all??\r\n\t\t_views = new Map<IGameEntity,FlambeView2_5D>();\r\n\t\t_scenes = new Map<IGameEntity,FlambeScene2_5D>();\r\n\t\t_cameras = new Map<IGameEntity,FlambeCamera2_5D>();\r\n\t\t_objects = new Map<IGameEntity,AObjectContainer2_5D>();\r\n\t\t\r\n\t\t_viewManager = new Flambe2_5DViewManager(this,_internalGraphics);\r\n\t\t_sceneManager = new Flambe2_5DSceneManager(this);\r\n\t\t_cameraManager = new Flambe2_5DCameraManager(this);\r\n\t\t_objectManager = new Flambe2_5DObjectManager(this);\r\n\t}\r\n\t\r\n\tpublic function renderView ( p_viewEntity:IGameEntity):Void\r\n\t{\r\n\t\t//Console.warn(\"AFlambe2_5DRenderer rendering View: \" + p_viewEntity.getState('name'));\r\n\t\t\r\n\t\t//render a view\r\n\t\t_views[p_viewEntity].render();\r\n\t}\r\n\t\r\n\r\n\tpublic function createView ( p_viewEntity:IGameEntity):Dynamic\r\n\t{\r\n\t\tif (_views[p_viewEntity] != null)\r\n\t\t\tConsole.warn(\"View \" + p_viewEntity.getState('name') + \" has already been added to this Flambe2_5DRenderer. Ignoring...\");\r\n\t\telse\r\n\t\t\t_views[p_viewEntity] = cast(_viewManager.create(p_viewEntity),FlambeView2_5D);\r\n\t\t\r\n\t\treturn _views[p_viewEntity];\r\n\t}\r\n\t\r\n\tpublic function createScene ( p_sceneEntity:IGameEntity):Dynamic\r\n\t{\r\n\t\tif (_scenes[p_sceneEntity] != null)\r\n\t\t\tConsole.warn(\"Scene \" + p_sceneEntity.getState('name') + \" has already been added to this Flambe2_5DRenderer. Ignoring...\");\r\n\t\telse\r\n\t\t\t_scenes[p_sceneEntity] = cast(_sceneManager.create(p_sceneEntity),FlambeScene2_5D);\r\n\t\t\r\n\t\treturn _scenes[p_sceneEntity];\r\n\t}\r\n\t\r\n\tpublic function createCamera ( p_cameraEntity:IGameEntity):Dynamic\r\n\t{\r\n\t\tif (_cameras[p_cameraEntity] != null)\r\n\t\t\tConsole.warn(\"Camera \" + p_cameraEntity.getState('name') + \" has already been added to this Flambe2_5DRenderer. Ignoring...\");\r\n\t\telse\r\n\t\t\t_cameras[p_cameraEntity] = cast(_cameraManager.create(p_cameraEntity),FlambeCamera2_5D);\r\n\r\n\t\treturn _cameras[p_cameraEntity];\r\n\t}\r\n\t\r\n\tpublic function createObject ( p_objectEntity:IGameEntity):Dynamic\r\n\t{\r\n\t\tif (p_objectEntity.getState('displayType')==\"Entity\")\r\n\t\t{\r\n\t\t\tif (_objects[p_objectEntity] != null)\r\n\t\t\t\tConsole.warn(\"Object \" + p_objectEntity.getState('name') + \" has already been added to this Flambe2_5DRenderer. Ignoring...\");\r\n\t\t\telse\r\n\t\t\t\t_objects[p_objectEntity] = cast(_objectManager.create(p_objectEntity),AObjectContainer2_5D);\r\n\t\t\t\r\n\t\t\treturn _objects[p_objectEntity];\r\n\t\t}\r\n\t\telse return null;\r\n\t}\r\n\t\r\n\tinline public function addChild ( p_parentEntity:IGameEntity, p_childEntity:IGameEntity):Void\r\n\t{\r\n\t\t//check the parent display type here.. For the childEntity, I'm ASSUMING it's an entity/object.. is that right??\r\n\t\tswitch (p_parentEntity.getState('displayType'))\r\n\t\t{\r\n\t\t\tcase \"Scene\":\r\n\t\t\t\tif (_scenes[p_parentEntity] != null)\r\n\t\t\t\t\t_sceneManager.addTo(createObject(p_childEntity), _scenes[p_parentEntity]);\r\n\t\t\tcase \"Entity\":\r\n\t\t\t\tif (_objects[p_parentEntity] != null)\r\n\t\t\t\t\t_objectManager.addTo(createObject(p_childEntity), _objects[p_parentEntity]);\r\n\t\t\tdefault:\r\n\t\t\t\tConsole.warn(\"AFlambe2_5DRenderer: Unhandled add child request: \" + p_parentEntity.getState('displayType'));\r\n\t\t}\r\n\t}\r\n\t\r\n\tinline public function updateState ( p_objectEntity:IGameEntity, p_state:String):Void\r\n\t{\r\n\t\t//maybe check its display type here..\r\n\t\t\r\n\t\t//is it object, do this:\r\n\t\tif (_objects[p_objectEntity] != null)\r\n\t\t{\r\n\t\t\t_objectManager.updateState(_objects[p_objectEntity], p_objectEntity, p_state);\r\n\t\t}\r\n\t\t\r\n\t\t//else, is it view, do this...  etc\r\n\t}\r\n\t\r\n\tinline public function updateFormState ( p_objectEntity:IGameEntity, p_state:String):Void\r\n\t{\r\n\t\t//maybe check its display type here..\r\n\t\t\r\n\t\t//is it object, do this:\r\n\t\tif (_objects[p_objectEntity] != null)\r\n\t\t{\r\n\t\t\t_objectManager.updateFormState(_objects[p_objectEntity], p_objectEntity.gameForm, p_state);\r\n\t\t}\r\n\t\t\r\n\t\t//else, is it view, do this...  etc\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\npackage tools.spark.sliced.services.std.display.renderers.core.library;\r\n\r\nimport tools.spark.sliced.services.std.display.renderers.core.dimension.A2_5DRenderer;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.ILibrarySpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass ANativeControls2_5DRenderer extends A2_5DRenderer implements ILibrarySpecificRenderer\r\n{\r\n\r\n\tprivate function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function renderView(p_viewEntity:IGameEntity):Void \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function createView(p_viewEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tpublic function createScene(p_sceneEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tpublic function createCamera(p_cameraEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tpublic function createObject(p_objectEntity:IGameEntity):Dynamic \r\n\t{\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tpublic function addChild(p_parentEntity:IGameEntity, p_childEntity:IGameEntity):Void \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function updateState(p_objectEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function updateFormState(p_objectEntity:IGameEntity, p_state:String):Void \r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, November 2013\r\n */\r\n\r\n package tools.spark.sliced.services.std.display.renderers.core.platform.html;\r\n\r\n\r\nimport tools.spark.sliced.services.std.display.renderers.core.library.AFlambe2_5DRenderer;\r\nimport flambe.platform.html.HtmlPlatform;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.IPlatformSpecificRenderer;\r\n\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n * \r\n */\r\nclass Flambe2_5DHtmlRenderer extends AFlambe2_5DRenderer implements IPlatformSpecificRenderer\r\n{\r\n\tpublic function new() \r\n\t{\r\n\t\t_platform = HtmlPlatform.instance;\r\n\t\t\r\n\t\tsuper();\r\n\t\t\r\n\t\t_flambe2DHtmlRendererInit();\r\n\t}\r\n\t\r\n\tinline private function _flambe2DHtmlRendererInit():Void\r\n\t{\r\n\t\tConsole.info(\"Creating Flambe 2_5D Html Renderer...\");\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, January 2015\r\n */\r\n\r\n package tools.spark.sliced.services.std.display.renderers.core.platform.html;\r\n\r\n\r\nimport tools.spark.framework.dom2_5D.DomCamera2_5D;\r\nimport tools.spark.framework.dom2_5D.DomScene2_5D;\r\nimport tools.spark.framework.dom2_5D.DomView2_5D;\r\nimport tools.spark.framework.space2_5D.core.AObjectContainer2_5D;\r\nimport tools.spark.sliced.services.std.display.managers.core.DomCameraManager;\r\nimport tools.spark.sliced.services.std.display.managers.core.DomObjectManager;\r\nimport tools.spark.sliced.services.std.display.managers.core.DomSceneManager;\r\nimport tools.spark.sliced.services.std.display.managers.core.DomViewManager;\r\nimport tools.spark.sliced.services.std.display.renderers.core.library.ANativeControls2_5DRenderer;\r\nimport tools.spark.sliced.services.std.display.renderers.interfaces.IPlatformSpecificRenderer;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n * \r\n */\r\nclass NativeControlsHtmlRenderer extends ANativeControls2_5DRenderer implements IPlatformSpecificRenderer\r\n{\r\n\tprivate var _views:Map<IGameEntity,DomView2_5D>;\r\n\tprivate var _scenes:Map<IGameEntity,DomScene2_5D>;\r\n\tprivate var _cameras:Map<IGameEntity,DomCamera2_5D>;\r\n\tprivate var _objects:Map<IGameEntity,AObjectContainer2_5D>;\r\n\r\n\tprivate var _viewManager:DomViewManager;\r\n\tprivate var _sceneManager:DomSceneManager;\r\n\tprivate var _cameraManager:DomCameraManager;\r\n\tprivate var _objectManager:DomObjectManager;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\r\n\t\t_nativeControlsHtmlRendererInit();\r\n\t}\r\n\t\r\n\tinline private function _nativeControlsHtmlRendererInit():Void\r\n\t{\r\n\t\tConsole.info(\"Creating Native Controls Html (DOM) Renderer...\");\r\n\t\t\r\n\t\t//@THINK: keep this? or just one map to rule them all??\r\n\t\t_views = new Map<IGameEntity,DomView2_5D>();\r\n\t\t_scenes = new Map<IGameEntity,DomScene2_5D>();\r\n\t\t_cameras = new Map<IGameEntity,DomCamera2_5D>();\r\n\t\t_objects = new Map<IGameEntity,AObjectContainer2_5D>();\r\n\t\t\r\n\t\t_viewManager = new DomViewManager(this);\r\n\t\t_sceneManager = new DomSceneManager(this);\r\n\t\t_cameraManager = new DomCameraManager(this);\r\n\t\t_objectManager = new DomObjectManager(this);\r\n\t}\r\n\t\r\n\t\r\n\toverride public function renderView ( p_viewEntity:IGameEntity):Void\r\n\t{\r\n\t\t//Console.warn(\"AFlambe2_5DRenderer rendering View: \" + p_viewEntity.getState('name'));\r\n\t\t\r\n\t\t//render a view\r\n\t\t_views[p_viewEntity].render();\r\n\t}\r\n\t\r\n\r\n\toverride public function createView ( p_viewEntity:IGameEntity):Dynamic\r\n\t{\r\n\t\tif (_views[p_viewEntity] != null)\r\n\t\t\tConsole.warn(\"View \" + p_viewEntity.getState('name') + \" has already been added to this NativeControlsHtmlRenderer. Ignoring...\");\r\n\t\telse\r\n\t\t\t_views[p_viewEntity] = cast(_viewManager.create(p_viewEntity),DomView2_5D);\r\n\t\t\r\n\t\treturn _views[p_viewEntity];\r\n\t}\r\n\t\r\n\toverride public function createScene ( p_sceneEntity:IGameEntity):Dynamic\r\n\t{\r\n\t\tif (_scenes[p_sceneEntity] != null)\r\n\t\t\tConsole.warn(\"Scene \" + p_sceneEntity.getState('name') + \" has already been added to this NativeControlsHtmlRenderer. Ignoring...\");\r\n\t\telse\r\n\t\t\t_scenes[p_sceneEntity] = cast(_sceneManager.create(p_sceneEntity),DomScene2_5D);\r\n\t\t\r\n\t\treturn _scenes[p_sceneEntity];\r\n\t}\r\n\t\r\n\toverride public function createCamera ( p_cameraEntity:IGameEntity):Dynamic\r\n\t{\r\n\t\tif (_cameras[p_cameraEntity] != null)\r\n\t\t\tConsole.warn(\"Camera \" + p_cameraEntity.getState('name') + \" has already been added to this NativeControlsHtmlRenderer. Ignoring...\");\r\n\t\telse\r\n\t\t\t_cameras[p_cameraEntity] = cast(_cameraManager.create(p_cameraEntity),DomCamera2_5D);\r\n\r\n\t\treturn _cameras[p_cameraEntity];\r\n\t}\r\n\t\r\n\toverride public function createObject ( p_objectEntity:IGameEntity):Dynamic\r\n\t{\r\n\t\tif (p_objectEntity.getState('displayType')==\"Entity\")\r\n\t\t{\r\n\t\t\tif (_objects[p_objectEntity] != null)\r\n\t\t\t\tConsole.warn(\"Object \" + p_objectEntity.getState('name') + \" has already been added to this NativeControlsHtmlRenderer. Ignoring...\");\r\n\t\t\telse\r\n\t\t\t\t_objects[p_objectEntity] = cast(_objectManager.create(p_objectEntity),AObjectContainer2_5D);\r\n\t\t\t\r\n\t\t\treturn _objects[p_objectEntity];\r\n\t\t}\r\n\t\telse return null;\r\n\t}\r\n\t\r\n\toverride inline public function addChild ( p_parentEntity:IGameEntity, p_childEntity:IGameEntity):Void\r\n\t{\r\n\t\t//check the parent display type here.. For the childEntity, I'm ASSUMING it's an entity/object.. is that right??\r\n\t\tswitch (p_parentEntity.getState('displayType'))\r\n\t\t{\r\n\t\t\tcase \"Scene\":\r\n\t\t\t\tif (_scenes[p_parentEntity] != null)\r\n\t\t\t\t\t_sceneManager.addTo(createObject(p_childEntity), _scenes[p_parentEntity]);\r\n\t\t\tcase \"Entity\":\r\n\t\t\t\tif (_objects[p_parentEntity] != null)\r\n\t\t\t\t\t_objectManager.addTo(createObject(p_childEntity), _objects[p_parentEntity]);\r\n\t\t\tdefault:\r\n\t\t\t\tConsole.warn(\"NativeControlsHtmlRenderer: Unhandled add child request: \" + p_parentEntity.getState('displayType'));\r\n\t\t}\r\n\t}\r\n\t\r\n\toverride inline public function updateState ( p_objectEntity:IGameEntity, p_state:String):Void\r\n\t{\r\n\t\t//maybe check its display type here..\r\n\t\t\r\n\t\t//is it object, do this:\r\n\t\tif (_objects[p_objectEntity] != null)\r\n\t\t{\r\n\t\t\t_objectManager.updateState(_objects[p_objectEntity], p_objectEntity, p_state);\r\n\t\t}//else, is it view, do this...  etc\r\n\t\telse if (_views[p_objectEntity] != null)\r\n\t\t{\r\n\t\t\t_viewManager.updateState(_views[p_objectEntity], p_objectEntity, p_state);\r\n\t\t}\r\n\t}\r\n\t\r\n\toverride inline public function updateFormState ( p_objectEntity:IGameEntity, p_state:String):Void\r\n\t{\r\n\t\t//maybe check its display type here..\r\n\t\t\r\n\t\t//is it object, do this:\r\n\t\tif (_objects[p_objectEntity] != null)\r\n\t\t{\r\n\t\t\t_objectManager.updateFormState(_objects[p_objectEntity], p_objectEntity.gameForm, p_state);\r\n\t\t}\r\n\t\t\r\n\t\t//else, is it view, do this...  etc\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, September 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.event.core;\r\n\r\nimport flambe.input.Key;\r\nimport haxe.ds.ObjectMap;\r\nimport tools.spark.sliced.interfaces.IEvent;\r\nimport tools.spark.sliced.core.AService;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EEventType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EEventPrefab;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameTrigger;\r\nimport tools.spark.sliced.core.Sliced;\r\n\r\n/**\r\n * This one needs a lot of reworking. apart from the comments below, consider this as well. If we try to raise an event but there are no triggers\r\n * established for this event, there's no reason raising the event at all!!!! So may optimizations here.. rework it asap\r\n * @author Aris Kostakos\r\n */\r\nclass Event extends AService implements IEvent\r\n{\r\n\t//@TODO: The way I'm doing this now is having a map of triggers, and in turn it has a map of filters. The values of the second map is: for eventTypeFilterFlags\r\n\t\t//it's a Boolean, for eventTypeFilterTriggers it's an array of triggers. For eventTypeFilterFlags, I check in every update of the service if each Boolean is\r\n\t\t//true. But I could instead just add the filter entry and remove the filter entry all together and not check for Booleans. This would optimize it a bit.\r\n\t\t//Also, instead of the NO_TRIGGER filter, you just check if i have ANY filters for that event. if true, then raise the NO_FILTER. Small optimization but\r\n\t\t//it could be worth it in the long run. Checking for true/false flags on EVERY FRAME is costly and dangerous.\r\n\tprivate var _eventTypeFilterFlags:Map < EEventType, ObjectMap < Dynamic, Bool >> ;\r\n\tprivate var _eventTypeFilterTriggers:Map < EEventType, ObjectMap < Dynamic, Array<IGameTrigger> >> ;\r\n\t\r\n\t//@note: There are dumb objects that will serve as keys to the filter arrays above. I just needed something to give a unique pointer\r\n\t\t//Btw, a String would not work since in JavaScript a string is apparently a primitive, not an object. So Empty arrays should do the trick\r\n\tprivate var _NO_FILTER:Array<Dynamic>;\r\n\tprivate var _FILTER_VARIABLE_USER_ENTITY:Array<Dynamic>;\r\n\t\r\n\tprivate var _prefabConvertToType:Map<EEventPrefab,EEventType>;\r\n\tprivate var _prefabConvertToFilter:Map<EEventPrefab,Dynamic>;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\tConsole.log(\"Init Event std Service...\");\r\n\t\t\r\n\t\t_NO_FILTER = new Array<Dynamic>();\r\n\t\t_FILTER_VARIABLE_USER_ENTITY = new Array<Dynamic>();\r\n\t\t\r\n\t\t_eventTypeFilterFlags = new Map < EEventType, ObjectMap < Dynamic, Bool >> ();\r\n\t\t_eventTypeFilterTriggers = new Map < EEventType, ObjectMap < Dynamic, Array<IGameTrigger> >> ();\r\n\t\t\r\n\t\t_initPrefabConvertToTypeMap();\r\n\t\t_initPrefabConvertToFilterMap();\r\n\t}\r\n\t\r\n\t\r\n\tpublic function addTrigger(p_gameTrigger:IGameTrigger):Void\r\n\t{\r\n\t\tvar l_eventType:EEventType = _prefabConvertToType[p_gameTrigger.eventPrefab];\r\n\t\tvar l_eventFilter:Dynamic = _prefabConvertToFilter[p_gameTrigger.eventPrefab];\r\n\t\t\r\n\t\t//Replace Filter with an appropriate variable if needed\r\n\t\tif (l_eventFilter == _FILTER_VARIABLE_USER_ENTITY)\r\n\t\t{\r\n\t\t\tl_eventFilter = p_gameTrigger.parentEntity;\r\n\t\t}\r\n\t\t\r\n\t\t//Add additional filter variable changes here\r\n\t\t//...\r\n\t\t\r\n\t\t//Create a slot for the eventType included in the trigger's prefab\r\n\t\tif (_eventTypeFilterTriggers.exists(l_eventType) == false)\r\n\t\t\t_eventTypeFilterTriggers.set(l_eventType, new ObjectMap < Dynamic, Array<IGameTrigger> > () );\r\n\t\t\r\n\t\t//Create a slot for the eventFilter included in the trigger's prefab\r\n\t\tif (_eventTypeFilterTriggers[l_eventType].exists(l_eventFilter) == false)\r\n\t\t\t_eventTypeFilterTriggers[l_eventType].set(l_eventFilter, new Array<IGameTrigger>() );\r\n\t\t\r\n\t\t//Push the trigger to the correct slot\r\n\t\t_eventTypeFilterTriggers.get(l_eventType).get(l_eventFilter).push(p_gameTrigger);\r\n\t\t\r\n\t\t//Register Triggers to appropriate Services (where needed)\r\n\t\tif (\tl_eventType == MOUSE_LEFT_CLICK ||\r\n\t\t\t\tl_eventType == MOUSE_RIGHT_CLICK ||\r\n\t\t\t\tl_eventType == MOUSE_ENTERED ||\r\n\t\t\t\tl_eventType == MOUSE_MOVED ||\r\n\t\t\t\tl_eventType == MOUSE_LEFT\r\n\t\t   )\r\n\t\t{\r\n\t\t\tSliced.input.pointer.registerTrigger(l_eventType,l_eventFilter);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function raiseEvent(p_eventType:EEventType, ?p_eventFilter:Dynamic):Void\r\n\t{\r\n\t\tif (p_eventFilter == null)\r\n\t\t\tp_eventFilter = _NO_FILTER;\r\n\t\t\t\r\n\t\t//Create a slot for the raised eventType\r\n\t\tif (_eventTypeFilterFlags.exists(p_eventType) == false)\r\n\t\t\t_eventTypeFilterFlags[p_eventType] = new ObjectMap < Dynamic, Bool > ();\r\n\t\t\t\r\n\t\t_eventTypeFilterFlags[p_eventType].set(p_eventFilter, true);\r\n\t\t\r\n\t\tif (p_eventFilter != _NO_FILTER)\r\n\t\t\t_eventTypeFilterFlags[p_eventType].set(_NO_FILTER, true);\r\n\t}\r\n\t\r\n\tinline private function _doTriggers(p_eventType:EEventType, p_eventFilter:Dynamic):Void\r\n\t{\r\n\t\t//Console.info(\"Activating triggers for: \" + p_eventType);\r\n\t\t\r\n\t\tif (_eventTypeFilterTriggers.exists(p_eventType))\r\n\t\t{\r\n\t\t\tif (_eventTypeFilterTriggers[p_eventType].exists(p_eventFilter))\r\n\t\t\t{\r\n\t\t\t\t//Console.warn(\"Triggers exist\");\r\n\t\t\t\tfor (gameTrigger in _eventTypeFilterTriggers[p_eventType].get(p_eventFilter))\r\n\t\t\t\t{\r\n\t\t\t\t\tgameTrigger.doPass();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t//Console.warn(\"Triggers map don't exist in this event's filter\");\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//Console.warn(\"Triggers map don't exist in this event\");\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function update():Void\r\n\t{\r\n\t\t//@FIX ME SOON!: In this case, and the other for loop two lines below, we enumerate the keys(). But in the doTriggers() function deep inside, it maybe be\r\n\t\t//possible that it will run some lionscript code that adds a new kew.. this will produce problems like it did with the logic service. Maybe store the \r\n\t\t//enumeration list somewhere prior, like you did in the logic service to be safe. This means it will check for the newly activated(added) filter, the next frame.\r\n\t\t//Search for '//Solution to html5 bug' in GameClassParser.hx\r\n\t\tfor (flag in _eventTypeFilterFlags.keys())\r\n\t\t{\r\n\t\t\tif (_eventTypeFilterFlags[flag].get(_NO_FILTER) == true)\r\n\t\t\t{\r\n\t\t\t\tfor (filterFlag in _eventTypeFilterFlags[flag].keys())\r\n\t\t\t\t{\r\n\t\t\t\t\tif (_eventTypeFilterFlags[flag].get(filterFlag) == true)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t_eventTypeFilterFlags[flag].set(filterFlag, false);\r\n\t\t\t\t\t\t_doTriggers(flag, filterFlag);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t///////////////////////////\r\n\t\r\n\tprivate function _initPrefabConvertToTypeMap():Void\r\n\t{\r\n\t\t_prefabConvertToType = new Map<EEventPrefab,EEventType>();\r\n\t\t\r\n\t\t_prefabConvertToType[EEventPrefab.CREATED] = EEventType.CREATED;\r\n\t\t_prefabConvertToType[EEventPrefab.UPDATE] = EEventType.UPDATE;\r\n\t\t_prefabConvertToType[EEventPrefab.NETWORK_CONNECTED] = EEventType.NETWORK_CONNECTED;\r\n\t\t_prefabConvertToType[EEventPrefab.NETWORK_REQUEST] = EEventType.NETWORK_REQUEST;\r\n\t\t_prefabConvertToType[EEventPrefab.NETWORK_SERVER_EVENT] = EEventType.NETWORK_SERVER_EVENT;\r\n\t\t_prefabConvertToType[EEventPrefab.FILETRANSFER_CONNECTED] = EEventType.FILETRANSFER_CONNECTED;\r\n\t\t_prefabConvertToType[EEventPrefab.FILETRANSFER_SENDREQUEST] = EEventType.FILETRANSFER_SENDREQUEST;\r\n\t\t_prefabConvertToType[EEventPrefab.MOUSE_LEFT_CLICK] = EEventType.MOUSE_LEFT_CLICK;\r\n\t\t_prefabConvertToType[EEventPrefab.MOUSE_RIGHT_CLICK] = EEventType.MOUSE_RIGHT_CLICK;\r\n\t\t_prefabConvertToType[EEventPrefab.MOUSE_LEFT_CLICKED] = EEventType.MOUSE_LEFT_CLICK;\r\n\t\t_prefabConvertToType[EEventPrefab.MOUSE_RIGHT_CLICKED] = EEventType.MOUSE_RIGHT_CLICK;\r\n\t\t_prefabConvertToType[EEventPrefab.MOUSE_ENTERED] = EEventType.MOUSE_ENTERED;\r\n\t\t_prefabConvertToType[EEventPrefab.MOUSE_MOVED] = EEventType.MOUSE_MOVED;\r\n\t\t_prefabConvertToType[EEventPrefab.MOUSE_LEFT] = EEventType.MOUSE_LEFT;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_ALT] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_BACKSPACE] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_CAPS_LOCK] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_CONTROL] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_DELETE] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_DOWN] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_END] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_ENTER] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_ESCAPE] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F1] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F10] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F11] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F12] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F13] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F14] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F15] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F2] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F3] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F4] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F5] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F6] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F7] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F8] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F9] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_HOME] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_INSERT] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_LEFT] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_0] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_1] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_2] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_3] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_4] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_5] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_6] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_7] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_8] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_9] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_ADD] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_DECIMAL] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_DIVIDE] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_ENTER] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_MULTIPLY] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMPAD_SUBTRACT] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_PAGE_DOWN] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_PAGE_UP] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_RIGHT] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_SHIFT] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_SPACE] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_TAB] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_UP] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_A] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_B] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_C] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_D] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_E] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_F] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_G] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_H] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_I] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_J] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_K] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_L] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_M] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_N] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_O] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_P] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_Q] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_R] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_S] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_T] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_U] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_V] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_W] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_X] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_Y] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_Z] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMBER_0] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMBER_1] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMBER_2] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMBER_3] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMBER_4] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMBER_5] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMBER_6] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMBER_7] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMBER_8] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_NUMBER_9] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_EQUALS] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_SLASH] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_BACKSLASH] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_LEFTBRACKET] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_RIGHTBRACKET] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_BACKQUOTE] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_COMMA] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_COMMAND] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_MINUS] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_PERIOD] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_QUOTE] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_SEMICOLON] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_ANDROIDMENU] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_ANDROIDSEARCH] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_PRESSED_UNKNOWN] = EEventType.KEY_PRESSED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_ALT] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_BACKSPACE] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_CAPS_LOCK] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_CONTROL] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_DELETE] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_DOWN] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_END] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_ENTER] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_ESCAPE] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F1] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F10] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F11] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F12] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F13] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F14] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F15] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F2] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F3] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F4] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F5] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F6] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F7] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F8] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F9] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_HOME] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_INSERT] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_LEFT] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_0] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_1] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_2] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_3] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_4] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_5] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_6] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_7] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_8] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_9] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_ADD] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_DECIMAL] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_DIVIDE] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_ENTER] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_MULTIPLY] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMPAD_SUBTRACT] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_PAGE_DOWN] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_PAGE_UP] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_RIGHT] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_SHIFT] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_SPACE] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_TAB] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_UP] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_A] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_B] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_C] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_D] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_E] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_F] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_G] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_H] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_I] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_J] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_K] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_L] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_M] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_N] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_O] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_P] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_Q] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_R] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_S] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_T] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_U] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_V] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_W] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_X] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_Y] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_Z] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMBER_0] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMBER_1] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMBER_2] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMBER_3] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMBER_4] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMBER_5] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMBER_6] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMBER_7] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMBER_8] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_NUMBER_9] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_EQUALS] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_SLASH] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_BACKSLASH] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_LEFTBRACKET] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_RIGHTBRACKET] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_BACKQUOTE] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_COMMA] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_COMMAND] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_MINUS] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_PERIOD] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_QUOTE] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_SEMICOLON] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_ANDROIDMENU] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_ANDROIDSEARCH] = EEventType.KEY_RELEASED;\r\n\t\t_prefabConvertToType[EEventPrefab.KEY_RELEASED_UNKNOWN] = EEventType.KEY_RELEASED;\r\n\t}\r\n\r\n\tprivate function _initPrefabConvertToFilterMap():Void\r\n\t{\r\n\t\t_prefabConvertToFilter = new Map<EEventPrefab,Dynamic>();\r\n\t\t\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.CREATED , _FILTER_VARIABLE_USER_ENTITY);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.UPDATE , _NO_FILTER);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.NETWORK_CONNECTED , _NO_FILTER);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.NETWORK_REQUEST , _NO_FILTER);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.NETWORK_SERVER_EVENT , _NO_FILTER);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.FILETRANSFER_CONNECTED , _NO_FILTER);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.FILETRANSFER_SENDREQUEST , _NO_FILTER);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.MOUSE_LEFT_CLICK , _NO_FILTER);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.MOUSE_RIGHT_CLICK , _NO_FILTER);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.MOUSE_LEFT_CLICKED , _FILTER_VARIABLE_USER_ENTITY);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.MOUSE_RIGHT_CLICKED , _FILTER_VARIABLE_USER_ENTITY);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.MOUSE_ENTERED , _FILTER_VARIABLE_USER_ENTITY);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.MOUSE_MOVED , _FILTER_VARIABLE_USER_ENTITY);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.MOUSE_LEFT , _FILTER_VARIABLE_USER_ENTITY);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED , _NO_FILTER);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED , _NO_FILTER);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_ALT, Key.Alt);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_BACKSPACE, Key.Backspace);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_CAPS_LOCK, Key.CapsLock);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_CONTROL, Key.Control);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_DELETE, Key.Delete);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_DOWN, Key.Down);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_END, Key.End);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_ENTER, Key.Enter);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_ESCAPE, Key.Escape);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F1, Key.F1);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F10, Key.F10);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F11, Key.F11);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F12, Key.F12);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F13, Key.F13);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F14, Key.F14);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F15, Key.F15);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F2, Key.F2);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F3, Key.F3);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F4, Key.F4);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F5, Key.F5);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F6, Key.F6);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F7, Key.F7);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F8, Key.F8);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F9, Key.F9);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_HOME, Key.Home);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_INSERT, Key.Insert);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_LEFT, Key.Left);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_0, Key.Numpad0);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_1, Key.Numpad1);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_2, Key.Numpad2);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_3, Key.Numpad3);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_4, Key.Numpad4);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_5, Key.Numpad5);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_6, Key.Numpad6);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_7, Key.Numpad7);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_8, Key.Numpad8);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_9, Key.Numpad9);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_ADD, Key.NumpadAdd);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_DECIMAL, Key.NumpadDecimal);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_DIVIDE, Key.NumpadDivide);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_ENTER, Key.NumpadEnter);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_MULTIPLY, Key.NumpadMultiply);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMPAD_SUBTRACT, Key.NumpadSubtract);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_PAGE_DOWN, Key.PageDown);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_PAGE_UP, Key.PageUp);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_RIGHT, Key.Right);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_SHIFT, Key.Shift);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_SPACE, Key.Space);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_TAB, Key.Tab);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_UP, Key.Up);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_A, Key.A);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_B, Key.B);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_C, Key.C);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_D, Key.D);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_E, Key.E);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_F, Key.F);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_G, Key.G);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_H, Key.H);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_I, Key.I);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_J, Key.J);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_K, Key.K);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_L, Key.L);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_M, Key.M);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_N, Key.N);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_O, Key.O);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_P, Key.P);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_Q, Key.Q);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_R, Key.R);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_S, Key.S);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_T, Key.T);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_U, Key.U);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_V, Key.V);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_W, Key.W);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_X, Key.X);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_Y, Key.Y);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_Z, Key.Z);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMBER_0, Key.Number0);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMBER_1, Key.Number1);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMBER_2, Key.Number2);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMBER_3, Key.Number3);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMBER_4, Key.Number4);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMBER_5, Key.Number5);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMBER_6, Key.Number6);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMBER_7, Key.Number7);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMBER_8, Key.Number8);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_NUMBER_9, Key.Number9);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_EQUALS, Key.Equals);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_SLASH, Key.Slash);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_BACKSLASH, Key.Backslash);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_LEFTBRACKET, Key.LeftBracket);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_RIGHTBRACKET, Key.RightBracket);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_BACKQUOTE, Key.Backquote);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_COMMA, Key.Comma);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_COMMAND, Key.Command);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_MINUS, Key.Minus);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_PERIOD, Key.Period);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_QUOTE, Key.Quote);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_SEMICOLON, Key.Semicolon);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_ANDROIDMENU, Key.Menu);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_ANDROIDSEARCH, Key.Search);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_PRESSED_UNKNOWN, Key.Unknown);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_ALT, Key.Alt);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_BACKSPACE, Key.Backspace);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_CAPS_LOCK, Key.CapsLock);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_CONTROL, Key.Control);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_DELETE, Key.Delete);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_DOWN, Key.Down);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_END, Key.End);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_ENTER, Key.Enter);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_ESCAPE, Key.Escape);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F1, Key.F1);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F10, Key.F10);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F11, Key.F11);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F12, Key.F12);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F13, Key.F13);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F14, Key.F14);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F15, Key.F15);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F2, Key.F2);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F3, Key.F3);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F4, Key.F4);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F5, Key.F5);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F6, Key.F6);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F7, Key.F7);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F8, Key.F8);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F9, Key.F9);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_HOME, Key.Home);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_INSERT, Key.Insert);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_LEFT, Key.Left);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_0, Key.Numpad0);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_1, Key.Numpad1);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_2, Key.Numpad2);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_3, Key.Numpad3);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_4, Key.Numpad4);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_5, Key.Numpad5);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_6, Key.Numpad6);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_7, Key.Numpad7);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_8, Key.Numpad8);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_9, Key.Numpad9);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_ADD, Key.NumpadAdd);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_DECIMAL, Key.NumpadDecimal);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_DIVIDE, Key.NumpadDivide);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_ENTER, Key.NumpadEnter);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_MULTIPLY, Key.NumpadMultiply);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMPAD_SUBTRACT, Key.NumpadSubtract);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_PAGE_DOWN, Key.PageDown);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_PAGE_UP, Key.PageUp);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_RIGHT, Key.Right);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_SHIFT, Key.Shift);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_SPACE, Key.Space);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_TAB, Key.Tab);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_UP, Key.Up);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_A, Key.A);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_B, Key.B);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_C, Key.C);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_D, Key.D);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_E, Key.E);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_F, Key.F);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_G, Key.G);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_H, Key.H);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_I, Key.I);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_J, Key.J);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_K, Key.K);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_L, Key.L);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_M, Key.M);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_N, Key.N);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_O, Key.O);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_P, Key.P);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_Q, Key.Q);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_R, Key.R);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_S, Key.S);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_T, Key.T);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_U, Key.U);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_V, Key.V);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_W, Key.W);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_X, Key.X);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_Y, Key.Y);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_Z, Key.Z);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMBER_0, Key.Number0);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMBER_1, Key.Number1);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMBER_2, Key.Number2);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMBER_3, Key.Number3);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMBER_4, Key.Number4);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMBER_5, Key.Number5);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMBER_6, Key.Number6);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMBER_7, Key.Number7);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMBER_8, Key.Number8);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_NUMBER_9, Key.Number9);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_EQUALS, Key.Equals);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_SLASH, Key.Slash);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_BACKSLASH, Key.Backslash);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_LEFTBRACKET, Key.LeftBracket);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_RIGHTBRACKET, Key.RightBracket);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_BACKQUOTE, Key.Backquote);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_COMMA, Key.Comma);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_COMMAND, Key.Command);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_MINUS, Key.Minus);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_PERIOD, Key.Period);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_QUOTE, Key.Quote);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_SEMICOLON, Key.Semicolon);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_ANDROIDMENU, Key.Menu);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_ANDROIDSEARCH, Key.Search);\r\n\t\t_prefabConvertToFilter.set(EEventPrefab.KEY_RELEASED_UNKNOWN, Key.Unknown);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, September 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.input.core;\r\n\r\nimport tools.spark.sliced.services.std.input.devices.core.KeyboardDevice;\r\nimport tools.spark.sliced.services.std.input.devices.core.PointerDevice;\r\nimport tools.spark.sliced.interfaces.IInput;\r\nimport tools.spark.sliced.core.AService;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Input extends AService implements IInput\r\n{\r\n\tpublic var keyboard( default, null ):KeyboardDevice;\r\n\tpublic var pointer( default, null ):PointerDevice;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\tConsole.log(\"Init Input std Service...\");\r\n\t\t\r\n\t\tkeyboard = new KeyboardDevice();\r\n\t\tpointer = new PointerDevice();\r\n\t}\r\n\t\r\n\tpublic function update():Void\r\n\t{\r\n\t\tkeyboard.update();\r\n\t\tpointer.update();\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, December 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.input.devices.core;\r\nimport tools.spark.sliced.services.std.input.devices.interfaces.IInputDevice;\r\nimport flambe.input.Key;\r\nimport flambe.input.KeyboardEvent;\r\nimport flambe.System;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EEventType;\r\nimport tools.spark.sliced.core.Sliced;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\n@:keep class KeyboardDevice implements IInputDevice\r\n{\r\n\tprivate var _keysDown:Array<Key>;\r\n\tprivate var _keysUp:Array<Key>;\r\n\t\r\n\tprivate var _keysJustPressed:Map<Key,Bool>;\r\n\tprivate var _keysJustReleased:Map<Key,Bool>;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\t_keysDown = new Array<Key>();\r\n\t\t_keysUp = new Array<Key>();\r\n\t\t\r\n\t\t_keysJustPressed = new Map<Key,Bool>();\r\n\t\t_keysJustReleased = new Map<Key,Bool>();\r\n\t\t\r\n\t\tSystem.keyboard.down.connect(_onKeyDown);\r\n\t\tSystem.keyboard.up.connect(_onKeyUp);\r\n\t}\r\n\t\r\n\tprivate function _onKeyDown(p_keyboardEvent:KeyboardEvent):Void\r\n\t{\r\n\t\t_keysDown.push(p_keyboardEvent.key);\r\n\t}\r\n\t\r\n\tprivate function _onKeyUp(p_keyboardEvent:KeyboardEvent):Void\r\n\t{\r\n\t\t_keysUp.push(p_keyboardEvent.key);\r\n\t}\r\n\t\r\n\tpublic function update():Void\r\n\t{\r\n\t\t_keysJustPressed = new Map<Key,Bool>();\r\n\t\t_keysJustReleased = new Map<Key,Bool>();\r\n\t\t\r\n\t\twhile (_keysDown.length>0)\r\n\t\t{\r\n\t\t\tvar w_keyDown:Key = _keysDown.pop();\r\n\t\t\t_keysJustPressed[w_keyDown] = true;\r\n\t\t\tSliced.event.raiseEvent(EEventType.KEY_PRESSED, w_keyDown);\r\n\t\t}\r\n\t\t\r\n\t\twhile (_keysUp.length>0)\r\n\t\t{\r\n\t\t\tvar w_keyUp:Key = _keysUp.pop();\r\n\t\t\t_keysJustReleased[w_keyUp] = true;\r\n\t\t\tSliced.event.raiseEvent(EEventType.KEY_RELEASED, w_keyUp);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function registerTrigger(p_eventType:EEventType, p_eventFilter:Dynamic):Void\r\n\t{\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic function isKeyDown( type:Key ):Bool\r\n\t{\r\n\t\treturn System.keyboard.isDown(type);\r\n\t}\r\n\t\r\n\tpublic function isKeyPressed( type:Key ):Bool\r\n\t{\r\n\t\treturn _keysJustPressed.exists(type);\r\n\t}\r\n\r\n\tpublic function isKeyReleased( type:Key ):Bool\r\n\t{\r\n\t\treturn _keysJustReleased.exists(type);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, December 2014\r\n */\r\n\r\npackage tools.spark.sliced.services.std.input.devices.core;\r\nimport flambe.input.PointerEvent;\r\nimport haxe.ds.ObjectMap;\r\nimport tools.spark.sliced.services.std.input.devices.interfaces.IInputDevice;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EEventType;\r\nimport flambe.System;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.core.Sliced;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\n@:keep class PointerDevice implements IInputDevice\r\n{\r\n\tprivate var _registeredTriggers:Map< EEventType, Map < IGameEntity, IGameEntity > >; //PointerEvent, Filter, SameFilterAgain\r\n\t\r\n\tpublic var currentX( default, null ):Float;\r\n\tpublic var currentY( default, null ):Float;\r\n\t\r\n\tprivate var _oldX:Float;\r\n\tprivate var _oldY:Float;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\t//System.pointer.move.connect(_onMove);\r\n\t\t_registeredTriggers = new Map < EEventType, Map < IGameEntity, IGameEntity > > ();\r\n\t}\r\n\t\r\n\tpublic function update():Void\r\n\t{\r\n\t\t_oldX = currentX;\r\n\t\t_oldY = currentY;\r\n\t\t\r\n\t\tcurrentX = System.pointer.x;\r\n\t\tcurrentY = System.pointer.y;\r\n\t}\r\n\t\r\n\tpublic function distX() : Float \r\n\t{\r\n\t\treturn currentX-_oldX;\r\n\t}\r\n\t\r\n\tpublic function distY() : Float \r\n\t{\r\n\t\treturn currentY-_oldY;\r\n\t}\r\n\t\r\n\tpublic function isDown():Bool\r\n\t{\r\n\t\treturn System.pointer.isDown();\r\n\t}\r\n\t\r\n\tprivate function _setTrigger(p_eventType:EEventType, p_eventFilter:IGameEntity):Void\r\n\t{\r\n\t\tif (_registeredTriggers[p_eventType] == null) _registeredTriggers[p_eventType] = new Map<IGameEntity, IGameEntity>();\r\n\t\t\r\n\t\t_registeredTriggers[p_eventType][p_eventFilter] = p_eventFilter;\r\n\t}\r\n\t\r\n\tprivate function _getTrigger(p_eventType: EEventType, p_eventFilter:IGameEntity):IGameEntity\r\n\t{\r\n\t\tif (_registeredTriggers[p_eventType] == null) return null;\r\n\t\t\r\n\t\treturn _registeredTriggers[p_eventType][p_eventFilter];\r\n\t}\r\n\t\r\n\tpublic function registerTrigger(p_eventType:EEventType, p_eventFilter:Dynamic):Void\r\n\t{\r\n\t\t_setTrigger(p_eventType,p_eventFilter);\r\n\t}\r\n\t\r\n\tpublic function submitPointerEvent(p_eventType:EEventType, p_eventFilter:Dynamic):Void\r\n\t{\r\n\t\tif (_getTrigger(p_eventType, p_eventFilter) != null)\r\n\t\t\tSliced.event.raiseEvent(p_eventType, p_eventFilter);\r\n\t}\r\n\t\r\n\tprivate function _onMove(p:PointerEvent):Void\r\n\t{\r\n\t\tConsole.error(\"PointerMove: \" + p.viewX + ', ' + p.viewY);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.core;\r\n\r\nimport tools.spark.sliced.interfaces.ILogic;\r\nimport tools.spark.sliced.core.AService;\r\nimport tools.spark.sliced.services.std.logic.gde.core.GameFactory;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameFactory;\r\nimport tools.spark.sliced.services.std.logic.interpreter.core.GmlInterpreter;\r\nimport tools.spark.sliced.services.std.logic.interpreter.core.HaxeInterpreter;\r\nimport tools.spark.sliced.services.std.logic.interpreter.interfaces.IInterpreter;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Logic extends AService implements ILogic\r\n{\r\n\tpublic var rootGameEntitiesRunning( default, null ):Map<String, IGameEntity>;\r\n\tpublic var rootGameEntitiesPaused( default, null ):Map<String, IGameEntity>;\r\n\t\r\n\tpublic var scriptInterpreter( default, null ):IInterpreter;\r\n\tpublic var gmlInterpreter( default, null ):IInterpreter;\r\n\tpublic var gameFactory( default, null ):IGameFactory;\r\n\t\r\n\tprivate var _gameEntitiesByName:Map<String, IGameEntity>;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\tConsole.log(\"Init Logic std Service...\");\r\n\t\t\r\n\t\t//Create Script Interpreter\r\n\t\tscriptInterpreter = new HaxeInterpreter();\r\n\t\t\r\n\t\t//Create Gml Interpreter\r\n\t\tgmlInterpreter = new GmlInterpreter();\r\n\t\t\r\n\t\t//Create GameFactory\r\n\t\tgameFactory = new GameFactory();\r\n\t\t\r\n\t\t//Create Maps\r\n\t\trootGameEntitiesRunning = new Map<String, IGameEntity>();\r\n\t\trootGameEntitiesPaused = new Map<String, IGameEntity>();\r\n\t\t_gameEntitiesByName = new Map<String, IGameEntity>();\r\n\t}\r\n\t\r\n\tpublic function update():Void\r\n\t{\r\n\t\t//@warning: Game Entities may NOT run in order!!! If that's the case, use an Array, and \r\n\t\t//will have to traverse the Array if you need to pick up an entity by a url reference\r\n\t\t//now that i think about it, maybe array would be better, to allow for multiple instances of the\r\n\t\t//same gameEntity to run (i forbid module run concurrency, but not game entity run concurrency..)\r\n\t\t//think about itttttttt! but then how do i say, pause this one, etc..?hmm\r\n\t\tfor (gameEntity in rootGameEntitiesRunning)\r\n\t\t\tgameEntity.doActions();\r\n\t}\r\n\t\r\n\tpublic function startAction(entity:IGameEntity, actionId:String):Bool\r\n\t{\r\n\t\treturn entity.startAction(actionId);\r\n\t}\r\n\t\r\n\tpublic function createAndRun(p_gameEntityUrl:String):Void\r\n\t{\r\n\t\t//Create GameEntity\r\n\t\trootGameEntitiesRunning[p_gameEntityUrl] = gameFactory.createGameEntity(p_gameEntityUrl);\r\n\t\tConsole.warn(\"Logic Service: Create and Running entity: \" + p_gameEntityUrl);\r\n\t}\r\n\t\r\n\tpublic function createAndPause(p_gameEntityUrl:String):Void\r\n\t{\r\n\t\t//Create GameEntity\r\n\t\trootGameEntitiesPaused[p_gameEntityUrl] = gameFactory.createGameEntity(p_gameEntityUrl);\r\n\t}\r\n\t\r\n\tpublic function getEntityByName(p_stateName:String):IGameEntity\r\n\t{\r\n\t\treturn _gameEntitiesByName.get(p_stateName);\r\n\t}\r\n\t\r\n\tpublic function registerEntityByName(p_entity:IGameEntity):Void\r\n\t{\r\n\t\tif (p_entity.getState('name') != null)\r\n\t\t\t_gameEntitiesByName.set(p_entity.getState('name'), p_entity);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.gde.core;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameBase;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\n@:keepSub class AGameBase implements IGameBase\r\n{\r\n\tpublic var parentEntity( default, default ):IGameEntity;\r\n\t\r\n\tprivate function new() \r\n\t{\r\n\r\n\t}\r\n\t\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.gde.core;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameAction;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameState;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EConcurrencyType;\r\nimport tools.spark.sliced.core.Sliced;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass GameAction extends AGameBase implements IGameAction\r\n{\r\n\t//Properties\r\n\tpublic var id( default, default ):String;\r\n\tpublic var gameStateSet( default, null ):Map<String,IGameState>;\r\n\tpublic var concurrency( default, default ):EConcurrencyType;\r\n\tpublic var scriptSet( default, null ):Array<Int>;\r\n\t\r\n\t//Constructor\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t//Console.log (\"Game Action Created\");\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\t\r\n\t//Methods\r\n\tprivate function _init():Void\r\n\t{\r\n\t\tscriptSet = new Array<Int>();\r\n\t\tgameStateSet = new Map<String,IGameState>();\r\n\t}\r\n\t\r\n\tpublic function addState(gameState:IGameState):Void\r\n\t{\r\n\t\tif (gameStateSet[gameState.id] != null)\r\n\t\t\tConsole.warn('A State with id ' + gameState.id + ' already exists in this Action.');\r\n\t\t\r\n\t\tgameStateSet[gameState.id] = gameState;\r\n\t}\r\n\t\r\n\tpublic function doPass():Void\r\n\t{\r\n\t\tfor (hashId in scriptSet)\r\n\t\t{\r\n\t\t\t//if (Sliced.logic.interpreter.run(hashId) == false)\r\n\t\t\t//\tConsole.warn('Action $id:HashId $hashId returned false');\r\n\t\t\tif (hashId == -1)\r\n\t\t\t{\r\n\t\t\t\tSliced.logic.gmlInterpreter.run(hashId, [ \"me\"=>parentEntity, \"parent\"=>parentEntity.parentEntity ]);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tSliced.logic.scriptInterpreter.run(hashId, [ \"me\"=>parentEntity, \"parent\"=>parentEntity.parentEntity ]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t// Set/Get State Value\r\n\tpublic function getState(p_stateId:String):Dynamic\r\n\t{\r\n\t\tif (gameStateSet.get(p_stateId) == null) return null;\r\n\t\telse return gameStateSet.get(p_stateId).value;\r\n\t}\r\n\t\r\n\tpublic function setState(p_stateId:String, p_value:Dynamic):Dynamic\r\n\t{\r\n\t\tgameStateSet.get(p_stateId).value = p_value;\r\n\t\t\r\n\t\treturn gameStateSet.get(p_stateId).value;\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.gde.core;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.ENodeType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EGameType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EConcurrencyType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EStateType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EEventPrefab;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameAction;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameClassInstantiator;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameSpace;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameState;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EEventType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameTrigger;\r\nimport tools.spark.sliced.core.Sliced;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass GameClassInstantiator implements IGameClassInstantiator\r\n{\r\n\tprivate var _xmlNodeTypeToNodeName:Map<ENodeType,String>;\r\n\tprivate var _xmlConcurrencyNameToType:Map<String,EConcurrencyType>;\r\n\tprivate var _xmlStateNameToType:Map<String,EStateType>;\r\n\tprivate var _xmlEventNameToPrefab:Map<String,EEventPrefab>;\r\n\t\r\n\tpublic function new(p_xmlNodeTypeToNodeName:Map<ENodeType,String>, p_xmlConcurrencyNameToType:Map<String,EConcurrencyType>, p_xmlStateNameToType:Map<String,EStateType>, p_xmlEventNameToPrefab:Map<String,EEventPrefab>) \r\n\t{\r\n\t\tConsole.log(\"Creating Game Class Instantiator\");\r\n\t\t_xmlNodeTypeToNodeName = p_xmlNodeTypeToNodeName;\r\n\t\t_xmlConcurrencyNameToType = p_xmlConcurrencyNameToType;\r\n\t\t_xmlStateNameToType = p_xmlStateNameToType;\r\n\t\t_xmlEventNameToPrefab = p_xmlEventNameToPrefab;\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\t\r\n\t}\r\n\t\t\r\n\t\r\n\t\r\n\tpublic function instantiateEntity(p_gameNode:Xml, ?p_parentEntity:IGameEntity):IGameEntity\r\n\t{\r\n\t\tvar l_gameEntity:IGameEntity = new GameEntity();\r\n\t\t\r\n\t\t//Parent Entity\r\n\t\tl_gameEntity.parentEntity = p_parentEntity;\r\n\t\t\r\n\t\t//Create the Entity's Form\r\n\t\tl_gameEntity.gameForm = instantiateForm(p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.FORM]).next(),l_gameEntity);\r\n\t\t\r\n\t\t//Create the Entity's States\r\n\t\t//@todo: //when i check whether the array xml element exists, and then access the first node it found (the hasNext and next functions),\r\n\t\t\t//I actually search through the xml TWICE. Instead, save the iterator from the first call(the hasNext), and use that to do the next()\r\n\t\tif (p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.STATES]).hasNext())\r\n\t\t{\r\n\t\t\tvar states:Xml = p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.STATES]).next();\r\n\t\t\tfor ( state in  states.elements()) \r\n\t\t\t{\r\n\t\t\t\tl_gameEntity.addState(instantiateState(state,l_gameEntity));\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Create the Entity's Actions\r\n\t\t//@todo: //when i check whether the array xml element exists, and then access the first node it found (the hasNext and next functions),\r\n\t\t\t//I actually search through the xml TWICE. Instead, save the iterator from the first call(the hasNext), and use that to do the next()\r\n\t\tif (p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.ACTIONS]).hasNext())\r\n\t\t{\r\n\t\t\tvar actions:Xml = p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.ACTIONS]).next();\r\n\t\t\tfor ( action in actions.elements()) \r\n\t\t\t{\r\n\t\t\t\tvar f_gameAction:IGameAction = instantiateAction(action, l_gameEntity);\r\n\t\t\t\t\r\n\t\t\t\tl_gameEntity.addAction(f_gameAction);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Create the Entity's Triggers\r\n\t\t//@todo: //when i check whether the array xml element exists, and then access the first node it found (the hasNext and next functions),\r\n\t\t\t//I actually search through the xml TWICE. Instead, save the iterator from the first call(the hasNext), and use that to do the next()\r\n\t\tif (p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.TRIGGERS]).hasNext())\r\n\t\t{\r\n\t\t\tvar triggers:Xml = p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.TRIGGERS]).next();\r\n\t\t\tfor ( trigger in triggers.elements()) \r\n\t\t\t{\r\n\t\t\t\tvar f_gameTrigger:IGameTrigger = instantiateTrigger(trigger,l_gameEntity);\r\n\t\t\t\t\r\n\t\t\t\tSliced.event.addTrigger(f_gameTrigger);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Register Entity By Name (watch here, if we dispose this entity we will need to remove it's reference from here as well)\r\n\t\tSliced.logic.registerEntityByName(l_gameEntity);\r\n\t\t\r\n\t\t//Trigger Event\r\n\t\tSliced.event.raiseEvent(EEventType.CREATED, l_gameEntity);\r\n\t\t\r\n\t\treturn l_gameEntity;\r\n\t}\r\n\t\r\n\tpublic function instantiateForm(p_gameNode:Xml, ?p_parentEntity:IGameEntity):IGameForm\r\n\t{\r\n\t\tvar l_gameForm:IGameForm = new GameForm();\r\n\t\t\r\n\t\t//Parent Entity\r\n\t\tl_gameForm.parentEntity = p_parentEntity;\r\n\t\t\r\n\t\t//Create the Form's States\r\n\t\t//@todo: //when i check whether the array xml element exists, and then access the first node it found (the hasNext and next functions),\r\n\t\t\t//I actually search through the xml TWICE. Instead, save the iterator from the first call(the hasNext), and use that to do the next()\r\n\t\tif (p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.STATES]).hasNext())\r\n\t\t{\r\n\t\t\tvar states:Xml = p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.STATES]).next();\r\n\t\t\tfor ( state in  states.elements()) \r\n\t\t\t{\r\n\t\t\t\tl_gameForm.addState(instantiateState(state,p_parentEntity));\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Create the Form's Space\r\n\t\tl_gameForm.gameSpace = instantiateSpace(p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.SPACE]).next(),p_parentEntity);\r\n\t\t\r\n\t\treturn l_gameForm;\r\n\t}\r\n\t\r\n\tpublic function instantiateSpace(p_gameNode:Xml, ?p_parentEntity:IGameEntity):IGameSpace\r\n\t{\r\n\t\tvar l_gameSpace:IGameSpace = new GameSpace();\r\n\t\t\r\n\t\t//Parent Entity\r\n\t\tl_gameSpace.parentEntity = p_parentEntity;\r\n\t\t\r\n\t\t//Create the Space's Entities\r\n\t\t//@todo: //when i check whether the array xml element exists, and then access the first node it found (the hasNext and next functions),\r\n\t\t\t//I actually search through the xml TWICE. Instead, save the iterator from the first call(the hasNext), and use that to do the next()\r\n\t\tif (p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.ENTITIES]).hasNext())\r\n\t\t{\r\n\t\t\tvar entities:Xml = p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.ENTITIES]).next();\r\n\t\t\tfor ( entity in  entities.elements()) \r\n\t\t\t{\r\n\t\t\t\tl_gameSpace.gameEntitySet.push(instantiateEntity(entity,p_parentEntity));\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn l_gameSpace;\r\n\t}\r\n\t\r\n\tpublic function instantiateState(p_gameNode:Xml, ?p_parentEntity:IGameEntity):IGameState\r\n\t{\r\n\t\tvar l_gameState:IGameState = new GameState();\r\n\t\t\r\n\t\t//Parent Entity\r\n\t\tl_gameState.parentEntity = p_parentEntity;\r\n\t\t\r\n\t\t//Create the State's Id\r\n\t\tl_gameState.id = p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.ID]).next().firstChild().nodeValue;\r\n\t\t\r\n\t\t//Create the State's Type\r\n\t\tl_gameState.type = _xmlStateNameToType[p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.TYPE]).next().firstChild().nodeValue];\r\n\t\t\r\n\t\t//Create the State's Value\r\n\t\tvar l_valueInString:String = p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.VALUE]).next().firstChild().nodeValue;\r\n\t\t//Typecast it\r\n\t\tswitch(l_gameState.type)\r\n\t\t{\r\n\t\t\tcase EStateType.BOOLEAN:\r\n\t\t\t\tl_gameState.value = (l_valueInString == \"true\" || l_valueInString == \"True\" || l_valueInString == \"t\" || l_valueInString == \"T\");\r\n\t\t\tcase EStateType.DECIMAL:\r\n\t\t\t\tl_gameState.value = Std.parseFloat(l_valueInString);\r\n\t\t\tcase EStateType.INTEGER:\r\n\t\t\t\tl_gameState.value = Std.parseInt(l_valueInString);\r\n\t\t\tcase EStateType.TEXT:\r\n\t\t\t\tl_gameState.value = l_valueInString;\r\n\t\t\tcase EStateType.DYNAMIC:\r\n\t\t\t\tl_gameState.value = null;\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\treturn l_gameState;\r\n\t}\r\n\t\r\n\tpublic function instantiateAction(p_gameNode:Xml, ?p_parentEntity:IGameEntity):IGameAction\r\n\t{\r\n\t\tvar l_gameAction:IGameAction = new GameAction();\r\n\t\t\r\n\t\t//Parent Entity\r\n\t\tl_gameAction.parentEntity = p_parentEntity;\r\n\t\t\r\n\t\t//Create the Action's Id\r\n\t\tl_gameAction.id = p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.ID]).next().firstChild().nodeValue;\r\n\t\t\r\n\t\t//Create the Actions's Concurrency\r\n\t\tl_gameAction.concurrency = _xmlConcurrencyNameToType[p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.CONCURRENCY]).next().firstChild().nodeValue];\r\n\t\t\r\n\t\t//Create the Action's Scripts\r\n\t\tvar scripts:Xml = p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.SCRIPTS]).next();\r\n\t\tfor ( script in scripts.elements()) \r\n\t\t{\r\n\t\t\tif (script.nodeName == _xmlNodeTypeToNodeName[ENodeType.SCRIPT])\r\n\t\t\t{\r\n\t\t\t\tl_gameAction.scriptSet.push(Sliced.logic.scriptInterpreter.hash(script.firstChild().nodeValue));\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tl_gameAction.scriptSet.push(Sliced.logic.gmlInterpreter.hash(script.firstChild().nodeValue));\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Create the Action's States\r\n\t\t//@todo: //when i check whether the array xml element exists, and then access the first node it found (the hasNext and next functions),\r\n\t\t\t//I actually search through the xml TWICE. Instead, save the iterator from the first call(the hasNext), and use that to do the next()\r\n\t\tif (p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.STATES]).hasNext())\r\n\t\t{\r\n\t\t\tvar states:Xml = p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.STATES]).next();\r\n\t\t\tfor ( state in states.elements()) \r\n\t\t\t{\r\n\t\t\t\tl_gameAction.addState(instantiateState(state,p_parentEntity));\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t\t\r\n\t\treturn l_gameAction;\r\n\t}\r\n\t\r\n\tpublic function instantiateTrigger(p_gameNode:Xml, ?p_parentEntity:IGameEntity):IGameTrigger\r\n\t{\r\n\t\tvar l_gameTrigger:IGameTrigger = new GameTrigger();\r\n\t\t\r\n\t\t//Parent Entity\r\n\t\tl_gameTrigger.parentEntity = p_parentEntity;\r\n\t\t\r\n\t\t//Create the Trigger's Event Type\r\n\t\tl_gameTrigger.eventPrefab = _xmlEventNameToPrefab[p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.EVENT]).next().firstChild().nodeValue];\r\n\t\t\r\n\t\t//Create the Trigger's Scripts\r\n\t\tvar scripts:Xml = p_gameNode.elementsNamed(_xmlNodeTypeToNodeName[ENodeType.SCRIPTS]).next();\r\n\t\tfor ( script in scripts.elements()) \r\n\t\t{\r\n\t\t\tif (script.nodeName == _xmlNodeTypeToNodeName[ENodeType.SCRIPT])\r\n\t\t\t{\r\n\t\t\t\tl_gameTrigger.scriptSet.push(Sliced.logic.scriptInterpreter.hash(script.firstChild().nodeValue));\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tl_gameTrigger.scriptSet.push(Sliced.logic.gmlInterpreter.hash(script.firstChild().nodeValue));\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn l_gameTrigger;\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.gde.core;\r\nimport tools.spark.framework.Assets;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EGameType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.ENodeType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EConcurrencyType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EStateType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EEventPrefab;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameAction;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameClassInstantiator;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameClassParser;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameClassValidator;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameFactory;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameSpace;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameState;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameTrigger;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass GameClassParser implements IGameClassParser\r\n{\r\n\tprivate var _gameClassValidator:IGameClassValidator;\r\n\tprivate var _gameClassInstantiator:IGameClassInstantiator;\r\n\t\r\n\tprivate var _xmlNodeTypeToNodeName:Map<ENodeType,String>;\r\n\tprivate var _xmlNodeNameToNodeType:Map<String,ENodeType>;\r\n\tprivate var _xmlGameTypeToNodeName:Map<EGameType,String>;\r\n\tprivate var _xmlNodeTypeToGameType:Map<ENodeType,EGameType>;\r\n\tprivate var _xmlGameTypeToFileExtension:Map<EGameType,String>;\r\n\tprivate var _xmlConcurrencyTypeToName:Map<EConcurrencyType,String>;\r\n\tprivate var _xmlConcurrencyNameToType:Map<String,EConcurrencyType>;\r\n\tprivate var _xmlStateTypeToName:Map<EStateType,String>;\r\n\tprivate var _xmlStateNameToType:Map<String,EStateType>;\r\n\tprivate var _xmlEventPrefabToName:Map<EEventPrefab,String>;\r\n\tprivate var _xmlEventNameToPrefab:Map<String,EEventPrefab>;\r\n\tprivate var _isNodeExtendable:Map<ENodeType,Bool>;\r\n\tprivate var _isNodeMergable:Map<ENodeType,Bool>;\r\n\tprivate var _isNodeTargetMergable:Map<ENodeType,Bool>;\r\n\tprivate var _isNodeArray:Map<ENodeType,Bool>;\r\n\t\r\n\tinline static private var _XMLELEMENT_EXTENDS:String = \"Extends\";\r\n\tinline static public var _XMLATTRIBUTE_EXTENDS:String = \"extends\";\r\n\t\r\n\tinline static private var _XMLELEMENT_TARGETMERGE:String = \"Id\";\r\n\tinline static private var _XMLATTRIBUTE_TARGETMERGE:String = \"id\";\r\n\t\r\n\tinline static private var _XMLNODEMODIFIER_MERGE:String = \"_\";\r\n\tinline static private var _MERGEWIDTH:Int = 1;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tConsole.log(\"Creating Game Class Parser\");\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\t_initNodeNamesMap();\r\n\t\t_initNodeTypesMap();\r\n\t\t_initGameTypesMap();\r\n\t\t_initNodeToGameMap();\r\n\t\t_initFileExtensionsMap();\r\n\t\t_initExtendableNodesMap();\r\n\t\t_initMergableNodesMap();\r\n\t\t_initTargetMergableNodesMap();\r\n\t\t_initArrayNodesMap();\r\n\t\t_initConcurrencyTypeToNameMap();\r\n\t\t_initConcurrencyNameToTypeMap();\r\n\t\t_initStateTypeToNameMap();\r\n\t\t_initStateNameToTypeMap();\r\n\t\t_initEventPrefabToNameMap();\r\n\t\t_initEventNameToPrefabMap();\r\n\t\t_gameClassValidator = new GameClassValidator(_xmlNodeTypeToNodeName, _xmlConcurrencyTypeToName, _xmlStateTypeToName, _xmlEventPrefabToName);\r\n\t\t_gameClassInstantiator = new GameClassInstantiator(_xmlNodeTypeToNodeName, _xmlConcurrencyNameToType, _xmlStateNameToType, _xmlEventNameToPrefab);\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t//Mapping\r\n\t\r\n\tprivate function _initNodeNamesMap():Void\r\n\t{\r\n\t\t_xmlNodeTypeToNodeName = new Map<ENodeType,String>();\r\n\t\t\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.ACTION] = \"Action\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.ACTIONS] = \"Actions\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.ENTITIES] = \"Entities\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.ENTITY] = \"Entity\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.FORM] = \"Form\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.SCRIPTS] = \"Scripts\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.SCRIPT] = \"Script\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.GML] = \"Gml\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.TRIGGERS] = \"Triggers\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.TRIGGER] = \"Trigger\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.EVENT] = \"Event\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.CONCURRENCY] = \"Concurrency\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.ID] = \"Id\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.SPACE] = \"Space\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.STATE] = \"State\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.STATES] = \"States\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.TYPE] = \"Type\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.VALUE] = \"Value\";\r\n\t\t_xmlNodeTypeToNodeName[ENodeType.EXTENDS] = \"Extends\";\r\n\t}\r\n\t\r\n\tprivate function _initNodeTypesMap():Void\r\n\t{\r\n\t\t_xmlNodeNameToNodeType = new Map<String,ENodeType>();\r\n\t\t\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.ACTION]] = ENodeType.ACTION;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.ACTIONS]] = ENodeType.ACTIONS;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.ENTITIES]] = ENodeType.ENTITIES;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.ENTITY]] = ENodeType.ENTITY;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.FORM]] = ENodeType.FORM;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.SCRIPTS]] = ENodeType.SCRIPTS;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.SCRIPT]] = ENodeType.SCRIPT;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.GML]] = ENodeType.GML;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.TRIGGERS]] = ENodeType.TRIGGERS;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.TRIGGER]] = ENodeType.TRIGGER;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.EVENT]] = ENodeType.EVENT;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.CONCURRENCY]] = ENodeType.CONCURRENCY;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.ID]] = ENodeType.ID;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.SPACE]] = ENodeType.SPACE;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.STATE]] = ENodeType.STATE;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.STATES]] = ENodeType.STATES;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.TYPE]] = ENodeType.TYPE;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.VALUE]] = ENodeType.VALUE;\r\n\t\t_xmlNodeNameToNodeType[_xmlNodeTypeToNodeName[ENodeType.EXTENDS]] = ENodeType.EXTENDS;\r\n\t}\r\n\t\r\n\tprivate function _initGameTypesMap():Void\r\n\t{\r\n\t\t_xmlGameTypeToNodeName = new Map<EGameType,String>();\r\n\t\t\r\n\t\t_xmlGameTypeToNodeName[EGameType.ENTITY] = _xmlNodeTypeToNodeName[ENodeType.ENTITY];\r\n\t\t_xmlGameTypeToNodeName[EGameType.STATE] = _xmlNodeTypeToNodeName[ENodeType.STATE];\r\n\t\t_xmlGameTypeToNodeName[EGameType.SPACE] = _xmlNodeTypeToNodeName[ENodeType.SPACE];\r\n\t\t_xmlGameTypeToNodeName[EGameType.FORM] = _xmlNodeTypeToNodeName[ENodeType.FORM];\r\n\t\t_xmlGameTypeToNodeName[EGameType.ACTION] = _xmlNodeTypeToNodeName[ENodeType.ACTION];\r\n\t\t_xmlGameTypeToNodeName[EGameType.TRIGGER] = _xmlNodeTypeToNodeName[ENodeType.TRIGGER];\r\n\t}\r\n\t\r\n\tprivate function _initNodeToGameMap():Void\r\n\t{\r\n\t\t_xmlNodeTypeToGameType = new Map<ENodeType,EGameType>();\r\n\t\t\r\n\t\t_xmlNodeTypeToGameType[ENodeType.ENTITY] = EGameType.ENTITY;\r\n\t\t_xmlNodeTypeToGameType[ENodeType.STATE] = EGameType.STATE;\r\n\t\t_xmlNodeTypeToGameType[ENodeType.SPACE] = EGameType.SPACE;\r\n\t\t_xmlNodeTypeToGameType[ENodeType.FORM] = EGameType.FORM;\r\n\t\t_xmlNodeTypeToGameType[ENodeType.ACTION] = EGameType.ACTION;\r\n\t\t_xmlNodeTypeToGameType[ENodeType.TRIGGER] = EGameType.TRIGGER;\r\n\t}\r\n\t\r\n\tprivate function _initFileExtensionsMap():Void\r\n\t{\r\n\t\t_xmlGameTypeToFileExtension = new Map<EGameType,String>();\r\n\t\t\r\n\t\t_xmlGameTypeToFileExtension[EGameType.ENTITY] = \"egc\";\r\n\t\t_xmlGameTypeToFileExtension[EGameType.STATE] = \"sgc\";\r\n\t\t_xmlGameTypeToFileExtension[EGameType.SPACE] = \"pgc\";\r\n\t\t_xmlGameTypeToFileExtension[EGameType.FORM] = \"fgc\";\r\n\t\t_xmlGameTypeToFileExtension[EGameType.ACTION] = \"agc\";\r\n\t\t_xmlGameTypeToFileExtension[EGameType.TRIGGER] = \"tgc\";\r\n\t}\r\n\t\r\n\r\n\tprivate function _initExtendableNodesMap():Void\r\n\t{\r\n\t\t_isNodeExtendable = new Map<ENodeType,Bool>();\r\n\t\t\r\n\t\t_isNodeExtendable[ENodeType.ACTION] = true;\r\n\t\t_isNodeExtendable[ENodeType.ACTIONS] = false;\r\n\t\t_isNodeExtendable[ENodeType.ENTITIES] = false;\r\n\t\t_isNodeExtendable[ENodeType.ENTITY] = true;\r\n\t\t_isNodeExtendable[ENodeType.FORM] = true;\r\n\t\t_isNodeExtendable[ENodeType.SCRIPTS] = false;\r\n\t\t_isNodeExtendable[ENodeType.SCRIPT] = false;\r\n\t\t_isNodeExtendable[ENodeType.GML] = false;\r\n\t\t_isNodeExtendable[ENodeType.TRIGGERS] = false;\r\n\t\t_isNodeExtendable[ENodeType.TRIGGER] = true;\r\n\t\t_isNodeExtendable[ENodeType.EVENT] = false;\r\n\t\t_isNodeExtendable[ENodeType.CONCURRENCY] = false;\r\n\t\t_isNodeExtendable[ENodeType.ID] = false;\r\n\t\t_isNodeExtendable[ENodeType.SPACE] = true;\r\n\t\t_isNodeExtendable[ENodeType.STATE] = true;\r\n\t\t_isNodeExtendable[ENodeType.STATES] = false;\r\n\t\t_isNodeExtendable[ENodeType.TYPE] = false;\r\n\t\t_isNodeExtendable[ENodeType.VALUE] = false;\r\n\t\t_isNodeExtendable[ENodeType.EXTENDS] = false;\r\n\t}\r\n\t\r\n\tprivate function _initMergableNodesMap():Void\r\n\t{\r\n\t\t_isNodeMergable = new Map<ENodeType,Bool>();\r\n\t\t\r\n\t\t_isNodeMergable[ENodeType.ACTION] = false;\r\n\t\t_isNodeMergable[ENodeType.ACTIONS] = true;\r\n\t\t_isNodeMergable[ENodeType.ENTITIES] = true;\r\n\t\t_isNodeMergable[ENodeType.ENTITY] = false;\r\n\t\t_isNodeMergable[ENodeType.FORM] = true;\r\n\t\t_isNodeMergable[ENodeType.SCRIPTS] = true;\r\n\t\t_isNodeMergable[ENodeType.SCRIPT] = false;\r\n\t\t_isNodeMergable[ENodeType.GML] = false;\r\n\t\t_isNodeMergable[ENodeType.TRIGGERS] = true;\r\n\t\t_isNodeMergable[ENodeType.TRIGGER] = false;\r\n\t\t_isNodeMergable[ENodeType.EVENT] = false;\r\n\t\t_isNodeMergable[ENodeType.CONCURRENCY] = false;\r\n\t\t_isNodeMergable[ENodeType.ID] = false;\r\n\t\t_isNodeMergable[ENodeType.SPACE] = true;\r\n\t\t_isNodeMergable[ENodeType.STATE] = false;\r\n\t\t_isNodeMergable[ENodeType.STATES] = true;\r\n\t\t_isNodeMergable[ENodeType.TYPE] = false;\r\n\t\t_isNodeMergable[ENodeType.VALUE] = false;\r\n\t\t_isNodeMergable[ENodeType.EXTENDS] = false;\r\n\t}\r\n\t\r\n\tprivate function _initTargetMergableNodesMap():Void\r\n\t{\r\n\t\t_isNodeTargetMergable = new Map<ENodeType,Bool>();\r\n\t\t\r\n\t\t_isNodeTargetMergable[ENodeType.ACTION] = true;\r\n\t\t_isNodeTargetMergable[ENodeType.ACTIONS] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.ENTITIES] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.ENTITY] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.FORM] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.SCRIPTS] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.SCRIPT] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.GML] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.TRIGGERS] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.TRIGGER] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.EVENT] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.CONCURRENCY] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.ID] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.SPACE] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.STATE] = true;\r\n\t\t_isNodeTargetMergable[ENodeType.STATES] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.TYPE] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.VALUE] = false;\r\n\t\t_isNodeTargetMergable[ENodeType.EXTENDS] = false;\r\n\t}\r\n\t\r\n\tprivate function _initArrayNodesMap():Void\r\n\t{\r\n\t\t_isNodeArray = new Map<ENodeType,Bool>();\r\n\t\t\r\n\t\t_isNodeArray[ENodeType.ACTION] = false;\r\n\t\t_isNodeArray[ENodeType.ACTIONS] = true;\r\n\t\t_isNodeArray[ENodeType.ENTITIES] = true;\r\n\t\t_isNodeArray[ENodeType.ENTITY] = false;\r\n\t\t_isNodeArray[ENodeType.FORM] = false;\r\n\t\t_isNodeArray[ENodeType.SCRIPTS] = true;\r\n\t\t_isNodeArray[ENodeType.SCRIPT] = false;\r\n\t\t_isNodeArray[ENodeType.GML] = false;\r\n\t\t_isNodeArray[ENodeType.TRIGGERS] = true;\r\n\t\t_isNodeArray[ENodeType.TRIGGER] = false;\r\n\t\t_isNodeArray[ENodeType.EVENT] = false;\r\n\t\t_isNodeArray[ENodeType.CONCURRENCY] = false;\r\n\t\t_isNodeArray[ENodeType.ID] = false;\r\n\t\t_isNodeArray[ENodeType.SPACE] = false;\r\n\t\t_isNodeArray[ENodeType.STATE] = false;\r\n\t\t_isNodeArray[ENodeType.STATES] = true;\r\n\t\t_isNodeArray[ENodeType.TYPE] = false;\r\n\t\t_isNodeArray[ENodeType.VALUE] = false;\r\n\t\t_isNodeArray[ENodeType.EXTENDS] = true;\r\n\t}\r\n\r\n\tprivate function _initConcurrencyTypeToNameMap():Void\r\n\t{\r\n\t\t_xmlConcurrencyTypeToName = new Map<EConcurrencyType,String>();\r\n\t\t\r\n\t\t_xmlConcurrencyTypeToName[EConcurrencyType.PARALLEL] = \"Parallel\";\r\n\t\t_xmlConcurrencyTypeToName[EConcurrencyType.PERSISTENT] = \"Persistent\";\r\n\t\t_xmlConcurrencyTypeToName[EConcurrencyType.TRANSIENT] = \"Transient\";\r\n\t}\r\n\t\r\n\tprivate function _initConcurrencyNameToTypeMap():Void\r\n\t{\r\n\t\t_xmlConcurrencyNameToType = new Map<String,EConcurrencyType>();\r\n\t\t\r\n\t\t_xmlConcurrencyNameToType[_xmlConcurrencyTypeToName[EConcurrencyType.PARALLEL]] = EConcurrencyType.PARALLEL;\r\n\t\t_xmlConcurrencyNameToType[_xmlConcurrencyTypeToName[EConcurrencyType.PERSISTENT]] = EConcurrencyType.PERSISTENT;\r\n\t\t_xmlConcurrencyNameToType[_xmlConcurrencyTypeToName[EConcurrencyType.TRANSIENT]] = EConcurrencyType.TRANSIENT;\r\n\t}\r\n\t\r\n\tprivate function _initStateTypeToNameMap():Void\r\n\t{\r\n\t\t_xmlStateTypeToName = new Map<EStateType,String>();\r\n\t\t\r\n\t\t_xmlStateTypeToName[EStateType.DYNAMIC] = \"Dynamic\";\r\n\t\t_xmlStateTypeToName[EStateType.BOOLEAN] = \"Boolean\";\r\n\t\t_xmlStateTypeToName[EStateType.DECIMAL] = \"Decimal\";\r\n\t\t_xmlStateTypeToName[EStateType.INTEGER] = \"Integer\";\r\n\t\t_xmlStateTypeToName[EStateType.TEXT] = \"Text\";\r\n\t}\r\n\t\r\n\tprivate function _initStateNameToTypeMap():Void\r\n\t{\r\n\t\t_xmlStateNameToType = new Map<String,EStateType>();\r\n\t\t\r\n\t\t_xmlStateNameToType[_xmlStateTypeToName[EStateType.DYNAMIC]] = EStateType.DYNAMIC;\r\n\t\t_xmlStateNameToType[_xmlStateTypeToName[EStateType.BOOLEAN]] = EStateType.BOOLEAN;\r\n\t\t_xmlStateNameToType[_xmlStateTypeToName[EStateType.DECIMAL]] = EStateType.DECIMAL;\r\n\t\t_xmlStateNameToType[_xmlStateTypeToName[EStateType.INTEGER]] = EStateType.INTEGER;\r\n\t\t_xmlStateNameToType[_xmlStateTypeToName[EStateType.TEXT]] = EStateType.TEXT;\r\n\t}\r\n\t\r\n\tprivate function _initEventPrefabToNameMap():Void\r\n\t{\r\n\t\t_xmlEventPrefabToName = new Map<EEventPrefab,String>();\r\n\t\t\r\n\t\t_xmlEventPrefabToName[EEventPrefab.CREATED] = \"Created\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.UPDATE] = \"Update\";\r\n\t\t\r\n\t\t_xmlEventPrefabToName[EEventPrefab.NETWORK_CONNECTED] = \"NetworkConnected\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.NETWORK_REQUEST] = \"NetworkRequest\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.NETWORK_SERVER_EVENT] = \"NetworkServerEvent\";\r\n\t\t\r\n\t\t_xmlEventPrefabToName[EEventPrefab.FILETRANSFER_CONNECTED] = \"FileTransferConnected\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.FILETRANSFER_SENDREQUEST] = \"FileTransferRequest\";\r\n\t\t\r\n\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_LEFT_CLICK] = \"MouseLeftClick\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_RIGHT_CLICK] = \"MouseRightClick\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_LEFT_CLICKED] = \"MouseLeftClicked\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_RIGHT_CLICKED] = \"MouseRightClicked\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_ENTERED] = \"MouseEntered\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_MOVED] = \"MouseMoved\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_LEFT] = \"MouseLeft\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED] = \"KeyPressed\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED] = \"KeyReleased\";\r\n\t\t\t\t\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ALT] = \"KeyPressed_Alt\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_BACKSPACE] = \"KeyPressed_Backspace\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_CAPS_LOCK] = \"KeyPressed_Capslock\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_CONTROL] = \"KeyPressed_Control\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_DELETE] = \"KeyPressed_Delete\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_DOWN] = \"KeyPressed_Down\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_END] = \"KeyPressed_End\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ENTER] = \"KeyPressed_Enter\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ESCAPE] = \"KeyPressed_Escape\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F1] = \"KeyPressed_F1\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F10] = \"KeyPressed_F10\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F11] = \"KeyPressed_F11\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F12] = \"KeyPressed_F12\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F13] = \"KeyPressed_F13\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F14] = \"KeyPressed_F14\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F15] = \"KeyPressed_F15\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F2] = \"KeyPressed_F2\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F3] = \"KeyPressed_F3\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F4] = \"KeyPressed_F4\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F5] = \"KeyPressed_F5\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F6] = \"KeyPressed_F6\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F7] = \"KeyPressed_F7\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F8] = \"KeyPressed_F8\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F9] = \"KeyPressed_F9\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_HOME] = \"KeyPressed_Home\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_INSERT] = \"KeyPressed_Insert\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_LEFT] = \"KeyPressed_Left\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_0] = \"KeyPressed_Num0\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_1] = \"KeyPressed_Num1\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_2] = \"KeyPressed_Num2\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_3] = \"KeyPressed_Num3\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_4] = \"KeyPressed_Num4\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_5] = \"KeyPressed_Num5\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_6] = \"KeyPressed_Num6\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_7] = \"KeyPressed_Num7\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_8] = \"KeyPressed_Num8\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_9] = \"KeyPressed_Num9\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_ADD] = \"KeyPressed_Add\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_DECIMAL] = \"KeyPressed_Decimal\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_DIVIDE] = \"KeyPressed_Divide\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_ENTER] = \"KeyPressed_Enter\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_MULTIPLY] = \"KeyPressed_Multiply\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_SUBTRACT] = \"KeyPressed_Subtract\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_PAGE_DOWN] = \"KeyPressed_Pagedown\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_PAGE_UP] = \"KeyPressed_Pageup\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_RIGHT] = \"KeyPressed_Right\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_SHIFT] = \"KeyPressed_Shift\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_SPACE] = \"KeyPressed_Space\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_TAB] = \"KeyPressed_Tab\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_UP] = \"KeyPressed_Up\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_A] = \"KeyPressed_A\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_B] = \"KeyPressed_B\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_C] = \"KeyPressed_C\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_D] = \"KeyPressed_D\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_E] = \"KeyPressed_E\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F] = \"KeyPressed_F\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_G] = \"KeyPressed_G\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_H] = \"KeyPressed_H\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_I] = \"KeyPressed_I\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_J] = \"KeyPressed_J\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_K] = \"KeyPressed_K\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_L] = \"KeyPressed_L\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_M] = \"KeyPressed_M\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_N] = \"KeyPressed_N\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_O] = \"KeyPressed_O\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_P] = \"KeyPressed_P\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_Q] = \"KeyPressed_Q\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_R] = \"KeyPressed_R\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_S] = \"KeyPressed_S\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_T] = \"KeyPressed_T\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_U] = \"KeyPressed_U\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_V] = \"KeyPressed_V\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_W] = \"KeyPressed_W\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_X] = \"KeyPressed_X\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_Y] = \"KeyPressed_Y\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_Z] = \"KeyPressed_Z\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_0] = \"KeyPressed_0\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_1] = \"KeyPressed_1\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_2] = \"KeyPressed_2\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_3] = \"KeyPressed_3\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_4] = \"KeyPressed_4\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_5] = \"KeyPressed_5\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_6] = \"KeyPressed_6\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_7] = \"KeyPressed_7\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_8] = \"KeyPressed_8\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_9] = \"KeyPressed_9\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_EQUALS] = \"KeyPressed_Equals\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_SLASH] = \"KeyPressed_Slash\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_BACKSLASH] = \"KeyPressed_Backslash\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_LEFTBRACKET] = \"KeyPressed_LeftBracket\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_RIGHTBRACKET] = \"KeyPressed_RightBracket\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_BACKQUOTE] = \"KeyPressed_Backquote\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_COMMA] = \"KeyPressed_Comma\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_COMMAND] = \"KeyPressed_Command\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_MINUS] = \"KeyPressed_Minus\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_PERIOD] = \"KeyPressed_Period\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_QUOTE] = \"KeyPressed_Quote\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_SEMICOLON] = \"KeyPressed_Semicolon\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ANDROIDMENU] = \"KeyPressed_AndroidMenu\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ANDROIDSEARCH] = \"KeyPressed_AndroidSearch\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_UNKNOWN] = \"KeyPressed_Unknown\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ALT] = \"KeyReleased_Alt\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_BACKSPACE] = \"KeyReleased_Backspace\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_CAPS_LOCK] = \"KeyReleased_Capslock\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_CONTROL] = \"KeyReleased_Control\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_DELETE] = \"KeyReleased_Delete\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_DOWN] = \"KeyReleased_Down\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_END] = \"KeyReleased_End\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ENTER] = \"KeyReleased_Enter\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ESCAPE] = \"KeyReleased_Escape\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F1] = \"KeyReleased_F1\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F10] = \"KeyReleased_F10\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F11] = \"KeyReleased_F11\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F12] = \"KeyReleased_F12\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F13] = \"KeyReleased_F13\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F14] = \"KeyReleased_F14\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F15] = \"KeyReleased_F15\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F2] = \"KeyReleased_F2\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F3] = \"KeyReleased_F3\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F4] = \"KeyReleased_F4\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F5] = \"KeyReleased_F5\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F6] = \"KeyReleased_F6\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F7] = \"KeyReleased_F7\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F8] = \"KeyReleased_F8\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F9] = \"KeyReleased_F9\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_HOME] = \"KeyReleased_Home\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_INSERT] = \"KeyReleased_Insert\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_LEFT] = \"KeyReleased_Left\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_0] = \"KeyReleased_Num0\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_1] = \"KeyReleased_Num1\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_2] = \"KeyReleased_Num2\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_3] = \"KeyReleased_Num3\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_4] = \"KeyReleased_Num4\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_5] = \"KeyReleased_Num5\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_6] = \"KeyReleased_Num6\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_7] = \"KeyReleased_Num7\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_8] = \"KeyReleased_Num8\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_9] = \"KeyReleased_Num9\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_ADD] = \"KeyReleased_Add\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_DECIMAL] = \"KeyReleased_Decimal\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_DIVIDE] = \"KeyReleased_Divide\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_ENTER] = \"KeyReleased_Enter\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_MULTIPLY] = \"KeyReleased_Multiply\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_SUBTRACT] = \"KeyReleased_Subtract\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_PAGE_DOWN] = \"KeyReleased_Pagedown\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_PAGE_UP] = \"KeyReleased_Pageup\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_RIGHT] = \"KeyReleased_Right\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_SHIFT] = \"KeyReleased_Shift\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_SPACE] = \"KeyReleased_Space\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_TAB] = \"KeyReleased_Tab\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_UP] = \"KeyReleased_Up\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_A] = \"KeyReleased_A\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_B] = \"KeyReleased_B\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_C] = \"KeyReleased_C\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_D] = \"KeyReleased_D\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_E] = \"KeyReleased_E\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F] = \"KeyReleased_F\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_G] = \"KeyReleased_G\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_H] = \"KeyReleased_H\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_I] = \"KeyReleased_I\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_J] = \"KeyReleased_J\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_K] = \"KeyReleased_K\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_L] = \"KeyReleased_L\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_M] = \"KeyReleased_M\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_N] = \"KeyReleased_N\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_O] = \"KeyReleased_O\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_P] = \"KeyReleased_P\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_Q] = \"KeyReleased_Q\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_R] = \"KeyReleased_R\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_S] = \"KeyReleased_S\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_T] = \"KeyReleased_T\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_U] = \"KeyReleased_U\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_V] = \"KeyReleased_V\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_W] = \"KeyReleased_W\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_X] = \"KeyReleased_X\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_Y] = \"KeyReleased_Y\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_Z] = \"KeyReleased_Z\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_0] = \"KeyReleased_0\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_1] = \"KeyReleased_1\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_2] = \"KeyReleased_2\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_3] = \"KeyReleased_3\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_4] = \"KeyReleased_4\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_5] = \"KeyReleased_5\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_6] = \"KeyReleased_6\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_7] = \"KeyReleased_7\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_8] = \"KeyReleased_8\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_9] = \"KeyReleased_9\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_EQUALS] = \"KeyReleased_Equals\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_SLASH] = \"KeyReleased_Slash\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_BACKSLASH] = \"KeyReleased_Backslash\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_LEFTBRACKET] = \"KeyReleased_LeftBracket\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_RIGHTBRACKET] = \"KeyReleased_RightBracket\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_BACKQUOTE] = \"KeyReleased_Backquote\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_COMMA] = \"KeyReleased_Comma\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_COMMAND] = \"KeyReleased_Command\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_MINUS] = \"KeyReleased_Minus\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_PERIOD] = \"KeyReleased_Period\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_QUOTE] = \"KeyReleased_Quote\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_SEMICOLON] = \"KeyReleased_Semicolon\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ANDROIDMENU] = \"KeyReleased_AndroidMenu\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ANDROIDSEARCH] = \"KeyReleased_AndroidSearch\";\r\n\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_UNKNOWN] = \"KeyReleased_Unknown\";\r\n\t}\r\n\t\r\n\tprivate function _initEventNameToPrefabMap():Void\r\n\t{\r\n\t\t_xmlEventNameToPrefab = new Map<String,EEventPrefab>();\r\n\t\t\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.CREATED]] = EEventPrefab.CREATED;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.UPDATE]] = EEventPrefab.UPDATE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.NETWORK_CONNECTED]] = EEventPrefab.NETWORK_CONNECTED;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.NETWORK_REQUEST]] = EEventPrefab.NETWORK_REQUEST;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.NETWORK_SERVER_EVENT]] = EEventPrefab.NETWORK_SERVER_EVENT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.FILETRANSFER_CONNECTED]] = EEventPrefab.FILETRANSFER_CONNECTED;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.FILETRANSFER_SENDREQUEST]] = EEventPrefab.FILETRANSFER_SENDREQUEST;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.MOUSE_LEFT_CLICK]] = EEventPrefab.MOUSE_LEFT_CLICK;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.MOUSE_RIGHT_CLICK]] = EEventPrefab.MOUSE_RIGHT_CLICK;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.MOUSE_LEFT_CLICKED]] = EEventPrefab.MOUSE_LEFT_CLICKED;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.MOUSE_RIGHT_CLICKED]] = EEventPrefab.MOUSE_RIGHT_CLICKED;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.MOUSE_ENTERED]] = EEventPrefab.MOUSE_ENTERED;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.MOUSE_MOVED]] = EEventPrefab.MOUSE_MOVED;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.MOUSE_LEFT]] = EEventPrefab.MOUSE_LEFT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED]] = EEventPrefab.KEY_PRESSED;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED]] = EEventPrefab.KEY_RELEASED;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ALT]] = EEventPrefab.KEY_PRESSED_ALT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_BACKSPACE]] = EEventPrefab.KEY_PRESSED_BACKSPACE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_CAPS_LOCK]] = EEventPrefab.KEY_PRESSED_CAPS_LOCK;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_CONTROL]] = EEventPrefab.KEY_PRESSED_CONTROL;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_DELETE]] = EEventPrefab.KEY_PRESSED_DELETE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_DOWN]] = EEventPrefab.KEY_PRESSED_DOWN;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_END]] = EEventPrefab.KEY_PRESSED_END;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ENTER]] = EEventPrefab.KEY_PRESSED_ENTER;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ESCAPE]] = EEventPrefab.KEY_PRESSED_ESCAPE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F1]] = EEventPrefab.KEY_PRESSED_F1;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F10]] = EEventPrefab.KEY_PRESSED_F10;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F11]] = EEventPrefab.KEY_PRESSED_F11;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F12]] = EEventPrefab.KEY_PRESSED_F12;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F13]] = EEventPrefab.KEY_PRESSED_F13;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F14]] = EEventPrefab.KEY_PRESSED_F14;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F15]] = EEventPrefab.KEY_PRESSED_F15;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F2]] = EEventPrefab.KEY_PRESSED_F2;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F3]] = EEventPrefab.KEY_PRESSED_F3;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F4]] = EEventPrefab.KEY_PRESSED_F4;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F5]] = EEventPrefab.KEY_PRESSED_F5;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F6]] = EEventPrefab.KEY_PRESSED_F6;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F7]] = EEventPrefab.KEY_PRESSED_F7;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F8]] = EEventPrefab.KEY_PRESSED_F8;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F9]] = EEventPrefab.KEY_PRESSED_F9;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_HOME]] = EEventPrefab.KEY_PRESSED_HOME;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_INSERT]] = EEventPrefab.KEY_PRESSED_INSERT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_LEFT]] = EEventPrefab.KEY_PRESSED_LEFT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_0]] = EEventPrefab.KEY_PRESSED_NUMPAD_0;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_1]] = EEventPrefab.KEY_PRESSED_NUMPAD_1;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_2]] = EEventPrefab.KEY_PRESSED_NUMPAD_2;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_3]] = EEventPrefab.KEY_PRESSED_NUMPAD_3;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_4]] = EEventPrefab.KEY_PRESSED_NUMPAD_4;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_5]] = EEventPrefab.KEY_PRESSED_NUMPAD_5;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_6]] = EEventPrefab.KEY_PRESSED_NUMPAD_6;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_7]] = EEventPrefab.KEY_PRESSED_NUMPAD_7;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_8]] = EEventPrefab.KEY_PRESSED_NUMPAD_8;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_9]] = EEventPrefab.KEY_PRESSED_NUMPAD_9;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_ADD]] = EEventPrefab.KEY_PRESSED_NUMPAD_ADD;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_DECIMAL]] = EEventPrefab.KEY_PRESSED_NUMPAD_DECIMAL;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_DIVIDE]] = EEventPrefab.KEY_PRESSED_NUMPAD_DIVIDE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_ENTER]] = EEventPrefab.KEY_PRESSED_NUMPAD_ENTER;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_MULTIPLY]] = EEventPrefab.KEY_PRESSED_NUMPAD_MULTIPLY;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_SUBTRACT]] = EEventPrefab.KEY_PRESSED_NUMPAD_SUBTRACT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_PAGE_DOWN]] = EEventPrefab.KEY_PRESSED_PAGE_DOWN;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_PAGE_UP]] = EEventPrefab.KEY_PRESSED_PAGE_UP;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_RIGHT]] = EEventPrefab.KEY_PRESSED_RIGHT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_SHIFT]] = EEventPrefab.KEY_PRESSED_SHIFT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_SPACE]] = EEventPrefab.KEY_PRESSED_SPACE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_TAB]] = EEventPrefab.KEY_PRESSED_TAB;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_UP]] = EEventPrefab.KEY_PRESSED_UP;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_A]] = EEventPrefab.KEY_PRESSED_A;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_B]] = EEventPrefab.KEY_PRESSED_B;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_C]] = EEventPrefab.KEY_PRESSED_C;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_D]] = EEventPrefab.KEY_PRESSED_D;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_E]] = EEventPrefab.KEY_PRESSED_E;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F]] = EEventPrefab.KEY_PRESSED_F;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_G]] = EEventPrefab.KEY_PRESSED_G;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_H]] = EEventPrefab.KEY_PRESSED_H;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_I]] = EEventPrefab.KEY_PRESSED_I;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_J]] = EEventPrefab.KEY_PRESSED_J;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_K]] = EEventPrefab.KEY_PRESSED_K;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_L]] = EEventPrefab.KEY_PRESSED_L;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_M]] = EEventPrefab.KEY_PRESSED_M;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_N]] = EEventPrefab.KEY_PRESSED_N;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_O]] = EEventPrefab.KEY_PRESSED_O;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_P]] = EEventPrefab.KEY_PRESSED_P;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_Q]] = EEventPrefab.KEY_PRESSED_Q;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_R]] = EEventPrefab.KEY_PRESSED_R;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_S]] = EEventPrefab.KEY_PRESSED_S;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_T]] = EEventPrefab.KEY_PRESSED_T;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_U]] = EEventPrefab.KEY_PRESSED_U;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_V]] = EEventPrefab.KEY_PRESSED_V;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_W]] = EEventPrefab.KEY_PRESSED_W;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_X]] = EEventPrefab.KEY_PRESSED_X;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_Y]] = EEventPrefab.KEY_PRESSED_Y;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_Z]] = EEventPrefab.KEY_PRESSED_Z;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_0]] = EEventPrefab.KEY_PRESSED_NUMBER_0;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_1]] = EEventPrefab.KEY_PRESSED_NUMBER_1;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_2]] = EEventPrefab.KEY_PRESSED_NUMBER_2;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_3]] = EEventPrefab.KEY_PRESSED_NUMBER_3;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_4]] = EEventPrefab.KEY_PRESSED_NUMBER_4;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_5]] = EEventPrefab.KEY_PRESSED_NUMBER_5;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_6]] = EEventPrefab.KEY_PRESSED_NUMBER_6;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_7]] = EEventPrefab.KEY_PRESSED_NUMBER_7;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_8]] = EEventPrefab.KEY_PRESSED_NUMBER_8;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_9]] = EEventPrefab.KEY_PRESSED_NUMBER_9;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_EQUALS]] = EEventPrefab.KEY_PRESSED_EQUALS;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_SLASH]] = EEventPrefab.KEY_PRESSED_SLASH;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_BACKSLASH]] = EEventPrefab.KEY_PRESSED_BACKSLASH;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_LEFTBRACKET]] = EEventPrefab.KEY_PRESSED_LEFTBRACKET;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_RIGHTBRACKET]] = EEventPrefab.KEY_PRESSED_RIGHTBRACKET;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_BACKQUOTE]] = EEventPrefab.KEY_PRESSED_BACKQUOTE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_COMMA]] = EEventPrefab.KEY_PRESSED_COMMA;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_COMMAND]] = EEventPrefab.KEY_PRESSED_COMMAND;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_MINUS]] = EEventPrefab.KEY_PRESSED_MINUS;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_PERIOD]] = EEventPrefab.KEY_PRESSED_PERIOD;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_QUOTE]] = EEventPrefab.KEY_PRESSED_QUOTE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_SEMICOLON]] = EEventPrefab.KEY_PRESSED_SEMICOLON;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ANDROIDMENU]] = EEventPrefab.KEY_PRESSED_ANDROIDMENU;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ANDROIDSEARCH]] = EEventPrefab.KEY_PRESSED_ANDROIDSEARCH;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_UNKNOWN]] = EEventPrefab.KEY_PRESSED_UNKNOWN;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ALT]] = EEventPrefab.KEY_RELEASED_ALT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_BACKSPACE]] = EEventPrefab.KEY_RELEASED_BACKSPACE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_CAPS_LOCK]] = EEventPrefab.KEY_RELEASED_CAPS_LOCK;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_CONTROL]] = EEventPrefab.KEY_RELEASED_CONTROL;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_DELETE]] = EEventPrefab.KEY_RELEASED_DELETE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_DOWN]] = EEventPrefab.KEY_RELEASED_DOWN;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_END]] = EEventPrefab.KEY_RELEASED_END;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ENTER]] = EEventPrefab.KEY_RELEASED_ENTER;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ESCAPE]] = EEventPrefab.KEY_RELEASED_ESCAPE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F1]] = EEventPrefab.KEY_RELEASED_F1;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F10]] = EEventPrefab.KEY_RELEASED_F10;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F11]] = EEventPrefab.KEY_RELEASED_F11;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F12]] = EEventPrefab.KEY_RELEASED_F12;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F13]] = EEventPrefab.KEY_RELEASED_F13;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F14]] = EEventPrefab.KEY_RELEASED_F14;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F15]] = EEventPrefab.KEY_RELEASED_F15;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F2]] = EEventPrefab.KEY_RELEASED_F2;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F3]] = EEventPrefab.KEY_RELEASED_F3;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F4]] = EEventPrefab.KEY_RELEASED_F4;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F5]] = EEventPrefab.KEY_RELEASED_F5;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F6]] = EEventPrefab.KEY_RELEASED_F6;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F7]] = EEventPrefab.KEY_RELEASED_F7;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F8]] = EEventPrefab.KEY_RELEASED_F8;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F9]] = EEventPrefab.KEY_RELEASED_F9;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_HOME]] = EEventPrefab.KEY_RELEASED_HOME;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_INSERT]] = EEventPrefab.KEY_RELEASED_INSERT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_LEFT]] = EEventPrefab.KEY_RELEASED_LEFT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_0]] = EEventPrefab.KEY_RELEASED_NUMPAD_0;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_1]] = EEventPrefab.KEY_RELEASED_NUMPAD_1;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_2]] = EEventPrefab.KEY_RELEASED_NUMPAD_2;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_3]] = EEventPrefab.KEY_RELEASED_NUMPAD_3;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_4]] = EEventPrefab.KEY_RELEASED_NUMPAD_4;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_5]] = EEventPrefab.KEY_RELEASED_NUMPAD_5;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_6]] = EEventPrefab.KEY_RELEASED_NUMPAD_6;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_7]] = EEventPrefab.KEY_RELEASED_NUMPAD_7;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_8]] = EEventPrefab.KEY_RELEASED_NUMPAD_8;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_9]] = EEventPrefab.KEY_RELEASED_NUMPAD_9;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_ADD]] = EEventPrefab.KEY_RELEASED_NUMPAD_ADD;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_DECIMAL]] = EEventPrefab.KEY_RELEASED_NUMPAD_DECIMAL;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_DIVIDE]] = EEventPrefab.KEY_RELEASED_NUMPAD_DIVIDE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_ENTER]] = EEventPrefab.KEY_RELEASED_NUMPAD_ENTER;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_MULTIPLY]] = EEventPrefab.KEY_RELEASED_NUMPAD_MULTIPLY;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_SUBTRACT]] = EEventPrefab.KEY_RELEASED_NUMPAD_SUBTRACT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_PAGE_DOWN]] = EEventPrefab.KEY_RELEASED_PAGE_DOWN;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_PAGE_UP]] = EEventPrefab.KEY_RELEASED_PAGE_UP;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_RIGHT]] = EEventPrefab.KEY_RELEASED_RIGHT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_SHIFT]] = EEventPrefab.KEY_RELEASED_SHIFT;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_SPACE]] = EEventPrefab.KEY_RELEASED_SPACE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_TAB]] = EEventPrefab.KEY_RELEASED_TAB;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_UP]] = EEventPrefab.KEY_RELEASED_UP;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_A]] = EEventPrefab.KEY_RELEASED_A;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_B]] = EEventPrefab.KEY_RELEASED_B;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_C]] = EEventPrefab.KEY_RELEASED_C;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_D]] = EEventPrefab.KEY_RELEASED_D;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_E]] = EEventPrefab.KEY_RELEASED_E;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F]] = EEventPrefab.KEY_RELEASED_F;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_G]] = EEventPrefab.KEY_RELEASED_G;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_H]] = EEventPrefab.KEY_RELEASED_H;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_I]] = EEventPrefab.KEY_RELEASED_I;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_J]] = EEventPrefab.KEY_RELEASED_J;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_K]] = EEventPrefab.KEY_RELEASED_K;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_L]] = EEventPrefab.KEY_RELEASED_L;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_M]] = EEventPrefab.KEY_RELEASED_M;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_N]] = EEventPrefab.KEY_RELEASED_N;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_O]] = EEventPrefab.KEY_RELEASED_O;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_P]] = EEventPrefab.KEY_RELEASED_P;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_Q]] = EEventPrefab.KEY_RELEASED_Q;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_R]] = EEventPrefab.KEY_RELEASED_R;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_S]] = EEventPrefab.KEY_RELEASED_S;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_T]] = EEventPrefab.KEY_RELEASED_T;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_U]] = EEventPrefab.KEY_RELEASED_U;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_V]] = EEventPrefab.KEY_RELEASED_V;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_W]] = EEventPrefab.KEY_RELEASED_W;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_X]] = EEventPrefab.KEY_RELEASED_X;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_Y]] = EEventPrefab.KEY_RELEASED_Y;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_Z]] = EEventPrefab.KEY_RELEASED_Z;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_0]] = EEventPrefab.KEY_RELEASED_NUMBER_0;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_1]] = EEventPrefab.KEY_RELEASED_NUMBER_1;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_2]] = EEventPrefab.KEY_RELEASED_NUMBER_2;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_3]] = EEventPrefab.KEY_RELEASED_NUMBER_3;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_4]] = EEventPrefab.KEY_RELEASED_NUMBER_4;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_5]] = EEventPrefab.KEY_RELEASED_NUMBER_5;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_6]] = EEventPrefab.KEY_RELEASED_NUMBER_6;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_7]] = EEventPrefab.KEY_RELEASED_NUMBER_7;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_8]] = EEventPrefab.KEY_RELEASED_NUMBER_8;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_9]] = EEventPrefab.KEY_RELEASED_NUMBER_9;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_EQUALS]] = EEventPrefab.KEY_RELEASED_EQUALS;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_SLASH]] = EEventPrefab.KEY_RELEASED_SLASH;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_BACKSLASH]] = EEventPrefab.KEY_RELEASED_BACKSLASH;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_LEFTBRACKET]] = EEventPrefab.KEY_RELEASED_LEFTBRACKET;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_RIGHTBRACKET]] = EEventPrefab.KEY_RELEASED_RIGHTBRACKET;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_BACKQUOTE]] = EEventPrefab.KEY_RELEASED_BACKQUOTE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_COMMA]] = EEventPrefab.KEY_RELEASED_COMMA;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_COMMAND]] = EEventPrefab.KEY_RELEASED_COMMAND;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_MINUS]] = EEventPrefab.KEY_RELEASED_MINUS;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_PERIOD]] = EEventPrefab.KEY_RELEASED_PERIOD;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_QUOTE]] = EEventPrefab.KEY_RELEASED_QUOTE;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_SEMICOLON]] = EEventPrefab.KEY_RELEASED_SEMICOLON;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ANDROIDMENU]] = EEventPrefab.KEY_RELEASED_ANDROIDMENU;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ANDROIDSEARCH]] = EEventPrefab.KEY_RELEASED_ANDROIDSEARCH;\r\n\t\t_xmlEventNameToPrefab[_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_UNKNOWN]] = EEventPrefab.KEY_RELEASED_UNKNOWN;\r\n\t}\r\n\t\r\n\t\r\n\t//METHODS\r\n\t\r\n\t//Parser\r\n\tpublic function parseGameNode(p_gameNode:Xml):Bool\r\n\t{\r\n\t\t//extend\r\n\t\tConsole.info('Extending ' + p_gameNode.nodeName + ' Node...');\r\n\t\tif (_extendGameNode(p_gameNode))\r\n\t\t{\r\n\t\t\t//Display the full Node after extending it\r\n\t\t\t//Console.debug(p_gameNode.toString());\r\n\t\t\tConsole.info('Extending ' + p_gameNode.nodeName + ' Node COMPLETED');\r\n\t\t\t\r\n\t\t\t//merge\r\n\t\t\tConsole.info('Merging ' + p_gameNode.nodeName + ' Node...');\r\n\t\t\t_mergeGameNode(p_gameNode);\r\n\r\n\t\t\t//Display the full Node after merging it\r\n\t\t\t//Console.debug(p_gameNode.toString());\r\n\t\t\tConsole.info('Merging ' + p_gameNode.nodeName + ' Node COMPLETED');\r\n\t\t\t\r\n\t\t\t//Validate\r\n\t\t\tConsole.info('Validating ' + p_gameNode.nodeName + ' Node...');\r\n\t\t\tif (_validateGameNode(p_gameNode))\r\n\t\t\t{\r\n\t\t\t\t//Display the full Node after validating it\r\n\t\t\t\t//Console.debug(p_gameNode.toString());\r\n\t\t\t\tConsole.info('Validating ' + p_gameNode.nodeName + ' Node COMPLETED');\r\n\t\t\t\t\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tConsole.error('Game Entity could not be validated');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tConsole.error('Game Entity Class is not valid!');\r\n\t\t\t//Console.debug(p_gameNode);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t\r\n\t//Instantiators\r\n\tinline public function instantiateEntity(p_gameNode:Xml):IGameEntity {\r\n\t\treturn _gameClassInstantiator.instantiateEntity(p_gameNode);\r\n\t}\r\n\tinline public function instantiateForm(p_gameNode:Xml):IGameForm {\r\n\t\treturn _gameClassInstantiator.instantiateForm(p_gameNode);\r\n\t}\r\n\tinline public function instantiateSpace(p_gameNode:Xml):IGameSpace {\r\n\t\treturn _gameClassInstantiator.instantiateSpace(p_gameNode);\r\n\t}\r\n\tinline public function instantiateState(p_gameNode:Xml):IGameState {\r\n\t\treturn _gameClassInstantiator.instantiateState(p_gameNode);\r\n\t}\r\n\tinline public function instantiateAction(p_gameNode:Xml):IGameAction {\r\n\t\treturn _gameClassInstantiator.instantiateAction(p_gameNode);\r\n\t}\r\n\t\r\n\tinline public function instantiateTrigger(p_gameNode:Xml):IGameTrigger {\r\n\t\treturn _gameClassInstantiator.instantiateTrigger(p_gameNode);\r\n\t}\r\n\t\r\n\t//Deep parsing functions (most are called a lot so they're inlined)\r\n\t\r\n\t//@todo: instead of the whole Boolean system, use try/catch/throw for all functions, including _extendGameNode itself.or not? can I do it with thtrow/catch and still\r\n\t//keep the error messages that tell me what went wrong exactly and also have the code be more clear than with the nested ifs???\r\n\tprivate function _extendGameNode(p_gameNode:Xml):Bool\r\n\t{\r\n\t\t//Get Node Type\r\n\t\tvar l_gameNodeType:ENodeType;\r\n\t\t\r\n\t\t//If element is a mergeNode\r\n\t\tif (p_gameNode.nodeName.substr(0,_MERGEWIDTH) == _XMLNODEMODIFIER_MERGE)\r\n\t\t\tl_gameNodeType = _xmlNodeNameToNodeType[p_gameNode.nodeName.substr(_MERGEWIDTH)];\r\n\t\telse //if element is a clean node\r\n\t\t\tl_gameNodeType = _xmlNodeNameToNodeType[p_gameNode.nodeName];\r\n\t\t\r\n\t\tif (l_gameNodeType == null)\r\n\t\t{\r\n\t\t\tConsole.error('Unexpected Element: <' + p_gameNode.nodeName + '>');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//For all Elements\r\n\t\t\t//@todo: Catch infinite recursion if an entity contains itself in it's form space. or in other cases as well\r\n\t\t\tfor ( elt in p_gameNode.elements() ) \r\n\t\t\t{\r\n\t\t\t\tif (_extendGameNode(elt) == false)\r\n\t\t\t\t{\r\n\t\t\t\t\tConsole.error('Failed to parse node ' + elt.nodeName);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tif (_handleExtendsElement(p_gameNode, l_gameNodeType))\r\n\t\t\t{\r\n\t\t\t\tif (_handleExtendsAttribute(p_gameNode, l_gameNodeType))\r\n\t\t\t\t{\t\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tConsole.error('Failed to extend $l_gameNodeType node from the \"extends\" parameter.');\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tConsole.error('Failed to extend $l_gameNodeType node from the \"Extends\" tag.');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate function _handleExtendsElement(p_gameNode:Xml, p_nodeType:ENodeType):Bool\r\n\t{\r\n\t\tvar l_extendsElementFound:Bool = p_gameNode.elementsNamed(_XMLELEMENT_EXTENDS).hasNext();\r\n\t\t\r\n\t\tif (_isNodeExtendable[p_nodeType] && l_extendsElementFound)\r\n\t\t{ \r\n\t\t\tvar l_extendsElement:Xml = p_gameNode.elementsNamed(_XMLELEMENT_EXTENDS).next();\r\n\t\t\t\r\n\t\t\tvar l_extendsChildren:Array<Xml> = new Array<Xml>();\r\n\t\t\t\r\n\t\t\tfor(elt in l_extendsElement.elements())\r\n\t\t\t\tl_extendsChildren.insert(0,elt);    \r\n\t\t\t\r\n\t\t\tfor (elt in l_extendsChildren) \r\n\t\t\t{\r\n\t\t\t\tif (_xmlNodeTypeToNodeName[p_nodeType] == elt.nodeName)\r\n\t\t\t\t{\r\n\t\t\t\t\t//Move super's children to p_gameNode\r\n\t\t\t\t\t_moveChildren(p_gameNode, elt);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tConsole.error(\"Expected Node <\" + _xmlNodeTypeToNodeName[p_nodeType] + \">. Got <\" + elt.nodeName + \">.\");\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tp_gameNode.removeChild(l_extendsElement);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (l_extendsElementFound)\r\n\t\t\t{\r\n\t\t\t\tConsole.warn('Element $p_nodeType cannot be extended!');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tinline private function _handleExtendsAttribute(p_gameNode:Xml, p_nodeType:ENodeType):Bool\r\n\t{\r\n\t\tif (_isNodeExtendable[p_nodeType] && p_gameNode.exists(_XMLATTRIBUTE_EXTENDS))\r\n\t\t{ \r\n\t\t\t//Get the class from the embedded assets folder(preloaded)\r\n\t\t\tvar l_superNode:Xml = getGameNode(_xmlNodeTypeToGameType[p_nodeType], p_gameNode.get(_XMLATTRIBUTE_EXTENDS));\r\n\t\t\t\r\n\t\t\tp_gameNode.remove(_XMLATTRIBUTE_EXTENDS);\r\n\t\t\t\r\n\t\t\tif (l_superNode!=null)\r\n\t\t\t{\r\n\t\t\t\tif (_extendGameNode(l_superNode))\r\n\t\t\t\t{\r\n\t\t\t\t\t//Console.debug('Successful parsing of Super-Node ' + l_superNode.nodeName);\r\n\t\t\t\t\t\r\n\t\t\t\t\t//Move super's children to p_gameNode\r\n\t\t\t\t\t_moveChildren(p_gameNode, l_superNode);\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tConsole.error('$p_nodeType Class is not valid!');\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tConsole.error('$p_nodeType Class is not well-formed or not found!');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (p_gameNode.exists(_XMLATTRIBUTE_EXTENDS))\r\n\t\t\t{\r\n\t\t\t\tConsole.error('Element $p_nodeType cannot be extended!');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tinline private function _moveChildren(p_gameNode:Xml, p_superNode:Xml):Void\r\n\t{\r\n\t\t//Solution to html5 bug\r\n\t\tvar childrenArray:Array<Xml> = new Array<Xml>();\r\n\t\tfor (elt in p_superNode.elements())\r\n\t\t\tchildrenArray.push(elt);\r\n\t\t\r\n\t\t//For all Elements of supernode\r\n\t\tfor (elt in childrenArray)\r\n\t\t{\r\n\t\t\t//If a node with the same name does not exist in p_gameNode\r\n\t\t\tif (p_gameNode.elementsNamed(elt.nodeName).hasNext() == false)\r\n\t\t\t{\r\n\t\t\t\t//Move the node to p_gameNode\r\n\t\t\t\tp_gameNode.addChild(elt);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t//If element is a mergeNode\r\n\t\t\t\tif (elt.nodeName.substr(0,_MERGEWIDTH) == _XMLNODEMODIFIER_MERGE)\r\n\t\t\t\t{\r\n\t\t\t\t\t//Move the node at the top of p_gameNode's children\r\n\t\t\t\t\tp_gameNode.insertChild(elt, 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _validateGameNode(p_gameNode:Xml):Bool\r\n\t{\r\n\t\tvar l_gameNodeType:ENodeType = _xmlNodeNameToNodeType[p_gameNode.nodeName];\r\n\t\t\r\n\t\tif (_gameClassValidator.validateGameNode(p_gameNode, l_gameNodeType))\r\n\t\t{\r\n\t\t\t//For all Elements\r\n\t\t\t//@todo: Catch infinite recursion if an entity contains itself in it's form space. or in other cases as well\r\n\t\t\tfor ( elt in p_gameNode.elements() ) \r\n\t\t\t{\r\n\t\t\t\tif (_validateGameNode(elt) == false)\r\n\t\t\t\t{\r\n\t\t\t\t\tConsole.error('Failed to validate node ' + elt.nodeName);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tConsole.error('Failed to validate $l_gameNodeType node');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate function _mergeGameNode(p_gameNode:Xml):Void\r\n\t{\r\n\t\t_mergeSingleGameNode(p_gameNode);\r\n\r\n\t\t//For all Elements\r\n\t\t//@todo: Catch infinite recursion if an entity contains itself in it's form space. or in other cases as well\r\n\t\tfor ( elt in p_gameNode.elements() ) \r\n\t\t{\r\n\t\t\t_mergeGameNode(elt);\r\n\t\t}\r\n\t}\r\n\t\r\n\tinline private function _mergeSingleGameNode(p_gameNode:Xml):Void\r\n\t{\r\n\t\t//Solution to html5 bug\r\n\t\t//@TODO: maybe there's a better way to solve this. How about you just store the enumerable of p_gameNode instead of creating a new array. Small otpimization, but it IS the better solution\r\n\t\tvar childrenArray:Array<Xml> = new Array<Xml>();\r\n\t\tfor (elt in p_gameNode.elements())\r\n\t\t\tchildrenArray.push(elt);\r\n\t\t\t\r\n\t\t//For all Elements\r\n\t\tfor ( elt in childrenArray ) \r\n\t\t{\r\n\t\t\t//If element is a mergeNode\r\n\t\t\tif (elt.nodeName.substr(0,_MERGEWIDTH) == _XMLNODEMODIFIER_MERGE)\r\n\t\t\t{\r\n\t\t\t\t//Clean node name\r\n\t\t\t\tvar l_elementCleanNodeName:String = elt.nodeName.substr(_MERGEWIDTH);\r\n\t\t\t\t\r\n\t\t\t\t//If the element is a mergable node\r\n\t\t\t\tif (_isNodeMergable[_xmlNodeNameToNodeType[l_elementCleanNodeName]])\r\n\t\t\t\t{\r\n\t\t\t\t\t//If a clean corresponding node exists\r\n\t\t\t\t\tif (p_gameNode.elementsNamed(l_elementCleanNodeName).hasNext())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t//Get corresponding clean node\r\n\t\t\t\t\t\tvar l_cleanNode:Xml = p_gameNode.elementsNamed(l_elementCleanNodeName).next();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//Merge Children\r\n\t\t\t\t\t\t_mergeChildren(elt, l_cleanNode);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//Remove the empty merge node\r\n\t\t\t\t\t\tp_gameNode.removeChild(elt);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//If a clean corresponding clean node does not exist\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t//Rename merge node as a clean node\r\n\t\t\t\t\t\telt.nodeName = elt.nodeName.substr(_MERGEWIDTH);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t//If the element is a target-mergable node  (mergableNodes and target-mergableNodes are mutually exclusive. One can't be both!)\r\n\t\t\t\t\tif (_isNodeTargetMergable[_xmlNodeNameToNodeType[l_elementCleanNodeName]])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (elt.exists(_XMLATTRIBUTE_TARGETMERGE))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t//Look for the target clean Node\r\n\t\t\t\t\t\t\tvar l_cleanNode:Xml=null;\r\n\t\t\t\t\t\t\tvar l_targetNodeFound:Bool = false;\r\n\t\t\t\t\t\t\tfor (i_cleanNode in p_gameNode.elementsNamed(l_elementCleanNodeName))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tif (i_cleanNode.elementsNamed(_XMLELEMENT_TARGETMERGE).hasNext())\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tvar l_targetMergeElement:Xml = i_cleanNode.elementsNamed(_XMLELEMENT_TARGETMERGE).next();\r\n\t\t\t\t\t\t\t\t\tif (l_targetMergeElement.firstChild().nodeValue == elt.get(_XMLATTRIBUTE_TARGETMERGE))\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tl_cleanNode = i_cleanNode;\r\n\t\t\t\t\t\t\t\t\t\tl_targetNodeFound = true;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (l_targetNodeFound)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t//Merge Children\r\n\t\t\t\t\t\t\t\t_mergeChildren(elt, l_cleanNode);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t//Remove the empty merge node\r\n\t\t\t\t\t\t\t\tp_gameNode.removeChild(elt);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t//Rename merge node as a clean node\r\n\t\t\t\t\t\t\t\telt.nodeName = elt.nodeName.substr(_MERGEWIDTH);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t//@todo: maybe i should even create a target-merge-element IF one is not found? I'm inclining towards NO for now. Does't help, user will need to enter other\r\n\t\t\t\t\t\t\t\t\t//mandatory fields as well (ex. for State, he would need to enter the type element as well, which he probably wouldn't, so he might as well\r\n\t\t\t\t\t\t\t\t\t//enter the id element too. For Action he'd also need to enter the Concurrency element which he probably wouldn't).\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t//Remove the target-merge attribute\r\n\t\t\t\t\t\t\t\telt.remove(_XMLATTRIBUTE_TARGETMERGE);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tConsole.warn('Target-Mergable Element $l_elementCleanNodeName does not have a targetMerge attribute');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tConsole.warn('Non-mergable element $l_elementCleanNodeName has a merge identifier');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tinline private function _mergeChildren(mergeNode:Xml, cleanNode:Xml):Void\r\n\t{\r\n\t\t//Solution to html5 bug\r\n\t\tvar childrenArray:Array<Xml> = new Array<Xml>();\r\n\t\tfor (elt in mergeNode.elements())\r\n\t\t\tchildrenArray.push(elt);\r\n\t\t\t\r\n\t\t//If the element is an array node\r\n\t\tif (_isNodeArray[_xmlNodeNameToNodeType[cleanNode.nodeName]])\r\n\t\t{\r\n\t\t\t//Move children of merge node to the clean node\r\n\t\t\tfor ( mergeNodeChild in childrenArray )\r\n\t\t\t\tcleanNode.addChild(mergeNodeChild);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//Move children of merge node to the clean node\r\n\t\t\tfor ( mergeNodeChild in childrenArray ) \r\n\t\t\t{\r\n\t\t\t\tif (mergeNodeChild.nodeName.substr(0,_MERGEWIDTH) != _XMLNODEMODIFIER_MERGE) //If the child is clean\r\n\t\t\t\t\tif (cleanNode.elementsNamed(mergeNodeChild.nodeName).hasNext()) //If a clean child with that name already exists in the non-array clean node\r\n\t\t\t\t\t\tcleanNode.removeChild(cleanNode.elementsNamed(mergeNodeChild.nodeName).next()); //remove the clean child with the same name from the clean node\r\n\t\t\t\t\r\n\t\t\t\t//Move the child to cleanNode\r\n\t\t\t\tcleanNode.addChild(mergeNodeChild);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tinline private function _parseEmbeddedStringAsset(p_stringAssetUrl:String):Xml\r\n\t{\r\n\t\ttry \r\n\t\t{\r\n\t\t\treturn Xml.parse(Assets.getFile(p_stringAssetUrl).toString());\r\n\t\t}\r\n\t\tcatch (err:Dynamic) \r\n\t\t{\r\n\t\t\tConsole.error(Std.string(err));\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tinline private function _getClassUrl(p_gameEntityClassName:String, p_fileExtension:String):String\r\n\t{\r\n\t\treturn StringTools.replace(p_gameEntityClassName,\".\",\"/\") + \".\" + p_fileExtension;\r\n\t}\r\n\t\r\n\tinline public function getGameNode(p_expectedGameType:EGameType, ?p_gameClassName:String, ?p_gameClassNode:Xml):Xml\r\n\t{\r\n\t\tvar l_gameClassNode:Xml;\r\n\t\t\r\n\t\tif (p_gameClassName != null && p_gameClassNode != null)\r\n\t\t{\r\n\t\t\tConsole.warn('Both a game class name and a game class node have been specified to create a game class. Using game class node...');\r\n\t\t\tl_gameClassNode = p_gameClassNode;\r\n\t\t}\r\n\t\telse if (p_gameClassName != null)\r\n\t\t{\r\n\t\t\t//@todo: _the function below may throw an exception(no it won't). in this case, throw one here too, and a trace saying the class file is not well-formed. Also, return null.\r\n\t\t\tl_gameClassNode = _parseEmbeddedStringAsset(_getClassUrl(p_gameClassName, _xmlGameTypeToFileExtension[p_expectedGameType]));\r\n\r\n\t\t\tif (l_gameClassNode != null) l_gameClassNode = l_gameClassNode.firstElement();\r\n\t\t}\r\n\t\telse if (p_gameClassNode != null)\r\n\t\t{\r\n\t\t\tl_gameClassNode = p_gameClassNode;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tl_gameClassNode = Xml.createElement(_xmlGameTypeToNodeName[p_expectedGameType]);\r\n\t\t}\r\n\t\t\r\n\t\tif (l_gameClassNode != null)\r\n\t\t{\r\n\t\t\tif (l_gameClassNode.nodeName != _xmlGameTypeToNodeName[p_expectedGameType])\r\n\t\t\t{\r\n\t\t\t\tConsole.error('Expected ' + _xmlGameTypeToNodeName[p_expectedGameType] + ', got ' + l_gameClassNode.nodeName);\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\treturn l_gameClassNode;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tConsole.error('Class $p_expectedGameType is not well-formed or not found!');\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.gde.core;\r\nimport tools.spark.framework.haxe.LooseCheck;\r\nimport tools.spark.framework.haxe.LooseCheck.Filter;\r\nimport tools.spark.framework.haxe.LooseCheck.Rule;\r\nimport tools.spark.framework.haxe.LooseCheck.Rule.RList;\r\nimport tools.spark.framework.haxe.LooseCheck.Rule.RNode;\r\nimport tools.spark.framework.haxe.LooseCheck.Rule.RChoice;\r\nimport tools.spark.framework.haxe.LooseCheck.Rule.RData;\r\nimport tools.spark.framework.haxe.LooseCheck.Rule.RMulti;\r\nimport tools.spark.framework.haxe.LooseCheck.Rule.ROptional;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.ENodeType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EConcurrencyType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EStateType;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EEventPrefab;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameClassValidator;\r\n\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass GameClassValidator implements IGameClassValidator\r\n{\r\n\tprivate var _xmlNodeTypeToNodeName:Map<ENodeType,String>;\r\n\tprivate var _xmlNodeTypeToNodeRule:Map<ENodeType,Rule>;\r\n\tprivate var _xmlConcurrencyTypeToName:Map<EConcurrencyType,String>;\r\n\tprivate var _xmlStateTypeToName:Map<EStateType,String>;\r\n\tprivate var _xmlEventPrefabToName:Map<EEventPrefab,String>;\r\n\t\r\n\tpublic function new(p_xmlNodeTypeToNodeName:Map<ENodeType,String>, p_xmlConcurrencyTypeToName:Map<EConcurrencyType,String>, p_xmlStateTypeToName:Map<EStateType,String>, p_xmlEventPrefabToName:Map<EEventPrefab,String>) \r\n\t{\r\n\t\tConsole.log(\"Creating Game Class Validator\");\r\n\t\t_xmlNodeTypeToNodeName = p_xmlNodeTypeToNodeName;\r\n\t\t_xmlConcurrencyTypeToName = p_xmlConcurrencyTypeToName;\r\n\t\t_xmlStateTypeToName = p_xmlStateTypeToName;\r\n\t\t_xmlEventPrefabToName = p_xmlEventPrefabToName;\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\t_initNodeRulesMap();\r\n\t}\r\n\t\t\r\n\t\r\n\t\r\n\tprivate function _initNodeRulesMap():Void\r\n\t{\r\n\t\t_xmlNodeTypeToNodeRule = new Map<ENodeType,Rule>();\r\n\t\t\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.ACTION] = _createActionNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.ACTIONS] = _createActionsNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.ENTITIES] = _createEntitiesNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.ENTITY] = _createEntityNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.FORM] = _createFormNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.SCRIPTS] = _createScriptsNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.SCRIPT] = _createScriptNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.GML] = _createGmlNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.TRIGGERS] = _createTriggersNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.TRIGGER] = _createTriggerNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.EVENT] = _createEventNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.CONCURRENCY] = _createConcurrencyNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.ID] = _createIdNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.SPACE] = _createSpaceNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.STATE] = _createStateNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.STATES] = _createStatesNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.TYPE] = _createTypeNodeRule();\r\n\t\t_xmlNodeTypeToNodeRule[ENodeType.VALUE] = _createValueNodeRule();\r\n\t}\r\n\t\r\n\t\r\n\t//METHODS\r\n\t\r\n\tpublic inline function validateGameNode(p_gameNode:Xml, p_nodeType:ENodeType):Bool\r\n\t{\r\n\t\tif (_xmlNodeTypeToNodeRule[p_nodeType] == null)\r\n\t\t{\r\n\t\t\tConsole.error(\"This rule has not been created Yet!\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\ttry \r\n\t\t{\r\n\t\t\t//@warning: This works, but LooseCheck has bugs. Benefit of loose check, i get good error messages, since\r\n\t\t\t//i check every node individually. Bad things is attribute validation won't work properly, i broke it\r\n\t\t\t//when modifying haxe.Check. If you need attribute validation in the future, just remove LooseCheck\r\n\t\t\t//and use Haxe's original Check the same way I use it in framework.config (the proper way to use Check, not check\r\n\t\t\t//node by node.. But the problem was, I was getting too abstract error messages, so I had to recheck all nodes,\r\n\t\t\t//in order to get proper messages about where the fault in the xml is.\r\n\t\t\tLooseCheck.checkNode(p_gameNode, _xmlNodeTypeToNodeRule[p_nodeType]);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tcatch (m:String) \r\n\t\t{\r\n\t\t\tConsole.error(m);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t//XML RULES (Schema)\r\n\t\r\n\tinline private function _createEntityNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RList(\r\n\t\t\t[\r\n\t\t\t\tROptional(RNode(_xmlNodeTypeToNodeName[ENodeType.ACTIONS])),\r\n\t\t\t\tROptional(RNode(_xmlNodeTypeToNodeName[ENodeType.STATES])),\r\n\t\t\t\tROptional(RNode(_xmlNodeTypeToNodeName[ENodeType.TRIGGERS])),\r\n\t\t\t\tRNode(_xmlNodeTypeToNodeName[ENodeType.FORM])\r\n\t\t\t],\r\n\t\t\tfalse\r\n\t\t);\r\n\t\t\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.ENTITY], [], l_children);\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tinline private function _createFormNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RList(\r\n\t\t\t[\r\n\t\t\t\tROptional(RNode(_xmlNodeTypeToNodeName[ENodeType.STATES])),\r\n\t\t\t\tRNode(_xmlNodeTypeToNodeName[ENodeType.SPACE])\r\n\t\t\t],\r\n\t\t\tfalse\r\n\t\t);\r\n\t\t\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.FORM], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createStateNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RList(\r\n\t\t\t[\r\n\t\t\t\tRNode(_xmlNodeTypeToNodeName[ENodeType.ID]),\r\n\t\t\t\tRNode(_xmlNodeTypeToNodeName[ENodeType.TYPE]),\r\n\t\t\t\tRNode(_xmlNodeTypeToNodeName[ENodeType.VALUE])\r\n\t\t\t],\r\n\t\t\tfalse\r\n\t\t);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.STATE], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createActionNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RList(\r\n\t\t\t[\r\n\t\t\t\tRNode(_xmlNodeTypeToNodeName[ENodeType.ID]),\r\n\t\t\t\tRNode(_xmlNodeTypeToNodeName[ENodeType.CONCURRENCY]),\r\n\t\t\t\tRNode(_xmlNodeTypeToNodeName[ENodeType.SCRIPTS]),\r\n\t\t\t\tROptional(RNode(_xmlNodeTypeToNodeName[ENodeType.STATES]))\r\n\t\t\t],\r\n\t\t\tfalse\r\n\t\t);\r\n\t\t//@todo: GOAP: add rules for action's metadata. a StatesRule for requirement states and a StatesRule for affected states. smth like that....\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.ACTION], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createSpaceNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = ROptional(RNode(_xmlNodeTypeToNodeName[ENodeType.ENTITIES]));\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.SPACE], [], l_children);\r\n\t}\r\n\r\n\tinline private function _createEntitiesNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RMulti(RNode(_xmlNodeTypeToNodeName[ENodeType.ENTITY]), false);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.ENTITIES], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createStatesNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RMulti(RNode(_xmlNodeTypeToNodeName[ENodeType.STATE]), false);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.STATES], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createActionsNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RMulti(RNode(_xmlNodeTypeToNodeName[ENodeType.ACTION]), false);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.ACTIONS], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createIdNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.ID], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createScriptsNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RMulti(\r\n\t\t\t\tRChoice(\r\n\t\t\t\t[\r\n\t\t\t\t\tRNode(_xmlNodeTypeToNodeName[ENodeType.SCRIPT]),\r\n\t\t\t\t\tRNode(_xmlNodeTypeToNodeName[ENodeType.GML])\r\n\t\t\t\t]\r\n\t\t\t\t),\r\n\t\t\ttrue\r\n\t\t);\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.SCRIPTS], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createScriptNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.SCRIPT], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createGmlNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.GML], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createTriggersNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RMulti(RNode(_xmlNodeTypeToNodeName[ENodeType.TRIGGER]), false);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.TRIGGERS], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createTriggerNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RList(\r\n\t\t\t[\r\n\t\t\t\tRNode(_xmlNodeTypeToNodeName[ENodeType.EVENT]),\r\n\t\t\t\tRNode(_xmlNodeTypeToNodeName[ENodeType.SCRIPTS])\r\n\t\t\t],\r\n\t\t\tfalse\r\n\t\t);\r\n\t\t\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.TRIGGER], [], l_children);\r\n\t}\r\n\r\n\tinline private function _createConcurrencyNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData(FEnum([_xmlConcurrencyTypeToName[EConcurrencyType.PARALLEL],\r\n\t\t\t\t\t\t\t\t_xmlConcurrencyTypeToName[EConcurrencyType.PERSISTENT],\r\n\t\t\t\t\t\t\t\t_xmlConcurrencyTypeToName[EConcurrencyType.TRANSIENT]\r\n\t\t\t\t\t\t\t\t])\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.CONCURRENCY], [], l_children);\r\n\t}\r\n\t\r\n\r\n\tinline private function _createTypeNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData(FEnum([\r\n\t\t\t\t\t\t\t\t_xmlStateTypeToName[EStateType.DYNAMIC],\r\n\t\t\t\t\t\t\t\t_xmlStateTypeToName[EStateType.INTEGER],\r\n\t\t\t\t\t\t\t\t_xmlStateTypeToName[EStateType.DECIMAL],\r\n\t\t\t\t\t\t\t\t_xmlStateTypeToName[EStateType.BOOLEAN],\r\n\t\t\t\t\t\t\t\t_xmlStateTypeToName[EStateType.TEXT]\r\n\t\t\t\t\t\t\t\t])\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.TYPE], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createValueNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData();\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.VALUE], [], l_children);\r\n\t}\r\n\t\r\n\tinline private function _createEventNodeRule():Rule\r\n\t{\r\n\t\tvar l_children:Rule = RData(FEnum([\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.CREATED],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.UPDATE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.NETWORK_CONNECTED],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.NETWORK_REQUEST],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.NETWORK_SERVER_EVENT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.FILETRANSFER_CONNECTED],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.FILETRANSFER_SENDREQUEST],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_LEFT_CLICK],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_RIGHT_CLICK],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_LEFT_CLICKED],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_RIGHT_CLICKED],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_ENTERED],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_MOVED],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.MOUSE_LEFT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ALT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_BACKSPACE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_CAPS_LOCK],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_CONTROL],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_DELETE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_DOWN],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_END],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ENTER],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ESCAPE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F1],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F10],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F11],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F12],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F13],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F14],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F15],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F2],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F3],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F4],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F5],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F6],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F7],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F8],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F9],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_HOME],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_INSERT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_LEFT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_0],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_1],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_2],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_3],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_4],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_5],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_6],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_7],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_8],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_9],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_ADD],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_DECIMAL],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_DIVIDE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_ENTER],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_MULTIPLY],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMPAD_SUBTRACT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_PAGE_DOWN],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_PAGE_UP],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_RIGHT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_SHIFT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_SPACE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_TAB],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_UP],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_A],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_B],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_C],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_D],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_E],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_F],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_G],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_H],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_I],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_J],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_K],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_L],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_M],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_N],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_O],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_P],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_Q],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_R],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_S],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_T],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_U],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_V],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_W],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_X],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_Y],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_Z],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_0],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_1],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_2],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_3],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_4],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_5],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_6],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_7],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_8],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_NUMBER_9],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_EQUALS],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_SLASH],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_BACKSLASH],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_LEFTBRACKET],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_RIGHTBRACKET],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_BACKQUOTE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_COMMA],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_COMMAND],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_MINUS],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_PERIOD],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_QUOTE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_SEMICOLON],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ANDROIDMENU],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_ANDROIDSEARCH],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_PRESSED_UNKNOWN],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ALT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_BACKSPACE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_CAPS_LOCK],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_CONTROL],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_DELETE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_DOWN],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_END],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ENTER],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ESCAPE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F1],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F10],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F11],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F12],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F13],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F14],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F15],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F2],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F3],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F4],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F5],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F6],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F7],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F8],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F9],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_HOME],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_INSERT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_LEFT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_0],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_1],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_2],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_3],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_4],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_5],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_6],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_7],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_8],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_9],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_ADD],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_DECIMAL],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_DIVIDE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_ENTER],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_MULTIPLY],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMPAD_SUBTRACT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_PAGE_DOWN],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_PAGE_UP],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_RIGHT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_SHIFT],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_SPACE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_TAB],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_UP],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_A],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_B],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_C],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_D],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_E],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_F],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_G],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_H],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_I],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_J],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_K],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_L],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_M],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_N],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_O],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_P],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_Q],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_R],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_S],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_T],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_U],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_V],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_W],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_X],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_Y],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_Z],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_0],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_1],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_2],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_3],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_4],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_5],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_6],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_7],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_8],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_NUMBER_9],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_EQUALS],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_SLASH],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_BACKSLASH],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_LEFTBRACKET],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_RIGHTBRACKET],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_BACKQUOTE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_COMMA],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_COMMAND],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_MINUS],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_PERIOD],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_QUOTE],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_SEMICOLON],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ANDROIDMENU],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_ANDROIDSEARCH],\r\n\t\t\t\t\t\t\t\t_xmlEventPrefabToName[EEventPrefab.KEY_RELEASED_UNKNOWN]\r\n\t\t\t\t\t\t\t\t])\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\treturn RNode(_xmlNodeTypeToNodeName[ENodeType.EVENT], [], l_children);\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.gde.core;\r\nimport tools.spark.sliced.core.Sliced;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameState;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameAction;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EConcurrencyType;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass GameEntity extends AGameBase implements IGameEntity\r\n{\r\n\t//Properties\r\n\t\r\n\tpublic var gameStateSet( default, null ):Map<String,IGameState>;\r\n\tpublic var gameForm( default, default ):IGameForm;\r\n\tpublic var possibleActionSet( default, null ):Map<String,IGameAction>;\r\n\tpublic var currentActionSet( default, null ):Map < String, Array<IGameAction> > ;\r\n\tpublic var children ( get, never ):Array<IGameEntity>; \r\n\t\r\n\t//Constructor\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t//Console.log (\"Game Entity Created\");\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\t\r\n\t//Methods\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\tgameStateSet = new Map<String,IGameState>();\r\n\t\tpossibleActionSet = new Map<String,IGameAction>();\r\n\t\tcurrentActionSet = new Map<String,Array<IGameAction>>();\r\n\t}\r\n\t\r\n\tpublic function doActions():Void\r\n\t{\r\n\t\t//foreach Action A in my currentActions: A.doPass();\r\n\t\tfor ( actions in currentActionSet)\r\n\t\t\tfor (action in actions)\r\n\t\t\t\taction.doPass();\r\n\t\t\t\r\n\t\t//foreach Entity E in my LogicalSpace: E.doActions\r\n\t\tfor ( entity in gameForm.gameSpace.gameEntitySet)\r\n\t\t\tentity.doActions();\r\n\t}\r\n\t\r\n\tpublic function addState(gameState:IGameState):Void\r\n\t{\r\n\t\tif (gameStateSet[gameState.id] != null)\r\n\t\t\tConsole.warn('A State with id ' + gameState.id + ' already exists in this Entity.');\r\n\t\t\r\n\t\tgameStateSet[gameState.id] = gameState;\r\n\t}\r\n\t\r\n\tpublic function addAction(gameAction:IGameAction):Void\r\n\t{\r\n\t\tif (possibleActionSet[gameAction.id] != null)\r\n\t\t\tConsole.warn('An Action with id ' + gameAction.id + ' already exists in this Entity.');\r\n\t\telse\r\n\t\t\tcurrentActionSet[gameAction.id] = new Array<IGameAction>();\r\n\t\t\r\n\t\tpossibleActionSet[gameAction.id] = gameAction;\r\n\t}\r\n\t\r\n\tpublic function getAction(p_actionId:String):IGameAction\r\n\t{\r\n\t\treturn possibleActionSet.get(p_actionId);\r\n\t}\r\n\t\r\n\tpublic function startAction(actionId:String):Bool\r\n\t{\r\n\t\t//Get Action Object\r\n\t\tvar gameAction:IGameAction = possibleActionSet[actionId];\r\n\t\t\r\n\t\tif (gameAction != null)\r\n\t\t{\r\n\t\t\tswitch (gameAction.concurrency)\r\n\t\t\t{\r\n\t\t\t\tcase EConcurrencyType.PARALLEL:\r\n\t\t\t\t\tcurrentActionSet[gameAction.id].push(gameAction);\r\n\t\t\t\tcase EConcurrencyType.PERSISTENT:\r\n\t\t\t\t\tif (currentActionSet[gameAction.id].length == 0)\r\n\t\t\t\t\t\tcurrentActionSet[gameAction.id].push(gameAction);\r\n\t\t\t\tcase EConcurrencyType.TRANSIENT:\r\n\t\t\t\t\twhile (currentActionSet[gameAction.id].length > 0) currentActionSet[gameAction.id].pop();\r\n\t\t\t\t\tcurrentActionSet[gameAction.id].push(gameAction);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tConsole.warn(\"Action with id '\" + actionId + \"' could not be started.\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic function stopAction(actionId:String):Bool\r\n\t{\r\n\t\tif (currentActionSet.exists(actionId))\r\n\t\t{\r\n\t\t\twhile (currentActionSet[actionId].length > 0) currentActionSet[actionId].pop();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tConsole.warn(\"Action with id '\" + actionId + \"' could not be stopped.\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t\r\n\t// Set/Get State Value\r\n\tpublic function getState(p_stateId:String):Dynamic\r\n\t{\r\n\t\tif (gameStateSet.get(p_stateId) == null) return null;\r\n\t\telse return gameStateSet.get(p_stateId).value;\r\n\t}\r\n\t\r\n\tpublic function setState(p_stateId:String, p_value:Dynamic):Dynamic\r\n\t{\r\n\t\tgameStateSet.get(p_stateId).value = p_value;\r\n\t\t\r\n\t\t//Following line is the weak connection between Logic and Display\r\n\t\tSliced.display.updateDisplayObjectState(this,p_stateId);\t\r\n\t\t\r\n\t\treturn gameStateSet.get(p_stateId).value;\r\n\t}\r\n\t\r\n\tpublic function addChild(p_gameEntity:IGameEntity):Void\r\n\t{\r\n\t\t//Add to children\r\n\t\tchildren.push(p_gameEntity);\r\n\t\t\r\n\t\t//Set Parent to Child\r\n\t\tp_gameEntity.parentEntity = this;\r\n\t\t\r\n\t\t//Following line is the weak connection between Logic and Display\r\n\t\tSliced.display.addDisplayObjectChild(this,p_gameEntity);\r\n\t}\r\n\t\r\n\tpublic function getChildren():Array<IGameEntity>\r\n\t{\r\n\t\treturn children;\r\n\t}\r\n\t\r\n\tprivate function get_children()\r\n\t{\r\n\t\treturn gameForm.gameSpace.gameEntitySet;\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.gde.core;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameAction;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameClassParser;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameFactory;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameSpace;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameState;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EGameType;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\n@:keep class GameFactory implements IGameFactory\r\n{\r\n\tprivate var _gameClassParser:IGameClassParser;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tConsole.log(\"Creating Game Factory\");\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\t_gameClassParser = new GameClassParser();\r\n\t}\r\n\t\r\n\tpublic function createGameEntityExtended(p_gameClassName:String, p_extendGameClassName:String):IGameEntity\r\n\t{\r\n\t\tvar l_extendGameNode:Xml = _gameClassParser.getGameNode(EGameType.ENTITY, p_extendGameClassName);\r\n\t\t\r\n\t\tl_extendGameNode.set(GameClassParser._XMLATTRIBUTE_EXTENDS,p_gameClassName);\r\n\t\t\r\n\t\treturn createGameEntity(l_extendGameNode);\r\n\t}\r\n\t\r\n\tpublic function createGameEntity(?p_gameClassName:String, ?p_gameClassNode:Xml):IGameEntity\r\n\t{\r\n\t\t//Get the class from the embedded assets folder(preloaded)\r\n\t\tvar l_gameNode:Xml = _gameClassParser.getGameNode(EGameType.ENTITY, p_gameClassName, p_gameClassNode);\r\n\t\t\r\n\t\tif (l_gameNode!=null)\r\n\t\t{\r\n\t\t\tif (_gameClassParser.parseGameNode(l_gameNode))\r\n\t\t\t{\r\n\t\t\t\t//Instantiate Parsed Node\r\n\t\t\t\tvar l_gameEntity:IGameEntity = _gameClassParser.instantiateEntity(l_gameNode);\r\n\t\t\t\t\r\n\t\t\t\tif (l_gameEntity != null)\r\n\t\t\t\t{\r\n\t\t\t\t\t//Console.debug(l_gameNode.toString());\r\n\t\t\t\t\treturn l_gameEntity;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tConsole.error('Game Entity could not be instantiated');\r\n\t\t\t\t\treturn null;\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tConsole.error('Game Entity could not be parsed');\r\n\t\t\t\tConsole.debug(l_gameNode.toString());\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tConsole.error('Game Entity Class is not well-formed or not found!');\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.gde.core;\r\nimport tools.spark.sliced.core.Sliced;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameForm;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameState;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameSpace;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass GameForm extends AGameBase implements IGameForm\r\n{\r\n\t//Properties\r\n\t\r\n\tpublic var gameStateSet( default, null ):Map<String,IGameState>;\r\n\tpublic var gameSpace( default, default ):IGameSpace;\r\n\t\r\n\t\r\n\t//Constructor\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t//Console.log (\"Game Form Created\");\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\t\r\n\t//Methods\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\tgameStateSet = new Map<String,IGameState>();\r\n\t}\r\n\t\r\n\tpublic function addState(gameState:IGameState):Void\r\n\t{\r\n\t\tif (gameStateSet[gameState.id] != null)\r\n\t\t\tConsole.warn('A State with id ' + gameState.id + ' already exists in this Form.');\r\n\t\t\t\r\n\t\tgameStateSet[gameState.id] = gameState;\r\n\t}\r\n\t\r\n\t// Set/Get State Value\r\n\tpublic function getState(p_stateId:String):Dynamic\r\n\t{\r\n\t\tif (gameStateSet.get(p_stateId) == null) return null;\r\n\t\telse return gameStateSet.get(p_stateId).value;\r\n\t}\r\n\t\r\n\tpublic function setState(p_stateId:String, p_value:Dynamic):Dynamic\r\n\t{\r\n\t\tgameStateSet.get(p_stateId).value = p_value;\r\n\t\t\r\n\t\t/*  ****************************FORM STATE UPDATE DEPRECATED*************************\r\n\t\t//Following line is the weak connection between Logic and Display\r\n\t\tSliced.display.updateDisplayObjectFormState(this.parentEntity,p_stateId);\t\r\n\t\t*/\r\n\t\t\r\n\t\treturn gameStateSet.get(p_stateId).value;\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.gde.core;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameSpace;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass GameSpace extends AGameBase implements IGameSpace\r\n{\r\n\t//Properties\r\n\t\r\n\tpublic var gameEntitySet( default, null ):Array<IGameEntity>;\r\n\t\r\n\t\r\n\t//Constructor\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t//Console.log (\"Game Space Created\");\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\t\r\n\t//Methods\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\tgameEntitySet = new Array<IGameEntity>();\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.gde.core;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameState;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EStateType;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass GameState extends AGameBase implements IGameState\r\n{\r\n\t//Properties\r\n\tpublic var id( default, default ):String;\r\n\tpublic var type( default, default ):EStateType;\r\n\tpublic var value( default, default ):Dynamic;\r\n\t\r\n\t\r\n\t//Constructor\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t//Console.log (\"Game State Created\");\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\t\r\n\t//Methods\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.gde.core;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameTrigger;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.EEventPrefab;\r\nimport tools.spark.sliced.core.Sliced;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass GameTrigger extends AGameBase implements IGameTrigger\r\n{\r\n\t//Properties\r\n\tpublic var eventPrefab( default, default ):EEventPrefab;\r\n\tpublic var scriptSet( default, null ):Array<Int>;\r\n\t\r\n\t\r\n\t//Constructor\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t//Console.log (\"Game Trigger Created\");\r\n\t\t\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\tscriptSet = new Array<Int>();\r\n\t}\r\n\r\n\t\r\n\t//Methods\r\n\r\n\tpublic function doPass():Void\r\n\t{\r\n\t\tfor (hashId in scriptSet)\r\n\t\t{\r\n\t\t\t//if (Sliced.logic.interpreter.run(hashId) == false)\r\n\t\t\t\t//Console.warn('Trigger $event:HashId $hashId returned false');\r\n\t\t\tif (hashId == -1)\r\n\t\t\t{\r\n\t\t\t\tSliced.logic.gmlInterpreter.run(hashId, [ \"me\" => parentEntity, \"parent\" => parentEntity.parentEntity ]);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tSliced.logic.scriptInterpreter.run(hashId, [ \"me\"=>parentEntity, \"parent\"=>parentEntity.parentEntity ]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.interpreter.core;\r\nimport tools.spark.sliced.core.Sliced;\r\nimport tools.spark.sliced.services.std.logic.gde.interfaces.IGameEntity;\r\nimport flambe.input.Key;\r\nimport haxe.io.Bytes;\r\nimport haxe.crypto.Crc32;\r\nimport tools.spark.sliced.services.std.logic.interpreter.interfaces.IInterpreter;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass GmlInterpreter implements IInterpreter\r\n{\r\n\tprivate var _hashTable:Map<Int,String>;\r\n\t//private var _parser:Parser;\r\n\t//private var _interpreter:Interp;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tConsole.log(\"Init Gml Interpreter...\");\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\t_hashTable = new Map<Int,String>();\r\n\t\t\r\n\t\t//_parser =  new hscript.Parser();\r\n\t\t//_interpreter = new hscript.Interp();\r\n\t\t\r\n\t\t/*\r\n\t\t//Static variables\r\n\t\t_interpreter.variables.set(\"Game\", Sliced); // share the Game class\r\n\t\t_interpreter.variables.set(\"Sound\", Sliced.sound); // share the Sound class\r\n\t\t_interpreter.variables.set(\"Logic\", Sliced.logic); // share the Logic class\r\n\t\t_interpreter.variables.set(\"Input\", Sliced.input); // share the Input class\r\n\t\t_interpreter.variables.set(\"Comms\", Sliced.comms); // share the Comms class\r\n\t\t_interpreter.variables.set(\"Display\", Sliced.display); // share the Display class\r\n\t\t_interpreter.variables.set(\"Key\", Key); // share the Key enum\r\n\t\t_interpreter.variables.set(\"Console\", Console); // share the Console\r\n\t\t_interpreter.variables.set(\"Math\", Math); // share the Math\r\n\t\t_interpreter.variables.set(\"Std\", Std); // share the Std\r\n\t\t//_interpreter.variables.set(\"Int\", Int); // share the Int\r\n\t\t*/\r\n\t}\r\n\t\r\n\tpublic function run(hashId:Int, parameters:Map<String,Dynamic>):Bool\r\n\t{\r\n\t\t//@todo: V.EASY/IMPORTANT/ASAP: don't create a new parser and interpenter EVERY SINGLE TIME!!!!\r\n\t\t//Console.time(\"interpreting\");\r\n\t\t\r\n\t\t//@todo: PARSE EVERYTHING IN THE HASH ONCE AND STORE DUMMY!\r\n\t\tvar program:String = _get(hashId);\r\n\t\t\r\n\t\t/*\r\n\t\t//_interpreter = new hscript.Interp();\r\n\t\t//Static variables\r\n\t\t_interpreter.variables.set(\"Game\", Sliced); // share the Game class\r\n\t\t_interpreter.variables.set(\"Sound\", Sliced.sound); // share the Sound class\r\n\t\t_interpreter.variables.set(\"Logic\", Sliced.logic); // share the Logic class\r\n\t\t_interpreter.variables.set(\"Input\", Sliced.input); // share the Input class\r\n\t\t_interpreter.variables.set(\"Comms\", Sliced.comms); // share the Comms class\r\n\t\t_interpreter.variables.set(\"Display\", Sliced.display); // share the Display class\r\n\t\t_interpreter.variables.set(\"Key\", Key); // share the Key enum\r\n\t\t_interpreter.variables.set(\"Console\", Console); // share the Console\r\n\t\t_interpreter.variables.set(\"Math\", Math); // share the Math\r\n\t\t_interpreter.variables.set(\"Std\", Std); // share the Std\r\n\t\t//_interpreter.variables.set(\"Int\", Int); // share the Int\r\n\t\t\r\n\t\t//Dynamic Variables\r\n\t\tfor (varName in parameters.keys())\r\n\t\t{\r\n\t\t\t_interpreter.variables.set(varName, parameters[varName]);\r\n\t\t}\r\n\t\t*/\r\n\t\t//Console.timeEnd(\"interpreting\");\r\n\t\t//Console.warn(\"Interpenter Executing: \" + hashId);\r\n\t\t\r\n\t\t//return _interpreter.execute(program);\r\n\t\t_deleteMeCircleAround(parameters[\"me\"]);\r\n\t\t\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\tprivate function _deleteMeCircleAround(me:IGameEntity):Void\r\n\t{\r\n\t\tif (me.getState('std_object')!=null)\r\n\t\t{\r\n\t\t\tme.setState('std_x',me.getState('initX')+50*Math.cos(me.getState('rotationDegree')));\r\n\t\t\tme.getState('std_object').x=me.getState('std_x');\r\n\t\t\t\r\n\t\t\tme.setState('std_y',me.getState('initY')+50*Math.sin(me.getState('rotationDegree')));\r\n\t\t\tme.getState('std_object').y=me.getState('std_y');\r\n\t\t\t\r\n\t\t\tme.setState('rotationDegree',me.getState('rotationDegree')+0.1);\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tpublic function hash(script:String):Int\r\n\t{\r\n\t\t//return _store(_parser.parseString(script), Crc32.make(Bytes.ofString(script)));\r\n\t\treturn -1;\r\n\t}\r\n\t\r\n\t\r\n\tinline private function _get(hashId:Int):String\r\n\t{\r\n\t\treturn \"doTheCircle\";\r\n\t\t/*\r\n\t\tvar script:String = _hashTable[hashId];\r\n\t\t\r\n\t\tif (script == null)\r\n\t\t\tConsole.error('Script not found on address [$hashId]');\r\n\t\t\r\n\t\treturn script;\r\n\t\t*/\r\n\t}\r\n\t\r\n\tprivate function _store(script:String, hashId: Int):Int\r\n\t{\r\n\t\tif (_hashTable[hashId] != null)\r\n\t\t{\r\n\t\t\tif (Std.string(script) == Std.string(_hashTable[hashId]))\r\n\t\t\t{\r\n\t\t\t\tConsole.log('Same Script found: [$script] in hashId: [$hashId]');\r\n\t\t\t\treturn hashId;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tConsole.warn('Collision detected with hashId: [$hashId] and script [$script]. Previous Stored Entry Script: ' + _hashTable[hashId]);\r\n\t\t\t\treturn _store(script, ++hashId);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tConsole.log('Entering hashId: [$hashId] with Script: $script');\r\n\t\t\t_hashTable[hashId] = script;\r\n\t\t\treturn hashId;\r\n\t\t}\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.logic.interpreter.core;\r\nimport hscript.Interp;\r\nimport hscript.Parser;\r\nimport tools.spark.sliced.core.Sliced;\r\nimport flambe.input.Key;\r\nimport hscript.Expr;\r\nimport haxe.io.Bytes;\r\nimport haxe.crypto.Crc32;\r\nimport tools.spark.sliced.services.std.logic.interpreter.interfaces.IInterpreter;\r\nimport tools.spark.framework.Framework;\r\nimport tools.spark.framework.Assets;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass HaxeInterpreter implements IInterpreter\r\n{\r\n\tprivate var _hashTable:Map<Int,Expr>;\r\n\tprivate var _parser:Parser;\r\n\tprivate var _interpreter:Interp;\r\n\t\r\n\tpublic function new() \r\n\t{\r\n\t\tConsole.log(\"Init Haxe Interpreter...\");\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\t_hashTable = new Map<Int,Expr>();\r\n\t\t\r\n\t\t_parser =  new hscript.Parser();\r\n\t\t_interpreter = new hscript.Interp();\r\n\t\t\r\n\t\t//Static variables\r\n\t\t_interpreter.variables.set(\"Game\", Sliced); // share the Game class\r\n\t\t_interpreter.variables.set(\"Sound\", Sliced.sound); // share the Sound class\r\n\t\t_interpreter.variables.set(\"Logic\", Sliced.logic); // share the Logic class\r\n\t\t_interpreter.variables.set(\"Input\", Sliced.input); // share the Input class\r\n\t\t_interpreter.variables.set(\"Comms\", Sliced.comms); // share the Comms class\r\n\t\t_interpreter.variables.set(\"Display\", Sliced.display); // share the Display class\r\n\t\t_interpreter.variables.set(\"Key\", Key); // share the Key enum\r\n\t\t_interpreter.variables.set(\"Console\", Console); // share the Console\r\n\t\t_interpreter.variables.set(\"Math\", Math); // share the Math\r\n\t\t_interpreter.variables.set(\"Std\", Std); // share the Std\r\n\t\t_interpreter.variables.set(\"String\", String); // share the String\r\n\t\t//_interpreter.variables.set(\"Framework\", Framework); // share the Framework class\r\n\t\t_interpreter.variables.set(\"Assets\", Assets); // share the Assets class\r\n\t\t//_interpreter.variables.set(\"Int\", Int); // share the Int\r\n\t\t\r\n\t\t//so bad..\r\n\t\t#if html\r\n\t\t_interpreter.variables.set(\"XMLHttpRequest\", js.html.XMLHttpRequest); // share the XMLHttpRequest\r\n\t\t#end\r\n\t}\r\n\t\r\n\tpublic function run(hashId:Int, parameters:Map<String,Dynamic>):Bool\r\n\t{\r\n\t\t//@todo: V.EASY/IMPORTANT/ASAP: don't create a new parser and interpenter EVERY SINGLE TIME!!!!\r\n\t\t//Console.time(\"interpreting\");\r\n\t\t\r\n\t\t//@todo: PARSE EVERYTHING IN THE HASH ONCE AND STORE DUMMY!\r\n\t\tvar program:Expr = _get(hashId);\r\n\t\t\r\n\t\t\r\n\t\t//_interpreter = new hscript.Interp();\r\n\t\t//Static variables\r\n\t\t_interpreter.variables.set(\"Game\", Sliced); // share the Game class\r\n\t\t_interpreter.variables.set(\"Sound\", Sliced.sound); // share the Sound class\r\n\t\t_interpreter.variables.set(\"Logic\", Sliced.logic); // share the Logic class\r\n\t\t_interpreter.variables.set(\"Input\", Sliced.input); // share the Input class\r\n\t\t_interpreter.variables.set(\"Comms\", Sliced.comms); // share the Comms class\r\n\t\t_interpreter.variables.set(\"Display\", Sliced.display); // share the Display class\r\n\t\t_interpreter.variables.set(\"Key\", Key); // share the Key enum\r\n\t\t_interpreter.variables.set(\"Console\", Console); // share the Console\r\n\t\t_interpreter.variables.set(\"Math\", Math); // share the Math\r\n\t\t_interpreter.variables.set(\"Std\", Std); // share the Std\r\n\t\t_interpreter.variables.set(\"String\", String); // share the String\r\n\t\t//_interpreter.variables.set(\"Framework\", Framework); // share the Framework class\r\n\t\t_interpreter.variables.set(\"Assets\", Assets); // share the Assets class\r\n\t\t//_interpreter.variables.set(\"Int\", Int); // share the Int\r\n\r\n\t\t//so bad..\r\n\t\t#if html\r\n\t\t_interpreter.variables.set(\"XMLHttpRequest\", js.html.XMLHttpRequest); // share the XMLHttpRequest\r\n\t\t#end\r\n\t\t\r\n\t\t\r\n\t\t//Dynamic Variables\r\n\t\tfor (varName in parameters.keys())\r\n\t\t{\r\n\t\t\t_interpreter.variables.set(varName, parameters[varName]);\r\n\t\t}\r\n\t\t\r\n\t\t//Console.timeEnd(\"interpreting\");\r\n\t\t//Console.warn(\"Interpenter Executing: \" + hashId);\r\n\t\treturn _interpreter.execute(program);\r\n\t}\r\n\t\r\n\t\r\n\tpublic function hash(script:String):Int\r\n\t{\r\n\t\treturn _store(_parser.parseString(script), Crc32.make(Bytes.ofString(script)));\r\n\t}\r\n\t\r\n\t\r\n\tinline private function _get(hashId:Int):Expr\r\n\t{\r\n\t\tvar script:Expr = _hashTable[hashId];\r\n\t\t\r\n\t\tif (script == null)\r\n\t\t\tConsole.error('Script not found on address [$hashId]');\r\n\t\t\r\n\t\treturn script;\r\n\t}\r\n\t\r\n\tprivate function _store(script:Expr, hashId: Int):Int\r\n\t{\r\n\t\tif (_hashTable[hashId] != null)\r\n\t\t{\r\n\t\t\tif (Std.string(script) == Std.string(_hashTable[hashId]))\r\n\t\t\t{\r\n\t\t\t\t//Console.log('Same Script found: [$script] in hashId: [$hashId]');\r\n\t\t\t\treturn hashId;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tConsole.warn('Collision detected with hashId: [$hashId] and script [$script]. Previous Stored Entry Script: ' + _hashTable[hashId]);\r\n\t\t\t\treturn _store(script, ++hashId);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//Console.log('Entering hashId: [$hashId] with Script: $script');\r\n\t\t\t_hashTable[hashId] = script;\r\n\t\t\treturn hashId;\r\n\t\t}\r\n\t}\r\n}","/* Copyright  Spark.tools - All Rights Reserved\r\n * Unauthorized copying of this file, via any medium is strictly prohibited\r\n * Proprietary and confidential\r\n * Written by Aris Kostakos <aris@spark.tools>, August 2013\r\n */\r\n\r\npackage tools.spark.sliced.services.std.sound.core;\r\n\r\nimport flambe.sound.Playback;\r\nimport tools.spark.framework.Assets;\r\nimport tools.spark.sliced.interfaces.ISound;\r\nimport tools.spark.sliced.core.AService;\r\n\r\n/**\r\n * ...\r\n * @author Aris Kostakos\r\n */\r\nclass Sound extends AService implements ISound\r\n{\r\n\tpublic function new() \r\n\t{\r\n\t\tsuper();\r\n\t\t_init();\r\n\t}\r\n\t\r\n\tprivate function _init():Void\r\n\t{\r\n\t\tConsole.log(\"Init Sound std Service...\");\r\n\t}\r\n\t\r\n\tpublic function playSound(p_soundName:String, ?volume :Float):Playback\r\n\t{\r\n\t\treturn Assets.getSound(p_soundName).play(volume);\r\n\t}\r\n\t\r\n\tpublic function loopSound(p_soundName:String, ?volume :Float):Playback\r\n\t{\r\n\t\treturn Assets.getSound(p_soundName).loop(volume);\r\n\t}\r\n}","/*\n * Copyright (C)2005-2012 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n/**\n\tThis class defines mathematical functions and constants.\n**/\n#if cpp @:include(\"hxMath\") #end\nextern class Math\n{\n\t/**\n\t\tRepresents the ratio of the circumference of a circle to its diameter, \n\t\tspecified by the constant, . `PI` is approximately 3.141592653589793.\n\t**/\n\tstatic var PI(default,null) : Float;\n\n\t/**\n\t\tA special Float constant which denotes negative infinity.\n\n\t\tFor example, this is the result of -1.0 / 0.0.\n\n\t\tOperations with NEGATIVE_INFINITY as an operand may result in\n\t\tNEGATIVE_INFINITY, POSITIVE_INFINITY or NaN. \n\n\t\tIf this constant is converted to an Int, e.g. through Std.int(), the\n\t\tresult is unspecified.\n\t**/\n\tstatic var NEGATIVE_INFINITY(default, null) : Float;\n\n\t/**\n\t\tA special Float constant which denotes negative infinity.\n\n\t\tFor example, this is the result of 1.0 / 0.0.\n\n\t\tOperations with POSITIVE_INFINITY as an operand may result in\n\t\tNEGATIVE_INFINITY, POSITIVE_INFINITY or NaN. \n\n\t\tIf this constant is converted to an Int, e.g. through Std.int(), the\n\t\tresult is unspecified.\n\t**/\n\tstatic var POSITIVE_INFINITY(default,null) : Float;\n\n\t/**\n\t\tA special Float constant which denotes an invalid number.\n\n\t\tNaN stands for \"Not a Number\". It occurs when a mathematically incorrect\n\t\toperation is executed, such as taking the square root of a negative\n\t\tnumber: Math.sqrt(-1).\n\n\t\tAll further operations with NaN as an operand will result in NaN.\n\n\t\tIf this constant is converted to an Int, e.g. through Std.int(), the\n\t\tresult is unspecified.\n\n\t\tIn order to test if a value is NaN, you should use Math.isNaN() function.\n\n\t\t@php In PHP versions prior to 5.3.1 VC 9 there may be unexpected\n\t\tresults when performing arithmetic operations with NaN on Windows, \n\t\tsee [https://bugs.php.net/bug.php?id=42143]\n\t**/\n\tstatic var NaN(default, null) : Float;\n\n\t/**\n\t\tReturns the absolute value of `v`.\n\n\t\tIf `v` is positive or 0, the result is unchanged. Otherwise the result \n\t\tis -`v`.\n\t\t\n\t\tIf `v` is NEGATIVE_INFINITY or POSITIVE_INFINITY, the result is \n\t\tPOSITIVE_INFINITY.\n\t\t\n\t\tIf `v` is NaN, the result is NaN.\n\t**/\n\tstatic function abs(v:Float):Float;\n\n\t/**\n\t\tReturns the smaller of values `a` and `b`.\n\n\t\tIf `a` or `b` are NaN, the result is NaN.\n\t\tIf `a` or `b` are NEGATIVE_INFINITY, the result is NEGATIVE_INFINITY.\n\t\tIf `a` and `b` are POSITIVE_INFINITY, the result is POSITIVE_INFINITY.\n\t**/\n\tstatic function min(a:Float, b:Float):Float;\n\n\t/**\n\t\tReturns the greater of values `a` and `b`.\n\n\t\tIf `a` or `b` are NaN, the result is NaN.\n\t\tIf `a` or `b` are POSITIVE_INFINITY, the result is POSITIVE_INFINITY.\n\t\tIf `a` and `b` are NEGATIVE_INFINITY, the result is NEGATIVE_INFINITY.\n\t**/\n\tstatic function max(a:Float, b:Float):Float;\n\n\t/**\n\t\tReturns the trigonometric sine of the specified angle `v`, in radians.\n\t\t\n\t\tIf `v` is NaN or infinite, the result is NaN.\n\t**/\n\tstatic function sin(v:Float):Float;\n\n\t/**\n\t\tReturns the trigonometric cosine of the specified angle `v`, in radians.\n\t\t\n\t\tIf `v` is NaN or infinite, the result is NaN.\n\t**/\n\tstatic function cos(v:Float):Float;\n\n\t/**\n\t\tReturns the trigonometric tangent of the specified angle `v`, in radians.\n\t\t\n\t\tIf `v` is NaN or infinite, the result is NaN.\n\t**/\n\tstatic function tan(v:Float):Float;\n\n\t/**\n\t\tReturns the trigonometric arc of the specified angle `v`, in radians.\n\t\t\n\t\tIf `v` is NaN or infinite, the result is NaN.\n\t**/\n\tstatic function asin(v:Float):Float;\n\n\t/**\n\t\tReturns the trigonometric arc cosine of the specified angle `v`, \n\t\tin radians.\n\t\t\n\t\tIf `v` is NaN or infinite, the result is NaN.\n\t**/\n\tstatic function acos(v:Float):Float;\n\n\t/**\n\t\tReturns the trigonometric arc tangent of the specified angle `v`, \n\t\tin radians.\n\t\t\n\t\tIf `v` is NaN or infinite, the result is NaN.\n\t**/\n\tstatic function atan(v:Float):Float;\n\n\t/**\n\t\tReturns the trigonometric arc tangent whose tangent is the quotient of \n\t\ttwo specified numbers, in radians.\n\t\t\n\t\tIf parameter `x` or `y`  is NaN, NEGATIVE_INFINITY or POSITIVE_INFINITY, \n\t\tthe result is NaN.\n\t**/\n\tstatic function atan2(y:Float, x:Float):Float;\n\n\t/**\n\t\tReturns Euler's number, raised to the power of `v`.\n\t\t\n\t\texp(1.0) is approximately 2.718281828459.\n\t\t\n\t\tIf `v` is POSITIVE_INFINITY, the result is POSITIVE_INFINITY.\n\t\tIf `v` is NEGATIVE_INFINITY, the result is 0.0.\n\t\tIf `v` is NaN, the result is NaN.\n\t**/\n\tstatic function exp(v:Float):Float;\n\n\t/**\n\t\tReturns the natural logarithm of `v`.\n\t\t\n\t\tThis is the mathematical inverse operation of exp, \n\t\ti.e. `log(exp(v)) == v` always holds.\n\t\t\n\t\tIf `v` is negative (including NEGATIVE_INFINITY) or NaN, the result \n\t\tis NaN.\n\t\tIf `v` is POSITIVE_INFINITY, the result is POSITIVE_INFINITY.\n\t\tIf `v` is 0.0, the result is NEGATIVE_INFINITY.\n\t**/\n\tstatic function log(v:Float):Float;\n\n\t/**\n\t\tReturns a specified base `v` raised to the specified power `exp`.\n\t**/\n\tstatic function pow(v:Float, exp:Float):Float;\n\n\t/**\n\t\tReturns the square root of `v`.\n\t\t\n\t\tIf `v` is negative (including NEGATIVE_INFINITY) or NaN, the result \n\t\tis NaN.\n\t\tIf `v` is POSITIVE_INFINITY, the result is POSITIVE_INFINITY.\n\t\tIf `v` is 0.0, the result is 0.0.\n\t**/\n\tstatic function sqrt(v:Float):Float;\n\n\t/**\n\t\tRounds `v` to the nearest integer value.\n\t\t\n\t\tIf `v` is outside of the signed Int32 range, or is NaN, NEGATIVE_INFINITY \n\t\tor POSITIVE_INFINITY, the result is unspecified.\n\t**/\n\tstatic function round(v:Float):Int;\n\n\t/**\n\t\tReturns the largest integer value that is not greater than `v`.\n\n\t\tIf `v` is outside of the signed Int32 range, or is NaN, NEGATIVE_INFINITY \n\t\tor POSITIVE_INFINITY, the result is unspecified.\n\t**/\n\tstatic function floor(v:Float):Int;\n\n\t/**\n\t\tReturns the smallest integer value that is not less than `v`.\n\n\t\tIf `v` is outside of the signed Int32 range, or is NaN, NEGATIVE_INFINITY \n\t\tor POSITIVE_INFINITY, the result is unspecified.\n\t**/\n\tstatic function ceil(v:Float):Int;\n\n\t/**\n\t\tReturns a pseudo-random number which is greater than or equal to 0.0, \n\t\tand less than 1.0.\n\t**/\n\tstatic function random() : Float;\n\n\t#if ((flash9 && !as3) || cpp)\n\t/**\n\t\tReturns the largest integer value that is not greater than `v`, as a Float.\n\n\t\tIf `v` is is NaN, NEGATIVE_INFINITY or POSITIVE_INFINITY, \n\t\tthe result is unspecified.\n\t**/\n\tstatic function ffloor( v : Float ) : Float;\n\n\t/**\n\t\tReturns the smallest integer value that is not less than `v`, as a Float.\n\n\t\tIf `v` is is NaN, NEGATIVE_INFINITY or POSITIVE_INFINITY, \n\t\tthe result is unspecified.\n\t**/\n\tstatic function fceil( v : Float ) : Float;\n\n\t/**\n\t\tRounds `v` to the nearest integer value, as a Float.\n\n\t\tIf `v` is is NaN, NEGATIVE_INFINITY or POSITIVE_INFINITY, \n\t\tthe result is unspecified.\n\t**/\n\tstatic function fround( v : Float ) : Float;\n\n\t#else\n\n\tstatic inline function ffloor( v : Float ) : Float {\n\t\treturn floor(v);\n\t}\n\n\tstatic inline function fceil( v : Float ) : Float {\n\t\treturn ceil(v);\n\t}\n\n\tstatic inline function fround( v : Float ) : Float {\n\t\treturn round(v);\n\t}\n\n\t#end\n\n\n\t/**\n\t\tTells if `f` is a finite number.\n\n\t\tIf `f` is POSITIVE_INFINITY, NEGATIVE_INFINITY or NaN, the result \n\t\tis false, otherwise the result is true.\n\t**/\n\tstatic function isFinite( f : Float ) : Bool;\n\n\t/**\n\t\tTells if `f` is not a valid number.\n\n\t\tIf `f` is NaN, the result is true, otherwise the result is false. \n\t\tIn particular, both POSITIVE_INFINITY and NEGATIVE_INFINITY are\n\t\tnot considered NaN.\n\t**/\n\tstatic function isNaN( f : Float ) : Bool;\n\n\tprivate static function __init__() : Void untyped {\n\t#if flash9\n\t\tNaN = __global__[\"Number\"].NaN;\n\t\tNEGATIVE_INFINITY = __global__[\"Number\"].NEGATIVE_INFINITY;\n\t\tPOSITIVE_INFINITY = __global__[\"Number\"].POSITIVE_INFINITY;\n\t#else\n\t\t#if !js // genjs.ml will insert this only if necessary.\n\t\t\tMath.__name__ = [\"Math\"];\n\t\t#end\n\t\tMath.NaN = Number[\"NaN\"];\n\t\tMath.NEGATIVE_INFINITY = Number[\"NEGATIVE_INFINITY\"];\n\t\tMath.POSITIVE_INFINITY = Number[\"POSITIVE_INFINITY\"];\n\t#end\n\t#if js\n\t\t__feature__(\"Type.resolveClass\",$hxClasses['Math'] = Math);\n\t#end\n\t\tMath.isFinite = function(i) {\n\t\t\treturn\n\t\t\t#if flash9\n\t\t\t__global__[\"isFinite\"](i);\n\t\t\t#elseif flash\n\t\t\t_global[\"isFinite\"](i);\n\t\t\t#elseif js\n\t\t\t__js__(\"isFinite\")(i);\n\t\t\t#else\n\t\t\tfalse;\n\t\t\t#end\n\t\t};\n\t\tMath.isNaN = function(i) {\n\t\t\treturn\n\t\t\t#if flash9\n\t\t\t__global__[\"isNaN\"](i);\n\t\t\t#elseif flash\n\t\t\t_global[\"isNaN\"](i);\n\t\t\t#elseif js\n\t\t\t__js__(\"isNaN\")(i);\n\t\t\t#else\n\t\t\tfalse;\n\t\t\t#end\n\t\t};\n\t}\n\n}\n\n\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport sys.FileSystem;\nimport sys.io.File;\n\nimport haxe.macro.Context;\n\nusing StringTools;\n\n/**\n * Creates the asset manifests from the files in /assets\n */\nclass ManifestBuilder\n{\n    macro public static function use (assetsDir :String)\n    {\n        switch (Context.getType(\"flambe.asset.Manifest\")) {\n        case TInst(cl,_):\n            var cl = cl.get();\n            var meta = cl.meta;\n\n            if (!assetsDir.endsWith(\"/\")) {\n                assetsDir += \"/\";\n            }\n\n            var data = {};\n            for (packName in FileSystem.readDirectory(assetsDir)) {\n                var entries = [];\n                if (FileSystem.isDirectory(assetsDir + packName)) {\n                    for (file in readRecursive(assetsDir + packName)) {\n                        var path = assetsDir + packName + \"/\" + file;\n                        entries.push({\n                            name: file,\n                            md5: Context.signature(File.getBytes(path)),\n                            bytes: FileSystem.stat(path).size,\n                        });\n                    }\n                }\n                Reflect.setField(data, packName, entries);\n            }\n\n            meta.remove(\"assets\");\n            meta.add(\"assets\", [macro $v{data}], cl.pos);\n\n        default:\n            throw \"assert\";\n        }\n\n        return macro {};\n    }\n\n    private static function readRecursive (root, dir = \"\")\n    {\n        var result = [];\n        for (file in readDirectoryNoHidden(root + \"/\" + dir)) {\n            var fullPath = root + \"/\" + dir + \"/\" + file;\n            var relPath = if (dir == \"\") file else dir + \"/\" + file;\n            if (FileSystem.isDirectory(fullPath)) {\n                result = result.concat(readRecursive(root, relPath));\n            } else {\n                result.push(relPath);\n            }\n        }\n        return result;\n    }\n\n    private static function readDirectoryNoHidden (dir :String)\n    {\n        if (dir.fastCodeAt(dir.length - 1) == \"/\".code) {\n            // Trim off the trailing slash. On Windows, FileSystem.exists() doesn't find directories\n            // with trailing slashes?\n            dir = dir.substr(0, -1);\n        }\n        return FileSystem.exists(dir) && FileSystem.isDirectory(dir) ?\n            FileSystem.readDirectory(dir).filter(\n                function (file) return file.fastCodeAt(0) != \".\".code) :\n            cast [];\n    }\n}\n"],
"names":[],
"mappings":"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sB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAAsB,AACtB,AAA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"
}